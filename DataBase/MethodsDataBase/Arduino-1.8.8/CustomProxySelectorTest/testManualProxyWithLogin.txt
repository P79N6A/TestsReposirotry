@Test public void testManualProxyWithLogin() throws Exception {
  preferences.put(Constants.PREF_PROXY_TYPE,Constants.PROXY_TYPE_MANUAL);
  preferences.put(Constants.PREF_PROXY_MANUAL_TYPE,Constants.PROXY_MANUAL_TYPE_HTTP);
  preferences.put(Constants.PREF_PROXY_MANUAL_HOSTNAME,"localhost");
  preferences.put(Constants.PREF_PROXY_MANUAL_PORT,"8080");
  preferences.put(Constants.PREF_PROXY_MANUAL_USERNAME,"username");
  preferences.put(Constants.PREF_PROXY_MANUAL_PASSWORD,"pwd");
  CustomProxySelector proxySelector=new CustomProxySelector(preferences);
  Proxy proxy=proxySelector.getProxyFor(uri);
  assertEquals(new Proxy(Proxy.Type.HTTP,new InetSocketAddress("localhost",8080)),proxy);
  PasswordAuthentication authentication=Authenticator.requestPasswordAuthentication(null,8080,uri.toURL().getProtocol(),"ciao","");
  assertEquals(authentication.getUserName(),"username");
  assertEquals(String.valueOf(authentication.getPassword()),"pwd");
}
