@Test public void testServiceCallSuccess() throws Exception {
  final int port=SocketUtils.findAvailableTcpPort();
  final String serviceId=UUID.randomUUID().toString();
  final String serviceName=UUID.randomUUID().toString();
  context.addRoutes(new RouteBuilder(){
    @Override public void configure() throws Exception {
      from("direct:start").serviceCall().name(serviceName).component("jetty").defaultLoadBalancer().consulServiceDiscovery().url(consulUrl()).end().end().log("${body}");
      fromF("undertow:http://%s:%d/service/path",SERVICE_HOST,port).routeId(serviceId).routeGroup(serviceName).routePolicy(new ServiceRegistrationRoutePolicy()).transform().simple("${in.body} on " + port);
    }
  }
);
  context.start();
  assertEquals("ping on " + port,template.requestBody("direct:start","ping",String.class));
}
