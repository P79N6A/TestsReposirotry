@Test public void testGetHistory() throws Exception {
  List<Object> testArray=new ArrayList<>();
  List<Object> historyItems=new ArrayList<>();
  Map<String,Object> historyEnvelope1=new HashMap<>();
  Map<String,Object> historyItem1=new HashMap<>();
  historyItem1.put("a",11);
  historyItem1.put("b",22);
  historyEnvelope1.put("timetoken",1111);
  historyEnvelope1.put("message",historyItem1);
  Map<String,Object> historyEnvelope2=new HashMap<>();
  Map<String,Object> historyItem2=new HashMap<>();
  historyItem2.put("a",33);
  historyItem2.put("b",44);
  historyEnvelope2.put("timetoken",2222);
  historyEnvelope2.put("message",historyItem2);
  historyItems.add(historyEnvelope1);
  historyItems.add(historyEnvelope2);
  testArray.add(historyItems);
  testArray.add(1234);
  testArray.add(4321);
  stubFor(get(urlPathEqualTo("/v2/history/sub-key/mySubscribeKey/channel/myChannel")).willReturn(aResponse().withBody(getPubnub().getMapper().toJson(testArray))));
  Map<String,Object> headers=new HashMap<>();
  headers.put(PubNubConstants.OPERATION,"GETHISTORY");
  @SuppressWarnings("unchecked") List<PNHistoryItemResult> response=template.requestBodyAndHeaders("direct:publish",null,headers,List.class);
  assertNotNull(response);
  assertListSize(response,2);
}
