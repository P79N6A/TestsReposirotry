@Test public void testDocumentParseWithEncoding() throws Exception {
  File document=new File("src/test/resources/testOpenOffice2.odt");
  template.sendBody("direct:start4",document);
  resultEndpoint.setExpectedMessageCount(1);
  resultEndpoint.expectedMessagesMatches(new Predicate(){
    @Override public boolean matches(    Exchange exchange){
      Object body=exchange.getIn().getBody(String.class);
      Map<String,Object> headerMap=exchange.getIn().getHeaders();
      assertThat(body,instanceOf(String.class));
      Charset detectedCharset=null;
      try {
        InputStream bodyIs=new ByteArrayInputStream(((String)body).getBytes(StandardCharsets.UTF_16));
        UniversalEncodingDetector encodingDetector=new UniversalEncodingDetector();
        detectedCharset=encodingDetector.detect(bodyIs,new Metadata());
      }
 catch (      IOException e1) {
        fail();
      }
      assertThat(detectedCharset.name(),startsWith(StandardCharsets.UTF_16.name()));
      assertThat(headerMap.get(Exchange.CONTENT_TYPE),equalTo("application/vnd.oasis.opendocument.text"));
      return true;
    }
  }
);
  resultEndpoint.assertIsSatisfied();
}
