@Test public void testViewReferences() throws Exception {
  TestClusterService service=new TestClusterService(UUID.randomUUID().toString());
  service.start();
  TestClusterView view1=service.getView("ns1").unwrap(TestClusterView.class);
  TestClusterView view2=service.getView("ns1").unwrap(TestClusterView.class);
  TestClusterView view3=service.getView("ns2").unwrap(TestClusterView.class);
  Assert.assertEquals(ServiceStatus.Started,view1.getStatus());
  Assert.assertEquals(ServiceStatus.Started,view2.getStatus());
  Assert.assertEquals(ServiceStatus.Started,view3.getStatus());
  service.releaseView(view1);
  Assert.assertEquals(ServiceStatus.Started,view1.getStatus());
  Assert.assertEquals(ServiceStatus.Started,view2.getStatus());
  Assert.assertEquals(ServiceStatus.Started,view3.getStatus());
  service.releaseView(view2);
  Assert.assertEquals(ServiceStatus.Stopped,view1.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,view2.getStatus());
  Assert.assertEquals(ServiceStatus.Started,view3.getStatus());
  service.releaseView(view3);
  TestClusterView newView1=service.getView("ns1").unwrap(TestClusterView.class);
  TestClusterView newView2=service.getView("ns1").unwrap(TestClusterView.class);
  Assert.assertEquals(newView1,newView2);
  Assert.assertEquals(view1,newView1);
  Assert.assertEquals(view1,newView2);
  Assert.assertEquals(ServiceStatus.Started,newView1.getStatus());
  Assert.assertEquals(ServiceStatus.Started,newView2.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,view3.getStatus());
  service.stop();
  Assert.assertEquals(ServiceStatus.Stopped,view1.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,view2.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,view3.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,newView1.getStatus());
  Assert.assertEquals(ServiceStatus.Stopped,newView2.getStatus());
}
