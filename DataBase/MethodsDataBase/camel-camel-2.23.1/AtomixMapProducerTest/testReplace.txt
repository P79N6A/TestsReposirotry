@Test public void testReplace() throws Exception {
  final String key=context().getUuidGenerator().generateUuid();
  final String oldVal=context().getUuidGenerator().generateUuid();
  final String newVal=context().getUuidGenerator().generateUuid();
  map.put(key,oldVal).join();
  Message result;
  result=fluent.clearAll().withHeader(AtomixClientConstants.RESOURCE_ACTION,AtomixMap.Action.REPLACE).withHeader(AtomixClientConstants.RESOURCE_KEY,key).withHeader(AtomixClientConstants.RESOURCE_OLD_VALUE,context().getUuidGenerator().generateUuid()).withBody(newVal).request(Message.class);
  assertTrue(result.getHeader(AtomixClientConstants.RESOURCE_ACTION_HAS_RESULT,Boolean.class));
  assertFalse(result.getBody(Boolean.class));
  assertEquals(oldVal,map.get(key).join());
  result=fluent.clearAll().withHeader(AtomixClientConstants.RESOURCE_ACTION,AtomixMap.Action.REPLACE).withHeader(AtomixClientConstants.RESOURCE_KEY,key).withHeader(AtomixClientConstants.RESOURCE_OLD_VALUE,oldVal).withBody(newVal).request(Message.class);
  assertTrue(result.getHeader(AtomixClientConstants.RESOURCE_ACTION_HAS_RESULT,Boolean.class));
  assertTrue(result.getBody(Boolean.class));
  assertEquals(newVal,map.get(key).join());
  map.put(key,oldVal).join();
  result=fluent.clearAll().withHeader(AtomixClientConstants.RESOURCE_ACTION,AtomixMap.Action.REPLACE).withHeader(AtomixClientConstants.RESOURCE_KEY,key).withBody(newVal).request(Message.class);
  assertTrue(result.getHeader(AtomixClientConstants.RESOURCE_ACTION_HAS_RESULT,Boolean.class));
  assertEquals(oldVal,result.getBody(String.class));
  assertEquals(newVal,map.get(key).join());
}
