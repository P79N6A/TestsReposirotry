@Test public void shouldProcessPlatformEvents() throws Exception {
  when(endpoint.getTopicName()).thenReturn("/event/TestEvent__e");
  final Message message=new HashMapMessage();
  final Map<String,Object> data=new HashMap<>();
  data.put("schema","30H2pgzuWcF844p26Ityvg");
  final Map<String,Object> payload=new HashMap<>();
  payload.put("Test_Field__c","abc");
  payload.put("CreatedById","00541000002WYFpAAO");
  payload.put("CreatedDate","2018-07-06T12:41:04Z");
  data.put("payload",payload);
  data.put("event",Collections.singletonMap("replayId",4L));
  message.put("data",data);
  message.put("channel","/event/TestEvent__e");
  final SalesforceConsumer consumer=new SalesforceConsumer(endpoint,processor,NOT_USED);
  consumer.processMessage(mock(ClientSessionChannel.class),message);
  final ZonedDateTime created=ZonedDateTime.parse("2018-07-06T12:41:04Z");
  final PlatformEvent event=new PlatformEvent(created,"00541000002WYFpAAO");
  event.set("Test_Field__c","abc");
  verify(in).setBody(event);
  verify(in).setHeader("CamelSalesforceCreatedDate",created);
  verify(in).setHeader("CamelSalesforceReplayId",4L);
  verify(in).setHeader("CamelSalesforceChannel","/event/TestEvent__e");
  verify(in).setHeader("CamelSalesforceEventType","TestEvent__e");
  verify(in).setHeader("CamelSalesforcePlatformEventSchema","30H2pgzuWcF844p26Ityvg");
  verify(processor).process(same(exchange),any());
  verifyNoMoreInteractions(in,processor);
}
