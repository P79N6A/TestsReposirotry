@Test public void testManagedResource() throws Exception {
  if (isPlatform("aix")) {
    return;
  }
  final ManagementAgent managementAgent=context.getManagementStrategy().getManagementAgent();
  Assert.assertNotNull(managementAgent);
  final MBeanServer mBeanServer=managementAgent.getMBeanServer();
  Assert.assertNotNull(mBeanServer);
  final String mBeanServerDefaultDomain=managementAgent.getMBeanServerDefaultDomain();
  Assert.assertEquals("org.apache.camel",mBeanServerDefaultDomain);
  final String managementName=context.getManagementName();
  Assert.assertNotNull("CamelContext should have a management name if JMX is enabled",managementName);
  LOG.info("managementName = {}",managementName);
  ObjectName onContext=ObjectName.getInstance(mBeanServerDefaultDomain + ":context=" + managementName+ ",type=context,name=\""+ context.getName()+ "\"");
  Assert.assertTrue("Should be registered",mBeanServer.isRegistered(onContext));
  ObjectName onManagedBean=ObjectName.getInstance(mBeanServerDefaultDomain + ":context=" + managementName+ ",type=processors,name=\"myManagedBean\"");
  LOG.info("Canonical Name = {}",onManagedBean.getCanonicalName());
  Assert.assertTrue("Should be registered",mBeanServer.isRegistered(onManagedBean));
  template.sendBody("direct:start","Hello Camel");
  template.sendBody("direct:start","Camel Rocks!");
  int camelsSeenCount=(Integer)mBeanServer.getAttribute(onManagedBean,"CamelsSeenCount");
  Assert.assertEquals(2,camelsSeenCount);
  mBeanServer.invoke(onManagedBean,"resetCamelsSeenCount",null,null);
  camelsSeenCount=(Integer)mBeanServer.getAttribute(onManagedBean,"CamelsSeenCount");
  Assert.assertEquals(0,camelsSeenCount);
  String camelId=(String)mBeanServer.getAttribute(onManagedBean,"CamelId");
  assertEquals(context.getName(),camelId);
  String state=(String)mBeanServer.getAttribute(onManagedBean,"State");
  assertEquals("Started",state);
  String fqn=(String)mBeanServer.getAttribute(onManagedBean,"BeanClassName");
  assertEquals(MyManagedBean.class.getCanonicalName(),fqn);
}
