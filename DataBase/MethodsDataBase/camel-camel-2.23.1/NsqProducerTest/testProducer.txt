@Test public void testProducer() throws Exception {
  CountDownLatch lock=new CountDownLatch(1);
  template.sendBody("direct:send",TEST_MESSAGE);
  AtomicInteger counter=new AtomicInteger(0);
  NSQLookup lookup=new DefaultNSQLookup();
  lookup.addLookupAddress("localhost",4161);
  NSQConsumer consumer=new NSQConsumer(lookup,"test","testconsumer",(message) -> {
    counter.incrementAndGet();
    message.finished();
    lock.countDown();
    assertTrue(new String(message.getMessage()).equals(TEST_MESSAGE));
  }
);
  consumer.start();
  lock.await(30,TimeUnit.SECONDS);
  assertTrue(counter.get() == Long.valueOf(1));
  consumer.shutdown();
}
