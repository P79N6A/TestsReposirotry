@Test public void testRemove() throws Exception {
  assertEquals(0,testCollection.count());
  for (int i=1; i <= 100; i++) {
    String body=null;
    Formatter f=new Formatter();
    if (i % 2 == 0) {
      body=f.format("{\"_id\":\"testSave%d\", \"scientist\":\"Einstein\"}",i).toString();
    }
 else {
      body=f.format("{\"_id\":\"testSave%d\", \"scientist\":\"Einstein\", \"extraField\": true}",i).toString();
    }
    f.close();
    template.requestBody("direct:insert",body);
  }
  assertEquals(100L,testCollection.count());
  BasicDBObject extraField=new BasicDBObject("extraField",true);
  assertEquals("Number of records with 'extraField' flag on must equal 50",50L,testCollection.count(extraField));
  Exchange resultExchange=template.request("direct:remove",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody(extraField);
    }
  }
);
  Object result=resultExchange.getOut().getBody();
  assertTrue(result instanceof DeleteResult);
  assertEquals("Number of records deleted header should equal 50",50L,resultExchange.getOut().getHeader(MongoDbConstants.RECORDS_AFFECTED));
  assertEquals("Number of records with 'extraField' flag on must be 0 after remove",0,testCollection.count(extraField));
}
