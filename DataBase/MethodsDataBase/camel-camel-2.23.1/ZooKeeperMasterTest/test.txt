@Test public void test() throws Exception {
  TestZookeeperServer server=null;
  try {
    server=new TestZookeeperServer(PORT,true);
    ZooKeeperTestSupport.waitForServerUp("localhost:" + PORT,1000);
    for (    String id : CLIENTS) {
      SCHEDULER.submit(() -> run(id));
    }
    LATCH.await(1,TimeUnit.MINUTES);
    SCHEDULER.shutdownNow();
    Assert.assertEquals(CLIENTS.size(),RESULTS.size());
    Assert.assertTrue(RESULTS.containsAll(CLIENTS));
  }
  finally {
    if (server != null) {
      server.shutdown();
    }
  }
}
