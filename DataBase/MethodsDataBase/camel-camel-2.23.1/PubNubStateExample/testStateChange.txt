@Test public void testStateChange() throws Exception {
  Map<String,Object> myState=new HashMap<>();
  myState.put("state","online");
  myState.put("name","preben");
  Map<String,Object> headers=new HashMap<>();
  headers.put(PubNubConstants.OPERATION,"SETSTATE");
  PNSetStateResult response=template.requestBodyAndHeaders("direct:publish",myState,headers,PNSetStateResult.class);
  assertNotNull(response);
  assertNotNull(response.getState());
  assertEquals("preben",response.getState().getAsJsonObject().get("name").getAsString());
  resetMocks();
  getMockEndpoint("mock:result").expectedMessageCount(1);
  headers.clear();
  headers.put(PubNubConstants.OPERATION,"GETSTATE");
  PNGetStateResult getStateResult=template.requestBodyAndHeader("direct:publish",null,PubNubConstants.OPERATION,"GETSTATE",PNGetStateResult.class);
  assertMockEndpointsSatisfied();
  assertEquals("preben",getStateResult.getStateByUUID().get("iot").getAsJsonObject().get("name").getAsString());
}
