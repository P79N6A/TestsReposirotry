@Test public void testPingAsyncAsyncRecovery() throws Exception {
  int messageGroupCount=5;
  for (int i=1; i <= messageGroupCount; i++) {
    template.sendBody("direct:grpc-stream-async-async-route",PingRequest.newBuilder().setPingName(String.valueOf(i)).build());
  }
  template.sendBody("direct:grpc-stream-async-async-route",PingRequest.newBuilder().setPingName(String.valueOf("error")).build());
  MockEndpoint replies=getMockEndpoint("mock:grpc-replies");
  replies.expectedMessageCount(messageGroupCount);
  replies.assertIsSatisfied();
  Thread.sleep(200);
  for (int i=messageGroupCount + 1; i <= 2 * messageGroupCount; i++) {
    template.sendBody("direct:grpc-stream-async-async-route",PingRequest.newBuilder().setPingName(String.valueOf(i)).build());
  }
  replies.reset();
  replies.expectedMessageCount(messageGroupCount);
  replies.assertIsSatisfied();
  context().stop();
  assertNotNull(pingPongServer.getLastStreamRequests());
  assertListSize(pingPongServer.getLastStreamRequests(),2);
  assertListSize(pingPongServer.getLastStreamRequests().get(0),messageGroupCount + 1);
  assertListSize(pingPongServer.getLastStreamRequests().get(1),messageGroupCount);
}
