@Test public void reserveWithHeadersTest() throws Exception {
  when(endpoint.getOperation()).thenReturn(GlanceConstants.RESERVE);
  msg.setHeader(OpenstackConstants.NAME,dummyImage.getName());
  msg.setHeader(GlanceConstants.CONTAINER_FORMAT,dummyImage.getContainerFormat());
  msg.setHeader(GlanceConstants.DISK_FORMAT,dummyImage.getDiskFormat());
  msg.setHeader(GlanceConstants.CHECKSUM,dummyImage.getChecksum());
  msg.setHeader(GlanceConstants.MIN_DISK,dummyImage.getMinDisk());
  msg.setHeader(GlanceConstants.MIN_RAM,dummyImage.getMinRam());
  msg.setHeader(GlanceConstants.OWNER,dummyImage.getOwner());
  producer.process(exchange);
  verify(imageService).reserve(captor.capture());
  assertEqualsImages(dummyImage,captor.getValue());
  final Image result=msg.getBody(Image.class);
  assertNotNull(result.getId());
  assertEqualsImages(dummyImage,result);
}
