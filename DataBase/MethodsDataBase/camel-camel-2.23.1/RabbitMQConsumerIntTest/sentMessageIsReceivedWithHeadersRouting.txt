/** 
 * Tests the proper rabbit binding arguments are in place when the headersExchangeWithQueue is created. Should only receive messages with the header [foo=bar]
 */
@Test public void sentMessageIsReceivedWithHeadersRouting() throws InterruptedException, IOException, TimeoutException {
  to.expectedMessageCount(1);
  Channel channel=connection().createChannel();
  channel.basicPublish(HEADERS_EXCHANGE,"",propertiesWithHeader("foo","bar"),MSG.getBytes());
  channel.basicPublish(HEADERS_EXCHANGE,"",null,MSG.getBytes());
  channel.basicPublish(HEADERS_EXCHANGE,"",propertiesWithHeader("foo","bra"),MSG.getBytes());
  to.assertIsSatisfied();
}
