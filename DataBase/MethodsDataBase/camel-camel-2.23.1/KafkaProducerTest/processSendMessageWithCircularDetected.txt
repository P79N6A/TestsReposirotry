@Test public void processSendMessageWithCircularDetected() throws Exception {
  endpoint.getConfiguration().setTopic("sometopic");
  endpoint.getConfiguration().setCircularTopicDetection(true);
  Mockito.when(exchange.getIn()).thenReturn(in);
  Mockito.when(exchange.getOut()).thenReturn(out);
  Mockito.when(exchange.getFromEndpoint()).thenReturn(fromEndpoint);
  in.setHeader(KafkaConstants.TOPIC,"fromtopic");
  in.setHeader(KafkaConstants.KEY,"somekey");
  producer.process(exchange);
  verifySendMessage("sometopic","somekey");
  assertRecordMetadataExists();
}
