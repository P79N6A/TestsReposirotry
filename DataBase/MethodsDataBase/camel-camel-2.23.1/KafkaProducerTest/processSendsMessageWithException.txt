@Test(expected=Exception.class) @SuppressWarnings({"unchecked"}) public void processSendsMessageWithException() throws Exception {
  endpoint.getConfiguration().setTopic("sometopic");
  org.apache.kafka.clients.producer.KafkaProducer kp=producer.getKafkaProducer();
  Mockito.when(kp.send(any(ProducerRecord.class))).thenThrow(new ApiException());
  Mockito.when(exchange.getIn()).thenReturn(in);
  in.setHeader(KafkaConstants.PARTITION_KEY,4);
  producer.process(exchange);
  assertRecordMetadataExists();
}
