@Test public void producedMessageWithNotNullHeaders() throws InterruptedException, IOException, TimeoutException {
  final List<String> received=new ArrayList<>();
  final Map<String,Object> receivedHeaders=new HashMap<String,Object>();
  Map<String,Object> headers=new HashMap<String,Object>();
  headers.put(RabbitMQConstants.EXCHANGE_NAME,EXCHANGE);
  headers.put(CUSTOM_HEADER,CUSTOM_HEADER.toLowerCase());
  channel.basicConsume("sammyq",true,new ArrayPopulatingConsumer(received,receivedHeaders));
  template.sendBodyAndHeaders("new message",headers);
  assertThatBodiesAndHeadersReceivedIn(receivedHeaders,headers,received,"new message");
}
