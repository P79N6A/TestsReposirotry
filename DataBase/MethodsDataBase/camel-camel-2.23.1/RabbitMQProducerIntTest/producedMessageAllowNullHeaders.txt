@Test public void producedMessageAllowNullHeaders() throws InterruptedException, IOException, TimeoutException {
  final List<String> received=new ArrayList<>();
  final Map<String,Object> receivedHeaders=new HashMap<String,Object>();
  Map<String,Object> headers=new HashMap<String,Object>();
  headers.put(RabbitMQConstants.EXCHANGE_NAME,null);
  headers.put(CUSTOM_HEADER,null);
  channel.basicConsume("sammyq",true,new ArrayPopulatingConsumer(received,receivedHeaders));
  templateAllowNullHeaders.sendBodyAndHeaders("new message",headers);
  assertThatBodiesAndHeadersReceivedIn(receivedHeaders,headers,received,"new message");
}
