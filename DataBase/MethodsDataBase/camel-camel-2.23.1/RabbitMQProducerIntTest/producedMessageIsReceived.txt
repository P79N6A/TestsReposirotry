@Test public void producedMessageIsReceived() throws InterruptedException, IOException, TimeoutException {
  final List<String> received=new ArrayList<>();
  channel.basicConsume("sammyq",true,new ArrayPopulatingConsumer(received));
  template.sendBodyAndHeader("new message",RabbitMQConstants.EXCHANGE_NAME,"ex1");
  assertThatBodiesReceivedIn(received,"new message");
}
