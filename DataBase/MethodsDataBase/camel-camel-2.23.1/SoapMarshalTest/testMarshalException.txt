/** 
 * Test Soap marshalling by sending a NoSuchCustomerException object and checking against a xml file. We expect to receive a SOAP fault here that contains a NoSuchCustomer object as detail.
 * @throws IOException
 * @throws InterruptedException
 */
@Test public void testMarshalException() throws IOException, InterruptedException {
  InputStream in=this.getClass().getResourceAsStream("SoapMarshalTestExpectedFault.xml");
  resultEndpoint.expectedMessageCount(1);
  resultEndpoint.expectedBodiesReceived(TestUtil.readStream(in));
  NoSuchCustomer noSuchCustomer=new NoSuchCustomer();
  noSuchCustomer.setCustomerId("None");
  NoSuchCustomerException exception=new NoSuchCustomerException("No customer found",noSuchCustomer);
  producer.sendBodyAndHeader(null,Exchange.EXCEPTION_CAUGHT,exception);
  resultEndpoint.assertIsSatisfied();
}
