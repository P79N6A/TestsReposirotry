@Test public void testToFunctionWithExchange() throws Exception {
  context.start();
  Set<String> values=Collections.synchronizedSet(new TreeSet<>());
  CountDownLatch latch=new CountDownLatch(3);
  Function<Object,Publisher<Exchange>> fun=crs.to("bean:hello");
  Flux.just(1,2,3).flatMap(fun).map(e -> e.getOut()).map(e -> e.getBody(String.class)).doOnNext(res -> values.add(res)).doOnNext(res -> latch.countDown()).subscribe();
  Assert.assertTrue(latch.await(2,TimeUnit.SECONDS));
  Assert.assertEquals(new TreeSet<>(Arrays.asList("Hello 1","Hello 2","Hello 3")),values);
}
