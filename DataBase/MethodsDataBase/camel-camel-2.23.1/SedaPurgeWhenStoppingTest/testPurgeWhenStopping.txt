@Test public void testPurgeWhenStopping() throws Exception {
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMessageCount(1);
  for (int i=0; i < 100; i++) {
    template.sendBody("seda:foo","Message " + i);
  }
  context.startRoute("myRoute");
  latch.await(2,TimeUnit.SECONDS);
  context.stopRoute("myRoute");
  latch2.countDown();
  mock.setAssertPeriod(500);
  mock.assertIsSatisfied();
}
