@Test public void testRedeliveryErrorHandlerNoRedeliveryOnShutdown() throws Exception {
  getMockEndpoint("mock:foo").expectedMessageCount(1);
  getMockEndpoint("mock:deadLetter").expectedMessageCount(1);
  getMockEndpoint("mock:deadLetter").setResultWaitTime(25000);
  template.sendBody("seda:foo","Hello World");
  getMockEndpoint("mock:foo").assertIsSatisfied();
  StopWatch watch=new StopWatch();
  Thread.sleep(500);
  log.info("==== stopping route foo ====");
  context.stopRoute("foo");
  long taken=watch.taken();
  getMockEndpoint("mock:deadLetter").assertIsSatisfied();
  log.info("OnRedelivery processor counter {}",counter.get());
  assertTrue("Should stop route faster, was " + taken,taken < 5000);
  assertTrue("Redelivery counter should be >= 20 and < 100, was: " + counter.get(),counter.get() >= 20 && counter.get() < 100);
}
