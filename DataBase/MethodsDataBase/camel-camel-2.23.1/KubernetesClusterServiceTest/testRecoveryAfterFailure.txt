@Test public void testRecoveryAfterFailure() throws Exception {
  LeaderRecorder mypod1=addMember("mypod1");
  LeaderRecorder mypod2=addMember("mypod2");
  context.start();
  mypod1.waitForAnyLeader(2,TimeUnit.SECONDS);
  mypod2.waitForAnyLeader(2,TimeUnit.SECONDS);
  String firstLeader=mypod1.getCurrentLeader();
  for (int i=0; i < 3; i++) {
    refuseRequestsFromPod(firstLeader);
    Thread.sleep(RENEW_DEADLINE_MILLIS);
    allowRequestsFromPod(firstLeader);
    Thread.sleep(LEASE_TIME_MILLIS);
  }
  assertEquals(firstLeader,mypod1.getCurrentLeader());
  assertEquals(firstLeader,mypod2.getCurrentLeader());
}
