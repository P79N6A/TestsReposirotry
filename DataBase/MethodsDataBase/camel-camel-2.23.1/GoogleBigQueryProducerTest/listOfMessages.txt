@Test public void listOfMessages() throws Exception {
  List<Map<String,String>> messages=new ArrayList<>();
  messages.add(new HashMap<>());
  messages.add(new HashMap<>());
  producer.process(createExchangeWithBody(messages));
  ArgumentCaptor<TableDataInsertAllRequest> dataCaptor=ArgumentCaptor.forClass(TableDataInsertAllRequest.class);
  verify(tabledataMock).insertAll(eq(projectId),eq(datasetId),eq(tableId),dataCaptor.capture());
  List<TableDataInsertAllRequest> requests=dataCaptor.getAllValues();
  assertEquals(1,requests.size());
  assertEquals(2,requests.get(0).getRows().size());
}
