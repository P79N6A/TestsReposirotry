/** 
 * When the setting useMessageIdAsCorrelationid is false and a correlation id is not set on the message then we expect the reply to contain the correlation id dynamically generated on send. Ideally we should also check what happens if the correlation id was not set on send but this is currently not done.
 */
@Test public void testRequestReplyCorrelationWithoutGivenCorrelationId() throws Exception {
  MockEndpoint result=getMockEndpoint("mock:result");
  result.expectedMessageCount(1);
  Exchange out=template.send("jms:queue:hello",ExchangePattern.InOut,new Processor(){
    public void process(    Exchange exchange) throws Exception {
      Message in=exchange.getIn();
      in.setBody("Hello World");
    }
  }
);
  result.assertIsSatisfied();
  assertNotNull(out);
  assertEquals(REPLY_BODY,out.getOut().getBody(String.class));
  String correlationId=out.getOut().getHeader("JMSCorrelationID",String.class);
  assertNotNull(correlationId);
  assertFalse("CorrelationID should NOT start with ID, was: " + correlationId,correlationId.startsWith("ID:"));
}
