/** 
 * When the setting useMessageIdAsCorrelationid is true for the client and false for the server and a correlation id is not set on the message then we expect the reply to contain the message is from the sent message
 */
@Test public void testRequestReplyCorrelationWithoutGivenCorrelationIdAndUseMessageIdonClient() throws Exception {
  MockEndpoint result=getMockEndpoint("mock:result");
  result.expectedMessageCount(1);
  Exchange out=template.send("jms2:queue:hello",ExchangePattern.InOut,new Processor(){
    public void process(    Exchange exchange) throws Exception {
      Message in=exchange.getIn();
      in.setBody("Hello World");
    }
  }
);
  result.assertIsSatisfied();
  assertNotNull(out);
  assertEquals(REPLY_BODY,out.getOut().getBody(String.class));
  String correlationId=(String)out.getOut().getHeader("JMSCorrelationID");
  assertNotNull(correlationId);
  assertTrue("CorrelationID should start with ID, was: " + correlationId,correlationId.startsWith("ID:"));
}
