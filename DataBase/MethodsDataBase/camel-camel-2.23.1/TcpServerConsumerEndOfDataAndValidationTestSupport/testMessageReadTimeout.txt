@Test public void testMessageReadTimeout() throws Exception {
  expectedCompleteCount=1;
  expectedInvalidCount=1;
  setExpectedCounts();
  NotifyBuilder oneDone=new NotifyBuilder(context).whenDone(1).create();
  NotifyBuilder twoDone=new NotifyBuilder(context).whenDone(2).create();
  mllpClient.sendFramedData(Hl7TestMessageGenerator.generateMessage());
  assertTrue("One exchange should have completed",oneDone.matches(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
  mllpClient.setSendEndOfBlock(false);
  mllpClient.setSendEndOfData(false);
  mllpClient.sendMessageAndWaitForAcknowledgement(Hl7TestMessageGenerator.generateMessage());
  assertTrue("Two exchanges should have completed",twoDone.matches(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
}
