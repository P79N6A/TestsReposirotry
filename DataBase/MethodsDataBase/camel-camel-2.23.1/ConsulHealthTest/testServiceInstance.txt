@Test public void testServiceInstance() throws Exception {
  List<ServiceHealth> ref=getConsul().healthClient().getAllServiceInstances(this.service).getResponse();
  List<ServiceHealth> res=fluentTemplate().withHeader(ConsulConstants.CONSUL_ACTION,ConsulHealthActions.SERVICE_INSTANCES).withHeader(ConsulConstants.CONSUL_SERVICE,this.service).to("direct:consul").request(List.class);
  Assert.assertEquals(2,ref.size());
  Assert.assertEquals(2,res.size());
  Assert.assertEquals(ref,res);
  assertTrue(registrations.stream().anyMatch(r -> r.getPort().isPresent() && r.getPort().get() == res.get(0).getService().getPort() && r.getId().equalsIgnoreCase(res.get(0).getService().getId())));
  assertTrue(registrations.stream().anyMatch(r -> r.getPort().isPresent() && r.getPort().get() == res.get(1).getService().getPort() && r.getId().equalsIgnoreCase(res.get(1).getService().getId())));
}
