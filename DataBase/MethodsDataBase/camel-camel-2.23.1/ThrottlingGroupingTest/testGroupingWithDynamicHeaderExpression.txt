@Test public void testGroupingWithDynamicHeaderExpression() throws Exception {
  getMockEndpoint("mock:result").expectedBodiesReceived("Hello World");
  getMockEndpoint("mock:result2").expectedBodiesReceived("Bye World");
  getMockEndpoint("mock:dead").expectedBodiesReceived("Kaboom","Saloon");
  getMockEndpoint("mock:resultdynamic").expectedBodiesReceived("Hello Dynamic World","Bye Dynamic World");
  Map<String,Object> headers=new HashMap<String,Object>();
  template.sendBodyAndHeaders("seda:a","Kaboom",headers);
  template.sendBodyAndHeaders("seda:a","Saloon",headers);
  headers.put("max","2");
  template.sendBodyAndHeaders("seda:a","Hello World",headers);
  template.sendBodyAndHeaders("seda:b","Bye World",headers);
  headers.put("max","2");
  headers.put("key","1");
  template.sendBodyAndHeaders("seda:c","Hello Dynamic World",headers);
  headers.put("key","2");
  template.sendBodyAndHeaders("seda:c","Bye Dynamic World",headers);
  assertMockEndpointsSatisfied();
}
