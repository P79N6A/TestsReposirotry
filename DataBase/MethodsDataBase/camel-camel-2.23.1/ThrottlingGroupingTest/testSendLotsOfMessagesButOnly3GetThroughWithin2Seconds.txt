@Test public void testSendLotsOfMessagesButOnly3GetThroughWithin2Seconds() throws Exception {
  MockEndpoint resultEndpoint=resolveMandatoryEndpoint("mock:gresult",MockEndpoint.class);
  resultEndpoint.expectedMessageCount(3);
  resultEndpoint.setResultWaitTime(2000);
  Map<String,Object> headers=new HashMap<String,Object>();
  for (int i=0; i < 9; i++) {
    if (i % 2 == 0) {
      headers.put("key","1");
    }
 else {
      headers.put("key","2");
    }
    template.sendBodyAndHeaders("seda:ga","<message>" + i + "</message>",headers);
  }
  resultEndpoint.assertIsSatisfied();
}
