@Test(expected=InvalidStateException.class) public void testPgEventProducerProcessDbThrowsInvalidStateException() throws Exception {
  when(endpoint.getDatasource()).thenReturn(dataSource);
  when(dataSource.getConnection()).thenReturn(connection);
  when(connection.isClosed()).thenThrow(new SQLException("DB problem occurred"));
  PgEventProducer producer=new PgEventProducer(endpoint);
  producer.start();
  producer.process(exchange);
}
