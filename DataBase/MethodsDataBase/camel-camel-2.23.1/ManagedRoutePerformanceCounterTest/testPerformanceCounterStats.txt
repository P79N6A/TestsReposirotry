@Test public void testPerformanceCounterStats() throws Exception {
  if (isPlatform("aix")) {
    return;
  }
  MBeanServer mbeanServer=getMBeanServer();
  ObjectName on=ObjectName.getInstance("org.apache.camel:context=camel-1,type=routes,name=\"route1\"");
  Long delta=(Long)mbeanServer.getAttribute(on,"DeltaProcessingTime");
  assertEquals(0,delta.intValue());
  getMockEndpoint("mock:result").expectedMessageCount(1);
  template.asyncSendBody("direct:start","Hello World");
  await().atMost(5,TimeUnit.SECONDS).until(() -> {
    Integer num=(Integer)mbeanServer.getAttribute(on,"InflightExchanges");
    return num == 1;
  }
);
  assertMockEndpointsSatisfied();
  await().atMost(5,TimeUnit.SECONDS).untilAsserted(() -> {
    Long completed=(Long)mbeanServer.getAttribute(on,"ExchangesCompleted");
    assertEquals(1,completed.longValue());
  }
);
  delta=(Long)mbeanServer.getAttribute(on,"DeltaProcessingTime");
  Long last=(Long)mbeanServer.getAttribute(on,"LastProcessingTime");
  Long total=(Long)mbeanServer.getAttribute(on,"TotalProcessingTime");
  assertNotNull(delta);
  assertTrue("Should take around 1 sec: was " + last,last > 900);
  assertTrue("Should take around 1 sec: was " + total,total > 900);
  template.sendBody("direct:start","Bye World");
  Long completed=(Long)mbeanServer.getAttribute(on,"ExchangesCompleted");
  assertEquals(2,completed.longValue());
  delta=(Long)mbeanServer.getAttribute(on,"DeltaProcessingTime");
  last=(Long)mbeanServer.getAttribute(on,"LastProcessingTime");
  total=(Long)mbeanServer.getAttribute(on,"TotalProcessingTime");
  assertNotNull(delta);
  assertTrue("Should take around 1 sec: was " + last,last > 900);
  assertTrue("Should be around 2 sec now: was " + total,total > 1900);
  Date reset=(Date)mbeanServer.getAttribute(on,"ResetTimestamp");
  assertNotNull(reset);
  Date lastFailed=(Date)mbeanServer.getAttribute(on,"LastExchangeFailureTimestamp");
  Date firstFailed=(Date)mbeanServer.getAttribute(on,"FirstExchangeFailureTimestamp");
  assertNull(lastFailed);
  assertNull(firstFailed);
  Integer inFlight=(Integer)mbeanServer.getAttribute(on,"InflightExchanges");
  assertEquals(0,inFlight.longValue());
}
