@Test public void testPgEventConsumerStop() throws Exception {
  PGDataSource dataSource=mock(PGDataSource.class);
  PGConnection connection=mock(PGConnection.class);
  PreparedStatement statement=mock(PreparedStatement.class);
  PgEventEndpoint endpoint=mock(PgEventEndpoint.class);
  Processor processor=mock(Processor.class);
  when(endpoint.getDatasource()).thenReturn(dataSource);
  when(dataSource.getConnection()).thenReturn(connection);
  when(connection.prepareStatement("LISTEN camel")).thenReturn(statement);
  when(endpoint.getChannel()).thenReturn("camel");
  when(connection.prepareStatement("UNLISTEN camel")).thenReturn(statement);
  PgEventConsumer consumer=new PgEventConsumer(endpoint,processor);
  consumer.start();
  consumer.stop();
  verify(connection).removeNotificationListener("camel");
  verify(connection).close();
  assertTrue(consumer.isStopped());
}
