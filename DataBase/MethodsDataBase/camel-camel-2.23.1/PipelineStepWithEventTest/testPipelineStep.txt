@Test public void testPipelineStep() throws Exception {
  getMockEndpoint("mock:a").expectedMessageCount(1);
  getMockEndpoint("mock:a2").expectedMessageCount(1);
  getMockEndpoint("mock:b").expectedMessageCount(1);
  getMockEndpoint("mock:b2").expectedMessageCount(1);
  getMockEndpoint("mock:result").expectedMessageCount(1);
  template.sendBody("direct:start","Hello World");
  assertMockEndpointsSatisfied();
  assertEquals(4,listener.getEvents().size());
  BeforeStepEvent event=(BeforeStepEvent)listener.getEvents().get(0);
  assertEquals("step-a",event.getId());
  AfterStepEvent event2=(AfterStepEvent)listener.getEvents().get(1);
  assertEquals("step-a",event2.getId());
  assertTrue("Should take a little time",event2.getTimeTaken() > 0);
  BeforeStepEvent event3=(BeforeStepEvent)listener.getEvents().get(2);
  assertEquals("step-b",event3.getId());
  AfterStepEvent event4=(AfterStepEvent)listener.getEvents().get(3);
  assertEquals("step-b",event4.getId());
  assertTrue("Should take a little time",event4.getTimeTaken() > 0);
}
