@Test public void testVelocityContext() throws Exception {
  Exchange exchange=template.request("direct:a",new Processor(){
    @Override public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("");
      exchange.getIn().setHeader("name","Christian");
      Map<String,Object> variableMap=new HashMap<>();
      Map<String,Object> headersMap=new HashMap<>();
      headersMap.put("name","Willem");
      variableMap.put("headers",headersMap);
      variableMap.put("body","Monday");
      variableMap.put("exchange",exchange);
      exchange.getIn().setHeader(StringTemplateConstants.STRINGTEMPLATE_VARIABLE_MAP,variableMap);
      exchange.setProperty("item","7");
    }
  }
);
  assertEquals("Dear Willem. You ordered item 7 on Monday.",exchange.getOut().getBody());
  assertEquals("Christian",exchange.getOut().getHeader("name"));
}
