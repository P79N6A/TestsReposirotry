@Test public void testServiceDiscovery() throws Exception {
  ConsulConfiguration configuration=new ConsulConfiguration();
  configuration.setUrl(consulUrl());
  ServiceDiscovery discovery=new ConsulServiceDiscovery(configuration);
  List<ServiceDefinition> services=discovery.getServices("my-service");
  assertNotNull(services);
  assertEquals(6,services.size());
  for (  ServiceDefinition service : services) {
    Assertions.assertThat(service.getMetadata()).isNotEmpty();
    Assertions.assertThat(service.getMetadata()).containsEntry(ServiceDefinition.SERVICE_META_NAME,"my-service");
    Assertions.assertThat(service.getMetadata()).containsKey(ServiceDefinition.SERVICE_META_ID);
    Assertions.assertThat(service.getMetadata()).containsKey("a-tag");
    Assertions.assertThat(service.getMetadata()).containsEntry("key1","value1");
    Assertions.assertThat(service.getMetadata()).containsEntry("key2","value2");
    Assertions.assertThat(service.getMetadata()).containsEntry("meta-key","meta-val");
    Assertions.assertThat("" + service.getHealth().isHealthy()).isEqualTo(service.getMetadata().get("healthy"));
  }
}
