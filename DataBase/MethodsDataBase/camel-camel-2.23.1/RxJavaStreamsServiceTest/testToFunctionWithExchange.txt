@Test public void testToFunctionWithExchange() throws Exception {
  context.start();
  AtomicInteger value=new AtomicInteger(0);
  CountDownLatch latch=new CountDownLatch(1);
  Function<Object,Publisher<Exchange>> fun=crs.to("bean:hello");
  Flowable.just(1,2,3).flatMap(fun::apply).map(e -> e.getOut()).map(e -> e.getBody(String.class)).doOnNext(res -> Assert.assertEquals("Hello " + value.incrementAndGet(),res)).doOnNext(res -> latch.countDown()).subscribe();
  Assert.assertTrue(latch.await(2,TimeUnit.SECONDS));
}
