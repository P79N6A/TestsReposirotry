@Test public void testGenerateInvalidPayloadExceptionMessageWithEmbeddedEndOfBlock() throws Exception {
  byte[] basePayload=TEST_MESSAGE.getBytes();
  ByteArrayOutputStream payloadStream=new ByteArrayOutputStream(basePayload.length + 1);
  int embeddedEndOfBlockIndex=basePayload.length / 2;
  payloadStream.write(basePayload,0,embeddedEndOfBlockIndex);
  payloadStream.write(MllpProtocolConstants.END_OF_BLOCK);
  payloadStream.write(basePayload,embeddedEndOfBlockIndex,basePayload.length - embeddedEndOfBlockIndex);
  String expected="HL7 payload contains an embedded END_OF_BLOCK {0x1c, ASCII <FS>} at index " + embeddedEndOfBlockIndex;
  assertEquals(expected,Hl7Util.generateInvalidPayloadExceptionMessage(payloadStream.toByteArray()));
}
