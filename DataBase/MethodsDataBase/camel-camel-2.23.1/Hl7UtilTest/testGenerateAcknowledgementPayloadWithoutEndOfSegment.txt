/** 
 * If the MSH isn't terminated correctly, we'll get Junk for the acknowledgement.
 * @throws Exception in the event of a test error.
 */
@Test public void testGenerateAcknowledgementPayloadWithoutEndOfSegment() throws Exception {
  String junkMessage="MSH|^~\\&|ADT|EPIC|JCAPS|CC|20161206193919|RISTECH|ADT^A08|00001|D|2.3^^|||||||" + "EVN|A08|20150107161440||REG_UPDATE_SEND_VISIT_MESSAGES_ON_PATIENT_CHANGES|RISTECH^RADIOLOGY^TECHNOLOGIST^^^^^^UCLA^^^^^RRMC||";
  MllpSocketBuffer mllpSocketBuffer=new MllpSocketBuffer(new MllpEndpointStub());
  Hl7Util.generateAcknowledgementPayload(mllpSocketBuffer,junkMessage.getBytes(),"AA");
  String actual=mllpSocketBuffer.toString();
  assertThat(actual,startsWith(EXPECTED_ACKNOWLEDGEMENT_PAYLOAD_START));
  assertThat(actual,endsWith("|EVN|A08|20150107161440||REG_UPDATE_SEND_VISIT_MESSAGES_ON_PATIENT_CHANGES|RISTECH^RADIOLOGY^TECHNOLOGIST^^^^^^UCLA^^^^^RRMC|\r" + "MSA|AA|00001\r" + MllpProtocolConstants.END_OF_BLOCK + MllpProtocolConstants.END_OF_DATA));
}
