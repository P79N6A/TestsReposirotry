@Test(timeout=5000) public void testComponentDeadlock() throws Exception {
  SimpleRegistry registry=new SimpleRegistry();
  registry.put("sql-connector",new DirectComponent(){
    @Override protected void doStart() throws Exception {
      Component delegate=new DirectComponent();
      getCamelContext().removeComponent("sql-connector-component");
      getCamelContext().addService(delegate,true,true);
      getCamelContext().addComponent("sql-connector-component",delegate);
      super.doStart();
    }
  }
);
  CamelContext context=new DefaultCamelContext(registry);
  context.start();
  context.getComponent("sql-connector",true,true);
  context.stop();
}
