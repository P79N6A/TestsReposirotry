@Test public void testRollsBackOnException() throws InterruptedException {
  mockOut.whenAnyExchangeReceived(exchange -> {
    int id=exchange.getIn().getHeader("id",Integer.class);
    if (id == 0) {
      throw new IllegalArgumentException("Boom!");
    }
  }
);
  for (int i=0; i < 10; i++) {
    try {
      template.sendBodyAndHeader("direct:in","Test message","id",i % 5);
    }
 catch (    CamelExecutionException cex) {
    }
  }
  assertEquals(4,kafkaIdempotentRepository.getDuplicateCount());
  assertEquals(6,mockOut.getReceivedCounter());
  assertEquals(10,mockBefore.getReceivedCounter());
}
