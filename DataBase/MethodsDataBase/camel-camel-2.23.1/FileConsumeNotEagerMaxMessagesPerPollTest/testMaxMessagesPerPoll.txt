@Test public void testMaxMessagesPerPoll() throws Exception {
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedBodiesReceived("AAA","BBB");
  template.sendBodyAndHeader(fileUrl,"CCC",Exchange.FILE_NAME,"ccc.txt");
  template.sendBodyAndHeader(fileUrl,"AAA",Exchange.FILE_NAME,"aaa.txt");
  template.sendBodyAndHeader(fileUrl,"BBB",Exchange.FILE_NAME,"bbb.txt");
  context.startRoute("foo");
  mock.expectedPropertyReceived(Exchange.BATCH_SIZE,2);
  assertMockEndpointsSatisfied();
  mock.reset();
  mock.expectedBodiesReceived("CCC");
  mock.expectedPropertyReceived(Exchange.BATCH_SIZE,1);
  assertMockEndpointsSatisfied();
}
