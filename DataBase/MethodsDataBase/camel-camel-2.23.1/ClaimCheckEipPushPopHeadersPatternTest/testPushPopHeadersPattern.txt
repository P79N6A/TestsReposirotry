@Test public void testPushPopHeadersPattern() throws Exception {
  Map<String,Object> headers=new HashMap<>();
  headers.put("foo",123);
  headers.put("bar","Moes");
  headers.put("car","Toyota");
  getMockEndpoint("mock:a").expectedBodiesReceived("Hello World");
  getMockEndpoint("mock:a").expectedHeaderReceived("foo",123);
  getMockEndpoint("mock:a").expectedHeaderReceived("bar","Moes");
  getMockEndpoint("mock:a").message(0).header("car").isEqualTo("Toyota");
  getMockEndpoint("mock:b").expectedBodiesReceived("Bye World");
  getMockEndpoint("mock:b").expectedHeaderReceived("foo",456);
  getMockEndpoint("mock:b").message(0).header("bar").isNull();
  getMockEndpoint("mock:b").message(0).header("car").isEqualTo("Toyota");
  getMockEndpoint("mock:c").expectedBodiesReceived("Bye World");
  getMockEndpoint("mock:c").expectedHeaderReceived("foo",123);
  getMockEndpoint("mock:c").expectedHeaderReceived("bar","Moes");
  getMockEndpoint("mock:c").message(0).header("car").isEqualTo("Toyota");
  template.sendBodyAndHeaders("direct:start","Hello World",headers);
  assertMockEndpointsSatisfied();
}
