@Test public void testObjectNameModification() throws JMException {
  MBeanServer mbeanServer=mock(MBeanServer.class);
  ObjectInstance instance=mock(ObjectInstance.class);
  ManagementAgent agent=new DefaultManagementAgent();
  agent.setMBeanServer(mbeanServer);
  Object object="object";
  ObjectName sourceObjectName=new ObjectName("domain","key","value");
  ObjectName registeredObjectName=new ObjectName("domain","key","otherValue");
  when(mbeanServer.isRegistered(sourceObjectName)).thenReturn(false);
  when(mbeanServer.registerMBean(object,sourceObjectName)).thenReturn(instance);
  when(instance.getObjectName()).thenReturn(registeredObjectName);
  when(mbeanServer.isRegistered(registeredObjectName)).thenReturn(true);
  agent.register(object,sourceObjectName);
  assertTrue(agent.isRegistered(sourceObjectName));
  reset(mbeanServer,instance);
  when(mbeanServer.isRegistered(registeredObjectName)).thenReturn(true);
  mbeanServer.unregisterMBean(registeredObjectName);
  when(mbeanServer.isRegistered(sourceObjectName)).thenReturn(false);
  agent.unregister(sourceObjectName);
  assertFalse(agent.isRegistered(sourceObjectName));
}
