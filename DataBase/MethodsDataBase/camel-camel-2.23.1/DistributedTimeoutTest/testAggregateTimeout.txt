@Test public void testAggregateTimeout() throws Exception {
  MockEndpoint mock=getMockEndpoint("mock:aggregated");
  MockEndpoint mock2=getMockEndpoint2("mock:aggregated");
  mock.expectedMessageCount(0);
  mock2.expectedMessageCount(0);
  template.sendBodyAndHeader("direct:start","A","id",123);
  template2.sendBodyAndHeader("direct:start","B","id",123);
  await().atMost(2,TimeUnit.SECONDS).until(() -> invoked.get() == 1);
  mock.assertIsSatisfied();
  mock2.assertIsSatisfied();
  assertNotNull(receivedExchange);
  assertEquals("AB",receivedExchange.getIn().getBody());
  assertEquals(-1,receivedIndex);
  assertEquals(-1,receivedTotal);
  assertEquals(200,receivedTimeout);
  mock.reset();
  mock.expectedMessageCount(0);
  mock2.reset();
  mock2.expectedBodiesReceived("ABC");
  template.sendBodyAndHeader("direct:start","A","id",123);
  template2.sendBodyAndHeader("direct:start","B","id",123);
  template2.sendBodyAndHeader("direct:start","C","id",123);
  mock2.assertIsSatisfied(500);
  mock.assertIsSatisfied(500);
  assertEquals(1,invoked.get());
}
