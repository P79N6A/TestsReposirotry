@Test public void testCacheManagerFromFile() throws Exception {
  CamelContext context=null;
  try {
    context=new DefaultCamelContext();
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:ehcache").to("ehcache:myCache1?configurationUri=classpath:ehcache/ehcache-file-config.xml").to("ehcache:myCache2?configurationUri=classpath:ehcache/ehcache-file-config.xml");
      }
    }
);
    context.start();
    EhcacheEndpoint e1=context.getEndpoint("ehcache:myCache1?configurationUri=classpath:ehcache/ehcache-file-config.xml",EhcacheEndpoint.class);
    EhcacheEndpoint e2=context.getEndpoint("ehcache:myCache2?configurationUri=classpath:ehcache/ehcache-file-config.xml",EhcacheEndpoint.class);
    Assert.assertEquals(e1.getManager(),e2.getManager());
    Assert.assertEquals(e1.getManager().getCacheManager(),e2.getManager().getCacheManager());
    Assert.assertEquals(2,e1.getManager().getReferenceCount().get());
    Assert.assertEquals(Status.AVAILABLE,e1.getManager().getCacheManager().getStatus());
    context.stop();
    Assert.assertEquals(e1.getManager(),e2.getManager());
    Assert.assertEquals(e1.getManager().getCacheManager(),e2.getManager().getCacheManager());
    Assert.assertEquals(0,e1.getManager().getReferenceCount().get());
    Assert.assertEquals(Status.UNINITIALIZED,e1.getManager().getCacheManager().getStatus());
  }
  finally {
    if (context != null) {
      context.stop();
    }
  }
}
