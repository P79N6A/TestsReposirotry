@Test public void testSendReceiveTraps() throws Exception {
  PDU trap=new PDU();
  trap.setType(PDU.TRAP);
  OID oid=new OID("1.2.3.4.5");
  trap.add(new VariableBinding(SnmpConstants.snmpTrapOID,oid));
  trap.add(new VariableBinding(SnmpConstants.sysUpTime,new TimeTicks(5000)));
  trap.add(new VariableBinding(SnmpConstants.sysDescr,new OctetString("System Description")));
  Variable var=new OctetString("some string");
  trap.add(new VariableBinding(oid,var));
  LOG.info("Sending pdu " + trap);
  Endpoint endpoint=context.getEndpoint("direct:snmptrap");
  Exchange exchange=endpoint.createExchange();
  exchange.getIn().setBody(trap);
  Producer producer=endpoint.createProducer();
  producer.process(exchange);
synchronized (this) {
    Thread.sleep(1000);
  }
  MockEndpoint mock=getMockEndpoint("mock:result");
  mock.expectedMessageCount(1);
  mock.assertIsSatisfied();
  List<Exchange> exchanges=mock.getExchanges();
  SnmpMessage msg=(SnmpMessage)exchanges.get(0).getIn();
  PDU receivedTrap=msg.getSnmpMessage();
  Assert.assertEquals(trap,receivedTrap);
  if (LOG.isInfoEnabled()) {
    LOG.info("Received SNMP TRAP:");
    Vector<? extends VariableBinding> variableBindings=receivedTrap.getVariableBindings();
    for (    VariableBinding vb : variableBindings) {
      LOG.info("  " + vb.toString());
    }
  }
}
