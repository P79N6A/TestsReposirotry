@Test() public void testConnectionClosedBeforeReadingAcknowledgement() throws Exception {
  target.expectedMessageCount(0);
  complete.expectedMessageCount(1);
  connectEx.expectedMessageCount(0);
  writeEx.expectedMessageCount(0);
  acknowledgementEx.expectedMessageCount(1);
  mllpServer.setCloseSocketBeforeAcknowledgementModulus(1);
  NotifyBuilder done=new NotifyBuilder(context).whenCompleted(1).create();
  source.sendBody(Hl7TestMessageGenerator.generateMessage());
  assertTrue("Should have completed an exchange",done.matches(5,TimeUnit.SECONDS));
  assertMockEndpointsSatisfied(5,TimeUnit.SECONDS);
}
