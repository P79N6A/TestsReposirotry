/** 
 * The component should reconnect, so the route shouldn't see any errors.
 * @throws Exception
 */
@Test public void testConnectionClosedBeforeSendingHL7Message() throws Exception {
  target.expectedMessageCount(2);
  complete.expectedMessageCount(2);
  connectEx.expectedMessageCount(0);
  writeEx.expectedMessageCount(0);
  acknowledgementEx.expectedMessageCount(0);
  NotifyBuilder oneDone=new NotifyBuilder(context).whenCompleted(1).create();
  NotifyBuilder twoDone=new NotifyBuilder(context).whenCompleted(2).create();
  source.sendBody(Hl7TestMessageGenerator.generateMessage());
  assertTrue("Should have completed an exchange",oneDone.matches(5,TimeUnit.SECONDS));
  mllpServer.closeClientConnections();
  source.sendBody(Hl7TestMessageGenerator.generateMessage());
  assertTrue("Should have completed two exchanges",twoDone.matches(5,TimeUnit.SECONDS));
  assertMockEndpointsSatisfied(5,TimeUnit.SECONDS);
}
