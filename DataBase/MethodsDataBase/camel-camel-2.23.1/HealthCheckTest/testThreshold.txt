@Test public void testThreshold() throws Exception {
  MyHealthCheck check=new MyHealthCheck();
  check.setState(HealthCheck.State.DOWN);
  check.getConfiguration().setEnabled(true);
  check.getConfiguration().setFailureThreshold(3);
  HealthCheck.Result result;
  for (int i=0; i < check.getConfiguration().getFailureThreshold(); i++) {
    result=check.call();
    Assert.assertEquals(HealthCheck.State.UP,result.getState());
    Assert.assertEquals(i + 1,result.getDetails().get(AbstractHealthCheck.INVOCATION_COUNT));
    Assert.assertEquals(i + 1,result.getDetails().get(AbstractHealthCheck.FAILURE_COUNT));
  }
  Assert.assertEquals(HealthCheck.State.DOWN,check.call().getState());
}
