@Test public void processShouldCreateTheSmppSessionWithTheSystemIdAndPasswordFromTheExchange() throws Exception {
  when(endpoint.getConnectionString()).thenReturn("smpp://localhost:2775");
  BindParameter expectedBindParameter=new BindParameter(BindType.BIND_TX,"smppclient2","password2","cp",TypeOfNumber.UNKNOWN,NumberingPlanIndicator.UNKNOWN,"");
  when(session.connectAndBind("localhost",new Integer(2775),expectedBindParameter)).thenReturn("1");
  SmppBinding binding=mock(SmppBinding.class);
  Exchange exchange=mock(Exchange.class);
  Message in=mock(Message.class);
  SmppCommand command=mock(SmppCommand.class);
  when(endpoint.getBinding()).thenReturn(binding);
  when(endpoint.isSingleton()).thenReturn(true);
  when(binding.createSmppCommand(session,exchange)).thenReturn(command);
  when(exchange.getIn()).thenReturn(in);
  when(in.getHeader("CamelSmppSystemId",String.class)).thenReturn("smppclient2");
  when(in.getHeader("CamelSmppPassword",String.class)).thenReturn("password2");
  command.execute(exchange);
  producer.doStart();
  producer.process(exchange);
  verify(session).connectAndBind("localhost",new Integer(2775),expectedBindParameter);
}
