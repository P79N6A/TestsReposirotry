@Test public void testOnDemandDiscovery() throws Exception {
  for (int i=0; i < 3; i++) {
    addServer(client,"serviceType-1");
  }
  for (int i=0; i < 2; i++) {
    addServer(client,"serviceType-2");
  }
  EtcdOnDemandServiceDiscovery strategy=new EtcdOnDemandServiceDiscovery(CONFIGURATION);
  strategy.start();
  List<ServiceDefinition> type1=strategy.getServices("serviceType-1");
  assertEquals(3,type1.size());
  for (  ServiceDefinition service : type1) {
    assertNotNull(service.getMetadata());
    assertTrue(service.getMetadata().containsKey("service_name"));
    assertTrue(service.getMetadata().containsKey("port_delta"));
  }
  List<ServiceDefinition> type2=strategy.getServices("serviceType-2");
  assertEquals(2,type2.size());
  for (  ServiceDefinition service : type2) {
    assertNotNull(service.getMetadata());
    assertTrue(service.getMetadata().containsKey("service_name"));
    assertTrue(service.getMetadata().containsKey("port_delta"));
  }
  strategy.stop();
}
