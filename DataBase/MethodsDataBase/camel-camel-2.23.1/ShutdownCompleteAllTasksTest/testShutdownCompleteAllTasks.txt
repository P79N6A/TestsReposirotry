@Test public void testShutdownCompleteAllTasks() throws Exception {
  context.getShutdownStrategy().setTimeout(30);
  context.startRoute("foo");
  MockEndpoint bar=getMockEndpoint("mock:bar");
  bar.expectedMinimumMessageCount(1);
  assertMockEndpointsSatisfied();
  int batch=bar.getReceivedExchanges().get(0).getProperty(Exchange.BATCH_SIZE,int.class);
  latch.await(10,TimeUnit.SECONDS);
  context.stop();
  assertEquals("Should complete all messages",batch,counter.get());
}
