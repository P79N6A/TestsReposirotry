@Test public void shouldSetIdByReferencesForNestedObjects(){
  final SObjectTree tree=new SObjectTree();
  final Account account=new Account();
  final SObjectNode accountNode=new SObjectNode(tree,account);
  tree.addNode(accountNode);
  final Contact contact=new Contact();
  final SObjectNode contactNode=new SObjectNode(tree,contact);
  accountNode.addChild("Contacts",contactNode);
  final Asset asset=new Asset();
  final SObjectNode assetNode=new SObjectNode(tree,asset);
  contactNode.addChild("Assets",assetNode);
  assertEquals("ref1",accountNode.getAttributes().getReferenceId());
  assertEquals("ref2",contactNode.getAttributes().getReferenceId());
  assertEquals("ref3",assetNode.getAttributes().getReferenceId());
  tree.setIdFor("ref1","id1");
  tree.setIdFor("ref3","id3");
  tree.setIdFor("ref2","id2");
  assertEquals("id1",account.getId());
  assertEquals("id2",contact.getId());
  assertEquals("id3",asset.getId());
}
