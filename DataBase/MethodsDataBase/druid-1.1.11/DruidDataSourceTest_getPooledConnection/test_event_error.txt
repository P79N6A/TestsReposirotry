public void test_event_error() throws Exception {
  DruidPooledConnection conn=(DruidPooledConnection)dataSource.getPooledConnection();
  final AtomicInteger errorCount=new AtomicInteger();
  conn.addConnectionEventListener(new ConnectionEventListener(){
    @Override public void connectionErrorOccurred(    ConnectionEvent event){
      errorCount.incrementAndGet();
    }
    @Override public void connectionClosed(    ConnectionEvent event){
    }
  }
);
  PreparedStatement stmt=conn.prepareStatement("select ?");
  try {
    stmt.executeQuery();
  }
 catch (  SQLException e) {
  }
  Assert.assertEquals(1,errorCount.get());
  conn.close();
}
