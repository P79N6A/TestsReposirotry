/** 
 * Test Beeline !connect with beeline saved vars
 * @throws Throwable
 */
@Test public void testBeelineConnectEnvVar() throws Throwable {
  final String jdbcUrl=miniHS2.getBaseJdbcURL();
  List<String> argList=new ArrayList<>();
  argList.add("-u");
  argList.add("blue");
  argList.add("-d");
  argList.add(BeeLine.BEELINE_DEFAULT_JDBC_DRIVER);
  final String SCRIPT_TEXT="create table blueconnecttest (d int);\nshow tables;\ndrop table blueconnecttest;\n";
  final String EXPECTED_PATTERN="blueconnecttest";
  final BeeLineOpts.Env baseEnv=BeeLineOpts.getEnv();
  BeeLineOpts.Env newEnv=new BeeLineOpts.Env(){
    @Override public String get(    String envVar){
      if (envVar.equalsIgnoreCase("BEELINE_URL_BLUE")) {
        return jdbcUrl;
      }
 else {
        return baseEnv.get(envVar);
      }
    }
  }
;
  BeeLineOpts.setEnv(newEnv);
  testScriptFile(SCRIPT_TEXT,argList,OutStream.OUT,Collections.singletonList(new Tuple<>(EXPECTED_PATTERN,true)),Collections.singletonList(Modes.SCRIPT));
}
