@Test public void testOpenSessionTimeMetrics() throws Exception {
  String json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.GAUGE,MetricsConstant.HS2_AVG_OPEN_SESSION_TIME,"NaN");
  long firstSessionOpen=System.currentTimeMillis();
  SessionHandle handle=sm.openSession(TProtocolVersion.HIVE_CLI_SERVICE_PROTOCOL_V9,"user","passw","127.0.0.1",new HashMap<String,String>());
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.GAUGE,MetricsConstant.HS2_AVG_OPEN_SESSION_TIME,(double)(System.currentTimeMillis() - firstSessionOpen),100d);
  long secondSessionOpen=System.currentTimeMillis();
  sm.openSession(TProtocolVersion.HIVE_CLI_SERVICE_PROTOCOL_V9,"user","passw","127.0.0.1",new HashMap<String,String>());
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.GAUGE,MetricsConstant.HS2_AVG_OPEN_SESSION_TIME,(double)(System.currentTimeMillis() - firstSessionOpen + System.currentTimeMillis() - secondSessionOpen) / 2d,100d);
  sm.closeSession(handle);
  json=metrics.dumpJson();
  MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.GAUGE,MetricsConstant.HS2_AVG_OPEN_SESSION_TIME,(double)(System.currentTimeMillis() - secondSessionOpen),100d);
}
