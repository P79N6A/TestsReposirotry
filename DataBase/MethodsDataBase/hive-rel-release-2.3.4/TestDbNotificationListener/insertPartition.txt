@Test public void insertPartition() throws Exception {
  String defaultDbName="default";
  String tblName="insertptn";
  String tblOwner="me";
  String serdeLocation="file:/tmp";
  String fileAdded="/warehouse/mytable/b1";
  String checksumAdded="1234";
  FieldSchema col1=new FieldSchema("col1","int","no comment");
  List<FieldSchema> cols=new ArrayList<FieldSchema>();
  cols.add(col1);
  SerDeInfo serde=new SerDeInfo("serde","seriallib",null);
  StorageDescriptor sd=new StorageDescriptor(cols,serdeLocation,"input","output",false,0,serde,null,null,emptyParameters);
  FieldSchema partCol1=new FieldSchema("ds","string","no comment");
  List<FieldSchema> partCols=new ArrayList<FieldSchema>();
  List<String> partCol1Vals=Arrays.asList("today");
  LinkedHashMap<String,String> partKeyVals=new LinkedHashMap<String,String>();
  partKeyVals.put("ds","today");
  partCols.add(partCol1);
  Table table=new Table(tblName,defaultDbName,tblOwner,startTime,startTime,0,sd,partCols,emptyParameters,null,null,null);
  msClient.createTable(table);
  Partition partition=new Partition(partCol1Vals,defaultDbName,tblName,startTime,startTime,sd,emptyParameters);
  msClient.add_partition(partition);
  FireEventRequestData data=new FireEventRequestData();
  InsertEventRequestData insertData=new InsertEventRequestData();
  data.setInsertData(insertData);
  insertData.addToFilesAdded(fileAdded);
  insertData.addToFilesAddedChecksum(checksumAdded);
  FireEventRequest rqst=new FireEventRequest(true,data);
  rqst.setDbName(defaultDbName);
  rqst.setTableName(tblName);
  rqst.setPartitionVals(partCol1Vals);
  msClient.fireListenerEvent(rqst);
  NotificationEventResponse rsp=msClient.getNextNotification(firstEventId,0,null);
  assertEquals(3,rsp.getEventsSize());
  NotificationEvent event=rsp.getEvents().get(2);
  assertEquals(firstEventId + 3,event.getEventId());
  assertTrue(event.getEventTime() >= startTime);
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  assertEquals(defaultDbName,event.getDbName());
  assertEquals(tblName,event.getTableName());
  verifyInsert(event,defaultDbName,tblName);
  InsertMessage insertMessage=md.getInsertMessage(event.getMessage());
  Map<String,String> partKeyValsFromNotif=insertMessage.getPartitionKeyValues();
  assertMapEquals(partKeyVals,partKeyValsFromNotif);
  MockMetaStoreEventListener.popAndVerifyLastEventId(EventType.INSERT,firstEventId + 3);
  MockMetaStoreEventListener.popAndVerifyLastEventId(EventType.ADD_PARTITION,firstEventId + 2);
  MockMetaStoreEventListener.popAndVerifyLastEventId(EventType.CREATE_TABLE,firstEventId + 1);
}
