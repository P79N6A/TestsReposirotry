@Test public void sqlInsertPartition() throws Exception {
  String tblName="sqlinsptn";
  driver.run("create table " + tblName + " (c int) partitioned by (ds string)");
  driver.run("insert into table " + tblName + " partition (ds = 'today') values (1)");
  driver.run("insert into table " + tblName + " partition (ds = 'today') values (2)");
  driver.run("insert into table " + tblName + " partition (ds) values (3, 'today')");
  driver.run("alter table " + tblName + " add partition (ds = 'yesterday')");
  driver.run("insert into table " + tblName + " partition (ds = 'yesterday') values (2)");
  driver.run("insert into table " + tblName + " partition (ds) values (3, 'yesterday')");
  driver.run("insert into table " + tblName + " partition (ds) values (3, 'tomorrow')");
  driver.run("alter table " + tblName + " drop partition (ds = 'tomorrow')");
  driver.run("insert into table " + tblName + " partition (ds) values (42, 'todaytwo')");
  driver.run("insert overwrite table " + tblName + " partition(ds='todaytwo') select c from "+ tblName+ " where 'ds'='today'");
  NotificationEventResponse rsp=msClient.getNextNotification(firstEventId,0,null);
  assertEquals(24,rsp.getEventsSize());
  NotificationEvent event=rsp.getEvents().get(1);
  assertEquals(firstEventId + 2,event.getEventId());
  assertEquals(EventType.ADD_PARTITION.toString(),event.getEventType());
  event=rsp.getEvents().get(3);
  assertEquals(firstEventId + 4,event.getEventId());
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  verifyInsert(event,null,tblName);
  event=rsp.getEvents().get(6);
  assertEquals(firstEventId + 7,event.getEventId());
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  verifyInsert(event,null,tblName);
  event=rsp.getEvents().get(9);
  assertEquals(firstEventId + 10,event.getEventId());
  assertEquals(EventType.ADD_PARTITION.toString(),event.getEventType());
  event=rsp.getEvents().get(10);
  assertEquals(firstEventId + 11,event.getEventId());
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  verifyInsert(event,null,tblName);
  event=rsp.getEvents().get(13);
  assertEquals(firstEventId + 14,event.getEventId());
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  verifyInsert(event,null,tblName);
  event=rsp.getEvents().get(16);
  assertEquals(firstEventId + 17,event.getEventId());
  assertEquals(EventType.ADD_PARTITION.toString(),event.getEventType());
  event=rsp.getEvents().get(18);
  assertEquals(firstEventId + 19,event.getEventId());
  assertEquals(EventType.DROP_PARTITION.toString(),event.getEventType());
  event=rsp.getEvents().get(19);
  assertEquals(firstEventId + 20,event.getEventId());
  assertEquals(EventType.ADD_PARTITION.toString(),event.getEventType());
  event=rsp.getEvents().get(20);
  assertEquals(firstEventId + 21,event.getEventId());
  assertEquals(EventType.ALTER_PARTITION.toString(),event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
  event=rsp.getEvents().get(21);
  assertEquals(firstEventId + 22,event.getEventId());
  assertEquals(EventType.INSERT.toString(),event.getEventType());
  assertTrue(event.getMessage().matches(".*\"files\":\\[\\].*"));
  event=rsp.getEvents().get(22);
  assertEquals(firstEventId + 23,event.getEventId());
  assertEquals(EventType.ALTER_PARTITION.toString(),event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
  event=rsp.getEvents().get(23);
  assertEquals(firstEventId + 24,event.getEventId());
  assertEquals(EventType.ALTER_PARTITION.toString(),event.getEventType());
  assertTrue(event.getMessage().matches(".*\"ds\":\"todaytwo\".*"));
}
