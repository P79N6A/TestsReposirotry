@Test public void testDeleteSegment() throws IOException, SegmentLoadingException {
  DruidStorageHandler druidStorageHandler=new DruidStorageHandler(derbyConnectorRule.getConnector(),new SQLMetadataStorageUpdaterJobHandler(derbyConnectorRule.getConnector()),derbyConnectorRule.metadataTablesConfigSupplier().get(),null);
  String segmentRootPath=temporaryFolder.newFolder().getAbsolutePath();
  Configuration config=new Configuration();
  druidStorageHandler.setConf(config);
  LocalFileSystem localFileSystem=FileSystem.getLocal(config);
  Path segmentOutputPath=JobHelper.makeSegmentOutputPath(new Path(segmentRootPath),localFileSystem,dataSegment);
  Path indexPath=new Path(segmentOutputPath,"index.zip");
  DataSegment dataSegmentWithLoadspect=DataSegment.builder(dataSegment).loadSpec(ImmutableMap.<String,Object>of("path",indexPath)).build();
  OutputStream outputStream=localFileSystem.create(indexPath,true);
  outputStream.close();
  Assert.assertTrue("index file is not created ??",localFileSystem.exists(indexPath));
  Assert.assertTrue(localFileSystem.exists(segmentOutputPath));
  druidStorageHandler.deleteSegment(dataSegmentWithLoadspect);
  Assert.assertFalse("Index file still there ??",localFileSystem.exists(indexPath));
  Assert.assertFalse("PartitionNum directory still there ??",localFileSystem.exists(segmentOutputPath));
  Assert.assertFalse("Version directory still there ??",localFileSystem.exists(segmentOutputPath.getParent()));
  Assert.assertFalse("Interval directory still there ??",localFileSystem.exists(segmentOutputPath.getParent().getParent()));
  Assert.assertFalse("Data source directory still there ??",localFileSystem.exists(segmentOutputPath.getParent().getParent().getParent()));
}
