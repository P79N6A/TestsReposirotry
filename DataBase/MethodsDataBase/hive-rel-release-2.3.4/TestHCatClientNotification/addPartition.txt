@Test public void addPartition() throws Exception {
  String dbName="default";
  String tableName="hcataddparttable";
  String partColName="pc";
  HCatTable table=new HCatTable(dbName,tableName);
  table.partCol(new HCatFieldSchema(partColName,TypeInfoFactory.stringTypeInfo,""));
  table.cols(Arrays.asList(new HCatFieldSchema("onecol",TypeInfoFactory.stringTypeInfo,"")));
  hCatClient.createTable(HCatCreateTableDesc.create(table).build());
  String partName="testpart";
  Map<String,String> partSpec=new HashMap<String,String>(1);
  partSpec.put(partColName,partName);
  HCatPartition part=new HCatPartition(table,partSpec,null);
  hCatClient.addPartition(HCatAddPartitionDesc.create(part).build());
  List<HCatNotificationEvent> events=hCatClient.getNextNotification(firstEventId,0,null);
  assertEquals(2,events.size());
  HCatNotificationEvent event=events.get(1);
  assertEquals(firstEventId + 2,event.getEventId());
  assertTrue(event.getEventTime() >= startTime);
  assertEquals(HCatConstants.HCAT_ADD_PARTITION_EVENT,event.getEventType());
  assertEquals("default",event.getDbName());
  assertEquals(tableName,event.getTableName());
  AddPartitionMessage addPartitionMessage=md.getAddPartitionMessage(event.getMessage());
  assertEquals(dbName,addPartitionMessage.getDB());
  assertEquals(tableName,addPartitionMessage.getTable());
  List<Map<String,String>> ptndescs=addPartitionMessage.getPartitions();
  HCatPartition addedPart=hCatClient.getPartition(dbName,tableName,ptndescs.get(0));
  assertEquals(part.getDatabaseName(),addedPart.getDatabaseName());
  assertEquals(part.getTableName(),addedPart.getTableName());
  assertEquals(part.getValues(),addedPart.getValues());
  assertEquals(part.getColumns(),addedPart.getColumns());
  assertEquals(part.getPartColumns(),addedPart.getPartColumns());
  assertEquals(part.getLocation(),addedPart.getLocation());
}
