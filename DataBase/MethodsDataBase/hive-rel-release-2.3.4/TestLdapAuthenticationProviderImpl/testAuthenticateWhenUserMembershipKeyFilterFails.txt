@Test public void testAuthenticateWhenUserMembershipKeyFilterFails() throws NamingException, AuthenticationException, IOException {
  thrown.expect(AuthenticationException.class);
  conf.setVar(HiveConf.ConfVars.HIVE_SERVER2_PLAIN_LDAP_GROUPFILTER,"HIVE-USERS");
  conf.setVar(HiveConf.ConfVars.HIVE_SERVER2_PLAIN_LDAP_BASEDN,"dc=mycorp,dc=com");
  conf.setVar(HiveConf.ConfVars.HIVE_SERVER2_PLAIN_LDAP_USERMEMBERSHIP_KEY,"memberOf");
  when(search.findUserDn("user1")).thenReturn("cn=user1,ou=PowerUsers,dc=mycorp,dc=com");
  String groupDn="cn=HIVE-USERS,ou=Groups,dc=mycorp,dc=com";
  when(search.findGroupDn("HIVE-USERS")).thenReturn(groupDn);
  when(search.isUserMemberOfGroup("user1",groupDn)).thenReturn(false);
  auth=new LdapAuthenticationProviderImpl(conf,factory);
  auth.Authenticate("user1","Blah");
}
