/** 
 * Writing UTs that need multiple threads is challenging since Derby chokes on concurrent access. This tests that "AND WAIT" actually blocks and responds to interrupt
 * @throws Exception
 */
@Test public void testCompactionBlocking() throws Exception {
  Timer cancelCompact=new Timer("CancelCompactionTimer",false);
  final Thread threadToInterrupt=Thread.currentThread();
  cancelCompact.schedule(new TimerTask(){
    @Override public void run(){
      threadToInterrupt.interrupt();
    }
  }
,5000);
  long start=System.currentTimeMillis();
  runStatementOnDriver("alter table " + TestTxnCommands2.Table.ACIDTBL + " compact 'major' AND WAIT");
  Assert.assertTrue(System.currentTimeMillis() > start + 2);
}
