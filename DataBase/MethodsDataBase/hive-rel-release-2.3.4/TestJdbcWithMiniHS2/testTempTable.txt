@Test public void testTempTable() throws Exception {
  String tempTableName="tmp1";
  Statement stmt=conTestDb.createStatement();
  stmt.execute("CREATE TEMPORARY TABLE " + tempTableName + " (key string, value string)");
  stmt.execute("load data local inpath '" + kvDataFilePath.toString() + "' into table "+ tempTableName);
  String resultVal="val_238";
  String queryStr="SELECT * FROM " + tempTableName + " where value = '"+ resultVal+ "'";
  ResultSet res=stmt.executeQuery(queryStr);
  assertTrue(res.next());
  assertEquals(resultVal,res.getString(2));
  res.close();
  stmt.close();
  DatabaseMetaData md=conTestDb.getMetaData();
  assertTrue(md.getConnection() == conTestDb);
  ResultSet rs=md.getTables(null,null,tempTableName,null);
  boolean foundTable=false;
  while (rs.next()) {
    String tableName=rs.getString(3);
    if (tableName.equalsIgnoreCase(tempTableName)) {
      assertFalse("Table not found yet",foundTable);
      foundTable=true;
    }
  }
  assertTrue("Found temp table",foundTable);
  rs=md.getTables(null,null,null,null);
  foundTable=false;
  while (rs.next()) {
    String tableName=rs.getString(3);
    if (tableName.equalsIgnoreCase(tempTableName)) {
      assertFalse("Table not found yet",foundTable);
      foundTable=true;
    }
  }
  assertTrue("Found temp table",foundTable);
  rs=md.getColumns(null,null,tempTableName,null);
  assertTrue("First row",rs.next());
  assertTrue(rs.getString(3).equalsIgnoreCase(tempTableName));
  assertTrue(rs.getString(4).equalsIgnoreCase("key"));
  assertEquals(Types.VARCHAR,rs.getInt(5));
  assertTrue("Second row",rs.next());
  assertTrue(rs.getString(3).equalsIgnoreCase(tempTableName));
  assertTrue(rs.getString(4).equalsIgnoreCase("value"));
  assertEquals(Types.VARCHAR,rs.getInt(5));
  Connection conn2=DriverManager.getConnection(miniHS2.getJdbcURL(testDbName),System.getProperty("user.name"),"bar");
  Statement stmt2=conn2.createStatement();
  stmt2.execute("USE " + testDbName);
  boolean gotException=false;
  try {
    res=stmt2.executeQuery(queryStr);
  }
 catch (  SQLException err) {
    assertTrue("Expecting table not found error, instead got: " + err,err.getMessage().contains("Table not found"));
    gotException=true;
  }
  assertTrue("Exception while querying non-existing temp table",gotException);
  conn2.close();
}
