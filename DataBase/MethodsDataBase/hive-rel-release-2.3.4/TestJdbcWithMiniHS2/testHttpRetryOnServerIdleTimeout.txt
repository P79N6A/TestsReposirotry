/** 
 * Test for jdbc driver retry on NoHttpResponseException
 * @throws Exception
 */
@Test public void testHttpRetryOnServerIdleTimeout() throws Exception {
  stopMiniHS2();
  HiveConf conf=new HiveConf();
  conf.set("hive.server2.transport.mode","http");
  conf.set("hive.server2.thrift.http.max.idle.time","5");
  startMiniHS2(conf);
  String userName=System.getProperty("user.name");
  Connection conn=getConnection(miniHS2.getJdbcURL(testDbName),userName,"password");
  Statement stmt=conn.createStatement();
  stmt.execute("select from_unixtime(unix_timestamp())");
  TimeUnit.SECONDS.sleep(10);
  try {
    stmt.execute("select from_unixtime(unix_timestamp())");
  }
 catch (  Exception e) {
    fail("Not expecting exception: " + e);
  }
 finally {
    if (conn != null) {
      conn.close();
    }
  }
  restoreMiniHS2AndConnections();
}
