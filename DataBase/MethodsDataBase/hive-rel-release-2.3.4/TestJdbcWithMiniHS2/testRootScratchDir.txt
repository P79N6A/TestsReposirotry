/** 
 * Tests the creation of the root hdfs scratch dir, which should be writable by all.
 * @throws Exception
 */
@Test public void testRootScratchDir() throws Exception {
  stopMiniHS2();
  HiveConf conf=new HiveConf();
  String userName;
  Path scratchDirPath;
  conf.set("hive.exec.scratchdir",tmpDir + "/hs2");
  startMiniHS2(conf);
  userName=System.getProperty("user.name");
  Connection conn=getConnection(miniHS2.getJdbcURL(testDbName),userName,"password");
  FileSystem fs=miniHS2.getLocalFS();
  FsPermission expectedFSPermission=new FsPermission((short)00733);
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  conn.close();
  stopMiniHS2();
  conf.set("hive.exec.scratchdir",tmpDir + "/level1/level2/level3");
  startMiniHS2(conf);
  conn=getConnection(miniHS2.getJdbcURL(testDbName),userName,"password");
  scratchDirPath=new Path(HiveConf.getVar(conf,HiveConf.ConfVars.SCRATCHDIR));
  verifyScratchDir(conf,fs,scratchDirPath,expectedFSPermission,userName,false);
  conn.close();
  restoreMiniHS2AndConnections();
}
