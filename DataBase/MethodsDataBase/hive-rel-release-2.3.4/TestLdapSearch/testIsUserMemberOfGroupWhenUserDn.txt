@Test public void testIsUserMemberOfGroupWhenUserDn() throws NamingException {
  conf.setVar(HiveConf.ConfVars.HIVE_SERVER2_PLAIN_LDAP_USERDNPATTERN,"CN=%s,OU=org1,DC=foo,DC=bar");
  NamingEnumeration<SearchResult> validResult=LdapTestUtils.mockNamingEnumeration("CN=User1");
  NamingEnumeration<SearchResult> emptyResult=LdapTestUtils.mockEmptyNamingEnumeration();
  when(ctx.search(anyString(),contains("(uid=User1)"),any(SearchControls.class))).thenReturn(validResult);
  when(ctx.search(anyString(),contains("(uid=User2)"),any(SearchControls.class))).thenReturn(emptyResult);
  search=new LdapSearch(conf,ctx);
  assertTrue(search.isUserMemberOfGroup("CN=User1,OU=org1,DC=foo,DC=bar","grp1"));
  assertFalse(search.isUserMemberOfGroup("CN=User2,OU=org1,DC=foo,DC=bar","grp2"));
}
