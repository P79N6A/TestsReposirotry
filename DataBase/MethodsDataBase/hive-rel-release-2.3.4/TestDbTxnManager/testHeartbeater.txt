@Test public void testHeartbeater() throws Exception {
  Assert.assertTrue(txnMgr instanceof DbTxnManager);
  addTableInput();
  LockException exception=null;
  QueryPlan qp=new MockQueryPlan(this);
  txnMgr.openTxn(ctx,"fred");
  txnMgr.acquireLocks(qp,ctx,"fred");
  runReaper();
  try {
    txnMgr.commitTxn();
  }
 catch (  LockException e) {
    exception=e;
  }
  Assert.assertNull("Txn commit should be successful",exception);
  exception=null;
  ((DbTxnManager)txnMgr).openTxn(ctx,"tom",HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS) / 2);
  txnMgr.acquireLocks(qp,ctx,"tom");
  runReaper();
  try {
    txnMgr.commitTxn();
  }
 catch (  LockException e) {
    exception=e;
  }
  Assert.assertNull("Txn commit should also be successful",exception);
  exception=null;
  ((DbTxnManager)txnMgr).openTxn(ctx,"jerry",HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS) * 2);
  txnMgr.acquireLocks(qp,ctx,"jerry");
  Thread.sleep(HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS));
  runReaper();
  try {
    txnMgr.commitTxn();
  }
 catch (  LockException e) {
    exception=e;
  }
  Assert.assertNotNull("Txn should have been aborted",exception);
  Assert.assertEquals(ErrorMsg.TXN_ABORTED,exception.getCanonicalErrorMsg());
}
