@Test public void testExceptions() throws Exception {
  addPartitionOutput(newTable(true),WriteEntity.WriteType.INSERT);
  QueryPlan qp=new MockQueryPlan(this);
  ((DbTxnManager)txnMgr).openTxn(ctx,"NicholasII",HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS) * 2);
  Thread.sleep(HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS));
  runReaper();
  LockException exception=null;
  try {
    txnMgr.commitTxn();
  }
 catch (  LockException ex) {
    exception=ex;
  }
  Assert.assertNotNull("Expected exception1",exception);
  Assert.assertEquals("Wrong Exception1",ErrorMsg.TXN_ABORTED,exception.getCanonicalErrorMsg());
  exception=null;
  ((DbTxnManager)txnMgr).openTxn(ctx,"AlexanderIII",HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS) * 2);
  Thread.sleep(HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS));
  runReaper();
  TxnStore txnHandler=TxnUtils.getTxnStore(conf);
  GetOpenTxnsInfoResponse txnsInfo=txnHandler.getOpenTxnsInfo();
  assertEquals(2,txnsInfo.getTxn_high_water_mark());
  assertEquals(2,txnsInfo.getOpen_txns().size());
  Assert.assertEquals(TxnState.ABORTED,txnsInfo.getOpen_txns().get(1).getState());
  txnMgr.rollbackTxn();
}
