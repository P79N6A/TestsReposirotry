@Test public void testLockTimeout() throws Exception {
  addPartitionInput(newTable(true));
  QueryPlan qp=new MockQueryPlan(this);
  testLockExpiration(txnMgr,0,true);
  for (int i=0; i < 5; i++) {
    ((DbTxnManager)txnMgr).acquireLocks(qp,ctx,"PeterI" + i,true);
  }
  testLockExpiration(txnMgr,5,true);
  for (int i=0; i < TEST_TIMED_OUT_TXN_ABORT_BATCH_SIZE + 17; i++) {
    ((DbTxnManager)txnMgr).acquireLocks(qp,ctx,"PeterI" + i,true);
  }
  testLockExpiration(txnMgr,TEST_TIMED_OUT_TXN_ABORT_BATCH_SIZE + 17,true);
  ((DbTxnManager)txnMgr).acquireLocksWithHeartbeatDelay(qp,ctx,"bob",HiveConf.getTimeVar(conf,HiveConf.ConfVars.HIVE_TXN_TIMEOUT,TimeUnit.MILLISECONDS) * 10);
  testLockExpiration(txnMgr,1,true);
  txnMgr.acquireLocks(qp,ctx,"peter");
  testLockExpiration(txnMgr,1,false);
}
