@Test public void testCopyWithDistcp() throws IOException {
  Path copySrc=new Path("copySrc");
  Path copyDst=new Path("copyDst");
  HiveConf conf=new HiveConf(TestFileUtils.class);
  conf.set(HiveConf.ConfVars.HIVE_WAREHOUSE_SUBDIR_INHERIT_PERMS.varname,"false");
  FileSystem mockFs=mock(FileSystem.class);
  when(mockFs.getUri()).thenReturn(URI.create("hdfs:///"));
  ContentSummary mockContentSummary=mock(ContentSummary.class);
  when(mockContentSummary.getFileCount()).thenReturn(Long.MAX_VALUE);
  when(mockContentSummary.getLength()).thenReturn(Long.MAX_VALUE);
  when(mockFs.getContentSummary(any(Path.class))).thenReturn(mockContentSummary);
  HadoopShims shims=mock(HadoopShims.class);
  when(shims.runDistCp(copySrc,copyDst,conf)).thenReturn(true);
  Assert.assertTrue(FileUtils.copy(mockFs,copySrc,mockFs,copyDst,false,false,conf,shims));
  verify(shims).runDistCp(copySrc,copyDst,conf);
}
