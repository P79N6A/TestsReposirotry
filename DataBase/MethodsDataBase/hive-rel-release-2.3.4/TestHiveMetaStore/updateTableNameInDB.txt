/** 
 * This method simulates another Hive metastore renaming a table, by accessing the db and updating the name. Unfortunately, derby cannot be run in two different JVMs simultaneously, but the only way to rename without having it put in this client's cache is to run a metastore in a separate JVM, so this simulation is required.
 * @param oldTableName
 * @param newTableName
 * @throws SQLException
 */
private void updateTableNameInDB(String oldTableName,String newTableName) throws SQLException {
  String connectionStr=HiveConf.getVar(hiveConf,HiveConf.ConfVars.METASTORECONNECTURLKEY);
  int interval=1;
  int attempts=1;
  Utilities.SQLCommand<Void> execUpdate=new Utilities.SQLCommand<Void>(){
    @Override public Void run(    PreparedStatement stmt) throws SQLException {
      stmt.executeUpdate();
      return null;
    }
  }
;
  Connection conn=Utilities.connectWithRetry(connectionStr,interval,attempts);
  PreparedStatement updateStmt=Utilities.prepareWithRetry(conn,"UPDATE TBLS SET tbl_name = '" + newTableName + "' WHERE tbl_name = '"+ oldTableName+ "'",interval,attempts);
  Utilities.executeWithRetry(execUpdate,updateStmt,interval,attempts);
}
