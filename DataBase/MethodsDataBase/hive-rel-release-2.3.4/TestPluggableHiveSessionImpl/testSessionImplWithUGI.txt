@Test public void testSessionImplWithUGI() throws Exception {
  HiveConf hiveConf=new HiveConf();
  hiveConf.setVar(HiveConf.ConfVars.HIVE_AUTHORIZATION_MANAGER,HiveConf.ConfVars.HIVE_AUTHORIZATION_MANAGER.getDefaultValue());
  hiveConf.setVar(HiveConf.ConfVars.HIVE_SESSION_IMPL_WITH_UGI_CLASSNAME,SampleHiveSessionImplWithUGI.class.getName());
  hiveConf.setBoolVar(HiveConf.ConfVars.HIVE_SERVER2_ENABLE_DOAS,true);
  CLIService cliService=new CLIService(null);
  cliService.init(hiveConf);
  ThriftBinaryCLIService service=new ThriftBinaryCLIService(cliService,null);
  service.init(hiveConf);
  ThriftCLIServiceClient client=new ThriftCLIServiceClient(service);
  SessionHandle sessionHandle=null;
  sessionHandle=client.openSession("tom","password");
  assertEquals(SampleHiveSessionImplWithUGI.class.getName(),service.getHiveConf().getVar(HiveConf.ConfVars.HIVE_SESSION_IMPL_WITH_UGI_CLASSNAME));
  HiveSession session=cliService.getSessionManager().getSession(sessionHandle);
  assertEquals(SampleHiveSessionImplWithUGI.MAGIC_RETURN_VALUE,session.getNoOperationTime());
  client.closeSession(sessionHandle);
}
