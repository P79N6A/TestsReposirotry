@Test public void testShareToMessengerWith20150314Protocol() throws Exception {
  setupPackageManagerForMessenger(true);
  setupContentResolverForProtocolVersions(20150314);
  Uri uri=Uri.parse("file:///foo.jpeg");
  Uri externalUri=Uri.parse("http://example.com/foo.jpeg");
  ShareToMessengerParams params=ShareToMessengerParams.newBuilder(uri,"image/jpeg").setMetaData("{}").setExternalUri(externalUri).build();
  MessengerUtils.shareToMessenger(mMockActivity,1,params);
  ArgumentCaptor<Intent> intentArgumentCaptor=ArgumentCaptor.forClass(Intent.class);
  verify(mMockActivity).startActivityForResult(intentArgumentCaptor.capture(),eq(1));
  Intent intent=intentArgumentCaptor.getValue();
  assertEquals(Intent.ACTION_SEND,intent.getAction());
  assertEquals(Intent.FLAG_GRANT_READ_URI_PERMISSION,intent.getFlags());
  assertEquals("com.facebook.orca",intent.getPackage());
  assertEquals(uri,intent.getParcelableExtra(Intent.EXTRA_STREAM));
  assertEquals("image/jpeg",intent.getType());
  assertEquals("200",intent.getStringExtra("com.facebook.orca.extra.APPLICATION_ID"));
  assertEquals(20150314,intent.getIntExtra("com.facebook.orca.extra.PROTOCOL_VERSION",-1));
  assertEquals("{}",intent.getStringExtra("com.facebook.orca.extra.METADATA"));
  assertEquals(externalUri,intent.getParcelableExtra("com.facebook.orca.extra.EXTERNAL_URI"));
}
