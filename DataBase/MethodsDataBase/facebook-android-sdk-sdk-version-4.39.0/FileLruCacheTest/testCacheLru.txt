@Test public void testCacheLru() throws IOException, InterruptedException {
  int keepCount=10;
  int otherCount=5;
  int dataSize=64;
  byte[] data=generateBytes(dataSize);
  FileLruCache cache=new FileLruCache("testCacheLru",limitCacheCount(keepCount + 1));
  try {
    TestUtils.clearFileLruCache(cache);
    for (int i=0; i < keepCount; i++) {
      put(cache,i,data);
    }
    Thread.sleep(1000);
    for (int i=0; i < otherCount; i++) {
      put(cache,keepCount + i,data);
      Thread.sleep(1000);
      for (int keepIndex=0; keepIndex < keepCount; keepIndex++) {
        checkValue(cache,keepIndex,data);
      }
      Thread.sleep(200);
    }
    for (int i=0; i < (otherCount - 1); i++) {
      String key=Integer.valueOf(keepCount + i).toString();
      assertEquals(false,hasValue(cache,key));
    }
  }
  finally {
    TestUtils.clearAndDeleteLruCacheDirectory(cache);
  }
}
