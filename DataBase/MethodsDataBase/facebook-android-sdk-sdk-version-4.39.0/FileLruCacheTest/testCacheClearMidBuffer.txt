@Test public void testCacheClearMidBuffer() throws Exception {
  int dataSize=1024;
  byte[] data=generateBytes(dataSize);
  String key="a";
  String key2="b";
  FileLruCache cache=new FileLruCache("testCacheClear",limitCacheSize(2 * dataSize));
  try {
    TestUtils.clearFileLruCache(cache);
    put(cache,key,data);
    checkValue(cache,key,data);
    OutputStream stream=cache.openPutStream(key2);
    Thread.sleep(200);
    TestUtils.clearFileLruCache(cache);
    stream.write(data);
    stream.close();
    assertEquals(false,hasValue(cache,key));
    assertEquals(false,hasValue(cache,key2));
    assertEquals(0,cache.sizeInBytesForTest());
  }
  finally {
    TestUtils.clearAndDeleteLruCacheDirectory(cache);
  }
}
