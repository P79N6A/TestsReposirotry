@Test public void testLoadSavesTokenWhenUpgradingFromLegacyToken() throws JSONException {
  when(FacebookSdk.isLegacyTokenUpgradeSupported()).thenReturn(true);
  AccessToken accessToken=createAccessToken();
  when(cachingStrategy.load()).thenReturn(AccessTokenTestHelper.toLegacyCacheBundle(accessToken));
  AccessTokenCache cache=new AccessTokenCache(sharedPreferences,cachingStrategyFactory);
  cache.load();
  assertTrue(sharedPreferences.contains(AccessTokenCache.CACHED_ACCESS_TOKEN_KEY));
  AccessToken savedAccessToken=AccessToken.createFromJSONObject(new JSONObject(sharedPreferences.getString(AccessTokenCache.CACHED_ACCESS_TOKEN_KEY,null)));
  assertEquals(accessToken,savedAccessToken);
}
