@Test public void testCacheRoundtrip(){
  Set<String> permissions=Utility.hashSet("stream_publish","go_outside_and_play");
  String token="AnImaginaryTokenValue";
  Date later=TestUtils.nowPlusSeconds(60);
  Date earlier=TestUtils.nowPlusSeconds(-60);
  String applicationId="1234";
  LegacyTokenHelper cache=new LegacyTokenHelper(RuntimeEnvironment.application);
  cache.clear();
  Bundle bundle=new Bundle();
  LegacyTokenHelper.putToken(bundle,token);
  LegacyTokenHelper.putExpirationDate(bundle,later);
  LegacyTokenHelper.putSource(bundle,AccessTokenSource.FACEBOOK_APPLICATION_NATIVE);
  LegacyTokenHelper.putLastRefreshDate(bundle,earlier);
  LegacyTokenHelper.putPermissions(bundle,permissions);
  LegacyTokenHelper.putDeclinedPermissions(bundle,Utility.arrayList("whatever"));
  LegacyTokenHelper.putApplicationId(bundle,applicationId);
  cache.save(bundle);
  bundle=cache.load();
  AccessToken accessToken=AccessToken.createFromLegacyCache(bundle);
  TestUtils.assertSamePermissions(permissions,accessToken);
  assertEquals(token,accessToken.getToken());
  assertEquals(AccessTokenSource.FACEBOOK_APPLICATION_NATIVE,accessToken.getSource());
  assertTrue(!accessToken.isExpired());
  Bundle cachedBundle=AccessTokenTestHelper.toLegacyCacheBundle(accessToken);
  TestUtils.assertEqualContentsWithoutOrder(bundle,cachedBundle);
}
