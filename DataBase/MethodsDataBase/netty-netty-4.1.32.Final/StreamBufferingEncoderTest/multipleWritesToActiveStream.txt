@Test public void multipleWritesToActiveStream(){
  encoder.writeSettingsAck(ctx,newPromise());
  encoderWriteHeaders(3,newPromise());
  assertEquals(0,encoder.numBufferedStreams());
  ByteBuf data=data();
  final int expectedBytes=data.readableBytes() * 3;
  encoder.writeData(ctx,3,data,0,false,newPromise());
  encoder.writeData(ctx,3,data(),0,false,newPromise());
  encoder.writeData(ctx,3,data(),0,false,newPromise());
  encoderWriteHeaders(3,newPromise());
  writeVerifyWriteHeaders(times(2),3);
  ArgumentCaptor<ByteBuf> bufCaptor=ArgumentCaptor.forClass(ByteBuf.class);
  verify(writer,times(1)).writeData(eq(ctx),eq(3),bufCaptor.capture(),eq(0),eq(false),any(ChannelPromise.class));
  assertEquals(expectedBytes,bufCaptor.getValue().readableBytes());
}
