@Test public void bufferUntilMaxStreamsIncreased(){
  encoder.writeSettingsAck(ctx,newPromise());
  setMaxConcurrentStreams(2);
  encoderWriteHeaders(3,newPromise());
  encoderWriteHeaders(5,newPromise());
  encoderWriteHeaders(7,newPromise());
  encoderWriteHeaders(9,newPromise());
  assertEquals(2,encoder.numBufferedStreams());
  writeVerifyWriteHeaders(times(1),3);
  writeVerifyWriteHeaders(times(1),5);
  writeVerifyWriteHeaders(never(),7);
  writeVerifyWriteHeaders(never(),9);
  setMaxConcurrentStreams(5);
  encoder.writeSettingsAck(ctx,newPromise());
  assertEquals(0,encoder.numBufferedStreams());
  writeVerifyWriteHeaders(times(1),7);
  writeVerifyWriteHeaders(times(1),9);
  encoderWriteHeaders(11,newPromise());
  writeVerifyWriteHeaders(times(1),11);
  assertEquals(5,connection.local().numActiveStreams());
}
