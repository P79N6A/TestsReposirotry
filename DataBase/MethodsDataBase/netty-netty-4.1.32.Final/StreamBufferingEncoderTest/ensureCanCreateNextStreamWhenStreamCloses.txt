@Test public void ensureCanCreateNextStreamWhenStreamCloses(){
  encoder.writeSettingsAck(ctx,newPromise());
  setMaxConcurrentStreams(1);
  encoderWriteHeaders(3,newPromise());
  assertEquals(0,encoder.numBufferedStreams());
  encoderWriteHeaders(5,newPromise());
  assertEquals(1,connection.numActiveStreams());
  assertEquals(1,encoder.numBufferedStreams());
  setMaxConcurrentStreams(0);
  connection.stream(3).close();
  writeVerifyWriteHeaders(times(1),3);
  writeVerifyWriteHeaders(never(),5);
  assertEquals(0,connection.numActiveStreams());
  assertEquals(1,encoder.numBufferedStreams());
}
