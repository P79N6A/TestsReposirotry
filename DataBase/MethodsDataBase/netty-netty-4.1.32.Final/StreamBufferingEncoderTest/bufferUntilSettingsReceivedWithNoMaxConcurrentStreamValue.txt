@Test public void bufferUntilSettingsReceivedWithNoMaxConcurrentStreamValue() throws Http2Exception {
  int initialLimit=SMALLEST_MAX_CONCURRENT_STREAMS;
  int numStreams=initialLimit * 2;
  for (int ix=0, nextStreamId=3; ix < numStreams; ++ix, nextStreamId+=2) {
    encoderWriteHeaders(nextStreamId,newPromise());
    if (ix < initialLimit) {
      writeVerifyWriteHeaders(times(1),nextStreamId);
    }
 else {
      writeVerifyWriteHeaders(never(),nextStreamId);
    }
  }
  assertEquals(numStreams / 2,encoder.numBufferedStreams());
  encoder.remoteSettings(new Http2Settings());
  assertEquals(0,encoder.numBufferedStreams());
  assertEquals(numStreams,connection.local().numActiveStreams());
}
