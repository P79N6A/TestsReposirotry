@Test public void testChunkedHeadResponse(){
  EmbeddedChannel ch=new EmbeddedChannel(new HttpServerCodec());
  assertTrue(ch.writeInbound(Unpooled.copiedBuffer("HEAD / HTTP/1.1\r\n\r\n",CharsetUtil.UTF_8)));
  HttpRequest request=ch.readInbound();
  assertEquals(HttpMethod.HEAD,request.method());
  LastHttpContent content=ch.readInbound();
  assertFalse(content.content().isReadable());
  content.release();
  HttpResponse response=new DefaultHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK);
  HttpUtil.setTransferEncodingChunked(response,true);
  assertTrue(ch.writeOutbound(response));
  assertTrue(ch.writeOutbound(LastHttpContent.EMPTY_LAST_CONTENT));
  assertTrue(ch.finish());
  ByteBuf buf=ch.readOutbound();
  assertEquals("HTTP/1.1 200 OK\r\ntransfer-encoding: chunked\r\n\r\n",buf.toString(CharsetUtil.US_ASCII));
  buf.release();
  buf=ch.readOutbound();
  assertFalse(buf.isReadable());
  buf.release();
  assertFalse(ch.finishAndReleaseAll());
}
