@Test public void testGZIP2() throws Exception {
  byte[] bytes="message".getBytes(CharsetUtil.UTF_8);
  ByteBuf data=Unpooled.wrappedBuffer(bytes);
  ByteBuf deflatedData=Unpooled.wrappedBuffer(gzip(bytes));
  EmbeddedChannel chDecoderGZip=new EmbeddedChannel(createDecoder(ZlibWrapper.GZIP));
  try {
    chDecoderGZip.writeInbound(deflatedData);
    assertTrue(chDecoderGZip.finish());
    ByteBuf buf=chDecoderGZip.readInbound();
    assertEquals(buf,data);
    assertNull(chDecoderGZip.readInbound());
    data.release();
    buf.release();
  }
  finally {
    dispose(chDecoderGZip);
  }
}
