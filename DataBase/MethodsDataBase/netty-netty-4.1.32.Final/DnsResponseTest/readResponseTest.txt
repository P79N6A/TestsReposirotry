@Test public void readResponseTest() throws Exception {
  EmbeddedChannel embedder=new EmbeddedChannel(new DatagramDnsResponseDecoder());
  for (  byte[] p : packets) {
    ByteBuf packet=embedder.alloc().buffer(512).writeBytes(p);
    embedder.writeInbound(new DatagramPacket(packet,null,new InetSocketAddress(0)));
    AddressedEnvelope<DnsResponse,InetSocketAddress> envelope=embedder.readInbound();
    assertThat(envelope,is(instanceOf(DatagramDnsResponse.class)));
    DnsResponse response=envelope.content();
    assertThat(response,is(sameInstance((Object)envelope)));
    ByteBuf raw=Unpooled.wrappedBuffer(p);
    assertThat(response.id(),is(raw.getUnsignedShort(0)));
    assertThat(response.count(DnsSection.QUESTION),is(raw.getUnsignedShort(4)));
    assertThat(response.count(DnsSection.ANSWER),is(raw.getUnsignedShort(6)));
    assertThat(response.count(DnsSection.AUTHORITY),is(raw.getUnsignedShort(8)));
    assertThat(response.count(DnsSection.ADDITIONAL),is(raw.getUnsignedShort(10)));
    envelope.release();
  }
}
