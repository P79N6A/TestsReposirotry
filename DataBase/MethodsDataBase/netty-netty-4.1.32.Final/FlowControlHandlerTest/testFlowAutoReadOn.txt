/** 
 * The  {@link FlowControlHandler} will simply pass-through all messagesif auto reading is on and remains on.
 */
@Test public void testFlowAutoReadOn() throws Exception {
  final CountDownLatch latch=new CountDownLatch(3);
  ChannelInboundHandlerAdapter handler=new ChannelDuplexHandler(){
    @Override public void channelRead(    ChannelHandlerContext ctx,    Object msg){
      latch.countDown();
    }
  }
;
  FlowControlHandler flow=new FlowControlHandler();
  Channel server=newServer(true,flow,handler);
  Channel client=newClient(server.localAddress());
  try {
    client.writeAndFlush(newOneMessage()).syncUninterruptibly();
    assertTrue(latch.await(1L,SECONDS));
    assertTrue(flow.isQueueEmpty());
  }
  finally {
    client.close();
    server.close();
  }
}
