/** 
 * This test demonstrates the default behavior if auto reading is turned on from the get-go and you're trying to turn it off once you've received your first message. NOTE: This test waits for the client to disconnect which is interpreted as the signal that all  {@code byte}s have been transferred to the server.
 */
@Test public void testAutoReadingOn() throws Exception {
  final CountDownLatch latch=new CountDownLatch(3);
  ChannelInboundHandlerAdapter handler=new ChannelInboundHandlerAdapter(){
    @Override public void channelRead(    ChannelHandlerContext ctx,    Object msg){
      ReferenceCountUtil.release(msg);
      ctx.channel().config().setAutoRead(false);
      latch.countDown();
    }
  }
;
  Channel server=newServer(true,handler);
  Channel client=newClient(server.localAddress());
  try {
    client.writeAndFlush(newOneMessage()).syncUninterruptibly();
    assertTrue(latch.await(1L,SECONDS));
  }
  finally {
    client.close();
    server.close();
  }
}
