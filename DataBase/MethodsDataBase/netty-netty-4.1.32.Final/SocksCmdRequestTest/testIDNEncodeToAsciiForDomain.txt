@Test public void testIDNEncodeToAsciiForDomain(){
  String host="тест.рф";
  CharBuffer asciiHost=CharBuffer.wrap(IDN.toASCII(host));
  short port=10000;
  SocksCmdRequest rq=new SocksCmdRequest(SocksCmdType.BIND,SocksAddressType.DOMAIN,host,port);
  assertEquals(host,rq.host());
  ByteBuf buffer=Unpooled.buffer(24);
  rq.encodeAsByteBuf(buffer);
  buffer.resetReaderIndex();
  assertEquals(SocksProtocolVersion.SOCKS5.byteValue(),buffer.readByte());
  assertEquals(SocksCmdType.BIND.byteValue(),buffer.readByte());
  assertEquals((byte)0x00,buffer.readByte());
  assertEquals(SocksAddressType.DOMAIN.byteValue(),buffer.readByte());
  assertEquals((byte)asciiHost.length(),buffer.readUnsignedByte());
  assertEquals(asciiHost,CharBuffer.wrap(buffer.readCharSequence(asciiHost.length(),CharsetUtil.US_ASCII)));
  assertEquals(port,buffer.readUnsignedShort());
  buffer.release();
}
