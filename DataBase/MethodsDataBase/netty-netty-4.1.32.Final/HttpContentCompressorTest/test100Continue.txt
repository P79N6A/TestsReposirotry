@Test public void test100Continue() throws Exception {
  FullHttpRequest request=newRequest();
  HttpUtil.set100ContinueExpected(request,true);
  EmbeddedChannel ch=new EmbeddedChannel(new HttpContentCompressor());
  ch.writeInbound(request);
  FullHttpResponse continueResponse=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.CONTINUE,Unpooled.EMPTY_BUFFER);
  ch.writeOutbound(continueResponse);
  FullHttpResponse res=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK,Unpooled.EMPTY_BUFFER);
  res.trailingHeaders().set(of("X-Test"),of("Netty"));
  ch.writeOutbound(res);
  Object o=ch.readOutbound();
  assertThat(o,is(instanceOf(FullHttpResponse.class)));
  res=(FullHttpResponse)o;
  assertSame(continueResponse,res);
  res.release();
  o=ch.readOutbound();
  assertThat(o,is(instanceOf(FullHttpResponse.class)));
  res=(FullHttpResponse)o;
  assertThat(res.headers().get(HttpHeaderNames.TRANSFER_ENCODING),is(nullValue()));
  assertThat(res.headers().get(HttpHeaderNames.CONTENT_ENCODING),is(nullValue()));
  assertThat(res.content().readableBytes(),is(0));
  assertThat(res.content().toString(CharsetUtil.US_ASCII),is(""));
  assertEquals("Netty",res.trailingHeaders().get(of("X-Test")));
  assertThat(ch.readOutbound(),is(nullValue()));
}
