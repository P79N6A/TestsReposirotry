@Test public void noMoreStreamIdsShouldSendGoAway() throws Exception {
  bootstrapEnv(1,1,3,1,1);
  setClientGracefulShutdownTime(0);
  final Http2Headers headers=dummyHeaders();
  runInChannel(clientChannel,new Http2Runnable(){
    @Override public void run() throws Http2Exception {
      http2Client.encoder().writeHeaders(ctx(),3,headers,0,(short)16,false,0,true,newPromise());
      http2Client.flush(ctx());
    }
  }
);
  assertTrue(serverSettingsAckLatch.await(DEFAULT_AWAIT_TIMEOUT_SECONDS,SECONDS));
  runInChannel(clientChannel,new Http2Runnable(){
    @Override public void run() throws Http2Exception {
      http2Client.encoder().writeHeaders(ctx(),MAX_VALUE + 1,headers,0,(short)16,false,0,true,newPromise());
      http2Client.flush(ctx());
    }
  }
);
  assertTrue(goAwayLatch.await(DEFAULT_AWAIT_TIMEOUT_SECONDS,SECONDS));
  verify(serverListener).onGoAwayRead(any(ChannelHandlerContext.class),eq(0),eq(PROTOCOL_ERROR.code()),any(ByteBuf.class));
}
