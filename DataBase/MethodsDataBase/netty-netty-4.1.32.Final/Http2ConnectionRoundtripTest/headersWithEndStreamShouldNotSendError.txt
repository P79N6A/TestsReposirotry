@Test public void headersWithEndStreamShouldNotSendError() throws Exception {
  bootstrapEnv(1,1,2,1);
  final short weight=16;
  final Http2Headers headers=dummyHeaders();
  runInChannel(clientChannel,new Http2Runnable(){
    @Override public void run() throws Http2Exception {
      http2Client.encoder().writeHeaders(ctx(),3,headers,0,weight,false,0,true,newPromise());
      http2Client.flush(ctx());
    }
  }
);
  assertTrue(requestLatch.await(DEFAULT_AWAIT_TIMEOUT_SECONDS,SECONDS));
  verify(serverListener).onHeadersRead(any(ChannelHandlerContext.class),eq(3),eq(headers),eq(0),eq(weight),eq(false),eq(0),eq(true));
  Thread.sleep(1000);
  verify(serverListener,never()).onGoAwayRead(any(ChannelHandlerContext.class),anyInt(),anyLong(),any(ByteBuf.class));
  verify(serverListener,never()).onRstStreamRead(any(ChannelHandlerContext.class),anyInt(),anyLong());
  setClientGracefulShutdownTime(0);
}
