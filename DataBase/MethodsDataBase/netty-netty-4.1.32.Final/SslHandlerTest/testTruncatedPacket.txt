@Test public void testTruncatedPacket() throws Exception {
  SSLEngine engine=newServerModeSSLEngine();
  EmbeddedChannel ch=new EmbeddedChannel(new SslHandler(engine));
  ch.writeInbound(wrappedBuffer(new byte[]{22,3,1,0,5}));
  assertThat(ch.readInbound(),is(nullValue()));
  try {
    ch.writeInbound(wrappedBuffer(new byte[]{2,0,0,1,0}));
    fail();
  }
 catch (  DecoderException e) {
    ch.finishAndReleaseAll();
    assertThat(e.getCause(),is(instanceOf(SSLProtocolException.class)));
  }
}
