@Test(timeout=5000) public void testEventsFired() throws Exception {
  SSLEngine engine=newServerModeSSLEngine();
  final BlockingQueue<SslCompletionEvent> events=new LinkedBlockingQueue<SslCompletionEvent>();
  EmbeddedChannel channel=new EmbeddedChannel(new SslHandler(engine),new ChannelInboundHandlerAdapter(){
    @Override public void userEventTriggered(    ChannelHandlerContext ctx,    Object evt) throws Exception {
      if (evt instanceof SslCompletionEvent) {
        events.add((SslCompletionEvent)evt);
      }
    }
  }
);
  assertTrue(events.isEmpty());
  assertTrue(channel.finishAndReleaseAll());
  SslCompletionEvent evt=events.take();
  assertTrue(evt instanceof SslHandshakeCompletionEvent);
  assertTrue(evt.cause() instanceof ClosedChannelException);
  evt=events.take();
  assertTrue(evt instanceof SslCloseCompletionEvent);
  assertTrue(evt.cause() instanceof ClosedChannelException);
  assertTrue(events.isEmpty());
}
