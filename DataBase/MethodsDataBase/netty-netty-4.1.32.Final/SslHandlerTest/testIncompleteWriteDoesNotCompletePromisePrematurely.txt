@Test public void testIncompleteWriteDoesNotCompletePromisePrematurely() throws NoSuchAlgorithmException {
  SSLEngine engine=newServerModeSSLEngine();
  EmbeddedChannel ch=new EmbeddedChannel(new SslHandler(engine));
  ChannelPromise promise=ch.newPromise();
  ByteBuf buf=Unpooled.buffer(10).writeZero(10);
  ch.writeAndFlush(buf,promise);
  assertFalse(promise.isDone());
  assertTrue(ch.finishAndReleaseAll());
  assertTrue(promise.isDone());
  assertThat(promise.cause(),is(instanceOf(SSLException.class)));
}
