@Test public void shouldDecodeNestedArray() throws Exception {
  ByteBuf buf=Unpooled.buffer();
  buf.writeBytes(byteBufOf("*2\r\n"));
  buf.writeBytes(byteBufOf("*3\r\n:1\r\n:2\r\n:3\r\n"));
  buf.writeBytes(byteBufOf("*2\r\n+Foo\r\n-Bar\r\n"));
  assertTrue(channel.writeInbound(buf));
  ArrayRedisMessage msg=channel.readInbound();
  List<RedisMessage> children=msg.children();
  assertThat(msg.children().size(),is(2));
  ArrayRedisMessage intArray=(ArrayRedisMessage)children.get(0);
  ArrayRedisMessage strArray=(ArrayRedisMessage)children.get(1);
  assertThat(intArray.children().size(),is(3));
  assertThat(((IntegerRedisMessage)intArray.children().get(0)).value(),is(1L));
  assertThat(((IntegerRedisMessage)intArray.children().get(1)).value(),is(2L));
  assertThat(((IntegerRedisMessage)intArray.children().get(2)).value(),is(3L));
  assertThat(strArray.children().size(),is(2));
  assertThat(((SimpleStringRedisMessage)strArray.children().get(0)).content(),is("Foo"));
  assertThat(((ErrorRedisMessage)strArray.children().get(1)).content(),is("Bar"));
  ReferenceCountUtil.release(msg);
}
