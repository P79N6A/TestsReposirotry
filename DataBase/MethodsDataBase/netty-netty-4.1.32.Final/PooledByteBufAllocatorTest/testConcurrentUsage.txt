@Test public void testConcurrentUsage() throws Throwable {
  long runningTime=MILLISECONDS.toNanos(SystemPropertyUtil.getLong("io.netty.buffer.PooledByteBufAllocatorTest.testConcurrentUsageTime",15000));
  ByteBufAllocator allocator=new PooledByteBufAllocator(true,1,1,8192,11,0,0,0);
  List<AllocationThread> threads=new ArrayList<AllocationThread>();
  try {
    for (int i=0; i < 512; i++) {
      AllocationThread thread=new AllocationThread(allocator);
      thread.start();
      threads.add(thread);
    }
    long start=System.nanoTime();
    while (!isExpired(start,runningTime)) {
      checkForErrors(threads);
      Thread.sleep(100);
    }
  }
  finally {
    for (    AllocationThread t : threads) {
      t.finish();
    }
  }
}
