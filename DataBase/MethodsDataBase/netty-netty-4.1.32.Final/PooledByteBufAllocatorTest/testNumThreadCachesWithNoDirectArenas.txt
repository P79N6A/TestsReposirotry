@Test(timeout=3000) public void testNumThreadCachesWithNoDirectArenas() throws InterruptedException {
  int numHeapArenas=1;
  final PooledByteBufAllocator allocator=new PooledByteBufAllocator(numHeapArenas,0,8192,1);
  ThreadCache tcache0=createNewThreadCache(allocator);
  assertEquals(1,allocator.metric().numThreadLocalCaches());
  ThreadCache tcache1=createNewThreadCache(allocator);
  assertEquals(2,allocator.metric().numThreadLocalCaches());
  tcache0.destroy();
  assertEquals(1,allocator.metric().numThreadLocalCaches());
  tcache1.destroy();
  assertEquals(0,allocator.metric().numThreadLocalCaches());
}
