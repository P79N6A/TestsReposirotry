@Test public void releaseWhenCompositeCumulateThrows(){
  final Error error=new Error();
  ByteBuf cumulation=new CompositeByteBuf(UnpooledByteBufAllocator.DEFAULT,false,64){
    @Override public CompositeByteBuf addComponent(    boolean increaseWriterIndex,    ByteBuf buffer){
      throw error;
    }
  }
;
  ByteBuf in=Unpooled.buffer().writeZero(12);
  try {
    ByteToMessageDecoder.COMPOSITE_CUMULATOR.cumulate(UnpooledByteBufAllocator.DEFAULT,cumulation,in);
    fail();
  }
 catch (  Error expected) {
    assertSame(error,expected);
    assertEquals(0,in.refCnt());
  }
}
