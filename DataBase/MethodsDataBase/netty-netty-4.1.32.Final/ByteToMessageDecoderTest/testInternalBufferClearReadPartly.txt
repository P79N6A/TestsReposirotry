/** 
 * Verifies that internal buffer of the ByteToMessageDecoder is released once decoder is removed from pipeline. In this case input was not fully read.
 */
@Test public void testInternalBufferClearReadPartly(){
  final ByteBuf buf=Unpooled.buffer().writeBytes(new byte[]{'a','b'});
  EmbeddedChannel channel=newInternalBufferTestChannel();
  assertTrue(channel.writeInbound(buf));
  assertTrue(channel.finish());
  ByteBuf expected=Unpooled.wrappedBuffer(new byte[]{'b'});
  ByteBuf b=channel.readInbound();
  assertEquals(expected,b);
  assertNull(channel.readInbound());
  expected.release();
  b.release();
}
