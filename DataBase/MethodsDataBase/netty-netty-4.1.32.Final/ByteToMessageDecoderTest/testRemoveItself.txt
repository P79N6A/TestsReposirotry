@Test public void testRemoveItself(){
  EmbeddedChannel channel=new EmbeddedChannel(new ByteToMessageDecoder(){
    private boolean removed;
    @Override protected void decode(    ChannelHandlerContext ctx,    ByteBuf in,    List<Object> out) throws Exception {
      assertFalse(removed);
      in.readByte();
      ctx.pipeline().remove(this);
      removed=true;
    }
  }
);
  ByteBuf buf=Unpooled.wrappedBuffer(new byte[]{'a','b','c'});
  channel.writeInbound(buf.copy());
  ByteBuf b=channel.readInbound();
  assertEquals(b,buf.skipBytes(1));
  b.release();
  buf.release();
}
