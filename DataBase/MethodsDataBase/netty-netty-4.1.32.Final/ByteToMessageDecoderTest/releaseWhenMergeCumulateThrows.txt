@Test public void releaseWhenMergeCumulateThrows(){
  final Error error=new Error();
  ByteBuf cumulation=new UnpooledHeapByteBuf(UnpooledByteBufAllocator.DEFAULT,0,64){
    @Override public ByteBuf writeBytes(    ByteBuf src){
      throw error;
    }
  }
;
  ByteBuf in=Unpooled.buffer().writeZero(12);
  try {
    ByteToMessageDecoder.MERGE_CUMULATOR.cumulate(UnpooledByteBufAllocator.DEFAULT,cumulation,in);
    fail();
  }
 catch (  Error expected) {
    assertSame(error,expected);
    assertEquals(0,in.refCnt());
  }
}
