@Test public void testDecodeLastEmptyBuffer(){
  EmbeddedChannel channel=new EmbeddedChannel(new ByteToMessageDecoder(){
    @Override protected void decode(    ChannelHandlerContext ctx,    ByteBuf in,    List<Object> out) throws Exception {
      int readable=in.readableBytes();
      assertTrue(readable > 0);
      out.add(in.readBytes(readable));
    }
  }
);
  byte[] bytes=new byte[1024];
  PlatformDependent.threadLocalRandom().nextBytes(bytes);
  assertTrue(channel.writeInbound(Unpooled.wrappedBuffer(bytes)));
  assertBuffer(Unpooled.wrappedBuffer(bytes),(ByteBuf)channel.readInbound());
  assertNull(channel.readInbound());
  assertFalse(channel.finish());
  assertNull(channel.readInbound());
}
