@Test(timeout=5000) public void testCleanup() throws Exception {
  final AtomicBoolean freeCalled=new AtomicBoolean();
  final CountDownLatch latch=new CountDownLatch(1);
  temporaryThread=new Thread(new Runnable(){
    @Override public void run(){
      try {
        latch.await();
      }
 catch (      InterruptedException ignore) {
      }
    }
  }
);
  temporaryThread.start();
  ObjectCleaner.register(temporaryThread,new Runnable(){
    @Override public void run(){
      freeCalled.set(true);
    }
  }
);
  latch.countDown();
  temporaryThread.join();
  Assert.assertFalse(freeCalled.get());
  temporaryThread=null;
  while (!freeCalled.get()) {
    System.gc();
    System.runFinalization();
    Thread.sleep(100);
  }
}
