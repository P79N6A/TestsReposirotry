@Test public void testAccountForHeaderOverhead() throws Exception {
  ByteBuf in=Unpooled.buffer(100);
  try {
    String headerName="12345";
    String headerValue="56789";
    long headerSize=headerName.length() + headerValue.length();
    hpackDecoder.setMaxHeaderListSize(headerSize);
    HpackEncoder hpackEncoder=new HpackEncoder(true);
    Http2Headers toEncode=new DefaultHttp2Headers();
    toEncode.add(headerName,headerValue);
    hpackEncoder.encodeHeaders(1,in,toEncode,NEVER_SENSITIVE);
    Http2Headers decoded=new DefaultHttp2Headers();
    assertThat(hpackDecoder.getMaxHeaderListSize(),is(greaterThanOrEqualTo(headerSize)));
    expectedException.expect(Http2Exception.HeaderListSizeException.class);
    hpackDecoder.decode(1,in,decoded,true);
  }
  finally {
    in.release();
  }
}
