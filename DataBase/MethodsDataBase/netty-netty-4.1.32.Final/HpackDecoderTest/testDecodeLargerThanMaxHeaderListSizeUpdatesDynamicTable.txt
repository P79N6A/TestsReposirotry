@Test public void testDecodeLargerThanMaxHeaderListSizeUpdatesDynamicTable() throws Http2Exception {
  ByteBuf in=Unpooled.buffer(300);
  try {
    hpackDecoder.setMaxHeaderListSize(200);
    HpackEncoder hpackEncoder=new HpackEncoder(true);
    Http2Headers toEncode=new DefaultHttp2Headers();
    toEncode.add("test_1","1");
    toEncode.add("test_2","2");
    toEncode.add("long",String.format("%0100d",0).replace('0','A'));
    toEncode.add("test_3","3");
    hpackEncoder.encodeHeaders(1,in,toEncode,NEVER_SENSITIVE);
    Http2Headers decoded=new DefaultHttp2Headers();
    try {
      hpackDecoder.decode(1,in,decoded,true);
      fail();
    }
 catch (    Http2Exception e) {
      assertTrue(e instanceof Http2Exception.HeaderListSizeException);
    }
    in.clear();
    in.writeByte(0x80 | 62);
    Http2Headers decoded2=new DefaultHttp2Headers();
    hpackDecoder.decode(1,in,decoded2,true);
    Http2Headers golden=new DefaultHttp2Headers();
    golden.add("test_3","3");
    assertEquals(golden,decoded2);
  }
  finally {
    in.release();
  }
}
