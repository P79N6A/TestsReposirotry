@Test public void testDecodeWithoutStrip() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new LineBasedFrameDecoder(8192,false,false));
  ch.writeInbound(copiedBuffer("first\r\nsecond\nthird",CharsetUtil.US_ASCII));
  ByteBuf buf=ch.readInbound();
  assertEquals("first\r\n",buf.toString(CharsetUtil.US_ASCII));
  ByteBuf buf2=ch.readInbound();
  assertEquals("second\n",buf2.toString(CharsetUtil.US_ASCII));
  assertNull(ch.readInbound());
  ch.finish();
  ReferenceCountUtil.release(ch.readInbound());
  buf.release();
  buf2.release();
}
