@Test public void testTooLongLineWithFailFast() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new LineBasedFrameDecoder(16,false,true));
  try {
    ch.writeInbound(copiedBuffer("12345678901234567",CharsetUtil.US_ASCII));
    fail();
  }
 catch (  Exception e) {
    assertThat(e,is(instanceOf(TooLongFrameException.class)));
  }
  assertThat(ch.writeInbound(copiedBuffer("890",CharsetUtil.US_ASCII)),is(false));
  assertThat(ch.writeInbound(copiedBuffer("123\r\nfirst\r\n",CharsetUtil.US_ASCII)),is(true));
  ByteBuf buf=ch.readInbound();
  ByteBuf buf2=copiedBuffer("first\r\n",CharsetUtil.US_ASCII);
  assertThat(buf,is(buf2));
  assertThat(ch.finish(),is(false));
  buf.release();
  buf2.release();
}
