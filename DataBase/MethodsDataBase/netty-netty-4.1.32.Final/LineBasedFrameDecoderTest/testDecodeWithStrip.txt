@Test public void testDecodeWithStrip() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new LineBasedFrameDecoder(8192,true,false));
  ch.writeInbound(copiedBuffer("first\r\nsecond\nthird",CharsetUtil.US_ASCII));
  ByteBuf buf=ch.readInbound();
  assertEquals("first",buf.toString(CharsetUtil.US_ASCII));
  ByteBuf buf2=ch.readInbound();
  assertEquals("second",buf2.toString(CharsetUtil.US_ASCII));
  assertNull(ch.readInbound());
  ch.finish();
  ReferenceCountUtil.release(ch.readInbound());
  buf.release();
  buf2.release();
}
