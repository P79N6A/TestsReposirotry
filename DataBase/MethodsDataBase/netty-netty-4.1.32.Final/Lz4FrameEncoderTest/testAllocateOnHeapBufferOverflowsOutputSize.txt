/** 
 * This test might be a invasive in terms of knowing what happens inside {@link Lz4FrameEncoder#allocateBuffer(ChannelHandlerContext,ByteBuf,boolean)}, but this is safest way of testing the overflow conditions as allocating the huge buffers fails in many CI environments.
 */
@Test(expected=EncoderException.class) public void testAllocateOnHeapBufferOverflowsOutputSize(){
  final int maxEncodeSize=Integer.MAX_VALUE;
  Lz4FrameEncoder encoder=newEncoder(Lz4Constants.DEFAULT_BLOCK_SIZE,maxEncodeSize);
  when(buffer.readableBytes()).thenReturn(maxEncodeSize);
  buffer.writerIndex(maxEncodeSize);
  encoder.allocateBuffer(ctx,buffer,false);
}
