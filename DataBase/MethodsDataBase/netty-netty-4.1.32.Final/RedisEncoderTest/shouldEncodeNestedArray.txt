@Test public void shouldEncodeNestedArray(){
  List<RedisMessage> grandChildren=new ArrayList<RedisMessage>();
  grandChildren.add(new FullBulkStringRedisMessage(byteBufOf("bar")));
  grandChildren.add(new IntegerRedisMessage(-1234L));
  List<RedisMessage> children=new ArrayList<RedisMessage>();
  children.add(new SimpleStringRedisMessage("foo"));
  children.add(new ArrayRedisMessage(grandChildren));
  RedisMessage msg=new ArrayRedisMessage(children);
  boolean result=channel.writeOutbound(msg);
  assertThat(result,is(true));
  ByteBuf written=readAll(channel);
  assertThat(bytesOf(written),is(equalTo(bytesOf("*2\r\n+foo\r\n*2\r\n$3\r\nbar\r\n:-1234\r\n"))));
  written.release();
}
