@Test public void testDowngradeFullHeaders() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new Http2StreamFrameToHttpObjectCodec(true));
  Http2Headers headers=new DefaultHttp2Headers();
  headers.path("/");
  headers.method("GET");
  assertTrue(ch.writeInbound(new DefaultHttp2HeadersFrame(headers,true)));
  FullHttpRequest request=ch.readInbound();
  try {
    assertThat(request.uri(),is("/"));
    assertThat(request.method(),is(HttpMethod.GET));
    assertThat(request.protocolVersion(),is(HttpVersion.HTTP_1_1));
    assertThat(request.content().readableBytes(),is(0));
    assertTrue(request.trailingHeaders().isEmpty());
    assertFalse(HttpUtil.isTransferEncodingChunked(request));
  }
  finally {
    request.release();
  }
  assertThat(ch.readInbound(),is(nullValue()));
  assertFalse(ch.finish());
}
