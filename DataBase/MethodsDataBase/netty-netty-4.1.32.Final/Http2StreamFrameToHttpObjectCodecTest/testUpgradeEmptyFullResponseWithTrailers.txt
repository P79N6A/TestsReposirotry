@Test public void testUpgradeEmptyFullResponseWithTrailers() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new Http2StreamFrameToHttpObjectCodec(true));
  FullHttpResponse response=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK);
  HttpHeaders trailers=response.trailingHeaders();
  trailers.set("key","value");
  assertTrue(ch.writeOutbound(response));
  Http2HeadersFrame headersFrame=ch.readOutbound();
  assertThat(headersFrame.headers().status().toString(),is("200"));
  assertFalse(headersFrame.isEndStream());
  Http2HeadersFrame trailersFrame=ch.readOutbound();
  assertThat(trailersFrame.headers().get("key").toString(),is("value"));
  assertTrue(trailersFrame.isEndStream());
  assertThat(ch.readOutbound(),is(nullValue()));
  assertFalse(ch.finish());
}
