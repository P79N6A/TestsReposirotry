@Test public void testUpgradeNonEmptyFullResponse() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new Http2StreamFrameToHttpObjectCodec(true));
  ByteBuf hello=Unpooled.copiedBuffer("hello world",CharsetUtil.UTF_8);
  assertTrue(ch.writeOutbound(new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK,hello)));
  Http2HeadersFrame headersFrame=ch.readOutbound();
  assertThat(headersFrame.headers().status().toString(),is("200"));
  assertFalse(headersFrame.isEndStream());
  Http2DataFrame dataFrame=ch.readOutbound();
  try {
    assertThat(dataFrame.content().toString(CharsetUtil.UTF_8),is("hello world"));
    assertTrue(dataFrame.isEndStream());
  }
  finally {
    dataFrame.release();
  }
  assertThat(ch.readOutbound(),is(nullValue()));
  assertFalse(ch.finish());
}
