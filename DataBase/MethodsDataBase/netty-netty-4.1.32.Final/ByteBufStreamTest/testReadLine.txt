@Test public void testReadLine() throws Exception {
  Charset utf8=Charset.forName("UTF-8");
  ByteBuf buf=Unpooled.buffer();
  ByteBufInputStream in=new ByteBufInputStream(buf,true);
  String s=in.readLine();
  assertNull(s);
  int charCount=7;
  byte[] abc="\na\n\nb\r\nc\nd\ne".getBytes(utf8);
  buf.writeBytes(abc);
  in.mark(charCount);
  assertEquals("",in.readLine());
  assertEquals("a",in.readLine());
  assertEquals("",in.readLine());
  assertEquals("b",in.readLine());
  assertEquals("c",in.readLine());
  assertEquals("d",in.readLine());
  assertEquals("e",in.readLine());
  assertNull(in.readLine());
  in.reset();
  int count=0;
  while (in.readLine() != null) {
    ++count;
    if (count > charCount) {
      fail("readLine() should have returned null");
    }
  }
  assertEquals(charCount,count);
  in.close();
}
