@Test public void testNormalHandshake(){
  WebSocketServerExtension extension;
  WebSocketExtensionData data;
  Map<String,String> parameters;
  PerMessageDeflateServerExtensionHandshaker handshaker=new PerMessageDeflateServerExtensionHandshaker();
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,Collections.<String,String>emptyMap()));
  assertNotNull(extension);
  assertEquals(WebSocketServerExtension.RSV1,extension.rsv());
  assertTrue(extension.newExtensionDecoder() instanceof PerMessageDeflateDecoder);
  assertTrue(extension.newExtensionEncoder() instanceof PerMessageDeflateEncoder);
  data=extension.newReponseData();
  assertEquals(PERMESSAGE_DEFLATE_EXTENSION,data.name());
  assertTrue(data.parameters().isEmpty());
  parameters=new HashMap<String,String>();
  parameters.put(CLIENT_MAX_WINDOW,null);
  parameters.put(CLIENT_NO_CONTEXT,null);
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,Collections.<String,String>emptyMap()));
  assertNotNull(extension);
  assertEquals(WebSocketServerExtension.RSV1,extension.rsv());
  assertTrue(extension.newExtensionDecoder() instanceof PerMessageDeflateDecoder);
  assertTrue(extension.newExtensionEncoder() instanceof PerMessageDeflateEncoder);
  data=extension.newReponseData();
  assertEquals(PERMESSAGE_DEFLATE_EXTENSION,data.name());
  assertTrue(data.parameters().isEmpty());
  parameters=new HashMap<String,String>();
  parameters.put(SERVER_MAX_WINDOW,"12");
  parameters.put(SERVER_NO_CONTEXT,null);
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,parameters));
  assertNull(extension);
}
