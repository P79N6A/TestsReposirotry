@Test public void testHttpUpgradeRequestMissingWSKeyHeader(){
  EmbeddedChannel ch=createChannel();
  HttpRequest httpRequest=new WebSocketRequestBuilder().httpVersion(HTTP_1_1).method(HttpMethod.GET).uri("/test").key(null).connection("Upgrade").upgrade(HttpHeaderValues.WEBSOCKET).version13().build();
  ch.writeInbound(httpRequest);
  FullHttpResponse response=responses.remove();
  assertEquals(BAD_REQUEST,response.status());
  assertEquals("not a WebSocket request: missing key",getResponseMessage(response));
  response.release();
}
