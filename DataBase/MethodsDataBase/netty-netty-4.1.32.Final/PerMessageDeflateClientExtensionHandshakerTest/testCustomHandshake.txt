@Test public void testCustomHandshake(){
  WebSocketClientExtension extension;
  Map<String,String> parameters;
  PerMessageDeflateClientExtensionHandshaker handshaker=new PerMessageDeflateClientExtensionHandshaker(6,true,10,true,true);
  parameters=new HashMap<String,String>();
  parameters.put(CLIENT_MAX_WINDOW,"12");
  parameters.put(SERVER_MAX_WINDOW,"10");
  parameters.put(CLIENT_NO_CONTEXT,null);
  parameters.put(SERVER_NO_CONTEXT,null);
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,parameters));
  assertNotNull(extension);
  assertEquals(RSV1,extension.rsv());
  assertTrue(extension.newExtensionDecoder() instanceof PerMessageDeflateDecoder);
  assertTrue(extension.newExtensionEncoder() instanceof PerMessageDeflateEncoder);
  parameters=new HashMap<String,String>();
  parameters.put(SERVER_MAX_WINDOW,"10");
  parameters.put(SERVER_NO_CONTEXT,null);
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,parameters));
  assertNotNull(extension);
  assertEquals(RSV1,extension.rsv());
  assertTrue(extension.newExtensionDecoder() instanceof PerMessageDeflateDecoder);
  assertTrue(extension.newExtensionEncoder() instanceof PerMessageDeflateEncoder);
  parameters=new HashMap<String,String>();
  extension=handshaker.handshakeExtension(new WebSocketExtensionData(PERMESSAGE_DEFLATE_EXTENSION,parameters));
  assertNull(extension);
}
