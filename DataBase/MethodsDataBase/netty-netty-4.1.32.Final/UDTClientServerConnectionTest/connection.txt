/** 
 * Verify UDT client/server connect and disconnect.
 */
@Test public void connection() throws Exception {
  log.info("Starting server.");
  final Server server=new Server(new InetSocketAddress(NetUtil.LOCALHOST4,0));
  final Thread serverTread=new Thread(server,"server-*");
  serverTread.start();
  server.waitForRunning(true);
  assertTrue(server.isRunning);
  log.info("Starting client.");
  final Client client=new Client((InetSocketAddress)server.channel.localAddress());
  final Thread clientThread=new Thread(client,"client-*");
  clientThread.start();
  client.waitForRunning(true);
  assertTrue(client.isRunning);
  log.info("Wait till connection is active.");
  client.waitForActive(true);
  server.waitForActive(true);
  log.info("Verify connection is active.");
  assertEquals("group must have one",1,server.group.size());
  log.info("Stopping client.");
  client.shutdown();
  client.waitForShutdown();
  assertTrue(client.isShutdown);
  log.info("Wait till connection is inactive.");
  client.waitForActive(false);
  server.waitForActive(false);
  log.info("Verify connection is inactive.");
  assertEquals("group must be empty",0,server.group.size());
  log.info("Stopping server.");
  server.shutdown();
  server.waitForShutdown();
  assertTrue(server.isShutdown);
  log.info("Finished server.");
}
