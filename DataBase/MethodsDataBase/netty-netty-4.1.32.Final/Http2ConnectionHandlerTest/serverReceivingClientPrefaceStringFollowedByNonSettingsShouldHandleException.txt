@Test public void serverReceivingClientPrefaceStringFollowedByNonSettingsShouldHandleException() throws Exception {
  when(connection.isServer()).thenReturn(true);
  handler=newHandler();
  ByteBuf buf=Unpooled.buffer().writeBytes(connectionPrefaceBuf()).writeZero(10);
  handler.channelRead(ctx,buf);
  ArgumentCaptor<ByteBuf> captor=ArgumentCaptor.forClass(ByteBuf.class);
  verify(frameWriter,atLeastOnce()).writeGoAway(eq(ctx),eq(0),eq(PROTOCOL_ERROR.code()),captor.capture(),eq(promise));
  assertEquals(0,captor.getValue().refCnt());
}
