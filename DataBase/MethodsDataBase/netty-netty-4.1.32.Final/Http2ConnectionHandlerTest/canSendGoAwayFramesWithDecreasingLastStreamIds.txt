@Test public void canSendGoAwayFramesWithDecreasingLastStreamIds() throws Exception {
  handler=newHandler();
  ByteBuf data=dummyData();
  long errorCode=Http2Error.INTERNAL_ERROR.code();
  handler.goAway(ctx,STREAM_ID + 2,errorCode,data.retain(),promise);
  verify(frameWriter).writeGoAway(eq(ctx),eq(STREAM_ID + 2),eq(errorCode),eq(data),eq(promise));
  verify(connection).goAwaySent(eq(STREAM_ID + 2),eq(errorCode),eq(data));
  promise=new DefaultChannelPromise(channel);
  handler.goAway(ctx,STREAM_ID,errorCode,data,promise);
  verify(frameWriter).writeGoAway(eq(ctx),eq(STREAM_ID),eq(errorCode),eq(data),eq(promise));
  verify(connection).goAwaySent(eq(STREAM_ID),eq(errorCode),eq(data));
  assertEquals(0,data.refCnt());
}
