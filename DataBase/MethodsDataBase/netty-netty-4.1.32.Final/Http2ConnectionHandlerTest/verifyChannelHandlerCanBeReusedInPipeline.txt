@Test public void verifyChannelHandlerCanBeReusedInPipeline() throws Exception {
  when(connection.isServer()).thenReturn(true);
  handler=newHandler();
  ByteBuf preface=connectionPrefaceBuf();
  handler.channelRead(ctx,preface);
  verify(decoder,never()).decodeFrame(any(ChannelHandlerContext.class),any(ByteBuf.class),ArgumentMatchers.<List<Object>>any());
  handler.handlerRemoved(ctx);
  handler.handlerAdded(ctx);
  ByteBuf prefacePlusSome=addSettingsHeader(Unpooled.buffer().writeBytes(connectionPrefaceBuf()));
  handler.channelRead(ctx,prefacePlusSome);
  verify(decoder,atLeastOnce()).decodeFrame(eq(ctx),any(ByteBuf.class),ArgumentMatchers.<List<Object>>any());
}
