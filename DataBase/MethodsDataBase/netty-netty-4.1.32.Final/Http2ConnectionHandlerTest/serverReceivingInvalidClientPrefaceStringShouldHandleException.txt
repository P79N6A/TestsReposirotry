@Test public void serverReceivingInvalidClientPrefaceStringShouldHandleException() throws Exception {
  when(connection.isServer()).thenReturn(true);
  handler=newHandler();
  handler.channelRead(ctx,copiedBuffer("BAD_PREFACE",UTF_8));
  ArgumentCaptor<ByteBuf> captor=ArgumentCaptor.forClass(ByteBuf.class);
  verify(frameWriter).writeGoAway(eq(ctx),eq(0),eq(PROTOCOL_ERROR.code()),captor.capture(),eq(promise));
  assertEquals(0,captor.getValue().refCnt());
}
