@Test public void preflightRequestWithConnectionKeepAliveShouldStayOpen() throws Exception {
  final CorsConfig config=forOrigin("http://localhost:8888").build();
  final EmbeddedChannel channel=new EmbeddedChannel(new CorsHandler(config));
  final FullHttpRequest request=optionsRequest("http://localhost:8888","",KEEP_ALIVE);
  assertThat(channel.writeInbound(request),is(false));
  final HttpResponse response=channel.readOutbound();
  assertThat(HttpUtil.isKeepAlive(response),is(true));
  assertThat(channel.isOpen(),is(true));
  assertThat(response.status(),is(OK));
  assertThat(ReferenceCountUtil.release(response),is(true));
  assertThat(channel.finish(),is(false));
}
