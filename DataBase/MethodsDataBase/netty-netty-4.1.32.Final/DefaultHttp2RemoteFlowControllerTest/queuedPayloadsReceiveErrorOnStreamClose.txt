@Test public void queuedPayloadsReceiveErrorOnStreamClose() throws Http2Exception {
  controller.initialWindowSize(0);
  verify(listener,times(1)).writabilityChanged(stream(STREAM_A));
  assertFalse(controller.isWritable(stream(STREAM_A)));
  reset(listener);
  FakeFlowControlled data=new FakeFlowControlled(15);
  FakeFlowControlled moreData=new FakeFlowControlled(0);
  sendData(STREAM_A,data);
  controller.writePendingBytes();
  data.assertNotWritten();
  sendData(STREAM_A,moreData);
  controller.writePendingBytes();
  moreData.assertNotWritten();
  connection.stream(STREAM_A).close();
  data.assertError(Http2Error.STREAM_CLOSED);
  moreData.assertError(Http2Error.STREAM_CLOSED);
  verifyZeroInteractions(listener);
}
