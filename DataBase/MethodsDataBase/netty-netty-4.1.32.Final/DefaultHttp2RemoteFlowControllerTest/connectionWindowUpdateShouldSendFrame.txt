@Test public void connectionWindowUpdateShouldSendFrame() throws Http2Exception {
  exhaustStreamWindow(CONNECTION_STREAM_ID);
  assertWritabilityChanged(1,false);
  reset(listener);
  FakeFlowControlled data=new FakeFlowControlled(10);
  sendData(STREAM_A,data);
  controller.writePendingBytes();
  data.assertNotWritten();
  assertWritabilityChanged(0,false);
  reset(listener);
  incrementWindowSize(CONNECTION_STREAM_ID,10);
  assertWritabilityChanged(0,false);
  reset(listener);
  data.assertNotWritten();
  controller.writePendingBytes();
  data.assertFullyWritten();
  assertWritabilityChanged(0,false);
  assertEquals(0,window(CONNECTION_STREAM_ID));
  assertEquals(DEFAULT_WINDOW_SIZE - 10,window(STREAM_A));
  assertEquals(DEFAULT_WINDOW_SIZE,window(STREAM_B));
  assertEquals(DEFAULT_WINDOW_SIZE,window(STREAM_C));
  assertEquals(DEFAULT_WINDOW_SIZE,window(STREAM_D));
}
