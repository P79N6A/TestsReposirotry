@Test public void testResolve() throws Exception {
  Set<String> domains=new HashSet<String>();
  domains.add("host1.foo.com");
  domains.add("host1");
  domains.add("host3");
  domains.add("host4.sub.foo.com");
  domains.add("host5.sub.foo.com");
  domains.add("host5.sub");
  TestDnsServer.MapRecordStoreA store=new TestDnsServer.MapRecordStoreA(domains);
  dnsServer=new TestDnsServer(store);
  dnsServer.start();
  resolver=newResolver().searchDomains(Collections.singletonList("foo.com")).ndots(2).build();
  String a="host1.foo.com";
  String resolved=assertResolve(resolver,a);
  assertEquals(store.getAddress("host1.foo.com"),resolved);
  resolved=assertResolve(resolver,"host1");
  assertEquals(store.getAddress("host1.foo.com"),resolved);
  resolved=assertResolve(resolver,"host1.");
  assertEquals(store.getAddress("host1"),resolved);
  assertNotResolve(resolver,"host2");
  resolved=assertResolve(resolver,"host3");
  assertEquals(store.getAddress("host3"),resolved);
  resolved=assertResolve(resolver,"host3.");
  assertEquals(store.getAddress("host3"),resolved);
  resolved=assertResolve(resolver,"host4.sub");
  assertEquals(store.getAddress("host4.sub.foo.com"),resolved);
  resolved=assertResolve(resolver,"host5.sub");
  assertEquals(store.getAddress("host5.sub.foo.com"),resolved);
}
