@Test public void testSearchDomainWithNdots2() throws Exception {
  Set<String> domains=new HashSet<String>();
  domains.add("host1.sub.foo.com");
  domains.add("host2.sub.foo.com");
  domains.add("host2.sub");
  TestDnsServer.MapRecordStoreA store=new TestDnsServer.MapRecordStoreA(domains);
  dnsServer=new TestDnsServer(store);
  dnsServer.start();
  resolver=newResolver().searchDomains(Collections.singleton("foo.com")).ndots(2).build();
  String resolved=assertResolve(resolver,"host1.sub");
  assertEquals(store.getAddress("host1.sub.foo.com"),resolved);
  resolved=assertResolve(resolver,"host2.sub");
  assertEquals(store.getAddress("host2.sub.foo.com"),resolved);
}
