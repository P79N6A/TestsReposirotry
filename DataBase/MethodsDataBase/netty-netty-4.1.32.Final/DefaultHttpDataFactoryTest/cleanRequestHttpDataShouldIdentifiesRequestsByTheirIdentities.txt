@Test public void cleanRequestHttpDataShouldIdentifiesRequestsByTheirIdentities() throws Exception {
  Attribute attribute1=factory.createAttribute(req1,"attribute1","value1");
  Attribute attribute2=factory.createAttribute(req2,"attribute2","value2");
  FileUpload file1=factory.createFileUpload(req1,"file1","file1.txt",DEFAULT_TEXT_CONTENT_TYPE,IDENTITY.toString(),UTF_8,123);
  FileUpload file2=factory.createFileUpload(req2,"file2","file2.txt",DEFAULT_TEXT_CONTENT_TYPE,IDENTITY.toString(),UTF_8,123);
  file1.setContent(Unpooled.copiedBuffer("file1 content",UTF_8));
  file2.setContent(Unpooled.copiedBuffer("file2 content",UTF_8));
  assertNotNull(attribute1.getByteBuf());
  assertNotNull(attribute2.getByteBuf());
  assertNotNull(file1.getByteBuf());
  assertNotNull(file2.getByteBuf());
  assertEquals(1,attribute1.refCnt());
  assertEquals(1,attribute2.refCnt());
  assertEquals(1,file1.refCnt());
  assertEquals(1,file2.refCnt());
  factory.cleanRequestHttpData(req1);
  assertNull(attribute1.getByteBuf());
  assertNull(file1.getByteBuf());
  assertEquals(0,attribute1.refCnt());
  assertEquals(0,file1.refCnt());
  assertNotNull(attribute2.getByteBuf());
  assertNotNull(file2.getByteBuf());
  assertEquals(1,attribute2.refCnt());
  assertEquals(1,file2.refCnt());
}
