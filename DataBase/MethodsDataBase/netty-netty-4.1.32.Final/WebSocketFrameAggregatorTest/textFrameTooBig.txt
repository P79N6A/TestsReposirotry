@Test public void textFrameTooBig() throws Exception {
  EmbeddedChannel channel=new EmbeddedChannel(new WebSocketFrameAggregator(8));
  channel.writeInbound(new BinaryWebSocketFrame(true,1,Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new BinaryWebSocketFrame(false,0,Unpooled.wrappedBuffer(content1)));
  try {
    channel.writeInbound(new ContinuationWebSocketFrame(false,0,Unpooled.wrappedBuffer(content2)));
    Assert.fail();
  }
 catch (  TooLongFrameException e) {
  }
  channel.writeInbound(new ContinuationWebSocketFrame(false,0,Unpooled.wrappedBuffer(content2)));
  channel.writeInbound(new ContinuationWebSocketFrame(true,0,Unpooled.wrappedBuffer(content2)));
  channel.writeInbound(new BinaryWebSocketFrame(true,1,Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new BinaryWebSocketFrame(false,0,Unpooled.wrappedBuffer(content1)));
  try {
    channel.writeInbound(new ContinuationWebSocketFrame(false,0,Unpooled.wrappedBuffer(content2)));
    Assert.fail();
  }
 catch (  TooLongFrameException e) {
  }
  channel.writeInbound(new ContinuationWebSocketFrame(false,0,Unpooled.wrappedBuffer(content2)));
  channel.writeInbound(new ContinuationWebSocketFrame(true,0,Unpooled.wrappedBuffer(content2)));
  for (; ; ) {
    Object msg=channel.readInbound();
    if (msg == null) {
      break;
    }
    ReferenceCountUtil.release(msg);
  }
  channel.finish();
}
