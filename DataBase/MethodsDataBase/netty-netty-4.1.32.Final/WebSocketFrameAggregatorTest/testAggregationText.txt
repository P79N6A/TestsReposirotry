@Test public void testAggregationText(){
  EmbeddedChannel channel=new EmbeddedChannel(new WebSocketFrameAggregator(Integer.MAX_VALUE));
  channel.writeInbound(new TextWebSocketFrame(true,1,Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new TextWebSocketFrame(false,0,Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new ContinuationWebSocketFrame(false,0,Unpooled.wrappedBuffer(content2)));
  channel.writeInbound(new PingWebSocketFrame(Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new PongWebSocketFrame(Unpooled.wrappedBuffer(content1)));
  channel.writeInbound(new ContinuationWebSocketFrame(true,0,Unpooled.wrappedBuffer(content3)));
  Assert.assertTrue(channel.finish());
  TextWebSocketFrame frame=channel.readInbound();
  Assert.assertTrue(frame.isFinalFragment());
  Assert.assertEquals(1,frame.rsv());
  Assert.assertArrayEquals(content1,toBytes(frame.content()));
  PingWebSocketFrame frame2=channel.readInbound();
  Assert.assertTrue(frame2.isFinalFragment());
  Assert.assertEquals(0,frame2.rsv());
  Assert.assertArrayEquals(content1,toBytes(frame2.content()));
  PongWebSocketFrame frame3=channel.readInbound();
  Assert.assertTrue(frame3.isFinalFragment());
  Assert.assertEquals(0,frame3.rsv());
  Assert.assertArrayEquals(content1,toBytes(frame3.content()));
  TextWebSocketFrame frame4=channel.readInbound();
  Assert.assertTrue(frame4.isFinalFragment());
  Assert.assertEquals(0,frame4.rsv());
  Assert.assertArrayEquals(aggregatedContent,toBytes(frame4.content()));
  Assert.assertNull(channel.readInbound());
}
