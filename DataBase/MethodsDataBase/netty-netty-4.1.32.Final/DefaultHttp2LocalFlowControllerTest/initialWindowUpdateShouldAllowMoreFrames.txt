@Test public void initialWindowUpdateShouldAllowMoreFrames() throws Http2Exception {
  int initialWindowSize=DEFAULT_WINDOW_SIZE;
  receiveFlowControlledFrame(STREAM_ID,initialWindowSize,0,false);
  assertEquals(0,window(STREAM_ID));
  assertEquals(0,window(CONNECTION_STREAM_ID));
  consumeBytes(STREAM_ID,initialWindowSize);
  assertEquals(initialWindowSize,window(STREAM_ID));
  assertEquals(DEFAULT_WINDOW_SIZE,window(CONNECTION_STREAM_ID));
  int newInitialWindowSize=2 * initialWindowSize;
  controller.initialWindowSize(newInitialWindowSize);
  assertEquals(newInitialWindowSize,window(STREAM_ID));
  assertEquals(DEFAULT_WINDOW_SIZE,window(CONNECTION_STREAM_ID));
  reset(frameWriter);
  receiveFlowControlledFrame(STREAM_ID,initialWindowSize,0,false);
  assertTrue(consumeBytes(STREAM_ID,initialWindowSize));
  int delta=newInitialWindowSize - initialWindowSize;
  verifyWindowUpdateSent(STREAM_ID,delta);
  verifyWindowUpdateSent(CONNECTION_STREAM_ID,delta);
}
