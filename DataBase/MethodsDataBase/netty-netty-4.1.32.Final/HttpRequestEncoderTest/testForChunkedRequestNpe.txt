/** 
 * A test that checks for a NPE that would occur if when processing  {@link LastHttpContent#EMPTY_LAST_CONTENT}when a certain initialization order of  {@link EmptyHttpHeaders} would occur.
 */
@Test public void testForChunkedRequestNpe() throws Exception {
  EmbeddedChannel channel=new EmbeddedChannel(new HttpRequestEncoder());
  assertTrue(channel.writeOutbound(new CustomHttpRequest()));
  assertTrue(channel.writeOutbound(new DefaultHttpContent(Unpooled.copiedBuffer("test",CharsetUtil.US_ASCII))));
  assertTrue(channel.writeOutbound(LastHttpContent.EMPTY_LAST_CONTENT));
  assertTrue(channel.finishAndReleaseAll());
}
