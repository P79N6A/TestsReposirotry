@Test public void testEmptyBufferShouldPassThrough() throws Exception {
  HttpRequestEncoder encoder=new HttpRequestEncoder();
  EmbeddedChannel channel=new EmbeddedChannel(encoder);
  ByteBuf buffer=Unpooled.buffer();
  channel.writeAndFlush(buffer).get();
  channel.finishAndReleaseAll();
  assertEquals(0,buffer.refCnt());
}
