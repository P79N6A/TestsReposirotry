@Test public void testEmptyReleasedBufferShouldNotWriteEmptyBufferToChannel() throws Exception {
  HttpRequestEncoder encoder=new HttpRequestEncoder();
  EmbeddedChannel channel=new EmbeddedChannel(encoder);
  ByteBuf buf=Unpooled.buffer();
  buf.release();
  try {
    channel.writeAndFlush(buf).get();
    fail();
  }
 catch (  ExecutionException e) {
    assertThat(e.getCause().getCause(),is(instanceOf(IllegalReferenceCountException.class)));
  }
  channel.finishAndReleaseAll();
}
