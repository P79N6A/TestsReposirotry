@Test public void testFullContent() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new TestEncoder());
  ch.writeInbound(new DefaultFullHttpRequest(HttpVersion.HTTP_1_1,HttpMethod.GET,"/"));
  FullHttpResponse res=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK,Unpooled.wrappedBuffer(new byte[42]));
  ch.writeOutbound(res);
  assertEncodedResponse(ch);
  HttpContent c=ch.readOutbound();
  assertThat(c.content().readableBytes(),is(2));
  assertThat(c.content().toString(CharsetUtil.US_ASCII),is("42"));
  c.release();
  LastHttpContent last=ch.readOutbound();
  assertThat(last.content().readableBytes(),is(0));
  last.release();
  assertThat(ch.readOutbound(),is(nullValue()));
}
