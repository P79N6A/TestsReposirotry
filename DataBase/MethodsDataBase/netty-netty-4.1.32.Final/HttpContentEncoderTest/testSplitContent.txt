@Test public void testSplitContent() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new TestEncoder());
  ch.writeInbound(new DefaultFullHttpRequest(HttpVersion.HTTP_1_1,HttpMethod.GET,"/"));
  ch.writeOutbound(new DefaultHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK));
  ch.writeOutbound(new DefaultHttpContent(Unpooled.wrappedBuffer(new byte[3])));
  ch.writeOutbound(new DefaultHttpContent(Unpooled.wrappedBuffer(new byte[2])));
  ch.writeOutbound(new DefaultLastHttpContent(Unpooled.wrappedBuffer(new byte[1])));
  assertEncodedResponse(ch);
  HttpContent chunk;
  chunk=ch.readOutbound();
  assertThat(chunk.content().toString(CharsetUtil.US_ASCII),is("3"));
  chunk.release();
  chunk=ch.readOutbound();
  assertThat(chunk.content().toString(CharsetUtil.US_ASCII),is("2"));
  chunk.release();
  chunk=ch.readOutbound();
  assertThat(chunk.content().toString(CharsetUtil.US_ASCII),is("1"));
  chunk.release();
  chunk=ch.readOutbound();
  assertThat(chunk.content().isReadable(),is(false));
  assertThat(chunk,is(instanceOf(LastHttpContent.class)));
  chunk.release();
  assertThat(ch.readOutbound(),is(nullValue()));
}
