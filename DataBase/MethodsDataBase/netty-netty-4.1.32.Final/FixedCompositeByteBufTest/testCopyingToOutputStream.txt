@Test public void testCopyingToOutputStream() throws IOException {
  ByteBuf buf1=directBuffer(10);
  ByteBuf buf2=buffer(10);
  ByteBuf buf3=directBuffer(10);
  buf1.writeBytes("a".getBytes(Charset.defaultCharset()));
  buf2.writeBytes("b".getBytes(Charset.defaultCharset()));
  buf3.writeBytes("c".getBytes(Charset.defaultCharset()));
  ByteBuf composite=unmodifiableBuffer(buf1,buf2,buf3);
  ByteBuf copy=directBuffer(3);
  ByteBuf copy2=buffer(3);
  OutputStream copyStream=new ByteBufOutputStream(copy);
  OutputStream copy2Stream=new ByteBufOutputStream(copy2);
  try {
    composite.getBytes(0,copyStream,3);
    composite.getBytes(0,copy2Stream,3);
    assertEquals(0,ByteBufUtil.compare(copy,composite));
    assertEquals(0,ByteBufUtil.compare(copy2,composite));
    assertEquals(0,ByteBufUtil.compare(copy,copy2));
  }
  finally {
    copy.release();
    copy2.release();
    copyStream.close();
    copy2Stream.close();
    composite.release();
  }
}
