@Test public void testCloseChannelOnCreation(){
  EmbeddedChannel channel=newChannel();
  ChannelHandlerContext context=channel.pipeline().firstContext();
  channel.close().syncUninterruptibly();
  final PendingWriteQueue queue=new PendingWriteQueue(context);
  IllegalStateException ex=new IllegalStateException();
  ChannelPromise promise=channel.newPromise();
  queue.add(1L,promise);
  queue.removeAndFailAll(ex);
  assertSame(ex,promise.cause());
}
