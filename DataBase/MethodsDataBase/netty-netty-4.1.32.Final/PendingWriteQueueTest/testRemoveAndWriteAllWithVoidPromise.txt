@Test public void testRemoveAndWriteAllWithVoidPromise(){
  EmbeddedChannel channel=new EmbeddedChannel(new ChannelOutboundHandlerAdapter(){
    @Override public void write(    ChannelHandlerContext ctx,    Object msg,    ChannelPromise promise){
      ctx.writeAndFlush(msg,promise);
    }
  }
,new ChannelOutboundHandlerAdapter());
  final PendingWriteQueue queue=new PendingWriteQueue(channel.pipeline().lastContext());
  ChannelPromise promise=channel.newPromise();
  queue.add(1L,promise);
  queue.add(2L,channel.voidPromise());
  queue.removeAndWriteAll();
  assertTrue(channel.finish());
  assertTrue(promise.isDone());
  assertTrue(promise.isSuccess());
  assertEquals(1L,channel.readOutbound());
  assertEquals(2L,channel.readOutbound());
}
