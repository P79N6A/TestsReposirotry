@Test public void testConcatenatedStreamsReadFully() throws IOException {
  EmbeddedChannel chDecoderGZip=new EmbeddedChannel(new JdkZlibDecoder(true));
  try {
    byte[] bytes=IOUtils.toByteArray(getClass().getResourceAsStream("/multiple.gz"));
    assertTrue(chDecoderGZip.writeInbound(Unpooled.copiedBuffer(bytes)));
    Queue<Object> messages=chDecoderGZip.inboundMessages();
    assertEquals(2,messages.size());
    for (    String s : Arrays.asList("a","b")) {
      ByteBuf msg=(ByteBuf)messages.poll();
      assertEquals(s,msg.toString(CharsetUtil.UTF_8));
      ReferenceCountUtil.release(msg);
    }
  }
  finally {
    assertFalse(chDecoderGZip.finish());
    chDecoderGZip.close();
  }
}
