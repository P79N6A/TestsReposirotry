@Test public void testConcatenatedStreamsReadFirstOnly() throws IOException {
  EmbeddedChannel chDecoderGZip=new EmbeddedChannel(createDecoder(ZlibWrapper.GZIP));
  try {
    byte[] bytes=IOUtils.toByteArray(getClass().getResourceAsStream("/multiple.gz"));
    assertTrue(chDecoderGZip.writeInbound(Unpooled.copiedBuffer(bytes)));
    Queue<Object> messages=chDecoderGZip.inboundMessages();
    assertEquals(1,messages.size());
    ByteBuf msg=(ByteBuf)messages.poll();
    assertEquals("a",msg.toString(CharsetUtil.UTF_8));
    ReferenceCountUtil.release(msg);
  }
  finally {
    assertFalse(chDecoderGZip.finish());
    chDecoderGZip.close();
  }
}
