/** 
 * In this test, we verify that each stream is allocated a minimum chunk size. When bytes run out, the remaining streams will be next in line for the next iteration.
 */
@Test public void minChunkShouldBeAllocatedPerStream() throws Http2Exception {
  setPriority(STREAM_A,0,(short)50,false);
  setPriority(STREAM_B,0,(short)200,false);
  setPriority(STREAM_C,STREAM_A,(short)100,false);
  setPriority(STREAM_D,STREAM_A,(short)100,false);
  initState(STREAM_A,CHUNK_SIZE,true);
  initState(STREAM_B,CHUNK_SIZE,true);
  initState(STREAM_C,CHUNK_SIZE,true);
  initState(STREAM_D,CHUNK_SIZE,true);
  int written=3 * CHUNK_SIZE;
  assertTrue(write(written));
  assertEquals(CHUNK_SIZE,captureWrite(STREAM_A));
  assertEquals(CHUNK_SIZE,captureWrite(STREAM_B));
  assertEquals(CHUNK_SIZE,captureWrite(STREAM_C));
  verifyNoMoreInteractions(writer);
  resetWriter();
  assertFalse(write(CHUNK_SIZE));
  assertEquals(CHUNK_SIZE,captureWrite(STREAM_D));
  verifyNoMoreInteractions(writer);
}
