@Test public void testPublishMessageTooLarge() throws Exception {
  final MqttPublishMessage message=createPublishMessage();
  ByteBuf byteBuf=MqttEncoder.doEncode(ALLOCATOR,message);
  try {
    final List<Object> out=new LinkedList<Object>();
    mqttDecoderLimitedMessageSize.decode(ctx,byteBuf,out);
    assertEquals("Expected one object but got " + out.size(),1,out.size());
    final MqttMessage decodedMessage=(MqttMessage)out.get(0);
    validateFixedHeaders(message.fixedHeader(),decodedMessage.fixedHeader());
    validatePublishVariableHeader(message.variableHeader(),(MqttPublishVariableHeader)decodedMessage.variableHeader());
    validateDecoderExceptionTooLargeMessage(decodedMessage);
  }
  finally {
    byteBuf.release();
  }
}
