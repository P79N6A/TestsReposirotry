@Test public void testConnectMessageForMqtt311TooLarge() throws Exception {
  final MqttConnectMessage message=createConnectMessage(MqttVersion.MQTT_3_1_1);
  ByteBuf byteBuf=MqttEncoder.doEncode(ALLOCATOR,message);
  try {
    final List<Object> out=new LinkedList<Object>();
    mqttDecoderLimitedMessageSize.decode(ctx,byteBuf,out);
    assertEquals("Expected one object but got " + out.size(),1,out.size());
    final MqttMessage decodedMessage=(MqttMessage)out.get(0);
    validateFixedHeaders(message.fixedHeader(),decodedMessage.fixedHeader());
    validateConnectVariableHeader(message.variableHeader(),(MqttConnectVariableHeader)decodedMessage.variableHeader());
    validateDecoderExceptionTooLargeMessage(decodedMessage);
  }
  finally {
    byteBuf.release();
  }
}
