@Test public void testConnectMessageWithNonZeroReservedFlagForMqtt311() throws Exception {
  final MqttConnectMessage message=createConnectMessage(MqttVersion.MQTT_3_1_1);
  ByteBuf byteBuf=MqttEncoder.doEncode(ALLOCATOR,message);
  try {
    byteBuf.setByte(9,byteBuf.getByte(9) | 0x1);
    final List<Object> out=new LinkedList<Object>();
    mqttDecoder.decode(ctx,byteBuf,out);
    assertEquals("Expected one object but got " + out.size(),1,out.size());
    final MqttMessage decodedMessage=(MqttMessage)out.get(0);
    assertTrue(decodedMessage.decoderResult().isFailure());
    Throwable cause=decodedMessage.decoderResult().cause();
    assertTrue(cause instanceof DecoderException);
    assertEquals("non-zero reserved flag",cause.getMessage());
  }
  finally {
    byteBuf.release();
  }
}
