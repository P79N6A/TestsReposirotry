/** 
 * This test makes sure that even when the decoder is confronted with various chunk sizes in the middle of decoding, it can recover and decode all the time eventually.
 */
@Test public void shouldHandleNonUniformNetworkBatches(){
  ByteBuf incoming=Unpooled.copiedBuffer(SET_REQUEST_WITH_CONTENT);
  while (incoming.isReadable()) {
    channel.writeInbound(incoming.readBytes(5));
  }
  incoming.release();
  BinaryMemcacheRequest request=channel.readInbound();
  assertThat(request,notNullValue());
  assertThat(request.key(),notNullValue());
  assertThat(request.extras(),nullValue());
  request.release();
  MemcacheContent content1=channel.readInbound();
  MemcacheContent content2=channel.readInbound();
  assertThat(content1,instanceOf(MemcacheContent.class));
  assertThat(content2,instanceOf(LastMemcacheContent.class));
  assertThat(content1.content().readableBytes(),is(3));
  assertThat(content2.content().readableBytes(),is(5));
  content1.release();
  content2.release();
}
