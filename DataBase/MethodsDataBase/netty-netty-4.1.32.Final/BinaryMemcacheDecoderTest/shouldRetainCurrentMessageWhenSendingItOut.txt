@Test public void shouldRetainCurrentMessageWhenSendingItOut(){
  channel=new EmbeddedChannel(new BinaryMemcacheRequestEncoder(),new BinaryMemcacheRequestDecoder());
  ByteBuf key=Unpooled.copiedBuffer("Netty",CharsetUtil.UTF_8);
  ByteBuf extras=Unpooled.copiedBuffer("extras",CharsetUtil.UTF_8);
  BinaryMemcacheRequest request=new DefaultBinaryMemcacheRequest(key,extras);
  assertTrue(channel.writeOutbound(request));
  for (; ; ) {
    ByteBuf buffer=channel.readOutbound();
    if (buffer == null) {
      break;
    }
    channel.writeInbound(buffer);
  }
  BinaryMemcacheRequest read=channel.readInbound();
  read.release();
}
