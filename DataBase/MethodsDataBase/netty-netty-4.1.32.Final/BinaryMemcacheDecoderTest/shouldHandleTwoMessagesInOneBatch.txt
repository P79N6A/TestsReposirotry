/** 
 * This test makes sure that even when more requests arrive in the same batch, they get emitted as separate messages.
 */
@Test public void shouldHandleTwoMessagesInOneBatch(){
  channel.writeInbound(Unpooled.buffer().writeBytes(GET_REQUEST).writeBytes(GET_REQUEST));
  BinaryMemcacheRequest request=channel.readInbound();
  assertThat(request,instanceOf(BinaryMemcacheRequest.class));
  assertThat(request,notNullValue());
  request.release();
  Object lastContent=channel.readInbound();
  assertThat(lastContent,instanceOf(LastMemcacheContent.class));
  ((ReferenceCounted)lastContent).release();
  request=channel.readInbound();
  assertThat(request,instanceOf(BinaryMemcacheRequest.class));
  assertThat(request,notNullValue());
  request.release();
  lastContent=channel.readInbound();
  assertThat(lastContent,instanceOf(LastMemcacheContent.class));
  ((ReferenceCounted)lastContent).release();
}
