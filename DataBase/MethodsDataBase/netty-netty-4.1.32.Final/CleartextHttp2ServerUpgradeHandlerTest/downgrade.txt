@Test public void downgrade() throws Exception {
  setUpServerChannel();
  String requestString="GET / HTTP/1.1\r\n" + "Host: example.com\r\n\r\n";
  ByteBuf inbound=Unpooled.buffer().writeBytes(requestString.getBytes(CharsetUtil.US_ASCII));
  assertTrue(channel.writeInbound(inbound));
  Object firstInbound=channel.readInbound();
  assertTrue(firstInbound instanceof HttpRequest);
  HttpRequest request=(HttpRequest)firstInbound;
  assertEquals(HttpMethod.GET,request.method());
  assertEquals("/",request.uri());
  assertEquals(HttpVersion.HTTP_1_1,request.protocolVersion());
  assertEquals(new DefaultHttpHeaders().add("Host","example.com"),request.headers());
  ((LastHttpContent)channel.readInbound()).release();
  assertNull(channel.readInbound());
}
