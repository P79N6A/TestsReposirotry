@Test public void testRacingGetAndGet() throws InterruptedException {
  final NettyRuntime.AvailableProcessorsHolder holder=new NettyRuntime.AvailableProcessorsHolder();
  final CyclicBarrier barrier=new CyclicBarrier(3);
  final AtomicReference<IllegalStateException> firstReference=new AtomicReference<IllegalStateException>();
  final Runnable firstTarget=getRunnable(holder,barrier,firstReference);
  final Thread firstGet=new Thread(firstTarget);
  firstGet.start();
  final AtomicReference<IllegalStateException> secondRefernce=new AtomicReference<IllegalStateException>();
  final Runnable secondTarget=getRunnable(holder,barrier,secondRefernce);
  final Thread secondGet=new Thread(secondTarget);
  secondGet.start();
  await(barrier);
  await(barrier);
  firstGet.join();
  secondGet.join();
  assertNull(firstReference.get());
  assertNull(secondRefernce.get());
}
