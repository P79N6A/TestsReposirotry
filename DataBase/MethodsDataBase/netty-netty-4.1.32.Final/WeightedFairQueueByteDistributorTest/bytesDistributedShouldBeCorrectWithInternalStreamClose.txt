/** 
 * In this test, we close an internal stream in the priority tree. <pre> 0 / \ A   B / \ C   D </pre> After the close: <pre> 0 / | \ C  D  B </pre>
 */
@Test public void bytesDistributedShouldBeCorrectWithInternalStreamClose() throws Http2Exception {
  initState(STREAM_A,400,true);
  initState(STREAM_B,500,true);
  initState(STREAM_C,600,true);
  initState(STREAM_D,700,true);
  stream(STREAM_A).close();
  assertTrue(write(500));
  verifyNeverWrite(STREAM_A);
  assertEquals(500,captureWrites(STREAM_B) + captureWrites(STREAM_C) + captureWrites(STREAM_D));
  assertFalse(write(1300));
  verifyNeverWrite(STREAM_A);
  assertEquals(500,captureWrites(STREAM_B));
  assertEquals(600,captureWrites(STREAM_C));
  assertEquals(700,captureWrites(STREAM_D));
}
