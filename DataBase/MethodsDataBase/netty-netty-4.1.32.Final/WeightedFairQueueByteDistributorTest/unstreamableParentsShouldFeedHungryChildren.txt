/** 
 * Test that the maximum allowed amount the flow controller allows to be sent is always fully allocated if the streams have at least this much data to send. See https://github.com/netty/netty/issues/4266. <pre> 0 / | \ /   |   \ A(0) B(0) C(0) / D(> allowed to send in 1 allocation attempt) </pre>
 */
@Test public void unstreamableParentsShouldFeedHungryChildren() throws Http2Exception {
  setPriority(STREAM_A,0,(short)32,false);
  setPriority(STREAM_B,0,(short)16,false);
  setPriority(STREAM_C,0,(short)16,false);
  setPriority(STREAM_D,STREAM_A,(short)16,false);
  final int writableBytes=100;
  final int expectedUnsentAmount=1;
  initState(STREAM_D,writableBytes + expectedUnsentAmount,true);
  assertTrue(write(writableBytes));
  verifyWrite(STREAM_D,writableBytes);
  assertFalse(write(expectedUnsentAmount));
  verifyWrite(STREAM_D,expectedUnsentAmount);
}
