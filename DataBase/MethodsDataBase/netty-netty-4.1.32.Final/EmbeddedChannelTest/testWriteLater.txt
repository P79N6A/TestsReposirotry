@Test public void testWriteLater(){
  EmbeddedChannel channel=new EmbeddedChannel(new ChannelOutboundHandlerAdapter(){
    @Override public void write(    final ChannelHandlerContext ctx,    final Object msg,    final ChannelPromise promise) throws Exception {
      ctx.executor().execute(new Runnable(){
        @Override public void run(){
          ctx.write(msg,promise);
        }
      }
);
    }
  }
);
  Object msg=new Object();
  assertTrue(channel.writeOutbound(msg));
  assertTrue(channel.finish());
  assertSame(msg,channel.readOutbound());
  assertNull(channel.readOutbound());
}
