@Test public void testConstructWithChannelInitializer(){
  final Integer first=1;
  final Integer second=2;
  final ChannelHandler handler=new ChannelInboundHandlerAdapter(){
    @Override public void channelRead(    ChannelHandlerContext ctx,    Object msg) throws Exception {
      ctx.fireChannelRead(first);
      ctx.fireChannelRead(second);
    }
  }
;
  EmbeddedChannel channel=new EmbeddedChannel(new ChannelInitializer<Channel>(){
    @Override protected void initChannel(    Channel ch) throws Exception {
      ch.pipeline().addLast(handler);
    }
  }
);
  ChannelPipeline pipeline=channel.pipeline();
  assertSame(handler,pipeline.firstContext().handler());
  assertTrue(channel.writeInbound(3));
  assertTrue(channel.finish());
  assertSame(first,channel.readInbound());
  assertSame(second,channel.readInbound());
  assertNull(channel.readInbound());
}
