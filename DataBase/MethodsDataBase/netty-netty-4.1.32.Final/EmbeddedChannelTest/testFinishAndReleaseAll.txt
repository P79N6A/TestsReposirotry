@Test public void testFinishAndReleaseAll(){
  ByteBuf in=Unpooled.buffer();
  ByteBuf out=Unpooled.buffer();
  try {
    EmbeddedChannel channel=new EmbeddedChannel();
    assertTrue(channel.writeInbound(in));
    assertEquals(1,in.refCnt());
    assertTrue(channel.writeOutbound(out));
    assertEquals(1,out.refCnt());
    assertTrue(channel.finishAndReleaseAll());
    assertEquals(0,in.refCnt());
    assertEquals(0,out.refCnt());
    assertNull(channel.readInbound());
    assertNull(channel.readOutbound());
  }
  finally {
    release(in,out);
  }
}
