@Test(timeout=3000) public void testHandlerAddedExecutedInEventLoop() throws Throwable {
  final CountDownLatch latch=new CountDownLatch(1);
  final AtomicReference<Throwable> error=new AtomicReference<Throwable>();
  final ChannelHandler handler=new ChannelHandlerAdapter(){
    @Override public void handlerAdded(    ChannelHandlerContext ctx) throws Exception {
      try {
        assertTrue(ctx.executor().inEventLoop());
      }
 catch (      Throwable cause) {
        error.set(cause);
      }
 finally {
        latch.countDown();
      }
    }
  }
;
  EmbeddedChannel channel=new EmbeddedChannel(handler);
  assertFalse(channel.finish());
  latch.await();
  Throwable cause=error.get();
  if (cause != null) {
    throw cause;
  }
}
