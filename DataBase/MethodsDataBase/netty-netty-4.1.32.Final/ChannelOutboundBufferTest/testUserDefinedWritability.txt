@Test public void testUserDefinedWritability(){
  final StringBuilder buf=new StringBuilder();
  EmbeddedChannel ch=new EmbeddedChannel(new ChannelInboundHandlerAdapter(){
    @Override public void channelWritabilityChanged(    ChannelHandlerContext ctx) throws Exception {
      buf.append(ctx.channel().isWritable());
      buf.append(' ');
    }
  }
);
  ch.config().setWriteBufferLowWaterMark(128);
  ch.config().setWriteBufferHighWaterMark(256);
  ChannelOutboundBuffer cob=ch.unsafe().outboundBuffer();
  for (int i=1; i <= 30; i++) {
    assertThat(cob.getUserDefinedWritability(i),is(true));
  }
  cob.setUserDefinedWritability(1,false);
  ch.runPendingTasks();
  assertThat(buf.toString(),is("false "));
  cob.setUserDefinedWritability(1,true);
  ch.runPendingTasks();
  assertThat(buf.toString(),is("false true "));
  safeClose(ch);
}
