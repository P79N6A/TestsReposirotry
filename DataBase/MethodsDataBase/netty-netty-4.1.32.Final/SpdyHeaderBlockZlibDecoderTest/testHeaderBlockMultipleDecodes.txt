@Test public void testHeaderBlockMultipleDecodes() throws Exception {
  ByteBuf headerBlock=Unpooled.buffer(37);
  headerBlock.writeBytes(zlibHeader);
  headerBlock.writeByte(0);
  headerBlock.writeByte(0x15);
  headerBlock.writeByte(0x00);
  headerBlock.writeByte(0xea);
  headerBlock.writeByte(0xff);
  headerBlock.writeInt(1);
  headerBlock.writeInt(4);
  headerBlock.writeBytes(nameBytes);
  headerBlock.writeInt(5);
  headerBlock.writeBytes(valueBytes);
  headerBlock.writeBytes(zlibSyncFlush);
  int readableBytes=headerBlock.readableBytes();
  for (int i=0; i < readableBytes; i++) {
    ByteBuf headerBlockSegment=headerBlock.slice(i,1);
    decoder.decode(ByteBufAllocator.DEFAULT,headerBlockSegment,frame);
    assertFalse(headerBlockSegment.isReadable());
  }
  decoder.endHeaderBlock(frame);
  assertFalse(frame.isInvalid());
  assertEquals(1,frame.headers().names().size());
  assertTrue(frame.headers().contains(name));
  assertEquals(1,frame.headers().getAll(name).size());
  assertEquals(value,frame.headers().get(name));
  headerBlock.release();
}
