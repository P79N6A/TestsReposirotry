@Test public void testSetBytesOnReadOnlyByteBuffer() throws Exception {
  byte[] testData={0,1,2,3,4,5,6,7,8,9};
  int length=testData.length;
  ByteBuffer readOnlyBuffer=ByteBuffer.wrap(testData).asReadOnlyBuffer();
  UnpooledByteBufAllocator alloc=new UnpooledByteBufAllocator(true);
  UnpooledDirectByteBuf targetBuffer=new UnpooledDirectByteBuf(alloc,length,length);
  try {
    UnsafeByteBufUtil.setBytes(targetBuffer,directBufferAddress(targetBuffer.nioBuffer()),0,readOnlyBuffer);
    byte[] check=new byte[length];
    targetBuffer.getBytes(0,check,0,length);
    assertArrayEquals("The byte array's copy does not equal the original",testData,check);
  }
  finally {
    targetBuffer.release();
  }
}
