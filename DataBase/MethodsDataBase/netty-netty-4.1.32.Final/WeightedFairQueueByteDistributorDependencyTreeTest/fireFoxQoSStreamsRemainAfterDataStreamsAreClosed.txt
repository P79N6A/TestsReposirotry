@Test public void fireFoxQoSStreamsRemainAfterDataStreamsAreClosed() throws Http2Exception {
  setup(5);
  setPriority(leadersId,connection.connectionStream().id(),leadersWeight,false);
  setPriority(unblockedId,connection.connectionStream().id(),unblockedWeight,false);
  setPriority(backgroundId,connection.connectionStream().id(),backgroundWeight,false);
  setPriority(speculativeId,backgroundId,speculativeWeight,false);
  setPriority(followersId,leadersId,followersWeight,false);
  verifyFireFoxQoSStreams();
  short htmlGetStreamWeight=2;
  Http2Stream htmlGetStream=connection.local().createStream(13,false);
  setPriority(htmlGetStream.id(),followersId,htmlGetStreamWeight,false);
  Http2Stream favIconStream=connection.local().createStream(15,false);
  setPriority(favIconStream.id(),connection.connectionStream().id(),DEFAULT_PRIORITY_WEIGHT,false);
  Http2Stream cssStream=connection.local().createStream(17,false);
  setPriority(cssStream.id(),leadersId,DEFAULT_PRIORITY_WEIGHT,false);
  Http2Stream jsStream=connection.local().createStream(19,false);
  setPriority(jsStream.id(),leadersId,DEFAULT_PRIORITY_WEIGHT,false);
  Http2Stream imageStream=connection.local().createStream(21,false);
  setPriority(imageStream.id(),followersId,1,false);
  assertEquals(4,distributor.numChildren(connection.connectionStream().id()));
  assertTrue(distributor.isChild(leadersId,connection.connectionStream().id(),leadersWeight));
  assertEquals(3,distributor.numChildren(leadersId));
  assertTrue(distributor.isChild(unblockedId,connection.connectionStream().id(),unblockedWeight));
  assertEquals(0,distributor.numChildren(unblockedId));
  assertTrue(distributor.isChild(backgroundId,connection.connectionStream().id(),backgroundWeight));
  assertEquals(1,distributor.numChildren(backgroundId));
  assertTrue(distributor.isChild(favIconStream.id(),connection.connectionStream().id(),DEFAULT_PRIORITY_WEIGHT));
  assertEquals(0,distributor.numChildren(favIconStream.id()));
  assertTrue(distributor.isChild(followersId,leadersId,followersWeight));
  assertEquals(2,distributor.numChildren(followersId));
  assertTrue(distributor.isChild(speculativeId,backgroundId,speculativeWeight));
  assertEquals(0,distributor.numChildren(speculativeId));
  assertTrue(distributor.isChild(cssStream.id(),leadersId,DEFAULT_PRIORITY_WEIGHT));
  assertEquals(0,distributor.numChildren(cssStream.id()));
  assertTrue(distributor.isChild(jsStream.id(),leadersId,DEFAULT_PRIORITY_WEIGHT));
  assertEquals(0,distributor.numChildren(jsStream.id()));
  assertTrue(distributor.isChild(htmlGetStream.id(),followersId,htmlGetStreamWeight));
  assertEquals(0,distributor.numChildren(htmlGetStream.id()));
  assertTrue(distributor.isChild(imageStream.id(),followersId,followersWeight));
  assertEquals(0,distributor.numChildren(imageStream.id()));
  htmlGetStream.close();
  favIconStream.close();
  cssStream.close();
  jsStream.close();
  imageStream.close();
  verifyFireFoxQoSStreams();
}
