@Test(timeout=3000) public void testAddHandlerBeforeRegisteredThenReplace() throws Exception {
  final EventLoop loop=group.next();
  final CountDownLatch latch=new CountDownLatch(1);
  CheckEventExecutorHandler handler=new CheckEventExecutorHandler(loop);
  ChannelPipeline pipeline=new LocalChannel().pipeline();
  pipeline.addFirst(handler);
  assertFalse(handler.addedPromise.isDone());
  group.register(pipeline.channel());
  handler.addedPromise.syncUninterruptibly();
  pipeline.replace(handler,null,new ChannelHandlerAdapter(){
    @Override public void handlerAdded(    ChannelHandlerContext ctx) throws Exception {
      latch.countDown();
    }
  }
);
  handler.removedPromise.syncUninterruptibly();
  latch.await();
}
