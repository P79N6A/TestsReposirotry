@Test public void testCancelWrite() throws Exception {
  ChannelPipeline pipeline=new LocalChannel().pipeline();
  group.register(pipeline.channel());
  ChannelPromise promise=pipeline.channel().newPromise();
  assertTrue(promise.cancel(false));
  ByteBuf buffer=Unpooled.buffer();
  assertEquals(1,buffer.refCnt());
  ChannelFuture future=pipeline.write(buffer,promise);
  assertTrue(future.isCancelled());
  assertEquals(0,buffer.refCnt());
}
