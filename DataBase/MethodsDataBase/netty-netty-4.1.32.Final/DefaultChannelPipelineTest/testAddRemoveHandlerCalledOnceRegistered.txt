@Test(timeout=2000) public void testAddRemoveHandlerCalledOnceRegistered() throws Throwable {
  ChannelPipeline pipeline=new LocalChannel().pipeline();
  CallbackCheckHandler handler=new CallbackCheckHandler();
  pipeline.addFirst(handler);
  pipeline.remove(handler);
  assertNull(handler.addedHandler.getNow());
  assertNull(handler.removedHandler.getNow());
  group.register(pipeline.channel()).syncUninterruptibly();
  Throwable cause=handler.error.get();
  if (cause != null) {
    throw cause;
  }
  assertTrue(handler.addedHandler.get());
  assertTrue(handler.removedHandler.get());
}
