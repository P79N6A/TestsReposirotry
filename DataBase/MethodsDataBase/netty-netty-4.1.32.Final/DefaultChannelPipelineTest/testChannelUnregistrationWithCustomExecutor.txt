@Test public void testChannelUnregistrationWithCustomExecutor() throws Exception {
  final CountDownLatch channelLatch=new CountDownLatch(1);
  final CountDownLatch handlerLatch=new CountDownLatch(1);
  ChannelPipeline pipeline=new LocalChannel().pipeline();
  pipeline.addLast(new ChannelInitializer<Channel>(){
    @Override protected void initChannel(    Channel ch) throws Exception {
      ch.pipeline().addLast(new WrapperExecutor(),new ChannelInboundHandlerAdapter(){
        @Override public void channelUnregistered(        ChannelHandlerContext ctx) throws Exception {
          channelLatch.countDown();
        }
        @Override public void handlerRemoved(        ChannelHandlerContext ctx) throws Exception {
          handlerLatch.countDown();
        }
      }
);
    }
  }
);
  Channel channel=pipeline.channel();
  group.register(channel);
  channel.close();
  channel.deregister();
  assertTrue(channelLatch.await(2,TimeUnit.SECONDS));
  assertTrue(handlerLatch.await(2,TimeUnit.SECONDS));
}
