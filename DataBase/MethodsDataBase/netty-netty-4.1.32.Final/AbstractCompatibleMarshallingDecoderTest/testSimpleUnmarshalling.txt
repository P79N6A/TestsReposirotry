@Test public void testSimpleUnmarshalling() throws IOException {
  MarshallerFactory marshallerFactory=createMarshallerFactory();
  MarshallingConfiguration configuration=createMarshallingConfig();
  EmbeddedChannel ch=new EmbeddedChannel(createDecoder(Integer.MAX_VALUE));
  ByteArrayOutputStream bout=new ByteArrayOutputStream();
  Marshaller marshaller=marshallerFactory.createMarshaller(configuration);
  marshaller.start(Marshalling.createByteOutput(bout));
  marshaller.writeObject(testObject);
  marshaller.finish();
  marshaller.close();
  byte[] testBytes=bout.toByteArray();
  ch.writeInbound(input(testBytes));
  assertTrue(ch.finish());
  String unmarshalled=ch.readInbound();
  assertEquals(testObject,unmarshalled);
  assertNull(ch.readInbound());
}
