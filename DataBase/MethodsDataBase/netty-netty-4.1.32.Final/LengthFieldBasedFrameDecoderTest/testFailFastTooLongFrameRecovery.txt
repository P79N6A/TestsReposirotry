@Test public void testFailFastTooLongFrameRecovery() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new LengthFieldBasedFrameDecoder(5,0,4,0,4));
  for (int i=0; i < 2; i++) {
    try {
      assertTrue(ch.writeInbound(Unpooled.wrappedBuffer(new byte[]{0,0,0,2})));
      fail(DecoderException.class.getSimpleName() + " must be raised.");
    }
 catch (    TooLongFrameException e) {
    }
    ch.writeInbound(Unpooled.wrappedBuffer(new byte[]{0,0,0,0,0,1,'A'}));
    ByteBuf buf=ch.readInbound();
    assertEquals("A",buf.toString(CharsetUtil.ISO_8859_1));
    buf.release();
  }
}
