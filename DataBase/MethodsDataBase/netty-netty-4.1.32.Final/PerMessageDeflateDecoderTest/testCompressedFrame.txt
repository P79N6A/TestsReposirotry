@Test public void testCompressedFrame(){
  EmbeddedChannel encoderChannel=new EmbeddedChannel(ZlibCodecFactory.newZlibEncoder(ZlibWrapper.NONE,9,15,8));
  EmbeddedChannel decoderChannel=new EmbeddedChannel(new PerMessageDeflateDecoder(false));
  byte[] payload=new byte[300];
  random.nextBytes(payload);
  encoderChannel.writeOutbound(Unpooled.wrappedBuffer(payload));
  ByteBuf compressedPayload=encoderChannel.readOutbound();
  BinaryWebSocketFrame compressedFrame=new BinaryWebSocketFrame(true,WebSocketExtension.RSV1 | WebSocketExtension.RSV3,compressedPayload.slice(0,compressedPayload.readableBytes() - 4));
  decoderChannel.writeInbound(compressedFrame);
  BinaryWebSocketFrame uncompressedFrame=decoderChannel.readInbound();
  assertNotNull(uncompressedFrame);
  assertNotNull(uncompressedFrame.content());
  assertTrue(uncompressedFrame instanceof BinaryWebSocketFrame);
  assertEquals(WebSocketExtension.RSV3,uncompressedFrame.rsv());
  assertEquals(300,uncompressedFrame.content().readableBytes());
  byte[] finalPayload=new byte[300];
  uncompressedFrame.content().readBytes(finalPayload);
  assertTrue(Arrays.equals(finalPayload,payload));
  uncompressedFrame.release();
}
