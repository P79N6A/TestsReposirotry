@SuppressWarnings("unchecked") @Test public void testUsedDirectMemory(){
  T allocator=newAllocator(true);
  ByteBufAllocatorMetric metric=((ByteBufAllocatorMetricProvider)allocator).metric();
  assertEquals(0,metric.usedDirectMemory());
  ByteBuf buffer=allocator.directBuffer(1024,4096);
  int capacity=buffer.capacity();
  assertEquals(expectedUsedMemory(allocator,capacity),metric.usedDirectMemory());
  buffer.capacity(capacity << 1);
  capacity=buffer.capacity();
  assertEquals(buffer.toString(),expectedUsedMemory(allocator,capacity),metric.usedDirectMemory());
  buffer.release();
  assertEquals(expectedUsedMemoryAfterRelease(allocator,capacity),metric.usedDirectMemory());
}
