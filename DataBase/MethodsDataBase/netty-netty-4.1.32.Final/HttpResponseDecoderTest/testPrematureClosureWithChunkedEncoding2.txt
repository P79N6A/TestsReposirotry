@Test public void testPrematureClosureWithChunkedEncoding2() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new HttpResponseDecoder());
  ch.writeInbound(Unpooled.copiedBuffer("HTTP/1.1 200 OK\r\nTransfer-Encoding: chunked\r\n\r\n8\r\n12345678",CharsetUtil.US_ASCII));
  HttpResponse res=ch.readInbound();
  assertThat(res.protocolVersion(),sameInstance(HttpVersion.HTTP_1_1));
  assertThat(res.status(),is(HttpResponseStatus.OK));
  assertThat(res.headers().get(HttpHeaderNames.TRANSFER_ENCODING),is("chunked"));
  HttpContent content=ch.readInbound();
  assertThat(content.content().toString(CharsetUtil.US_ASCII),is("12345678"));
  assertThat(content,is(not(instanceOf(LastHttpContent.class))));
  content.release();
  assertThat(ch.readInbound(),is(nullValue()));
  ch.finish();
  assertThat(ch.readInbound(),is(nullValue()));
}
