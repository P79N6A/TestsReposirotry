/** 
 * Complementary test case of  {@link #testMaxHeaderSize1()} When it actually exceeds the maximum, it should fail.
 */
@Test public void testMaxHeaderSize2(){
  final int maxHeaderSize=8192;
  final EmbeddedChannel ch=new EmbeddedChannel(new HttpResponseDecoder(4096,maxHeaderSize,8192));
  final char[] bytes=new char[maxHeaderSize / 2 - 2];
  Arrays.fill(bytes,'a');
  ch.writeInbound(Unpooled.copiedBuffer("HTTP/1.1 200 OK\r\n",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("A:",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer(bytes,CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  assertNull(ch.readInbound());
  ch.writeInbound(Unpooled.copiedBuffer("B: ",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer(bytes,CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  HttpResponse res=ch.readInbound();
  assertTrue(res.decoderResult().cause() instanceof TooLongFrameException);
  assertFalse(ch.finish());
  assertNull(ch.readInbound());
}
