/** 
 * The size of headers should be calculated correctly even if a single header is split into multiple fragments.
 * @see <a href="https://github.com/netty/netty/issues/3445">#3445</a>
 */
@Test public void testMaxHeaderSize1(){
  final int maxHeaderSize=8192;
  final EmbeddedChannel ch=new EmbeddedChannel(new HttpResponseDecoder(4096,maxHeaderSize,8192));
  final char[] bytes=new char[maxHeaderSize / 2 - 2];
  Arrays.fill(bytes,'a');
  ch.writeInbound(Unpooled.copiedBuffer("HTTP/1.1 200 OK\r\n",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("A:",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer(bytes,CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  assertNull(ch.readInbound());
  ch.writeInbound(Unpooled.copiedBuffer("B:",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer(bytes,CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  ch.writeInbound(Unpooled.copiedBuffer("\r\n",CharsetUtil.US_ASCII));
  HttpResponse res=ch.readInbound();
  assertNull(res.decoderResult().cause());
  assertTrue(res.decoderResult().isSuccess());
  assertNull(ch.readInbound());
  assertTrue(ch.finish());
  assertThat(ch.readInbound(),instanceOf(LastHttpContent.class));
}
