@Test public void testResponseWithContentLength(){
  EmbeddedChannel ch=new EmbeddedChannel(new HttpResponseDecoder());
  ch.writeInbound(Unpooled.copiedBuffer("HTTP/1.1 200 OK\r\n" + "Content-Length: 10\r\n" + "\r\n",CharsetUtil.US_ASCII));
  byte[] data=new byte[10];
  for (int i=0; i < data.length; i++) {
    data[i]=(byte)i;
  }
  ch.writeInbound(Unpooled.wrappedBuffer(data,0,data.length / 2));
  ch.writeInbound(Unpooled.wrappedBuffer(data,5,data.length / 2));
  HttpResponse res=ch.readInbound();
  assertThat(res.protocolVersion(),sameInstance(HttpVersion.HTTP_1_1));
  assertThat(res.status(),is(HttpResponseStatus.OK));
  HttpContent firstContent=ch.readInbound();
  assertThat(firstContent.content().readableBytes(),is(5));
  assertEquals(Unpooled.wrappedBuffer(data,0,5),firstContent.content());
  firstContent.release();
  LastHttpContent lastContent=ch.readInbound();
  assertEquals(5,lastContent.content().readableBytes());
  assertEquals(Unpooled.wrappedBuffer(data,5,5),lastContent.content());
  lastContent.release();
  assertThat(ch.finish(),is(false));
  assertThat(ch.readInbound(),is(nullValue()));
}
