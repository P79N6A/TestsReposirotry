/** 
 * Tests if the decoder produces one and only  {@link LastHttpContent} when an invalid chunk is received andthe connection is closed.
 */
@Test public void testGarbageChunk(){
  EmbeddedChannel channel=new EmbeddedChannel(new HttpResponseDecoder());
  String responseWithIllegalChunk="HTTP/1.1 200 OK\r\n" + "Transfer-Encoding: chunked\r\n\r\n" + "NOT_A_CHUNK_LENGTH\r\n";
  channel.writeInbound(Unpooled.copiedBuffer(responseWithIllegalChunk,CharsetUtil.US_ASCII));
  assertThat(channel.readInbound(),is(instanceOf(HttpResponse.class)));
  LastHttpContent invalidChunk=channel.readInbound();
  assertThat(invalidChunk.decoderResult().isFailure(),is(true));
  invalidChunk.release();
  assertThat(channel.readInbound(),is(nullValue()));
  assertThat(channel.finish(),is(false));
}
