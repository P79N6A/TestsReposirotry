@Test public void testFailSlowTooLongFrameRecovery() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new DelimiterBasedFrameDecoder(1,true,false,Delimiters.nulDelimiter()));
  for (int i=0; i < 2; i++) {
    ch.writeInbound(Unpooled.wrappedBuffer(new byte[]{1,2}));
    try {
      assertTrue(ch.writeInbound(Unpooled.wrappedBuffer(new byte[]{0})));
      fail(DecoderException.class.getSimpleName() + " must be raised.");
    }
 catch (    TooLongFrameException e) {
    }
    ch.writeInbound(Unpooled.wrappedBuffer(new byte[]{'A',0}));
    ByteBuf buf=ch.readInbound();
    assertEquals("A",buf.toString(CharsetUtil.ISO_8859_1));
    buf.release();
  }
}
