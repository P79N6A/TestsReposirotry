@Test public void testReplaceAggregatedRequest(){
  EmbeddedChannel embedder=new EmbeddedChannel(new HttpObjectAggregator(1024 * 1024));
  Exception boom=new Exception("boom");
  HttpRequest req=new DefaultHttpRequest(HttpVersion.HTTP_1_1,HttpMethod.GET,"http://localhost");
  req.setDecoderResult(DecoderResult.failure(boom));
  assertTrue(embedder.writeInbound(req) && embedder.finish());
  FullHttpRequest aggregatedReq=embedder.readInbound();
  FullHttpRequest replacedReq=aggregatedReq.replace(Unpooled.EMPTY_BUFFER);
  assertEquals(replacedReq.decoderResult(),aggregatedReq.decoderResult());
  aggregatedReq.release();
  replacedReq.release();
}
