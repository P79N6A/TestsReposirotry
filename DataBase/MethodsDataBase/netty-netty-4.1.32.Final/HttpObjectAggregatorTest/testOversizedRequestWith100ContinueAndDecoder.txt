@Test public void testOversizedRequestWith100ContinueAndDecoder(){
  EmbeddedChannel embedder=new EmbeddedChannel(new HttpRequestDecoder(),new HttpObjectAggregator(4));
  embedder.writeInbound(Unpooled.copiedBuffer("PUT /upload HTTP/1.1\r\n" + "Expect: 100-continue\r\n" + "Content-Length: 100\r\n\r\n",CharsetUtil.US_ASCII));
  assertNull(embedder.readInbound());
  FullHttpResponse response=embedder.readOutbound();
  assertEquals(HttpResponseStatus.REQUEST_ENTITY_TOO_LARGE,response.status());
  assertEquals("0",response.headers().get(HttpHeaderNames.CONTENT_LENGTH));
  assertTrue(embedder.isOpen());
  embedder.writeInbound(Unpooled.copiedBuffer("GET /max-upload-size HTTP/1.1\r\n\r\n",CharsetUtil.US_ASCII));
  FullHttpRequest request=embedder.readInbound();
  assertThat(request.method(),is(HttpMethod.GET));
  assertThat(request.uri(),is("/max-upload-size"));
  assertThat(request.content().readableBytes(),is(0));
  request.release();
  assertFalse(embedder.finish());
}
