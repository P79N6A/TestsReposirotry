@Test public void testResponseDecompression(){
  HttpResponseDecoder decoder=new HttpResponseDecoder();
  HttpContentDecoder decompressor=new HttpContentDecompressor();
  HttpObjectAggregator aggregator=new HttpObjectAggregator(1024);
  EmbeddedChannel channel=new EmbeddedChannel(decoder,decompressor,aggregator);
  String headers="HTTP/1.1 200 OK\r\n" + "Content-Length: " + GZ_HELLO_WORLD.length + "\r\n"+ "Content-Encoding: gzip\r\n"+ "\r\n";
  ByteBuf buf=Unpooled.copiedBuffer(headers.getBytes(CharsetUtil.US_ASCII),GZ_HELLO_WORLD);
  assertTrue(channel.writeInbound(buf));
  Object o=channel.readInbound();
  assertThat(o,is(instanceOf(FullHttpResponse.class)));
  FullHttpResponse resp=(FullHttpResponse)o;
  assertEquals(HELLO_WORLD.length(),resp.headers().getInt(HttpHeaderNames.CONTENT_LENGTH).intValue());
  assertEquals(HELLO_WORLD,resp.content().toString(CharsetUtil.US_ASCII));
  resp.release();
  assertHasInboundMessages(channel,false);
  assertHasOutboundMessages(channel,false);
  assertFalse(channel.finish());
}
