@Test public void testFullHttpResponse(){
  HttpResponseDecoder decoder=new HttpResponseDecoder(4096,4096,5);
  HttpObjectAggregator aggregator=new HttpObjectAggregator(1024);
  HttpContentDecoder decompressor=new HttpContentDecompressor();
  EmbeddedChannel channel=new EmbeddedChannel(decoder,aggregator,decompressor);
  String headers="HTTP/1.1 200 OK\r\n" + "Content-Length: " + GZ_HELLO_WORLD.length + "\r\n"+ "Content-Encoding: gzip\r\n"+ "\r\n";
  assertTrue(channel.writeInbound(Unpooled.copiedBuffer(headers.getBytes(),GZ_HELLO_WORLD)));
  Queue<Object> resp=channel.inboundMessages();
  assertTrue(resp.size() > 1);
  int contentLength=0;
  contentLength=calculateContentLength(resp,contentLength);
  byte[] receivedContent=readContent(resp,contentLength,true);
  assertEquals(HELLO_WORLD,new String(receivedContent,CharsetUtil.US_ASCII));
  assertHasInboundMessages(channel,true);
  assertHasOutboundMessages(channel,false);
  assertFalse(channel.finish());
}
