@Test public void testFlushViaDisconnect(){
  final AtomicInteger flushCount=new AtomicInteger();
  EmbeddedChannel channel=newChannel(flushCount,false);
  channel.pipeline().fireChannelRead(1L);
  assertEquals(0,flushCount.get());
  assertNull(channel.readOutbound());
  channel.disconnect();
  assertEquals(1,flushCount.get());
  assertEquals(1L,channel.readOutbound());
  assertNull(channel.readOutbound());
  assertFalse(channel.finish());
}
