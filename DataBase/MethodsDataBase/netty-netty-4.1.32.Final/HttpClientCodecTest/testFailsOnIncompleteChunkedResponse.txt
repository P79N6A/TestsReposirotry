@Test public void testFailsOnIncompleteChunkedResponse(){
  HttpClientCodec codec=new HttpClientCodec(4096,8192,8192,true);
  EmbeddedChannel ch=new EmbeddedChannel(codec);
  ch.writeOutbound(new DefaultFullHttpRequest(HttpVersion.HTTP_1_1,HttpMethod.GET,"http://localhost/"));
  ByteBuf buffer=ch.readOutbound();
  assertNotNull(buffer);
  buffer.release();
  assertNull(ch.readInbound());
  ch.writeInbound(Unpooled.copiedBuffer(INCOMPLETE_CHUNKED_RESPONSE,CharsetUtil.ISO_8859_1));
  assertThat(ch.readInbound(),instanceOf(HttpResponse.class));
  ((HttpContent)ch.readInbound()).release();
  ((HttpContent)ch.readInbound()).release();
  assertNull(ch.readInbound());
  try {
    ch.finish();
    fail();
  }
 catch (  CodecException e) {
    assertTrue(e instanceof PrematureChannelClosureException);
  }
}
