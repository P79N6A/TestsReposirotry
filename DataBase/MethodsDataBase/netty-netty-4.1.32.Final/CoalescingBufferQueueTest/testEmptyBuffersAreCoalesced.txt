@Test public void testEmptyBuffersAreCoalesced(){
  ByteBuf empty=Unpooled.buffer(0,1);
  assertQueueSize(0,true);
  writeQueue.add(cat,catPromise);
  writeQueue.add(empty,emptyPromise);
  assertQueueSize(3,false);
  ChannelPromise aggregatePromise=newPromise();
  assertEquals("cat",dequeue(3,aggregatePromise));
  assertQueueSize(0,true);
  assertFalse(catPromise.isSuccess());
  assertFalse(emptyPromise.isSuccess());
  aggregatePromise.setSuccess();
  assertTrue(catPromise.isSuccess());
  assertTrue(emptyPromise.isSuccess());
  assertEquals(0,cat.refCnt());
  assertEquals(0,empty.refCnt());
}
