@Test public void testAggregateWithFullRead(){
  writeQueue.add(cat,catPromise);
  assertQueueSize(3,false);
  writeQueue.add(mouse,mouseListener);
  assertQueueSize(8,false);
  ChannelPromise aggregatePromise=newPromise();
  assertEquals("catmouse",dequeue(8,aggregatePromise));
  assertQueueSize(0,true);
  assertFalse(catPromise.isSuccess());
  assertFalse(mouseDone);
  aggregatePromise.setSuccess();
  assertTrue(catPromise.isSuccess());
  assertTrue(mouseSuccess);
  assertEquals(0,cat.refCnt());
  assertEquals(0,mouse.refCnt());
}
