@Test public void testAggregateWithPartialRead(){
  writeQueue.add(cat,catPromise);
  writeQueue.add(mouse,mouseListener);
  ChannelPromise aggregatePromise=newPromise();
  assertEquals("catm",dequeue(4,aggregatePromise));
  assertQueueSize(4,false);
  assertFalse(catPromise.isSuccess());
  assertFalse(mouseDone);
  aggregatePromise.setSuccess();
  assertTrue(catPromise.isSuccess());
  assertFalse(mouseDone);
  aggregatePromise=newPromise();
  assertEquals("ouse",dequeue(Integer.MAX_VALUE,aggregatePromise));
  assertQueueSize(0,true);
  assertFalse(mouseDone);
  aggregatePromise.setSuccess();
  assertTrue(mouseSuccess);
  assertEquals(0,cat.refCnt());
  assertEquals(0,mouse.refCnt());
}
