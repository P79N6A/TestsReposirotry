@Test public void testBadChunk() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new HttpRequestDecoder());
  ch.writeInbound(Unpooled.copiedBuffer("GET / HTTP/1.0\r\n",CharsetUtil.UTF_8));
  ch.writeInbound(Unpooled.copiedBuffer("Transfer-Encoding: chunked\r\n\r\n",CharsetUtil.UTF_8));
  ch.writeInbound(Unpooled.copiedBuffer("BAD_LENGTH\r\n",CharsetUtil.UTF_8));
  HttpRequest req=ch.readInbound();
  assertTrue(req.decoderResult().isSuccess());
  LastHttpContent chunk=ch.readInbound();
  DecoderResult dr=chunk.decoderResult();
  assertFalse(dr.isSuccess());
  assertTrue(dr.isFailure());
  ensureInboundTrafficDiscarded(ch);
}
