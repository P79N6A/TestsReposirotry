@SuppressWarnings("unchecked") @Test public void testSuccessfulPending() throws Exception {
  Promise<Void> p=mock(Promise.class);
  PromiseAggregator<Void,Future<Void>> a=new PromiseAggregator<Void,Future<Void>>(p);
  Promise<Void> p1=mock(Promise.class);
  Promise<Void> p2=mock(Promise.class);
  when(p1.addListener(a)).thenReturn(p1);
  when(p2.addListener(a)).thenReturn(p2);
  when(p1.isSuccess()).thenReturn(true);
  when(p2.isSuccess()).thenReturn(true);
  when(p.setSuccess(null)).thenReturn(p);
  assertThat(a.add(p1,null,p2),is(a));
  a.operationComplete(p1);
  a.operationComplete(p2);
  verify(p1).addListener(a);
  verify(p2).addListener(a);
  verify(p1).isSuccess();
  verify(p2).isSuccess();
  verify(p).setSuccess(null);
}
