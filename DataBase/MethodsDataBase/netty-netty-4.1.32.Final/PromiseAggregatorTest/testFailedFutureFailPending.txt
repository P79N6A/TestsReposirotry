@SuppressWarnings("unchecked") @Test public void testFailedFutureFailPending() throws Exception {
  Promise<Void> p=mock(Promise.class);
  PromiseAggregator<Void,Future<Void>> a=new PromiseAggregator<Void,Future<Void>>(p);
  Promise<Void> p1=mock(Promise.class);
  Promise<Void> p2=mock(Promise.class);
  Throwable t=mock(Throwable.class);
  when(p1.addListener(a)).thenReturn(p1);
  when(p2.addListener(a)).thenReturn(p2);
  when(p1.isSuccess()).thenReturn(false);
  when(p1.cause()).thenReturn(t);
  when(p.setFailure(t)).thenReturn(p);
  when(p2.setFailure(t)).thenReturn(p2);
  a.add(p1,p2);
  a.operationComplete(p1);
  verify(p1).addListener(a);
  verify(p2).addListener(a);
  verify(p1).cause();
  verify(p).setFailure(t);
  verify(p2).setFailure(t);
}
