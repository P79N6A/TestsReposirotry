@Test public void testResolveACachedWithDotSearchDomain() throws Exception {
  final TestDnsCache cache=new TestDnsCache(new DefaultDnsCache());
  TestDnsServer server=new TestDnsServer(Collections.singleton("test.netty.io"));
  server.start();
  DnsNameResolver resolver=newResolver(ResolvedAddressTypes.IPV4_ONLY).searchDomains(Collections.singletonList("netty.io")).nameServerProvider(new SingletonDnsServerAddressStreamProvider(server.localAddress())).resolveCache(cache).build();
  try {
    resolver.resolve("test").syncUninterruptibly();
    assertNull(cache.cacheHits.get("test.netty.io"));
    List<? extends DnsCacheEntry> cached=cache.cache.get("test.netty.io",null);
    List<? extends DnsCacheEntry> cached2=cache.cache.get("test.netty.io.",null);
    assertEquals(1,cached.size());
    assertSame(cached,cached2);
    resolver.resolve("test").syncUninterruptibly();
    List<? extends DnsCacheEntry> entries=cache.cacheHits.get("test.netty.io");
    assertFalse(entries.isEmpty());
  }
  finally {
    resolver.close();
    server.stop();
  }
}
