@Test public void shouldCleanupSegmentsThatHaveExpired(){
  final Segment segment1=segments.getOrCreateSegmentIfLive(0,context);
  final Segment segment2=segments.getOrCreateSegmentIfLive(1,context);
  context.setStreamTime(SEGMENT_INTERVAL * 7);
  final Segment segment3=segments.getOrCreateSegmentIfLive(7,context);
  assertFalse(segment1.isOpen());
  assertFalse(segment2.isOpen());
  assertTrue(segment3.isOpen());
  assertFalse(new File(context.stateDir(),"test/test.0").exists());
  assertFalse(new File(context.stateDir(),"test/test." + SEGMENT_INTERVAL).exists());
  assertTrue(new File(context.stateDir(),"test/test." + 7 * SEGMENT_INTERVAL).exists());
}
