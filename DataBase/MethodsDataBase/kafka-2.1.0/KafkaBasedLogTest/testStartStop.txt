@Test public void testStartStop() throws Exception {
  expectStart();
  expectStop();
  PowerMock.replayAll();
  Map<TopicPartition,Long> endOffsets=new HashMap<>();
  endOffsets.put(TP0,0L);
  endOffsets.put(TP1,0L);
  consumer.updateEndOffsets(endOffsets);
  store.start();
  assertEquals(CONSUMER_ASSIGNMENT,consumer.assignment());
  store.stop();
  assertFalse(Whitebox.<Thread>getInternalState(store,"thread").isAlive());
  assertTrue(consumer.closed());
  PowerMock.verifyAll();
}
