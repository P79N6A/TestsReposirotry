@Test public void shouldForwardChangedValuesDuringFlush(){
  final Windowed<Bytes> a=new Windowed<>(keyA,new SessionWindow(0,0));
  final Windowed<String> aDeserialized=new Windowed<>("a",new SessionWindow(0,0));
  final List<KeyValue<Windowed<String>,Change<String>>> flushed=new ArrayList<>();
  cachingStore.setFlushListener((key,newValue,oldValue) -> flushed.add(KeyValue.pair(key,new Change<>(newValue,oldValue))),true);
  cachingStore.put(a,"1".getBytes());
  cachingStore.flush();
  cachingStore.put(a,"2".getBytes());
  cachingStore.flush();
  cachingStore.remove(a);
  cachingStore.flush();
  assertEquals(flushed,Arrays.asList(KeyValue.pair(aDeserialized,new Change<>("1",null)),KeyValue.pair(aDeserialized,new Change<>("2","1")),KeyValue.pair(aDeserialized,new Change<>(null,"2"))));
}
