@Test public void shouldSendDataToDynamicTopics(){
  final StreamsBuilder builder=new StreamsBuilder();
  final String input="topic";
  final KStream<String,String> stream=builder.stream(input,stringConsumed);
  stream.to((key,value,context) -> context.topic() + "-" + key+ "-"+ value.substring(0,1),Produced.with(Serdes.String(),Serdes.String()));
  builder.stream(input + "-a-v",stringConsumed).process(processorSupplier);
  builder.stream(input + "-b-v",stringConsumed).process(processorSupplier);
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    driver.pipeInput(recordFactory.create(input,"a","v1"));
    driver.pipeInput(recordFactory.create(input,"a","v2"));
    driver.pipeInput(recordFactory.create(input,"b","v1"));
  }
   final List<MockProcessor<String,String>> mockProcessors=processorSupplier.capturedProcessors(2);
  assertThat(mockProcessors.get(0).processed,equalTo(Utils.mkList("a:v1","a:v2")));
  assertThat(mockProcessors.get(1).processed,equalTo(Collections.singletonList("b:v1")));
}
