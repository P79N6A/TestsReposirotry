@SuppressWarnings("unchecked") @Test public void shouldAggregateAndMaterializeResults(){
  final KTable<String,String> table=builder.table(topic,Consumed.with(Serdes.String(),Serdes.String()));
  table.groupBy(MockMapper.<String,String>selectValueKeyValueMapper(),Serialized.with(Serdes.String(),Serdes.String())).aggregate(MockInitializer.STRING_INIT,MockAggregator.TOSTRING_ADDER,MockAggregator.TOSTRING_REMOVER,Materialized.<String,String,KeyValueStore<Bytes,byte[]>>as("aggregate").withValueSerde(Serdes.String()).withKeySerde(Serdes.String()));
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    processData(topic,driver);
    final KeyValueStore<String,String> aggregate=driver.getKeyValueStore("aggregate");
    assertThat(aggregate.get("1"),equalTo("0+1+1+1"));
    assertThat(aggregate.get("2"),equalTo("0+2+2"));
  }
 }
