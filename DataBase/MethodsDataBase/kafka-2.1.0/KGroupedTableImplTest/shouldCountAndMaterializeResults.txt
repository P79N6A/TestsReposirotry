@SuppressWarnings("unchecked") @Test public void shouldCountAndMaterializeResults(){
  final KTable<String,String> table=builder.table(topic,Consumed.with(Serdes.String(),Serdes.String()));
  table.groupBy(MockMapper.<String,String>selectValueKeyValueMapper(),Serialized.with(Serdes.String(),Serdes.String())).count(Materialized.<String,Long,KeyValueStore<Bytes,byte[]>>as("count").withKeySerde(Serdes.String()).withValueSerde(Serdes.Long()));
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    processData(topic,driver);
    final KeyValueStore<String,Long> counts=driver.getKeyValueStore("count");
    assertThat(counts.get("1"),equalTo(3L));
    assertThat(counts.get("2"),equalTo(2L));
  }
 }
