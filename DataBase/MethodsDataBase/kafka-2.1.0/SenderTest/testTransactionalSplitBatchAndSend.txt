@Test public void testTransactionalSplitBatchAndSend() throws Exception {
  ProducerIdAndEpoch producerIdAndEpoch=new ProducerIdAndEpoch(123456L,(short)0);
  TopicPartition tp=new TopicPartition("testSplitBatchAndSend",1);
  TransactionManager txnManager=new TransactionManager(logContext,"testSplitBatchAndSend",60000,100);
  setupWithTransactionState(txnManager);
  doInitTransactions(txnManager,producerIdAndEpoch);
  txnManager.beginTransaction();
  txnManager.maybeAddPartitionToTransaction(tp);
  client.prepareResponse(new AddPartitionsToTxnResponse(0,Collections.singletonMap(tp,Errors.NONE)));
  sender.run(time.milliseconds());
  testSplitBatchAndSend(txnManager,producerIdAndEpoch,tp);
}
