@Test public void testExpiryOfUnsentBatchesShouldNotCauseUnresolvedSequences() throws Exception {
  final long producerId=343434L;
  TransactionManager transactionManager=new TransactionManager();
  setupWithTransactionState(transactionManager);
  prepareAndReceiveInitProducerId(producerId,Errors.NONE);
  assertTrue(transactionManager.hasProducerId());
  assertEquals(0,transactionManager.sequenceNumber(tp0).longValue());
  Future<RecordMetadata> request1=accumulator.append(tp0,0L,"key".getBytes(),"value".getBytes(),null,null,MAX_BLOCK_TIMEOUT).future;
  Node node=this.cluster.nodes().get(0);
  time.sleep(10000L);
  client.disconnect(node.idString());
  client.blackout(node,10);
  sender.run(time.milliseconds());
  assertFutureFailure(request1,TimeoutException.class);
  assertFalse(transactionManager.hasUnresolvedSequence(tp0));
}
