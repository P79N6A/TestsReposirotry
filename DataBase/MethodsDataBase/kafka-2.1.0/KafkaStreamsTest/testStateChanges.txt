@Test public void testStateChanges() throws InterruptedException {
  final StateListenerStub stateListener=new StateListenerStub();
  globalStreams.setStateListener(stateListener);
  Assert.assertEquals(globalStreams.state(),KafkaStreams.State.CREATED);
  Assert.assertEquals(stateListener.numChanges,0);
  globalStreams.start();
  TestUtils.waitForCondition(() -> globalStreams.state() == KafkaStreams.State.RUNNING,10 * 1000,"Streams never started.");
  globalStreams.close();
  Assert.assertEquals(globalStreams.state(),KafkaStreams.State.NOT_RUNNING);
}
