@Test public void shouldCleanupResourcesOnCloseWithoutPreviousStart() throws Exception {
  builder.globalTable("anyTopic");
  final List<Node> nodes=Arrays.asList(new Node(0,"localhost",8121));
  final Cluster cluster=new Cluster("mockClusterId",nodes,Collections.emptySet(),Collections.<String>emptySet(),Collections.emptySet(),nodes.get(0));
  final MockClientSupplier clientSupplier=new MockClientSupplier();
  clientSupplier.setClusterForAdminClient(cluster);
  final KafkaStreams streams=new KafkaStreams(builder.build(),props,clientSupplier);
  streams.close();
  TestUtils.waitForCondition(() -> streams.state() == KafkaStreams.State.NOT_RUNNING,10 * 1000,"Streams never stopped.");
  assertTrue(clientSupplier.consumer.closed());
  assertTrue(clientSupplier.restoreConsumer.closed());
  for (  final MockProducer p : clientSupplier.producers) {
    assertTrue(p.closed());
  }
}
