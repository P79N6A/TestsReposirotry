@Test public void shouldMapStateStoresToCorrectSourceTopics(){
  final KStream<String,String> playEvents=builder.stream(Collections.singleton("events"),consumed);
  final MaterializedInternal<String,String,KeyValueStore<Bytes,byte[]>> materializedInternal=new MaterializedInternal<>(Materialized.as("table-store"));
  materializedInternal.generateStoreNameIfNeeded(builder,storePrefix);
  final KTable<String,String> table=builder.table("table-topic",consumed,materializedInternal);
  final KStream<String,String> mapped=playEvents.map(MockMapper.<String,String>selectValueKeyValueMapper());
  mapped.leftJoin(table,MockValueJoiner.TOSTRING_JOINER).groupByKey().count(Materialized.as("count"));
  builder.buildAndOptimizeTopology();
  builder.internalTopologyBuilder.rewriteTopology(new StreamsConfig(StreamsTestUtils.getStreamsConfig(APP_ID)));
  assertEquals(Collections.singletonList("table-topic"),builder.internalTopologyBuilder.stateStoreNameToSourceTopics().get("table-store"));
  assertEquals(Collections.singletonList(APP_ID + "-KSTREAM-MAP-0000000003-repartition"),builder.internalTopologyBuilder.stateStoreNameToSourceTopics().get("count"));
}
