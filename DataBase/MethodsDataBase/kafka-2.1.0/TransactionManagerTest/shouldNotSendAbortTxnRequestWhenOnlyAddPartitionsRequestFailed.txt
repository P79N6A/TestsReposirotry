@Test public void shouldNotSendAbortTxnRequestWhenOnlyAddPartitionsRequestFailed(){
  final long pid=13131L;
  final short epoch=1;
  doInitTransactions(pid,epoch);
  transactionManager.beginTransaction();
  transactionManager.maybeAddPartitionToTransaction(tp0);
  prepareAddPartitionsToTxnResponse(Errors.TOPIC_AUTHORIZATION_FAILED,tp0,epoch,pid);
  sender.run(time.milliseconds());
  TransactionalRequestResult abortResult=transactionManager.beginAbort();
  assertFalse(abortResult.isCompleted());
  sender.run(time.milliseconds());
  assertTrue(abortResult.isCompleted());
  assertTrue(abortResult.isSuccessful());
}
