@Test public void testUnsupportedInitTransactions(){
  transactionManager.initializeTransactions();
  prepareFindCoordinatorResponse(Errors.NONE,false,CoordinatorType.TRANSACTION,transactionalId);
  sender.run(time.milliseconds());
  sender.run(time.milliseconds());
  assertFalse(transactionManager.hasError());
  assertNotNull(transactionManager.coordinator(CoordinatorType.TRANSACTION));
  client.prepareUnsupportedVersionResponse(new MockClient.RequestMatcher(){
    @Override public boolean matches(    AbstractRequest body){
      InitProducerIdRequest initProducerIdRequest=(InitProducerIdRequest)body;
      assertEquals(initProducerIdRequest.transactionalId(),transactionalId);
      assertEquals(initProducerIdRequest.transactionTimeoutMs(),transactionTimeoutMs);
      return true;
    }
  }
);
  sender.run(time.milliseconds());
  assertTrue(transactionManager.hasFatalError());
  assertTrue(transactionManager.lastError() instanceof UnsupportedVersionException);
}
