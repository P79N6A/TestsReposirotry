@Test public void testHasOngoingTransactionFatalError(){
  long pid=13131L;
  short epoch=1;
  TopicPartition partition=new TopicPartition("foo",0);
  assertFalse(transactionManager.hasOngoingTransaction());
  doInitTransactions(pid,epoch);
  assertFalse(transactionManager.hasOngoingTransaction());
  transactionManager.beginTransaction();
  assertTrue(transactionManager.hasOngoingTransaction());
  transactionManager.maybeAddPartitionToTransaction(partition);
  assertTrue(transactionManager.hasOngoingTransaction());
  prepareAddPartitionsToTxn(partition,Errors.NONE);
  sender.run(time.milliseconds());
  transactionManager.transitionToFatalError(new KafkaException());
  assertFalse(transactionManager.hasOngoingTransaction());
}
