@Test public void testTransactionalIdAuthorizationFailureInInitProducerId(){
  final long pid=13131L;
  TransactionalRequestResult initPidResult=transactionManager.initializeTransactions();
  prepareFindCoordinatorResponse(Errors.NONE,false,CoordinatorType.TRANSACTION,transactionalId);
  sender.run(time.milliseconds());
  sender.run(time.milliseconds());
  assertEquals(brokerNode,transactionManager.coordinator(CoordinatorType.TRANSACTION));
  prepareInitPidResponse(Errors.TRANSACTIONAL_ID_AUTHORIZATION_FAILED,false,pid,RecordBatch.NO_PRODUCER_EPOCH);
  sender.run(time.milliseconds());
  assertTrue(transactionManager.hasError());
  assertTrue(initPidResult.isCompleted());
  assertFalse(initPidResult.isSuccessful());
  assertTrue(initPidResult.error() instanceof TransactionalIdAuthorizationException);
  assertFatalError(TransactionalIdAuthorizationException.class);
}
