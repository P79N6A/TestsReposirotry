@Test public void testMaybeAddPartitionToTransaction(){
  long pid=13131L;
  short epoch=1;
  TopicPartition partition=new TopicPartition("foo",0);
  doInitTransactions(pid,epoch);
  transactionManager.beginTransaction();
  transactionManager.maybeAddPartitionToTransaction(partition);
  assertTrue(transactionManager.hasPartitionsToAdd());
  assertFalse(transactionManager.isPartitionAdded(partition));
  assertTrue(transactionManager.isPartitionPendingAdd(partition));
  prepareAddPartitionsToTxn(partition,Errors.NONE);
  sender.run(time.milliseconds());
  assertFalse(transactionManager.hasPartitionsToAdd());
  assertTrue(transactionManager.isPartitionAdded(partition));
  assertFalse(transactionManager.isPartitionPendingAdd(partition));
  transactionManager.maybeAddPartitionToTransaction(partition);
  assertFalse(transactionManager.hasPartitionsToAdd());
  assertTrue(transactionManager.isPartitionAdded(partition));
  assertFalse(transactionManager.isPartitionPendingAdd(partition));
}
