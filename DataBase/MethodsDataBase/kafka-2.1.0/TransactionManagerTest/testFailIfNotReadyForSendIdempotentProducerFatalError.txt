@Test(expected=KafkaException.class) public void testFailIfNotReadyForSendIdempotentProducerFatalError(){
  TransactionManager idempotentTransactionManager=new TransactionManager();
  idempotentTransactionManager.transitionToFatalError(new KafkaException());
  idempotentTransactionManager.failIfNotReadyForSend();
}
