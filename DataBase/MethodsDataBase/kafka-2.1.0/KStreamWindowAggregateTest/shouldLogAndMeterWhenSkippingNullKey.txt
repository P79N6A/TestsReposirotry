@Test public void shouldLogAndMeterWhenSkippingNullKey(){
  final StreamsBuilder builder=new StreamsBuilder();
  final String topic="topic";
  builder.stream(topic,Consumed.with(Serdes.String(),Serdes.String())).groupByKey(Grouped.with(Serdes.String(),Serdes.String())).windowedBy(TimeWindows.of(ofMillis(10)).advanceBy(ofMillis(5))).aggregate(MockInitializer.STRING_INIT,MockAggregator.toStringInstance("+"),Materialized.<String,String,WindowStore<Bytes,byte[]>>as("topic1-Canonicalized").withValueSerde(Serdes.String()));
  final LogCaptureAppender appender=LogCaptureAppender.createAndRegister();
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props,0L)){
    driver.pipeInput(recordFactory.create(topic,null,"1"));
    LogCaptureAppender.unregister(appender);
    assertEquals(1.0,getMetricByName(driver.metrics(),"skipped-records-total","stream-metrics").metricValue());
    assertThat(appender.getMessages(),hasItem("Skipping record due to null key. value=[1] topic=[topic] partition=[0] offset=[0]"));
  }
 }
