@Test public void testPrincipalBuilderGssapi() throws Exception {
  SaslServer server=mock(SaslServer.class);
  KerberosShortNamer kerberosShortNamer=mock(KerberosShortNamer.class);
  when(server.getMechanismName()).thenReturn(SaslConfigs.GSSAPI_MECHANISM);
  when(server.getAuthorizationID()).thenReturn("foo/host@REALM.COM");
  when(kerberosShortNamer.shortName(any())).thenReturn("foo");
  DefaultKafkaPrincipalBuilder builder=new DefaultKafkaPrincipalBuilder(kerberosShortNamer);
  KafkaPrincipal principal=builder.build(new SaslAuthenticationContext(server,SecurityProtocol.SASL_PLAINTEXT,InetAddress.getLocalHost(),SecurityProtocol.SASL_PLAINTEXT.name()));
  assertEquals(KafkaPrincipal.USER_TYPE,principal.getPrincipalType());
  assertEquals("foo",principal.getName());
  builder.close();
  verify(server,atLeastOnce()).getMechanismName();
  verify(server,atLeastOnce()).getAuthorizationID();
  verify(kerberosShortNamer,atLeastOnce()).shortName(any());
}
