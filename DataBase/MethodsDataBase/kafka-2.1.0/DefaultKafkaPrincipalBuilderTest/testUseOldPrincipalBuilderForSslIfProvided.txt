@Test @SuppressWarnings("deprecation") public void testUseOldPrincipalBuilderForSslIfProvided() throws Exception {
  TransportLayer transportLayer=mock(TransportLayer.class);
  Authenticator authenticator=mock(Authenticator.class);
  PrincipalBuilder oldPrincipalBuilder=mock(PrincipalBuilder.class);
  SSLSession session=mock(SSLSession.class);
  when(oldPrincipalBuilder.buildPrincipal(any(),any())).thenReturn(new DummyPrincipal("foo"));
  DefaultKafkaPrincipalBuilder builder=DefaultKafkaPrincipalBuilder.fromOldPrincipalBuilder(authenticator,transportLayer,oldPrincipalBuilder,null);
  KafkaPrincipal principal=builder.build(new SslAuthenticationContext(session,InetAddress.getLocalHost(),SecurityProtocol.PLAINTEXT.name()));
  assertEquals(KafkaPrincipal.USER_TYPE,principal.getPrincipalType());
  assertEquals("foo",principal.getName());
  builder.close();
  verify(oldPrincipalBuilder).buildPrincipal(transportLayer,authenticator);
  verify(oldPrincipalBuilder).close();
}
