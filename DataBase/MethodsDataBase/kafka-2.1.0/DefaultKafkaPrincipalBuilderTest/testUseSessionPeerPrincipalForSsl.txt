@Test public void testUseSessionPeerPrincipalForSsl() throws Exception {
  SSLSession session=mock(SSLSession.class);
  when(session.getPeerPrincipal()).thenReturn(new DummyPrincipal("foo"));
  DefaultKafkaPrincipalBuilder builder=new DefaultKafkaPrincipalBuilder(null);
  KafkaPrincipal principal=builder.build(new SslAuthenticationContext(session,InetAddress.getLocalHost(),SecurityProtocol.PLAINTEXT.name()));
  assertEquals(KafkaPrincipal.USER_TYPE,principal.getPrincipalType());
  assertEquals("foo",principal.getName());
  builder.close();
  verify(session,atLeastOnce()).getPeerPrincipal();
}
