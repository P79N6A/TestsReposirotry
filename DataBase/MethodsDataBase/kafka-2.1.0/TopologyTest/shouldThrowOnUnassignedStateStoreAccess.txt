@Test public void shouldThrowOnUnassignedStateStoreAccess(){
  final String sourceNodeName="source";
  final String goodNodeName="goodGuy";
  final String badNodeName="badGuy";
  final Properties config=new Properties();
  config.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG,"host:1");
  config.put(StreamsConfig.APPLICATION_ID_CONFIG,"appId");
  config.put(StreamsConfig.STATE_DIR_CONFIG,TestUtils.tempDirectory().getAbsolutePath());
  mockStoreBuilder();
  EasyMock.expect(storeBuilder.build()).andReturn(new MockKeyValueStore("store",false));
  EasyMock.replay(storeBuilder);
  topology.addSource(sourceNodeName,"topic").addProcessor(goodNodeName,new LocalMockProcessorSupplier(),sourceNodeName).addStateStore(storeBuilder,goodNodeName).addProcessor(badNodeName,new LocalMockProcessorSupplier(),sourceNodeName);
  try {
    new TopologyTestDriver(topology,config);
    fail("Should have thrown StreamsException");
  }
 catch (  final StreamsException e) {
    final String error=e.toString();
    final String expectedMessage="org.apache.kafka.streams.errors.StreamsException: failed to initialize processor " + badNodeName;
    assertThat(error,equalTo(expectedMessage));
  }
}
