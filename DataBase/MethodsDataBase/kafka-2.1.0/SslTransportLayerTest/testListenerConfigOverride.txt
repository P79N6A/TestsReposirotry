/** 
 * Tests that disabling client authentication as a listener override has the desired effect.
 */
@Test public void testListenerConfigOverride() throws Exception {
  String node="0";
  ListenerName clientListenerName=new ListenerName("client");
  sslServerConfigs.put(BrokerSecurityConfigs.SSL_CLIENT_AUTH_CONFIG,"required");
  sslServerConfigs.put(clientListenerName.configPrefix() + BrokerSecurityConfigs.SSL_CLIENT_AUTH_CONFIG,"none");
  server=createEchoServer(SecurityProtocol.SSL);
  InetSocketAddress addr=new InetSocketAddress("localhost",server.port());
  createSelector(sslClientConfigs);
  selector.connect(node,addr,BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.checkClientConnection(selector,node,100,10);
  selector.close();
  sslClientConfigs.remove(SslConfigs.SSL_KEYSTORE_LOCATION_CONFIG);
  sslClientConfigs.remove(SslConfigs.SSL_KEYSTORE_PASSWORD_CONFIG);
  sslClientConfigs.remove(SslConfigs.SSL_KEY_PASSWORD_CONFIG);
  createSelector(sslClientConfigs);
  selector.connect(node,addr,BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.waitForChannelClose(selector,node,ChannelState.State.AUTHENTICATION_FAILED);
  selector.close();
  server.close();
  server=createEchoServer(clientListenerName,SecurityProtocol.SSL);
  addr=new InetSocketAddress("localhost",server.port());
  createSelector(sslClientConfigs);
  selector.connect(node,addr,BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.checkClientConnection(selector,node,100,10);
}
