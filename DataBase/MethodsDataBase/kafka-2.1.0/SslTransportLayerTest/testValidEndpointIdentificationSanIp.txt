/** 
 * Tests that server certificate with SubjectAltName containing valid IP address is accepted by a client that connects using IP address and validates server endpoint.
 */
@Test public void testValidEndpointIdentificationSanIp() throws Exception {
  String node="0";
  serverCertStores=new CertStores(true,"server",InetAddress.getByName("127.0.0.1"));
  clientCertStores=new CertStores(false,"client",InetAddress.getByName("127.0.0.1"));
  sslServerConfigs=serverCertStores.getTrustingConfig(clientCertStores);
  sslClientConfigs=clientCertStores.getTrustingConfig(serverCertStores);
  server=createEchoServer(SecurityProtocol.SSL);
  sslClientConfigs.put(SslConfigs.SSL_ENDPOINT_IDENTIFICATION_ALGORITHM_CONFIG,"HTTPS");
  createSelector(sslClientConfigs);
  InetSocketAddress addr=new InetSocketAddress("127.0.0.1",server.port());
  selector.connect(node,addr,BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.checkClientConnection(selector,node,100,10);
}
