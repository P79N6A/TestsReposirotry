@Test public void testCreateOldPrincipalBuilder() throws Exception {
  TransportLayer transportLayer=mock(TransportLayer.class);
  Authenticator authenticator=mock(Authenticator.class);
  Map<String,Object> configs=new HashMap<>();
  configs.put(BrokerSecurityConfigs.PRINCIPAL_BUILDER_CLASS_CONFIG,OldPrincipalBuilder.class);
  KafkaPrincipalBuilder builder=ChannelBuilders.createPrincipalBuilder(configs,transportLayer,authenticator,null);
  assertTrue(OldPrincipalBuilder.configured);
  KafkaPrincipal principal=builder.build(new PlaintextAuthenticationContext(InetAddress.getLocalHost(),SecurityProtocol.PLAINTEXT.name()));
  assertEquals(OldPrincipalBuilder.PRINCIPAL_NAME,principal.getName());
  assertEquals(KafkaPrincipal.USER_TYPE,principal.getPrincipalType());
}
