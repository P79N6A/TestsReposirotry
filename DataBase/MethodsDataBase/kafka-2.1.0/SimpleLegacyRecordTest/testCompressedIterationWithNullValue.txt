@Test(expected=InvalidRecordException.class) public void testCompressedIterationWithNullValue() throws Exception {
  ByteBuffer buffer=ByteBuffer.allocate(128);
  DataOutputStream out=new DataOutputStream(new ByteBufferOutputStream(buffer));
  AbstractLegacyRecordBatch.writeHeader(out,0L,LegacyRecord.RECORD_OVERHEAD_V1);
  LegacyRecord.write(out,RecordBatch.MAGIC_VALUE_V1,1L,(byte[])null,null,CompressionType.GZIP,TimestampType.CREATE_TIME);
  buffer.flip();
  MemoryRecords records=MemoryRecords.readableRecords(buffer);
  if (records.records().iterator().hasNext())   fail("Iteration should have caused invalid record error");
}
