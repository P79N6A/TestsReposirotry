@Test public void shouldFinishGlobalStoreOperationOnShutDown() throws Exception {
  kafkaStreams=new KafkaStreams(builder.build(),streamsConfiguration);
  populateTopics(globalStoreTopic);
  populateTopics(streamTopic);
  kafkaStreams.start();
  TestUtils.waitForCondition(new TestCondition(){
    @Override public boolean conditionMet(){
      return firstRecordProcessed;
    }
  }
,30000,"Has not processed record within 30 seconds");
  kafkaStreams.close(Duration.ofSeconds(30));
  final List<Long> expectedRetrievedValues=Arrays.asList(1L,2L,3L,4L);
  assertEquals(expectedRetrievedValues,retrievedValuesList);
}
