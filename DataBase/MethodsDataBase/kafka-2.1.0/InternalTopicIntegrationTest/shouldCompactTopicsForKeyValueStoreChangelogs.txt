@Test public void shouldCompactTopicsForKeyValueStoreChangelogs() throws Exception {
  final String appID=APP_ID + "-compact";
  streamsProp.put(StreamsConfig.APPLICATION_ID_CONFIG,appID);
  final StreamsBuilder builder=new StreamsBuilder();
  final KStream<String,String> textLines=builder.stream(DEFAULT_INPUT_TOPIC);
  textLines.flatMapValues(value -> Arrays.asList(value.toLowerCase(Locale.getDefault()).split("\\W+"))).groupBy(MockMapper.selectValueMapper()).count(Materialized.as("Counts"));
  final KafkaStreams streams=new KafkaStreams(builder.build(),streamsProp);
  streams.start();
  produceData(Arrays.asList("hello","world","world","hello world"));
  waitForCompletion(streams,2,30000);
  streams.close();
  final Properties changelogProps=getTopicProperties(ProcessorStateManager.storeChangelogTopic(appID,"Counts"));
  assertEquals(LogConfig.Compact(),changelogProps.getProperty(LogConfig.CleanupPolicyProp()));
  final Properties repartitionProps=getTopicProperties(appID + "-Counts-repartition");
  assertEquals(LogConfig.Delete(),repartitionProps.getProperty(LogConfig.CleanupPolicyProp()));
  assertEquals(5,repartitionProps.size());
}
