@Test public void testJaasConfigurationForListener() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_PLAINTEXT;
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"PLAIN");
  saslServerConfigs.put(BrokerSecurityConfigs.SASL_ENABLED_MECHANISMS_CONFIG,Arrays.asList("PLAIN"));
  TestJaasConfig staticJaasConfig=new TestJaasConfig();
  Map<String,Object> globalServerOptions=new HashMap<>();
  globalServerOptions.put("user_global1","gsecret1");
  globalServerOptions.put("user_global2","gsecret2");
  staticJaasConfig.createOrUpdateEntry(TestJaasConfig.LOGIN_CONTEXT_SERVER,PlainLoginModule.class.getName(),globalServerOptions);
  Map<String,Object> clientListenerServerOptions=new HashMap<>();
  clientListenerServerOptions.put("user_client1","csecret1");
  clientListenerServerOptions.put("user_client2","csecret2");
  String clientJaasEntryName="client." + TestJaasConfig.LOGIN_CONTEXT_SERVER;
  staticJaasConfig.createOrUpdateEntry(clientJaasEntryName,PlainLoginModule.class.getName(),clientListenerServerOptions);
  Configuration.setConfiguration(staticJaasConfig);
  server=createEchoServer(new ListenerName("client"),securityProtocol);
  saslClientConfigs.put(SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN","client1","csecret1"));
  createAndCheckClientConnection(securityProtocol,"1");
  saslClientConfigs.put(SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN","global1","gsecret1"));
  createAndCheckClientConnectionFailure(securityProtocol,"2");
  server.close();
  server=createEchoServer(new ListenerName("other"),securityProtocol);
  saslClientConfigs.put(SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN","global1","gsecret1"));
  createAndCheckClientConnection(securityProtocol,"3");
  saslClientConfigs.put(SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN","client1","csecret1"));
  createAndCheckClientConnectionFailure(securityProtocol,"4");
}
