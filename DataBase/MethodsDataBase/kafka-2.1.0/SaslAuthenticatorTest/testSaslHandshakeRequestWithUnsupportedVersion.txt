/** 
 * Tests that unsupported version of SASL handshake request returns error response and fails authentication. This test is similar to {@link #testUnauthenticatedApiVersionsRequest(SecurityProtocol,short)}where a non-SASL client is used to send requests that are processed by {@link SaslServerAuthenticator} of the server prior to client authentication.
 */
@Test public void testSaslHandshakeRequestWithUnsupportedVersion() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_PLAINTEXT;
  configureMechanisms("PLAIN",Arrays.asList("PLAIN"));
  server=createEchoServer(securityProtocol);
  String node1="invalid1";
  createClientConnection(SecurityProtocol.PLAINTEXT,node1);
  SaslHandshakeRequest request=new SaslHandshakeRequest("PLAIN");
  RequestHeader header=new RequestHeader(ApiKeys.SASL_HANDSHAKE,Short.MAX_VALUE,"someclient",2);
  selector.send(request.toSend(node1,header));
  NetworkTestUtils.waitForChannelClose(selector,node1,ChannelState.READY.state());
  selector.close();
  createAndCheckClientConnection(securityProtocol,"good1");
}
