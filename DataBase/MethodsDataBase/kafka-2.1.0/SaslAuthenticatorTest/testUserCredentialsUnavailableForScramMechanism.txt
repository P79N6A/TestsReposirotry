/** 
 * Tests that SASL/SCRAM clients fail authentication if credentials are not available for the specific SCRAM mechanism.
 */
@Test public void testUserCredentialsUnavailableForScramMechanism() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_SSL;
  configureMechanisms("SCRAM-SHA-256",new ArrayList<>(ScramMechanism.mechanismNames()));
  server=createEchoServer(securityProtocol);
  updateScramCredentialCache(TestJaasConfig.USERNAME,TestJaasConfig.PASSWORD);
  server.credentialCache().cache(ScramMechanism.SCRAM_SHA_256.mechanismName(),ScramCredential.class).remove(TestJaasConfig.USERNAME);
  String node="1";
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"SCRAM-SHA-256");
  createAndCheckClientAuthenticationFailure(securityProtocol,node,"SCRAM-SHA-256",null);
  server.verifyAuthenticationMetrics(0,1);
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"SCRAM-SHA-512");
  createAndCheckClientConnection(securityProtocol,"2");
  server.verifyAuthenticationMetrics(1,1);
}
