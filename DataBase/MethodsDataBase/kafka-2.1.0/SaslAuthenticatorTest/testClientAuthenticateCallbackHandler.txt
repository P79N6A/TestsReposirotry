/** 
 * Tests SASL client authentication callback handler override.
 */
@Test public void testClientAuthenticateCallbackHandler() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_PLAINTEXT;
  TestJaasConfig jaasConfig=configureMechanisms("PLAIN",Collections.singletonList("PLAIN"));
  saslClientConfigs.put(SaslConfigs.SASL_CLIENT_CALLBACK_HANDLER_CLASS,TestClientCallbackHandler.class.getName());
  jaasConfig.setClientOptions("PLAIN","","");
  Map<String,Object> options=new HashMap<>();
  options.put("user_" + TestClientCallbackHandler.USERNAME,TestClientCallbackHandler.PASSWORD);
  jaasConfig.createOrUpdateEntry(TestJaasConfig.LOGIN_CONTEXT_SERVER,PlainLoginModule.class.getName(),options);
  server=createEchoServer(securityProtocol);
  createAndCheckClientConnection(securityProtocol,"good");
  options.clear();
  options.put("user_" + TestClientCallbackHandler.USERNAME,"invalid-password");
  jaasConfig.createOrUpdateEntry(TestJaasConfig.LOGIN_CONTEXT_SERVER,PlainLoginModule.class.getName(),options);
  createAndCheckClientConnectionFailure(securityProtocol,"invalid");
}
