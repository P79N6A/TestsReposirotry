/** 
 * Tests dynamic JAAS configuration property for SASL server. Invalid server credentials are set in the static JVM-wide configuration instance to ensure that the dynamic property override is used during authentication.
 */
@Test public void testServerDynamicJaasConfiguration() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_SSL;
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"PLAIN");
  saslServerConfigs.put(BrokerSecurityConfigs.SASL_ENABLED_MECHANISMS_CONFIG,Arrays.asList("PLAIN"));
  Map<String,Object> serverOptions=new HashMap<>();
  serverOptions.put("user_user1","user1-secret");
  serverOptions.put("user_user2","user2-secret");
  saslServerConfigs.put("listener.name.sasl_ssl.plain." + SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN",serverOptions));
  TestJaasConfig staticJaasConfig=new TestJaasConfig();
  staticJaasConfig.createOrUpdateEntry(TestJaasConfig.LOGIN_CONTEXT_SERVER,PlainLoginModule.class.getName(),Collections.emptyMap());
  staticJaasConfig.setClientOptions("PLAIN","user1","user1-secret");
  Configuration.setConfiguration(staticJaasConfig);
  server=createEchoServer(securityProtocol);
  createAndCheckClientConnection(securityProtocol,"1");
  saslClientConfigs.put(SaslConfigs.SASL_JAAS_CONFIG,TestJaasConfig.jaasConfigProperty("PLAIN","user2","user2-secret"));
  createAndCheckClientConnection(securityProtocol,"2");
}
