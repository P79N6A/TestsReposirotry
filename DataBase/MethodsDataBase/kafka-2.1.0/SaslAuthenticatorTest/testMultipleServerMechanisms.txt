/** 
 * Tests that servers supporting multiple SASL mechanisms work with clients using any of the enabled mechanisms.
 */
@Test public void testMultipleServerMechanisms() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_SSL;
  configureMechanisms("DIGEST-MD5",Arrays.asList("DIGEST-MD5","PLAIN","SCRAM-SHA-256"));
  configureDigestMd5ServerCallback(securityProtocol);
  server=createEchoServer(securityProtocol);
  updateScramCredentialCache(TestJaasConfig.USERNAME,TestJaasConfig.PASSWORD);
  String node1="1";
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"PLAIN");
  createAndCheckClientConnection(securityProtocol,node1);
  String node2="2";
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"DIGEST-MD5");
  createSelector(securityProtocol,saslClientConfigs);
  InetSocketAddress addr=new InetSocketAddress("127.0.0.1",server.port());
  selector.connect(node2,addr,BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.checkClientConnection(selector,node2,100,10);
  String node3="3";
  saslClientConfigs.put(SaslConfigs.SASL_MECHANISM,"SCRAM-SHA-256");
  createSelector(securityProtocol,saslClientConfigs);
  selector.connect(node3,new InetSocketAddress("127.0.0.1",server.port()),BUFFER_SIZE,BUFFER_SIZE);
  NetworkTestUtils.checkClientConnection(selector,node3,100,10);
}
