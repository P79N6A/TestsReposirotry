/** 
 * Tests OAUTHBEARER fails the connection when the client presents a token with insufficient scope .
 */
@Test public void testInsufficientScopeSaslOauthBearerMechanism() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_SSL;
  TestJaasConfig jaasConfig=configureMechanisms("OAUTHBEARER",Arrays.asList("OAUTHBEARER"));
  Map<String,Object> serverJaasConfigOptionsMap=TestJaasConfig.defaultServerOptions("OAUTHBEARER");
  serverJaasConfigOptionsMap.put("unsecuredValidatorRequiredScope","LOGIN_TO_KAFKA");
  jaasConfig.createOrUpdateEntry("KafkaServer","org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule",serverJaasConfigOptionsMap);
  server=createEchoServer(securityProtocol);
  createAndCheckClientAuthenticationFailure(securityProtocol,"node-" + OAuthBearerLoginModule.OAUTHBEARER_MECHANISM,OAuthBearerLoginModule.OAUTHBEARER_MECHANISM,"{\"status\":\"insufficient_scope\", \"scope\":\"[LOGIN_TO_KAFKA]\"}");
}
