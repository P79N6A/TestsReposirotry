/** 
 * Tests SASL server authentication callback handler override.
 */
@Test public void testServerAuthenticateCallbackHandler() throws Exception {
  SecurityProtocol securityProtocol=SecurityProtocol.SASL_PLAINTEXT;
  TestJaasConfig jaasConfig=configureMechanisms("PLAIN",Collections.singletonList("PLAIN"));
  jaasConfig.createOrUpdateEntry(TestJaasConfig.LOGIN_CONTEXT_SERVER,PlainLoginModule.class.getName(),new HashMap<String,Object>());
  String callbackPrefix=ListenerName.forSecurityProtocol(securityProtocol).saslMechanismConfigPrefix("PLAIN");
  saslServerConfigs.put(callbackPrefix + BrokerSecurityConfigs.SASL_SERVER_CALLBACK_HANDLER_CLASS,TestServerCallbackHandler.class.getName());
  server=createEchoServer(securityProtocol);
  jaasConfig.setClientOptions("PLAIN",TestServerCallbackHandler.USERNAME,TestServerCallbackHandler.PASSWORD);
  createAndCheckClientConnection(securityProtocol,"good");
  jaasConfig.setClientOptions("PLAIN",TestJaasConfig.USERNAME,"invalid-password");
  createAndCheckClientConnectionFailure(securityProtocol,"invalid");
}
