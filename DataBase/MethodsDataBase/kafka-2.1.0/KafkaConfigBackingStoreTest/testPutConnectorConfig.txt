@Test public void testPutConnectorConfig() throws Exception {
  expectConfigure();
  expectStart(Collections.EMPTY_LIST,Collections.EMPTY_MAP);
  expectConvertWriteAndRead(CONNECTOR_CONFIG_KEYS.get(0),KafkaConfigBackingStore.CONNECTOR_CONFIGURATION_V0,CONFIGS_SERIALIZED.get(0),"properties",SAMPLE_CONFIGS.get(0));
  configUpdateListener.onConnectorConfigUpdate(CONNECTOR_IDS.get(0));
  EasyMock.expectLastCall();
  expectConvertWriteAndRead(CONNECTOR_CONFIG_KEYS.get(1),KafkaConfigBackingStore.CONNECTOR_CONFIGURATION_V0,CONFIGS_SERIALIZED.get(1),"properties",SAMPLE_CONFIGS.get(1));
  configUpdateListener.onConnectorConfigUpdate(CONNECTOR_IDS.get(1));
  EasyMock.expectLastCall();
  expectConnectorRemoval(CONNECTOR_CONFIG_KEYS.get(1),TARGET_STATE_KEYS.get(1));
  configUpdateListener.onConnectorConfigRemove(CONNECTOR_IDS.get(1));
  EasyMock.expectLastCall();
  expectStop();
  PowerMock.replayAll();
  configStorage.setupAndCreateKafkaBasedLog(TOPIC,DEFAULT_DISTRIBUTED_CONFIG);
  configStorage.start();
  ClusterConfigState configState=configStorage.snapshot();
  assertEquals(-1,configState.offset());
  assertNull(configState.connectorConfig(CONNECTOR_IDS.get(0)));
  assertNull(configState.connectorConfig(CONNECTOR_IDS.get(1)));
  configStorage.putConnectorConfig(CONNECTOR_IDS.get(0),SAMPLE_CONFIGS.get(0));
  configState=configStorage.snapshot();
  assertEquals(1,configState.offset());
  assertEquals(SAMPLE_CONFIGS.get(0),configState.connectorConfig(CONNECTOR_IDS.get(0)));
  assertNull(configState.connectorConfig(CONNECTOR_IDS.get(1)));
  configStorage.putConnectorConfig(CONNECTOR_IDS.get(1),SAMPLE_CONFIGS.get(1));
  configState=configStorage.snapshot();
  assertEquals(2,configState.offset());
  assertEquals(SAMPLE_CONFIGS.get(0),configState.connectorConfig(CONNECTOR_IDS.get(0)));
  assertEquals(SAMPLE_CONFIGS.get(1),configState.connectorConfig(CONNECTOR_IDS.get(1)));
  configStorage.removeConnectorConfig(CONNECTOR_IDS.get(1));
  configState=configStorage.snapshot();
  assertEquals(4,configState.offset());
  assertEquals(SAMPLE_CONFIGS.get(0),configState.connectorConfig(CONNECTOR_IDS.get(0)));
  assertNull(configState.connectorConfig(CONNECTOR_IDS.get(1)));
  assertNull(configState.targetState(CONNECTOR_IDS.get(1)));
  configStorage.stop();
  PowerMock.verifyAll();
}
