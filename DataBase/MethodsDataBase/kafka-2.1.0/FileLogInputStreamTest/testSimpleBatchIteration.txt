@Test public void testSimpleBatchIteration() throws IOException {
  if (compression == CompressionType.ZSTD && magic < MAGIC_VALUE_V2)   return;
  try (FileRecords fileRecords=FileRecords.open(tempFile())){
    SimpleRecord firstBatchRecord=new SimpleRecord(3241324L,"a".getBytes(),"foo".getBytes());
    SimpleRecord secondBatchRecord=new SimpleRecord(234280L,"b".getBytes(),"bar".getBytes());
    fileRecords.append(MemoryRecords.withRecords(magic,0L,compression,CREATE_TIME,firstBatchRecord));
    fileRecords.append(MemoryRecords.withRecords(magic,1L,compression,CREATE_TIME,secondBatchRecord));
    fileRecords.flush();
    FileLogInputStream logInputStream=new FileLogInputStream(fileRecords,0,fileRecords.sizeInBytes());
    FileChannelRecordBatch firstBatch=logInputStream.nextBatch();
    assertGenericRecordBatchData(firstBatch,0L,3241324L,firstBatchRecord);
    assertNoProducerData(firstBatch);
    FileChannelRecordBatch secondBatch=logInputStream.nextBatch();
    assertGenericRecordBatchData(secondBatch,1L,234280L,secondBatchRecord);
    assertNoProducerData(secondBatch);
    assertNull(logInputStream.nextBatch());
  }
 }
