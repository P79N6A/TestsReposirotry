@Test public void testWriteTo() throws IOException {
  if (compression == CompressionType.ZSTD && magic < MAGIC_VALUE_V2)   return;
  try (FileRecords fileRecords=FileRecords.open(tempFile())){
    fileRecords.append(MemoryRecords.withRecords(magic,compression,new SimpleRecord("foo".getBytes())));
    fileRecords.flush();
    FileLogInputStream logInputStream=new FileLogInputStream(fileRecords,0,fileRecords.sizeInBytes());
    FileChannelRecordBatch batch=logInputStream.nextBatch();
    assertNotNull(batch);
    assertEquals(magic,batch.magic());
    ByteBuffer buffer=ByteBuffer.allocate(128);
    batch.writeTo(buffer);
    buffer.flip();
    MemoryRecords memRecords=MemoryRecords.readableRecords(buffer);
    List<Record> records=Utils.toList(memRecords.records().iterator());
    assertEquals(1,records.size());
    Record record0=records.get(0);
    assertTrue(record0.hasMagic(magic));
    assertEquals("foo",Utils.utf8(record0.value(),record0.valueSize()));
  }
 }
