@Test public void testBatchIterationIncompleteBatch() throws IOException {
  if (compression == CompressionType.ZSTD && magic < MAGIC_VALUE_V2)   return;
  try (FileRecords fileRecords=FileRecords.open(tempFile())){
    SimpleRecord firstBatchRecord=new SimpleRecord(100L,"foo".getBytes());
    SimpleRecord secondBatchRecord=new SimpleRecord(200L,"bar".getBytes());
    fileRecords.append(MemoryRecords.withRecords(magic,0L,compression,CREATE_TIME,firstBatchRecord));
    fileRecords.append(MemoryRecords.withRecords(magic,1L,compression,CREATE_TIME,secondBatchRecord));
    fileRecords.flush();
    fileRecords.truncateTo(fileRecords.sizeInBytes() - 13);
    FileLogInputStream logInputStream=new FileLogInputStream(fileRecords,0,fileRecords.sizeInBytes());
    FileChannelRecordBatch firstBatch=logInputStream.nextBatch();
    assertNoProducerData(firstBatch);
    assertGenericRecordBatchData(firstBatch,0L,100L,firstBatchRecord);
    assertNull(logInputStream.nextBatch());
  }
 }
