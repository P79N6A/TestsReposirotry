@Test public void testMetadataReady(){
  assertFalse(mgr.isReady());
  assertEquals(0,mgr.metadataFetchDelayMs(time.milliseconds()));
  mgr.update(Cluster.bootstrap(Collections.singletonList(new InetSocketAddress("localhost",9999))),time.milliseconds());
  assertFalse(mgr.isReady());
  assertEquals(0,mgr.metadataFetchDelayMs(time.milliseconds()));
  mgr.update(mockCluster(),time.milliseconds());
  assertTrue(mgr.isReady());
  assertEquals(metadataExpireMs,mgr.metadataFetchDelayMs(time.milliseconds()));
  time.sleep(metadataExpireMs);
  assertEquals(0,mgr.metadataFetchDelayMs(time.milliseconds()));
}
