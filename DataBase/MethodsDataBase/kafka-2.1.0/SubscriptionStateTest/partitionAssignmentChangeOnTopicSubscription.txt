@Test public void partitionAssignmentChangeOnTopicSubscription(){
  state.assignFromUser(new HashSet<>(Arrays.asList(tp0,tp1)));
  assertEquals(2,state.assignedPartitions().size());
  assertEquals(2,state.numAssignedPartitions());
  assertTrue(state.assignedPartitions().contains(tp0));
  assertTrue(state.assignedPartitions().contains(tp1));
  state.unsubscribe();
  assertTrue(state.assignedPartitions().isEmpty());
  assertEquals(0,state.numAssignedPartitions());
  state.subscribe(singleton(topic1),rebalanceListener);
  assertTrue(state.assignedPartitions().isEmpty());
  assertEquals(0,state.numAssignedPartitions());
  state.assignFromSubscribed(singleton(t1p0));
  assertEquals(singleton(t1p0),state.assignedPartitions());
  assertEquals(1,state.numAssignedPartitions());
  state.subscribe(singleton(topic),rebalanceListener);
  assertEquals(singleton(t1p0),state.assignedPartitions());
  assertEquals(1,state.numAssignedPartitions());
  state.unsubscribe();
  assertTrue(state.assignedPartitions().isEmpty());
  assertEquals(0,state.numAssignedPartitions());
}
