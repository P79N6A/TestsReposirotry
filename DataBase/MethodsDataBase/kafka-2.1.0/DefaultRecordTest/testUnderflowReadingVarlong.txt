@Test(expected=InvalidRecordException.class) public void testUnderflowReadingVarlong(){
  byte attributes=0;
  int sizeOfBodyInBytes=2;
  ByteBuffer buf=ByteBuffer.allocate(sizeOfBodyInBytes + ByteUtils.sizeOfVarint(sizeOfBodyInBytes) + 1);
  ByteUtils.writeVarint(sizeOfBodyInBytes,buf);
  buf.put(attributes);
  ByteUtils.writeVarlong(156,buf);
  buf.position(buf.limit() - 1);
  buf.flip();
  DefaultRecord.readFrom(buf,0L,0L,RecordBatch.NO_SEQUENCE,null);
}
