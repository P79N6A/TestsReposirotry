@Test public void testMultipleLoginModules() throws Exception {
  StringBuilder builder=new StringBuilder();
  int moduleCount=3;
  Map<Integer,Map<String,Object>> moduleOptions=new HashMap<>();
  for (int i=0; i < moduleCount; i++) {
    Map<String,Object> options=new HashMap<>();
    options.put("index","Index" + i);
    options.put("module","Module" + i);
    moduleOptions.put(i,options);
    String module=jaasConfigProp("test.Module" + i,LoginModuleControlFlag.REQUIRED,options);
    builder.append(' ');
    builder.append(module);
  }
  String jaasConfigProp=builder.toString();
  String clientContextName="CLIENT";
  Configuration configuration=new JaasConfig(clientContextName,jaasConfigProp);
  AppConfigurationEntry[] dynamicEntries=configuration.getAppConfigurationEntry(clientContextName);
  assertEquals(moduleCount,dynamicEntries.length);
  for (int i=0; i < moduleCount; i++) {
    AppConfigurationEntry entry=dynamicEntries[i];
    checkEntry(entry,"test.Module" + i,LoginModuleControlFlag.REQUIRED,moduleOptions.get(i));
  }
  String serverContextName="SERVER";
  writeConfiguration(serverContextName,jaasConfigProp);
  AppConfigurationEntry[] staticEntries=Configuration.getConfiguration().getAppConfigurationEntry(serverContextName);
  for (int i=0; i < moduleCount; i++) {
    AppConfigurationEntry staticEntry=staticEntries[i];
    checkEntry(staticEntry,dynamicEntries[i].getLoginModuleName(),LoginModuleControlFlag.REQUIRED,dynamicEntries[i].getOptions());
  }
}
