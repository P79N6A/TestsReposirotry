/** 
 * Test if the  waiter that is waiting on availability of more memory is cleaned up when a timeout occurs
 */
@Test public void testCleanupMemoryAvailabilityWaiterOnBlockTimeout() throws Exception {
  BufferPool pool=new BufferPool(2,1,metrics,time,metricGroup);
  pool.allocate(1,maxBlockTimeMs);
  try {
    pool.allocate(2,maxBlockTimeMs);
    fail("The buffer allocated more memory than its maximum value 2");
  }
 catch (  TimeoutException e) {
  }
  assertEquals(0,pool.queued());
  assertEquals(1,pool.availableMemory());
}
