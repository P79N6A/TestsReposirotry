@Test public void testRefreshOffsetNotCoordinatorForConsumer(){
  client.prepareResponse(groupCoordinatorResponse(node,Errors.NONE));
  coordinator.ensureCoordinatorReady(time.timer(Long.MAX_VALUE));
  subscriptions.assignFromUser(singleton(t1p));
  client.prepareResponse(offsetFetchResponse(Errors.NOT_COORDINATOR));
  client.prepareResponse(groupCoordinatorResponse(node,Errors.NONE));
  client.prepareResponse(offsetFetchResponse(t1p,Errors.NONE,"",100L));
  coordinator.refreshCommittedOffsetsIfNeeded(time.timer(Long.MAX_VALUE));
  assertEquals(Collections.emptySet(),subscriptions.missingFetchPositions());
  assertTrue(subscriptions.hasAllFetchPositions());
  assertEquals(100L,subscriptions.position(t1p).longValue());
}
