@Test public void testAutoCommitDynamicAssignmentRebalance(){
  final String consumerId="consumer";
  ConsumerCoordinator coordinator=buildCoordinator(new Metrics(),assignors,ConsumerConfig.DEFAULT_EXCLUDE_INTERNAL_TOPICS,true,true);
  subscriptions.subscribe(singleton(topic1),rebalanceListener);
  client.prepareResponse(groupCoordinatorResponse(node,Errors.NONE));
  coordinator.ensureCoordinatorReady(time.timer(Long.MAX_VALUE));
  time.sleep(autoCommitIntervalMs);
  consumerClient.poll(time.timer(0));
  client.prepareResponse(joinGroupFollowerResponse(1,consumerId,"leader",Errors.NONE));
  client.prepareResponse(syncGroupResponse(singletonList(t1p),Errors.NONE));
  coordinator.joinGroupIfNeeded(time.timer(Long.MAX_VALUE));
  subscriptions.seek(t1p,100);
  prepareOffsetCommitRequest(singletonMap(t1p,100L),Errors.NONE);
  time.sleep(autoCommitIntervalMs);
  coordinator.poll(time.timer(Long.MAX_VALUE));
  assertFalse(client.hasPendingResponses());
}
