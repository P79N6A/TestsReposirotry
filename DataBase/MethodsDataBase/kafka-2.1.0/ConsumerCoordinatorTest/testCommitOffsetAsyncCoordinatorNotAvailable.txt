@Test public void testCommitOffsetAsyncCoordinatorNotAvailable(){
  client.prepareResponse(groupCoordinatorResponse(node,Errors.NONE));
  coordinator.ensureCoordinatorReady(time.timer(Long.MAX_VALUE));
  MockCommitCallback cb=new MockCommitCallback();
  prepareOffsetCommitRequest(singletonMap(t1p,100L),Errors.COORDINATOR_NOT_AVAILABLE);
  coordinator.commitOffsetsAsync(singletonMap(t1p,new OffsetAndMetadata(100L)),cb);
  coordinator.invokeCompletedOffsetCommitCallbacks();
  assertTrue(coordinator.coordinatorUnknown());
  assertEquals(1,cb.invoked);
  assertTrue(cb.exception instanceof RetriableCommitFailedException);
}
