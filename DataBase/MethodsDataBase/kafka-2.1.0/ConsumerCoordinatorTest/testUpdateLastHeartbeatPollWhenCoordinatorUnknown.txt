@Test public void testUpdateLastHeartbeatPollWhenCoordinatorUnknown() throws Exception {
  subscriptions.subscribe(singleton(topic1),rebalanceListener);
  client.prepareResponse(groupCoordinatorResponse(node,Errors.NONE));
  coordinator.ensureCoordinatorReady(time.timer(Long.MAX_VALUE));
  client.prepareResponse(joinGroupFollowerResponse(1,"consumer","leader",Errors.NONE));
  client.prepareResponse(syncGroupResponse(singletonList(t1p),Errors.NONE));
  client.prepareResponse(heartbeatResponse(Errors.NOT_COORDINATOR));
  coordinator.poll(time.timer(Long.MAX_VALUE));
  time.sleep(heartbeatIntervalMs);
  TestUtils.waitForCondition(() -> !client.hasPendingResponses(),"Failed to observe expected heartbeat from background thread");
  assertTrue(coordinator.coordinatorUnknown());
  assertFalse(coordinator.poll(time.timer(0)));
  assertEquals(time.milliseconds(),heartbeat.lastPollTime());
  time.sleep(rebalanceTimeoutMs - 1);
  assertFalse(heartbeat.pollTimeoutExpired(time.milliseconds()));
}
