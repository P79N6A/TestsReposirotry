@Test public void shouldGroupByKey() throws Exception {
  final long timestamp=mockTime.milliseconds();
  produceMessages(timestamp);
  produceMessages(timestamp);
  stream.groupByKey(Serialized.with(Serdes.Integer(),Serdes.String())).windowedBy(TimeWindows.of(ofMillis(500L))).count(Materialized.as("count-windows")).toStream((windowedKey,value) -> windowedKey.key() + "@" + windowedKey.window().start()).to(outputTopic,Produced.with(Serdes.String(),Serdes.Long()));
  startStreams();
  final long window=timestamp / 500 * 500;
  validateReceivedMessages(new StringDeserializer(),new LongDeserializer(),Arrays.asList(KeyValue.pair("1@" + window,2L),KeyValue.pair("2@" + window,2L),KeyValue.pair("3@" + window,2L),KeyValue.pair("4@" + window,2L),KeyValue.pair("5@" + window,2L)));
}
