@Test public void shouldUseSerdesDefinedInMaterializedToConsumeTable(){
  final Map<Long,String> results=new HashMap<>();
  final String topic="topic";
  final ForeachAction<Long,String> action=new ForeachAction<Long,String>(){
    @Override public void apply(    final Long key,    final String value){
      results.put(key,value);
    }
  }
;
  builder.table(topic,Materialized.<Long,String,KeyValueStore<Bytes,byte[]>>as("store").withKeySerde(Serdes.Long()).withValueSerde(Serdes.String())).toStream().foreach(action);
  final ConsumerRecordFactory<Long,String> recordFactory=new ConsumerRecordFactory<>(new LongSerializer(),new StringSerializer());
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    driver.pipeInput(recordFactory.create(topic,1L,"value1"));
    driver.pipeInput(recordFactory.create(topic,2L,"value2"));
    final KeyValueStore<Long,String> store=driver.getKeyValueStore("store");
    assertThat(store.get(1L),equalTo("value1"));
    assertThat(store.get(2L),equalTo("value2"));
    assertThat(results.get(1L),equalTo("value1"));
    assertThat(results.get(2L),equalTo("value2"));
  }
 }
