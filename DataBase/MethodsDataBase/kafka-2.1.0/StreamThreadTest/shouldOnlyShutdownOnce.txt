@SuppressWarnings("unchecked") @Test public void shouldOnlyShutdownOnce(){
  final Consumer<byte[],byte[]> consumer=EasyMock.createNiceMock(Consumer.class);
  final TaskManager taskManager=EasyMock.createNiceMock(TaskManager.class);
  taskManager.shutdown(true);
  EasyMock.expectLastCall();
  EasyMock.replay(taskManager,consumer);
  final StreamThread.StreamsMetricsThreadImpl streamsMetrics=new StreamThread.StreamsMetricsThreadImpl(metrics,"");
  final StreamThread thread=new StreamThread(mockTime,config,null,consumer,consumer,null,taskManager,streamsMetrics,internalTopologyBuilder,clientId,new LogContext(""),new AtomicInteger());
  thread.shutdown();
  thread.run();
  EasyMock.verify(taskManager);
}
