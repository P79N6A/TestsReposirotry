@Test public void testStateChangeStartClose() throws InterruptedException {
  final StreamThread thread=createStreamThread(clientId,config,false);
  final StateListenerStub stateListener=new StateListenerStub();
  thread.setStateListener(stateListener);
  thread.start();
  TestUtils.waitForCondition(new TestCondition(){
    @Override public boolean conditionMet(){
      return thread.state() == StreamThread.State.RUNNING;
    }
  }
,10 * 1000,"Thread never started.");
  thread.shutdown();
  TestUtils.waitForCondition(new TestCondition(){
    @Override public boolean conditionMet(){
      return thread.state() == StreamThread.State.DEAD;
    }
  }
,10 * 1000,"Thread never shut down.");
  thread.shutdown();
  assertEquals(thread.state(),StreamThread.State.DEAD);
}
