@Test(expected=UnsupportedVersionException.class) public void testIdempotenceWithOldMagic() throws InterruptedException {
  ApiVersions apiVersions=new ApiVersions();
  int batchSize=1025;
  int requestTimeoutMs=1600;
  long deliveryTimeoutMs=3200L;
  long lingerMs=10L;
  long retryBackoffMs=100L;
  long totalSize=10 * batchSize;
  String metricGrpName="producer-metrics";
  apiVersions.update("foobar",NodeApiVersions.create(Arrays.asList(new ApiVersionsResponse.ApiVersion(ApiKeys.PRODUCE.id,(short)0,(short)2))));
  RecordAccumulator accum=new RecordAccumulator(logContext,batchSize + DefaultRecordBatch.RECORD_BATCH_OVERHEAD,CompressionType.NONE,lingerMs,retryBackoffMs,deliveryTimeoutMs,metrics,metricGrpName,time,apiVersions,new TransactionManager(),new BufferPool(totalSize,batchSize,metrics,time,metricGrpName));
  accum.append(tp1,0L,key,value,Record.EMPTY_HEADERS,null,0);
}
