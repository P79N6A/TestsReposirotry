@Test public void testAwaitFlushComplete() throws Exception {
  RecordAccumulator accum=createTestRecordAccumulator(4 * 1024 + DefaultRecordBatch.RECORD_BATCH_OVERHEAD,64 * 1024,CompressionType.NONE,Long.MAX_VALUE);
  accum.append(new TopicPartition(topic,0),0L,key,value,Record.EMPTY_HEADERS,null,maxBlockTimeMs);
  accum.beginFlush();
  assertTrue(accum.flushInProgress());
  delayedInterrupt(Thread.currentThread(),1000L);
  try {
    accum.awaitFlushCompletion();
    fail("awaitFlushCompletion should throw InterruptException");
  }
 catch (  InterruptedException e) {
    assertFalse("flushInProgress count should be decremented even if thread is interrupted",accum.flushInProgress());
  }
}
