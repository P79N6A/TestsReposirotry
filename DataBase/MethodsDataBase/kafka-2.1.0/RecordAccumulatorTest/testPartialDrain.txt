@Test public void testPartialDrain() throws Exception {
  RecordAccumulator accum=createTestRecordAccumulator(1024 + DefaultRecordBatch.RECORD_BATCH_OVERHEAD,10 * 1024,CompressionType.NONE,10L);
  int appends=1024 / msgSize + 1;
  List<TopicPartition> partitions=asList(tp1,tp2);
  for (  TopicPartition tp : partitions) {
    for (int i=0; i < appends; i++)     accum.append(tp,0L,key,value,Record.EMPTY_HEADERS,null,maxBlockTimeMs);
  }
  assertEquals("Partition's leader should be ready",Collections.singleton(node1),accum.ready(cluster,time.milliseconds()).readyNodes);
  List<ProducerBatch> batches=accum.drain(cluster,Collections.singleton(node1),1024,0).get(node1.id());
  assertEquals("But due to size bound only one partition should have been retrieved",1,batches.size());
}
