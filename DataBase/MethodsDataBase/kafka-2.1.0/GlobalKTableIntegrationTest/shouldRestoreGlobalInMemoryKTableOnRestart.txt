@Test public void shouldRestoreGlobalInMemoryKTableOnRestart() throws Exception {
  builder=new StreamsBuilder();
  globalTable=builder.globalTable(globalTableTopic,Consumed.with(Serdes.Long(),Serdes.String()),Materialized.as(Stores.inMemoryKeyValueStore(globalStore)));
  produceInitialGlobalTableValues();
  startStreams();
  ReadOnlyKeyValueStore<Long,String> store=kafkaStreams.store(globalStore,QueryableStoreTypes.keyValueStore());
  assertThat(store.approximateNumEntries(),equalTo(4L));
  kafkaStreams.close();
  startStreams();
  store=kafkaStreams.store(globalStore,QueryableStoreTypes.keyValueStore());
  assertThat(store.approximateNumEntries(),equalTo(4L));
}
