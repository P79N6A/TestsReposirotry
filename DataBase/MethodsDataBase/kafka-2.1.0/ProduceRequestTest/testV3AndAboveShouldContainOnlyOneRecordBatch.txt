@Test public void testV3AndAboveShouldContainOnlyOneRecordBatch(){
  ByteBuffer buffer=ByteBuffer.allocate(256);
  MemoryRecordsBuilder builder=MemoryRecords.builder(buffer,CompressionType.NONE,TimestampType.CREATE_TIME,0L);
  builder.append(10L,null,"a".getBytes());
  builder.close();
  builder=MemoryRecords.builder(buffer,CompressionType.NONE,TimestampType.CREATE_TIME,1L);
  builder.append(11L,"1".getBytes(),"b".getBytes());
  builder.append(12L,null,"c".getBytes());
  builder.close();
  buffer.flip();
  Map<TopicPartition,MemoryRecords> produceData=new HashMap<>();
  produceData.put(new TopicPartition("test",0),MemoryRecords.readableRecords(buffer));
  ProduceRequest.Builder requestBuilder=ProduceRequest.Builder.forCurrentMagic((short)1,5000,produceData);
  assertThrowsInvalidRecordExceptionForAllVersions(requestBuilder);
}
