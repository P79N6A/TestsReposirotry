@Test public void testBuildWithOldMessageFormat(){
  ByteBuffer buffer=ByteBuffer.allocate(256);
  MemoryRecordsBuilder builder=MemoryRecords.builder(buffer,RecordBatch.MAGIC_VALUE_V1,CompressionType.NONE,TimestampType.CREATE_TIME,0L);
  builder.append(10L,null,"a".getBytes());
  Map<TopicPartition,MemoryRecords> produceData=new HashMap<>();
  produceData.put(new TopicPartition("test",0),builder.build());
  ProduceRequest.Builder requestBuilder=ProduceRequest.Builder.forMagic(RecordBatch.MAGIC_VALUE_V1,(short)1,5000,produceData,null);
  assertEquals(2,requestBuilder.oldestAllowedVersion());
  assertEquals(2,requestBuilder.latestAllowedVersion());
}
