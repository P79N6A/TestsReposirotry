@Test public void testV6AndBelowCannotUseZStdCompression(){
  ByteBuffer buffer=ByteBuffer.allocate(256);
  MemoryRecordsBuilder builder=MemoryRecords.builder(buffer,RecordBatch.MAGIC_VALUE_V2,CompressionType.ZSTD,TimestampType.CREATE_TIME,0L);
  builder.append(10L,null,"a".getBytes());
  Map<TopicPartition,MemoryRecords> produceData=new HashMap<>();
  produceData.put(new TopicPartition("test",0),builder.build());
  for (short version=3; version < 7; version++) {
    ProduceRequest.Builder requestBuilder=new ProduceRequest.Builder(version,version,(short)1,5000,produceData,null);
    assertThrowsInvalidRecordExceptionForAllVersions(requestBuilder);
  }
  ProduceRequest.Builder.forCurrentMagic((short)1,5000,produceData);
}
