@Test public void testBuildWithCurrentMessageFormat(){
  ByteBuffer buffer=ByteBuffer.allocate(256);
  MemoryRecordsBuilder builder=MemoryRecords.builder(buffer,RecordBatch.CURRENT_MAGIC_VALUE,CompressionType.NONE,TimestampType.CREATE_TIME,0L);
  builder.append(10L,null,"a".getBytes());
  Map<TopicPartition,MemoryRecords> produceData=new HashMap<>();
  produceData.put(new TopicPartition("test",0),builder.build());
  ProduceRequest.Builder requestBuilder=ProduceRequest.Builder.forMagic(RecordBatch.CURRENT_MAGIC_VALUE,(short)1,5000,produceData,null);
  assertEquals(3,requestBuilder.oldestAllowedVersion());
  assertEquals(ApiKeys.PRODUCE.latestVersion(),requestBuilder.latestAllowedVersion());
}
