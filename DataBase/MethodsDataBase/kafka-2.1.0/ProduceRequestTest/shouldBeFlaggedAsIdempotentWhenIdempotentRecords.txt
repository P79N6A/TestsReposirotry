@Test public void shouldBeFlaggedAsIdempotentWhenIdempotentRecords() throws Exception {
  final MemoryRecords memoryRecords=MemoryRecords.withIdempotentRecords(1,CompressionType.NONE,1L,(short)1,1,1,simpleRecord);
  final ProduceRequest request=ProduceRequest.Builder.forCurrentMagic((short)-1,10,Collections.singletonMap(new TopicPartition("topic",1),memoryRecords)).build();
  assertTrue(request.isIdempotent());
}
