@Test public void shouldThrowExceptionOnCommitWhenNotCommitFailedOrProducerFenced(){
  mockTaskInitialization();
  EasyMock.expect(t1.commitNeeded()).andReturn(true);
  t1.commit();
  EasyMock.expectLastCall().andThrow(new RuntimeException(""));
  EasyMock.replay(t1);
  addAndInitTask();
  try {
    assignedTasks.commit();
    fail("Should have thrown exception");
  }
 catch (  final Exception e) {
  }
  assertThat(assignedTasks.runningTaskIds(),equalTo(Collections.singleton(taskId1)));
  EasyMock.verify(t1);
}
