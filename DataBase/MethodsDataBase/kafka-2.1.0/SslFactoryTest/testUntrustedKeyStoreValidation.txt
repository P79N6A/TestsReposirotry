@Test public void testUntrustedKeyStoreValidation() throws Exception {
  File trustStoreFile=File.createTempFile("truststore",".jks");
  Map<String,Object> serverSslConfig=TestSslUtils.createSslConfig(false,true,Mode.SERVER,trustStoreFile,"server");
  Map<String,Object> untrustedConfig=TestSslUtils.createSslConfig(false,true,Mode.SERVER,File.createTempFile("truststore",".jks"),"server");
  SslFactory sslFactory=new SslFactory(Mode.SERVER,null,true);
  sslFactory.configure(serverSslConfig);
  try {
    sslFactory.createSSLContext(sslKeyStore(untrustedConfig),null);
    fail("Validation did not fail with untrusted keystore");
  }
 catch (  SSLHandshakeException e) {
  }
  try {
    sslFactory.createSSLContext(null,sslTrustStore(untrustedConfig));
    fail("Validation did not fail with untrusted truststore");
  }
 catch (  SSLHandshakeException e) {
  }
  try {
    sslFactory.createSSLContext(sslKeyStore(untrustedConfig),sslTrustStore(untrustedConfig));
    fail("Validation did not fail with untrusted truststore");
  }
 catch (  SSLHandshakeException e) {
  }
}
