/** 
 * Tests that `readFullyOrFail` behaves correctly if multiple `FileChannel.read` operations are required to fill the destination buffer.
 */
@Test public void testReadFullyWithPartialFileChannelReads() throws IOException {
  FileChannel channelMock=mock(FileChannel.class);
  final int bufferSize=100;
  String expectedBufferContent=fileChannelMockExpectReadWithRandomBytes(channelMock,bufferSize);
  ByteBuffer buffer=ByteBuffer.allocate(bufferSize);
  Utils.readFully(channelMock,buffer,0L);
  assertEquals("The buffer should be populated correctly.",expectedBufferContent,new String(buffer.array()));
  assertFalse("The buffer should be filled",buffer.hasRemaining());
  verify(channelMock,atLeastOnce()).read(any(),anyLong());
}
