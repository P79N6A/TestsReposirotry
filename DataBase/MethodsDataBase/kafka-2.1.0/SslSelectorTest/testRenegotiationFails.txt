/** 
 * Renegotiation is not supported since it is potentially unsafe and it has been removed in TLS 1.3
 */
@Test public void testRenegotiationFails() throws Exception {
  String node="0";
  InetSocketAddress addr=new InetSocketAddress("localhost",server.port);
  selector.connect(node,addr,BUFFER_SIZE,BUFFER_SIZE);
  while (!selector.isChannelReady(node)) {
    selector.poll(1000L);
  }
  selector.send(createSend(node,node + "-" + 0));
  selector.poll(0L);
  server.renegotiate();
  selector.send(createSend(node,node + "-" + 1));
  long expiryTime=System.currentTimeMillis() + 2000;
  List<String> disconnected=new ArrayList<>();
  while (!disconnected.contains(node) && System.currentTimeMillis() < expiryTime) {
    selector.poll(10);
    disconnected.addAll(selector.disconnected().keySet());
  }
  assertTrue("Renegotiation should cause disconnection",disconnected.contains(node));
}
