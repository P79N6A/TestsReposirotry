@Test public void shouldLogAndMeasureSkipsInReduce(){
  groupedStream.reduce(MockReducer.STRING_ADDER,Materialized.<String,String,KeyValueStore<Bytes,byte[]>>as("reduce").withKeySerde(Serdes.String()).withValueSerde(Serdes.String()));
  final LogCaptureAppender appender=LogCaptureAppender.createAndRegister();
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    processData(driver);
    LogCaptureAppender.unregister(appender);
    final Map<MetricName,? extends Metric> metrics=driver.metrics();
    assertEquals(1.0,getMetricByName(metrics,"skipped-records-total","stream-metrics").metricValue());
    assertNotEquals(0.0,getMetricByName(metrics,"skipped-records-rate","stream-metrics").metricValue());
    assertThat(appender.getMessages(),hasItem("Skipping record due to null key or value. key=[3] value=[null] topic=[topic] partition=[0] offset=[6]"));
  }
 }
