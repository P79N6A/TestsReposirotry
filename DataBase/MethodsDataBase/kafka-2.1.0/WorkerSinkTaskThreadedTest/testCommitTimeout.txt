@Test public void testCommitTimeout() throws Exception {
  expectInitializeTask();
  expectPollInitialAssignment();
  Capture<Collection<SinkRecord>> capturedRecords=expectPolls(WorkerConfig.OFFSET_COMMIT_INTERVAL_MS_DEFAULT / 2);
  expectOffsetCommit(2L,null,null,WorkerConfig.OFFSET_COMMIT_TIMEOUT_MS_DEFAULT,false);
  expectStopTask();
  PowerMock.replayAll();
  workerTask.initialize(TASK_CONFIG);
  workerTask.initializeAndStart();
  workerTask.iteration();
  workerTask.iteration();
  workerTask.iteration();
  workerTask.iteration();
  workerTask.iteration();
  assertEquals(1,workerTask.commitFailures());
  assertEquals(false,Whitebox.getInternalState(workerTask,"committing"));
  workerTask.stop();
  workerTask.close();
  PowerMock.verifyAll();
}
