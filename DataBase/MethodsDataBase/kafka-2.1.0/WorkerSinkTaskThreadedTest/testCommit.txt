@Test public void testCommit() throws Exception {
  expectInitializeTask();
  expectPollInitialAssignment();
  Capture<Collection<SinkRecord>> capturedRecords=expectPolls(WorkerConfig.OFFSET_COMMIT_INTERVAL_MS_DEFAULT);
  expectOffsetCommit(1L,null,null,0,true);
  expectStopTask();
  PowerMock.replayAll();
  workerTask.initialize(TASK_CONFIG);
  workerTask.initializeAndStart();
  workerTask.iteration();
  workerTask.iteration();
  workerTask.iteration();
  assertEquals(0,workerTask.commitFailures());
  workerTask.stop();
  workerTask.close();
  assertEquals(2,capturedRecords.getValues().size());
  PowerMock.verifyAll();
}
