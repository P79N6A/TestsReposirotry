@Test public void testPollsInBackground() throws Exception {
  expectInitializeTask();
  expectPollInitialAssignment();
  Capture<Collection<SinkRecord>> capturedRecords=expectPolls(1L);
  expectStopTask();
  PowerMock.replayAll();
  workerTask.initialize(TASK_CONFIG);
  workerTask.initializeAndStart();
  workerTask.iteration();
  for (int i=0; i < 10; i++) {
    workerTask.iteration();
  }
  workerTask.stop();
  workerTask.close();
  assertEquals(10,capturedRecords.getValues().size());
  int offset=0;
  for (  Collection<SinkRecord> recs : capturedRecords.getValues()) {
    assertEquals(1,recs.size());
    for (    SinkRecord rec : recs) {
      SinkRecord referenceSinkRecord=new SinkRecord(TOPIC,PARTITION,KEY_SCHEMA,KEY,VALUE_SCHEMA,VALUE,FIRST_OFFSET + offset,TIMESTAMP,TIMESTAMP_TYPE);
      assertEquals(referenceSinkRecord,rec);
      offset++;
    }
  }
  PowerMock.verifyAll();
}
