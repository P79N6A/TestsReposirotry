@Test public void testCloseConnectionInClosingState() throws Exception {
  KafkaChannel channel=createConnectionWithStagedReceives(5);
  String id=channel.id();
  selector.mute(id);
  time.sleep(6000);
  selector.poll(0);
  assertNull("Channel not expired",selector.channel(id));
  assertEquals(channel,selector.closingChannel(id));
  assertEquals(ChannelState.EXPIRED,channel.state());
  selector.close(id);
  assertNull("Channel not removed from channels",selector.channel(id));
  assertNull("Channel not removed from closingChannels",selector.closingChannel(id));
  assertTrue("Unexpected disconnect notification",selector.disconnected().isEmpty());
  assertEquals(ChannelState.EXPIRED,channel.state());
  assertNull(channel.selectionKey().attachment());
  selector.poll(0);
  assertTrue("Unexpected disconnect notification",selector.disconnected().isEmpty());
}
