@Test public void testImmediatelyConnectedCleaned() throws Exception {
  Metrics metrics=new Metrics();
  Selector selector=new Selector(5000,metrics,time,"MetricGroup",channelBuilder,new LogContext()){
    @Override protected boolean doConnect(    SocketChannel channel,    InetSocketAddress address) throws IOException {
      channel.configureBlocking(true);
      boolean connected=super.doConnect(channel,address);
      channel.configureBlocking(false);
      return connected;
    }
  }
;
  try {
    testImmediatelyConnectedCleaned(selector,true);
    testImmediatelyConnectedCleaned(selector,false);
  }
  finally {
    selector.close();
    metrics.close();
  }
}
