@Test public void testOutboundConnectionsCountInConnectionCreationMetric() throws Exception {
  int expectedConnections=5;
  InetSocketAddress addr=new InetSocketAddress("localhost",server.port);
  for (int i=0; i < expectedConnections; i++)   connect(Integer.toString(i),addr);
  int seenConnections=0;
  for (int i=0; i < 10; i++) {
    selector.poll(100L);
    seenConnections+=selector.connected().size();
    if (seenConnections == expectedConnections)     break;
  }
  assertEquals((double)expectedConnections,getMetric("connection-creation-total").metricValue());
  assertEquals((double)expectedConnections,getMetric("connection-count").metricValue());
}
