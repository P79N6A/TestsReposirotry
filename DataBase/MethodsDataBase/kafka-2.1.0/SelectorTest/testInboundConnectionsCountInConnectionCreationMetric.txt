@Test public void testInboundConnectionsCountInConnectionCreationMetric() throws Exception {
  int conns=5;
  try (ServerSocketChannel ss=ServerSocketChannel.open()){
    ss.bind(new InetSocketAddress(0));
    InetSocketAddress serverAddress=(InetSocketAddress)ss.getLocalAddress();
    for (int i=0; i < conns; i++) {
      Thread sender=createSender(serverAddress,randomPayload(1));
      sender.start();
      SocketChannel channel=ss.accept();
      channel.configureBlocking(false);
      selector.register(Integer.toString(i),channel);
    }
  }
   assertEquals((double)conns,getMetric("connection-creation-total").metricValue());
  assertEquals((double)conns,getMetric("connection-count").metricValue());
}
