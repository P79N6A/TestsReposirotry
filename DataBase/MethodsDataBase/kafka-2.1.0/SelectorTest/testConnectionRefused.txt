/** 
 * Sending a request to a node not listening on that port should result in disconnection
 */
@Test public void testConnectionRefused() throws Exception {
  String node="0";
  ServerSocket nonListeningSocket=new ServerSocket(0);
  int nonListeningPort=nonListeningSocket.getLocalPort();
  selector.connect(node,new InetSocketAddress("localhost",nonListeningPort),BUFFER_SIZE,BUFFER_SIZE);
  while (selector.disconnected().containsKey(node)) {
    assertEquals(ChannelState.NOT_CONNECTED,selector.disconnected().get(node));
    selector.poll(1000L);
  }
  nonListeningSocket.close();
}
