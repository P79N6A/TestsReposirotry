@SuppressWarnings("unchecked") @Test public void shouldCreateConsumerRecordsFromKeyValuePairsWithCustomTimestampAndIncrementsAndNotAdvanceTime(){
  final ConsumerRecordFactory<String,Integer> factory=new ConsumerRecordFactory<>(topicName,stringSerializer,integerSerializer,0L);
  final KeyValue[] keyValuePairs=new KeyValue[5];
  final KeyValue[] rawKeyValuePairs=new KeyValue[keyValuePairs.length];
  for (int i=0; i < keyValuePairs.length; ++i) {
    keyValuePairs[i]=KeyValue.pair(key + "-" + i,value + i);
    rawKeyValuePairs[i]=KeyValue.pair(stringSerializer.serialize(topicName,key + "-" + i),integerSerializer.serialize(topicName,value + i));
  }
  final List<ConsumerRecord<byte[],byte[]>> records=factory.create(Arrays.<KeyValue<String,Integer>>asList(keyValuePairs),timestamp,2L);
  for (int i=0; i < keyValuePairs.length; ++i) {
    verifyRecord(topicName,(byte[])rawKeyValuePairs[i].key,(byte[])rawKeyValuePairs[i].value,timestamp + 2L * i,records.get(i));
  }
  verifyRecord(topicName,null,rawValue,0L,factory.create(value));
}
