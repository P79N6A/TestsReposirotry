@Test public void testAuthorizationFailed() throws UnknownHostException {
  connectionStates.connecting(nodeId1,time.milliseconds(),"localhost",ClientDnsLookup.DEFAULT);
  time.sleep(100);
  connectionStates.authenticationFailed(nodeId1,time.milliseconds(),new AuthenticationException("No path to CA for certificate!"));
  time.sleep(1000);
  assertEquals(connectionStates.connectionState(nodeId1),ConnectionState.AUTHENTICATION_FAILED);
  assertTrue(connectionStates.authenticationException(nodeId1) instanceof AuthenticationException);
  assertFalse(connectionStates.hasReadyNodes(time.milliseconds()));
  assertFalse(connectionStates.canConnect(nodeId1,time.milliseconds()));
  time.sleep(connectionStates.connectionDelay(nodeId1,time.milliseconds()) + 1);
  assertTrue(connectionStates.canConnect(nodeId1,time.milliseconds()));
  connectionStates.ready(nodeId1);
  assertNull(connectionStates.authenticationException(nodeId1));
}
