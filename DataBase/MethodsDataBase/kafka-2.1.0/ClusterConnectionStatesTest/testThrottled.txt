@Test public void testThrottled() throws UnknownHostException {
  connectionStates.connecting(nodeId1,time.milliseconds(),"localhost",ClientDnsLookup.DEFAULT);
  time.sleep(1000);
  connectionStates.ready(nodeId1);
  time.sleep(10000);
  assertEquals(0,connectionStates.throttleDelayMs(nodeId1,time.milliseconds()));
  connectionStates.throttle(nodeId1,time.milliseconds() + 100);
  assertEquals(100,connectionStates.throttleDelayMs(nodeId1,time.milliseconds()));
  time.sleep(50);
  assertEquals(50,connectionStates.throttleDelayMs(nodeId1,time.milliseconds()));
  assertEquals(50,connectionStates.pollDelayMs(nodeId1,time.milliseconds()));
  time.sleep(50);
  assertEquals(0,connectionStates.throttleDelayMs(nodeId1,time.milliseconds()));
  assertEquals(connectionStates.connectionDelay(nodeId1,time.milliseconds()),connectionStates.pollDelayMs(nodeId1,time.milliseconds()));
}
