@Test public void testMultipleNodeConnectionStates() throws UnknownHostException {
  assertTrue(connectionStates.canConnect(nodeId1,time.milliseconds()));
  assertTrue(connectionStates.canConnect(nodeId2,time.milliseconds()));
  assertFalse(connectionStates.hasReadyNodes(time.milliseconds()));
  connectionStates.connecting(nodeId2,time.milliseconds(),"localhost",ClientDnsLookup.DEFAULT);
  assertFalse(connectionStates.hasReadyNodes(time.milliseconds()));
  time.sleep(1000);
  connectionStates.ready(nodeId2);
  assertTrue(connectionStates.hasReadyNodes(time.milliseconds()));
  connectionStates.connecting(nodeId1,time.milliseconds(),"localhost",ClientDnsLookup.DEFAULT);
  assertTrue(connectionStates.hasReadyNodes(time.milliseconds()));
  time.sleep(1000);
  connectionStates.ready(nodeId1);
  assertTrue(connectionStates.hasReadyNodes(time.milliseconds()));
  time.sleep(12000);
  connectionStates.disconnected(nodeId2,time.milliseconds());
  assertTrue(connectionStates.hasReadyNodes(time.milliseconds()));
  assertTrue(connectionStates.isBlackedOut(nodeId2,time.milliseconds()));
  assertFalse(connectionStates.isBlackedOut(nodeId1,time.milliseconds()));
  time.sleep(connectionStates.connectionDelay(nodeId2,time.milliseconds()));
  connectionStates.disconnected(nodeId1,time.milliseconds() + 1);
  assertTrue(connectionStates.isBlackedOut(nodeId1,time.milliseconds()));
  assertFalse(connectionStates.isBlackedOut(nodeId2,time.milliseconds()));
  assertFalse(connectionStates.hasReadyNodes(time.milliseconds()));
}
