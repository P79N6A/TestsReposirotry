@Test public void testSetLastOffsetCompressed(){
  SimpleRecord[] simpleRecords=new SimpleRecord[]{new SimpleRecord(1L,"a".getBytes(),"1".getBytes()),new SimpleRecord(2L,"b".getBytes(),"2".getBytes()),new SimpleRecord(3L,"c".getBytes(),"3".getBytes())};
  MemoryRecords records=MemoryRecords.withRecords(RecordBatch.MAGIC_VALUE_V1,0L,CompressionType.GZIP,TimestampType.CREATE_TIME,simpleRecords);
  long lastOffset=500L;
  long firstOffset=lastOffset - simpleRecords.length + 1;
  ByteBufferLegacyRecordBatch batch=new ByteBufferLegacyRecordBatch(records.buffer());
  batch.setLastOffset(lastOffset);
  assertEquals(lastOffset,batch.lastOffset());
  assertEquals(firstOffset,batch.baseOffset());
  assertTrue(batch.isValid());
  List<MutableRecordBatch> recordBatches=Utils.toList(records.batches().iterator());
  assertEquals(1,recordBatches.size());
  assertEquals(lastOffset,recordBatches.get(0).lastOffset());
  long offset=firstOffset;
  for (  Record record : records.records())   assertEquals(offset++,record.offset());
}
