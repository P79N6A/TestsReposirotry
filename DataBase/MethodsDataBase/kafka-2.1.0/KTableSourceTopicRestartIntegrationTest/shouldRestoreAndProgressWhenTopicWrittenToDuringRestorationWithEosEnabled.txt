@Test public void shouldRestoreAndProgressWhenTopicWrittenToDuringRestorationWithEosEnabled() throws Exception {
  try {
    STREAMS_CONFIG.put(StreamsConfig.PROCESSING_GUARANTEE_CONFIG,StreamsConfig.EXACTLY_ONCE);
    streamsOne=new KafkaStreams(streamsBuilder.build(),STREAMS_CONFIG);
    streamsOne.start();
    produceKeyValues("a","b","c");
    assertNumberValuesRead(readKeyValues,expectedInitialResultsMap,"Table did not read all values");
    streamsOne.close();
    streamsOne=new KafkaStreams(streamsBuilder.build(),STREAMS_CONFIG);
    streamsOne.setGlobalStateRestoreListener(new UpdatingSourceTopicOnRestoreStartStateRestoreListener());
    streamsOne.start();
    produceKeyValues("f","g","h");
    assertNumberValuesRead(readKeyValues,expectedResultsWithDataWrittenDuringRestoreMap,"Table did not get all values after restart");
  }
  finally {
    streamsOne.close(Duration.ofSeconds(5));
  }
}
