@Test public void testSetPartitionLeaderEpoch(){
  MemoryRecords records=MemoryRecords.withRecords(RecordBatch.MAGIC_VALUE_V2,0L,CompressionType.NONE,TimestampType.CREATE_TIME,new SimpleRecord(1L,"a".getBytes(),"1".getBytes()),new SimpleRecord(2L,"b".getBytes(),"2".getBytes()),new SimpleRecord(3L,"c".getBytes(),"3".getBytes()));
  int leaderEpoch=500;
  DefaultRecordBatch batch=new DefaultRecordBatch(records.buffer());
  batch.setPartitionLeaderEpoch(leaderEpoch);
  assertEquals(leaderEpoch,batch.partitionLeaderEpoch());
  assertTrue(batch.isValid());
  List<MutableRecordBatch> recordBatches=Utils.toList(records.batches().iterator());
  assertEquals(1,recordBatches.size());
  assertEquals(leaderEpoch,recordBatches.get(0).partitionLeaderEpoch());
}
