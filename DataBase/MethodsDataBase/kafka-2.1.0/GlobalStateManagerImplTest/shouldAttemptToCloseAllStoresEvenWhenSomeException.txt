@Test public void shouldAttemptToCloseAllStoresEvenWhenSomeException() throws IOException {
  stateManager.initialize();
  initializeConsumer(1,1,t1);
  initializeConsumer(1,1,t2);
  final NoOpReadOnlyStore store=new NoOpReadOnlyStore("t1-store"){
    @Override public void close(){
      super.close();
      throw new RuntimeException("KABOOM!");
    }
  }
;
  stateManager.register(store,stateRestoreCallback);
  stateManager.register(store2,stateRestoreCallback);
  try {
    stateManager.close(Collections.<TopicPartition,Long>emptyMap());
  }
 catch (  final ProcessorStateException e) {
  }
  assertFalse(store.isOpen());
  assertFalse(store2.isOpen());
}
