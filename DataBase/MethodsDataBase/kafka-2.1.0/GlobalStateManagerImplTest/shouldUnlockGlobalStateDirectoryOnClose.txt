@Test public void shouldUnlockGlobalStateDirectoryOnClose() throws IOException {
  stateManager.initialize();
  stateManager.close(Collections.<TopicPartition,Long>emptyMap());
  final StateDirectory stateDir=new StateDirectory(streamsConfig,new MockTime());
  try {
    assertTrue(stateDir.lockGlobalState());
  }
  finally {
    stateDir.unlockGlobalState();
  }
}
