@Test public void shouldReleaseLockIfExceptionWhenLoadingCheckpoints() throws IOException {
  writeCorruptCheckpoint();
  try {
    stateManager.initialize();
  }
 catch (  final StreamsException e) {
  }
  final StateDirectory stateDir=new StateDirectory(streamsConfig,new MockTime());
  try {
    assertTrue(stateDir.lockGlobalState());
  }
  finally {
    stateDir.unlockGlobalState();
  }
}
