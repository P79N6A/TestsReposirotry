@Test public void testListenerGetsNotifiedOfUpdate(){
  long time=0;
  final Set<String> topics=new HashSet<>();
  metadata.update(Cluster.empty(),Collections.<String>emptySet(),time);
  metadata.addListener(new Metadata.Listener(){
    @Override public void onMetadataUpdate(    Cluster cluster,    Set<String> unavailableTopics){
      topics.clear();
      topics.addAll(cluster.topics());
    }
  }
);
  metadata.update(new Cluster(null,Arrays.asList(new Node(0,"host1",1000)),Arrays.asList(new PartitionInfo("topic",0,null,null,null),new PartitionInfo("topic1",0,null,null,null)),Collections.<String>emptySet(),Collections.<String>emptySet()),Collections.<String>emptySet(),100);
  assertEquals("Listener did not update topics list correctly",new HashSet<>(Arrays.asList("topic","topic1")),topics);
}
