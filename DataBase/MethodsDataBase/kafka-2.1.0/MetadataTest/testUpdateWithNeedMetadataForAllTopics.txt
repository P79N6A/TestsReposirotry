@Test public void testUpdateWithNeedMetadataForAllTopics(){
  long time=0;
  metadata.update(Cluster.empty(),Collections.<String>emptySet(),time);
  metadata.needMetadataForAllTopics(true);
  final List<String> expectedTopics=Collections.singletonList("topic");
  metadata.setTopics(expectedTopics);
  metadata.update(new Cluster(null,Collections.singletonList(new Node(0,"host1",1000)),Arrays.asList(new PartitionInfo("topic",0,null,null,null),new PartitionInfo("topic1",0,null,null,null)),Collections.<String>emptySet(),Collections.<String>emptySet()),Collections.<String>emptySet(),100);
  assertArrayEquals("Metadata got updated with wrong set of topics.",expectedTopics.toArray(),metadata.topics().toArray());
  metadata.needMetadataForAllTopics(false);
}
