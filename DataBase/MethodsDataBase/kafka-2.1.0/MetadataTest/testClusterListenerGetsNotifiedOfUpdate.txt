@Test public void testClusterListenerGetsNotifiedOfUpdate(){
  long time=0;
  MockClusterResourceListener mockClusterListener=new MockClusterResourceListener();
  ClusterResourceListeners listeners=new ClusterResourceListeners();
  listeners.maybeAdd(mockClusterListener);
  metadata=new Metadata(refreshBackoffMs,metadataExpireMs,true,false,listeners);
  String hostName="www.example.com";
  Cluster cluster=Cluster.bootstrap(Arrays.asList(new InetSocketAddress(hostName,9002)));
  metadata.update(cluster,Collections.<String>emptySet(),time);
  assertFalse("ClusterResourceListener should not called when metadata is updated with bootstrap Cluster",MockClusterResourceListener.IS_ON_UPDATE_CALLED.get());
  metadata.update(new Cluster("dummy",Arrays.asList(new Node(0,"host1",1000)),Arrays.asList(new PartitionInfo("topic",0,null,null,null),new PartitionInfo("topic1",0,null,null,null)),Collections.<String>emptySet(),Collections.<String>emptySet()),Collections.<String>emptySet(),100);
  assertEquals("MockClusterResourceListener did not get cluster metadata correctly","dummy",mockClusterListener.clusterResource().clusterId());
  assertTrue("MockClusterResourceListener should be called when metadata is updated with non-bootstrap Cluster",MockClusterResourceListener.IS_ON_UPDATE_CALLED.get());
}
