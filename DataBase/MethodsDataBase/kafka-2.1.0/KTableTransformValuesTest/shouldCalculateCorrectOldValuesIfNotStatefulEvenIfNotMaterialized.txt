@Test public void shouldCalculateCorrectOldValuesIfNotStatefulEvenIfNotMaterialized(){
  builder.table(INPUT_TOPIC,CONSUMED).transformValues(new StatelessTransformerSupplier()).groupBy(toForceSendingOfOldValues(),Serialized.with(Serdes.String(),Serdes.Integer())).reduce(MockReducer.INTEGER_ADDER,MockReducer.INTEGER_SUBTRACTOR).mapValues(mapBackToStrings()).toStream().process(capture);
  driver=new TopologyTestDriver(builder.build(),props());
  driver.pipeInput(recordFactory.create(INPUT_TOPIC,"A","a",0L));
  driver.pipeInput(recordFactory.create(INPUT_TOPIC,"A","aa",0L));
  driver.pipeInput(recordFactory.create(INPUT_TOPIC,"A","aaa",0L));
  assertThat(output(),hasItems("A:1","A:0","A:2","A:0","A:3"));
}
