/** 
 * Test the lazy down-conversion path in the presence of commit markers. When converting to V0 or V1, these batches are dropped. If there happen to be no more batches left to convert, we must get an overflow message batch after conversion.
 */
@Test public void testConversionOfCommitMarker() throws IOException {
  MemoryRecords recordsToConvert=MemoryRecords.withEndTransactionMarker(0,Time.SYSTEM.milliseconds(),RecordBatch.NO_PARTITION_LEADER_EPOCH,1,(short)1,new EndTransactionMarker(ControlRecordType.COMMIT,0));
  MemoryRecords convertedRecords=convertRecords(recordsToConvert,(byte)1,recordsToConvert.sizeInBytes());
  ByteBuffer buffer=convertedRecords.buffer();
  buffer.getLong();
  int sizeOfConvertedRecords=buffer.getInt();
  assertTrue(sizeOfConvertedRecords > buffer.limit());
  assertFalse(convertedRecords.batchIterator().hasNext());
}
