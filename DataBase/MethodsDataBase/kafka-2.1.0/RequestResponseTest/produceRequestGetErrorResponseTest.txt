@Test public void produceRequestGetErrorResponseTest(){
  ProduceRequest request=createProduceRequest(ApiKeys.PRODUCE.latestVersion());
  Set<TopicPartition> partitions=new HashSet<>(request.partitionRecordsOrFail().keySet());
  ProduceResponse errorResponse=(ProduceResponse)request.getErrorResponse(new NotEnoughReplicasException());
  assertEquals(partitions,errorResponse.responses().keySet());
  ProduceResponse.PartitionResponse partitionResponse=errorResponse.responses().values().iterator().next();
  assertEquals(Errors.NOT_ENOUGH_REPLICAS,partitionResponse.error);
  assertEquals(ProduceResponse.INVALID_OFFSET,partitionResponse.baseOffset);
  assertEquals(RecordBatch.NO_TIMESTAMP,partitionResponse.logAppendTime);
  request.clearPartitionRecords();
  errorResponse=(ProduceResponse)request.getErrorResponse(new NotEnoughReplicasException());
  assertEquals(partitions,errorResponse.responses().keySet());
  partitionResponse=errorResponse.responses().values().iterator().next();
  assertEquals(Errors.NOT_ENOUGH_REPLICAS,partitionResponse.error);
  assertEquals(ProduceResponse.INVALID_OFFSET,partitionResponse.baseOffset);
  assertEquals(RecordBatch.NO_TIMESTAMP,partitionResponse.logAppendTime);
}
