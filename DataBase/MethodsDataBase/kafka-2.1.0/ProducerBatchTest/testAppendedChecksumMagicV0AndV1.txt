@Test public void testAppendedChecksumMagicV0AndV1(){
  for (  byte magic : Arrays.asList(MAGIC_VALUE_V0,MAGIC_VALUE_V1)) {
    MemoryRecordsBuilder builder=MemoryRecords.builder(ByteBuffer.allocate(128),magic,CompressionType.NONE,TimestampType.CREATE_TIME,0L);
    ProducerBatch batch=new ProducerBatch(new TopicPartition("topic",1),builder,now);
    byte[] key="hi".getBytes();
    byte[] value="there".getBytes();
    FutureRecordMetadata future=batch.tryAppend(now,key,value,Record.EMPTY_HEADERS,null,now);
    assertNotNull(future);
    byte attributes=LegacyRecord.computeAttributes(magic,CompressionType.NONE,TimestampType.CREATE_TIME);
    long expectedChecksum=LegacyRecord.computeChecksum(magic,attributes,now,key,value);
    assertEquals(expectedChecksum,future.checksumOrNull().longValue());
  }
}
