@Test public void testBatchAbort() throws Exception {
  ProducerBatch batch=new ProducerBatch(new TopicPartition("topic",1),memoryRecordsBuilder,now);
  MockCallback callback=new MockCallback();
  FutureRecordMetadata future=batch.tryAppend(now,null,new byte[10],Record.EMPTY_HEADERS,callback,now);
  KafkaException exception=new KafkaException();
  batch.abort(exception);
  assertTrue(future.isDone());
  assertEquals(1,callback.invocations);
  assertEquals(exception,callback.exception);
  assertNull(callback.metadata);
  assertFalse(batch.done(500L,2342342341L,null));
  assertFalse(batch.done(-1,-1,new KafkaException()));
  assertEquals(1,callback.invocations);
  assertTrue(future.isDone());
  try {
    future.get();
    fail("Future should have thrown");
  }
 catch (  ExecutionException e) {
    assertEquals(exception,e.getCause());
  }
}
