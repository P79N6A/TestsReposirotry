@Test public void testProducerWithInvalidCredentials(){
  Map<String,Object> props=new HashMap<>(saslClientConfigs);
  props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,"localhost:" + server.port());
  StringSerializer serializer=new StringSerializer();
  try (KafkaProducer<String,String> producer=new KafkaProducer<>(props,serializer,serializer)){
    ProducerRecord<String,String> record=new ProducerRecord<>(topic,"message");
    producer.send(record).get();
    fail("Expected an authentication error!");
  }
 catch (  Exception e) {
    assertTrue("Expected SaslAuthenticationException, got " + e.getCause().getClass(),e.getCause() instanceof SaslAuthenticationException);
  }
}
