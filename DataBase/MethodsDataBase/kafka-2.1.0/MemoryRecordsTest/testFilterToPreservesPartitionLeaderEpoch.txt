@Test public void testFilterToPreservesPartitionLeaderEpoch(){
  if (magic >= RecordBatch.MAGIC_VALUE_V2) {
    int partitionLeaderEpoch=67;
    ByteBuffer buffer=ByteBuffer.allocate(2048);
    MemoryRecordsBuilder builder=MemoryRecords.builder(buffer,magic,compression,TimestampType.CREATE_TIME,0L,RecordBatch.NO_TIMESTAMP,partitionLeaderEpoch);
    builder.append(10L,null,"a".getBytes());
    builder.append(11L,"1".getBytes(),"b".getBytes());
    builder.append(12L,null,"c".getBytes());
    ByteBuffer filtered=ByteBuffer.allocate(2048);
    builder.build().filterTo(new TopicPartition("foo",0),new RetainNonNullKeysFilter(),filtered,Integer.MAX_VALUE,BufferSupplier.NO_CACHING);
    filtered.flip();
    MemoryRecords filteredRecords=MemoryRecords.readableRecords(filtered);
    List<MutableRecordBatch> batches=TestUtils.toList(filteredRecords.batches());
    assertEquals(1,batches.size());
    MutableRecordBatch firstBatch=batches.get(0);
    assertEquals(partitionLeaderEpoch,firstBatch.partitionLeaderEpoch());
  }
}
