@Test public void shouldOnlyCloseProducerIfFencedOnCommitDuringCleanCloseWithEosEnabled(){
  task=createStatelessTask(createConfig(true));
  task.initializeTopology();
  producer.fenceProducer();
  try {
    task.close(true,false);
    fail("should have thrown TaskMigratedException");
  }
 catch (  final TaskMigratedException expected) {
    task=null;
    assertTrue(expected.getCause() instanceof ProducerFencedException);
  }
  assertFalse(producer.transactionCommitted());
  assertTrue(producer.transactionInFlight());
  assertFalse(producer.transactionAborted());
  assertFalse(producer.transactionCommitted());
  assertTrue(producer.closed());
}
