@Test public void shouldNotCloseProducerIfFencedOnCloseDuringCleanCloseWithEosEnabled(){
  task=createStatelessTask(createConfig(true));
  task.initializeTopology();
  producer.fenceProducerOnClose();
  try {
    task.close(true,false);
    fail("should have thrown TaskMigratedException");
  }
 catch (  final TaskMigratedException expected) {
    task=null;
    assertTrue(expected.getCause() instanceof ProducerFencedException);
  }
  assertTrue(producer.transactionCommitted());
  assertFalse(producer.transactionInFlight());
  assertFalse(producer.closed());
}
