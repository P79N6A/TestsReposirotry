@Test public void testRegisterNonPersistentStore() throws IOException {
  final MockKeyValueStore nonPersistentStore=new MockKeyValueStore(nonPersistentStoreName,false);
  final ProcessorStateManager stateMgr=new ProcessorStateManager(new TaskId(0,2),noPartitions,false,stateDirectory,new HashMap<String,String>(){
{
      put(persistentStoreName,persistentStoreTopicName);
      put(nonPersistentStoreName,nonPersistentStoreTopicName);
    }
  }
,changelogReader,false,logContext);
  try {
    stateMgr.register(nonPersistentStore,nonPersistentStore.stateRestoreCallback);
    assertTrue(changelogReader.wasRegistered(new TopicPartition(nonPersistentStoreTopicName,2)));
  }
  finally {
    stateMgr.close(Collections.emptyMap());
  }
}
