@Test public void shouldThrowProcessorStateExceptionOnFlushIfStoreThrowsAnException() throws IOException {
  final ProcessorStateManager stateManager=new ProcessorStateManager(taskId,Collections.singleton(changelogTopicPartition),false,stateDirectory,Collections.singletonMap(storeName,changelogTopic),changelogReader,false,logContext);
  final MockKeyValueStore stateStore=new MockKeyValueStore(storeName,true){
    @Override public void flush(){
      throw new RuntimeException("KABOOM!");
    }
  }
;
  stateManager.register(stateStore,stateStore.stateRestoreCallback);
  try {
    stateManager.flush();
    fail("Should throw ProcessorStateException if store flush throws exception");
  }
 catch (  final ProcessorStateException e) {
  }
}
