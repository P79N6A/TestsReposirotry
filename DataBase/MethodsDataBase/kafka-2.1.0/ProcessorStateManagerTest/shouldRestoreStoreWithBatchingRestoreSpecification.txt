@Test public void shouldRestoreStoreWithBatchingRestoreSpecification() throws Exception {
  final TaskId taskId=new TaskId(0,2);
  final MockBatchingStateRestoreListener batchingRestoreCallback=new MockBatchingStateRestoreListener();
  final KeyValue<byte[],byte[]> expectedKeyValue=KeyValue.pair(key,value);
  final MockKeyValueStore persistentStore=getPersistentStore();
  final ProcessorStateManager stateMgr=getStandByStateManager(taskId);
  try {
    stateMgr.register(persistentStore,batchingRestoreCallback);
    stateMgr.updateStandbyStates(persistentStorePartition,singletonList(consumerRecord),consumerRecord.offset());
    assertThat(batchingRestoreCallback.getRestoredRecords().size(),is(1));
    assertTrue(batchingRestoreCallback.getRestoredRecords().contains(expectedKeyValue));
  }
  finally {
    stateMgr.close(Collections.emptyMap());
  }
}
