@Test public void testUpdatePositionOnEmptyBatch(){
  long producerId=1;
  short producerEpoch=0;
  int sequence=1;
  long baseOffset=37;
  long lastOffset=54;
  int partitionLeaderEpoch=7;
  ByteBuffer buffer=ByteBuffer.allocate(DefaultRecordBatch.RECORD_BATCH_OVERHEAD);
  DefaultRecordBatch.writeEmptyHeader(buffer,RecordBatch.CURRENT_MAGIC_VALUE,producerId,producerEpoch,sequence,baseOffset,lastOffset,partitionLeaderEpoch,TimestampType.CREATE_TIME,System.currentTimeMillis(),false,false);
  buffer.flip();
  MemoryRecords recordsWithEmptyBatch=MemoryRecords.readableRecords(buffer);
  subscriptions.assignFromUser(singleton(tp0));
  subscriptions.seek(tp0,0);
  assertEquals(1,fetcher.sendFetches());
  client.prepareResponse(fullFetchResponse(tp0,recordsWithEmptyBatch,Errors.NONE,100L,0));
  consumerClient.poll(time.timer(0));
  assertTrue(fetcher.hasCompletedFetches());
  Map<TopicPartition,List<ConsumerRecord<byte[],byte[]>>> allFetchedRecords=fetcher.fetchedRecords();
  assertTrue(allFetchedRecords.isEmpty());
  assertEquals(lastOffset + 1,subscriptions.position(tp0).longValue());
}
