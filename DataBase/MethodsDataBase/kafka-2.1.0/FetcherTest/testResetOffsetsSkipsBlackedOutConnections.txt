@Test public void testResetOffsetsSkipsBlackedOutConnections(){
  subscriptions.assignFromUser(singleton(tp0));
  subscriptions.requestOffsetReset(tp0,OffsetResetStrategy.EARLIEST);
  client.blackout(node,500);
  fetcher.resetOffsetsIfNeeded();
  assertEquals(0,consumerClient.pendingRequestCount());
  consumerClient.pollNoWakeup();
  assertTrue(subscriptions.isOffsetResetNeeded(tp0));
  assertEquals(OffsetResetStrategy.EARLIEST,subscriptions.resetStrategy(tp0));
  time.sleep(500);
  client.prepareResponse(listOffsetRequestMatcher(ListOffsetRequest.EARLIEST_TIMESTAMP),listOffsetResponse(Errors.NONE,1L,5L));
  fetcher.resetOffsetsIfNeeded();
  consumerClient.pollNoWakeup();
  assertFalse(subscriptions.isOffsetResetNeeded(tp0));
  assertTrue(subscriptions.isFetchable(tp0));
  assertEquals(5,subscriptions.position(tp0).longValue());
}
