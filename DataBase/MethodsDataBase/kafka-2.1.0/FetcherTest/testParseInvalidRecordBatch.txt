@Test public void testParseInvalidRecordBatch() throws Exception {
  MemoryRecords records=MemoryRecords.withRecords(RecordBatch.MAGIC_VALUE_V2,0L,CompressionType.NONE,TimestampType.CREATE_TIME,new SimpleRecord(1L,"a".getBytes(),"1".getBytes()),new SimpleRecord(2L,"b".getBytes(),"2".getBytes()),new SimpleRecord(3L,"c".getBytes(),"3".getBytes()));
  ByteBuffer buffer=records.buffer();
  buffer.putInt(32,buffer.get(32) ^ 87238423);
  subscriptions.assignFromUser(singleton(tp0));
  subscriptions.seek(tp0,0);
  assertEquals(1,fetcher.sendFetches());
  client.prepareResponse(fullFetchResponse(tp0,MemoryRecords.readableRecords(buffer),Errors.NONE,100L,0));
  consumerClient.poll(time.timer(0));
  try {
    fetcher.fetchedRecords();
    fail("fetchedRecords should have raised");
  }
 catch (  KafkaException e) {
    assertEquals(0,subscriptions.position(tp0).longValue());
  }
}
