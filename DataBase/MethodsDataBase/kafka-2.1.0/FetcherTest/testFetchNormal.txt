@Test public void testFetchNormal(){
  subscriptions.assignFromUser(singleton(tp0));
  subscriptions.seek(tp0,0);
  assertEquals(1,fetcher.sendFetches());
  assertFalse(fetcher.hasCompletedFetches());
  client.prepareResponse(fullFetchResponse(tp0,this.records,Errors.NONE,100L,0));
  consumerClient.poll(time.timer(0));
  assertTrue(fetcher.hasCompletedFetches());
  Map<TopicPartition,List<ConsumerRecord<byte[],byte[]>>> partitionRecords=fetcher.fetchedRecords();
  assertTrue(partitionRecords.containsKey(tp0));
  List<ConsumerRecord<byte[],byte[]>> records=partitionRecords.get(tp0);
  assertEquals(3,records.size());
  assertEquals(4L,subscriptions.position(tp0).longValue());
  long offset=1;
  for (  ConsumerRecord<byte[],byte[]> record : records) {
    assertEquals(offset,record.offset());
    offset+=1;
  }
}
