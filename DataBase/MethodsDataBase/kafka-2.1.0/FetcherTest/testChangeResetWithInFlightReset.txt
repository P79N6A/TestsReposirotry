@Test public void testChangeResetWithInFlightReset(){
  subscriptions.assignFromUser(singleton(tp0));
  subscriptions.requestOffsetReset(tp0,OffsetResetStrategy.LATEST);
  fetcher.resetOffsetsIfNeeded();
  consumerClient.pollNoWakeup();
  assertFalse(subscriptions.hasValidPosition(tp0));
  assertTrue(client.hasInFlightRequests());
  subscriptions.requestOffsetReset(tp0,OffsetResetStrategy.EARLIEST);
  client.respond(listOffsetResponse(Errors.NONE,1L,5L));
  consumerClient.pollNoWakeup();
  assertFalse(client.hasPendingResponses());
  assertFalse(client.hasInFlightRequests());
  assertTrue(subscriptions.isOffsetResetNeeded(tp0));
  assertEquals(OffsetResetStrategy.EARLIEST,subscriptions.resetStrategy(tp0));
}
