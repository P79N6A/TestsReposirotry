@Test(expected=TimeoutException.class) public void testBatchedListOffsetsMetadataErrors(){
  Map<TopicPartition,ListOffsetResponse.PartitionData> partitionData=new HashMap<>();
  partitionData.put(tp0,new ListOffsetResponse.PartitionData(Errors.NOT_LEADER_FOR_PARTITION,ListOffsetResponse.UNKNOWN_TIMESTAMP,ListOffsetResponse.UNKNOWN_OFFSET,Optional.empty()));
  partitionData.put(tp1,new ListOffsetResponse.PartitionData(Errors.UNKNOWN_TOPIC_OR_PARTITION,ListOffsetResponse.UNKNOWN_TIMESTAMP,ListOffsetResponse.UNKNOWN_OFFSET,Optional.empty()));
  client.prepareResponse(new ListOffsetResponse(0,partitionData));
  Map<TopicPartition,Long> offsetsToSearch=new HashMap<>();
  offsetsToSearch.put(tp0,ListOffsetRequest.EARLIEST_TIMESTAMP);
  offsetsToSearch.put(tp1,ListOffsetRequest.EARLIEST_TIMESTAMP);
  fetcher.offsetsByTimes(offsetsToSearch,time.timer(0));
}
