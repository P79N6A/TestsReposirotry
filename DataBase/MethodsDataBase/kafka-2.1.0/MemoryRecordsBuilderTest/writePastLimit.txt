@Test public void writePastLimit(){
  expectExceptionWithZStd(compressionType,RecordBatch.MAGIC_VALUE_V1);
  ByteBuffer buffer=ByteBuffer.allocate(64);
  buffer.position(bufferOffset);
  long logAppendTime=System.currentTimeMillis();
  MemoryRecordsBuilder builder=new MemoryRecordsBuilder(buffer,RecordBatch.MAGIC_VALUE_V1,compressionType,TimestampType.CREATE_TIME,0L,logAppendTime,RecordBatch.NO_PRODUCER_ID,RecordBatch.NO_PRODUCER_EPOCH,RecordBatch.NO_SEQUENCE,false,false,RecordBatch.NO_PARTITION_LEADER_EPOCH,buffer.capacity());
  builder.setEstimatedCompressionRatio(0.5f);
  builder.append(0L,"a".getBytes(),"1".getBytes());
  builder.append(1L,"b".getBytes(),"2".getBytes());
  assertFalse(builder.hasRoomFor(2L,"c".getBytes(),"3".getBytes(),Record.EMPTY_HEADERS));
  builder.append(2L,"c".getBytes(),"3".getBytes());
  MemoryRecords records=builder.build();
  MemoryRecordsBuilder.RecordsInfo info=builder.info();
  assertEquals(2L,info.maxTimestamp);
  assertEquals(2L,info.shallowOffsetOfMaxTimestamp);
  long i=0L;
  for (  RecordBatch batch : records.batches()) {
    assertEquals(TimestampType.CREATE_TIME,batch.timestampType());
    for (    Record record : batch)     assertEquals(i++,record.timestamp());
  }
}
