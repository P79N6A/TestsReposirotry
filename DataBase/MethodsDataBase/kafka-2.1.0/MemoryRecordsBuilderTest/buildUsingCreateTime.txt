@Test public void buildUsingCreateTime(){
  expectExceptionWithZStd(compressionType,RecordBatch.MAGIC_VALUE_V1);
  ByteBuffer buffer=ByteBuffer.allocate(1024);
  buffer.position(bufferOffset);
  long logAppendTime=System.currentTimeMillis();
  MemoryRecordsBuilder builder=new MemoryRecordsBuilder(buffer,RecordBatch.MAGIC_VALUE_V1,compressionType,TimestampType.CREATE_TIME,0L,logAppendTime,RecordBatch.NO_PRODUCER_ID,RecordBatch.NO_PRODUCER_EPOCH,RecordBatch.NO_SEQUENCE,false,false,RecordBatch.NO_PARTITION_LEADER_EPOCH,buffer.capacity());
  builder.append(0L,"a".getBytes(),"1".getBytes());
  builder.append(2L,"b".getBytes(),"2".getBytes());
  builder.append(1L,"c".getBytes(),"3".getBytes());
  MemoryRecords records=builder.build();
  MemoryRecordsBuilder.RecordsInfo info=builder.info();
  assertEquals(2L,info.maxTimestamp);
  if (compressionType == CompressionType.NONE)   assertEquals(1L,info.shallowOffsetOfMaxTimestamp);
 else   assertEquals(2L,info.shallowOffsetOfMaxTimestamp);
  int i=0;
  long[] expectedTimestamps=new long[]{0L,2L,1L};
  for (  RecordBatch batch : records.batches()) {
    assertEquals(TimestampType.CREATE_TIME,batch.timestampType());
    for (    Record record : batch)     assertEquals(expectedTimestamps[i++],record.timestamp());
  }
}
