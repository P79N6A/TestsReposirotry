@Test public void testFailureInPoll() throws Exception {
  createWorkerTask();
  sourceTask.initialize(EasyMock.anyObject(SourceTaskContext.class));
  EasyMock.expectLastCall();
  sourceTask.start(TASK_PROPS);
  EasyMock.expectLastCall();
  statusListener.onStartup(taskId);
  EasyMock.expectLastCall();
  final CountDownLatch pollLatch=new CountDownLatch(1);
  final RuntimeException exception=new RuntimeException();
  EasyMock.expect(sourceTask.poll()).andAnswer(new IAnswer<List<SourceRecord>>(){
    @Override public List<SourceRecord> answer() throws Throwable {
      pollLatch.countDown();
      throw exception;
    }
  }
);
  statusListener.onFailure(taskId,exception);
  EasyMock.expectLastCall();
  sourceTask.stop();
  EasyMock.expectLastCall();
  expectOffsetFlush(true);
  producer.close(EasyMock.anyLong(),EasyMock.anyObject(TimeUnit.class));
  EasyMock.expectLastCall();
  transformationChain.close();
  EasyMock.expectLastCall();
  PowerMock.replayAll();
  workerTask.initialize(TASK_CONFIG);
  Future<?> taskFuture=executor.submit(workerTask);
  assertTrue(awaitLatch(pollLatch));
  workerTask.stop();
  assertTrue(workerTask.awaitStop(1000));
  taskFuture.get();
  assertPollMetrics(0);
  PowerMock.verifyAll();
}
