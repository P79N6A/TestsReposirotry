@Test public void login1Commit1Logout1Login2Commit2Logout2() throws LoginException {
  Subject subject=new Subject();
  Set<Object> privateCredentials=subject.getPrivateCredentials();
  Set<Object> publicCredentials=subject.getPublicCredentials();
  OAuthBearerToken[] tokens=new OAuthBearerToken[]{mock(OAuthBearerToken.class),mock(OAuthBearerToken.class)};
  SaslExtensions[] extensions=new SaslExtensions[]{mock(SaslExtensions.class),mock(SaslExtensions.class)};
  TestCallbackHandler testTokenCallbackHandler=new TestCallbackHandler(tokens,extensions);
  OAuthBearerLoginModule loginModule1=new OAuthBearerLoginModule();
  loginModule1.initialize(subject,testTokenCallbackHandler,Collections.emptyMap(),Collections.emptyMap());
  OAuthBearerLoginModule loginModule2=new OAuthBearerLoginModule();
  loginModule2.initialize(subject,testTokenCallbackHandler,Collections.emptyMap(),Collections.emptyMap());
  assertEquals(0,privateCredentials.size());
  assertEquals(0,publicCredentials.size());
  loginModule1.login();
  assertEquals(0,privateCredentials.size());
  assertEquals(0,publicCredentials.size());
  loginModule1.commit();
  assertEquals(1,privateCredentials.size());
  assertEquals(1,publicCredentials.size());
  assertSame(tokens[0],privateCredentials.iterator().next());
  assertSame(extensions[0],publicCredentials.iterator().next());
  loginModule1.logout();
  assertEquals(0,privateCredentials.size());
  assertEquals(0,publicCredentials.size());
  loginModule2.login();
  assertEquals(0,privateCredentials.size());
  assertEquals(0,publicCredentials.size());
  loginModule2.commit();
  assertEquals(1,privateCredentials.size());
  assertEquals(1,publicCredentials.size());
  assertSame(tokens[1],privateCredentials.iterator().next());
  assertSame(extensions[1],publicCredentials.iterator().next());
  loginModule2.logout();
  assertEquals(0,privateCredentials.size());
  assertEquals(0,publicCredentials.size());
  verifyZeroInteractions((Object[])tokens);
  verifyZeroInteractions((Object[])extensions);
}
