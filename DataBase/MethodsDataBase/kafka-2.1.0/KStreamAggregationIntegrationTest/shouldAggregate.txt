@Test public void shouldAggregate() throws Exception {
  produceMessages(mockTime.milliseconds());
  groupedStream.aggregate(initializer,aggregator,Materialized.<String,Integer,KeyValueStore<Bytes,byte[]>>as("aggregate-by-selected-key")).toStream().to(outputTopic,Produced.with(Serdes.String(),Serdes.Integer()));
  startStreams();
  produceMessages(mockTime.milliseconds());
  final List<KeyValue<String,Integer>> results=receiveMessages(new StringDeserializer(),new IntegerDeserializer(),10);
  Collections.sort(results,KStreamAggregationIntegrationTest::compare);
  assertThat(results,is(Arrays.asList(KeyValue.pair("A",1),KeyValue.pair("A",2),KeyValue.pair("B",1),KeyValue.pair("B",2),KeyValue.pair("C",1),KeyValue.pair("C",2),KeyValue.pair("D",1),KeyValue.pair("D",2),KeyValue.pair("E",1),KeyValue.pair("E",2))));
}
