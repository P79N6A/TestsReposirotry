@SuppressWarnings("unchecked") @Test public void shouldNotThrowStreamsExceptionOnFlushIfASendFailedWithContinueExceptionHandler(){
  final RecordCollector collector=new RecordCollectorImpl("test",logContext,new AlwaysContinueProductionExceptionHandler(),new Metrics().sensor("skipped-records"));
  collector.init(new MockProducer(cluster,true,new DefaultPartitioner(),byteArraySerializer,byteArraySerializer){
    @Override public synchronized Future<RecordMetadata> send(    final ProducerRecord record,    final Callback callback){
      callback.onCompletion(null,new Exception());
      return null;
    }
  }
);
  collector.send("topic1","3","0",null,null,stringSerializer,stringSerializer,streamPartitioner);
  collector.flush();
}
