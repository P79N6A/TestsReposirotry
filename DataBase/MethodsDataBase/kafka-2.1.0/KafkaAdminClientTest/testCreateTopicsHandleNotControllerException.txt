@Test public void testCreateTopicsHandleNotControllerException() throws Exception {
  try (AdminClientUnitTestEnv env=mockClientEnv()){
    env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());
    env.kafkaClient().setNode(env.cluster().nodeById(0));
    env.kafkaClient().prepareResponseFrom(new CreateTopicsResponse(Collections.singletonMap("myTopic",new ApiError(Errors.NOT_CONTROLLER,""))),env.cluster().nodeById(0));
    env.kafkaClient().prepareResponse(new MetadataResponse(env.cluster().nodes(),env.cluster().clusterResource().clusterId(),1,Collections.<MetadataResponse.TopicMetadata>emptyList()));
    env.kafkaClient().prepareResponseFrom(new CreateTopicsResponse(Collections.singletonMap("myTopic",new ApiError(Errors.NONE,""))),env.cluster().nodeById(1));
    KafkaFuture<Void> future=env.adminClient().createTopics(Collections.singleton(new NewTopic("myTopic",Collections.singletonMap(0,asList(0,1,2)))),new CreateTopicsOptions().timeoutMs(10000)).all();
    future.get();
  }
 }
