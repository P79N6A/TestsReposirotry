@Test public void testUnexpectedRequestType() throws IOException {
  TransportLayer transportLayer=mock(TransportLayer.class);
  Map<String,?> configs=Collections.singletonMap(BrokerSecurityConfigs.SASL_ENABLED_MECHANISMS_CONFIG,Collections.singletonList(SCRAM_SHA_256.mechanismName()));
  SaslServerAuthenticator authenticator=setupAuthenticator(configs,transportLayer,SCRAM_SHA_256.mechanismName());
  final RequestHeader header=new RequestHeader(ApiKeys.METADATA,(short)0,"clientId",13243);
  final Struct headerStruct=header.toStruct();
  when(transportLayer.read(any(ByteBuffer.class))).then(invocation -> {
    invocation.<ByteBuffer>getArgument(0).putInt(headerStruct.sizeOf());
    return 4;
  }
).then(invocation -> {
    headerStruct.writeTo(invocation.getArgument(0));
    return headerStruct.sizeOf();
  }
);
  try {
    authenticator.authenticate();
    fail("Expected authenticate() to raise an exception");
  }
 catch (  IllegalSaslStateException e) {
  }
  verify(transportLayer,times(2)).read(any(ByteBuffer.class));
}
