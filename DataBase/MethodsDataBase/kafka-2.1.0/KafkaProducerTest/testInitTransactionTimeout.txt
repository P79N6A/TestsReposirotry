@Test(expected=TimeoutException.class) public void testInitTransactionTimeout(){
  Properties props=new Properties();
  props.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG,"bad-transaction");
  props.put(ProducerConfig.MAX_BLOCK_MS_CONFIG,5);
  props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,"localhost:9000");
  Time time=Time.SYSTEM;
  Cluster cluster=TestUtils.singletonCluster("topic",1);
  Node node=cluster.nodes().get(0);
  Metadata metadata=new Metadata(0,Long.MAX_VALUE,true);
  metadata.update(cluster,Collections.emptySet(),time.milliseconds());
  MockClient client=new MockClient(time,metadata);
  client.setNode(node);
  try (Producer<String,String> producer=new KafkaProducer<>(new ProducerConfig(ProducerConfig.addSerializerToConfig(props,new StringSerializer(),new StringSerializer())),null,null,metadata,client,null,time)){
    producer.initTransactions();
    fail("initTransactions() should have raised TimeoutException");
  }
 }
