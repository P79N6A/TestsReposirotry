@Test public void testPartitionerClose(){
  try {
    Properties props=new Properties();
    props.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,"localhost:9999");
    MockPartitioner.resetCounters();
    props.setProperty(ProducerConfig.PARTITIONER_CLASS_CONFIG,MockPartitioner.class.getName());
    KafkaProducer<String,String> producer=new KafkaProducer<>(props,new StringSerializer(),new StringSerializer());
    assertEquals(1,MockPartitioner.INIT_COUNT.get());
    assertEquals(0,MockPartitioner.CLOSE_COUNT.get());
    producer.close();
    assertEquals(1,MockPartitioner.INIT_COUNT.get());
    assertEquals(1,MockPartitioner.CLOSE_COUNT.get());
  }
  finally {
    MockPartitioner.resetCounters();
  }
}
