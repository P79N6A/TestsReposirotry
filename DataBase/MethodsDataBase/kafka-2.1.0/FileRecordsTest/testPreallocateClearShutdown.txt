/** 
 * Test the new FileRecords with pre allocate as true and file has been clearly shut down, the file will be truncate to end of valid data.
 */
@Test public void testPreallocateClearShutdown() throws IOException {
  File temp=tempFile();
  FileRecords fileRecords=FileRecords.open(temp,false,512 * 1024 * 1024,true);
  append(fileRecords,values);
  int oldPosition=(int)fileRecords.channel().position();
  int oldSize=fileRecords.sizeInBytes();
  assertEquals(this.fileRecords.sizeInBytes(),oldPosition);
  assertEquals(this.fileRecords.sizeInBytes(),oldSize);
  fileRecords.close();
  File tempReopen=new File(temp.getAbsolutePath());
  FileRecords setReopen=FileRecords.open(tempReopen,true,512 * 1024 * 1024,true);
  int position=(int)setReopen.channel().position();
  int size=setReopen.sizeInBytes();
  assertEquals(oldPosition,position);
  assertEquals(oldPosition,size);
  assertEquals(oldPosition,tempReopen.length());
}
