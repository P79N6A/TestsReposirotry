@Test public void testFormatConversionWithPartialMessage() throws IOException {
  RecordBatch batch=batches(fileRecords).get(1);
  int start=fileRecords.searchForOffsetWithSize(1,0).position;
  int size=batch.sizeInBytes();
  FileRecords slice=fileRecords.slice(start,size - 1);
  Records messageV0=slice.downConvert(RecordBatch.MAGIC_VALUE_V0,0,time).records();
  assertTrue("No message should be there",batches(messageV0).isEmpty());
  assertEquals("There should be " + (size - 1) + " bytes",size - 1,messageV0.sizeInBytes());
  TopicPartition tp=new TopicPartition("topic-1",0);
  LazyDownConversionRecords lazyRecords=new LazyDownConversionRecords(tp,slice,RecordBatch.MAGIC_VALUE_V0,0,Time.SYSTEM);
  Iterator<ConvertedRecords> it=lazyRecords.iterator(16 * 1024L);
  assertTrue("No messages should be returned",!it.hasNext());
}
