@Test public void sendWithinBlackoutPeriodAfterAuthenticationFailure() throws InterruptedException {
  client.authenticationFailed(node,300);
  client.prepareResponse(heartbeatResponse(Errors.NONE));
  final RequestFuture<ClientResponse> future=consumerClient.send(node,heartbeat());
  consumerClient.poll(future);
  assertTrue(future.failed());
  assertTrue("Expected only an authentication error.",future.exception() instanceof AuthenticationException);
  time.sleep(30);
  assertTrue(client.connectionFailed(node));
  final RequestFuture<ClientResponse> future2=consumerClient.send(node,heartbeat());
  consumerClient.poll(future2);
  assertTrue(future2.failed());
  assertTrue("Expected only an authentication error.",future2.exception() instanceof AuthenticationException);
}
