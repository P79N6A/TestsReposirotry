@Test public void testFutureCompletionOutsidePoll() throws Exception {
  final RequestFuture<ClientResponse> future=consumerClient.send(node,heartbeat());
  consumerClient.pollNoWakeup();
  client.enableBlockingUntilWakeup(2);
  Thread t1=new Thread(){
    @Override public void run(){
      consumerClient.pollNoWakeup();
    }
  }
;
  t1.start();
  Thread.sleep(50);
  Thread t2=new Thread(){
    @Override public void run(){
      consumerClient.poll(future);
    }
  }
;
  t2.start();
  Thread.sleep(50);
  client.respond(heartbeatResponse(Errors.NONE));
  client.wakeup();
  t1.join();
  t2.join();
  assertTrue(future.succeeded());
}
