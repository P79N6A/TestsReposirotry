@Test public void testDisconnectWakesUpPoll() throws Exception {
  final RequestFuture<ClientResponse> future=consumerClient.send(node,heartbeat());
  client.enableBlockingUntilWakeup(1);
  Thread t=new Thread(){
    @Override public void run(){
      consumerClient.poll(future);
    }
  }
;
  t.start();
  consumerClient.disconnectAsync(node);
  t.join();
  assertTrue(future.failed());
  assertTrue(future.exception() instanceof DisconnectException);
}
