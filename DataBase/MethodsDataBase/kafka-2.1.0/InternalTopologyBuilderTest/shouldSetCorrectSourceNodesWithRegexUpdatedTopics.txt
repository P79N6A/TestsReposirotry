@SuppressWarnings("unchecked") @Test public void shouldSetCorrectSourceNodesWithRegexUpdatedTopics() throws Exception {
  builder.addSource(null,"source-1",null,null,null,"topic-foo");
  builder.addSource(null,"source-2",null,null,null,Pattern.compile("topic-[A-C]"));
  builder.addSource(null,"source-3",null,null,null,Pattern.compile("topic-\\d"));
  final InternalTopologyBuilder.SubscriptionUpdates subscriptionUpdates=new InternalTopologyBuilder.SubscriptionUpdates();
  final Field updatedTopicsField=subscriptionUpdates.getClass().getDeclaredField("updatedTopicSubscriptions");
  updatedTopicsField.setAccessible(true);
  final Set<String> updatedTopics=(Set<String>)updatedTopicsField.get(subscriptionUpdates);
  updatedTopics.add("topic-B");
  updatedTopics.add("topic-3");
  updatedTopics.add("topic-A");
  builder.updateSubscriptions(subscriptionUpdates,null);
  builder.setApplicationId("test-id");
  final Map<Integer,InternalTopologyBuilder.TopicsInfo> topicGroups=builder.topicGroups();
  assertTrue(topicGroups.get(0).sourceTopics.contains("topic-foo"));
  assertTrue(topicGroups.get(1).sourceTopics.contains("topic-A"));
  assertTrue(topicGroups.get(1).sourceTopics.contains("topic-B"));
  assertTrue(topicGroups.get(2).sourceTopics.contains("topic-3"));
}
