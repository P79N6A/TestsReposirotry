@SuppressWarnings("unchecked") @Test public void shouldConnectRegexMatchedTopicsToStateStore() throws Exception {
  builder.addSource(null,"ingest",null,null,null,Pattern.compile("topic-\\d+"));
  builder.addProcessor("my-processor",new MockProcessorSupplier(),"ingest");
  builder.addStateStore(storeBuilder,"my-processor");
  final InternalTopologyBuilder.SubscriptionUpdates subscriptionUpdates=new InternalTopologyBuilder.SubscriptionUpdates();
  final Field updatedTopicsField=subscriptionUpdates.getClass().getDeclaredField("updatedTopicSubscriptions");
  updatedTopicsField.setAccessible(true);
  final Set<String> updatedTopics=(Set<String>)updatedTopicsField.get(subscriptionUpdates);
  updatedTopics.add("topic-2");
  updatedTopics.add("topic-3");
  updatedTopics.add("topic-A");
  builder.updateSubscriptions(subscriptionUpdates,"test-thread");
  builder.setApplicationId("test-app");
  final Map<String,List<String>> stateStoreAndTopics=builder.stateStoreNameToSourceTopics();
  final List<String> topics=stateStoreAndTopics.get(storeBuilder.name());
  assertTrue("Expected to contain two topics",topics.size() == 2);
  assertTrue(topics.contains("topic-2"));
  assertTrue(topics.contains("topic-3"));
  assertFalse(topics.contains("topic-A"));
}
