@Test public void shouldLogAndMeterOnNullKey(){
  final StreamsBuilder builder=new StreamsBuilder();
  builder.stream("TOPIC",Consumed.with(Serdes.String(),Serdes.String())).groupByKey(Serialized.with(Serdes.String(),Serdes.String())).windowedBy(TimeWindows.of(ofMillis(500L))).reduce((value1,value2) -> value1 + "+" + value2);
  try (final TopologyTestDriver driver=new TopologyTestDriver(builder.build(),props)){
    final LogCaptureAppender appender=LogCaptureAppender.createAndRegister();
    driver.pipeInput(recordFactory.create("TOPIC",null,"asdf"));
    LogCaptureAppender.unregister(appender);
    assertEquals(1.0,getMetricByName(driver.metrics(),"skipped-records-total","stream-metrics").metricValue());
    assertThat(appender.getMessages(),hasItem("Skipping record due to null key. value=[asdf] topic=[TOPIC] partition=[0] offset=[0]"));
  }
 }
