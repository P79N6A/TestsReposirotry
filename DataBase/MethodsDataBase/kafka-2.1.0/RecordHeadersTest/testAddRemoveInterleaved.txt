@Test public void testAddRemoveInterleaved(){
  Headers headers=new RecordHeaders();
  headers.add(new RecordHeader("key","value".getBytes()));
  headers.add(new RecordHeader("key2","value2".getBytes()));
  assertTrue(headers.iterator().hasNext());
  headers.remove("key");
  assertEquals(1,getCount(headers));
  headers.add(new RecordHeader("key3","value3".getBytes()));
  assertNull(headers.lastHeader("key"));
  assertHeader("key2","value2",headers.lastHeader("key2"));
  assertHeader("key3","value3",headers.lastHeader("key3"));
  assertEquals(2,getCount(headers));
  headers.remove("key2");
  assertNull(headers.lastHeader("key"));
  assertNull(headers.lastHeader("key2"));
  assertHeader("key3","value3",headers.lastHeader("key3"));
  assertEquals(1,getCount(headers));
  headers.add(new RecordHeader("key3","value4".getBytes()));
  assertHeader("key3","value4",headers.lastHeader("key3"));
  assertEquals(2,getCount(headers));
  headers.add(new RecordHeader("key","valueNew".getBytes()));
  assertEquals(3,getCount(headers));
  assertHeader("key","valueNew",headers.lastHeader("key"));
  headers.remove("key3");
  assertEquals(1,getCount(headers));
  assertNull(headers.lastHeader("key2"));
  headers.remove("key");
  assertFalse(headers.iterator().hasNext());
}
