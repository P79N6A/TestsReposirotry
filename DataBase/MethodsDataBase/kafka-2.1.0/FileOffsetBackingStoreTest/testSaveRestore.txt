@Test public void testSaveRestore() throws Exception {
  Callback<Void> setCallback=expectSuccessfulSetCallback();
  Callback<Map<ByteBuffer,ByteBuffer>> getCallback=expectSuccessfulGetCallback();
  PowerMock.replayAll();
  store.set(firstSet,setCallback).get();
  store.stop();
  FileOffsetBackingStore restore=new FileOffsetBackingStore();
  restore.configure(config);
  restore.start();
  Map<ByteBuffer,ByteBuffer> values=restore.get(Arrays.asList(buffer("key")),getCallback).get();
  assertEquals(buffer("value"),values.get(buffer("key")));
  PowerMock.verifyAll();
}
