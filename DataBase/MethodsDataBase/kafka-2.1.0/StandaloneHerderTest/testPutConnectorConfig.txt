@Test public void testPutConnectorConfig() throws Exception {
  Map<String,String> connConfig=connectorConfig(SourceSink.SOURCE);
  Map<String,String> newConnConfig=new HashMap<>(connConfig);
  newConnConfig.put("foo","bar");
  Callback<Map<String,String>> connectorConfigCb=PowerMock.createMock(Callback.class);
  Callback<Herder.Created<ConnectorInfo>> putConnectorConfigCb=PowerMock.createMock(Callback.class);
  connector=PowerMock.createMock(BogusSourceConnector.class);
  expectAdd(SourceSink.SOURCE);
  Connector connectorMock=PowerMock.createMock(SourceConnector.class);
  expectConfigValidation(connectorMock,true,connConfig);
  connectorConfigCb.onCompletion(null,connConfig);
  EasyMock.expectLastCall();
  worker.stopConnector(CONNECTOR_NAME);
  EasyMock.expectLastCall().andReturn(true);
  Capture<Map<String,String>> capturedConfig=EasyMock.newCapture();
  worker.startConnector(EasyMock.eq(CONNECTOR_NAME),EasyMock.capture(capturedConfig),EasyMock.<ConnectorContext>anyObject(),EasyMock.eq(herder),EasyMock.eq(TargetState.STARTED));
  EasyMock.expectLastCall().andReturn(true);
  EasyMock.expect(worker.isRunning(CONNECTOR_NAME)).andReturn(true);
  EasyMock.expect(worker.connectorTaskConfigs(CONNECTOR_NAME,new SourceConnectorConfig(plugins,newConnConfig))).andReturn(singletonList(taskConfig(SourceSink.SOURCE)));
  worker.isSinkConnector(CONNECTOR_NAME);
  EasyMock.expectLastCall().andReturn(false);
  ConnectorInfo newConnInfo=new ConnectorInfo(CONNECTOR_NAME,newConnConfig,Arrays.asList(new ConnectorTaskId(CONNECTOR_NAME,0)),ConnectorType.SOURCE);
  putConnectorConfigCb.onCompletion(null,new Herder.Created<>(false,newConnInfo));
  EasyMock.expectLastCall();
  expectConfigValidation(connectorMock,false,newConnConfig);
  connectorConfigCb.onCompletion(null,newConnConfig);
  EasyMock.expectLastCall();
  EasyMock.expect(worker.getPlugins()).andReturn(plugins).anyTimes();
  PowerMock.replayAll();
  herder.putConnectorConfig(CONNECTOR_NAME,connConfig,false,createCallback);
  herder.connectorConfig(CONNECTOR_NAME,connectorConfigCb);
  herder.putConnectorConfig(CONNECTOR_NAME,newConnConfig,true,putConnectorConfigCb);
  assertEquals("bar",capturedConfig.getValue().get("foo"));
  herder.connectorConfig(CONNECTOR_NAME,connectorConfigCb);
  PowerMock.verifyAll();
}
