@Test public void testTaskDestruction() throws Exception {
  MockTime time=new MockTime(0,0,0);
  Scheduler scheduler=new MockScheduler(time);
  try (MiniTrogdorCluster cluster=new MiniTrogdorCluster.Builder().addCoordinator("node01").addAgent("node01").addAgent("node02").scheduler(scheduler).build()){
    CoordinatorClient coordinatorClient=cluster.coordinatorClient();
    AgentClient agentClient1=cluster.agentClient("node01");
    AgentClient agentClient2=cluster.agentClient("node02");
    new ExpectedTasks().waitFor(coordinatorClient).waitFor(agentClient1).waitFor(agentClient2);
    NoOpTaskSpec fooSpec=new NoOpTaskSpec(2,2);
    coordinatorClient.destroyTask(new DestroyTaskRequest("foo"));
    coordinatorClient.createTask(new CreateTaskRequest("foo",fooSpec));
    NoOpTaskSpec barSpec=new NoOpTaskSpec(20,20);
    coordinatorClient.createTask(new CreateTaskRequest("bar",barSpec));
    coordinatorClient.destroyTask(new DestroyTaskRequest("bar"));
    new ExpectedTasks().addTask(new ExpectedTaskBuilder("foo").taskState(new TaskPending(fooSpec)).build()).waitFor(coordinatorClient).waitFor(agentClient1).waitFor(agentClient2);
    time.sleep(10);
    ObjectNode status1=new ObjectNode(JsonNodeFactory.instance);
    status1.set("node01",new TextNode("active"));
    status1.set("node02",new TextNode("active"));
    new ExpectedTasks().addTask(new ExpectedTaskBuilder("foo").taskState(new TaskRunning(fooSpec,10,status1)).build()).waitFor(coordinatorClient).waitFor(agentClient1).waitFor(agentClient2);
    coordinatorClient.destroyTask(new DestroyTaskRequest("foo"));
    new ExpectedTasks().waitFor(coordinatorClient).waitFor(agentClient1).waitFor(agentClient2);
  }
 }
