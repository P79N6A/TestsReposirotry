@Test public void testUpdateAndMoveToEnd(){
  PartitionStates<String> states=new PartitionStates<>();
  LinkedHashMap<TopicPartition,String> map=createMap();
  states.set(map);
  states.updateAndMoveToEnd(new TopicPartition("foo",0),"foo 0 updated");
  LinkedHashMap<TopicPartition,String> expected=new LinkedHashMap<>();
  expected.put(new TopicPartition("foo",2),"foo 2");
  expected.put(new TopicPartition("blah",2),"blah 2");
  expected.put(new TopicPartition("blah",1),"blah 1");
  expected.put(new TopicPartition("baz",2),"baz 2");
  expected.put(new TopicPartition("baz",3),"baz 3");
  expected.put(new TopicPartition("foo",0),"foo 0 updated");
  checkState(states,expected);
  states.updateAndMoveToEnd(new TopicPartition("baz",2),"baz 2 updated");
  expected=new LinkedHashMap<>();
  expected.put(new TopicPartition("foo",2),"foo 2");
  expected.put(new TopicPartition("blah",2),"blah 2");
  expected.put(new TopicPartition("blah",1),"blah 1");
  expected.put(new TopicPartition("baz",3),"baz 3");
  expected.put(new TopicPartition("foo",0),"foo 0 updated");
  expected.put(new TopicPartition("baz",2),"baz 2 updated");
  checkState(states,expected);
  states.updateAndMoveToEnd(new TopicPartition("baz",5),"baz 5 new");
  expected=new LinkedHashMap<>();
  expected.put(new TopicPartition("foo",2),"foo 2");
  expected.put(new TopicPartition("blah",2),"blah 2");
  expected.put(new TopicPartition("blah",1),"blah 1");
  expected.put(new TopicPartition("baz",3),"baz 3");
  expected.put(new TopicPartition("foo",0),"foo 0 updated");
  expected.put(new TopicPartition("baz",2),"baz 2 updated");
  expected.put(new TopicPartition("baz",5),"baz 5 new");
  checkState(states,expected);
  states.updateAndMoveToEnd(new TopicPartition("aaa",2),"aaa 2 new");
  expected=new LinkedHashMap<>();
  expected.put(new TopicPartition("foo",2),"foo 2");
  expected.put(new TopicPartition("blah",2),"blah 2");
  expected.put(new TopicPartition("blah",1),"blah 1");
  expected.put(new TopicPartition("baz",3),"baz 3");
  expected.put(new TopicPartition("foo",0),"foo 0 updated");
  expected.put(new TopicPartition("baz",2),"baz 2 updated");
  expected.put(new TopicPartition("baz",5),"baz 5 new");
  expected.put(new TopicPartition("aaa",2),"aaa 2 new");
  checkState(states,expected);
}
