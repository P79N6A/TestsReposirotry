@Test(expected=OverlappingFileLockException.class) public void shouldLockGlobalStateDirectory() throws IOException {
  directory.lockGlobalState();
  try (final FileChannel channel=FileChannel.open(new File(directory.globalStateDir(),StateDirectory.LOCK_FILE_NAME).toPath(),StandardOpenOption.CREATE,StandardOpenOption.WRITE)){
    channel.lock();
  }
  finally {
    directory.unlockGlobalState();
  }
}
