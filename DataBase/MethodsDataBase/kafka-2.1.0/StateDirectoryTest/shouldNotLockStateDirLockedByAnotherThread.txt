@Test public void shouldNotLockStateDirLockedByAnotherThread() throws IOException, InterruptedException {
  final TaskId taskId=new TaskId(0,0);
  final AtomicReference<IOException> exceptionOnThread=new AtomicReference<>();
  final Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      try {
        directory.lock(taskId);
      }
 catch (      final IOException e) {
        exceptionOnThread.set(e);
      }
    }
  }
);
  thread.start();
  thread.join(30000);
  assertNull("should not have had an exception during locking on other thread",exceptionOnThread.get());
  assertFalse(directory.lock(taskId));
}
