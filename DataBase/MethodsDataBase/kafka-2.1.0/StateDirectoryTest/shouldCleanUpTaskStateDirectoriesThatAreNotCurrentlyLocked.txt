@Test public void shouldCleanUpTaskStateDirectoriesThatAreNotCurrentlyLocked() throws IOException {
  final TaskId task0=new TaskId(0,0);
  final TaskId task1=new TaskId(1,0);
  try {
    directory.lock(task0);
    directory.lock(task1);
    directory.directoryForTask(new TaskId(2,0));
    List<File> files=Arrays.asList(appDir.listFiles());
    assertEquals(3,files.size());
    time.sleep(1000);
    directory.cleanRemovedTasks(0);
    files=Arrays.asList(appDir.listFiles());
    assertEquals(2,files.size());
    assertTrue(files.contains(new File(appDir,task0.toString())));
    assertTrue(files.contains(new File(appDir,task1.toString())));
  }
  finally {
    directory.unlock(task0);
    directory.unlock(task1);
  }
}
