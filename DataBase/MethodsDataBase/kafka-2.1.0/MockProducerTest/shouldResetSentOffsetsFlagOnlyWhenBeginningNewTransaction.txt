@Test public void shouldResetSentOffsetsFlagOnlyWhenBeginningNewTransaction(){
  buildMockProducer(true);
  producer.initTransactions();
  producer.beginTransaction();
  assertFalse(producer.sentOffsets());
  Map<TopicPartition,OffsetAndMetadata> groupCommit=new HashMap<TopicPartition,OffsetAndMetadata>(){
{
      put(new TopicPartition(topic,0),new OffsetAndMetadata(42L,null));
    }
  }
;
  producer.sendOffsetsToTransaction(groupCommit,"groupId");
  producer.commitTransaction();
  assertTrue(producer.sentOffsets());
  producer.beginTransaction();
  assertFalse(producer.sentOffsets());
}
