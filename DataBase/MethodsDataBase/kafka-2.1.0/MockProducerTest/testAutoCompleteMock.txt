@Test public void testAutoCompleteMock() throws Exception {
  buildMockProducer(true);
  Future<RecordMetadata> metadata=producer.send(record1);
  assertTrue("Send should be immediately complete",metadata.isDone());
  assertFalse("Send should be successful",isError(metadata));
  assertEquals("Offset should be 0",0L,metadata.get().offset());
  assertEquals(topic,metadata.get().topic());
  assertEquals("We should have the record in our history",singletonList(record1),producer.history());
  producer.clear();
  assertEquals("Clear should erase our history",0,producer.history().size());
}
