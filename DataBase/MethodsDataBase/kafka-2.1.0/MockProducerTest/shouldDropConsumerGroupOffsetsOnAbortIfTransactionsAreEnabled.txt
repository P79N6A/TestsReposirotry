@Test public void shouldDropConsumerGroupOffsetsOnAbortIfTransactionsAreEnabled(){
  buildMockProducer(true);
  producer.initTransactions();
  producer.beginTransaction();
  String group="g";
  Map<TopicPartition,OffsetAndMetadata> groupCommit=new HashMap<TopicPartition,OffsetAndMetadata>(){
{
      put(new TopicPartition(topic,0),new OffsetAndMetadata(42L,null));
      put(new TopicPartition(topic,1),new OffsetAndMetadata(73L,null));
    }
  }
;
  producer.sendOffsetsToTransaction(groupCommit,group);
  producer.abortTransaction();
  producer.beginTransaction();
  producer.commitTransaction();
  assertTrue(producer.consumerGroupOffsetsHistory().isEmpty());
}
