@Test public void shouldPreserveCommittedMessagesOnAbortIfTransactionsAreEnabled(){
  buildMockProducer(true);
  producer.initTransactions();
  producer.beginTransaction();
  producer.send(record1);
  producer.send(record2);
  producer.commitTransaction();
  producer.beginTransaction();
  producer.abortTransaction();
  List<ProducerRecord<byte[],byte[]>> expectedResult=new ArrayList<>();
  expectedResult.add(record1);
  expectedResult.add(record2);
  assertThat(producer.history(),equalTo(expectedResult));
}
