@Test public void testPartitioner() throws Exception {
  PartitionInfo partitionInfo0=new PartitionInfo(topic,0,null,null,null);
  PartitionInfo partitionInfo1=new PartitionInfo(topic,1,null,null,null);
  Cluster cluster=new Cluster(null,new ArrayList<Node>(0),asList(partitionInfo0,partitionInfo1),Collections.<String>emptySet(),Collections.<String>emptySet());
  MockProducer<String,String> producer=new MockProducer<>(cluster,true,new DefaultPartitioner(),new StringSerializer(),new StringSerializer());
  ProducerRecord<String,String> record=new ProducerRecord<>(topic,"key","value");
  Future<RecordMetadata> metadata=producer.send(record);
  assertEquals("Partition should be correct",1,metadata.get().partition());
  producer.clear();
  assertEquals("Clear should erase our history",0,producer.history().size());
  producer.close();
}
