@Test public void testConnectionClosedOnRegionLocate() throws IOException {
  Configuration testConf=new Configuration(this.conf);
  testConf.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,2);
  Connection connection=ConnectionFactory.createConnection(testConf);
  Table table=connection.getTable(TableName.META_TABLE_NAME);
  connection.close();
  try {
    Get get=new Get(Bytes.toBytes("dummyRow"));
    table.get(get);
    fail("Should have thrown DoNotRetryException but no exception thrown");
  }
 catch (  Exception e) {
    if (!(e instanceof DoNotRetryIOException)) {
      String errMsg="Should have thrown DoNotRetryException but actually " + e.getClass().getSimpleName();
      LOG.error(errMsg,e);
      fail(errMsg);
    }
  }
 finally {
    table.close();
  }
}
