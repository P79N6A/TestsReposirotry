@Ignore @Test public void testReadRequestsWithCoprocessor() throws Exception {
  TableName tableName=TableName.valueOf("testReadRequestsWithCoprocessor");
  TableDescriptorBuilder builder=TableDescriptorBuilder.newBuilder(tableName);
  builder.setColumnFamily(ColumnFamilyDescriptorBuilder.of(CF1));
  builder.setCoprocessor(ScanRegionCoprocessor.class.getName());
  admin.createTable(builder.build());
  try {
    TEST_UTIL.waitTableAvailable(tableName);
    List<RegionInfo> regionInfos=admin.getRegions(tableName);
    assertEquals("Table " + TABLE_NAME + " should have 1 region",1,regionInfos.size());
    boolean success=true;
    int i=0;
    for (; i < MAX_TRY; i++) {
      try {
        testReadRequests(regionInfos.get(0).getRegionName(),3);
      }
 catch (      Throwable t) {
        LOG.warn("Got exception when try " + i + " times",t);
        Thread.sleep(SLEEP_MS);
        success=false;
      }
      if (success) {
        break;
      }
    }
    if (i == MAX_TRY) {
      fail("Failed to get right read requests metric after try " + i + " times");
    }
  }
  finally {
    admin.disableTable(tableName);
    admin.deleteTable(tableName);
  }
}
