@Test public void testMerge() throws IOException, InterruptedException, ExecutionException, TimeoutException {
  try (Table table=createTable(true)){
    table.put(new Put(Bytes.toBytes(0)).addColumn(CF,CQ,Bytes.toBytes(0)));
    table.put(new Put(Bytes.toBytes(1)).addColumn(CF,CQ,Bytes.toBytes(0)));
    table.put(new Put(Bytes.toBytes(2)).addColumn(CF,CQ,Bytes.toBytes(0)));
  }
   UTIL.flush(NAME);
  MiniHBaseCluster cluster=UTIL.getMiniHBaseCluster();
  List<HRegion> regions=cluster.getRegions(NAME);
  HRegion regionA=regions.get(0);
  HRegion regionB=regions.get(1);
  HRegionServer rsA=cluster.getRegionServer(cluster.getServerWith(regionA.getRegionInfo().getRegionName()));
  HRegionServer rsB=cluster.getRegionServer(cluster.getServerWith(regionB.getRegionInfo().getRegionName()));
  UTIL.getAdmin().mergeRegionsAsync(regionA.getRegionInfo().getRegionName(),regionB.getRegionInfo().getRegionName(),false).get(1,TimeUnit.MINUTES);
  long maxSeqIdA=getMaxSeqId(rsA,regionA.getRegionInfo());
  long maxSeqIdB=getMaxSeqId(rsB,regionB.getRegionInfo());
  HRegionLocation loc=UTIL.getConnection().getRegionLocator(NAME).getRegionLocation(Bytes.toBytes(0),true);
  assertEquals(Math.max(maxSeqIdA,maxSeqIdB) + 1,loc.getSeqNum());
}
