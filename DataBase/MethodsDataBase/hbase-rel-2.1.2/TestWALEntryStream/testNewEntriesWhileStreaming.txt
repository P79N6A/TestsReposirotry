/** 
 * Tests that if writes come in while we have a stream open, we shouldn't miss them
 */
@Test public void testNewEntriesWhileStreaming() throws Exception {
  appendToLog("1");
  try (WALEntryStream entryStream=new WALEntryStream(walQueue,fs,CONF,0,log,null,new MetricsSource("1"))){
    entryStream.next();
    appendToLog("2");
    appendToLog("3");
    assertFalse(entryStream.hasNext());
    entryStream.reset();
    assertEquals("2",getRow(entryStream.next()));
    assertEquals("3",getRow(entryStream.next()));
    assertFalse(entryStream.hasNext());
  }
 }
