@Test public void testRecoveryAndDoubleExecution() throws Exception {
  final ProcedureExecutor<MasterProcedureEnv> procExec=getMasterProcedureExecutor();
  ProcedureTestingUtility.setKillAndToggleBeforeStoreUpdate(procExec,true);
  long procId=procExec.submitProcedure(new RestoreSnapshotProcedure(procExec.getEnvironment(),snapshotHTD,snapshot));
  MasterProcedureTestingUtility.testRecoveryAndDoubleExecution(procExec,procId);
  resetProcExecutorTestingKillFlag();
  validateSnapshotRestore();
}
