@Test public void testRestoreSnapshotToEnabledTable() throws Exception {
  final ProcedureExecutor<MasterProcedureEnv> procExec=getMasterProcedureExecutor();
  try {
    UTIL.getAdmin().enableTable(snapshotTableName);
    long procId=ProcedureTestingUtility.submitAndWait(procExec,new RestoreSnapshotProcedure(procExec.getEnvironment(),snapshotHTD,snapshot));
    Procedure<?> result=procExec.getResult(procId);
    assertTrue(result.isFailed());
    LOG.debug("Restore snapshot failed with exception: " + result.getException());
    assertTrue(ProcedureTestingUtility.getExceptionCause(result) instanceof TableNotDisabledException);
  }
  finally {
    UTIL.getAdmin().disableTable(snapshotTableName);
  }
}
