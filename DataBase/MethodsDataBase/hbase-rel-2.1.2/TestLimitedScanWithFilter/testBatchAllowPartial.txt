@Test public void testBatchAllowPartial() throws IOException {
  int limit=5;
  Scan scan=new Scan().setFilter(new ColumnCountOnRowFilter(3)).setBatch(2).setMaxResultSize(1).setAllowPartialResults(true).setLimit(limit);
  try (Table table=UTIL.getConnection().getTable(TABLE_NAME);ResultScanner scanner=table.getScanner(scan)){
    for (int i=0; i < 3 * limit; i++) {
      int key=i / 3;
      Result result=scanner.next();
      assertEquals(key,Bytes.toInt(result.getRow()));
      assertEquals(1,result.size());
      assertTrue(result.mayHaveMoreCellsInRow());
      int cqIndex=i % 3;
      assertEquals(key * (cqIndex + 1),Bytes.toInt(result.getValue(FAMILY,CQS[cqIndex])));
    }
    assertNull(scanner.next());
  }
 }
