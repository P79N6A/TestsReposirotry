@Test public void testScannerWithRestoreScanner() throws Exception {
  setupCluster();
  TableName tableName=TableName.valueOf("testScanner");
  String snapshotName="testScannerWithRestoreScanner";
  try {
    createTableAndSnapshot(UTIL,tableName,snapshotName,50);
    Path restoreDir=UTIL.getDataTestDirOnTestFS(snapshotName);
    Scan scan=new Scan(bbb,yyy);
    Configuration conf=UTIL.getConfiguration();
    Path rootDir=FSUtils.getRootDir(conf);
    TableSnapshotScanner scanner0=new TableSnapshotScanner(conf,restoreDir,snapshotName,scan);
    verifyScanner(scanner0,bbb,yyy);
    scanner0.close();
    RestoreSnapshotHelper.copySnapshotForScanner(conf,fs,rootDir,restoreDir,snapshotName);
    TableSnapshotScanner scanner=new TableSnapshotScanner(conf,rootDir,restoreDir,snapshotName,scan,true);
    verifyScanner(scanner,bbb,yyy);
    scanner.close();
    scanner=new TableSnapshotScanner(conf,rootDir,restoreDir,snapshotName,scan,true);
    verifyScanner(scanner,bbb,yyy);
    scanner.close();
    RestoreSnapshotHelper.copySnapshotForScanner(conf,fs,rootDir,restoreDir,snapshotName);
    scanner=new TableSnapshotScanner(conf,rootDir,restoreDir,snapshotName,scan,true);
    verifyScanner(scanner,bbb,yyy);
    scanner.close();
  }
  finally {
    UTIL.getAdmin().deleteSnapshot(snapshotName);
    UTIL.deleteTable(tableName);
    tearDownCluster();
  }
}
