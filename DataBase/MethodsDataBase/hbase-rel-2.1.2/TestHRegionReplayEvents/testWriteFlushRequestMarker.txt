/** 
 * Tests the case where a request for flush cache is sent to the region, but region cannot flush. It should write the flush request marker instead.
 */
@Test public void testWriteFlushRequestMarker() throws IOException {
  FlushResultImpl result=primaryRegion.flushcache(true,false,FlushLifeCycleTracker.DUMMY);
  assertNotNull(result);
  assertEquals(FlushResultImpl.Result.CANNOT_FLUSH_MEMSTORE_EMPTY,result.result);
  assertFalse(result.wroteFlushWalMarker);
  result=primaryRegion.flushcache(true,true,FlushLifeCycleTracker.DUMMY);
  assertNotNull(result);
  assertEquals(FlushResultImpl.Result.CANNOT_FLUSH_MEMSTORE_EMPTY,result.result);
  assertTrue(result.wroteFlushWalMarker);
  List<FlushDescriptor> flushes=Lists.newArrayList();
  reader=createWALReaderForPrimary();
  while (true) {
    WAL.Entry entry=reader.next();
    if (entry == null) {
      break;
    }
    FlushDescriptor flush=WALEdit.getFlushDescriptor(entry.getEdit().getCells().get(0));
    if (flush != null) {
      flushes.add(flush);
    }
  }
  assertEquals(1,flushes.size());
  assertNotNull(flushes.get(0));
  assertEquals(FlushDescriptor.FlushAction.CANNOT_FLUSH,flushes.get(0).getAction());
}
