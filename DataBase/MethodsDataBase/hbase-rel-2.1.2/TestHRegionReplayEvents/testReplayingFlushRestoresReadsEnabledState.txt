/** 
 * Test the case where the secondary region replica is not in reads enabled state because it is waiting for a flush or region open marker from primary region. Replaying flush start and commit entries should restore the reads enabled status in the region and allow the reads to continue.
 */
@Test public void testReplayingFlushRestoresReadsEnabledState() throws IOException {
  disableReads(secondaryRegion);
  putData(primaryRegion,Durability.SYNC_WAL,0,100,cq,families);
  primaryRegion.flush(true);
  putData(primaryRegion,Durability.SYNC_WAL,0,100,cq,families);
  reader=createWALReaderForPrimary();
  while (true) {
    WAL.Entry entry=reader.next();
    LOG.info(Objects.toString(entry));
    if (entry == null) {
      break;
    }
    FlushDescriptor flush=WALEdit.getFlushDescriptor(entry.getEdit().getCells().get(0));
    if (flush != null) {
      secondaryRegion.replayWALFlushMarker(flush,entry.getKey().getSequenceId());
    }
 else {
      replayEdit(secondaryRegion,entry);
    }
  }
  verifyData(secondaryRegion,0,100,cq,families);
}
