@Test public void testWithRegionServerFailover() throws Exception {
  AsyncTable<?> table=tableGetter.apply(TABLE_NAME);
  table.putAll(IntStream.range(0,COUNT).mapToObj(i -> new Put(getRow(i)).addColumn(FAMILY,CQ,Bytes.toBytes(i))).collect(Collectors.toList())).get();
  TEST_UTIL.getMiniHBaseCluster().getRegionServer(0).abort("Aborting for tests");
  Thread.sleep(100);
  table.putAll(IntStream.range(COUNT,2 * COUNT).mapToObj(i -> new Put(getRow(i)).addColumn(FAMILY,CQ,Bytes.toBytes(i))).collect(Collectors.toList())).get();
  List<Result> results=table.getAll(IntStream.range(0,2 * COUNT).mapToObj(i -> new Get(getRow(i))).collect(Collectors.toList())).get();
  assertEquals(2 * COUNT,results.size());
  results.forEach(r -> assertFalse(r.isEmpty()));
  table.deleteAll(IntStream.range(0,2 * COUNT).mapToObj(i -> new Delete(getRow(i))).collect(Collectors.toList())).get();
  results=table.getAll(IntStream.range(0,2 * COUNT).mapToObj(i -> new Get(getRow(i))).collect(Collectors.toList())).get();
  assertEquals(2 * COUNT,results.size());
  results.forEach(r -> assertTrue(r.isEmpty()));
}
