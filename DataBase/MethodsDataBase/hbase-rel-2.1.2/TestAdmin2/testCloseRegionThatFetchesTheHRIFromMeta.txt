@Test public void testCloseRegionThatFetchesTheHRIFromMeta() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  createTableWithDefaultConf(tableName);
  RegionInfo info=null;
  HRegionServer rs=TEST_UTIL.getRSForFirstRegionInTable(tableName);
  List<RegionInfo> onlineRegions=ProtobufUtil.getOnlineRegions(rs.getRSRpcServices());
  for (  RegionInfo regionInfo : onlineRegions) {
    if (!regionInfo.isMetaRegion()) {
      if (regionInfo.getRegionNameAsString().contains("TestHBACloseRegion2")) {
        info=regionInfo;
        admin.unassign(regionInfo.getRegionName(),true);
      }
    }
  }
  boolean isInList=ProtobufUtil.getOnlineRegions(rs.getRSRpcServices()).contains(info);
  long timeout=System.currentTimeMillis() + 10000;
  while ((System.currentTimeMillis() < timeout) && (isInList)) {
    Thread.sleep(100);
    isInList=ProtobufUtil.getOnlineRegions(rs.getRSRpcServices()).contains(info);
  }
  assertFalse("The region should not be present in online regions list.",isInList);
}
