@Test(expected=org.apache.hbase.thirdparty.com.google.protobuf.ServiceException.class) public void testProtoBufRpc() throws Exception {
  RpcClient rpcClient=RpcClientFactory.createClient(conf,HConstants.CLUSTER_ID_DEFAULT);
  try {
    BlockingInterface stub=newBlockingStub(rpcClient,this.isa);
    TestProtos.EmptyRequestProto emptyRequest=TestProtos.EmptyRequestProto.newBuilder().build();
    stub.ping(null,emptyRequest);
    EchoRequestProto echoRequest=EchoRequestProto.newBuilder().setMessage("hello").build();
    EchoResponseProto echoResponse=stub.echo(null,echoRequest);
    assertEquals("hello",echoResponse.getMessage());
    stub.error(null,emptyRequest);
    fail("Expected exception is not thrown");
  }
  finally {
    rpcClient.close();
  }
}
