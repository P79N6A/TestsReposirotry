@Test public void testTableCreateAndDeletePB() throws IOException, JAXBException {
  String schemaPath="/" + TABLE2 + "/schema";
  TableSchemaModel model;
  Response response;
  Admin admin=TEST_UTIL.getAdmin();
  assertFalse(admin.tableExists(TableName.valueOf(TABLE2)));
  model=testTableSchemaModel.buildTestModel(TABLE2);
  testTableSchemaModel.checkModel(model,TABLE2);
  if (csrfEnabled) {
    response=client.put(schemaPath,Constants.MIMETYPE_PROTOBUF,model.createProtobufOutput());
    assertEquals(400,response.getCode());
  }
  response=client.put(schemaPath,Constants.MIMETYPE_PROTOBUF,model.createProtobufOutput(),extraHdr);
  assertEquals("put failed with csrf " + (csrfEnabled ? "enabled" : "disabled"),201,response.getCode());
  conf.set("hbase.rest.readonly","true");
  response=client.put(schemaPath,Constants.MIMETYPE_PROTOBUF,model.createProtobufOutput(),extraHdr);
  assertNotNull(extraHdr);
  assertEquals(403,response.getCode());
  response=client.get(schemaPath,Constants.MIMETYPE_PROTOBUF);
  assertEquals(200,response.getCode());
  assertEquals(Constants.MIMETYPE_PROTOBUF,response.getHeader("content-type"));
  model=new TableSchemaModel();
  model.getObjectFromMessage(response.getBody());
  testTableSchemaModel.checkModel(model,TABLE2);
  response=client.get(schemaPath,Constants.MIMETYPE_PROTOBUF_IETF);
  assertEquals(200,response.getCode());
  assertEquals(Constants.MIMETYPE_PROTOBUF_IETF,response.getHeader("content-type"));
  model=new TableSchemaModel();
  model.getObjectFromMessage(response.getBody());
  testTableSchemaModel.checkModel(model,TABLE2);
  if (csrfEnabled) {
    response=client.delete(schemaPath);
    assertEquals(400,response.getCode());
  }
  response=client.delete(schemaPath,extraHdr);
  assertEquals(403,response.getCode());
  conf.set("hbase.rest.readonly","false");
  response=client.delete(schemaPath,extraHdr);
  assertEquals(200,response.getCode());
  assertFalse(admin.tableExists(TableName.valueOf(TABLE2)));
}
