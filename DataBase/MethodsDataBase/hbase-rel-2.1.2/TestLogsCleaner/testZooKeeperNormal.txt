/** 
 * When zk is working both files should be returned
 * @throws Exception
 */
@Test(timeout=10000) public void testZooKeeperNormal() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  ReplicationLogCleaner cleaner=new ReplicationLogCleaner();
  List<FileStatus> dummyFiles=Lists.newArrayList(new FileStatus(100,false,3,100,System.currentTimeMillis(),new Path("log1")),new FileStatus(100,false,3,100,System.currentTimeMillis(),new Path("log2")));
  ZKWatcher zkw=new ZKWatcher(conf,"testZooKeeperAbort-normal",null);
  try {
    cleaner.setConf(conf,zkw);
    cleaner.preClean();
    Iterable<FileStatus> filesToDelete=cleaner.getDeletableFiles(dummyFiles);
    Iterator<FileStatus> iter=filesToDelete.iterator();
    assertTrue(iter.hasNext());
    assertEquals(new Path("log1"),iter.next().getPath());
    assertTrue(iter.hasNext());
    assertEquals(new Path("log2"),iter.next().getPath());
    assertFalse(iter.hasNext());
  }
  finally {
    zkw.close();
  }
}
