@Test public void testOnConfigurationChange() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(LogCleaner.OLD_WALS_CLEANER_THREAD_SIZE,LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_SIZE);
  conf.setLong(LogCleaner.OLD_WALS_CLEANER_THREAD_TIMEOUT_MSEC,LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_TIMEOUT_MSEC);
  conf.setLong(LogCleaner.OLD_WALS_CLEANER_THREAD_CHECK_INTERVAL_MSEC,LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_CHECK_INTERVAL_MSEC);
  Server server=new DummyServer();
  Path oldWALsDir=new Path(TEST_UTIL.getDefaultRootDirPath(),HConstants.HREGION_OLDLOGDIR_NAME);
  FileSystem fs=TEST_UTIL.getDFSCluster().getFileSystem();
  LogCleaner cleaner=new LogCleaner(3000,server,conf,fs,oldWALsDir);
  assertEquals(LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_SIZE,cleaner.getSizeOfCleaners());
  assertEquals(LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_TIMEOUT_MSEC,cleaner.getCleanerThreadTimeoutMsec());
  assertEquals(LogCleaner.DEFAULT_OLD_WALS_CLEANER_THREAD_CHECK_INTERVAL_MSEC,cleaner.getCleanerThreadCheckIntervalMsec());
  fs.delete(oldWALsDir,true);
  fs.mkdirs(oldWALsDir);
  int numOfFiles=10;
  createFiles(fs,oldWALsDir,numOfFiles);
  FileStatus[] status=fs.listStatus(oldWALsDir);
  assertEquals(numOfFiles,status.length);
  Thread thread=new Thread(() -> cleaner.chore());
  thread.setDaemon(true);
  thread.start();
  int sizeToChange=4;
  long threadTimeoutToChange=30 * 1000L;
  long threadCheckIntervalToChange=250L;
  conf.setInt(LogCleaner.OLD_WALS_CLEANER_THREAD_SIZE,sizeToChange);
  conf.setLong(LogCleaner.OLD_WALS_CLEANER_THREAD_TIMEOUT_MSEC,threadTimeoutToChange);
  conf.setLong(LogCleaner.OLD_WALS_CLEANER_THREAD_CHECK_INTERVAL_MSEC,threadCheckIntervalToChange);
  cleaner.onConfigurationChange(conf);
  assertEquals(sizeToChange,cleaner.getSizeOfCleaners());
  assertEquals(threadTimeoutToChange,cleaner.getCleanerThreadTimeoutMsec());
  assertEquals(threadCheckIntervalToChange,cleaner.getCleanerThreadCheckIntervalMsec());
  thread.join();
  status=fs.listStatus(oldWALsDir);
  assertEquals(0,status.length);
}
