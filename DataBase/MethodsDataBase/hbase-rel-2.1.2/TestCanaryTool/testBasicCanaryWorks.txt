@Test public void testBasicCanaryWorks() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  Table table=testingUtility.createTable(tableName,new byte[][]{FAMILY});
  for (int i=0; i < 1000; i++) {
    byte[] iBytes=Bytes.toBytes(i);
    Put p=new Put(iBytes);
    p.addColumn(FAMILY,COLUMN,iBytes);
    table.put(p);
  }
  ExecutorService executor=new ScheduledThreadPoolExecutor(1);
  Canary.RegionStdOutSink sink=spy(new Canary.RegionStdOutSink());
  Canary canary=new Canary(executor,sink);
  String[] args={"-writeSniffing","-t","10000",tableName.getNameAsString()};
  assertEquals(0,ToolRunner.run(testingUtility.getConfiguration(),canary,args));
  assertEquals("verify no read error count",0,canary.getReadFailures().size());
  assertEquals("verify no write error count",0,canary.getWriteFailures().size());
  verify(sink,atLeastOnce()).publishReadTiming(isA(ServerName.class),isA(RegionInfo.class),isA(ColumnFamilyDescriptor.class),anyLong());
}
