@Test public void testSplitSwitch() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  Table t=TEST_UTIL.createTable(tableName,FAMILY);
  TEST_UTIL.loadTable(t,FAMILY,false);
  RegionLocator locator=TEST_UTIL.getConnection().getRegionLocator(t.getName());
  int originalCount=locator.getAllRegionLocations().size();
  Admin admin=TEST_UTIL.getAdmin();
  initSwitchStatus(admin);
  boolean[] results=admin.setSplitOrMergeEnabled(false,false,MasterSwitchType.SPLIT);
  assertEquals(1,results.length);
  assertTrue(results[0]);
  admin.split(t.getName());
  int count=admin.getTableRegions(tableName).size();
  assertTrue(originalCount == count);
  results=admin.setSplitOrMergeEnabled(true,false,MasterSwitchType.SPLIT);
  assertEquals(1,results.length);
  assertFalse(results[0]);
  admin.split(t.getName());
  while ((count=admin.getTableRegions(tableName).size()) == originalCount) {
    Threads.sleep(1);
    ;
  }
  count=admin.getTableRegions(tableName).size();
  assertTrue(originalCount < count);
  admin.close();
}
