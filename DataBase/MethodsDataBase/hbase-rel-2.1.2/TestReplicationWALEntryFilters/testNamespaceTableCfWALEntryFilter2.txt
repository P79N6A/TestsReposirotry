@Test public void testNamespaceTableCfWALEntryFilter2(){
  ReplicationPeer peer=mock(ReplicationPeer.class);
  ReplicationPeerConfig peerConfig=mock(ReplicationPeerConfig.class);
  when(peerConfig.replicateAllUserTables()).thenReturn(true);
  when(peerConfig.getExcludeNamespaces()).thenReturn(null);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(null);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  Entry userEntry=createEntry(null,a,b,c);
  ChainWALEntryFilter filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  Set<String> namespaces=new HashSet<String>();
  when(peerConfig.getExcludeNamespaces()).thenReturn(namespaces);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(null);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  namespaces.add("default");
  when(peerConfig.getExcludeNamespaces()).thenReturn(namespaces);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(null);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
  namespaces=new HashSet<String>();
  namespaces.add("ns1");
  when(peerConfig.getExcludeNamespaces()).thenReturn(namespaces);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(null);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  Map<TableName,List<String>> tableCfs=new HashMap<TableName,List<String>>();
  when(peerConfig.getExcludeNamespaces()).thenReturn(null);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(tableCfs);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  tableCfs=new HashMap<TableName,List<String>>();
  tableCfs.put(TableName.valueOf("bar"),null);
  when(peerConfig.getExcludeNamespaces()).thenReturn(null);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(tableCfs);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,a,b,c),filter.filter(userEntry));
  tableCfs=new HashMap<TableName,List<String>>();
  tableCfs.put(TableName.valueOf("foo"),Lists.newArrayList("a"));
  when(peerConfig.getExcludeNamespaces()).thenReturn(null);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(tableCfs);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,b,c),filter.filter(userEntry));
  namespaces=new HashSet<String>();
  tableCfs=new HashMap<TableName,List<String>>();
  namespaces.add("ns1");
  tableCfs.put(TableName.valueOf("foo"),Lists.newArrayList("a","c"));
  when(peerConfig.getExcludeNamespaces()).thenReturn(namespaces);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(tableCfs);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(createEntry(null,b),filter.filter(userEntry));
  namespaces=new HashSet<String>();
  tableCfs=new HashMap<TableName,List<String>>();
  namespaces.add("default");
  tableCfs.put(TableName.valueOf("ns1:bar"),new ArrayList<String>());
  when(peerConfig.getExcludeNamespaces()).thenReturn(namespaces);
  when(peerConfig.getExcludeTableCFsMap()).thenReturn(tableCfs);
  when(peer.getPeerConfig()).thenReturn(peerConfig);
  userEntry=createEntry(null,a,b,c);
  filter=new ChainWALEntryFilter(new NamespaceTableCfWALEntryFilter(peer));
  assertEquals(null,filter.filter(userEntry));
}
