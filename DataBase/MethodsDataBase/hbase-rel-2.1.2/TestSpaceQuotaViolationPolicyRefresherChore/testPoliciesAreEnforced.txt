@Test public void testPoliciesAreEnforced() throws IOException {
  final Map<TableName,SpaceQuotaSnapshot> policiesToEnforce=new HashMap<>();
  policiesToEnforce.put(TableName.valueOf("table1"),new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.DISABLE),1024L,512L));
  policiesToEnforce.put(TableName.valueOf("table2"),new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.NO_INSERTS),2048L,512L));
  policiesToEnforce.put(TableName.valueOf("table3"),new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.NO_WRITES),4096L,512L));
  policiesToEnforce.put(TableName.valueOf("table4"),new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.NO_WRITES_COMPACTIONS),8192L,512L));
  when(manager.copyQuotaSnapshots()).thenReturn(Collections.emptyMap());
  when(chore.fetchSnapshotsFromQuotaTable()).thenReturn(policiesToEnforce);
  chore.chore();
  for (  Entry<TableName,SpaceQuotaSnapshot> entry : policiesToEnforce.entrySet()) {
    verify(manager).enforceViolationPolicy(entry.getKey(),entry.getValue());
    verify(manager,never()).disableViolationPolicyEnforcement(entry.getKey());
  }
}
