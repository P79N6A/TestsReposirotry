/** 
 * Coprocessors shouldn't get notice of empty waledits.
 */
@Test public void testEmptyWALEditAreNotSeen() throws Exception {
  RegionInfo hri=createBasicHRegionInfo(Bytes.toString(TEST_TABLE));
  TableDescriptor htd=createBasic3FamilyHTD(Bytes.toString(TEST_TABLE));
  MultiVersionConcurrencyControl mvcc=new MultiVersionConcurrencyControl();
  NavigableMap<byte[],Integer> scopes=new TreeMap<>(Bytes.BYTES_COMPARATOR);
  for (  byte[] fam : htd.getColumnFamilyNames()) {
    scopes.put(fam,0);
  }
  WAL log=wals.getWAL(null);
  try {
    SampleRegionWALCoprocessor cp=getCoprocessor(log,SampleRegionWALCoprocessor.class);
    cp.setTestValues(TEST_TABLE,null,null,null,null,null,null,null);
    assertFalse(cp.isPreWALWriteCalled());
    assertFalse(cp.isPostWALWriteCalled());
    final long now=EnvironmentEdgeManager.currentTime();
    long txid=log.append(hri,new WALKeyImpl(hri.getEncodedNameAsBytes(),hri.getTable(),now,mvcc,scopes),new WALEdit(),true);
    log.sync(txid);
    assertFalse("Empty WALEdit should skip coprocessor evaluation.",cp.isPreWALWriteCalled());
    assertFalse("Empty WALEdit should skip coprocessor evaluation.",cp.isPostWALWriteCalled());
  }
  finally {
    log.close();
  }
}
