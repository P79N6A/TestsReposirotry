/** 
 * Test blocksize change from HBASE-20520 takes on both asycnfs and old wal provider. Hard to verify more than this given the blocksize is passed down to HDFS on create -- not kept local to the streams themselves.
 */
@Test public void testBlocksizeDefaultsToTwiceHDFSBlockSize() throws IOException {
  TableName tableName=TableName.valueOf("test");
  final WALFactory walFactory=new WALFactory(TEST_UTIL.getConfiguration(),this.walProvider);
  Configuration conf=TEST_UTIL.getConfiguration();
  WALProvider provider=walFactory.getWALProvider();
  WAL wal=provider.getWAL(null);
  if (wal instanceof AbstractFSWAL) {
    long expectedDefaultBlockSize=WALUtil.getWALBlockSize(conf,FileSystem.get(conf),TEST_UTIL.getDataTestDir());
    long blocksize=((AbstractFSWAL)wal).blocksize;
    assertEquals(expectedDefaultBlockSize,blocksize);
    LOG.info("Found blocksize of {} on {}",blocksize,wal);
  }
 else {
    fail("Unknown provider " + provider);
  }
}
