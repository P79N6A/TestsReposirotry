/** 
 * Tests the bulk assignment used during cluster startup. Round-robin. Should yield a balanced cluster so same invariant as the load balancer holds, all servers holding either floor(avg) or ceiling(avg).
 */
@Test public void testBulkAssignment() throws Exception {
  List<RegionInfo> regions=randomRegions(25);
  Map<ServerName,List<RegionInfo>> assignments=loadBalancer.roundRobinAssignment(regions,servers);
  loadBalancer.roundRobinAssignment(regions,Collections.EMPTY_LIST);
  assertTrue(assignments.keySet().size() == servers.size());
  for (  ServerName sn : assignments.keySet()) {
    List<RegionInfo> regionAssigned=assignments.get(sn);
    for (    RegionInfo region : regionAssigned) {
      TableName tableName=region.getTable();
      String groupName=getMockedGroupInfoManager().getRSGroupOfTable(tableName);
      assertTrue(StringUtils.isNotEmpty(groupName));
      RSGroupInfo gInfo=getMockedGroupInfoManager().getRSGroup(groupName);
      assertTrue("Region is not correctly assigned to group servers.",gInfo.containsServer(sn.getAddress()));
    }
  }
  ArrayListMultimap<String,ServerAndLoad> loadMap=convertToGroupBasedMap(assignments);
  assertClusterAsBalanced(loadMap);
}
