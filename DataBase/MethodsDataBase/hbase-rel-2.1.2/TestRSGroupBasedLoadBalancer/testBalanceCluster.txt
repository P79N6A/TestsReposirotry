/** 
 * Test the load balancing algorithm. Invariant is that all servers of the group should be hosting either floor(average) or ceiling(average)
 */
@Test public void testBalanceCluster() throws Exception {
  Map<ServerName,List<RegionInfo>> servers=mockClusterServers();
  ArrayListMultimap<String,ServerAndLoad> list=convertToGroupBasedMap(servers);
  LOG.info("Mock Cluster :  " + printStats(list));
  List<RegionPlan> plans=loadBalancer.balanceCluster(servers);
  ArrayListMultimap<String,ServerAndLoad> balancedCluster=reconcile(list,plans);
  LOG.info("Mock Balance : " + printStats(balancedCluster));
  assertClusterAsBalanced(balancedCluster);
}
