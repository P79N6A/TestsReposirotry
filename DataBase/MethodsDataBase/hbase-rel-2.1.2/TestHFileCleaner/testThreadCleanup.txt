@Test public void testThreadCleanup() throws Exception {
  Configuration conf=UTIL.getConfiguration();
  conf.setStrings(HFileCleaner.MASTER_HFILE_CLEANER_PLUGINS,"");
  Server server=new DummyServer();
  Path archivedHfileDir=new Path(UTIL.getDataTestDirOnTestFS(),HConstants.HFILE_ARCHIVE_DIRECTORY);
  FileSystem fs=UTIL.getDFSCluster().getFileSystem();
  HFileCleaner cleaner=new HFileCleaner(1000,server,conf,fs,archivedHfileDir);
  fs.delete(archivedHfileDir,true);
  fs.mkdirs(archivedHfileDir);
  fs.createNewFile(new Path(archivedHfileDir,"dfd-dfd"));
  cleaner.chore();
  cleaner.cleanup();
  Thread.sleep(100);
  for (  Thread thread : cleaner.getCleanerThreads()) {
    Assert.assertFalse(thread.isAlive());
  }
}
