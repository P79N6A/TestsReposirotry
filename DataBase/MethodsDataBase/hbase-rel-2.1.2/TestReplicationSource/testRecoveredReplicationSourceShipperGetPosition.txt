@Test public void testRecoveredReplicationSourceShipperGetPosition() throws Exception {
  String walGroupId="fake-wal-group-id";
  ServerName serverName=ServerName.valueOf("www.example.com",12006,1524679704418L);
  ServerName deadServer=ServerName.valueOf("www.deadServer.com",12006,1524679704419L);
  PriorityBlockingQueue<Path> queue=new PriorityBlockingQueue<>();
  queue.put(new Path("/www/html/test"));
  RecoveredReplicationSource source=Mockito.mock(RecoveredReplicationSource.class);
  Server server=Mockito.mock(Server.class);
  Mockito.when(server.getServerName()).thenReturn(serverName);
  Mockito.when(source.getServer()).thenReturn(server);
  Mockito.when(source.getServerWALsBelongTo()).thenReturn(deadServer);
  ReplicationQueueStorage storage=Mockito.mock(ReplicationQueueStorage.class);
  Mockito.when(storage.getWALPosition(Mockito.eq(serverName),Mockito.any(),Mockito.any())).thenReturn(1001L);
  Mockito.when(storage.getWALPosition(Mockito.eq(deadServer),Mockito.any(),Mockito.any())).thenReturn(-1L);
  conf.setInt("replication.source.maxretriesmultiplier",-1);
  RecoveredReplicationSourceShipper shipper=new RecoveredReplicationSourceShipper(conf,walGroupId,queue,source,storage);
  Assert.assertEquals(1001L,shipper.getStartPosition());
  conf.unset("replication.source.maxretriesmultiplier");
}
