@Test public void test() throws Exception {
  JVMClusterUtil.RegionServerThread rsThread=null;
  for (  JVMClusterUtil.RegionServerThread t : UTIL.getMiniHBaseCluster().getRegionServerThreads()) {
    if (!t.getRegionServer().getRegions(TABLE_NAME).isEmpty()) {
      rsThread=t;
      break;
    }
  }
  HRegionServer rs=rsThread.getRegionServer();
  RegionInfo hri=rs.getRegions(TABLE_NAME).get(0).getRegionInfo();
  MoveRegionProcedure moveRegionProcedure=new MoveRegionProcedure(UTIL.getMiniHBaseCluster().getMaster().getMasterProcedureExecutor().getEnvironment(),new RegionPlan(hri,rs.getServerName(),rs.getServerName()),true);
  long procID=UTIL.getMiniHBaseCluster().getMaster().getMasterProcedureExecutor().submitProcedure(moveRegionProcedure);
  countDownLatch.await();
  UTIL.getMiniHBaseCluster().stopMaster(0);
  UTIL.getMiniHBaseCluster().startMaster();
  UTIL.waitFor(30000,() -> UTIL.getMiniHBaseCluster().getMaster() != null && UTIL.getMiniHBaseCluster().getMaster().isInitialized());
  Assert.assertTrue("Should be 3 RS after master restart",UTIL.getMiniHBaseCluster().getLiveRegionServerThreads().size() == 3);
}
