@Test public void testShouldFlushMeta() throws Exception {
  Configuration conf=new Configuration();
  conf.setInt(HRegion.MEMSTORE_PERIODIC_FLUSH_INTERVAL,HRegion.SYSTEM_CACHE_FLUSH_INTERVAL * 10);
  HBaseTestingUtility hbaseUtility=HBaseTestingUtility.createLocalHTU(conf);
  Path testDir=hbaseUtility.getDataTestDir();
  EnvironmentEdgeForMemstoreTest edge=new EnvironmentEdgeForMemstoreTest();
  EnvironmentEdgeManager.injectEdge(edge);
  edge.setCurrentTimeMillis(1234);
  WALFactory wFactory=new WALFactory(conf,"1234");
  HRegion meta=HRegion.createHRegion(RegionInfoBuilder.FIRST_META_REGIONINFO,testDir,conf,FSTableDescriptors.createMetaTableDescriptor(conf),wFactory.getWAL(RegionInfoBuilder.FIRST_META_REGIONINFO));
  TableDescriptor desc=TableDescriptorBuilder.newBuilder(TableName.valueOf(name.getMethodName().replaceAll("[\\[\\]]","_"))).setColumnFamily(ColumnFamilyDescriptorBuilder.of("foo")).build();
  RegionInfo hri=RegionInfoBuilder.newBuilder(desc.getTableName()).setStartKey(Bytes.toBytes("row_0200")).setEndKey(Bytes.toBytes("row_0300")).build();
  HRegion r=HRegion.createHRegion(hri,testDir,conf,desc,wFactory.getWAL(hri));
  addRegionToMETA(meta,r);
  edge.setCurrentTimeMillis(1234 + 100);
  StringBuilder sb=new StringBuilder();
  assertTrue(meta.shouldFlush(sb) == false);
  edge.setCurrentTimeMillis(edge.currentTime() + HRegion.SYSTEM_CACHE_FLUSH_INTERVAL + 1);
  assertTrue(meta.shouldFlush(sb) == true);
}
