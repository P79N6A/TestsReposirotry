@Test public void test() throws IOException {
  try (Table t=TEST_UTIL.getConnection().getTable(TABLE)){
    byte[] val=makeLargeValue(VALUE_SIZE);
    Put p=new Put(ROW);
    for (int i=0; i < NUM_COLUMNS; i++) {
      p.addColumn(CF,Integer.toString(i).getBytes(),val);
    }
    t.put(p);
    Scan scan=new Scan();
    scan.withStartRow(ROW);
    scan.withStopRow(ROW,true);
    scan.setAllowPartialResults(true);
    scan.setMaxResultSize(2L * 1024 * 1024);
    scan.readVersions(1);
    ResultScanner scanner=t.getScanner(scan);
    int nResults=0;
    int nCells=0;
    for (Result result=scanner.next(); (result != null); result=scanner.next()) {
      nResults++;
      nCells+=result.listCells().size();
    }
    assertEquals(NUM_COLUMNS,nCells);
    assertTrue(nResults < 5);
  }
 }
