@Test public void testNonIdempotentOpsWithRetries() throws IOException {
  Path rootDir=TEST_UTIL.getDataTestDirOnTestFS(name.getMethodName());
  FileSystem fs=TEST_UTIL.getTestFileSystem();
  Configuration conf=TEST_UTIL.getConfiguration();
  RegionInfo hri=RegionInfoBuilder.newBuilder(TableName.valueOf(name.getMethodName())).build();
  HRegionFileSystem regionFs=HRegionFileSystem.createRegionOnFileSystem(conf,fs,rootDir,hri);
  assertTrue(fs.exists(regionFs.getRegionDir()));
  regionFs=new HRegionFileSystem(conf,new MockFileSystemForCreate(),rootDir,hri);
  boolean result=regionFs.createDir(new Path("/foo/bar"));
  assertTrue("Couldn't create the directory",result);
  regionFs=new HRegionFileSystem(conf,new MockFileSystem(),rootDir,hri);
  result=regionFs.rename(new Path("/foo/bar"),new Path("/foo/bar2"));
  assertTrue("Couldn't rename the directory",result);
  regionFs=new HRegionFileSystem(conf,new MockFileSystem(),rootDir,hri);
  result=regionFs.deleteDir(new Path("/foo/bar"));
  assertTrue("Couldn't delete the directory",result);
  fs.delete(rootDir,true);
}
