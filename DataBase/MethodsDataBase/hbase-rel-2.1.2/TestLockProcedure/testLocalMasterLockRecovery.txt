@Test public void testLocalMasterLockRecovery() throws Exception {
  ProcedureTestingUtility.setKillAndToggleBeforeStoreUpdate(procExec,true);
  CountDownLatch latch=new CountDownLatch(1);
  LockProcedure lockProc=new LockProcedure(UTIL.getConfiguration(),TableName.valueOf("table"),LockType.EXCLUSIVE,"desc",latch);
  procExec.submitProcedure(lockProc);
  assertTrue(latch.await(2000,TimeUnit.MILLISECONDS));
  ProcedureTestingUtility.waitProcedure(procExec,lockProc.getProcId());
  assertEquals(false,procExec.isRunning());
  ProcedureTestingUtility.setKillAndToggleBeforeStoreUpdate(procExec,false);
  ProcedureTestingUtility.restart(procExec);
  while (!procExec.isStarted(lockProc.getProcId())) {
    Thread.sleep(250);
  }
  assertEquals(true,procExec.isRunning());
  ProcedureTestingUtility.waitProcedure(procExec,lockProc.getProcId());
  Procedure<?> result=procExec.getResultOrProcedure(lockProc.getProcId());
  assertTrue(result != null && !result.isFailed());
  ProcedureTestingUtility.assertProcNotFailed(procExec,lockProc.getProcId());
}
