@Test public void testExceptionOnPolicyEnforcementDisable() throws Exception {
  final TableName tableName=TableName.valueOf("foo");
  final SpaceQuotaSnapshot snapshot=new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.DISABLE),1024L,2048L);
  RegionServerServices rss=mock(RegionServerServices.class);
  SpaceViolationPolicyEnforcementFactory factory=mock(SpaceViolationPolicyEnforcementFactory.class);
  SpaceViolationPolicyEnforcement enforcement=mock(SpaceViolationPolicyEnforcement.class);
  RegionServerSpaceQuotaManager realManager=new RegionServerSpaceQuotaManager(rss,factory);
  when(factory.create(rss,tableName,snapshot)).thenReturn(enforcement);
  doNothing().when(enforcement).enable();
  doThrow(new IOException("Failed for test!")).when(enforcement).disable();
  realManager.enforceViolationPolicy(tableName,snapshot);
  Map<TableName,SpaceViolationPolicyEnforcement> enforcements=realManager.copyActiveEnforcements();
  assertEquals(1,enforcements.size());
  realManager.disableViolationPolicyEnforcement(tableName);
  enforcements=realManager.copyActiveEnforcements();
  assertEquals(1,enforcements.size());
}
