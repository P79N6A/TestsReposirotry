@Test public void testExceptionOnPolicyEnforcementEnable() throws Exception {
  final TableName tableName=TableName.valueOf("foo");
  final SpaceQuotaSnapshot snapshot=new SpaceQuotaSnapshot(new SpaceQuotaStatus(SpaceViolationPolicy.DISABLE),1024L,2048L);
  RegionServerServices rss=mock(RegionServerServices.class);
  SpaceViolationPolicyEnforcementFactory factory=mock(SpaceViolationPolicyEnforcementFactory.class);
  SpaceViolationPolicyEnforcement enforcement=mock(SpaceViolationPolicyEnforcement.class);
  RegionServerSpaceQuotaManager realManager=new RegionServerSpaceQuotaManager(rss,factory);
  when(factory.create(rss,tableName,snapshot)).thenReturn(enforcement);
  doThrow(new IOException("Failed for test!")).when(enforcement).enable();
  realManager.enforceViolationPolicy(tableName,snapshot);
  Map<TableName,SpaceViolationPolicyEnforcement> enforcements=realManager.copyActiveEnforcements();
  assertTrue("Expected active enforcements to be empty, but were " + enforcements,enforcements.isEmpty());
}
