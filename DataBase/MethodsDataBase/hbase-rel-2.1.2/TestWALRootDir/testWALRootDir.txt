@Test public void testWALRootDir() throws Exception {
  RegionInfo regionInfo=RegionInfoBuilder.newBuilder(tableName).build();
  wals=new WALFactory(conf,"testWALRootDir");
  WAL log=wals.getWAL(regionInfo);
  assertEquals(1,getWALFiles(walFs,walRootDir).size());
  byte[] value=Bytes.toBytes("value");
  WALEdit edit=new WALEdit();
  edit.add(new KeyValue(rowName,family,Bytes.toBytes("1"),System.currentTimeMillis(),value));
  long txid=log.append(regionInfo,getWalKey(System.currentTimeMillis(),regionInfo,0),edit,true);
  log.sync(txid);
  assertEquals("Expect 1 log have been created",1,getWALFiles(walFs,walRootDir).size());
  log.rollWriter();
  assertEquals(2,getWALFiles(walFs,new Path(walRootDir,HConstants.HREGION_LOGDIR_NAME)).size());
  edit.add(new KeyValue(rowName,family,Bytes.toBytes("2"),System.currentTimeMillis(),value));
  txid=log.append(regionInfo,getWalKey(System.currentTimeMillis(),regionInfo,1),edit,true);
  log.sync(txid);
  log.rollWriter();
  log.shutdown();
  assertEquals("Expect 3 logs in WALs dir",3,getWALFiles(walFs,new Path(walRootDir,HConstants.HREGION_LOGDIR_NAME)).size());
}
