@Test public void testChangeToSerial() throws Exception {
  ReplicationPeerConfig peerConfig=ReplicationPeerConfig.newBuilder().setClusterKey("127.0.0.1:2181:/hbase").setReplicationEndpointImpl(LocalReplicationEndpoint.class.getName()).build();
  UTIL.getAdmin().addReplicationPeer(PEER_ID,peerConfig,true);
  TableName tableName=createTable();
  try (Table table=UTIL.getConnection().getTable(tableName)){
    for (int i=0; i < 100; i++) {
      table.put(new Put(Bytes.toBytes(i)).addColumn(CF,CQ,Bytes.toBytes(i)));
    }
  }
   RegionInfo region=UTIL.getAdmin().getRegions(tableName).get(0);
  HRegionServer srcRs=UTIL.getRSForFirstRegionInTable(tableName);
  HRegionServer rs=UTIL.getOtherRegionServer(srcRs);
  moveRegionAndArchiveOldWals(region,rs);
  waitUntilReplicationDone(100);
  waitUntilReplicatedToTheCurrentWALFile(srcRs);
  UTIL.getAdmin().disableReplicationPeer(PEER_ID);
  UTIL.getAdmin().updateReplicationPeerConfig(PEER_ID,ReplicationPeerConfig.newBuilder(peerConfig).setSerial(true).build());
  UTIL.getAdmin().enableReplicationPeer(PEER_ID);
  try (Table table=UTIL.getConnection().getTable(tableName)){
    for (int i=0; i < 100; i++) {
      table.put(new Put(Bytes.toBytes(i)).addColumn(CF,CQ,Bytes.toBytes(i)));
    }
  }
   waitUntilReplicationDone(200);
  checkOrder(200);
}
