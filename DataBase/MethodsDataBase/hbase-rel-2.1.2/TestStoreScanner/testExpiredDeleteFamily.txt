/** 
 * Ensure that expired delete family markers don't override valid puts
 */
@Test public void testExpiredDeleteFamily() throws Exception {
  long now=System.currentTimeMillis();
  KeyValue[] kvs=new KeyValue[]{new KeyValue(Bytes.toBytes("R1"),Bytes.toBytes("cf"),null,now - 1000,KeyValue.Type.DeleteFamily),create("R1","cf","a",now - 10,KeyValue.Type.Put,"dont-care")};
  List<KeyValueScanner> scanners=scanFixture(kvs);
  Scan scan=new Scan();
  scan.readVersions(1);
  ScanInfo scanInfo=new ScanInfo(CONF,CF,0,1,500,KeepDeletedCells.FALSE,HConstants.DEFAULT_BLOCKSIZE,0,CellComparator.getInstance(),false);
  try (StoreScanner scanner=new StoreScanner(scan,scanInfo,null,scanners)){
    List<Cell> results=new ArrayList<>();
    assertEquals(true,scanner.next(results));
    assertEquals(1,results.size());
    assertEquals(kvs[1],results.get(0));
    results.clear();
    assertEquals(false,scanner.next(results));
  }
 }
