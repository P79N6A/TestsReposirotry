/** 
 * Create a custom compaction request and be sure that we can track it through the queue, knowing when the compaction is completed.
 */
@Test public void testTrackingCompactionRequest() throws Exception {
  HRegionServer mockServer=Mockito.mock(HRegionServer.class);
  Mockito.when(mockServer.getConfiguration()).thenReturn(r.getBaseConf());
  CompactSplit thread=new CompactSplit(mockServer);
  Mockito.when(mockServer.getCompactSplitThread()).thenReturn(thread);
  HStore store=r.getStore(COLUMN_FAMILY);
  createStoreFile(r);
  for (int i=0; i < MAX_FILES_TO_COMPACT + 1; i++) {
    createStoreFile(r);
  }
  CountDownLatch latch=new CountDownLatch(1);
  Tracker tracker=new Tracker(latch);
  thread.requestCompaction(r,store,"test custom comapction",PRIORITY_USER,tracker,null);
  latch.await();
  thread.interruptIfNecessary();
}
