/** 
 * HBASE-7947: Regression test to ensure adding to the correct list in the {@link CompactSplit}
 * @throws Exception on failure
 */
@Test public void testMultipleCustomCompactionRequests() throws Exception {
  HRegionServer mockServer=Mockito.mock(HRegionServer.class);
  Mockito.when(mockServer.getConfiguration()).thenReturn(r.getBaseConf());
  CompactSplit thread=new CompactSplit(mockServer);
  Mockito.when(mockServer.getCompactSplitThread()).thenReturn(thread);
  int numStores=r.getStores().size();
  CountDownLatch latch=new CountDownLatch(numStores);
  Tracker tracker=new Tracker(latch);
  for (  HStore store : r.getStores()) {
    createStoreFile(r,store.getColumnFamilyName());
    createStoreFile(r,store.getColumnFamilyName());
    createStoreFile(r,store.getColumnFamilyName());
    thread.requestCompaction(r,store,"test mulitple custom comapctions",PRIORITY_USER,tracker,null);
  }
  latch.await();
  thread.interruptIfNecessary();
}
