@Test public void testRestoreSnapshot() throws Exception {
  verifyAllowed(new AccessReadAction(TEST_TABLE),USER_OWNER,USER_RO,USER_RW);
  verifyDenied(new AccessReadAction(TEST_TABLE),USER_NONE);
  verifyAllowed(new AccessWriteAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessWriteAction(TEST_TABLE),USER_RO,USER_NONE);
  loadData();
  verifyRows(TEST_TABLE);
  String snapshotName1=TEST_UTIL.getRandomUUID().toString();
  admin.snapshot(snapshotName1,TEST_TABLE);
  TableName tableName1=TableName.valueOf(TEST_UTIL.getRandomUUID().toString());
  admin.cloneSnapshot(snapshotName1,tableName1,true);
  verifyRows(tableName1);
  verifyAllowed(new AccessReadAction(tableName1),USER_OWNER,USER_RO,USER_RW);
  verifyDenied(new AccessReadAction(tableName1),USER_NONE);
  verifyAllowed(new AccessWriteAction(tableName1),USER_OWNER,USER_RW);
  verifyDenied(new AccessWriteAction(tableName1),USER_RO,USER_NONE);
  TableName tableName2=TableName.valueOf(TEST_UTIL.getRandomUUID().toString());
  admin.cloneSnapshot(snapshotName1,tableName2,false);
  verifyRows(tableName2);
  verifyAllowed(new AccessReadAction(tableName2),USER_OWNER);
  verifyDenied(new AccessReadAction(tableName2),USER_NONE,USER_RO,USER_RW);
  verifyAllowed(new AccessWriteAction(tableName2),USER_OWNER);
  verifyDenied(new AccessWriteAction(tableName2),USER_RO,USER_RW,USER_NONE);
  revokeFromTable(TEST_UTIL,USER_RO.getShortName(),TEST_TABLE,TEST_FAMILY,null,Permission.Action.READ);
  verifyAllowed(new AccessReadAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessReadAction(TEST_TABLE),USER_RO,USER_NONE);
  verifyAllowed(new AccessWriteAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessWriteAction(TEST_TABLE),USER_RO,USER_NONE);
  admin.disableTable(TEST_TABLE);
  admin.restoreSnapshot(snapshotName1,false,false);
  admin.enableTable(TEST_TABLE);
  verifyAllowed(new AccessReadAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessReadAction(TEST_TABLE),USER_RO,USER_NONE);
  verifyAllowed(new AccessWriteAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessWriteAction(TEST_TABLE),USER_RO,USER_NONE);
  admin.disableTable(TEST_TABLE);
  admin.restoreSnapshot(snapshotName1,false,true);
  admin.enableTable(TEST_TABLE);
  verifyAllowed(new AccessReadAction(TEST_TABLE),USER_OWNER,USER_RO,USER_RW);
  verifyDenied(new AccessReadAction(TEST_TABLE),USER_NONE);
  verifyAllowed(new AccessWriteAction(TEST_TABLE),USER_OWNER,USER_RW);
  verifyDenied(new AccessWriteAction(TEST_TABLE),USER_RO,USER_NONE);
}
