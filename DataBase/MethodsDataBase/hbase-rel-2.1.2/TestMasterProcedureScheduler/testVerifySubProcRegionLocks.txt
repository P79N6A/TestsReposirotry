@Test public void testVerifySubProcRegionLocks() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  final RegionInfo regionA=RegionInfoBuilder.newBuilder(tableName).setStartKey(Bytes.toBytes("a")).setEndKey(Bytes.toBytes("b")).build();
  final RegionInfo regionB=RegionInfoBuilder.newBuilder(tableName).setStartKey(Bytes.toBytes("b")).setEndKey(Bytes.toBytes("c")).build();
  final RegionInfo regionC=RegionInfoBuilder.newBuilder(tableName).setStartKey(Bytes.toBytes("c")).setEndKey(Bytes.toBytes("d")).build();
  queue.addBack(new TestTableProcedure(1,tableName,TableProcedureInterface.TableOperationType.ENABLE));
  Procedure<?> rootProc=queue.poll();
  assertEquals(1,rootProc.getProcId());
  assertEquals(false,queue.waitTableExclusiveLock(rootProc,tableName));
  assertEquals(null,queue.poll(0));
  Procedure<?>[] subProcs=new Procedure[]{new TestRegionProcedure(1,2,tableName,TableProcedureInterface.TableOperationType.REGION_EDIT,regionA),new TestRegionProcedure(1,3,tableName,TableProcedureInterface.TableOperationType.REGION_EDIT,regionB),new TestRegionProcedure(1,4,tableName,TableProcedureInterface.TableOperationType.REGION_EDIT,regionC)};
  for (int i=subProcs.length - 1; i >= 0; --i) {
    queue.addFront(subProcs[i]);
  }
  assertEquals(subProcs.length,queue.size());
  for (int i=0; i < subProcs.length; ++i) {
    TestRegionProcedure regionProc=(TestRegionProcedure)queue.poll(0);
    assertEquals(subProcs[i].getProcId(),regionProc.getProcId());
    assertEquals(false,queue.waitRegions(regionProc,tableName,regionProc.getRegionInfo()));
  }
  assertEquals(null,queue.poll(0));
  for (int i=0; i < subProcs.length; ++i) {
    TestRegionProcedure regionProc=(TestRegionProcedure)subProcs[i];
    queue.wakeRegions(regionProc,tableName,regionProc.getRegionInfo());
  }
  assertEquals(null,queue.poll(0));
  queue.wakeTableExclusiveLock(rootProc,tableName);
}
