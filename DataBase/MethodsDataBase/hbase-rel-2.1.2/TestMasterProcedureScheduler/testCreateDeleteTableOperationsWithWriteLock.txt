/** 
 * Check that the table queue is not deletable until every procedure in-progress is completed (this is a special case for write-locks).
 */
@Test public void testCreateDeleteTableOperationsWithWriteLock() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  final TestTableProcedure dummyProc=new TestTableProcedure(100,tableName,TableProcedureInterface.TableOperationType.DELETE);
  queue.addBack(new TestTableProcedure(1,tableName,TableProcedureInterface.TableOperationType.EDIT));
  assertFalse(queue.markTableAsDeleted(tableName,dummyProc));
  Procedure<?> proc=queue.poll();
  assertEquals(1,proc.getProcId());
  assertEquals(false,queue.waitTableExclusiveLock(proc,tableName));
  assertEquals(0,queue.size());
  assertFalse(queue.markTableAsDeleted(tableName,dummyProc));
  queue.wakeTableExclusiveLock(proc,tableName);
  assertTrue(queue.markTableAsDeleted(tableName,proc));
}
