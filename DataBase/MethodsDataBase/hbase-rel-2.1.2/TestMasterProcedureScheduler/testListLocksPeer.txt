@Test public void testListLocksPeer() throws Exception {
  String peerId="1";
  LockProcedure procedure=createExclusiveLockProcedure(4);
  queue.waitPeerExclusiveLock(procedure,peerId);
  List<LockedResource> locks=queue.getLocks();
  assertEquals(1,locks.size());
  LockedResource resource=locks.get(0);
  assertLockResource(resource,LockedResourceType.PEER,peerId);
  assertExclusiveLock(resource,procedure);
  assertTrue(resource.getWaitingProcedures().isEmpty());
  assertFalse(queue.waitPeerExclusiveLock(procedure,peerId));
  LockProcedure procedure2=createExclusiveLockProcedure(5);
  assertTrue(queue.waitPeerExclusiveLock(procedure2,peerId));
  locks=queue.getLocks();
  assertEquals(1,locks.size());
  resource=locks.get(0);
  assertLockResource(resource,LockedResourceType.PEER,peerId);
  assertExclusiveLock(resource,procedure);
  assertEquals(1,resource.getWaitingProcedures().size());
}
