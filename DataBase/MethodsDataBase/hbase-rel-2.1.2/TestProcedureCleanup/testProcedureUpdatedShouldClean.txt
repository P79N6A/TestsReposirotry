@Test public void testProcedureUpdatedShouldClean() throws Exception {
  createProcExecutor();
  SuspendProcedure suspendProcedure=new SuspendProcedure();
  long suspendProc=procExecutor.submitProcedure(suspendProcedure);
  LOG.info("Begin to execute " + suspendProc);
  suspendProcedure.latch.countDown();
  Thread.sleep(500);
  LOG.info("begin to restart1 ");
  ProcedureTestingUtility.restart(procExecutor,true);
  LOG.info("finish to restart1 ");
  htu.waitFor(10000,() -> procExecutor.getProcedure(suspendProc) != null);
  suspendProcedure=(SuspendProcedure)procExecutor.getProcedure(suspendProc);
  suspendProcedure.latch.countDown();
  Thread.sleep(500);
  assertTrue(procStore.getActiveLogs().size() == 1);
  LOG.info("begin to restart2");
  ProcedureTestingUtility.restart(procExecutor,true,false);
  LOG.info("finish to restart2");
  assertTrue(procStore.getActiveLogs().size() == 2);
  procExecutor.startWorkers();
}
