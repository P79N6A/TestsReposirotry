@Test public void testRegionAvailability() throws Exception {
  List<RegionInfo> list0=new ArrayList<>();
  List<RegionInfo> list1=new ArrayList<>();
  List<RegionInfo> list2=new ArrayList<>();
  RegionInfo hri1=RegionInfoBuilder.newBuilder(TableName.valueOf(name.getMethodName())).setStartKey("key1".getBytes()).setEndKey("key2".getBytes()).setSplit(false).setRegionId(100).build();
  RegionInfo hri2=RegionReplicaUtil.getRegionInfoForReplica(hri1,1);
  RegionInfo hri3=RegionInfoBuilder.newBuilder(TableName.valueOf(name.getMethodName())).setStartKey("key2".getBytes()).setEndKey("key3".getBytes()).setSplit(false).setRegionId(101).build();
  list0.add(hri1);
  list1.add(hri2);
  list2.add(hri3);
  Map<ServerName,List<RegionInfo>> clusterState=new LinkedHashMap<>();
  clusterState.put(servers[0],list0);
  clusterState.put(servers[1],list1);
  clusterState.put(servers[2],list2);
  Cluster cluster=new Cluster(clusterState,null,null,rackManager);
  assertTrue(cluster.wouldLowerAvailability(hri1,servers[1]));
  assertTrue(!cluster.wouldLowerAvailability(hri1,servers[2]));
  assertTrue(!cluster.wouldLowerAvailability(hri2,servers[2]));
  assertTrue(!cluster.wouldLowerAvailability(hri3,servers[1]));
  list1.add(RegionReplicaUtil.getRegionInfoForReplica(hri3,1));
  cluster=new Cluster(clusterState,null,null,rackManager);
  assertTrue(cluster.wouldLowerAvailability(hri3,servers[1]));
  clusterState.clear();
  clusterState.put(servers[0],list0);
  clusterState.put(servers[5],list1);
  clusterState.put(servers[6],list2);
  clusterState.put(servers[10],new ArrayList<>());
  cluster=new Cluster(clusterState,null,null,rackManager);
  assertTrue(cluster.wouldLowerAvailability(hri1,servers[0]));
  cluster=new Cluster(clusterState,null,null,null);
  assertTrue(!cluster.wouldLowerAvailability(hri1,servers[6]));
}
