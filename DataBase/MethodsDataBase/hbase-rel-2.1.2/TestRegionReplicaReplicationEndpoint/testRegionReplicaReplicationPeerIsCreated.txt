@Test public void testRegionReplicaReplicationPeerIsCreated() throws IOException, ReplicationException {
  ReplicationAdmin admin=new ReplicationAdmin(HTU.getConfiguration());
  String peerId="region_replica_replication";
  ReplicationPeerConfig peerConfig=null;
  try {
    peerConfig=admin.getPeerConfig(peerId);
  }
 catch (  ReplicationPeerNotFoundException e) {
    LOG.warn("Region replica replication peer id=" + peerId + " not exist",e);
  }
  if (peerConfig != null) {
    admin.removePeer(peerId);
    peerConfig=null;
  }
  HTableDescriptor htd=HTU.createTableDescriptor("testReplicationPeerIsCreated_no_region_replicas");
  HTU.getAdmin().createTable(htd);
  try {
    peerConfig=admin.getPeerConfig(peerId);
    fail("Should throw ReplicationException, because replication peer id=" + peerId + " not exist");
  }
 catch (  ReplicationPeerNotFoundException e) {
  }
  assertNull(peerConfig);
  htd=HTU.createTableDescriptor("testReplicationPeerIsCreated");
  htd.setRegionReplication(2);
  HTU.getAdmin().createTable(htd);
  peerConfig=admin.getPeerConfig(peerId);
  assertNotNull(peerConfig);
  assertEquals(peerConfig.getClusterKey(),ZKConfig.getZooKeeperClusterKey(HTU.getConfiguration()));
  assertEquals(RegionReplicaReplicationEndpoint.class.getName(),peerConfig.getReplicationEndpointImpl());
  admin.close();
}
