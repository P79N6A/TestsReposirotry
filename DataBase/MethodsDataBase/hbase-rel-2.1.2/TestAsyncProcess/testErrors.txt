@Test public void testErrors() throws IOException {
  ClusterConnection conn=new MyConnectionImpl(CONF);
  AsyncProcessWithFailure ap=new AsyncProcessWithFailure(conn,CONF,new IOException("test"));
  BufferedMutatorParams bufferParam=createBufferedMutatorParams(ap,DUMMY_TABLE);
  BufferedMutatorImpl mutator=new BufferedMutatorImpl(conn,bufferParam,ap);
  Assert.assertNotNull(ap.createServerErrorTracker());
  Put p=createPut(1,true);
  mutator.mutate(p);
  try {
    mutator.flush();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
    assertEquals(1,expected.getNumExceptions());
    assertTrue(expected.getRow(0) == p);
  }
  Assert.assertEquals(NB_RETRIES + 1,ap.callsCt.get());
}
