@Test public void testSubmitBusyRegion() throws Exception {
  ClusterConnection conn=createHConnection();
  final String defaultClazz=conn.getConfiguration().get(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY);
  conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,SimpleRequestController.class.getName());
  MyAsyncProcess ap=new MyAsyncProcess(conn,CONF);
  SimpleRequestController controller=(SimpleRequestController)ap.requestController;
  List<Put> puts=new ArrayList<>(1);
  puts.add(createPut(1,true));
  for (int i=0; i != controller.maxConcurrentTasksPerRegion; ++i) {
    ap.incTaskCounters(Collections.singleton(hri1.getRegionName()),sn);
  }
  ap.submit(null,DUMMY_TABLE,puts,false,null,false);
  Assert.assertEquals(puts.size(),1);
  ap.decTaskCounters(Collections.singleton(hri1.getRegionName()),sn);
  ap.submit(null,DUMMY_TABLE,puts,false,null,false);
  Assert.assertEquals(0,puts.size());
  if (defaultClazz != null) {
    conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,defaultClazz);
  }
}
