@Test public void testSubmitBusyRegionServer() throws Exception {
  ClusterConnection conn=createHConnection();
  MyAsyncProcess ap=new MyAsyncProcess(conn,CONF);
  final String defaultClazz=conn.getConfiguration().get(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY);
  conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,SimpleRequestController.class.getName());
  SimpleRequestController controller=(SimpleRequestController)ap.requestController;
  controller.taskCounterPerServer.put(sn2,new AtomicInteger(controller.maxConcurrentTasksPerServer));
  List<Put> puts=new ArrayList<>(4);
  puts.add(createPut(1,true));
  puts.add(createPut(3,true));
  puts.add(createPut(1,true));
  puts.add(createPut(2,true));
  ap.submit(null,DUMMY_TABLE,puts,false,null,false);
  Assert.assertEquals(" puts=" + puts,1,puts.size());
  controller.taskCounterPerServer.put(sn2,new AtomicInteger(controller.maxConcurrentTasksPerServer - 1));
  ap.submit(null,DUMMY_TABLE,puts,false,null,false);
  Assert.assertTrue(puts.isEmpty());
  if (defaultClazz != null) {
    conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,defaultClazz);
  }
}
