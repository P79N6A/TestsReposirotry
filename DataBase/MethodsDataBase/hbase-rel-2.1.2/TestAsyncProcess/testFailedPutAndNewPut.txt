@Test public void testFailedPutAndNewPut() throws Exception {
  ClusterConnection conn=createHConnection();
  MyAsyncProcess ap=new MyAsyncProcess(conn,CONF);
  BufferedMutatorParams bufferParam=createBufferedMutatorParams(ap,DUMMY_TABLE).writeBufferSize(0);
  BufferedMutatorImpl mutator=new BufferedMutatorImpl(conn,bufferParam,ap);
  Put p=createPut(1,false);
  try {
    mutator.mutate(p);
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
    assertEquals(1,expected.getNumExceptions());
    assertTrue(expected.getRow(0) == p);
  }
  ap.waitForMaximumCurrentTasks(0,null);
  Assert.assertEquals(0,mutator.size());
  mutator.mutate(createPut(1,true));
  Assert.assertEquals("the put should not been inserted.",0,mutator.size());
}
