@Test public void testTaskCountWithClientBackoffPolicy() throws IOException, InterruptedException {
  Configuration copyConf=new Configuration(CONF);
  copyConf.setBoolean(HConstants.ENABLE_CLIENT_BACKPRESSURE,true);
  MyClientBackoffPolicy bp=new MyClientBackoffPolicy();
  ClusterConnection conn=createHConnection();
  Mockito.when(conn.getConfiguration()).thenReturn(copyConf);
  Mockito.when(conn.getStatisticsTracker()).thenReturn(ServerStatisticTracker.create(copyConf));
  Mockito.when(conn.getBackoffPolicy()).thenReturn(bp);
  final String defaultClazz=conn.getConfiguration().get(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY);
  conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,SimpleRequestController.class.getName());
  MyAsyncProcess ap=new MyAsyncProcess(conn,copyConf);
  testTaskCount(ap);
  if (defaultClazz != null) {
    conn.getConfiguration().set(RequestControllerFactory.REQUEST_CONTROLLER_IMPL_CONF_KEY,defaultClazz);
  }
}
