@Test public void testQueueRowAccess() throws Exception {
  ClusterConnection conn=createHConnection();
  BufferedMutatorImpl mutator=new BufferedMutatorImpl(conn,null,null,new BufferedMutatorParams(DUMMY_TABLE).writeBufferSize(100000));
  Put p0=new Put(DUMMY_BYTES_1).addColumn(DUMMY_BYTES_1,DUMMY_BYTES_1,DUMMY_BYTES_1);
  Put p1=new Put(DUMMY_BYTES_2).addColumn(DUMMY_BYTES_2,DUMMY_BYTES_2,DUMMY_BYTES_2);
  mutator.mutate(p0);
  BufferedMutatorImpl.QueueRowAccess ra0=mutator.createQueueRowAccess();
  assertEquals(0,mutator.size());
  mutator.mutate(p1);
  assertEquals(1,mutator.size());
  BufferedMutatorImpl.QueueRowAccess ra1=mutator.createQueueRowAccess();
  assertEquals(0,mutator.size());
  assertEquals(1,ra0.size());
  assertEquals(1,ra1.size());
  Iterator<Row> iter0=ra0.iterator();
  Iterator<Row> iter1=ra1.iterator();
  assertTrue(iter0.hasNext());
  assertTrue(iter1.hasNext());
  assertTrue(iter0.next() == p0);
  assertEquals(1,mutator.getUnflushedSize());
  assertEquals(p1.heapSize(),mutator.getCurrentWriteBufferSize());
  assertTrue(iter1.next() == p1);
  assertEquals(0,mutator.getUnflushedSize());
  assertEquals(0,mutator.getCurrentWriteBufferSize());
  assertFalse(iter0.hasNext());
  assertFalse(iter1.hasNext());
  iter0.remove();
  ra0.close();
  assertEquals(0,mutator.size());
  assertEquals(0,mutator.getUnflushedSize());
  assertEquals(0,mutator.getCurrentWriteBufferSize());
  ra1.close();
  assertEquals(1,mutator.size());
  assertEquals(1,mutator.getUnflushedSize());
  assertEquals(p1.heapSize(),mutator.getCurrentWriteBufferSize());
}
