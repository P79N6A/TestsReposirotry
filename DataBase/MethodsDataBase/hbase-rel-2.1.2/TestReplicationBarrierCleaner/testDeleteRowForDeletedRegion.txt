@Test public void testDeleteRowForDeletedRegion() throws IOException, ReplicationException {
  TableName tableName=TableName.valueOf(name.getMethodName());
  RegionInfo region=RegionInfoBuilder.newBuilder(tableName).build();
  addBarrier(region,40,50,60);
  fillCatalogFamily(region);
  String peerId="1";
  ReplicationQueueStorage queueStorage=create(59L);
  @SuppressWarnings("unchecked") ReplicationPeerManager peerManager=create(queueStorage,Lists.newArrayList(peerId));
  ReplicationBarrierCleaner cleaner=create(peerManager);
  cleaner.chore();
  assertArrayEquals(new long[]{50,60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
  verify(queueStorage,never()).removeLastSequenceIds(anyString(),anyList());
  clearCatalogFamily(region);
  cleaner.chore();
  try (Table table=UTIL.getConnection().getTable(TableName.META_TABLE_NAME)){
    assertFalse(table.exists(new Get(region.getRegionName()).addFamily(HConstants.REPLICATION_BARRIER_FAMILY)));
  }
   verify(queueStorage,times(1)).removeLastSequenceIds(peerId,Arrays.asList(region.getEncodedName()));
}
