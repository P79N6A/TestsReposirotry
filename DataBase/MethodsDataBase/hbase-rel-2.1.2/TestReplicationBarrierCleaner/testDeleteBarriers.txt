@Test public void testDeleteBarriers() throws IOException, ReplicationException {
  TableName tableName=TableName.valueOf(name.getMethodName());
  RegionInfo region=RegionInfoBuilder.newBuilder(tableName).build();
  addBarrier(region,10,20,30,40,50,60);
  ReplicationQueueStorage queueStorage=create(-1L,2L,15L,25L,20L,25L,65L,55L,70L,70L);
  List<String> peerIds=Lists.newArrayList("1","2");
  @SuppressWarnings("unchecked") ReplicationPeerManager peerManager=create(queueStorage,peerIds,peerIds,peerIds,peerIds,peerIds);
  ReplicationBarrierCleaner cleaner=create(peerManager);
  cleaner.chore();
  assertArrayEquals(new long[]{10,20,30,40,50,60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
  cleaner.chore();
  assertArrayEquals(new long[]{10,20,30,40,50,60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
  cleaner.chore();
  assertArrayEquals(new long[]{20,30,40,50,60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
  cleaner.chore();
  assertArrayEquals(new long[]{50,60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
  cleaner.chore();
  assertArrayEquals(new long[]{60},MetaTableAccessor.getReplicationBarrier(UTIL.getConnection(),region.getRegionName()));
}
