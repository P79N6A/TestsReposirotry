@Test public void testMetaRegionMove() throws Exception {
  TableName tn=TableName.valueOf(name.getMethodName());
  Connection conn=TEST_UTIL.getConnection();
  Admin admin=conn.getAdmin();
  HTable table=(HTable)conn.getTable(tn);
  try {
    MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
    ColumnFamilyDescriptorBuilder cfDescBuilder=ColumnFamilyDescriptorBuilder.newBuilder(family);
    TableDescriptorBuilder tableDescBuilder=TableDescriptorBuilder.newBuilder(tn).setColumnFamily(cfDescBuilder.build());
    admin.createTable(tableDescBuilder.build());
    Put put=new Put(row);
    put.addColumn(family,qualifier,value);
    table.put(put);
    Get get=new Get(row);
    Result result=table.get(get);
    byte[] destServerName=null;
    for (    RegionServerThread rst : cluster.getLiveRegionServerThreads()) {
      ServerName name=rst.getRegionServer().getServerName();
      if (!name.equals(cluster.getServerHoldingMeta())) {
        destServerName=Bytes.toBytes(name.getServerName());
        break;
      }
    }
    admin.move(RegionInfoBuilder.FIRST_META_REGIONINFO.getEncodedNameAsBytes(),destServerName);
    LOG.debug("Finished moving meta");
    RegionInfo region=table.getRegionLocator().getRegionLocation(row).getRegion();
    ServerName currentServer=cluster.getServerHoldingRegion(tn,region.getRegionName());
    for (    RegionServerThread rst : cluster.getLiveRegionServerThreads()) {
      ServerName name=rst.getRegionServer().getServerName();
      if (!name.equals(currentServer)) {
        destServerName=Bytes.toBytes(name.getServerName());
        break;
      }
    }
    admin.move(region.getEncodedNameAsBytes(),destServerName);
    LOG.debug("Finished moving user region");
    put=new Put(row);
    put.addColumn(family,qualifier,newVal);
    table.put(put);
    result=table.get(get);
    LOG.debug("Result: " + Bytes.toString(result.getValue(family,qualifier)));
    Assert.assertArrayEquals(newVal,result.getValue(family,qualifier));
  }
  finally {
    admin.close();
    table.close();
  }
}
