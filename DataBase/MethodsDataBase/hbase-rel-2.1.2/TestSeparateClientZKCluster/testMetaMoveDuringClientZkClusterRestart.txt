@Test public void testMetaMoveDuringClientZkClusterRestart() throws Exception {
  TableName tn=TableName.valueOf(name.getMethodName());
  ClusterConnection conn=(ClusterConnection)TEST_UTIL.getConnection();
  Admin admin=conn.getAdmin();
  HTable table=(HTable)conn.getTable(tn);
  try {
    ColumnFamilyDescriptorBuilder cfDescBuilder=ColumnFamilyDescriptorBuilder.newBuilder(family);
    TableDescriptorBuilder tableDescBuilder=TableDescriptorBuilder.newBuilder(tn).setColumnFamily(cfDescBuilder.build());
    admin.createTable(tableDescBuilder.build());
    Put put=new Put(row);
    put.addColumn(family,qualifier,value);
    table.put(put);
    conn.clearRegionCache();
    clientZkCluster.shutdown();
    MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
    int metaServerId=cluster.getServerWithMeta();
    HRegionServer metaServer=cluster.getRegionServer(metaServerId);
    metaServer.stop("Stop current RS holding meta region");
    while (!metaServer.isShutDown()) {
      Thread.sleep(200);
    }
    AssignmentTestingUtil.waitForAssignment(cluster.getMaster().getAssignmentManager(),RegionInfoBuilder.FIRST_META_REGIONINFO);
    Thread.sleep(10000);
    clientZkCluster.startup(clientZkDir);
    Get get=new Get(row);
    Result result=table.get(get);
    LOG.debug("Result: " + Bytes.toString(result.getValue(family,qualifier)));
    Assert.assertArrayEquals(value,result.getValue(family,qualifier));
  }
  finally {
    admin.close();
    table.close();
  }
}
