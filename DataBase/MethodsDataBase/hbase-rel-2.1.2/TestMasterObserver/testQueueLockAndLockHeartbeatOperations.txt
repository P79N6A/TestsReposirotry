@Test public void testQueueLockAndLockHeartbeatOperations() throws Exception {
  HMaster master=UTIL.getMiniHBaseCluster().getMaster();
  CPMasterObserver cp=master.getMasterCoprocessorHost().findCoprocessor(CPMasterObserver.class);
  cp.resetStates();
  final TableName tableName=TableName.valueOf("testLockedTable");
  long procId=master.getLockManager().remoteLocks().requestTableLock(tableName,LockType.EXCLUSIVE,"desc",null);
  master.getLockManager().remoteLocks().lockHeartbeat(procId,false);
  assertTrue(cp.preAndPostForQueueLockAndHeartbeatLockCalled());
  ProcedureTestingUtility.waitNoProcedureRunning(master.getMasterProcedureExecutor());
  ProcedureTestingUtility.assertProcNotFailed(master.getMasterProcedureExecutor(),procId);
}
