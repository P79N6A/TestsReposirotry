@Test public void testWholesomeMerge() throws Exception {
  LOG.info("Starting " + name.getMethodName());
  final TableName tableName=TableName.valueOf(name.getMethodName());
  Table table=createTableAndLoadData(MASTER,tableName);
  mergeRegionsAndVerifyRegionNum(MASTER,tableName,0,1,INITIAL_REGION_NUM - 1);
  PairOfSameType<RegionInfo> mergedRegions=mergeRegionsAndVerifyRegionNum(MASTER,tableName,1,2,INITIAL_REGION_NUM - 2);
  verifyRowCount(table,ROWSIZE);
  RegionInfo hri=RandomUtils.nextBoolean() ? mergedRegions.getFirst() : mergedRegions.getSecond();
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  AssignmentManager am=cluster.getMaster().getAssignmentManager();
  RegionStates regionStates=am.getRegionStates();
  am.assign(hri);
  assertFalse("Merged region can't be assigned",regionStates.isRegionInTransition(hri));
  am.unassign(hri);
  assertFalse("Merged region can't be unassigned",regionStates.isRegionInTransition(hri));
  table.close();
}
