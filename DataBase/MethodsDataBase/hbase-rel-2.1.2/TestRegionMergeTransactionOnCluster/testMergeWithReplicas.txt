@Test public void testMergeWithReplicas() throws Exception {
  final TableName tableName=TableName.valueOf(name.getMethodName());
  createTableAndLoadData(MASTER,tableName,5,2);
  List<Pair<RegionInfo,ServerName>> initialRegionToServers=MetaTableAccessor.getTableRegionsAndLocations(TEST_UTIL.getConnection(),tableName);
  PairOfSameType<RegionInfo> mergedRegions=mergeRegionsAndVerifyRegionNum(MASTER,tableName,0,2,5 * 2 - 2);
  List<Pair<RegionInfo,ServerName>> currentRegionToServers=MetaTableAccessor.getTableRegionsAndLocations(TEST_UTIL.getConnection(),tableName);
  List<RegionInfo> initialRegions=new ArrayList<>();
  for (  Pair<RegionInfo,ServerName> p : initialRegionToServers) {
    initialRegions.add(p.getFirst());
  }
  List<RegionInfo> currentRegions=new ArrayList<>();
  for (  Pair<RegionInfo,ServerName> p : currentRegionToServers) {
    currentRegions.add(p.getFirst());
  }
  assertTrue(initialRegions.contains(mergedRegions.getFirst()));
  assertTrue(initialRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(mergedRegions.getFirst(),1)));
  assertTrue(initialRegions.contains(mergedRegions.getSecond()));
  assertTrue(initialRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(mergedRegions.getSecond(),1)));
  assertTrue(!initialRegions.contains(currentRegions.get(0)));
  assertTrue(!initialRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(currentRegions.get(0),1)));
  assertTrue(currentRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(currentRegions.get(0),1)));
  assertTrue(!currentRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(mergedRegions.getFirst(),1)));
  assertTrue(!currentRegions.contains(RegionReplicaUtil.getRegionInfoForReplica(mergedRegions.getSecond(),1)));
}
