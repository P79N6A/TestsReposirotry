@Test public void testBulkLoadReplicationEnabled() throws IOException {
  TEST_UTIL.getConfiguration().setBoolean(HConstants.REPLICATION_BULKLOAD_ENABLE_KEY,true);
  final ServerName serverName=ServerName.valueOf(name.getMethodName(),100,42);
  final RegionServerServices rss=spy(TEST_UTIL.createMockRegionServerService(serverName));
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf(name.getMethodName()));
  htd.addFamily(new HColumnDescriptor(fam1));
  HRegionInfo hri=new HRegionInfo(htd.getTableName(),HConstants.EMPTY_BYTE_ARRAY,HConstants.EMPTY_BYTE_ARRAY);
  region=HRegion.openHRegion(hri,htd,rss.getWAL(hri),TEST_UTIL.getConfiguration(),rss,null);
  assertTrue(region.conf.getBoolean(HConstants.REPLICATION_BULKLOAD_ENABLE_KEY,false));
  String plugins=region.conf.get(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY,"");
  String replicationCoprocessorClass=ReplicationObserver.class.getCanonicalName();
  assertTrue(plugins.contains(replicationCoprocessorClass));
  assertTrue(region.getCoprocessorHost().getCoprocessors().contains(ReplicationObserver.class.getSimpleName()));
  region.close();
}
