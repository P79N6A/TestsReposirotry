@Test public void testReadingOldHTDFromFS() throws IOException, DeserializationException {
  final String name=this.name.getMethodName();
  FileSystem fs=FileSystem.get(UTIL.getConfiguration());
  Path rootdir=UTIL.getDataTestDir(name);
  FSTableDescriptors fstd=new FSTableDescriptors(UTIL.getConfiguration(),fs,rootdir);
  TableDescriptor htd=TableDescriptorBuilder.newBuilder(TableName.valueOf(name)).build();
  Path descriptorFile=fstd.updateTableDescriptor(htd);
  try (FSDataOutputStream out=fs.create(descriptorFile,true)){
    out.write(TableDescriptorBuilder.toByteArray(htd));
  }
   FSTableDescriptors fstd2=new FSTableDescriptors(UTIL.getConfiguration(),fs,rootdir);
  TableDescriptor td2=fstd2.get(htd.getTableName());
  assertEquals(htd,td2);
  FileStatus descriptorFile2=FSTableDescriptors.getTableInfoPath(fs,fstd2.getTableDir(htd.getTableName()));
  byte[] buffer=TableDescriptorBuilder.toByteArray(htd);
  try (FSDataInputStream in=fs.open(descriptorFile2.getPath())){
    in.readFully(buffer);
  }
   TableDescriptor td3=TableDescriptorBuilder.parseFrom(buffer);
  assertEquals(htd,td3);
}
