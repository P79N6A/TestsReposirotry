@Test public void testMetaAddressChange() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  ZKWatcher zkw=TEST_UTIL.getZooKeeperWatcher();
  String baseZNode=conf.get(HConstants.ZOOKEEPER_ZNODE_PARENT,HConstants.DEFAULT_ZOOKEEPER_ZNODE_PARENT);
  String primaryMetaZnode=ZNodePaths.joinZNode(baseZNode,conf.get("zookeeper.znode.metaserver","meta-region-server"));
  byte[] data=ZKUtil.getData(zkw,primaryMetaZnode);
  ServerName currentServer=ProtobufUtil.toServerName(data);
  Collection<ServerName> liveServers=TEST_UTIL.getAdmin().getClusterMetrics(EnumSet.of(Option.LIVE_SERVERS)).getLiveServerMetrics().keySet();
  ServerName moveToServer=null;
  for (  ServerName s : liveServers) {
    if (!currentServer.equals(s)) {
      moveToServer=s;
    }
  }
  assert (moveToServer != null);
  final TableName tableName=TableName.valueOf(name.getMethodName());
  TEST_UTIL.createTable(tableName,"f");
  assertTrue(TEST_UTIL.getAdmin().tableExists(tableName));
  TEST_UTIL.getAdmin().move(RegionInfoBuilder.FIRST_META_REGIONINFO.getEncodedNameAsBytes(),Bytes.toBytes(moveToServer.getServerName()));
  int i=0;
  assert !moveToServer.equals(currentServer);
  LOG.info("CurrentServer=" + currentServer + ", moveToServer="+ moveToServer);
  final int max=10000;
  do {
    Thread.sleep(10);
    data=ZKUtil.getData(zkw,primaryMetaZnode);
    currentServer=ProtobufUtil.toServerName(data);
    i++;
  }
 while (!moveToServer.equals(currentServer) && i < max);
  assert (i != max);
  TEST_UTIL.getAdmin().disableTable(tableName);
  assertTrue(TEST_UTIL.getAdmin().isTableDisabled(tableName));
}
