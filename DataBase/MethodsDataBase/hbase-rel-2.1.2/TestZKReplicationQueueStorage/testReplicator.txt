@Test public void testReplicator() throws ReplicationException {
  assertTrue(STORAGE.getListOfReplicators().isEmpty());
  String queueId="1";
  for (int i=0; i < 10; i++) {
    STORAGE.addWAL(getServerName(i),queueId,"file" + i);
  }
  List<ServerName> replicators=STORAGE.getListOfReplicators();
  assertEquals(10,replicators.size());
  for (int i=0; i < 10; i++) {
    assertThat(replicators,hasItems(getServerName(i)));
  }
  for (int i=0; i < 5; i++) {
    STORAGE.removeQueue(getServerName(i),queueId);
  }
  for (int i=0; i < 10; i++) {
    STORAGE.removeReplicatorIfQueueIsEmpty(getServerName(i));
  }
  replicators=STORAGE.getListOfReplicators();
  assertEquals(5,replicators.size());
  for (int i=5; i < 10; i++) {
    assertThat(replicators,hasItems(getServerName(i)));
  }
}
