/** 
 * Test for HBASE-5920
 */
@Test public void testUserMajorCompactionRequest() throws IOException {
  HStore store=r.getStore(COLUMN_FAMILY);
  createStoreFile(r);
  for (int i=0; i < MAX_FILES_TO_COMPACT + 1; i++) {
    createStoreFile(r);
  }
  store.triggerMajorCompaction();
  CompactionRequestImpl request=store.requestCompaction(PRIORITY_USER,CompactionLifeCycleTracker.DUMMY,null).get().getRequest();
  assertNotNull("Expected to receive a compaction request",request);
  assertEquals("User-requested major compaction should always occur, even if there are too many store files",true,request.isMajor());
}
