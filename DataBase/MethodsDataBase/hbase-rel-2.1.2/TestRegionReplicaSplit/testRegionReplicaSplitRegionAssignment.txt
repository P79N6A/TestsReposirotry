@Test public void testRegionReplicaSplitRegionAssignment() throws Exception {
  HTU.loadNumericRows(table,f,0,3);
  List<RegionInfo> regions=new ArrayList<RegionInfo>();
  for (  RegionServerThread rs : HTU.getMiniHBaseCluster().getRegionServerThreads()) {
    for (    Region r : rs.getRegionServer().getRegions(table.getName())) {
      System.out.println("the region before split is is " + r.getRegionInfo() + rs.getRegionServer().getServerName());
      regions.add(r.getRegionInfo());
    }
  }
  HTU.getAdmin().split(table.getName(),Bytes.toBytes(1));
  int count=0;
  while (true) {
    for (    RegionServerThread rs : HTU.getMiniHBaseCluster().getRegionServerThreads()) {
      for (      Region r : rs.getRegionServer().getRegions(table.getName())) {
        count++;
      }
    }
    if (count >= 9) {
      break;
    }
    count=0;
  }
  List<ServerName> newRegionLocations=new ArrayList<ServerName>();
  for (  RegionServerThread rs : HTU.getMiniHBaseCluster().getRegionServerThreads()) {
    RegionInfo prevInfo=null;
    for (    Region r : rs.getRegionServer().getRegions(table.getName())) {
      if (!regions.contains(r.getRegionInfo()) && !RegionReplicaUtil.isDefaultReplica(r.getRegionInfo())) {
        LOG.info("The region is " + r.getRegionInfo() + " the location is "+ rs.getRegionServer().getServerName());
        if (!RegionReplicaUtil.isDefaultReplica(r.getRegionInfo()) && newRegionLocations.contains(rs.getRegionServer().getServerName()) && prevInfo != null && Bytes.equals(prevInfo.getStartKey(),r.getRegionInfo().getStartKey()) && Bytes.equals(prevInfo.getEndKey(),r.getRegionInfo().getEndKey())) {
          fail("Splitted regions should not be assigned to same region server");
        }
 else {
          prevInfo=r.getRegionInfo();
          if (!RegionReplicaUtil.isDefaultReplica(r.getRegionInfo()) && !newRegionLocations.contains(rs.getRegionServer().getServerName())) {
            newRegionLocations.add(rs.getRegionServer().getServerName());
          }
        }
      }
    }
  }
  assertEquals("The new regions should be assigned to 3 unique servers ",3,newRegionLocations.size());
}
