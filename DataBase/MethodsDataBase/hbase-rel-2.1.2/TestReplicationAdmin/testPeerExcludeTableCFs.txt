@Test public void testPeerExcludeTableCFs() throws Exception {
  ReplicationPeerConfig rpc=new ReplicationPeerConfig();
  rpc.setClusterKey(KEY_ONE);
  TableName tab1=TableName.valueOf("t1");
  TableName tab2=TableName.valueOf("t2");
  TableName tab3=TableName.valueOf("t3");
  TableName tab4=TableName.valueOf("t4");
  hbaseAdmin.addReplicationPeer(ID_ONE,rpc);
  rpc=hbaseAdmin.getReplicationPeerConfig(ID_ONE);
  assertTrue(rpc.replicateAllUserTables());
  Map<TableName,List<String>> tableCFs=new HashMap<TableName,List<String>>();
  tableCFs.put(tab1,null);
  rpc.setExcludeTableCFsMap(tableCFs);
  hbaseAdmin.updateReplicationPeerConfig(ID_ONE,rpc);
  Map<TableName,List<String>> result=hbaseAdmin.getReplicationPeerConfig(ID_ONE).getExcludeTableCFsMap();
  assertEquals(1,result.size());
  assertEquals(true,result.containsKey(tab1));
  assertNull(result.get(tab1));
  tableCFs.put(tab2,new ArrayList<String>());
  tableCFs.get(tab2).add("f1");
  rpc.setExcludeTableCFsMap(tableCFs);
  hbaseAdmin.updateReplicationPeerConfig(ID_ONE,rpc);
  result=hbaseAdmin.getReplicationPeerConfig(ID_ONE).getExcludeTableCFsMap();
  assertEquals(2,result.size());
  assertTrue("Should contain t1",result.containsKey(tab1));
  assertTrue("Should contain t2",result.containsKey(tab2));
  assertNull(result.get(tab1));
  assertEquals(1,result.get(tab2).size());
  assertEquals("f1",result.get(tab2).get(0));
  tableCFs.clear();
  tableCFs.put(tab3,new ArrayList<String>());
  tableCFs.put(tab4,new ArrayList<String>());
  tableCFs.get(tab4).add("f1");
  tableCFs.get(tab4).add("f2");
  rpc.setExcludeTableCFsMap(tableCFs);
  hbaseAdmin.updateReplicationPeerConfig(ID_ONE,rpc);
  result=hbaseAdmin.getReplicationPeerConfig(ID_ONE).getExcludeTableCFsMap();
  assertEquals(2,result.size());
  assertTrue("Should contain t3",result.containsKey(tab3));
  assertTrue("Should contain t4",result.containsKey(tab4));
  assertNull(result.get(tab3));
  assertEquals(2,result.get(tab4).size());
  assertEquals("f1",result.get(tab4).get(0));
  assertEquals("f2",result.get(tab4).get(1));
  hbaseAdmin.removeReplicationPeer(ID_ONE);
}
