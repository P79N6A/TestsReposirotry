@Test public void testAddPeerWithUnDeletedQueues() throws Exception {
  ReplicationPeerConfig rpc1=new ReplicationPeerConfig();
  rpc1.setClusterKey(KEY_ONE);
  ReplicationPeerConfig rpc2=new ReplicationPeerConfig();
  rpc2.setClusterKey(KEY_SECOND);
  Configuration conf=TEST_UTIL.getConfiguration();
  ReplicationQueueStorage queueStorage=ReplicationStorageFactory.getReplicationQueueStorage(TEST_UTIL.getZooKeeperWatcher(),conf);
  ServerName serverName=ServerName.valueOf("server1",8000,1234);
  queueStorage.addWAL(serverName,ID_ONE,"file1");
  try {
    admin.addPeer(ID_ONE,rpc1,null);
    fail();
  }
 catch (  Exception e) {
  }
  queueStorage.removeQueue(serverName,ID_ONE);
  assertEquals(0,queueStorage.getAllQueues(serverName).size());
  queueStorage.addWAL(serverName,ID_ONE + "-server2","file1");
  try {
    admin.addPeer(ID_ONE,rpc2,null);
    fail();
  }
 catch (  Exception e) {
  }
}
