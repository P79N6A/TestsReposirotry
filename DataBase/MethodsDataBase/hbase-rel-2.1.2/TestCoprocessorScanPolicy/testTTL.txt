@Test public void testTTL() throws Exception {
  TableName tableName=TableName.valueOf("testTTL");
  if (TEST_UTIL.getAdmin().tableExists(tableName)) {
    TEST_UTIL.deleteTable(tableName);
  }
  Table t=TEST_UTIL.createTable(tableName,F,10);
  long now=EnvironmentEdgeManager.currentTime();
  ManualEnvironmentEdge me=new ManualEnvironmentEdge();
  me.setValue(now);
  EnvironmentEdgeManagerTestHelper.injectEdge(me);
  long ts=now - 2000;
  Put p=new Put(R);
  p.addColumn(F,Q,ts,Q);
  t.put(p);
  p=new Put(R);
  p.addColumn(F,Q,ts + 1,Q);
  t.put(p);
  p=new Put(R);
  p.setAttribute("ttl",new byte[]{});
  p.addColumn(F,tableName.getName(),Bytes.toBytes(3000L));
  t.put(p);
  Get g=new Get(R);
  g.readAllVersions();
  Result r=t.get(g);
  assertEquals(2,r.size());
  TEST_UTIL.flush(tableName);
  TEST_UTIL.compact(tableName,true);
  g=new Get(R);
  g.readAllVersions();
  r=t.get(g);
  assertEquals(2,r.size());
  me.setValue(now + 2000);
  g=new Get(R);
  g.readAllVersions();
  r=t.get(g);
  assertEquals(0,r.size());
  t.close();
  EnvironmentEdgeManager.reset();
}
