@Test public void testRegionCache() throws IOException {
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf(name.getMethodName()));
  HColumnDescriptor fam=new HColumnDescriptor(FAMILY);
  htd.addFamily(fam);
  byte[][] KEYS=HBaseTestingUtility.KEYS_FOR_HBA_CREATE_TABLE;
  Admin admin=TEST_UTIL.getAdmin();
  admin.createTable(htd,KEYS);
  HRegionLocator locator=(HRegionLocator)admin.getConnection().getRegionLocator(htd.getTableName());
  List<HRegionLocation> results=locator.getAllRegionLocations();
  int number=((ConnectionImplementation)admin.getConnection()).getNumberOfCachedRegionLocations(htd.getTableName());
  assertEquals(results.size(),number);
  ConnectionImplementation conn=((ConnectionImplementation)admin.getConnection());
  assertNotNull("Can't get cached location for row aaa",conn.getCachedLocation(htd.getTableName(),Bytes.toBytes("aaa")));
  for (  byte[] startKey : HBaseTestingUtility.KEYS_FOR_HBA_CREATE_TABLE) {
    assertNotNull("Can't get cached location for row " + Bytes.toString(startKey),(conn.getCachedLocation(htd.getTableName(),startKey)));
  }
}
