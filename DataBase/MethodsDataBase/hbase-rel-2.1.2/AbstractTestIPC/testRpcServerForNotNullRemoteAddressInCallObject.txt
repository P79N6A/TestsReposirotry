/** 
 * Tests that the RpcServer creates & dispatches CallRunner object to scheduler with non-null remoteAddress set to its Call Object
 * @throws ServiceException
 */
@Test public void testRpcServerForNotNullRemoteAddressInCallObject() throws IOException, ServiceException {
  RpcServer rpcServer=createRpcServer(null,"testRpcServer",Lists.newArrayList(new RpcServer.BlockingServiceAndInterface(SERVICE,null)),new InetSocketAddress("localhost",0),CONF,new FifoRpcScheduler(CONF,1));
  InetSocketAddress localAddr=new InetSocketAddress("localhost",0);
  try (AbstractRpcClient<?> client=createRpcClient(CONF)){
    rpcServer.start();
    BlockingInterface stub=newBlockingStub(client,rpcServer.getListenerAddress());
    assertEquals(localAddr.getAddress().getHostAddress(),stub.addr(null,EmptyRequestProto.getDefaultInstance()).getAddr());
  }
  finally {
    rpcServer.stop();
  }
}
