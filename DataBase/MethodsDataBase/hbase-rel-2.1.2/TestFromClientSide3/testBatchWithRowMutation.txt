@Test public void testBatchWithRowMutation() throws Exception {
  LOG.info("Starting testBatchWithRowMutation");
  final TableName TABLENAME=TableName.valueOf("testBatchWithRowMutation");
  try (Table t=TEST_UTIL.createTable(TABLENAME,FAMILY)){
    byte[][] QUALIFIERS=new byte[][]{Bytes.toBytes("a"),Bytes.toBytes("b")};
    RowMutations arm=RowMutations.of(Collections.singletonList(new Put(ROW).addColumn(FAMILY,QUALIFIERS[0],VALUE)));
    Object[] batchResult=new Object[1];
    t.batch(Arrays.asList(arm),batchResult);
    Get g=new Get(ROW);
    Result r=t.get(g);
    assertEquals(0,Bytes.compareTo(VALUE,r.getValue(FAMILY,QUALIFIERS[0])));
    arm=RowMutations.of(Arrays.asList(new Put(ROW).addColumn(FAMILY,QUALIFIERS[1],VALUE),new Delete(ROW).addColumns(FAMILY,QUALIFIERS[0])));
    t.batch(Arrays.asList(arm),batchResult);
    r=t.get(g);
    assertEquals(0,Bytes.compareTo(VALUE,r.getValue(FAMILY,QUALIFIERS[1])));
    assertNull(r.getValue(FAMILY,QUALIFIERS[0]));
    try {
      arm=RowMutations.of(Collections.singletonList(new Put(ROW).addColumn(new byte[]{'b','o','g','u','s'},QUALIFIERS[0],VALUE)));
      t.batch(Arrays.asList(arm),batchResult);
      fail("Expected RetriesExhaustedWithDetailsException with NoSuchColumnFamilyException");
    }
 catch (    RetriesExhaustedWithDetailsException e) {
      String msg=e.getMessage();
      assertTrue(msg.contains("NoSuchColumnFamilyException"));
    }
  }
 }
