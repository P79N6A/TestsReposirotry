@Test public void testAccessControlClientMultiGrantRevoke() throws Exception {
  User testGrantRevoke=User.createUserForTesting(conf,"testGrantRevoke",new String[0]);
  AccessTestAction getAction=new AccessTestAction(){
    @Override public Object run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf);Table t=conn.getTable(TEST_TABLE)){
        return t.get(new Get(TEST_ROW));
      }
     }
  }
;
  AccessTestAction putAction=new AccessTestAction(){
    @Override public Object run() throws Exception {
      Put p=new Put(TEST_ROW);
      p.addColumn(TEST_FAMILY,TEST_QUALIFIER,Bytes.toBytes(1));
      try (Connection conn=ConnectionFactory.createConnection(conf);Table t=conn.getTable(TEST_TABLE)){
        t.put(p);
        return null;
      }
     }
  }
;
  verifyDenied(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  String userName=testGrantRevoke.getShortName();
  try {
    grantGlobalUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,Permission.Action.READ);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  try {
    grantGlobalUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,Permission.Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyAllowed(putAction,testGrantRevoke);
  try {
    revokeGlobalUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,Permission.Action.READ,Permission.Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.revoke ",e);
  }
  verifyDenied(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  try {
    grantOnTableUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,TEST_TABLE,null,null,Permission.Action.READ);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  try {
    grantOnTableUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,TEST_TABLE,null,null,Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyAllowed(putAction,testGrantRevoke);
  try {
    revokeFromTableUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,TEST_TABLE,null,null,Permission.Action.READ,Permission.Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.revoke ",e);
  }
  verifyDenied(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  String namespace=TEST_TABLE.getNamespaceAsString();
  try {
    grantOnNamespaceUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,namespace,Permission.Action.READ);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
  try {
    grantOnNamespaceUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,namespace,Permission.Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.grant. ",e);
  }
  verifyAllowed(getAction,testGrantRevoke);
  verifyAllowed(putAction,testGrantRevoke);
  try {
    revokeFromNamespaceUsingAccessControlClient(TEST_UTIL,systemUserConnection,userName,TEST_TABLE.getNamespaceAsString(),Permission.Action.READ,Permission.Action.WRITE);
  }
 catch (  Throwable e) {
    LOG.error("error during call of AccessControlClient.revoke ",e);
  }
  verifyDenied(getAction,testGrantRevoke);
  verifyDenied(putAction,testGrantRevoke);
}
