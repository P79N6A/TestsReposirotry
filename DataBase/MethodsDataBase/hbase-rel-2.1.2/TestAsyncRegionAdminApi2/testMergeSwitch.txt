@Test @Ignore public void testMergeSwitch() throws Exception {
  createTableWithDefaultConf(tableName);
  byte[][] families={FAMILY};
  TestAsyncRegionAdminApi.loadData(tableName,families,1000);
  AsyncTable<AdvancedScanResultConsumer> metaTable=ASYNC_CONN.getTable(META_TABLE_NAME);
  List<HRegionLocation> regionLocations=AsyncMetaTableAccessor.getTableHRegionLocations(metaTable,Optional.of(tableName)).get();
  int originalCount=regionLocations.size();
  initSplitMergeSwitch();
  admin.split(tableName).join();
  int postSplitCount=originalCount;
  while ((postSplitCount=admin.getRegions(tableName).get().size()) == originalCount) {
    Threads.sleep(100);
  }
  assertTrue("originalCount=" + originalCount + ", postSplitCount="+ postSplitCount,originalCount != postSplitCount);
  assertTrue(admin.mergeSwitch(false).get());
  List<RegionInfo> regions=admin.getRegions(tableName).get();
  assertTrue(regions.size() > 1);
  admin.mergeRegions(regions.get(0).getRegionName(),regions.get(1).getRegionName(),true).join();
  int count=admin.getRegions(tableName).get().size();
  assertTrue("postSplitCount=" + postSplitCount + ", count="+ count,postSplitCount == count);
  assertFalse(admin.mergeSwitch(true).get());
  admin.mergeRegions(regions.get(0).getRegionName(),regions.get(1).getRegionName(),true).join();
  count=admin.getRegions(tableName).get().size();
  assertTrue((postSplitCount / 2) == count);
}
