@Test public void testSplitSwitch() throws Exception {
  createTableWithDefaultConf(tableName);
  byte[][] families={FAMILY};
  final int rows=10000;
  TestAsyncRegionAdminApi.loadData(tableName,families,rows);
  AsyncTable<AdvancedScanResultConsumer> metaTable=ASYNC_CONN.getTable(META_TABLE_NAME);
  List<HRegionLocation> regionLocations=AsyncMetaTableAccessor.getTableHRegionLocations(metaTable,Optional.of(tableName)).get();
  int originalCount=regionLocations.size();
  initSplitMergeSwitch();
  assertTrue(admin.splitSwitch(false).get());
  try {
    admin.split(tableName,Bytes.toBytes(rows / 2)).join();
  }
 catch (  Exception e) {
  }
  int count=admin.getRegions(tableName).get().size();
  assertTrue(originalCount == count);
  assertFalse(admin.splitSwitch(true).get());
  admin.split(tableName).join();
  while ((count=admin.getRegions(tableName).get().size()) == originalCount) {
    Threads.sleep(100);
  }
  assertTrue(originalCount < count);
}
