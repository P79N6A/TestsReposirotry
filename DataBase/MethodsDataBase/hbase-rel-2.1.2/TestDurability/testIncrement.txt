@Test public void testIncrement() throws Exception {
  byte[] row1=Bytes.toBytes("row1");
  byte[] col1=Bytes.toBytes("col1");
  byte[] col2=Bytes.toBytes("col2");
  byte[] col3=Bytes.toBytes("col3");
  WALFactory wals=new WALFactory(CONF,ServerName.valueOf("TestIncrement",16010,System.currentTimeMillis()).toString());
  HRegion region=createHRegion(wals,Durability.USE_DEFAULT);
  WAL wal=region.getWAL();
  Increment inc1=new Increment(row1);
  inc1.addColumn(FAMILY,col1,0);
  Result res=region.increment(inc1);
  assertEquals(1,res.size());
  assertEquals(0,Bytes.toLong(res.getValue(FAMILY,col1)));
  verifyWALCount(wals,wal,1);
  inc1=new Increment(row1);
  inc1.addColumn(FAMILY,col1,1);
  res=region.increment(inc1);
  assertEquals(1,res.size());
  assertEquals(1,Bytes.toLong(res.getValue(FAMILY,col1)));
  verifyWALCount(wals,wal,2);
  inc1=new Increment(row1);
  inc1.addColumn(FAMILY,col1,0);
  res=region.increment(inc1);
  assertEquals(1,res.size());
  assertEquals(1,Bytes.toLong(res.getValue(FAMILY,col1)));
  verifyWALCount(wals,wal,3);
  inc1=new Increment(row1);
  inc1.addColumn(FAMILY,col1,0);
  inc1.addColumn(FAMILY,col2,0);
  inc1.addColumn(FAMILY,col3,0);
  res=region.increment(inc1);
  assertEquals(3,res.size());
  assertEquals(1,Bytes.toLong(res.getValue(FAMILY,col1)));
  assertEquals(0,Bytes.toLong(res.getValue(FAMILY,col2)));
  assertEquals(0,Bytes.toLong(res.getValue(FAMILY,col3)));
  verifyWALCount(wals,wal,4);
  inc1=new Increment(row1);
  inc1.addColumn(FAMILY,col1,5);
  inc1.addColumn(FAMILY,col2,4);
  inc1.addColumn(FAMILY,col3,3);
  res=region.increment(inc1);
  assertEquals(3,res.size());
  assertEquals(6,Bytes.toLong(res.getValue(FAMILY,col1)));
  assertEquals(4,Bytes.toLong(res.getValue(FAMILY,col2)));
  assertEquals(3,Bytes.toLong(res.getValue(FAMILY,col3)));
  verifyWALCount(wals,wal,5);
}
