@Test public void testWALMonotonicallyIncreasingSeqId() throws Exception {
  List<Thread> putThreads=new ArrayList<>();
  for (int i=0; i < 1; i++) {
    putThreads.add(new PutThread(region));
  }
  IncThread incThread=new IncThread(region);
  for (int i=0; i < 1; i++) {
    putThreads.get(i).start();
  }
  incThread.start();
  incThread.join();
  Path logPath=((AbstractFSWAL<?>)region.getWAL()).getCurrentFileName();
  region.getWAL().rollWriter();
  Thread.sleep(10);
  Path hbaseDir=new Path(walConf.get(HConstants.HBASE_DIR));
  Path oldWalsDir=new Path(hbaseDir,HConstants.HREGION_OLDLOGDIR_NAME);
  try (WAL.Reader reader=createReader(logPath,oldWalsDir)){
    long currentMaxSeqid=0;
    for (WAL.Entry e; (e=reader.next()) != null; ) {
      if (!WALEdit.isMetaEditFamily(e.getEdit().getCells().get(0))) {
        long currentSeqid=e.getKey().getSequenceId();
        if (currentSeqid > currentMaxSeqid) {
          currentMaxSeqid=currentSeqid;
        }
 else {
          fail("Current max Seqid is " + currentMaxSeqid + ", but the next seqid in wal is smaller:"+ currentSeqid);
        }
      }
    }
  }
 }
