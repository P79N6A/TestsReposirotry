@Test public void testAppendWithReadOnly() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  byte[] rowName=Bytes.toBytes("testAppend");
  ByteBuffer table=wrap(tableAname);
  byte[] v1=Bytes.toBytes("42");
  List<TColumnValue> appendColumns=new ArrayList<>(1);
  appendColumns.add(new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(v1)));
  TAppend append=new TAppend(wrap(rowName),appendColumns);
  boolean exceptionCaught=false;
  try {
    handler.append(table,append);
  }
 catch (  TIOError e) {
    exceptionCaught=true;
    assertTrue(e.getCause() instanceof DoNotRetryIOException);
    assertEquals("Thrift Server is in Read-only mode.",e.getMessage());
  }
 finally {
    assertTrue(exceptionCaught);
  }
}
