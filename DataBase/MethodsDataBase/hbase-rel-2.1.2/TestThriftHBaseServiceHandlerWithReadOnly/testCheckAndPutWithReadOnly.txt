@Test public void testCheckAndPutWithReadOnly() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  byte[] rowName=Bytes.toBytes("testCheckAndPut");
  ByteBuffer table=wrap(tableAname);
  List<TColumnValue> columnValuesA=new ArrayList<>(1);
  TColumnValue columnValueA=new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(valueAname));
  columnValuesA.add(columnValueA);
  TPut putA=new TPut(wrap(rowName),columnValuesA);
  putA.setColumnValues(columnValuesA);
  List<TColumnValue> columnValuesB=new ArrayList<>(1);
  TColumnValue columnValueB=new TColumnValue(wrap(familyBname),wrap(qualifierBname),wrap(valueBname));
  columnValuesB.add(columnValueB);
  TPut putB=new TPut(wrap(rowName),columnValuesB);
  putB.setColumnValues(columnValuesB);
  boolean exceptionCaught=false;
  try {
    handler.checkAndPut(table,wrap(rowName),wrap(familyAname),wrap(qualifierAname),wrap(valueAname),putB);
  }
 catch (  TIOError e) {
    exceptionCaught=true;
    assertTrue(e.getCause() instanceof DoNotRetryIOException);
    assertEquals("Thrift Server is in Read-only mode.",e.getMessage());
  }
 finally {
    assertTrue(exceptionCaught);
  }
}
