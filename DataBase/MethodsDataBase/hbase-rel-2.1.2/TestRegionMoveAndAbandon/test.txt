@Test public void test() throws Exception {
  LOG.info("Moving {} to {}",regionInfo,rs2.getServerName());
  UTIL.moveRegionAndWait(regionInfo,rs2.getServerName());
  LOG.info("Moving {} to {}",regionInfo,rs1.getServerName());
  UTIL.moveRegionAndWait(regionInfo,rs1.getServerName());
  LOG.info("Killing RS {}",rs1.getServerName());
  cluster.killRegionServer(rs1.getServerName());
  UTIL.waitTableAvailable(TableName.NAMESPACE_TABLE_NAME,30_000);
  LOG.info("Killing master {}",cluster.getMaster().getServerName());
  cluster.killMaster(cluster.getMaster().getServerName());
  LOG.info("Killing RS {}",rs2.getServerName());
  cluster.killRegionServer(rs2.getServerName());
  LOG.info("Starting cluster");
  UTIL.getMiniHBaseCluster().startMaster();
  UTIL.ensureSomeRegionServersAvailable(2);
  UTIL.waitFor(30_000,new Waiter.Predicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      try (Table nsTable=UTIL.getConnection().getTable(TableName.NAMESPACE_TABLE_NAME)){
        nsTable.get(new Get(Bytes.toBytes("a")));
        return true;
      }
     }
  }
);
}
