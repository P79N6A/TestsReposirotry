@Test public void testBalancerWithoutFavoredNodes() throws Exception {
  TableName tableName=TableName.valueOf("testBalancerWithoutFavoredNodes");
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  admin.createTable(desc,Bytes.toBytes("aaa"),Bytes.toBytes("zzz"),REGION_NUM);
  TEST_UTIL.waitTableAvailable(tableName);
  final RegionInfo region=admin.getTableRegions(tableName).get(0);
  LOG.info("Region thats supposed to be in transition: " + region);
  FavoredNodesManager fnm=master.getFavoredNodesManager();
  List<ServerName> currentFN=fnm.getFavoredNodes(region);
  assertNotNull(currentFN);
  fnm.deleteFavoredNodesForRegions(Lists.newArrayList(region));
  RegionStates regionStates=master.getAssignmentManager().getRegionStates();
  admin.setBalancerRunning(true,true);
  assertTrue("Balancer did not run",admin.balancer());
  TEST_UTIL.waitUntilNoRegionsInTransition();
  admin.assign(region.getEncodedNameAsBytes());
  TEST_UTIL.waitUntilNoRegionsInTransition(60000);
  currentFN=fnm.getFavoredNodes(region);
  assertNotNull(currentFN);
  assertEquals("Expected number of FN not present",FavoredNodeAssignmentHelper.FAVORED_NODES_NUM,currentFN.size());
  assertTrue("Balancer did not run",admin.balancer());
  TEST_UTIL.waitUntilNoRegionsInTransition(60000);
  checkFavoredNodeAssignments(tableName,fnm,regionStates);
}
