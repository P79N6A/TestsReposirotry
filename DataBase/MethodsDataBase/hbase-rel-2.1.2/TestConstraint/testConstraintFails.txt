/** 
 * Test that constraints will fail properly
 * @throws Exception
 */
@SuppressWarnings("unchecked") @Test public void testConstraintFails() throws Exception {
  HTableDescriptor desc=new HTableDescriptor(tableName);
  for (  byte[] family : new byte[][]{dummy,test}) {
    desc.addFamily(new HColumnDescriptor(family));
  }
  Constraints.add(desc,AllFailConstraint.class);
  util.getAdmin().createTable(desc);
  Table table=util.getConnection().getTable(tableName);
  Put put=new Put(row1);
  byte[] qualifier=new byte[0];
  put.addColumn(dummy,qualifier,Bytes.toBytes("fail"));
  LOG.warn("Doing put in table");
  try {
    table.put(put);
    fail("This put should not have suceeded - AllFailConstraint was not run!");
  }
 catch (  ConstraintException e) {
  }
  table.close();
}
