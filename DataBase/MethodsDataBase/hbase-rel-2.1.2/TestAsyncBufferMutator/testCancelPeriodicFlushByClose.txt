@Test public void testCancelPeriodicFlushByClose() throws InterruptedException, ExecutionException {
  CompletableFuture<?> future;
  Timeout task;
  try (AsyncBufferedMutatorImpl mutator=(AsyncBufferedMutatorImpl)CONN.getBufferedMutatorBuilder(TABLE_NAME).setWriteBufferPeriodicFlush(1,TimeUnit.SECONDS).build()){
    future=mutator.mutate(new Put(Bytes.toBytes(0)).addColumn(CF,CQ,VALUE));
    task=mutator.periodicFlushTask;
    assertNotNull(task);
  }
   assertTrue(task.isCancelled());
  future.get();
  AsyncTable<?> table=CONN.getTable(TABLE_NAME);
  assertArrayEquals(VALUE,table.get(new Get(Bytes.toBytes(0))).get().getValue(CF,CQ));
}
