@Test public void testClosedMutate() throws InterruptedException {
  AsyncBufferedMutator mutator=CONN.getBufferedMutator(TABLE_NAME);
  mutator.close();
  Put put=new Put(Bytes.toBytes(0)).addColumn(CF,CQ,VALUE);
  try {
    mutator.mutate(put).get();
    fail("Close check failed");
  }
 catch (  ExecutionException e) {
    assertThat(e.getCause(),instanceOf(IOException.class));
    assertTrue(e.getCause().getMessage().startsWith("Already closed"));
  }
  for (  CompletableFuture<Void> f : mutator.mutate(Arrays.asList(put))) {
    try {
      f.get();
      fail("Close check failed");
    }
 catch (    ExecutionException e) {
      assertThat(e.getCause(),instanceOf(IOException.class));
      assertTrue(e.getCause().getMessage().startsWith("Already closed"));
    }
  }
}
