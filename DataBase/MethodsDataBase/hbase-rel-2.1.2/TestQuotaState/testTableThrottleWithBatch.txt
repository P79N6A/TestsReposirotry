@Test(timeout=60000) public void testTableThrottleWithBatch(){
  final TableName TABLE_A=TableName.valueOf("TableA");
  final int TABLE_A_THROTTLE_1=3;
  final long LAST_UPDATE_1=10;
  UserQuotaState quotaInfo=new UserQuotaState();
  assertEquals(0,quotaInfo.getLastUpdate());
  assertTrue(quotaInfo.isBypass());
  UserQuotaState otherQuotaState=new UserQuotaState(LAST_UPDATE_1);
  otherQuotaState.setQuotas(TABLE_A,buildReqNumThrottle(TABLE_A_THROTTLE_1));
  assertEquals(LAST_UPDATE_1,otherQuotaState.getLastUpdate());
  assertFalse(otherQuotaState.isBypass());
  quotaInfo.update(otherQuotaState);
  assertEquals(LAST_UPDATE_1,quotaInfo.getLastUpdate());
  assertFalse(quotaInfo.isBypass());
  QuotaLimiter limiter=quotaInfo.getTableLimiter(TABLE_A);
  try {
    limiter.checkQuota(TABLE_A_THROTTLE_1 + 1,TABLE_A_THROTTLE_1 + 1,0,0);
    fail("Should have thrown RpcThrottlingException");
  }
 catch (  RpcThrottlingException e) {
  }
}
