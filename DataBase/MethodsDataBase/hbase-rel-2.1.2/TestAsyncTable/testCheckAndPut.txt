@Test public void testCheckAndPut() throws InterruptedException, ExecutionException {
  AsyncTable<?> table=getTable.get();
  AtomicInteger successCount=new AtomicInteger(0);
  AtomicInteger successIndex=new AtomicInteger(-1);
  int count=10;
  CountDownLatch latch=new CountDownLatch(count);
  IntStream.range(0,count).forEach(i -> table.checkAndMutate(row,FAMILY).qualifier(QUALIFIER).ifNotExists().thenPut(new Put(row).addColumn(FAMILY,QUALIFIER,concat(VALUE,i))).thenAccept(x -> {
    if (x) {
      successCount.incrementAndGet();
      successIndex.set(i);
    }
    latch.countDown();
  }
));
  latch.await();
  assertEquals(1,successCount.get());
  String actual=Bytes.toString(table.get(new Get(row)).get().getValue(FAMILY,QUALIFIER));
  assertTrue(actual.endsWith(Integer.toString(successIndex.get())));
}
