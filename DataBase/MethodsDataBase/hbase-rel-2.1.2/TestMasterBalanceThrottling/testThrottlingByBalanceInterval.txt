@Test public void testThrottlingByBalanceInterval() throws Exception {
  TEST_UTIL.startMiniCluster(2);
  TableName tableName=createTable("testNoThrottling");
  final HMaster master=TEST_UTIL.getHBaseCluster().getMaster();
  unbalance(master,tableName);
  AtomicInteger maxCount=new AtomicInteger(0);
  AtomicBoolean stop=new AtomicBoolean(false);
  Thread checker=startBalancerChecker(master,maxCount,stop);
  master.balance();
  stop.set(true);
  checker.interrupt();
  checker.join();
  assertTrue("max regions in transition: " + maxCount.get(),maxCount.get() == 1);
  TEST_UTIL.deleteTable(tableName);
}
