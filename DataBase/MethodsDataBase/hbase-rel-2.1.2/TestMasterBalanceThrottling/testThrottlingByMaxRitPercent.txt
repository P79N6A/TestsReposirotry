@Test public void testThrottlingByMaxRitPercent() throws Exception {
  TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_BALANCER_MAX_BALANCING,500);
  TEST_UTIL.getConfiguration().setDouble(HConstants.HBASE_MASTER_BALANCER_MAX_RIT_PERCENT,0.05);
  TEST_UTIL.startMiniCluster(2);
  TableName tableName=createTable("testThrottlingByMaxRitPercent");
  final HMaster master=TEST_UTIL.getHBaseCluster().getMaster();
  unbalance(master,tableName);
  AtomicInteger maxCount=new AtomicInteger(0);
  AtomicBoolean stop=new AtomicBoolean(false);
  Thread checker=startBalancerChecker(master,maxCount,stop);
  master.balance();
  stop.set(true);
  checker.interrupt();
  checker.join();
  assertTrue("max regions in transition: " + maxCount.get(),maxCount.get() == 5);
  TEST_UTIL.deleteTable(tableName);
}
