/** 
 * Test getSplits only puts up one Connection. In past it has put up many Connections. Each Connection setup comes with a fresh new cache so we have to do fresh hit on hbase:meta. Should only do one Connection when doing getSplits even if a MultiTableInputFormat.
 * @throws IOException
 */
@Test public void testMRSplitsConnectionCount() throws IOException {
  MultiTableInputFormatBase mtif=new MultiTableInputFormatBase(){
    @Override public RecordReader<ImmutableBytesWritable,Result> createRecordReader(    InputSplit split,    TaskAttemptContext context) throws IOException, InterruptedException {
      return super.createRecordReader(split,context);
    }
  }
;
  JobContext mockedJobContext=Mockito.mock(JobContext.class);
  Configuration c=HBaseConfiguration.create();
  c.set(ClusterConnection.HBASE_CLIENT_CONNECTION_IMPL,MRSplitsConnection.class.getName());
  Mockito.when(mockedJobContext.getConfiguration()).thenReturn(c);
  List<Scan> scans=new ArrayList<>();
  for (int i=0; i < 10; i++) {
    Scan scan=new Scan();
    String tableName=this.name.getMethodName() + i;
    scan.setAttribute(SCAN_ATTRIBUTES_TABLE_NAME,Bytes.toBytes(tableName));
    scans.add(scan);
  }
  mtif.setScans(scans);
  List<InputSplit> splits=mtif.getSplits(mockedJobContext);
  Assert.assertTrue(splits.size() > 0);
  Assert.assertEquals(1,MRSplitsConnection.creations.get());
}
