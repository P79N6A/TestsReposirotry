@Test public void test() throws IOException, KeeperException, InterruptedException {
  long now=System.currentTimeMillis();
  put(0,100,now - 10000);
  assertValueEquals(0,100);
  setExpireBefore(now - 5000);
  Thread.sleep(5000);
  UTIL.getAdmin().flush(NAME);
  assertNotExists(0,100);
  put(0,50,now - 1000);
  UTIL.getAdmin().flush(NAME);
  put(50,100,now - 100);
  UTIL.getAdmin().flush(NAME);
  assertValueEquals(0,100);
  setExpireBefore(now - 500);
  Thread.sleep(5000);
  UTIL.getAdmin().majorCompact(NAME);
  UTIL.waitFor(30000,() -> UTIL.getHBaseCluster().getRegions(NAME).iterator().next().getStore(FAMILY).getStorefilesCount() == 1);
  assertNotExists(0,50);
  assertValueEquals(50,100);
}
