@Test(expected=IOException.class) public void testFailedToCreateWALIfParentRenamed() throws IOException, CommonFSUtils.StreamLacksCapabilityException {
  final String name="testFailedToCreateWALIfParentRenamed";
  AbstractFSWAL<?> wal=newWAL(FS,CommonFSUtils.getWALRootDir(CONF),name,HConstants.HREGION_OLDLOGDIR_NAME,CONF,null,true,null,null);
  long filenum=System.currentTimeMillis();
  Path path=wal.computeFilename(filenum);
  wal.createWriterInstance(path);
  Path parent=path.getParent();
  path=wal.computeFilename(filenum + 1);
  Path newPath=new Path(parent.getParent(),parent.getName() + "-splitting");
  FS.rename(parent,newPath);
  wal.createWriterInstance(path);
  fail("It should fail to create the new WAL");
}
