/** 
 * Test disable/enable replication, trying to insert, make sure nothing's replicated, enable it, the insert should be replicated
 */
@Test public void testDisableEnable() throws Exception {
  hbaseAdmin.disableReplicationPeer(PEER_ID);
  byte[] rowkey=Bytes.toBytes("disable enable");
  Put put=new Put(rowkey);
  put.addColumn(famName,row,row);
  htable1.put(put);
  Get get=new Get(rowkey);
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      fail("Replication wasn't disabled");
    }
 else {
      LOG.info("Row not replicated, let's wait a bit more...");
      Thread.sleep(SLEEP_TIME);
    }
  }
  hbaseAdmin.enableReplicationPeer(PEER_ID);
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.isEmpty()) {
      LOG.info("Row not available");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      assertArrayEquals(row,res.value());
      return;
    }
  }
  fail("Waited too much time for put replication");
}
