/** 
 * To test that we successfully exclude a server from the unloading process We test for the number of regions on Excluded server and also test that regions are unloaded successfully
 */
@Test public void testExclude() throws Exception {
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  File excludeFile=new File(TEST_UTIL.getDataTestDir().toUri().getPath(),"exclude_file");
  FileWriter fos=new FileWriter(excludeFile);
  HRegionServer excludeServer=cluster.getRegionServer(1);
  String excludeHostname=excludeServer.getServerName().getHostname();
  int excludeServerPort=excludeServer.getServerName().getPort();
  int regionsExcludeServer=excludeServer.getNumberOfOnlineRegions();
  String excludeServerName=excludeHostname + ":" + Integer.toString(excludeServerPort);
  fos.write(excludeServerName);
  fos.close();
  HRegionServer regionServer=cluster.getRegionServer(0);
  String rsName=regionServer.getServerName().getHostname();
  int port=regionServer.getServerName().getPort();
  String rs=rsName + ":" + Integer.toString(port);
  RegionMoverBuilder rmBuilder=new RegionMoverBuilder(rs,TEST_UTIL.getConfiguration()).ack(true).excludeFile(excludeFile.getCanonicalPath());
  RegionMover rm=rmBuilder.build();
  rm.unload();
  LOG.info("Unloading " + rs);
  assertEquals(0,regionServer.getNumberOfOnlineRegions());
  assertEquals(regionsExcludeServer,cluster.getRegionServer(1).getNumberOfOnlineRegions());
  LOG.info("Before:" + regionsExcludeServer + " After:"+ cluster.getRegionServer(1).getNumberOfOnlineRegions());
}
