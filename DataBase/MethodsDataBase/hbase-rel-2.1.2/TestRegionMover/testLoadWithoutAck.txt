/** 
 * Test to unload a regionserver first and then load it using no Ack mode we check if some regions are loaded on the region server(since no ack is best effort)
 */
@Test public void testLoadWithoutAck() throws Exception {
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  final HRegionServer regionServer=cluster.getRegionServer(0);
  String rsName=regionServer.getServerName().getHostname();
  int port=regionServer.getServerName().getPort();
  int noRegions=regionServer.getNumberOfOnlineRegions();
  String rs=rsName + ":" + Integer.toString(port);
  RegionMoverBuilder rmBuilder=new RegionMoverBuilder(rs,TEST_UTIL.getConfiguration()).ack(true);
  RegionMover rm=rmBuilder.build();
  LOG.info("Unloading " + rs);
  rm.unload();
  assertEquals(0,regionServer.getNumberOfOnlineRegions());
  LOG.info("Successfully Unloaded\nNow Loading");
  rm=rmBuilder.ack(false).build();
  rm.load();
  TEST_UTIL.waitFor(5000,500,new Predicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      return regionServer.getNumberOfOnlineRegions() > 0;
    }
  }
);
}
