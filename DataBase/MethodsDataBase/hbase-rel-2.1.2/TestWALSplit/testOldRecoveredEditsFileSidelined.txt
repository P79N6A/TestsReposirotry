/** 
 * Test old recovered edits file doesn't break WALSplitter. This is useful in upgrading old instances.
 */
@Test public void testOldRecoveredEditsFileSidelined() throws IOException {
  byte[] encoded=RegionInfoBuilder.FIRST_META_REGIONINFO.getEncodedNameAsBytes();
  Path tdir=FSUtils.getTableDir(HBASEDIR,TableName.META_TABLE_NAME);
  Path regiondir=new Path(tdir,RegionInfoBuilder.FIRST_META_REGIONINFO.getEncodedName());
  fs.mkdirs(regiondir);
  long now=System.currentTimeMillis();
  Entry entry=new Entry(new WALKeyImpl(encoded,TableName.META_TABLE_NAME,1,now,HConstants.DEFAULT_CLUSTER_ID),new WALEdit());
  Path parent=WALSplitter.getRegionDirRecoveredEditsDir(regiondir);
  assertEquals(HConstants.RECOVERED_EDITS_DIR,parent.getName());
  fs.createNewFile(parent);
  Path p=WALSplitter.getRegionSplitEditsPath(entry,FILENAME_BEING_SPLIT,TMPDIRNAME,conf);
  String parentOfParent=p.getParent().getParent().getName();
  assertEquals(parentOfParent,RegionInfoBuilder.FIRST_META_REGIONINFO.getEncodedName());
  WALFactory.createRecoveredEditsWriter(fs,p,conf).close();
}
