/** 
 * Test the new prepare step. Here we test that our Mock is faking out the precedure well-enough for it to progress past the first prepare stage.
 */
@Test public void testPrepare() throws ProcedureSuspendedException, ProcedureYieldException, InterruptedException, IOException {
  RecoverMetaProcedure rmp=new RecoverMetaProcedure();
  MasterProcedureEnv env=Mockito.mock(MasterProcedureEnv.class);
  MasterServices masterServices=new MockMasterServices(UTIL.getConfiguration(),null);
  Mockito.when(env.getMasterServices()).thenReturn(masterServices);
  assertEquals(StateMachineProcedure.Flow.HAS_MORE_STATE,rmp.executeFromState(env,rmp.getInitialState()));
  int stateId=rmp.getCurrentStateId();
  assertEquals(MasterProcedureProtos.RecoverMetaState.RECOVER_META_SPLIT_LOGS_VALUE,rmp.getCurrentStateId());
}
