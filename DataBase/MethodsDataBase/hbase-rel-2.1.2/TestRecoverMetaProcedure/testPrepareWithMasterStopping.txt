/** 
 * Test the new prepare step. If Master is stopping, procedure should skip the assign by returning NO_MORE_STATE
 */
@Test public void testPrepareWithMasterStopping() throws ProcedureSuspendedException, ProcedureYieldException, InterruptedException, IOException {
  RecoverMetaProcedure rmp=new RecoverMetaProcedure();
  MasterProcedureEnv env=Mockito.mock(MasterProcedureEnv.class);
  MasterServices masterServices=new MockMasterServices(UTIL.getConfiguration(),null){
    @Override public boolean isStopping(){
      return true;
    }
  }
;
  Mockito.when(env.getMasterServices()).thenReturn(masterServices);
  assertEquals(StateMachineProcedure.Flow.NO_MORE_STATE,rmp.executeFromState(env,rmp.getInitialState()));
}
