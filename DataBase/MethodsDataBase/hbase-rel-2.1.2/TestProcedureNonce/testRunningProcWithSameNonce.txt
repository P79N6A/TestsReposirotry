@Test public void testRunningProcWithSameNonce() throws Exception {
  final long nonceGroup=456;
  final long nonce=33333;
  final NonceKey nonceKey=procExecutor.createNonceKey(nonceGroup,nonce);
  assertFalse(procExecutor.registerNonce(nonceKey) >= 0);
  CountDownLatch latch=new CountDownLatch(1);
  TestSingleStepProcedure proc=new TestSingleStepProcedure();
  procEnv.setWaitLatch(latch);
  long procId=procExecutor.submitProcedure(proc,nonceKey);
  while (proc.step != 1)   Threads.sleep(25);
  assertEquals(procId,procExecutor.registerNonce(nonceKey));
  latch.countDown();
  ProcedureTestingUtility.restart(procExecutor);
  ProcedureTestingUtility.waitProcedure(procExecutor,procId);
  assertEquals(procId,procExecutor.registerNonce(nonceKey));
  Procedure<?> result=procExecutor.getResult(procId);
  ProcedureTestingUtility.assertProcNotFailed(result);
}
