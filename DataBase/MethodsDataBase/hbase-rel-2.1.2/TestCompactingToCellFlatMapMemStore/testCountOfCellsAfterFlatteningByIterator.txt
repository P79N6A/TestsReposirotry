@Test public void testCountOfCellsAfterFlatteningByIterator() throws IOException {
  String[] keys1={"A","B","C"};
  addRowsByKeysWith50Cols(memstore,keys1);
  ((CompactingMemStore)memstore).flushInMemory();
  while (((CompactingMemStore)memstore).isMemStoreFlushingInMemory()) {
    Threads.sleep(10);
  }
  MemStoreSegmentsIterator itr=new MemStoreMergerSegmentsIterator(((CompactingMemStore)memstore).getImmutableSegments().getStoreSegments(),CellComparatorImpl.COMPARATOR,10);
  int cnt=0;
  try {
    while (itr.next() != null) {
      cnt++;
    }
  }
  finally {
    itr.close();
  }
  assertEquals("the count should be ",150,cnt);
}
