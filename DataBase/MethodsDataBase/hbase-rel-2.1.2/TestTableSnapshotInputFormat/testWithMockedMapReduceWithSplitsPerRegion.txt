@Test public void testWithMockedMapReduceWithSplitsPerRegion() throws Exception {
  setupCluster();
  String snapshotName="testWithMockedMapReduceMultiRegion";
  final TableName tableName=TableName.valueOf(name.getMethodName());
  try {
    createTableAndSnapshot(UTIL,tableName,snapshotName,getStartRow(),getEndRow(),10);
    Configuration conf=UTIL.getConfiguration();
    conf.setBoolean(SNAPSHOT_INPUTFORMAT_LOCALITY_ENABLED_KEY,false);
    Job job=new Job(conf);
    Path tmpTableDir=UTIL.getDataTestDirOnTestFS(snapshotName);
    Scan scan=new Scan(bbc,yya);
    TableMapReduceUtil.initTableSnapshotMapperJob(snapshotName,scan,TestTableSnapshotMapper.class,ImmutableBytesWritable.class,NullWritable.class,job,false,tmpTableDir,new RegionSplitter.UniformSplit(),5);
    verifyWithMockedMapReduce(job,10,40,bbc,yya);
  }
  finally {
    UTIL.getAdmin().deleteSnapshot(snapshotName);
    UTIL.deleteTable(tableName);
    tearDownCluster();
  }
}
