/** 
 * Checks whether we are effected by the JDK issue on windows, and if so ensures that we are running with preferIPv4Stack=true.
 */
@Test public void testServerSocket() throws IOException {
  byte[] addr={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1};
  InetAddress inetAddr=InetAddress.getByAddress(addr);
  try {
    bindServerSocket(inetAddr);
    bindNIOServerSocket(inetAddr);
  }
 catch (  java.net.SocketException ex) {
    Assert.assertFalse(ex instanceof BindException);
    Assert.assertTrue(ex.getMessage().toLowerCase(Locale.ROOT).contains("protocol family"));
    LOG.info("Received expected exception:",ex);
    ensurePreferIPv4();
  }
}
