@Test public void testToCell() throws Exception {
  KeyValue kv1=new KeyValue(Bytes.toBytes("aaa"),Bytes.toBytes("f1"),Bytes.toBytes("q1"),new byte[30]);
  KeyValue kv2=new KeyValue(Bytes.toBytes("bbb"),Bytes.toBytes("f1"),Bytes.toBytes("q1"),new byte[30]);
  KeyValue kv3=new KeyValue(Bytes.toBytes("ccc"),Bytes.toBytes("f1"),Bytes.toBytes("q1"),new byte[30]);
  byte[] arr=new byte[kv1.getLength() + kv2.getLength() + kv3.getLength()];
  System.arraycopy(kv1.getBuffer(),kv1.getOffset(),arr,0,kv1.getLength());
  System.arraycopy(kv2.getBuffer(),kv2.getOffset(),arr,kv1.getLength(),kv2.getLength());
  System.arraycopy(kv3.getBuffer(),kv3.getOffset(),arr,kv1.getLength() + kv2.getLength(),kv3.getLength());
  ByteBuffer dbb=ByteBuffer.allocateDirect(arr.length);
  dbb.put(arr);
  ByteBufferKeyValue offheapKV=new ByteBufferKeyValue(dbb,kv1.getLength(),kv2.getLength());
  CellProtos.Cell cell=ProtobufUtil.toCell(offheapKV);
  Cell newOffheapKV=ProtobufUtil.toCell(ExtendedCellBuilderFactory.create(CellBuilderType.SHALLOW_COPY),cell);
  assertTrue(CellComparatorImpl.COMPARATOR.compare(offheapKV,newOffheapKV) == 0);
}
