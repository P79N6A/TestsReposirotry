@Test public void testUnassignAndCrashBeforeResponse() throws Exception {
  final TableName tableName=TableName.valueOf("testAssignAndCrashBeforeResponse");
  final RegionInfo hri=createRegionInfo(tableName,1);
  rsDispatcher.setMockRsExecutor(new HangOnCloseThenRSCrashExecutor());
  for (int i=0; i < HangOnCloseThenRSCrashExecutor.TYPES_OF_FAILURE; i++) {
    AssignProcedure assign=am.createAssignProcedure(hri);
    waitOnFuture(submitProcedure(assign));
    UnassignProcedure unassign=am.createUnassignProcedure(hri,am.getRegionStates().getRegionServerOfRegion(hri),false);
    waitOnFuture(submitProcedure(unassign));
  }
}
