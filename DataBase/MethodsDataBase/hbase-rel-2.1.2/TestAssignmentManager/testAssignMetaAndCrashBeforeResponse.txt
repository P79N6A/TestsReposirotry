/** 
 * It is possible that when AM send assign meta request to a RS successfully, but RS can not send back any response, which cause master startup hangs forever
 */
@Test public void testAssignMetaAndCrashBeforeResponse() throws Exception {
  tearDown();
  UTIL=new HBaseTestingUtility();
  this.executor=Executors.newSingleThreadScheduledExecutor();
  setupConfiguration(UTIL.getConfiguration());
  master=new MockMasterServices(UTIL.getConfiguration(),this.regionsToRegionServers);
  rsDispatcher=new MockRSProcedureDispatcher(master);
  master.start(NSERVERS,rsDispatcher);
  am=master.getAssignmentManager();
  rsDispatcher.setMockRsExecutor(new HangThenRSRestartExecutor());
  am.assign(RegionInfoBuilder.FIRST_META_REGIONINFO);
  assertEquals(true,am.isMetaAssigned());
  am.wakeMetaLoadedEvent();
}
