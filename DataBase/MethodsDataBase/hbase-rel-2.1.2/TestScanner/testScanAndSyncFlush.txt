/** 
 * Tests to do a sync flush during the middle of a scan. This is testing the StoreScanner update readers code essentially.  This is not highly concurrent, since its all 1 thread. HBase-910.
 * @throws Exception
 */
@Test public void testScanAndSyncFlush() throws Exception {
  this.region=TEST_UTIL.createLocalHRegion(TESTTABLEDESC,null,null);
  Table hri=new RegionAsTable(region);
  try {
    LOG.info("Added: " + HBaseTestCase.addContent(hri,Bytes.toString(HConstants.CATALOG_FAMILY),Bytes.toString(HConstants.REGIONINFO_QUALIFIER)));
    int count=count(hri,-1,false);
    assertEquals(count,count(hri,100,false));
  }
 catch (  Exception e) {
    LOG.error("Failed",e);
    throw e;
  }
 finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
  }
}
