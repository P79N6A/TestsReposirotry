@Test public void testLocateRegionsWithRegionReplicas() throws IOException {
  int regionReplication=3;
  byte[] family=Bytes.toBytes("cf");
  TableName tableName=TableName.valueOf(name.getMethodName());
  TableDescriptorBuilder builder=TableDescriptorBuilder.newBuilder(tableName).setRegionReplication(regionReplication).setColumnFamily(ColumnFamilyDescriptorBuilder.of(family));
  TEST_UTIL.getAdmin().createTable(builder.build());
  try (ConnectionImplementation con=(ConnectionImplementation)ConnectionFactory.createConnection(TEST_UTIL.getConfiguration())){
    List<HRegionLocation> locations=con.locateRegions(tableName,false,false);
    assertEquals(regionReplication,locations.size());
    Set<Integer> expectedReplicaIds=IntStream.range(0,regionReplication).boxed().collect(Collectors.toSet());
    for (    HRegionLocation location : locations) {
      assertTrue(expectedReplicaIds.remove(location.getRegion().getReplicaId()));
    }
  }
  finally {
    TEST_UTIL.deleteTable(tableName);
  }
}
