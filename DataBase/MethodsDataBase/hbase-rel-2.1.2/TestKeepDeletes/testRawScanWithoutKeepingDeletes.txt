/** 
 * Even when the store does not keep deletes a "raw" scan will return everything it can find (unless discarding cells is guaranteed to have no effect). Assuming this the desired behavior. Could also disallow "raw" scanning if the store does not have KEEP_DELETED_CELLS enabled. (can be changed easily)
 */
@Test public void testRawScanWithoutKeepingDeletes() throws Exception {
  HTableDescriptor htd=hbu.createTableDescriptor(name.getMethodName(),0,3,HConstants.FOREVER,KeepDeletedCells.FALSE);
  HRegion region=hbu.createLocalHRegion(htd,null,null);
  long ts=EnvironmentEdgeManager.currentTime();
  Put p=new Put(T1,ts);
  p.addColumn(c0,c0,T1);
  region.put(p);
  Delete d=new Delete(T1,ts);
  d.addColumn(c0,c0,ts);
  region.delete(d);
  Scan s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  InternalScanner scan=region.getScanner(s);
  List<Cell> kvs=new ArrayList<>();
  scan.next(kvs);
  assertEquals(2,kvs.size());
  region.flush(true);
  region.compact(true);
  s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  scan=region.getScanner(s);
  kvs=new ArrayList<>();
  scan.next(kvs);
  assertTrue(kvs.isEmpty());
  HBaseTestingUtility.closeRegionAndWAL(region);
}
