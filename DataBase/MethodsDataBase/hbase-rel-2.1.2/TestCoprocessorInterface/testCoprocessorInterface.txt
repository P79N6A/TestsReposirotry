@Test public void testCoprocessorInterface() throws IOException {
  TableName tableName=TableName.valueOf(name.getMethodName());
  byte[][] families={fam1,fam2,fam3};
  Configuration hc=initConfig();
  HRegion region=initHRegion(tableName,name.getMethodName(),hc,new Class<?>[]{CoprocessorImpl.class},families);
  for (int i=0; i < 3; i++) {
    HBaseTestCase.addContent(region,fam3);
    region.flush(true);
  }
  region.compact(false);
  Scan s=new Scan();
  RegionScanner scanner=region.getCoprocessorHost().postScannerOpen(s,region.getScanner(s));
  assertTrue(scanner instanceof CustomScanner);
  scanner.next(new ArrayList<>());
  HBaseTestingUtility.closeRegionAndWAL(region);
  Coprocessor c=region.getCoprocessorHost().findCoprocessor(CoprocessorImpl.class);
  assertTrue("Coprocessor not started",((CoprocessorImpl)c).wasStarted());
  assertTrue("Coprocessor not stopped",((CoprocessorImpl)c).wasStopped());
  assertTrue(((CoprocessorImpl)c).wasOpened());
  assertTrue(((CoprocessorImpl)c).wasClosed());
  assertTrue(((CoprocessorImpl)c).wasFlushed());
  assertTrue(((CoprocessorImpl)c).wasCompacted());
}
