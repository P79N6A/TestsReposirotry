/** 
 * Check that ExportSnapshot will succeed if something fails but the retry succeed.
 */
@Test public void testExportRetry() throws Exception {
  Path copyDir=getLocalDestinationDir();
  FileSystem fs=FileSystem.get(copyDir.toUri(),new Configuration());
  copyDir=copyDir.makeQualified(fs);
  Configuration conf=new Configuration(TEST_UTIL.getConfiguration());
  conf.setBoolean(ExportSnapshot.Testing.CONF_TEST_FAILURE,true);
  conf.setInt(ExportSnapshot.Testing.CONF_TEST_FAILURE_COUNT,2);
  conf.setInt("mapreduce.map.maxattempts",3);
  testExportFileSystemState(conf,tableName,snapshotName,snapshotName,tableNumFiles,TEST_UTIL.getDefaultRootDirPath(),copyDir,true,getBypassRegionPredicate(),true);
}
