@Test public void testGet_InternalCacheDir() throws Exception {
  File cacheDir=mContext.getCacheDir();
  DynamicDefaultDiskStorage storage=createInternalCacheDirStorage();
  Assert.assertNull(storage.mCurrentState.delegate);
  DiskStorage delegate=storage.get();
  Assert.assertEquals(delegate,storage.mCurrentState.delegate);
  Assert.assertTrue(delegate instanceof DefaultDiskStorage);
  File baseDir=new File(cacheDir,mBaseDirectoryName);
  Assert.assertTrue(baseDir.exists());
  Assert.assertTrue(getStorageSubdirectory(baseDir,1).exists());
  DiskStorage storage2=storage.get();
  Assert.assertEquals(delegate,storage2);
  File baseDirOrig=baseDir.getAbsoluteFile();
  Assert.assertTrue(baseDirOrig.renameTo(new File(cacheDir,"dummydir")));
  DiskStorage storage3=storage.get();
  Assert.assertNotSame(delegate,storage3);
  Assert.assertTrue(storage3 instanceof DefaultDiskStorage);
  Assert.assertTrue(baseDir.exists());
  Assert.assertTrue(getStorageSubdirectory(baseDir,1).exists());
}
