@Test public void testFailure(){
  SingleUsePostprocessorConsumer postprocessorConsumer=produceResults();
  doThrow(new RuntimeException()).when(mPostprocessor).process(eq(mSourceBitmap),eq(mPlatformBitmapFactory));
  postprocessorConsumer.onNewResult(mSourceCloseableImageRef,Consumer.IS_LAST);
  mSourceCloseableImageRef.close();
  mTestExecutorService.runUntilIdle();
  mInOrder.verify(mProducerListener).onProducerStart(mRequestId,PostprocessorProducer.NAME);
  mInOrder.verify(mPostprocessor).process(mSourceBitmap,mPlatformBitmapFactory);
  mInOrder.verify(mProducerListener).requiresExtraMap(mRequestId);
  mInOrder.verify(mProducerListener).onProducerFinishWithFailure(eq(mRequestId),eq(PostprocessorProducer.NAME),any(RuntimeException.class),eq(mExtraMap));
  mInOrder.verify(mConsumer).onFailure(any(IllegalStateException.class));
  mInOrder.verifyNoMoreInteractions();
  assertEquals(0,mResults.size());
  verify(mSourceCloseableStaticBitmap).close();
}
