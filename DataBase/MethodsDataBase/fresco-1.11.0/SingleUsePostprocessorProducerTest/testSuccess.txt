@Test public void testSuccess(){
  SingleUsePostprocessorConsumer postprocessorConsumer=produceResults();
  doReturn(mDestinationCloseableBitmapRef).when(mPostprocessor).process(mSourceBitmap,mPlatformBitmapFactory);
  postprocessorConsumer.onNewResult(mSourceCloseableImageRef,Consumer.IS_LAST);
  mSourceCloseableImageRef.close();
  mTestExecutorService.runUntilIdle();
  mInOrder.verify(mProducerListener).onProducerStart(mRequestId,PostprocessorProducer.NAME);
  mInOrder.verify(mPostprocessor).process(mSourceBitmap,mPlatformBitmapFactory);
  mInOrder.verify(mProducerListener).requiresExtraMap(mRequestId);
  mInOrder.verify(mProducerListener).onProducerFinishWithSuccess(mRequestId,PostprocessorProducer.NAME,mExtraMap);
  mInOrder.verify(mConsumer).onNewResult(any(CloseableReference.class),eq(Consumer.IS_LAST));
  mInOrder.verifyNoMoreInteractions();
  assertEquals(1,mResults.size());
  CloseableReference<CloseableImage> res0=mResults.get(0);
  assertTrue(CloseableReference.isValid(res0));
  assertSame(mDestinationBitmap,((CloseableStaticBitmap)res0.get()).getUnderlyingBitmap());
  res0.close();
  verify(mBitmapResourceReleaser).release(mDestinationBitmap);
  verify(mSourceCloseableStaticBitmap).close();
}
