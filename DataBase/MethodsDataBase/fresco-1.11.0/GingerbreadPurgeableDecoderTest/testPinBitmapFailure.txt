@Test(expected=ConcurrentModificationException.class) public void testPinBitmapFailure(){
  GingerbreadPurgeableDecoder decoder=mock(GingerbreadPurgeableDecoder.class);
  PowerMockito.doThrow(new ConcurrentModificationException()).when(decoder).pinBitmap(any(Bitmap.class));
  decoder.pinBitmap(any(Bitmap.class));
  try {
    decoder.decodeFromEncodedImage(mEncodedImage,DEFAULT_BITMAP_CONFIG,null);
  }
  finally {
    verify(mBitmap).recycle();
    assertEquals(0,mBitmapCounter.getCount());
    assertEquals(0,mBitmapCounter.getSize());
  }
}
