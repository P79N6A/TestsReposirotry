@Test public void testOnNewResult(){
  when(mEncodedImage.getByteBufferRef()).thenReturn(mIntermediateResult);
  when(mEncodedImage.isValid()).thenReturn(true);
  mRemoveMetaDataConsumer.onNewResult(mEncodedImage,Consumer.NO_FLAGS);
  ArgumentCaptor<CloseableReference> argumentCaptor=ArgumentCaptor.forClass(CloseableReference.class);
  verify(mConsumer).onNewResult(argumentCaptor.capture(),eq(Consumer.NO_FLAGS));
  CloseableReference intermediateResult=argumentCaptor.getValue();
  assertEquals(mIntermediateResult.getUnderlyingReferenceTestOnly().getRefCountTestOnly(),intermediateResult.getUnderlyingReferenceTestOnly().getRefCountTestOnly());
  when(mEncodedImage.getByteBufferRef()).thenReturn(mFinalResult);
  mRemoveMetaDataConsumer.onNewResult(mEncodedImage,Consumer.IS_LAST);
  verify(mConsumer).onNewResult(argumentCaptor.capture(),eq(Consumer.NO_FLAGS));
  CloseableReference finalResult=argumentCaptor.getValue();
  assertEquals(mFinalResult.getUnderlyingReferenceTestOnly().getRefCountTestOnly(),finalResult.getUnderlyingReferenceTestOnly().getRefCountTestOnly());
}
