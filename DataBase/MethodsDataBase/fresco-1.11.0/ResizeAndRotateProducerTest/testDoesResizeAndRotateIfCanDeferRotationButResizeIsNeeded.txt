@Test public void testDoesResizeAndRotateIfCanDeferRotationButResizeIsNeeded() throws Exception {
  whenResizingEnabled();
  int rotationAngle=90;
  int exifOrientation=ExifInterface.ORIENTATION_ROTATE_90;
  int sourceWidth=10;
  int sourceHeight=10;
  whenRequestWidthAndHeight(sourceWidth,sourceHeight);
  whenRequestsRotationFromMetadataWithDeferringAllowed();
  provideIntermediateResult(DefaultImageFormats.JPEG,sourceWidth * 2,sourceHeight * 2,rotationAngle,exifOrientation);
  verifyNoIntermediateResultPassedThrough();
  provideFinalResult(DefaultImageFormats.JPEG,sourceWidth * 2,sourceHeight * 2,rotationAngle,exifOrientation);
  verifyAFinalResultPassedThroughResized();
  verifyJpegTranscoderInteractions(4,rotationAngle);
}
