/** 
 * Verify that multiple threads can write to the cache at the same time.
 */
@Test public void testConcurrency() throws Exception {
  final CyclicBarrier barrier=new CyclicBarrier(3);
  WriterCallback writerCallback=new WriterCallback(){
    @Override public void write(    OutputStream os) throws IOException {
      try {
        barrier.await(10,TimeUnit.SECONDS);
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
;
  CacheKey key1=new SimpleCacheKey("concurrent1");
  CacheKey key2=new SimpleCacheKey("concurrent2");
  Thread t1=runInsertionInSeparateThread(key1,writerCallback);
  Thread t2=runInsertionInSeparateThread(key2,writerCallback);
  barrier.await(10,TimeUnit.SECONDS);
  t1.join(1000);
  t2.join(1000);
}
