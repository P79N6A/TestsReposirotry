@Test public void testEncodedMemoryCacheGetSuccessful(){
  setupEncodedMemoryCacheGetSuccess();
  when(mProducerContext.getLowestPermittedRequestLevel()).thenReturn(ImageRequest.RequestLevel.ENCODED_MEMORY_CACHE);
  mEncodedMemoryCacheProducer.produceResults(mConsumer,mProducerContext);
  ArgumentCaptor<EncodedImage> argumentCaptor=ArgumentCaptor.forClass(EncodedImage.class);
  verify(mConsumer).onNewResult(argumentCaptor.capture(),eq(Consumer.IS_LAST));
  EncodedImage encodedImage=argumentCaptor.getValue();
  Assert.assertSame(mFinalEncodedImage.getUnderlyingReferenceTestOnly(),encodedImage.getUnderlyingReferenceTestOnly());
  verify(mProducerListener).onProducerStart(mRequestId,PRODUCER_NAME);
  Map<String,String> extraMap=ImmutableMap.of(EncodedMemoryCacheProducer.EXTRA_CACHED_VALUE_FOUND,"true");
  verify(mProducerListener).onProducerFinishWithSuccess(mRequestId,PRODUCER_NAME,extraMap);
  verify(mProducerListener).onUltimateProducerReached(mRequestId,PRODUCER_NAME,true);
  Assert.assertFalse(mFinalImageReference.isValid());
}
