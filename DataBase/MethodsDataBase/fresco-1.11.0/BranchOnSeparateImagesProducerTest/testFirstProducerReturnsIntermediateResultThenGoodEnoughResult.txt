@Test public void testFirstProducerReturnsIntermediateResultThenGoodEnoughResult(){
  EncodedImage intermediateEncodedImage=new EncodedImage(mIntermediateResult.getByteBufferRef());
  intermediateEncodedImage.setImageFormat(DefaultImageFormats.JPEG);
  intermediateEncodedImage.setRotationAngle(-1);
  intermediateEncodedImage.setWidth(WIDTH);
  intermediateEncodedImage.setHeight(HEIGHT);
  mFirstProducerConsumer.onNewResult(intermediateEncodedImage,Consumer.NO_FLAGS);
  verify(mConsumer).onNewResult(intermediateEncodedImage,Consumer.NO_FLAGS);
  EncodedImage finalEncodedImage=new EncodedImage(mFirstProducerFinalResult.getByteBufferRef());
  finalEncodedImage.setImageFormat(DefaultImageFormats.JPEG);
  finalEncodedImage.setRotationAngle(-1);
  finalEncodedImage.setWidth(WIDTH);
  finalEncodedImage.setHeight(HEIGHT);
  mFirstProducerConsumer.onNewResult(finalEncodedImage,Consumer.IS_LAST);
  verify(mConsumer).onNewResult(finalEncodedImage,Consumer.IS_LAST);
  verify(mInputProducer2,never()).produceResults(any(Consumer.class),eq(mProducerContext));
}
