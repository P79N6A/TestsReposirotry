@Test public void testFetchLocalContentUri() throws Exception {
  PooledByteBuffer pooledByteBuffer=mock(PooledByteBuffer.class);
  when(mPooledByteBufferFactory.newByteBuffer(any(InputStream.class))).thenReturn(pooledByteBuffer);
  when(mContentResolver.openInputStream(mContentUri)).thenReturn(mock(InputStream.class));
  mLocalContentUriFetchProducer.produceResults(mConsumer,mProducerContext);
  mExecutor.runUntilIdle();
  assertEquals(2,mCapturedEncodedImage.getByteBufferRef().getUnderlyingReferenceTestOnly().getRefCountTestOnly());
  assertSame(pooledByteBuffer,mCapturedEncodedImage.getByteBufferRef().get());
  verify(mProducerListener).onProducerStart(mRequestId,PRODUCER_NAME);
  verify(mProducerListener).onUltimateProducerReached(mRequestId,PRODUCER_NAME,true);
}
