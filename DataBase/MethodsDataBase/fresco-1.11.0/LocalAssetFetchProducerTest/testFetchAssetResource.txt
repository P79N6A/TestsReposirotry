@Test public void testFetchAssetResource() throws Exception {
  PooledByteBuffer pooledByteBuffer=mock(PooledByteBuffer.class);
  when(mAssetManager.open(eq(TEST_FILENAME),eq(AssetManager.ACCESS_STREAMING))).thenReturn(new ByteArrayInputStream(new byte[TEST_DATA_LENGTH]));
  when(mPooledByteBufferFactory.newByteBuffer(any(InputStream.class),eq(TEST_DATA_LENGTH))).thenReturn(pooledByteBuffer);
  mLocalAssetFetchProducer.produceResults(mConsumer,mProducerContext);
  mExecutor.runUntilIdle();
  assertEquals(2,mCapturedEncodedImage.getByteBufferRef().getUnderlyingReferenceTestOnly().getRefCountTestOnly());
  assertSame(pooledByteBuffer,mCapturedEncodedImage.getByteBufferRef().get());
  verify(mProducerListener).onProducerStart(mRequestId,PRODUCER_NAME);
  verify(mProducerListener).onProducerFinishWithSuccess(mRequestId,PRODUCER_NAME,null);
  verify(mProducerListener).onUltimateProducerReached(mRequestId,PRODUCER_NAME,true);
}
