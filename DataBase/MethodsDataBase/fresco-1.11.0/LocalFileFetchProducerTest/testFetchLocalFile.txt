@Test public void testFetchLocalFile() throws Exception {
  PooledByteBuffer pooledByteBuffer=mock(PooledByteBuffer.class);
  when(mPooledByteBufferFactory.newByteBuffer(any(InputStream.class),eq(INPUT_STREAM_LENGTH))).thenReturn(pooledByteBuffer);
  mLocalFileFetchProducer.produceResults(mConsumer,mProducerContext);
  mExecutor.runUntilIdle();
  assertEquals(2,mCapturedEncodedImage.getByteBufferRef().getUnderlyingReferenceTestOnly().getRefCountTestOnly());
  assertSame(pooledByteBuffer,mCapturedEncodedImage.getByteBufferRef().get());
  verify(mProducerListener).onProducerStart(mRequestId,PRODUCER_NAME);
  verify(mProducerListener).onProducerFinishWithSuccess(mRequestId,PRODUCER_NAME,null);
  verify(mProducerListener).onUltimateProducerReached(mRequestId,PRODUCER_NAME,true);
}
