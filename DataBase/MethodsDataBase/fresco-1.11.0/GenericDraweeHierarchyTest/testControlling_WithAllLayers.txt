@Test public void testControlling_WithAllLayers() throws Exception {
  GenericDraweeHierarchy dh=mBuilder.setBackground(mBackground).setOverlays(Arrays.asList(mOverlay1,mOverlay2)).setPlaceholderImage(mPlaceholderImage,null).setRetryImage(mRetryImage,null).setFailureImage(mFailureImage,null).setProgressBarImage(mProgressBarImage,null).setActualImageScaleType(null).setFadeDuration(250).build();
  final int backgroundIndex=0;
  final int placeholderImageIndex=1;
  final int actualImageIndex=2;
  final int progressBarImageIndex=3;
  final int retryImageIndex=4;
  final int failureImageIndex=5;
  final int overlaysIndex=6;
  int numOverlays=2;
  FadeDrawable fadeDrawable=(FadeDrawable)dh.getTopLevelDrawable().getCurrent();
  assertEquals(mPlaceholderImage,fadeDrawable.getDrawable(placeholderImageIndex));
  assertEquals(mProgressBarImage,fadeDrawable.getDrawable(progressBarImageIndex));
  assertEquals(mRetryImage,fadeDrawable.getDrawable(retryImageIndex));
  assertEquals(mFailureImage,fadeDrawable.getDrawable(failureImageIndex));
  assertEquals(ForwardingDrawable.class,fadeDrawable.getDrawable(actualImageIndex).getClass());
  ForwardingDrawable finalImageSettableDrawable=(ForwardingDrawable)fadeDrawable.getDrawable(actualImageIndex);
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage2,1f,true);
  assertEquals(mActualImage2,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.reset();
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage2,1f,false);
  assertEquals(mActualImage2,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
  dh.reset();
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage1,0.5f,true);
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage2,1f,false);
  assertEquals(mActualImage2,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
  dh.reset();
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage1,0.5f,false);
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
  dh.setImage(mActualImage2,1f,false);
  assertEquals(mActualImage2,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
  dh.reset();
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage1,0.5f,true);
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setRetry(new RuntimeException());
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
  dh.reset();
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  dh.setProgress(0f,true);
  assertEquals(ColorDrawable.class,finalImageSettableDrawable.getCurrent().getClass());
  assertEquals(true,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setImage(mActualImage1,0.5f,true);
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_NONE,fadeDrawable.getTransitionState());
  dh.setFailure(new RuntimeException());
  assertEquals(mActualImage1,finalImageSettableDrawable.getCurrent());
  assertEquals(false,fadeDrawable.isLayerOn(placeholderImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(actualImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(progressBarImageIndex));
  assertEquals(false,fadeDrawable.isLayerOn(retryImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(failureImageIndex));
  assertEquals(true,fadeDrawable.isLayerOn(backgroundIndex));
  assertLayersOn(fadeDrawable,overlaysIndex,numOverlays);
  assertEquals(FadeDrawable.TRANSITION_STARTING,fadeDrawable.getTransitionState());
  assertEquals(250,fadeDrawable.getTransitionDuration());
}
