@Test public void testFailure(){
  final long startTime=10L;
  final long imageLoadTime=200L;
  final long imageReleaseTime=345L;
  int expectedNumOfTimestamps=0;
  when(mMonotonicClock.now()).thenReturn(startTime);
  mListener.onSubmit(CONTROLLER_ID,CALLER_CONTEXT);
  expectedNumOfTimestamps++;
  when(mImagePerfState.getImageLoadStatus()).thenReturn(ImageLoadStatus.REQUESTED);
  when(mMonotonicClock.now()).thenReturn(imageLoadTime);
  mListener.onFailure(CONTROLLER_ID,new Throwable("Error"));
  expectedNumOfTimestamps++;
  when(mImagePerfState.getImageLoadStatus()).thenReturn(ImageLoadStatus.ERROR);
  when(mMonotonicClock.now()).thenReturn(imageReleaseTime);
  mListener.onRelease(CONTROLLER_ID);
  expectedNumOfTimestamps++;
  verify(mMonotonicClock,times(expectedNumOfTimestamps)).now();
  verify(mImagePerfMonitor).notifyStatusUpdated(eq(mImagePerfState),eq(ImageLoadStatus.REQUESTED));
  verify(mImagePerfMonitor).notifyStatusUpdated(eq(mImagePerfState),eq(ImageLoadStatus.ERROR));
  verify(mImagePerfState).setControllerSubmitTimeMs(startTime);
  verify(mImagePerfState).setControllerFailureTimeMs(imageLoadTime);
}
