@Test public void testExceptionInResponseHandler() throws IOException {
  NetworkFetcher.Callback callback=performFetch();
  InputStream inputStream=mock(InputStream.class);
  when(inputStream.read(any(byte[].class))).thenThrow(new IOException());
  when(mNetworkFetcher.shouldPropagate(any(FetchState.class))).thenReturn(false);
  try {
    callback.onResponse(inputStream,100);
    fail();
  }
 catch (  Exception e) {
    verify(mPooledByteBufferFactory).newOutputStream(100);
    verify(mPooledByteBufferOutputStream).close();
    verify(mProducerListener,never()).onProducerEvent(eq(mRequestId),any(String.class),any(String.class));
  }
}
