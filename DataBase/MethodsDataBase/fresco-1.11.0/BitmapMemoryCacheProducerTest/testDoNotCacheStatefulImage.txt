/** 
 * Verify that stateful image results, both intermediate and final, are never cached.
 */
@Test public void testDoNotCacheStatefulImage(){
  when(mCloseableImage1.isStateful()).thenReturn(true);
  when(mCloseableImage2.isStateful()).thenReturn(true);
  setupBitmapMemoryCacheGetNotFound();
  setupInputProducerStreamingSuccess();
  when(mMemoryCache.get(mBitmapMemoryCacheKey)).thenReturn(null);
  mBitmapMemoryCacheProducer.produceResults(mConsumer,mProducerContext);
  verify(mConsumer).onNewResult(mIntermediateImageReference,Consumer.NO_FLAGS);
  verify(mConsumer).onNewResult(mFinalImageReference,Consumer.IS_LAST);
  verify(mMemoryCache,never()).cache(any(BitmapMemoryCacheKey.class),any(CloseableReference.class));
}
