@Test public void testOnNewResultLastAndJpeg(){
  int rotationAngle=180;
  int orientation=1;
  int width=10;
  int height=20;
  when(ImageFormatChecker.getImageFormat_WrapIOException(any(InputStream.class))).thenReturn(DefaultImageFormats.JPEG);
  when(JfifUtil.getAutoRotateAngleFromOrientation(orientation)).thenReturn(rotationAngle);
  when(JfifUtil.getOrientation(any(InputStream.class))).thenReturn(orientation);
  when(BitmapUtil.decodeDimensionsAndColorSpace(any(InputStream.class))).thenReturn(new ImageMetaData(width,height,null));
  mAddMetaDataConsumer.onNewResult(mFinalResult,Consumer.IS_LAST);
  ArgumentCaptor<EncodedImage> argumentCaptor=ArgumentCaptor.forClass(EncodedImage.class);
  verify(mConsumer).onNewResult(argumentCaptor.capture(),eq(Consumer.IS_LAST));
  EncodedImage encodedImage=argumentCaptor.getValue();
  assertTrue(EncodedImage.isValid(encodedImage));
  assertEquals(DefaultImageFormats.JPEG,encodedImage.getImageFormat());
  assertEquals(rotationAngle,encodedImage.getRotationAngle());
  assertEquals(width,encodedImage.getWidth());
  assertEquals(height,encodedImage.getHeight());
}
