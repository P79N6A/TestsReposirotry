@Test public void testWritesToDiskCache() throws Exception {
  mBufferedDiskCache.put(mCacheKey,mEncodedImage);
  reset(mPooledByteBuffer);
  when(mPooledByteBuffer.size()).thenReturn(0);
  final ArgumentCaptor<WriterCallback> wcCapture=ArgumentCaptor.forClass(WriterCallback.class);
  when(mFileCache.insert(eq(mCacheKey),wcCapture.capture())).thenReturn(null);
  mWritePriorityExecutor.runUntilIdle();
  OutputStream os=mock(OutputStream.class);
  wcCapture.getValue().write(os);
  assertEquals(2,mCloseableReference.getUnderlyingReferenceTestOnly().getRefCountTestOnly());
}
