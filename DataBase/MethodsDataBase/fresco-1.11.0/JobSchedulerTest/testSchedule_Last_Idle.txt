@Test public void testSchedule_Last_Idle() throws Exception {
  EncodedImage encodedImage=fakeEncodedImage();
  mJobScheduler.updateJob(encodedImage,Consumer.IS_LAST);
  assertEquals(JobScheduler.JobState.IDLE,mJobScheduler.mJobState);
  assertTrue(mJobScheduler.scheduleJob());
  assertEquals(0,mTestScheduledExecutorService.getPendingCount());
  assertEquals(1,mTestExecutorService.getPendingCount());
  assertEquals(0,mTestJobRunnable.jobs.size());
  mFakeClockForTime.incrementBy(1234);
  mFakeClockForWorker.incrementBy(1234);
  mFakeClockForScheduled.incrementBy(1234);
  assertEquals(1,mTestJobRunnable.jobs.size());
  assertJobsEqual(mTestJobRunnable.jobs.get(0),encodedImage,Consumer.IS_LAST);
  mTestJobRunnable.jobs.get(0).encodedImage.close();
  encodedImage.close();
  assertNull(encodedImage.getByteBufferRef());
}
