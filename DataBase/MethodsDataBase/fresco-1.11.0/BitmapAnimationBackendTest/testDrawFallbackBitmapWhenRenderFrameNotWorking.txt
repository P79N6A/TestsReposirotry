@Test public void testDrawFallbackBitmapWhenRenderFrameNotWorking(){
  when(mBitmapFrameCache.getFallbackFrame(anyInt())).thenReturn(mBitmapRefererence);
  CloseableReference<Bitmap> temporaryBitmap=CloseableReference.of(mBitmap,mBitmapResourceReleaser);
  when(mPlatformBitmapFactory.createBitmap(anyInt(),anyInt(),any(Bitmap.Config.class))).thenReturn(temporaryBitmap);
  when(mBitmapFrameRenderer.renderFrame(anyInt(),any(Bitmap.class))).thenReturn(false);
  mBitmapAnimationBackend.drawFrame(mParentDrawable,mCanvas,3);
  verify(mFrameListener).onDrawFrameStart(mBitmapAnimationBackend,3);
  verify(mBitmapFrameCache).getCachedFrame(3);
  verify(mBitmapFrameCache).getBitmapToReuseForFrame(3,0,0);
  verify(mPlatformBitmapFactory).createBitmap(0,0,Bitmap.Config.ARGB_8888);
  assertThat(temporaryBitmap.isValid()).isFalse();
  verify(mBitmapFrameCache).getFallbackFrame(3);
  verify(mCanvas).drawBitmap(eq(mBitmap),eq(0f),eq(0f),any(Paint.class));
  verifyFramePreparationStrategyCalled(3);
  verifyListenersNotifiedWithoutCache(3,BitmapAnimationBackend.FRAME_TYPE_FALLBACK);
  assertReferencesClosed();
}
