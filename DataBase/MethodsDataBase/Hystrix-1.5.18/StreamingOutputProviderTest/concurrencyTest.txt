@Test @Ignore("Test is flaky") public void concurrencyTest() throws Exception {
  Response resp=sse.handleRequest();
  assertEquals(200,resp.getStatus());
  assertEquals("text/event-stream;charset=UTF-8",resp.getHeaders().getFirst(HttpHeaders.CONTENT_TYPE));
  assertEquals("no-cache, no-store, max-age=0, must-revalidate",resp.getHeaders().getFirst(HttpHeaders.CACHE_CONTROL));
  assertEquals("no-cache",resp.getHeaders().getFirst("Pragma"));
  resp=sse.handleRequest();
  assertEquals(200,resp.getStatus());
  resp=sse.handleRequest();
  assertEquals(503,resp.getStatus());
  assertEquals("MaxConcurrentConnections reached: " + sse.getMaxNumberConcurrentConnectionsAllowed(),resp.getEntity());
  sse.getCurrentConnections().decrementAndGet();
  resp=sse.handleRequest();
  assertEquals(200,resp.getStatus());
}
