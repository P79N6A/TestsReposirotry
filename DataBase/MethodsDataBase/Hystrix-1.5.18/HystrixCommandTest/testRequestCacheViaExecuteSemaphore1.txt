/** 
 * Test Request scoped caching with a mixture of commands
 */
@Test public void testRequestCacheViaExecuteSemaphore1(){
  TestCircuitBreaker circuitBreaker=new TestCircuitBreaker();
  SuccessfulCacheableCommandViaSemaphore command1=new SuccessfulCacheableCommandViaSemaphore(circuitBreaker,true,"A");
  SuccessfulCacheableCommandViaSemaphore command2=new SuccessfulCacheableCommandViaSemaphore(circuitBreaker,true,"B");
  SuccessfulCacheableCommandViaSemaphore command3=new SuccessfulCacheableCommandViaSemaphore(circuitBreaker,true,"A");
  assertFalse(command1.isCommandRunningInThread());
  String f1=command1.execute();
  String f2=command2.execute();
  String f3=command3.execute();
  assertEquals("A",f1);
  assertEquals("B",f2);
  assertEquals("A",f3);
  assertTrue(command1.executed);
  assertTrue(command2.executed);
  assertFalse(command3.executed);
  assertCommandExecutionEvents(command1,HystrixEventType.SUCCESS);
  assertCommandExecutionEvents(command2,HystrixEventType.SUCCESS);
  assertCommandExecutionEvents(command3,HystrixEventType.SUCCESS,HystrixEventType.RESPONSE_FROM_CACHE);
  assertEquals(0,circuitBreaker.metrics.getCurrentConcurrentExecutionCount());
  assertSaneHystrixRequestLog(3);
}
