@Test public void testRequestCacheOnTimeoutCausesNullPointerException() throws Exception {
  TestCircuitBreaker circuitBreaker=new TestCircuitBreaker();
  RequestCacheNullPointerExceptionCase command1=new RequestCacheNullPointerExceptionCase(circuitBreaker);
  RequestCacheNullPointerExceptionCase command2=new RequestCacheNullPointerExceptionCase(circuitBreaker);
  RequestCacheNullPointerExceptionCase command3=new RequestCacheNullPointerExceptionCase(circuitBreaker);
  assertFalse(command1.execute());
  assertFalse(command2.execute());
  assertFalse(command3.execute());
  Thread.sleep(500);
  RequestCacheNullPointerExceptionCase command4=new RequestCacheNullPointerExceptionCase(circuitBreaker);
  Boolean value=command4.execute();
  assertFalse(value);
  RequestCacheNullPointerExceptionCase command5=new RequestCacheNullPointerExceptionCase(circuitBreaker);
  Future<Boolean> f=command5.queue();
  assertNotNull(f);
  assertFalse(f.get());
  assertTrue(command5.isResponseFromFallback());
  assertTrue(command5.isResponseTimedOut());
  assertFalse(command5.isFailedExecution());
  assertFalse(command5.isResponseShortCircuited());
  assertNotNull(command5.getExecutionException());
  assertCommandExecutionEvents(command1,HystrixEventType.TIMEOUT,HystrixEventType.FALLBACK_SUCCESS);
  assertCommandExecutionEvents(command2,HystrixEventType.TIMEOUT,HystrixEventType.FALLBACK_SUCCESS,HystrixEventType.RESPONSE_FROM_CACHE);
  assertCommandExecutionEvents(command3,HystrixEventType.TIMEOUT,HystrixEventType.FALLBACK_SUCCESS,HystrixEventType.RESPONSE_FROM_CACHE);
  assertCommandExecutionEvents(command4,HystrixEventType.TIMEOUT,HystrixEventType.FALLBACK_SUCCESS,HystrixEventType.RESPONSE_FROM_CACHE);
  assertCommandExecutionEvents(command5,HystrixEventType.TIMEOUT,HystrixEventType.FALLBACK_SUCCESS,HystrixEventType.RESPONSE_FROM_CACHE);
  assertEquals(0,circuitBreaker.metrics.getCurrentConcurrentExecutionCount());
  assertSaneHystrixRequestLog(5);
}
