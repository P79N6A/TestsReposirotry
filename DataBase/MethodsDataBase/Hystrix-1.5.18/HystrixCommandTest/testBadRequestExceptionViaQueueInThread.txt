/** 
 * Test that a BadRequestException can be thrown and not count towards errors and bypasses fallback.
 */
@Test public void testBadRequestExceptionViaQueueInThread() throws Exception {
  TestCircuitBreaker circuitBreaker=new TestCircuitBreaker();
  BadRequestCommand command1=null;
  try {
    command1=new BadRequestCommand(circuitBreaker,ExecutionIsolationStrategy.THREAD);
    command1.queue().get();
    fail("we expect to receive a " + HystrixBadRequestException.class.getSimpleName());
  }
 catch (  ExecutionException e) {
    e.printStackTrace();
    if (e.getCause() instanceof HystrixBadRequestException) {
    }
 else {
      fail("We expect a " + HystrixBadRequestException.class.getSimpleName() + " but got a "+ e.getClass().getSimpleName());
    }
  }
  assertCommandExecutionEvents(command1,HystrixEventType.BAD_REQUEST);
  assertNotNull(command1.getExecutionException());
  assertEquals(0,circuitBreaker.metrics.getCurrentConcurrentExecutionCount());
  assertSaneHystrixRequestLog(1);
}
