/** 
 * Test an Exception implementing NotWrappedByHystrix being thrown
 * @throws InterruptedException
 */
@Test public void testNotWrappedExceptionViaObserve() throws InterruptedException {
  TestCircuitBreaker circuitBreaker=new TestCircuitBreaker();
  CommandWithNotWrappedByHystrixException command=new CommandWithNotWrappedByHystrixException(circuitBreaker);
  final AtomicReference<Throwable> t=new AtomicReference<Throwable>();
  final CountDownLatch latch=new CountDownLatch(1);
  try {
    command.observe().subscribe(new Observer<Boolean>(){
      @Override public void onCompleted(){
        latch.countDown();
      }
      @Override public void onError(      Throwable e){
        t.set(e);
        latch.countDown();
      }
      @Override public void onNext(      Boolean args){
      }
    }
);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("we should not get anything thrown, it should be emitted via the Observer#onError method");
  }
  latch.await(1,TimeUnit.SECONDS);
  assertNotNull(t.get());
  t.get().printStackTrace();
  assertTrue(t.get() instanceof NotWrappedByHystrixTestException);
  assertTrue(command.getExecutionTimeInMilliseconds() > -1);
  assertTrue(command.isFailedExecution());
  assertCommandExecutionEvents(command,HystrixEventType.FAILURE);
  assertNotNull(command.getExecutionException());
  assertTrue(command.getExecutionException() instanceof NotWrappedByHystrixTestException);
  assertEquals(0,command.getBuilder().metrics.getCurrentConcurrentExecutionCount());
  assertSaneHystrixRequestLog(1);
}
