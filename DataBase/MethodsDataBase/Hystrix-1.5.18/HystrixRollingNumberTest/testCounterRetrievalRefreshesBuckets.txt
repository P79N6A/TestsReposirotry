@Test public void testCounterRetrievalRefreshesBuckets(){
  MockedTime time=new MockedTime();
  try {
    HystrixRollingNumber counter=new HystrixRollingNumber(time,200,10);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    time.increment(counter.bucketSizeInMillseconds * 3);
    assertEquals(1,counter.buckets.size());
    assertEquals(4,counter.getRollingSum(HystrixRollingNumberEvent.SUCCESS));
    assertEquals(2,counter.getRollingSum(HystrixRollingNumberEvent.FAILURE));
    assertEquals(4,counter.buckets.size());
    time.increment(counter.timeInMilliseconds);
    assertEquals(0,counter.getRollingSum(HystrixRollingNumberEvent.SUCCESS));
    assertEquals(0,counter.getRollingSum(HystrixRollingNumberEvent.FAILURE));
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    assertEquals(1,counter.getRollingSum(HystrixRollingNumberEvent.SUCCESS));
    assertEquals(0,counter.getRollingSum(HystrixRollingNumberEvent.FAILURE));
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Exception: " + e.getMessage());
  }
}
