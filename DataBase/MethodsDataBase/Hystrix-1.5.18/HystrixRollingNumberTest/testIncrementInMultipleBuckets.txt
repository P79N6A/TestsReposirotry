@Test public void testIncrementInMultipleBuckets(){
  MockedTime time=new MockedTime();
  try {
    HystrixRollingNumber counter=new HystrixRollingNumber(time,200,10);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.TIMEOUT);
    counter.increment(HystrixRollingNumberEvent.TIMEOUT);
    counter.increment(HystrixRollingNumberEvent.SHORT_CIRCUITED);
    time.increment(counter.bucketSizeInMillseconds * 3);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.FAILURE);
    counter.increment(HystrixRollingNumberEvent.TIMEOUT);
    counter.increment(HystrixRollingNumberEvent.SHORT_CIRCUITED);
    assertEquals(4,counter.buckets.size());
    assertEquals(2,counter.buckets.getLast().getAdder(HystrixRollingNumberEvent.SUCCESS).sum());
    assertEquals(3,counter.buckets.getLast().getAdder(HystrixRollingNumberEvent.FAILURE).sum());
    assertEquals(1,counter.buckets.getLast().getAdder(HystrixRollingNumberEvent.TIMEOUT).sum());
    assertEquals(1,counter.buckets.getLast().getAdder(HystrixRollingNumberEvent.SHORT_CIRCUITED).sum());
    assertEquals(6,counter.getRollingSum(HystrixRollingNumberEvent.SUCCESS));
    assertEquals(5,counter.getRollingSum(HystrixRollingNumberEvent.FAILURE));
    assertEquals(3,counter.getRollingSum(HystrixRollingNumberEvent.TIMEOUT));
    assertEquals(2,counter.getRollingSum(HystrixRollingNumberEvent.SHORT_CIRCUITED));
    time.increment(counter.timeInMilliseconds);
    counter.increment(HystrixRollingNumberEvent.SUCCESS);
    assertEquals(1,counter.getRollingSum(HystrixRollingNumberEvent.SUCCESS));
    assertEquals(0,counter.getRollingSum(HystrixRollingNumberEvent.FAILURE));
    assertEquals(0,counter.getRollingSum(HystrixRollingNumberEvent.TIMEOUT));
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Exception: " + e.getMessage());
  }
}
