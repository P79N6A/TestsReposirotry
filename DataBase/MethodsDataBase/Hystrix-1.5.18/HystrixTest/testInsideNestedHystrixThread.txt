@Test public void testInsideNestedHystrixThread(){
  HystrixCommand<Boolean> command=new HystrixCommand<Boolean>(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey("TestUtil")).andCommandKey(HystrixCommandKey.Factory.asKey("OuterCommand"))){
    @Override protected Boolean run(){
      assertEquals("OuterCommand",Hystrix.getCurrentThreadExecutingCommand().name());
      System.out.println("Outer Thread : " + Thread.currentThread().getName());
      assertEquals(1,Hystrix.getCommandCount());
      if (Hystrix.getCurrentThreadExecutingCommand() == null) {
        throw new RuntimeException("BEFORE expected it to run inside a thread");
      }
      HystrixCommand<Boolean> command2=new HystrixCommand<Boolean>(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey("TestUtil")).andCommandKey(HystrixCommandKey.Factory.asKey("InnerCommand"))){
        @Override protected Boolean run(){
          assertEquals("InnerCommand",Hystrix.getCurrentThreadExecutingCommand().name());
          System.out.println("Inner Thread : " + Thread.currentThread().getName());
          assertEquals(1,Hystrix.getCommandCount());
          return Hystrix.getCurrentThreadExecutingCommand() != null;
        }
      }
;
      if (Hystrix.getCurrentThreadExecutingCommand() == null) {
        throw new RuntimeException("AFTER expected it to run inside a thread");
      }
      return command2.execute();
    }
  }
;
  assertTrue(command.execute());
  assertNull(Hystrix.getCurrentThreadExecutingCommand());
}
