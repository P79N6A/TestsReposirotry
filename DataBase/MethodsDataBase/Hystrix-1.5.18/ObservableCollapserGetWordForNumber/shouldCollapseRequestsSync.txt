/** 
 * Example where we subscribe without using a specific scheduler. That means we run the actions on the same thread.
 */
@Test public void shouldCollapseRequestsSync(){
  final int noOfRequests=10;
  final Map<Integer,TestSubscriber<String>> subscribersByNumber=new HashMap<Integer,TestSubscriber<String>>(noOfRequests);
  TestSubscriber<String> subscriber;
  for (int number=0; number < noOfRequests; number++) {
    subscriber=new TestSubscriber<String>();
    new ObservableCollapserGetWordForNumber(number).toObservable().subscribe(subscriber);
    subscribersByNumber.put(number,subscriber);
    if (number == noOfRequests / 2)     sleep(1000);
  }
  assertThat(subscribersByNumber.size(),is(noOfRequests));
  for (  final Entry<Integer,TestSubscriber<String>> subscriberByNumber : subscribersByNumber.entrySet()) {
    subscriber=subscriberByNumber.getValue();
    subscriber.awaitTerminalEvent(10,TimeUnit.SECONDS);
    assertThat(subscriber.getOnErrorEvents().toString(),subscriber.getOnErrorEvents().size(),is(0));
    assertThat(subscriber.getOnNextEvents().size(),is(1));
    final String word=subscriber.getOnNextEvents().get(0);
    System.out.println("Translated " + subscriberByNumber.getKey() + " to "+ word);
    assertThat(word,equalTo(numberToWord(subscriberByNumber.getKey())));
  }
  assertTrue(ObservableCollapserGetWordForNumber.getCmdCount() > 1);
  assertTrue(ObservableCollapserGetWordForNumber.getCmdCount() < noOfRequests);
}
