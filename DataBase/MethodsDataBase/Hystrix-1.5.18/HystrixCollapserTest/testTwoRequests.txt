@Test public void testTwoRequests() throws Exception {
  TestCollapserTimer timer=new TestCollapserTimer();
  HystrixCollapser<List<String>,String,String> collapser1=new TestRequestCollapser(timer,1);
  Future<String> response1=collapser1.queue();
  HystrixCollapser<List<String>,String,String> collapser2=new TestRequestCollapser(timer,2);
  Future<String> response2=collapser2.queue();
  timer.incrementTime(10);
  assertEquals("1",response1.get());
  assertEquals("2",response2.get(1000,TimeUnit.MILLISECONDS));
  assertEquals(1,HystrixRequestLog.getCurrentRequest().getAllExecutedCommands().size());
  HystrixCollapserMetrics metrics=collapser1.getMetrics();
  assertSame(metrics,collapser2.getMetrics());
  HystrixInvokableInfo<?> command=HystrixRequestLog.getCurrentRequest().getAllExecutedCommands().iterator().next();
  assertEquals(2,command.getNumberCollapsed());
}
