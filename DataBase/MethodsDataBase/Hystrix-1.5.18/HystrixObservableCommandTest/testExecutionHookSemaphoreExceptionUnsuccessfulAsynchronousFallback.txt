/** 
 * Short-circuitInteger : NO Thread/semaphore: SEMAPHORE Semaphore Permit reachedInteger : NO Execution Result: HystrixRuntimeException Fallback: asynchronous HystrixRuntimeException
 */
@Test public void testExecutionHookSemaphoreExceptionUnsuccessfulAsynchronousFallback(){
  assertHooksOnFailure(new Func0<TestHystrixObservableCommand<Integer>>(){
    @Override public TestHystrixObservableCommand<Integer> call(){
      return getCommand(ExecutionIsolationStrategy.SEMAPHORE,AbstractTestHystrixCommand.ExecutionResult.FAILURE,AbstractTestHystrixCommand.FallbackResult.ASYNC_FAILURE);
    }
  }
,new Action1<TestHystrixObservableCommand<Integer>>(){
    @Override public void call(    TestHystrixObservableCommand<Integer> command){
      TestableExecutionHook hook=command.getBuilder().executionHook;
      assertTrue(hook.commandEmissionsMatch(0,1,0));
      assertTrue(hook.executionEventsMatch(0,1,0));
      assertTrue(hook.fallbackEventsMatch(0,1,0));
      assertEquals(RuntimeException.class,hook.getCommandException().getClass());
      assertEquals(RuntimeException.class,hook.getExecutionException().getClass());
      assertEquals(RuntimeException.class,hook.getFallbackException().getClass());
      assertEquals("onStart - !onRunStart - onExecutionStart - onExecutionError - !onRunError - onFallbackStart - onFallbackError - onError - ",command.getBuilder().executionHook.executionSequence.toString());
    }
  }
);
}
