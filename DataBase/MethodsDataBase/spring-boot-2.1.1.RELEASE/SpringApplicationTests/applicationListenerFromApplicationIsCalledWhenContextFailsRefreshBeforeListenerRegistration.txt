@SuppressWarnings("unchecked") @Test public void applicationListenerFromApplicationIsCalledWhenContextFailsRefreshBeforeListenerRegistration(){
  ApplicationListener<ApplicationEvent> listener=mock(ApplicationListener.class);
  SpringApplication application=new SpringApplication(ExampleConfig.class);
  application.addListeners(listener);
  try {
    application.run();
    fail("Run should have failed with an ApplicationContextException");
  }
 catch (  ApplicationContextException ex) {
    verifyListenerEvents(listener,ApplicationStartingEvent.class,ApplicationEnvironmentPreparedEvent.class,ApplicationContextInitializedEvent.class,ApplicationPreparedEvent.class,ApplicationFailedEvent.class);
  }
}
