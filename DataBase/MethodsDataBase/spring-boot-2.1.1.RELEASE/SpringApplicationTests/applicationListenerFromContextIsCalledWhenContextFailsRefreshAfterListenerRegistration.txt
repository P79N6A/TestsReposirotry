@SuppressWarnings("unchecked") @Test public void applicationListenerFromContextIsCalledWhenContextFailsRefreshAfterListenerRegistration(){
  ApplicationListener<ApplicationEvent> listener=mock(ApplicationListener.class);
  SpringApplication application=new SpringApplication(BrokenPostConstructConfig.class);
  application.setWebApplicationType(WebApplicationType.NONE);
  application.addInitializers((applicationContext) -> applicationContext.addApplicationListener(listener));
  try {
    application.run();
    fail("Run should have failed with a BeanCreationException");
  }
 catch (  BeanCreationException ex) {
    verifyListenerEvents(listener,ApplicationFailedEvent.class);
  }
}
