@SuppressWarnings("unchecked") @Test public void applicationListenerFromContextIsCalledWhenContextFailsRefreshBeforeListenerRegistration(){
  final ApplicationListener<ApplicationEvent> listener=mock(ApplicationListener.class);
  SpringApplication application=new SpringApplication(ExampleConfig.class);
  application.addInitializers((applicationContext) -> applicationContext.addApplicationListener(listener));
  try {
    application.run();
    fail("Run should have failed with an ApplicationContextException");
  }
 catch (  ApplicationContextException ex) {
    verifyListenerEvents(listener,ApplicationFailedEvent.class);
  }
}
