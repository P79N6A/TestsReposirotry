@Test public void withBasicAuthAddsBasicAuthInterceptorWhenNotAlreadyPresent(){
  TestRestTemplate originalTemplate=new TestRestTemplate();
  TestRestTemplate basicAuthTemplate=originalTemplate.withBasicAuth("user","password");
  assertThat(basicAuthTemplate.getRestTemplate().getMessageConverters()).containsExactlyElementsOf(originalTemplate.getRestTemplate().getMessageConverters());
  assertThat(basicAuthTemplate.getRestTemplate().getRequestFactory()).isInstanceOf(InterceptingClientHttpRequestFactory.class);
  assertThat(ReflectionTestUtils.getField(basicAuthTemplate.getRestTemplate().getRequestFactory(),"requestFactory")).isInstanceOf(CustomHttpComponentsClientHttpRequestFactory.class);
  assertThat(basicAuthTemplate.getRestTemplate().getUriTemplateHandler()).isSameAs(originalTemplate.getRestTemplate().getUriTemplateHandler());
  assertThat(basicAuthTemplate.getRestTemplate().getInterceptors()).hasSize(1);
  assertBasicAuthorizationInterceptorCredentials(basicAuthTemplate,"user","password");
}
