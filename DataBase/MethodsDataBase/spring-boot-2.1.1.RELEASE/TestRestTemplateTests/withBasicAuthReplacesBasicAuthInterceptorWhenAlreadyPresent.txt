@Test public void withBasicAuthReplacesBasicAuthInterceptorWhenAlreadyPresent(){
  TestRestTemplate original=new TestRestTemplate("foo","bar").withBasicAuth("replace","replace");
  TestRestTemplate basicAuth=original.withBasicAuth("user","password");
  assertThat(basicAuth.getRestTemplate().getMessageConverters()).containsExactlyElementsOf(original.getRestTemplate().getMessageConverters());
  assertThat(basicAuth.getRestTemplate().getRequestFactory()).isInstanceOf(InterceptingClientHttpRequestFactory.class);
  assertThat(ReflectionTestUtils.getField(basicAuth.getRestTemplate().getRequestFactory(),"requestFactory")).isInstanceOf(CustomHttpComponentsClientHttpRequestFactory.class);
  assertThat(basicAuth.getRestTemplate().getUriTemplateHandler()).isSameAs(original.getRestTemplate().getUriTemplateHandler());
  assertThat(basicAuth.getRestTemplate().getInterceptors()).hasSize(1);
  assertBasicAuthorizationInterceptorCredentials(basicAuth,"user","password");
}
