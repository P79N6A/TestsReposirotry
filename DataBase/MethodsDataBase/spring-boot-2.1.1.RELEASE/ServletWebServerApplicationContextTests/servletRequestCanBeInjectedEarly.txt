@Test public void servletRequestCanBeInjectedEarly() throws Exception {
  int initialOutputLength=this.output.toString().length();
  addWebServerFactoryBean();
  RootBeanDefinition beanDefinition=new RootBeanDefinition(WithAutowiredServletRequest.class);
  beanDefinition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR);
  this.context.registerBeanDefinition("withAutowiredServletRequest",beanDefinition);
  this.context.addBeanFactoryPostProcessor(new BeanFactoryPostProcessor(){
    @Override public void postProcessBeanFactory(    ConfigurableListableBeanFactory beanFactory) throws BeansException {
      WithAutowiredServletRequest bean=beanFactory.getBean(WithAutowiredServletRequest.class);
      assertThat(bean.getRequest()).isNotNull();
    }
  }
);
  this.context.refresh();
  String output=this.output.toString().substring(initialOutputLength);
  assertThat(output).doesNotContain("Replacing scope");
}
