@Test public void elasticsearchIsOutOfServiceByStatus() throws IOException {
  BasicHttpEntity httpEntity=new BasicHttpEntity();
  httpEntity.setContent(new ByteArrayInputStream(createJsonResult(200,"red").getBytes()));
  Response response=mock(Response.class);
  StatusLine statusLine=mock(StatusLine.class);
  when(statusLine.getStatusCode()).thenReturn(200);
  when(response.getStatusLine()).thenReturn(statusLine);
  when(response.getEntity()).thenReturn(httpEntity);
  when(this.restClient.performRequest(any(Request.class))).thenReturn(response);
  assertThat(this.elasticsearchRestHealthIndicator.health().getStatus()).isEqualTo(Status.OUT_OF_SERVICE);
}
