@Test public void embeddedWithPersistentMode() throws IOException {
  File dataFolder=this.folder.newFolder();
  final String messageId=UUID.randomUUID().toString();
  this.contextRunner.withUserConfiguration(EmptyConfiguration.class).withPropertyValues("spring.artemis.embedded.queues=TestQueue","spring.artemis.embedded.persistent:true","spring.artemis.embedded.dataDirectory:" + dataFolder.getAbsolutePath()).run((context) -> context.getBean(JmsTemplate.class).send("TestQueue",(session) -> session.createTextMessage(messageId))).run((context) -> {
    JmsTemplate jmsTemplate2=context.getBean(JmsTemplate.class);
    jmsTemplate2.setReceiveTimeout(1000L);
    Message message=jmsTemplate2.receive("TestQueue");
    assertThat(message).isNotNull();
    assertThat(((TextMessage)message).getText()).isEqualTo(messageId);
  }
);
}
