@Test public void faultyFilterCausesStartFailure(){
  AbstractServletWebServerFactory factory=getFactory();
  factory.addInitializers((servletContext) -> servletContext.addFilter("faulty",new Filter(){
    @Override public void init(    FilterConfig filterConfig) throws ServletException {
      throw new ServletException("Faulty filter");
    }
    @Override public void doFilter(    ServletRequest request,    ServletResponse response,    FilterChain chain) throws IOException, ServletException {
      chain.doFilter(request,response);
    }
    @Override public void destroy(){
    }
  }
));
  assertThatExceptionOfType(WebServerException.class).isThrownBy(() -> factory.getWebServer().start());
}
