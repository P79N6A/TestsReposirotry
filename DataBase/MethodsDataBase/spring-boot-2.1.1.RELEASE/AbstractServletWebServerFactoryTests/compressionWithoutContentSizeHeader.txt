@Test public void compressionWithoutContentSizeHeader() throws Exception {
  AbstractServletWebServerFactory factory=getFactory();
  Compression compression=new Compression();
  compression.setEnabled(true);
  factory.setCompression(compression);
  this.webServer=factory.getWebServer(new ServletRegistrationBean<>(new ExampleServlet(false,true),"/hello"));
  this.webServer.start();
  TestGzipInputStreamFactory inputStreamFactory=new TestGzipInputStreamFactory();
  Map<String,InputStreamFactory> contentDecoderMap=Collections.singletonMap("gzip",(InputStreamFactory)inputStreamFactory);
  getResponse(getLocalUrl("/hello"),new HttpComponentsClientHttpRequestFactory(HttpClientBuilder.create().setContentDecoderRegistry(contentDecoderMap).build()));
  assertThat(inputStreamFactory.wasCompressionUsed()).isTrue();
}
