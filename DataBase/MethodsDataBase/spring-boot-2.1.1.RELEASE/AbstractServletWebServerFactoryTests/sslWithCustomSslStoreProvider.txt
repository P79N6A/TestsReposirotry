@Test public void sslWithCustomSslStoreProvider() throws Exception {
  AbstractServletWebServerFactory factory=getFactory();
  addTestTxtFile(factory);
  Ssl ssl=new Ssl();
  ssl.setClientAuth(ClientAuth.NEED);
  ssl.setKeyPassword("password");
  factory.setSsl(ssl);
  SslStoreProvider sslStoreProvider=mock(SslStoreProvider.class);
  given(sslStoreProvider.getKeyStore()).willReturn(loadStore());
  given(sslStoreProvider.getTrustStore()).willReturn(loadStore());
  factory.setSslStoreProvider(sslStoreProvider);
  this.webServer=factory.getWebServer();
  this.webServer.start();
  KeyStore keyStore=KeyStore.getInstance(KeyStore.getDefaultType());
  keyStore.load(new FileInputStream(new File("src/test/resources/test.jks")),"secret".toCharArray());
  SSLConnectionSocketFactory socketFactory=new SSLConnectionSocketFactory(new SSLContextBuilder().loadTrustMaterial(null,new TrustSelfSignedStrategy()).loadKeyMaterial(keyStore,"password".toCharArray()).build());
  HttpClient httpClient=HttpClients.custom().setSSLSocketFactory(socketFactory).build();
  HttpComponentsClientHttpRequestFactory requestFactory=new HttpComponentsClientHttpRequestFactory(httpClient);
  assertThat(getResponse(getLocalUrl("https","/test.txt"),requestFactory)).isEqualTo("test");
  verify(sslStoreProvider,atLeastOnce()).getKeyStore();
  verify(sslStoreProvider,atLeastOnce()).getTrustStore();
}
