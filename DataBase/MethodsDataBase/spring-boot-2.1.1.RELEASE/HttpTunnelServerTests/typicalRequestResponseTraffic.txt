@Test public void typicalRequestResponseTraffic() throws Exception {
  MockHttpConnection h1=new MockHttpConnection();
  this.server.handle(h1);
  MockHttpConnection h2=new MockHttpConnection("hello server",1);
  this.server.handle(h2);
  this.serverChannel.verifyReceived("hello server");
  this.serverChannel.send("hello client");
  h1.verifyReceived("hello client",1);
  MockHttpConnection h3=new MockHttpConnection("1+1",2);
  this.server.handle(h3);
  this.serverChannel.send("=2");
  h2.verifyReceived("=2",2);
  MockHttpConnection h4=new MockHttpConnection("1+2",3);
  this.server.handle(h4);
  this.serverChannel.send("=3");
  h3.verifyReceived("=3",3);
  this.serverChannel.disconnect();
  this.server.getServerThread().join();
}
