@Test public void httpConnectionsAreClosedAfterLongPollTimeout() throws Exception {
  this.server.setDisconnectTimeout(1000);
  this.server.setLongPollTimeout(100);
  MockHttpConnection h1=new MockHttpConnection();
  this.server.handle(h1);
  MockHttpConnection h2=new MockHttpConnection();
  this.server.handle(h2);
  Thread.sleep(400);
  this.serverChannel.disconnect();
  this.server.getServerThread().join();
  assertThat(h1.getServletResponse().getStatus()).isEqualTo(204);
  assertThat(h2.getServletResponse().getStatus()).isEqualTo(204);
}
