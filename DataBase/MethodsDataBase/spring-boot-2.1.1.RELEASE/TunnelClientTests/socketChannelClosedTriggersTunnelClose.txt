@Test public void socketChannelClosedTriggersTunnelClose() throws Exception {
  TunnelClient client=new TunnelClient(0,this.tunnelConnection);
  int port=client.start();
  SocketChannel channel=SocketChannel.open(new InetSocketAddress(port));
  Thread.sleep(200);
  channel.close();
  client.getServerThread().stopAcceptingConnections();
  client.getServerThread().join(2000);
  assertThat(this.tunnelConnection.getOpenedTimes()).isEqualTo(1);
  assertThat(this.tunnelConnection.isOpen()).isFalse();
}
