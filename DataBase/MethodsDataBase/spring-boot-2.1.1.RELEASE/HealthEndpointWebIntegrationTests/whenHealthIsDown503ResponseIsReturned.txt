@Test public void whenHealthIsDown503ResponseIsReturned(){
  HealthIndicatorRegistry registry=context.getBean(HealthIndicatorRegistry.class);
  registry.register("charlie",() -> Health.down().build());
  try {
    client.get().uri("/actuator/health").exchange().expectStatus().isEqualTo(HttpStatus.SERVICE_UNAVAILABLE).expectBody().jsonPath("status").isEqualTo("DOWN").jsonPath("details.alpha.status").isEqualTo("UP").jsonPath("details.bravo.status").isEqualTo("UP").jsonPath("details.charlie.status").isEqualTo("DOWN");
  }
  finally {
    registry.unregister("charlie");
  }
}
