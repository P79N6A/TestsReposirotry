@Test public void testRankDeficient(){
  Matrix A=rank4Matrix();
  CholeskyDecomposition cd=new CholeskyDecomposition(A);
  PivotedMatrix Ax=new PivotedMatrix(A,cd.getPivot());
  CholeskyDecomposition cd2=new CholeskyDecomposition(Ax,false);
  assertEquals(0,cd2.getL().times(cd2.getL().transpose()).minus(Ax).aggregate(Functions.PLUS,Functions.ABS),1.0e-10);
  assertEquals(0,cd.getL().times(cd.getL().transpose()).minus(A).aggregate(Functions.PLUS,Functions.ABS),1.0e-10);
  Assert.assertFalse(cd.isPositiveDefinite());
  Matrix L=cd.getL();
  Matrix Abar=L.times(L.transpose());
  double error=A.minus(Abar).aggregate(Functions.MAX,Functions.ABS);
  Assert.assertEquals(0,error,1.0e-10);
}
