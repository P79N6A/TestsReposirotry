/** 
 * Story: User can produce initial canopy centers using a ManhattanDistanceMeasure and a CanopyMapper which clusters input points to produce an output set of canopy centroid points.
 */
@Test public void testCanopyMapperManhattan() throws Exception {
  CanopyMapper mapper=new CanopyMapper();
  Configuration conf=getConfiguration();
  conf.set(CanopyConfigKeys.DISTANCE_MEASURE_KEY,manhattanDistanceMeasure.getClass().getName());
  conf.set(CanopyConfigKeys.T1_KEY,String.valueOf(3.1));
  conf.set(CanopyConfigKeys.T2_KEY,String.valueOf(2.1));
  conf.set(CanopyConfigKeys.CF_KEY,"0");
  DummyRecordWriter<Text,VectorWritable> writer=new DummyRecordWriter<>();
  Mapper<WritableComparable<?>,VectorWritable,Text,VectorWritable>.Context context=DummyRecordWriter.build(mapper,conf,writer);
  mapper.setup(context);
  List<VectorWritable> points=getPointsWritable();
  for (  VectorWritable point : points) {
    mapper.map(new Text(),point,context);
  }
  mapper.cleanup(context);
  assertEquals("Number of map results",1,writer.getData().size());
  List<VectorWritable> data=writer.getValue(new Text("centroid"));
  assertEquals("Number of centroids",3,data.size());
  for (int i=0; i < data.size(); i++) {
    assertEquals("Centroid error",manhattanCentroids.get(i).asFormatString(),data.get(i).get().asFormatString());
  }
}
