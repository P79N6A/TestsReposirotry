@Test public void testBoth() throws Exception {
  Map<String,String> immutableEnv=System.getenv();
  Class<?> unMap=Class.forName("java.util.Collections$UnmodifiableMap");
  Field m=unMap.getDeclaredField("m");
  m.setAccessible(true);
  @SuppressWarnings("unchecked") Map<String,String> env=(Map<String,String>)m.get(immutableEnv);
  try {
    env.put(AwsProfileNameLoader.AWS_PROFILE_ENVIRONMENT_VARIABLE,"test");
    System.setProperty(AwsProfileNameLoader.AWS_PROFILE_SYSTEM_PROPERTY,"bogus");
    ProfileCredentialsProvider provider=newProvider();
    AWSCredentials credentials=provider.getCredentials();
    Assert.assertEquals("test",credentials.getAWSAccessKeyId());
    Assert.assertEquals("test key",credentials.getAWSSecretKey());
  }
  finally {
    System.setProperty(AwsProfileNameLoader.AWS_PROFILE_SYSTEM_PROPERTY,"");
    env.remove(AwsProfileNameLoader.AWS_PROFILE_ENVIRONMENT_VARIABLE);
  }
}
