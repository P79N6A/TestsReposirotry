@Test public void testCredentialsSetInRequestContext() throws Exception {
  EasyMock.reset(httpClient);
  EasyMock.expect(httpClient.execute(EasyMock.<HttpRequestBase>anyObject(),EasyMock.<HttpContext>anyObject())).andReturn(createBasicHttpResponse()).once();
  EasyMock.replay(httpClient);
  AmazonHttpClient client=new AmazonHttpClient(new ClientConfiguration(),httpClient,null);
  final BasicAWSCredentials credentials=new BasicAWSCredentials("foo","bar");
  AWSCredentialsProvider credentialsProvider=EasyMock.createMock(AWSCredentialsProvider.class);
  EasyMock.expect(credentialsProvider.getCredentials()).andReturn(credentials).anyTimes();
  EasyMock.replay(credentialsProvider);
  ExecutionContext executionContext=new ExecutionContext();
  executionContext.setCredentialsProvider(credentialsProvider);
  Request<?> request=mockRequest(SERVER_NAME,HttpMethodName.PUT,URI_NAME,true);
  HttpResponseHandler<AmazonWebServiceResponse<Object>> handler=createStubResponseHandler();
  EasyMock.replay(handler);
  client.execute(request,handler,null,executionContext);
  assertEquals(credentials,request.getHandlerContext(HandlerContextKey.AWS_CREDENTIALS));
}
