@Test public void afterAttempt_AwsException_shouldSendApiCallAttemptEvent(){
  AmazonServiceException exception=new AmazonServiceException("test");
  exception.setStatusCode(400);
  exception.setErrorCode("BadRequest");
  Map<String,String> header=new HashMap<String,String>();
  header.put("x-amzn-RequestId","test");
  exception.setHttpHeaders(header);
  AWSRequestMetrics metrics=getMetrics(1);
  requestHandler.afterAttempt(getContext(metrics,exception));
  ArgumentCaptor<ApiCallAttemptMonitoringEvent> monitoringEventArgumentCaptor=ArgumentCaptor.forClass(ApiCallAttemptMonitoringEvent.class);
  verify(agentMonitoringListener,times(1)).handleEvent(monitoringEventArgumentCaptor.capture());
  verify(customMonitoringListener,times(1)).handleEvent(any(ApiCallAttemptMonitoringEvent.class));
  ApiCallAttemptMonitoringEvent event=monitoringEventArgumentCaptor.getValue();
  verifyRequiredEntries(event);
  verifyConditionalEntries(event,exception);
}
