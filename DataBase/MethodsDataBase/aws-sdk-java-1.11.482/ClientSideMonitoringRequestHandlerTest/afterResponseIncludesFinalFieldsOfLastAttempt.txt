@Test public void afterResponseIncludesFinalFieldsOfLastAttempt(){
  Request<?> request=getRequest();
  HandlerAfterAttemptContext failedAttempt=HandlerAfterAttemptContext.builder().withRequest(request).withResponse(getResponse(request)).withException(new AmazonServiceException("ErrorMessage")).build();
  HandlerAfterAttemptContext successfulAttempt=HandlerAfterAttemptContext.builder().withRequest(request).withResponse(getResponse(request)).build();
  requestHandler.afterAttempt(failedAttempt);
  requestHandler.afterAttempt(successfulAttempt);
  requestHandler.afterResponse(successfulAttempt.getRequest(),successfulAttempt.getResponse());
  verifyFinalFields(getCapturedEvent(ApiCallMonitoringEvent.class),getCapturedEvents(ApiCallAttemptMonitoringEvent.class,2).get(1));
}
