/** 
 * When readResource is called with custom retry policy and IOException occurs, the request is retried and the number of retries is equal to the value returned by getMaxRetries method of the custom retry policy.
 */
@Test @SuppressWarnings("unchecked") public void readResouceWithCustomRetryPolicy_DoesRetry_ForIoException() throws IOException {
  Mockito.when(mockConnection.connectToEndpoint(eq(endpoint),any(Map.class))).thenThrow(new IOException());
  try {
    new EC2CredentialsUtils(mockConnection).readResource(endpoint,customRetryPolicy,null);
    fail("Expected an IOexception");
  }
 catch (  IOException exception) {
    Mockito.verify(mockConnection,Mockito.times(CustomRetryPolicy.MAX_RETRIES + 1)).connectToEndpoint(eq(endpoint),any(Map.class));
  }
}
