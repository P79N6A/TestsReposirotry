/** 
 * A memory leak was introduced in 1.11 that prevented connection managers from being deregistered with the IdleConnectionReaper. This test asserts that any clients registered with the reaper are also deregistered on shutdown of the client.
 * @see <a href="https://github.com/aws/aws-sdk-java/issues/722">Issue #722</a>
 */
@Test public void connectionManagersAreUnregisteredFromIdleConnectionReaper(){
  IdleConnectionReaper.shutdown();
  for (int count=0; count < 100; count++) {
    new AmazonWebServiceClient(new ClientConfiguration()){
    }
.shutdown();
  }
  assertEquals(0,IdleConnectionReaper.getRegisteredConnectionManagers().size());
}
