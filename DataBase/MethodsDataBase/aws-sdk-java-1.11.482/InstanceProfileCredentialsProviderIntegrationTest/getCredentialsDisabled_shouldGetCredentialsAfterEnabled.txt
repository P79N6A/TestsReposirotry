@Test public void getCredentialsDisabled_shouldGetCredentialsAfterEnabled() throws Exception {
  InstanceProfileCredentialsProvider credentialsProvider=null;
  try {
    System.setProperty("com.amazonaws.sdk.disableEc2Metadata","true");
    credentialsProvider=new InstanceProfileCredentialsProvider();
    credentialsProvider.getCredentials();
    fail("exception not thrown when ec2Metadata disabled");
  }
 catch (  AmazonClientException ex) {
  }
 finally {
    System.clearProperty("com.amazonaws.sdk.disableEc2Metadata");
  }
  mockServer.setResponseFileName("sessionResponse");
  mockServer.setAvailableSecurityCredentials("test-credentials");
  assertNotNull(credentialsProvider.getCredentials());
}
