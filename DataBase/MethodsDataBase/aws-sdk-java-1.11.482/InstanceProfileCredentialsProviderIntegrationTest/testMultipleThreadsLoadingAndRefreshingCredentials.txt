/** 
 * Tests by initiating a refresh thread in parallel which refreshes the credentials. Next call to credentials provider will result in refreshing and getting new credentials.
 */
@Test public void testMultipleThreadsLoadingAndRefreshingCredentials() throws Exception {
  mockServer.setResponseFileName("sessionResponse");
  mockServer.setAvailableSecurityCredentials("test-credentials");
  InstanceProfileCredentialsProvider credentialsProvider=new InstanceProfileCredentialsProvider();
  AWSSessionCredentials credentials=(AWSSessionCredentials)credentialsProvider.getCredentials();
  assertNotNull(credentials);
  new RefreshThread(credentialsProvider).join();
  AWSSessionCredentials newCredentials=(AWSSessionCredentials)credentialsProvider.getCredentials();
  assertNotNull(newCredentials);
  assertNotSame(credentials,newCredentials);
}
