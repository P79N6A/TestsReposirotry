@Test(expected=AmazonClientException.class) public void canBeConfiguredToOnlyRefreshCredentialsAfterFirstCallToGetCredentials() throws InterruptedException {
  mockServer.setResponseFileName("sessionResponseExpired");
  mockServer.setAvailableSecurityCredentials("test-credentials");
  InstanceProfileCredentialsProvider credentialsProvider=InstanceProfileCredentialsProvider.createAsyncRefreshingProvider(false);
  Thread.sleep(1000);
  assertThat(loggedEvents(),is(empty()));
  credentialsProvider.getCredentials();
}
