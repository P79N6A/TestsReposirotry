@Test public void handlesErrorsUsingMagicField() throws Exception {
  IonStruct payload=createPayload();
  payload.add("__type",system.newString(ERROR_TYPE));
  HttpResponse error=createResponse(payload);
  AmazonServiceException exception=handleError(error);
  assertThat(exception,instanceOf(InvalidParameterException.class));
  assertEquals(ERROR_MESSAGE,exception.getErrorMessage());
}
