/** 
 * Tests that comments and unsupported properties are preserved after profile modification.
 * @throws URISyntaxException
 */
@Test public void testModifyAndInsertProfile_WithComments() throws IOException, URISyntaxException {
  File credWithComments=ProfileResourceLoader.profilesWithComments().asFile();
  File tmpFile=copyToTempFile(credWithComments);
  String originalContent=FileUtils.readFileToString(tmpFile);
  Profile[] expected={new Profile("a",basicCredA),new Profile("b",basicCredB),new Profile("c",sessionCredC),new Profile("d",sessionCredD)};
  Profile[] modified={new Profile("A",basicCredB),new Profile("B",basicCredA),new Profile("C",sessionCredD),new Profile("D",sessionCredC)};
  ProfilesConfigFileWriter.modifyProfiles(tmpFile,ImmutableMapParameter.of("a",modified[0],"b",modified[1],"c",modified[2],"d",modified[3]));
  checkCredentialsFile(tmpFile,modified);
  String modifiedContent=FileUtils.readFileToString(tmpFile);
  assertFalse(originalContent.equals(modifiedContent));
  ProfilesConfigFileWriter.modifyProfiles(tmpFile,ImmutableMapParameter.of("A",expected[0],"B",expected[1],"C",expected[2],"D",expected[3]));
  checkCredentialsFile(tmpFile,expected);
  String restoredContent=FileUtils.readFileToString(tmpFile);
  assertEquals(originalContent,restoredContent);
}
