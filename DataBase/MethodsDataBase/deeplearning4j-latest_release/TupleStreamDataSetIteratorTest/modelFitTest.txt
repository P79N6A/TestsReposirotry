@Test public void modelFitTest() throws Exception {
  final MultiLayerNetwork model=new MultiLayerNetwork(new NeuralNetConfiguration.Builder().list(new OutputLayer.Builder(LossFunction.MSE).nIn(3).nOut(1).weightInit(WeightInit.ONES).activation(Activation.IDENTITY).build()).build());
  model.init();
  int batch=1;
  for (int ii=1; ii <= 5; ++ii) {
    final CountingIterationListener listener=new CountingIterationListener();
    model.setListeners(listener);
    batch*=2;
    try (final TupleStreamDataSetIterator tsdsi=new TupleStreamDataSetIterator(batch,"id",new String[]{"channel_b_f","channel_g_f","channel_r_f"},new String[]{"luminance_f"},"search(mySolrCollection," + "q=\"id:*\"," + "fl=\"id,channel_b_f,channel_g_f,channel_r_f,luminance_f\","+ "sort=\"id asc\","+ "qt=\"/export\")",cluster.getZkClient().getZkServerAddress())){
      model.fit(tsdsi);
    }
     assertEquals("numIterationsDone=" + listener.numIterationsDone() + " numDocs="+ numDocs+ " batch="+ batch,(numDocs + (batch - 1)) / batch,listener.numIterationsDone());
  }
}
