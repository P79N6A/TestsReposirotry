@Test public void testSequenceRecordReader() throws Exception {
  SequenceRecordReader seqRR=new MapFileSequenceRecordReader();
  URI uri=seqMapFilePath.toUri();
  InputSplit is=new FileSplit(new File(uri));
  seqRR.initialize(is);
  Field f=MapFileSequenceRecordReader.class.getDeclaredField("indexToKey");
  f.setAccessible(true);
  IndexToKey itk=(IndexToKey)f.get(seqRR);
  assertEquals(seqMap.size(),itk.getNumRecords());
  List<Pair<Long,Long>> expReaderExampleIdxs=new ArrayList<>();
  expReaderExampleIdxs.add(new Pair<>(0L,2L));
  expReaderExampleIdxs.add(new Pair<>(-1L,-1L));
  expReaderExampleIdxs.add(new Pair<>(3L,5L));
  f=LongIndexToKey.class.getDeclaredField("readerIndices");
  f.setAccessible(true);
  assertEquals(expReaderExampleIdxs,f.get(itk));
  assertTrue(seqRR.hasNext());
  int count=0;
  while (seqRR.hasNext()) {
    List<List<org.datavec.api.writable.Writable>> l=seqRR.sequenceRecord();
    assertEquals(seqMap.get(new LongWritable(count)).getSequenceRecord(),l);
    count++;
  }
  assertFalse(seqRR.hasNext());
  assertEquals(seqMap.size(),count);
  seqRR.close();
  seqRR=new MapFileSequenceRecordReader(new Random(12345));
  seqRR.initialize(is);
  f=MapFileSequenceRecordReader.class.getDeclaredField("order");
  f.setAccessible(true);
  int[] order=(int[])f.get(seqRR);
  assertNotNull(order);
  int[] expOrder=new int[6];
  for (int i=0; i < expOrder.length; i++) {
    expOrder[i]=i;
  }
  MathUtils.shuffleArray(expOrder,new Random(12345));
  assertArrayEquals(expOrder,order);
  count=0;
  while (seqRR.hasNext()) {
    List<List<org.datavec.api.writable.Writable>> l=seqRR.sequenceRecord();
    assertEquals(seqMap.get(new LongWritable(expOrder[count])).getSequenceRecord(),l);
    count++;
  }
}
