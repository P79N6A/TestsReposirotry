/** 
 * This test checks for allocations within single workspace, without any spills
 * @throws Exception
 */
@Test public void endlessTest1() throws Exception {
  Nd4j.getWorkspaceManager().setDefaultWorkspaceConfiguration(WorkspaceConfiguration.builder().initialSize(100 * 1024L * 1024L).build());
  Nd4j.getMemoryManager().togglePeriodicGc(false);
  AtomicLong counter=new AtomicLong(0);
  while (true) {
    try (MemoryWorkspace workspace=Nd4j.getWorkspaceManager().getAndActivateWorkspace()){
      long time1=System.nanoTime();
      INDArray array=Nd4j.create(1024 * 1024);
      long time2=System.nanoTime();
      array.addi(1.0f);
      assertEquals(1.0f,array.meanNumber().floatValue(),0.1f);
      if (counter.incrementAndGet() % 1000 == 0)       log.info("{} iterations passed... Allocation time: {} ns",counter.get(),time2 - time1);
    }
   }
}
