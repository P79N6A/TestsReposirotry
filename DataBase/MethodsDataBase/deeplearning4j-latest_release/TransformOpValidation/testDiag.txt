@Test public void testDiag(){
  SameDiff sd=SameDiff.create();
  INDArray ia=Nd4j.create(new float[]{4,2},new int[]{2});
  SDVariable in=sd.var("in",new long[]{2});
  INDArray expOut=Nd4j.create(new int[]{2,2});
  DynamicCustomOp diag=DynamicCustomOp.builder("diag").addInputs(ia).addOutputs(expOut).build();
  Nd4j.getExecutioner().exec(diag);
  SDVariable t=sd.diag("diag",in);
  SDVariable loss=sd.standardDeviation("loss",t,false,0,1);
  sd.associateArrayWithVariable(ia,in);
  String err=OpValidation.validate(new TestCase(sd).expectedOutput("diag",expOut).gradientCheck(true));
  assertNull(err,err);
}
