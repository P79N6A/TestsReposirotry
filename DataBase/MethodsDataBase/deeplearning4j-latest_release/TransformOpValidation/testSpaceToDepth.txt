@Test public void testSpaceToDepth(){
  Nd4j.getRandom().setSeed(1337);
  int miniBatch=128;
  int blockSize=4;
  String dataFormat="NHWC";
  int isNHWC=dataFormat.equals("NHWC") ? 1 : 0;
  int[] inputShape=new int[]{miniBatch,2 * blockSize,2 * blockSize,1};
  INDArray input=Nd4j.randn(inputShape);
  SameDiff sd=SameDiff.create();
  SDVariable sdInput=sd.var("in",inputShape);
  INDArray expOut=Nd4j.create(miniBatch,2,2,blockSize * blockSize);
  DynamicCustomOp op=new SpaceToDepth(input,expOut,blockSize,dataFormat);
  Nd4j.getExecutioner().exec(op);
  sd.associateArrayWithVariable(input,sdInput);
  SDVariable t=sd.spaceToDepth("std",sdInput,blockSize,dataFormat);
  SDVariable loss=sd.mean("loss",t);
  String err=OpValidation.validate(new TestCase(sd).expectedOutput("std",expOut).gradientCheck(true));
  assertNull(err);
}
