@Test public void testLocalExecutionEarlyStopping() throws Exception {
  EarlyStoppingConfiguration<ComputationGraph> esConf=new EarlyStoppingConfiguration.Builder<ComputationGraph>().epochTerminationConditions(new MaxEpochsTerminationCondition(15)).scoreCalculator(new ScoreProvider()).modelSaver(new InMemoryModelSaver()).build();
  Map<String,Object> commands=new HashMap<>();
  commands.put(DataSetIteratorFactoryProvider.FACTORY_KEY,TestDataFactoryProviderMnist.class.getCanonicalName());
  ComputationGraphSpace cgs=new ComputationGraphSpace.Builder().optimizationAlgo(OptimizationAlgorithm.STOCHASTIC_GRADIENT_DESCENT).updater(new AdamSpace(new ContinuousParameterSpace(0.0001,0.1))).l2(new ContinuousParameterSpace(0.0001,0.01)).addInputs("in").setInputTypes(InputType.feedForward(784)).addLayer("first",new DenseLayerSpace.Builder().nIn(784).nOut(new IntegerParameterSpace(2,10)).activation(new DiscreteParameterSpace<>(Activation.RELU,Activation.TANH)).build(),"in").addLayer("out",new OutputLayerSpace.Builder().nOut(10).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build(),"first").setOutputs("out").earlyStoppingConfiguration(esConf).pretrain(false).backprop(true).build();
  CandidateGenerator candidateGenerator=new RandomSearchGenerator(cgs,commands);
  DataProvider dataProvider=new DataSetIteratorFactoryProvider();
  String modelSavePath=new File(System.getProperty("java.io.tmpdir"),"ArbiterDL4JTest2CG\\").getAbsolutePath();
  File f=new File(modelSavePath);
  if (f.exists())   f.delete();
  f.mkdir();
  f.deleteOnExit();
  if (!f.exists())   throw new RuntimeException();
  OptimizationConfiguration configuration=new OptimizationConfiguration.Builder().candidateGenerator(candidateGenerator).dataProvider(dataProvider).scoreFunction(ScoreFunctions.testSetF1()).modelSaver(new FileModelSaver(modelSavePath)).terminationConditions(new MaxTimeCondition(30,TimeUnit.SECONDS),new MaxCandidatesCondition(10)).build();
  IOptimizationRunner runner=new LocalOptimizationRunner(configuration,new ComputationGraphTaskCreator());
  runner.execute();
  assertEquals(0,runner.numCandidatesFailed());
  assertTrue(runner.numCandidatesCompleted() > 0);
}
