@Test public void testReadingFromStream() throws Exception {
  for (  boolean b : new boolean[]{false,true}) {
    int batchSize=1;
    int labelIndex=4;
    int numClasses=3;
    InputStream dataFile=new ClassPathResource("iris.txt").getInputStream();
    RecordReader recordReader=new CSVRecordReader(0,',');
    recordReader.initialize(new InputStreamInputSplit(dataFile));
    assertTrue(recordReader.hasNext());
    assertFalse(recordReader.resetSupported());
    DataSetIterator iterator;
    if (b) {
      iterator=new RecordReaderDataSetIterator.Builder(recordReader,batchSize).classification(labelIndex,numClasses).build();
    }
 else {
      iterator=new RecordReaderDataSetIterator(recordReader,batchSize,labelIndex,numClasses);
    }
    assertFalse(iterator.resetSupported());
    int count=0;
    while (iterator.hasNext()) {
      assertNotNull(iterator.next());
      count++;
    }
    assertEquals(150,count);
    try {
      iterator.reset();
      fail("Expected exception");
    }
 catch (    Exception e) {
    }
  }
}
