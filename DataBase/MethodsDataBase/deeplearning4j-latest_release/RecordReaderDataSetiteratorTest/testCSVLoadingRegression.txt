@Test public void testCSVLoadingRegression() throws Exception {
  int nLines=30;
  int nFeatures=5;
  int miniBatchSize=10;
  int labelIdx=0;
  String path="rr_csv_test_rand.csv";
  Pair<double[][],File> p=makeRandomCSV(path,nLines,nFeatures);
  double[][] data=p.getFirst();
  RecordReader testReader=new CSVRecordReader();
  testReader.initialize(new FileSplit(p.getSecond()));
  DataSetIterator iter=new RecordReaderDataSetIterator(testReader,miniBatchSize,labelIdx,labelIdx,true);
  int miniBatch=0;
  while (iter.hasNext()) {
    DataSet test=iter.next();
    INDArray features=test.getFeatures();
    INDArray labels=test.getLabels();
    assertArrayEquals(new long[]{miniBatchSize,nFeatures},features.shape());
    assertArrayEquals(new long[]{miniBatchSize,1},labels.shape());
    int startRow=miniBatch * miniBatchSize;
    for (int i=0; i < miniBatchSize; i++) {
      double labelExp=data[startRow + i][labelIdx];
      double labelAct=labels.getDouble(i);
      assertEquals(labelExp,labelAct,1e-5f);
      int featureCount=0;
      for (int j=0; j < nFeatures + 1; j++) {
        if (j == labelIdx)         continue;
        double featureExp=data[startRow + i][j];
        double featureAct=features.getDouble(i,featureCount++);
        assertEquals(featureExp,featureAct,1e-5f);
      }
    }
    miniBatch++;
  }
  assertEquals(nLines / miniBatchSize,miniBatch);
}
