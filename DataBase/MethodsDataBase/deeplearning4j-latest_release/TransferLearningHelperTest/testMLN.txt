@Test public void testMLN(){
  DataSet randomData=new DataSet(Nd4j.rand(10,4),Nd4j.rand(10,3));
  NeuralNetConfiguration.Builder overallConf=new NeuralNetConfiguration.Builder().updater(new Sgd(0.1)).optimizationAlgo(OptimizationAlgorithm.STOCHASTIC_GRADIENT_DESCENT).activation(Activation.IDENTITY);
  MultiLayerNetwork modelToFineTune=new MultiLayerNetwork(overallConf.clone().list().layer(0,new DenseLayer.Builder().nIn(4).nOut(3).build()).layer(1,new DenseLayer.Builder().nIn(3).nOut(2).build()).layer(2,new DenseLayer.Builder().nIn(2).nOut(3).build()).layer(3,new org.deeplearning4j.nn.conf.layers.OutputLayer.Builder(LossFunctions.LossFunction.MCXENT).activation(Activation.SOFTMAX).nIn(3).nOut(3).build()).build());
  modelToFineTune.init();
  MultiLayerNetwork modelNow=new TransferLearning.Builder(modelToFineTune).setFeatureExtractor(1).build();
  List<INDArray> ff=modelToFineTune.feedForwardToLayer(2,randomData.getFeatures(),false);
  INDArray asFrozenFeatures=ff.get(2);
  TransferLearningHelper helper=new TransferLearningHelper(modelToFineTune,1);
  INDArray paramsLastTwoLayers=Nd4j.hstack(modelToFineTune.getLayer(2).params(),modelToFineTune.getLayer(3).params());
  MultiLayerNetwork notFrozen=new MultiLayerNetwork(overallConf.clone().list().layer(0,new DenseLayer.Builder().nIn(2).nOut(3).build()).layer(1,new org.deeplearning4j.nn.conf.layers.OutputLayer.Builder(LossFunctions.LossFunction.MCXENT).activation(Activation.SOFTMAX).nIn(3).nOut(3).build()).build(),paramsLastTwoLayers);
  assertEquals(asFrozenFeatures,helper.featurize(randomData).getFeatures());
  assertEquals(randomData.getLabels(),helper.featurize(randomData).getLabels());
  for (int i=0; i < 5; i++) {
    notFrozen.fit(new DataSet(asFrozenFeatures,randomData.getLabels()));
    helper.fitFeaturized(helper.featurize(randomData));
    modelNow.fit(randomData);
  }
  INDArray expected=Nd4j.hstack(modelToFineTune.getLayer(0).params(),modelToFineTune.getLayer(1).params(),notFrozen.params());
  INDArray act=modelNow.params();
  assertEquals(expected,act);
}
