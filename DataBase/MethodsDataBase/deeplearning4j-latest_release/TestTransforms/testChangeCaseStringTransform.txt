@Test public void testChangeCaseStringTransform() throws Exception {
  final String STRING_COLUMN="StringColumn";
  final List<String> ALL_COLUMNS=Arrays.asList(STRING_COLUMN,"OtherColumn");
  final String TEXT_MIXED_CASE="UPPER lower MiXeD";
  final String TEXT_UPPER_CASE=TEXT_MIXED_CASE.toUpperCase();
  final String TEXT_LOWER_CASE=TEXT_MIXED_CASE.toLowerCase();
  Transform transform=new ChangeCaseStringTransform(STRING_COLUMN);
  String[] allColumns=ALL_COLUMNS.toArray(new String[ALL_COLUMNS.size()]);
  Schema schema=new Schema.Builder().addColumnsString(allColumns).build();
  transform.setInputSchema(schema);
  Schema newSchema=transform.transform(schema);
  List<String> outputColumns=new ArrayList<>(ALL_COLUMNS);
  Assert.assertEquals(outputColumns,newSchema.getColumnNames());
  transform=new ChangeCaseStringTransform(STRING_COLUMN,ChangeCaseStringTransform.CaseType.LOWER);
  transform.setInputSchema(schema);
  List<Writable> input=new ArrayList<>();
  input.add(new Text(TEXT_MIXED_CASE));
  input.add(new Text(TEXT_MIXED_CASE));
  List<Writable> output=new ArrayList<>();
  output.add(new Text(TEXT_LOWER_CASE));
  output.add(new Text(TEXT_MIXED_CASE));
  List<Writable> transformed=transform.map(input);
  Assert.assertEquals(transformed.get(0).toString(),TEXT_LOWER_CASE);
  Assert.assertEquals(transformed,output);
  transform=new ChangeCaseStringTransform(STRING_COLUMN,ChangeCaseStringTransform.CaseType.UPPER);
  transform.setInputSchema(schema);
  output.clear();
  output.add(new Text(TEXT_UPPER_CASE));
  output.add(new Text(TEXT_MIXED_CASE));
  transformed=transform.map(input);
  Assert.assertEquals(transformed.get(0).toString(),TEXT_UPPER_CASE);
  Assert.assertEquals(transformed,output);
  String s=JsonMappers.getMapper().writeValueAsString(transform);
  Transform transform2=JsonMappers.getMapper().readValue(s,ChangeCaseStringTransform.class);
  Assert.assertEquals(transform,transform2);
}
