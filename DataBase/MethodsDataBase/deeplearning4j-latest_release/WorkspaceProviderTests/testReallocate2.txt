@Test public void testReallocate2() throws Exception {
  MemoryWorkspace workspace=Nd4j.getWorkspaceManager().getWorkspaceForCurrentThread(reallocateDelayedConfiguration,"WS_1");
  for (int i=1; i <= 10; i++) {
    try (MemoryWorkspace ws=Nd4j.getWorkspaceManager().getAndActivateWorkspace(reallocateDelayedConfiguration,"WS_1")){
      INDArray array=Nd4j.create(100 * i);
    }
     if (i >= 3)     assertEquals("Failed on iteration " + i,100 * i * Nd4j.sizeOfDataType(),workspace.getCurrentSize());
 else     assertEquals(0,workspace.getCurrentSize());
  }
}
