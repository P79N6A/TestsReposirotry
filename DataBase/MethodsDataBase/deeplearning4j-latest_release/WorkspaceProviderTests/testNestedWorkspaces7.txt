@Test public void testNestedWorkspaces7() throws Exception {
  try (Nd4jWorkspace wsExternal=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getAndActivateWorkspace(basicConfiguration,"External")){
    INDArray array1=Nd4j.create(10);
    INDArray array2=null;
    INDArray array3=null;
    INDArray array4=null;
    INDArray array5=null;
    try (Nd4jWorkspace wsFeedForward=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getAndActivateWorkspace(basicConfiguration,"FeedForward")){
      array2=Nd4j.create(10);
      assertEquals(true,array2.isAttached());
      try (Nd4jWorkspace borrowed=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getWorkspaceForCurrentThread("External").notifyScopeBorrowed()){
        array3=Nd4j.create(10);
        assertTrue(wsExternal == array3.data().getParentWorkspace());
        try (MemoryWorkspace ws=Nd4j.getMemoryManager().scopeOutOfWorkspaces()){
          array4=Nd4j.create(10);
        }
         array5=Nd4j.create(10);
        log.info("Workspace5: {}",array5.data().getParentWorkspace());
        assertTrue(null == array4.data().getParentWorkspace());
        assertFalse(array4.isAttached());
        assertTrue(wsExternal == array5.data().getParentWorkspace());
      }
       assertEquals(true,array3.isAttached());
      assertEquals(false,array4.isAttached());
      assertEquals(true,array5.isAttached());
    }
   }
 }
