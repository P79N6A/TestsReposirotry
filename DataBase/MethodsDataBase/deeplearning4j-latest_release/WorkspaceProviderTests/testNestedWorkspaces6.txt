@Test public void testNestedWorkspaces6() throws Exception {
  try (Nd4jWorkspace wsExternal=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getAndActivateWorkspace(firstConfiguration,"External")){
    INDArray array1=Nd4j.create(10);
    INDArray array2=null;
    INDArray array3=null;
    INDArray array4=null;
    try (Nd4jWorkspace wsFeedForward=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getAndActivateWorkspace(firstConfiguration,"FeedForward")){
      array2=Nd4j.create(10);
      assertEquals(true,array2.isAttached());
      try (Nd4jWorkspace borrowed=(Nd4jWorkspace)Nd4j.getWorkspaceManager().getWorkspaceForCurrentThread("External").notifyScopeBorrowed()){
        array3=Nd4j.create(10);
        assertTrue(wsExternal == array3.data().getParentWorkspace());
      }
       assertEquals(true,array3.isAttached());
      try (MemoryWorkspace ws=Nd4j.getMemoryManager().scopeOutOfWorkspaces()){
        array4=Nd4j.create(10);
      }
       assertEquals(false,array4.isAttached());
    }
     assertEquals(0,wsExternal.getCurrentSize());
    log.info("------");
  }
 }
