@Test public void testGravesLSTM() throws Exception {
  File f=new ClassPathResource("regression_testing/100a/GravesLSTMCharModelingExample_100a.bin").getTempFileFromArchive();
  MultiLayerNetwork net=MultiLayerNetwork.load(f,true);
  GravesLSTM l0=(GravesLSTM)net.getLayer(0).conf().getLayer();
  assertEquals(new ActivationTanH(),l0.getActivationFn());
  assertEquals(200,l0.getNOut());
  assertEquals(WeightInit.XAVIER,l0.getWeightInit());
  assertEquals(0.001,l0.getL2(),1e-6);
  assertEquals(new RmsProp(0.1),l0.getIUpdater());
  GravesLSTM l1=(GravesLSTM)net.getLayer(1).conf().getLayer();
  assertEquals(new ActivationTanH(),l1.getActivationFn());
  assertEquals(200,l1.getNOut());
  assertEquals(WeightInit.XAVIER,l1.getWeightInit());
  assertEquals(0.001,l1.getL2(),1e-6);
  assertEquals(new RmsProp(0.1),l1.getIUpdater());
  RnnOutputLayer l2=(RnnOutputLayer)net.getLayer(2).conf().getLayer();
  assertEquals(new ActivationSoftmax(),l2.getActivationFn());
  assertEquals(77,l2.getNOut());
  assertEquals(WeightInit.XAVIER,l2.getWeightInit());
  assertEquals(0.001,l0.getL2(),1e-6);
  assertEquals(new RmsProp(0.1),l0.getIUpdater());
  assertEquals(BackpropType.TruncatedBPTT,net.getLayerWiseConfigurations().getBackpropType());
  assertEquals(50,net.getLayerWiseConfigurations().getTbpttBackLength());
  assertEquals(50,net.getLayerWiseConfigurations().getTbpttFwdLength());
  INDArray outExp;
  File f2=new ClassPathResource("regression_testing/100a/GravesLSTMCharModelingExample_Output_100a.bin").getTempFileFromArchive();
  try (DataInputStream dis=new DataInputStream(new FileInputStream(f2))){
    outExp=Nd4j.read(dis);
  }
   INDArray in;
  File f3=new ClassPathResource("regression_testing/100a/GravesLSTMCharModelingExample_Input_100a.bin").getTempFileFromArchive();
  try (DataInputStream dis=new DataInputStream(new FileInputStream(f3))){
    in=Nd4j.read(dis);
  }
   INDArray outAct=net.output(in);
  assertEquals(outExp,outAct);
  assertTrue(net.getLayerWiseConfigurations().isLegacyBatchScaledL2());
  assertTrue(l2.isLegacyBatchScaledL2());
}
