@Test public void testVae() throws Exception {
  File f=new ClassPathResource("regression_testing/100a/VaeMNISTAnomaly_100a.bin").getTempFileFromArchive();
  MultiLayerNetwork net=MultiLayerNetwork.load(f,true);
  VariationalAutoencoder l0=(VariationalAutoencoder)net.getLayer(0).conf().getLayer();
  assertEquals(new ActivationLReLU(),l0.getActivationFn());
  assertEquals(32,l0.getNOut());
  assertArrayEquals(new int[]{256,256},l0.getEncoderLayerSizes());
  assertArrayEquals(new int[]{256,256},l0.getDecoderLayerSizes());
  assertEquals(WeightInit.XAVIER,l0.getWeightInit());
  assertEquals(1e-4,l0.getL2(),1e-6);
  assertEquals(new Adam(0.05),l0.getIUpdater());
  INDArray outExp;
  File f2=new ClassPathResource("regression_testing/100a/VaeMNISTAnomaly_Output_100a.bin").getTempFileFromArchive();
  try (DataInputStream dis=new DataInputStream(new FileInputStream(f2))){
    outExp=Nd4j.read(dis);
  }
   INDArray in;
  File f3=new ClassPathResource("regression_testing/100a/VaeMNISTAnomaly_Input_100a.bin").getTempFileFromArchive();
  try (DataInputStream dis=new DataInputStream(new FileInputStream(f3))){
    in=Nd4j.read(dis);
  }
   INDArray outAct=net.output(in);
  assertEquals(outExp,outAct);
}
