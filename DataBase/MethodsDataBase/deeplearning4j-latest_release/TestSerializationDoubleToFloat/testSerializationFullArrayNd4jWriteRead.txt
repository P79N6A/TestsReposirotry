@Test public void testSerializationFullArrayNd4jWriteRead() throws Exception {
  int length=100;
  Nd4j.create(1);
  val initialType=Nd4j.dataType();
  Nd4j.setDataType(DataBuffer.Type.DOUBLE);
  INDArray arr=Nd4j.linspace(1,length,length).reshape('c',10,10);
  arr.subi(50.0123456);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  try (DataOutputStream dos=new DataOutputStream(baos)){
    Nd4j.write(arr,dos);
  }
   byte[] bytes=baos.toByteArray();
  DataTypeUtil.setDTypeForContext(DataBuffer.Type.FLOAT);
  System.out.println("The data opType is " + Nd4j.dataType());
  INDArray arr1=Nd4j.linspace(1,length,length).reshape('c',10,10);
  arr1.subi(50.0123456);
  INDArray arr2;
  try (DataInputStream dis=new DataInputStream(new ByteArrayInputStream(bytes))){
    arr2=Nd4j.read(dis);
  }
   assertTrue(Transforms.abs(arr1.sub(arr2).div(arr1)).maxNumber().doubleValue() < 0.01);
}
