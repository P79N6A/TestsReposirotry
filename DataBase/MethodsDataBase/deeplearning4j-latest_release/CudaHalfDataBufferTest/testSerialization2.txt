@Test public void testSerialization2() throws Exception {
  DataBuffer bufferOriginal=new CudaFloatDataBuffer(new float[]{1f,2f,3f,4f,5f});
  DataBuffer bufferHalfs=Nd4j.getNDArrayFactory().convertDataEx(DataBuffer.TypeEx.FLOAT,bufferOriginal,DataBuffer.TypeEx.FLOAT16);
  DataTypeUtil.setDTypeForContext(DataBuffer.Type.HALF);
  File tempFile=File.createTempFile("alpha","11");
  tempFile.deleteOnExit();
  try (DataOutputStream dos=new DataOutputStream(Files.newOutputStream(Paths.get(tempFile.getAbsolutePath())))){
    bufferHalfs.write(dos);
  }
   DataInputStream dis=new DataInputStream(new FileInputStream(tempFile.getAbsoluteFile()));
  DataBuffer bufferRestored=Nd4j.createBuffer(bufferOriginal.length());
  bufferRestored.read(dis);
  assertEquals(bufferRestored.dataType(),DataBuffer.Type.HALF);
  DataTypeUtil.setDTypeForContext(DataBuffer.Type.FLOAT);
  DataBuffer bufferConverted=Nd4j.getNDArrayFactory().convertDataEx(DataBuffer.TypeEx.FLOAT16,bufferRestored,DataBuffer.TypeEx.FLOAT);
  assertArrayEquals(bufferOriginal.asFloat(),bufferConverted.asFloat(),0.01f);
}
