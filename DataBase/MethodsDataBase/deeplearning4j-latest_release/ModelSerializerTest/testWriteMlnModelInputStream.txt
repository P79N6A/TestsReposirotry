@Test public void testWriteMlnModelInputStream() throws Exception {
  int nIn=5;
  int nOut=6;
  MultiLayerConfiguration conf=new NeuralNetConfiguration.Builder().seed(12345).l1(0.01).l2(0.01).updater(new Sgd(0.1)).activation(Activation.TANH).weightInit(WeightInit.XAVIER).list().layer(0,new DenseLayer.Builder().nIn(nIn).nOut(20).build()).layer(1,new DenseLayer.Builder().nIn(20).nOut(30).build()).layer(2,new OutputLayer.Builder().lossFunction(LossFunctions.LossFunction.MSE).nIn(30).nOut(nOut).build()).build();
  MultiLayerNetwork net=new MultiLayerNetwork(conf);
  net.init();
  File tempFile=tempDir.newFile();
  FileOutputStream fos=new FileOutputStream(tempFile);
  ModelSerializer.writeModel(net,fos,true);
  NormalizerMinMaxScaler scaler=new NormalizerMinMaxScaler();
  DataSetIterator iter=new IrisDataSetIterator(150,150);
  scaler.fit(iter);
  ModelSerializer.addNormalizerToModel(tempFile,scaler);
  NormalizerMinMaxScaler restoredScaler=ModelSerializer.restoreNormalizerFromFile(tempFile);
  assertNotEquals(null,scaler.getMax());
  assertEquals(scaler.getMax(),restoredScaler.getMax());
  assertEquals(scaler.getMin(),restoredScaler.getMin());
  FileInputStream fis=new FileInputStream(tempFile);
  MultiLayerNetwork network=ModelSerializer.restoreMultiLayerNetwork(fis);
  assertEquals(network.getLayerWiseConfigurations().toJson(),net.getLayerWiseConfigurations().toJson());
  assertEquals(net.params(),network.params());
  assertEquals(net.getUpdater().getStateViewArray(),network.getUpdater().getStateViewArray());
}
