@Test public void testCheckpointListenerEveryTimeUnit() throws Exception {
  File f=tempDir.newFolder();
  Pair<MultiLayerNetwork,DataSetIterator> p=getNetAndData();
  MultiLayerNetwork net=p.getFirst();
  DataSetIterator iter=p.getSecond();
  CheckpointListener l=new CheckpointListener.Builder(f).keepLast(3).saveEvery(3,TimeUnit.SECONDS).build();
  net.setListeners(l);
  for (int i=0; i < 5; i++) {
    net.fit(iter);
    Thread.sleep(4000);
  }
  File[] files=f.listFiles();
  Set<Integer> ns=new HashSet<>();
  for (  File f2 : files) {
    if (!f2.getPath().endsWith(".zip")) {
      continue;
    }
    int prefixLength="checkpoint_".length();
    int num=Integer.parseInt(f2.getName().substring(prefixLength,prefixLength + 1));
    MultiLayerNetwork n=ModelSerializer.restoreMultiLayerNetwork(f2,true);
    int expIter=2 * (num + 1);
    assertEquals(expIter,n.getIterationCount());
    ns.add(n.getIterationCount());
  }
  assertEquals(3,l.availableCheckpoints().size());
  assertEquals(ns.toString(),3,ns.size());
  assertTrue(ns.containsAll(Arrays.asList(4,6,8)));
}
