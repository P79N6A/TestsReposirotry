@Test public void testCheckpointListenerEvery2Epochs() throws Exception {
  File f=tempDir.newFolder();
  Pair<MultiLayerNetwork,DataSetIterator> p=getNetAndData();
  MultiLayerNetwork net=p.getFirst();
  DataSetIterator iter=p.getSecond();
  CheckpointListener l=new CheckpointListener.Builder(f).keepAll().saveEveryNEpochs(2).build();
  net.setListeners(l);
  for (int i=0; i < 10; i++) {
    net.fit(iter);
    if (i > 0 && i % 2 == 0) {
      assertEquals(1 + i / 2,f.list().length);
    }
  }
  File[] files=f.listFiles();
  int count=0;
  for (  File f2 : files) {
    if (!f2.getPath().endsWith(".zip")) {
      continue;
    }
    int prefixLength="checkpoint_".length();
    int num=Integer.parseInt(f2.getName().substring(prefixLength,prefixLength + 1));
    MultiLayerNetwork n=ModelSerializer.restoreMultiLayerNetwork(f2,true);
    int expEpoch=2 * (num + 1) - 1;
    int expIter=(expEpoch + 1) * 2;
    assertEquals(expEpoch,n.getEpochCount());
    assertEquals(expIter,n.getIterationCount());
    count++;
  }
  assertEquals(5,count);
  assertEquals(5,l.availableCheckpoints().size());
}
