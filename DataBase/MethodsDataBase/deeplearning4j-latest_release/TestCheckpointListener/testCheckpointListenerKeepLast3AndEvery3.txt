@Test public void testCheckpointListenerKeepLast3AndEvery3() throws Exception {
  File f=tempDir.newFolder();
  Pair<MultiLayerNetwork,DataSetIterator> p=getNetAndData();
  MultiLayerNetwork net=p.getFirst();
  DataSetIterator iter=p.getSecond();
  CheckpointListener l=new CheckpointListener.Builder(f).keepLastAndEvery(3,3).saveEveryNEpochs(2).build();
  net.setListeners(l);
  for (int i=0; i < 20; i++) {
    net.fit(iter);
  }
  File[] files=f.listFiles();
  int count=0;
  Set<Integer> ns=new HashSet<>();
  for (  File f2 : files) {
    if (!f2.getPath().endsWith(".zip")) {
      continue;
    }
    count++;
    int prefixLength="checkpoint_".length();
    int end=f2.getName().lastIndexOf("_");
    int num=Integer.parseInt(f2.getName().substring(prefixLength,end));
    MultiLayerNetwork n=ModelSerializer.restoreMultiLayerNetwork(f2,true);
    int expEpoch=2 * (num + 1) - 1;
    assertEquals(expEpoch,n.getEpochCount());
    ns.add(n.getEpochCount());
    count++;
  }
  assertEquals(ns.toString(),5,ns.size());
  assertTrue(ns.toString(),ns.containsAll(Arrays.asList(5,11,15,17,19)));
  assertEquals(5,l.availableCheckpoints().size());
}
