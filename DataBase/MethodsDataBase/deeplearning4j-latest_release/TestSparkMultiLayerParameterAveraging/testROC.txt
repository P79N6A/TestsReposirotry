@Test public void testROC(){
  int nArrays=100;
  int minibatch=64;
  int steps=20;
  int nIn=5;
  int nOut=2;
  int layerSize=10;
  MultiLayerConfiguration conf=new NeuralNetConfiguration.Builder().weightInit(WeightInit.XAVIER).list().layer(0,new DenseLayer.Builder().nIn(nIn).nOut(layerSize).build()).layer(1,new OutputLayer.Builder().nIn(layerSize).nOut(nOut).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build()).build();
  MultiLayerNetwork net=new MultiLayerNetwork(conf);
  net.init();
  Nd4j.getRandom().setSeed(12345);
  Random r=new Random(12345);
  ROC local=new ROC(steps);
  List<DataSet> dsList=new ArrayList<>();
  for (int i=0; i < nArrays; i++) {
    INDArray features=Nd4j.rand(minibatch,nIn);
    INDArray p=net.output(features);
    INDArray l=Nd4j.zeros(minibatch,2);
    for (int j=0; j < minibatch; j++) {
      l.putScalar(j,r.nextInt(2),1.0);
    }
    local.eval(l,p);
    dsList.add(new DataSet(features,l));
  }
  SparkDl4jMultiLayer sparkNet=new SparkDl4jMultiLayer(sc,net,null);
  JavaRDD<DataSet> rdd=sc.parallelize(dsList);
  ROC sparkROC=sparkNet.evaluateROC(rdd,steps,32);
  assertEquals(sparkROC.calculateAUC(),sparkROC.calculateAUC(),1e-6);
  assertEquals(local.getRocCurve(),sparkROC.getRocCurve());
}
