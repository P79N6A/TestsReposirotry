@Test public void testDropoutLayerWithDenseMnist() throws Exception {
  DataSetIterator iter=new MnistDataSetIterator(2,2);
  DataSet next=iter.next();
  MultiLayerConfiguration confIntegrated=new NeuralNetConfiguration.Builder().optimizationAlgo(OptimizationAlgorithm.STOCHASTIC_GRADIENT_DESCENT).seed(123).list().layer(0,new DenseLayer.Builder().nIn(28 * 28 * 1).nOut(10).activation(Activation.RELU).weightInit(WeightInit.XAVIER).build()).layer(1,new OutputLayer.Builder(LossFunctions.LossFunction.MCXENT).weightInit(WeightInit.XAVIER).activation(Activation.SOFTMAX).dropOut(0.25).nIn(10).nOut(10).build()).build();
  MultiLayerNetwork netIntegrated=new MultiLayerNetwork(confIntegrated);
  netIntegrated.init();
  netIntegrated.fit(next);
  MultiLayerConfiguration confSeparate=new NeuralNetConfiguration.Builder().optimizationAlgo(OptimizationAlgorithm.STOCHASTIC_GRADIENT_DESCENT).seed(123).list().layer(0,new DenseLayer.Builder().nIn(28 * 28 * 1).nOut(10).activation(Activation.RELU).weightInit(WeightInit.XAVIER).build()).layer(1,new DropoutLayer.Builder(0.25).build()).layer(2,new OutputLayer.Builder(LossFunctions.LossFunction.MCXENT).weightInit(WeightInit.XAVIER).activation(Activation.SOFTMAX).nIn(10).nOut(10).build()).build();
  MultiLayerNetwork netSeparate=new MultiLayerNetwork(confSeparate);
  netSeparate.init();
  netSeparate.fit(next);
  for (  Layer l : netIntegrated.getLayers()) {
    l.allowInputModification(false);
  }
  for (  Layer l : netSeparate.getLayers()) {
    l.allowInputModification(false);
  }
  assertEquals(netIntegrated.getLayer(0).getParam("W"),netSeparate.getLayer(0).getParam("W"));
  assertEquals(netIntegrated.getLayer(0).getParam("b"),netSeparate.getLayer(0).getParam("b"));
  assertEquals(netIntegrated.getLayer(1).getParam("W"),netSeparate.getLayer(2).getParam("W"));
  assertEquals(netIntegrated.getLayer(1).getParam("b"),netSeparate.getLayer(2).getParam("b"));
  netIntegrated.setInput(next.getFeatures());
  netSeparate.setInput(next.getFeatures());
  Nd4j.getRandom().setSeed(12345);
  List<INDArray> actTrainIntegrated=netIntegrated.feedForward(true);
  Nd4j.getRandom().setSeed(12345);
  List<INDArray> actTrainSeparate=netSeparate.feedForward(true);
  assertEquals(actTrainIntegrated.get(1),actTrainSeparate.get(1));
  assertEquals(actTrainIntegrated.get(2),actTrainSeparate.get(3));
  Nd4j.getRandom().setSeed(12345);
  List<INDArray> actTestIntegrated=netIntegrated.feedForward(false);
  Nd4j.getRandom().setSeed(12345);
  List<INDArray> actTestSeparate=netSeparate.feedForward(false);
  assertEquals(actTestIntegrated.get(1),actTrainSeparate.get(1));
  assertEquals(actTestIntegrated.get(2),actTestSeparate.get(3));
}
