@Test public void checkMaskArrayClearance(){
  for (  boolean tbptt : new boolean[]{true,false}) {
    ComputationGraphConfiguration conf=new NeuralNetConfiguration.Builder().seed(12345).graphBuilder().addInputs("in").addLayer("out",new RnnOutputLayer.Builder(LossFunctions.LossFunction.MSE).activation(Activation.IDENTITY).nIn(1).nOut(1).build(),"in").setOutputs("out").backpropType(tbptt ? BackpropType.TruncatedBPTT : BackpropType.Standard).tBPTTForwardLength(8).tBPTTBackwardLength(8).build();
    ComputationGraph net=new ComputationGraph(conf);
    net.init();
    MultiDataSet data=new MultiDataSet(new INDArray[]{Nd4j.linspace(1,10,10).reshape(1,1,10)},new INDArray[]{Nd4j.linspace(2,20,10).reshape(1,1,10)},new INDArray[]{Nd4j.ones(10)},new INDArray[]{Nd4j.ones(10)});
    net.fit(data);
    assertNull(net.getInputMaskArrays());
    assertNull(net.getLabelMaskArrays());
    for (    Layer l : net.getLayers()) {
      assertNull(l.getMaskArray());
    }
    DataSet ds=new DataSet(data.getFeatures(0),data.getLabels(0),data.getFeaturesMaskArray(0),data.getLabelsMaskArray(0));
    net.fit(ds);
    assertNull(net.getInputMaskArrays());
    assertNull(net.getLabelMaskArrays());
    for (    Layer l : net.getLayers()) {
      assertNull(l.getMaskArray());
    }
    net.fit(data.getFeatures(),data.getLabels(),data.getFeaturesMaskArrays(),data.getLabelsMaskArrays());
    assertNull(net.getInputMaskArrays());
    assertNull(net.getLabelMaskArrays());
    for (    Layer l : net.getLayers()) {
      assertNull(l.getMaskArray());
    }
    MultiDataSetIterator iter=new IteratorMultiDataSetIterator(Collections.singletonList((org.nd4j.linalg.dataset.api.MultiDataSet)data).iterator(),1);
    net.fit(iter);
    assertNull(net.getInputMaskArrays());
    assertNull(net.getLabelMaskArrays());
    for (    Layer l : net.getLayers()) {
      assertNull(l.getMaskArray());
    }
    DataSetIterator iter2=new IteratorDataSetIterator(Collections.singletonList(ds).iterator(),1);
    net.fit(iter2);
    assertNull(net.getInputMaskArrays());
    assertNull(net.getLabelMaskArrays());
    for (    Layer l : net.getLayers()) {
      assertNull(l.getMaskArray());
    }
  }
}
