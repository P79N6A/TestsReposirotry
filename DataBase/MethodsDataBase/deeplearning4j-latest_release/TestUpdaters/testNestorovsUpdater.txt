@Test public void testNestorovsUpdater(){
  double lr=1e-2;
  double mu=0.6;
  NeuralNetConfiguration conf=new NeuralNetConfiguration.Builder().updater(new Nesterovs(lr,mu)).layer(new DenseLayer.Builder().nIn(nIn).nOut(nOut).build()).build();
  long numParams=conf.getLayer().initializer().numParams(conf);
  INDArray params=Nd4j.create(1,numParams);
  BaseLayer layer=(BaseLayer)conf.getLayer().instantiate(conf,null,0,params,true);
  layer.setBackpropGradientsViewArray(gradients);
  Updater updater=UpdaterCreator.getUpdater(layer);
  int updaterStateSize=(int)layer.layerConf().getIUpdater().stateSize(numParams);
  INDArray updaterState=Nd4j.create(1,updaterStateSize);
  updater.setStateViewArray(layer,updaterState,true);
  Gradient gradientCopyPreUpdate=new DefaultGradient();
  INDArray g=gradients.dup();
  INDArray wg=g.get(point(0),interval(0,nIn * nOut));
  INDArray bg=g.get(point(0),interval(nIn * nOut,nIn * nOut + nOut));
  gradientCopyPreUpdate.setGradientFor(DefaultParamInitializer.WEIGHT_KEY,wg);
  gradientCopyPreUpdate.setGradientFor(DefaultParamInitializer.BIAS_KEY,bg);
  updater.update(layer,gradient,-1,0,1,LayerWorkspaceMgr.noWorkspaces());
  int count=0;
  for (  Map.Entry<String,INDArray> entry : gradientCopyPreUpdate.gradientForVariable().entrySet()) {
    INDArray val=entry.getValue();
    INDArray v=Nd4j.create(val.shape());
    INDArray vPrev=v.dup();
    v=v.mul(mu).subi(val.mul(lr));
    gradExpected=vPrev.muli(mu).addi(v.mul(-mu - 1));
    assertEquals(gradExpected,gradient.getGradientFor(entry.getKey()));
    count++;
  }
  assertEquals(mu,((Nesterovs)layer.layerConf().getIUpdater()).getMomentum(),1e-4);
  assertEquals(2,count);
}
