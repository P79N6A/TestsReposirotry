@Test public void testNetworkLoader() throws Exception {
  DatasetFacade df=DatasetFacade.dataRows(sqlContext.read().json("src/test/resources/dl4jnetwork"));
  Pipeline p=new Pipeline().setStages(new PipelineStage[]{getAssembler(new String[]{"x","y"},"features")});
  DatasetFacade part2=DatasetFacade.dataRows(p.fit(df.get()).transform(df.get()).select("features","label"));
  ParamSerializer ps=new ParamHelper();
  MultiLayerConfiguration mc=getNNConfiguration();
  Collection<TrainingListener> il=new ArrayList<>();
  il.add(new ScoreIterationListener(1));
  SparkDl4jNetwork sparkDl4jNetwork=new SparkDl4jNetwork(mc,2,ps,1,il,true).setFeaturesCol("features").setLabelCol("label");
  String fileName=UUID.randomUUID().toString();
  SparkDl4jModel sm=sparkDl4jNetwork.fit(part2.get());
  sm.write().overwrite().save(fileName);
  SparkDl4jModel spdm=SparkDl4jModel.load(fileName);
  Assert.assertNotNull(spdm);
  File file1=new File(fileName);
  File file2=new File(fileName + "_metadata");
  FileUtils.deleteDirectory(file1);
  FileUtils.deleteDirectory(file2);
}
