@Test public void testCnnSentenceDataSetIteratorNoTokensEdgeCase() throws Exception {
  WordVectors w2v=WordVectorSerializer.readWord2VecModel(new ClassPathResource("word2vec/googleload/sample_vec.bin").getFile());
  int vectorSize=w2v.lookupTable().layerSize();
  List<String> sentences=new ArrayList<>();
  sentences.add("NOVALID WORDSHERE");
  sentences.add("!!!");
  sentences.add("these balance Database model");
  sentences.add("into same THISWORDDOESNTEXIST are");
  int maxLength=4;
  List<String> s1=Arrays.asList("these","balance","Database","model");
  List<String> s2=Arrays.asList("into","same","are");
  List<String> labelsForSentences=Arrays.asList("Positive","Negative","Positive","Negative");
  INDArray expLabels=Nd4j.create(new double[][]{{0,1},{1,0}});
  LabeledSentenceProvider p=new CollectionLabeledSentenceProvider(sentences,labelsForSentences,null);
  CnnSentenceDataSetIterator dsi=new CnnSentenceDataSetIterator.Builder(CnnSentenceDataSetIterator.Format.CNN2D).sentenceProvider(p).wordVectors(w2v).useNormalizedWordVectors(true).maxSentenceLength(256).minibatchSize(32).sentencesAlongHeight(false).build();
  DataSet ds=dsi.next();
  INDArray expectedFeatures=Nd4j.create(2,1,vectorSize,maxLength);
  INDArray expectedFeatureMask=Nd4j.create(new double[][]{{1,1,1,1},{1,1,1,0}}).reshape('c',2,1,1,4);
  for (int i=0; i < 4; i++) {
    expectedFeatures.get(NDArrayIndex.point(0),NDArrayIndex.point(0),NDArrayIndex.all(),NDArrayIndex.point(i)).assign(w2v.getWordVectorMatrixNormalized(s1.get(i)));
  }
  for (int i=0; i < 3; i++) {
    expectedFeatures.get(NDArrayIndex.point(1),NDArrayIndex.point(0),NDArrayIndex.all(),NDArrayIndex.point(i)).assign(w2v.getWordVectorMatrixNormalized(s2.get(i)));
  }
  assertArrayEquals(expectedFeatures.shape(),ds.getFeatures().shape());
  assertEquals(expectedFeatures,ds.getFeatures());
  assertEquals(expLabels,ds.getLabels());
  assertEquals(expectedFeatureMask,ds.getFeaturesMaskArray());
  assertNull(ds.getLabelsMaskArray());
}
