@Test public void testProbabilisticPipelineTransform() throws Exception {
  ImageWritable writable=makeRandomImage(0,0,3);
  Frame frame=writable.getFrame();
  ImageTransform randCrop=new RandomCropTransform(frame.imageHeight / 2,frame.imageWidth / 2);
  ImageTransform flip=new FlipImageTransform();
  List<Pair<ImageTransform,Double>> pipeline=new LinkedList<>();
  pipeline.add(new Pair<>(randCrop,1.0));
  pipeline.add(new Pair<>(flip,0.5));
  ImageTransform transform=new PipelineImageTransform(pipeline,true);
  for (int i=0; i < 100; i++) {
    ImageWritable w=transform.transform(writable);
    Frame f=w.getFrame();
    assertTrue(f.imageHeight == frame.imageHeight / 2);
    assertTrue(f.imageWidth == frame.imageWidth / 2);
    assertEquals(f.imageChannels,frame.imageChannels);
  }
  assertEquals(null,transform.transform(null));
  transform=new PipelineImageTransform(new EqualizeHistTransform());
  writable=transform.transform(writable);
  float[] transformed=transform.query(new float[]{88,99});
  assertEquals(88,transformed[0],0);
  assertEquals(99,transformed[1],0);
}
