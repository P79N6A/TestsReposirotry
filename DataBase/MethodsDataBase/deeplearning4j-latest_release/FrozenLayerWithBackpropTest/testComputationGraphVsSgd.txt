@Test public void testComputationGraphVsSgd(){
  DataSet randomData=new DataSet(Nd4j.rand(100,4,12345),Nd4j.rand(100,1,12345));
  String frozenBranchName="B1-";
  String unfrozenBranchName="B2-";
  String initialLayer="initial";
  String frozenBranchUnfrozenLayer0=frozenBranchName + "0";
  String frozenBranchFrozenLayer1=frozenBranchName + "1";
  String frozenBranchFrozenLayer2=frozenBranchName + "2";
  String frozenBranchOutput=frozenBranchName + "Output";
  String unfrozenLayer0=unfrozenBranchName + "0";
  String unfrozenLayer1=unfrozenBranchName + "1";
  String unfrozenBranch2=unfrozenBranchName + "Output";
  ComputationGraphConfiguration computationGraphConf=new NeuralNetConfiguration.Builder().updater(new Sgd(2.0)).seed(12345).graphBuilder().addInputs("input").addLayer(initialLayer,new DenseLayer.Builder().nIn(4).nOut(4).build(),"input").addLayer(frozenBranchUnfrozenLayer0,new DenseLayer.Builder().nIn(4).nOut(3).build(),initialLayer).addLayer(frozenBranchFrozenLayer1,new org.deeplearning4j.nn.conf.layers.misc.FrozenLayerWithBackprop(new DenseLayer.Builder().nIn(3).nOut(4).build()),frozenBranchUnfrozenLayer0).addLayer(frozenBranchFrozenLayer2,new org.deeplearning4j.nn.conf.layers.misc.FrozenLayerWithBackprop(new DenseLayer.Builder().nIn(4).nOut(2).build()),frozenBranchFrozenLayer1).addLayer(unfrozenLayer0,new DenseLayer.Builder().nIn(4).nOut(4).build(),initialLayer).addLayer(unfrozenLayer1,new DenseLayer.Builder().nIn(4).nOut(2).build(),unfrozenLayer0).addLayer(unfrozenBranch2,new DenseLayer.Builder().nIn(2).nOut(1).build(),unfrozenLayer1).addVertex("merge",new MergeVertex(),frozenBranchFrozenLayer2,unfrozenBranch2).addLayer(frozenBranchOutput,new org.deeplearning4j.nn.conf.layers.misc.FrozenLayerWithBackprop(new OutputLayer.Builder(LossFunctions.LossFunction.MSE).activation(Activation.TANH).nIn(3).nOut(1).build()),"merge").setOutputs(frozenBranchOutput).build();
  ComputationGraphConfiguration computationSgdGraphConf=new NeuralNetConfiguration.Builder().updater(new Sgd(2.0)).seed(12345).graphBuilder().addInputs("input").addLayer(initialLayer,new DenseLayer.Builder().nIn(4).nOut(4).build(),"input").addLayer(frozenBranchUnfrozenLayer0,new DenseLayer.Builder().nIn(4).nOut(3).build(),initialLayer).addLayer(frozenBranchFrozenLayer1,new DenseLayer.Builder().updater(new Sgd(0.0)).biasUpdater(new Sgd(0.0)).nIn(3).nOut(4).build(),frozenBranchUnfrozenLayer0).addLayer(frozenBranchFrozenLayer2,new DenseLayer.Builder().updater(new Sgd(0.0)).biasUpdater(new Sgd(0.0)).nIn(4).nOut(2).build(),frozenBranchFrozenLayer1).addLayer(unfrozenLayer0,new DenseLayer.Builder().nIn(4).nOut(4).build(),initialLayer).addLayer(unfrozenLayer1,new DenseLayer.Builder().nIn(4).nOut(2).build(),unfrozenLayer0).addLayer(unfrozenBranch2,new DenseLayer.Builder().nIn(2).nOut(1).build(),unfrozenLayer1).addVertex("merge",new MergeVertex(),frozenBranchFrozenLayer2,unfrozenBranch2).addLayer(frozenBranchOutput,new OutputLayer.Builder(LossFunctions.LossFunction.MSE).updater(new Sgd(0.0)).biasUpdater(new Sgd(0.0)).activation(Activation.TANH).nIn(3).nOut(1).build(),"merge").setOutputs(frozenBranchOutput).build();
  ComputationGraph frozenComputationGraph=new ComputationGraph(computationGraphConf);
  frozenComputationGraph.init();
  INDArray unfrozenLayerParams=frozenComputationGraph.getLayer(frozenBranchUnfrozenLayer0).params().dup();
  INDArray frozenLayerParams1=frozenComputationGraph.getLayer(frozenBranchFrozenLayer1).params().dup();
  INDArray frozenLayerParams2=frozenComputationGraph.getLayer(frozenBranchFrozenLayer2).params().dup();
  INDArray frozenOutputLayerParams=frozenComputationGraph.getLayer(frozenBranchOutput).params().dup();
  ComputationGraph sgdComputationGraph=new ComputationGraph(computationSgdGraphConf);
  sgdComputationGraph.init();
  INDArray unfrozenSgdLayerParams=sgdComputationGraph.getLayer(frozenBranchUnfrozenLayer0).params().dup();
  INDArray frozenSgdLayerParams1=sgdComputationGraph.getLayer(frozenBranchFrozenLayer1).params().dup();
  INDArray frozenSgdLayerParams2=sgdComputationGraph.getLayer(frozenBranchFrozenLayer2).params().dup();
  INDArray frozenSgdOutputLayerParams=sgdComputationGraph.getLayer(frozenBranchOutput).params().dup();
  for (int i=0; i < 100; i++) {
    frozenComputationGraph.fit(randomData);
  }
  for (int i=0; i < 100; i++) {
    sgdComputationGraph.fit(randomData);
  }
  assertEquals(frozenComputationGraph.getLayer(frozenBranchUnfrozenLayer0).params(),sgdComputationGraph.getLayer(frozenBranchUnfrozenLayer0).params());
  assertEquals(frozenComputationGraph.getLayer(frozenBranchFrozenLayer1).params(),sgdComputationGraph.getLayer(frozenBranchFrozenLayer1).params());
  assertEquals(frozenComputationGraph.getLayer(frozenBranchFrozenLayer2).params(),sgdComputationGraph.getLayer(frozenBranchFrozenLayer2).params());
  assertEquals(frozenComputationGraph.getLayer(frozenBranchOutput).params(),sgdComputationGraph.getLayer(frozenBranchOutput).params());
}
