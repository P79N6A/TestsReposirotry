@Test(timeout=30000L) public void testParallelInferenceVariableLengthTS() throws Exception {
  Nd4j.getRandom().setSeed(12345);
  int nIn=10;
  int[] tsLengths={3,5,7,10,50,100};
  MultiLayerConfiguration conf=new NeuralNetConfiguration.Builder().activation(Activation.TANH).seed(12345).list().layer(new LSTM.Builder().nIn(nIn).nOut(5).build()).layer(new RnnOutputLayer.Builder().nIn(5).nOut(5).activation(Activation.SOFTMAX).build()).build();
  MultiLayerNetwork net=new MultiLayerNetwork(conf);
  net.init();
  for (  InferenceMode m : InferenceMode.values()) {
    for (    int w : new int[]{1,2}) {
      final ParallelInference inf=new ParallelInference.Builder(net).inferenceMode(m).batchLimit(20).queueLimit(64).workers(w).build();
      List<INDArray> arrs=new ArrayList<>();
      List<INDArray> exp=new ArrayList<>();
      for (      int l : tsLengths) {
        INDArray in=Nd4j.rand(new int[]{1,nIn,l});
        arrs.add(in);
        INDArray out=net.output(in);
        exp.add(out);
      }
      testParallelInference(inf,arrs,exp);
      inf.shutdown();
    }
  }
}
