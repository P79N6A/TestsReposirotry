@Test public void testSaveWriteWithTrainingConfig() throws Exception {
  SameDiff sameDiff=SameDiff.create();
  INDArray arr=Transforms.sigmoid(Nd4j.linspace(1,4,4));
  SDVariable x=sameDiff.var("x",arr);
  SDVariable result=sameDiff.sum(x,1);
  TrainingConfig trainingConfig=TrainingConfig.builder().dataSetFeatureMapping("x").dataSetLabelMapping(result.getVarName()).updater(new Nesterovs()).build();
  sameDiff.setTrainingConfig(trainingConfig);
  sameDiff.initializeTraining();
  File newFile=folder.newFile();
  try (BufferedOutputStream bufferedOutputStream=new BufferedOutputStream(new FileOutputStream(newFile))){
    sameDiff.saveWithTrainingConfig(bufferedOutputStream);
  }
   SameDiff sameDiff1=SameDiff.restoreFromTrainingConfigZip(newFile);
  assertEquals(sameDiff.getTrainingConfig().getUpdater(),sameDiff1.getTrainingConfig().getUpdater());
  assertEquals(sameDiff.getUpdaterState(),sameDiff1.getUpdaterState());
  sameDiff.saveWithTrainingConfig(newFile);
  sameDiff1=SameDiff.restoreFromTrainingConfigZip(newFile);
  assertEquals(sameDiff.getTrainingConfig().getUpdater(),sameDiff1.getTrainingConfig().getUpdater());
  assertEquals(sameDiff.getUpdaterState(),sameDiff1.getUpdaterState());
}
