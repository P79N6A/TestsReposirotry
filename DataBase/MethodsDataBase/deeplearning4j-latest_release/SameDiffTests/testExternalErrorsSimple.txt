@Test public void testExternalErrorsSimple(){
  INDArray externalGrad=Nd4j.linspace(1,12,12).reshape(3,4);
  SameDiff sd=SameDiff.create();
  SDVariable var=sd.var("var",externalGrad);
  SDVariable out=var.mul("out",0.5);
  Map<String,INDArray> gradMap=new HashMap<>();
  gradMap.put("out",externalGrad);
  ExternalErrorsFunction fn=sd.f().externalErrors(out);
  fn.updateVariable("out",externalGrad);
  sd.execAndEndResult();
  sd.execBackwards();
  INDArray gradOut=out.getGradient().getArr();
  INDArray gradVar=var.getGradient().getArr();
  assertEquals(externalGrad,gradOut);
  assertEquals(externalGrad.mul(0.5),gradVar);
  externalGrad=Nd4j.linspace(1,12,12).reshape(3,4).muli(10);
  fn.updateVariable("out",externalGrad);
  sd.execBackwards();
  gradOut=out.getGradient().getArr();
  gradVar=var.getGradient().getArr();
  assertEquals(externalGrad,gradOut);
  assertEquals(externalGrad.mul(0.5),gradVar);
}
