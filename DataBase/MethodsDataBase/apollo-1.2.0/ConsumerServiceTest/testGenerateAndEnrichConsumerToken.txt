@Test public void testGenerateAndEnrichConsumerToken() throws Exception {
  String someConsumerAppId="someAppId";
  long someConsumerId=1;
  String someToken="someToken";
  Date generationTime=new Date();
  Consumer consumer=mock(Consumer.class);
  when(consumerRepository.findById(someConsumerId)).thenReturn(Optional.of(consumer));
  when(consumer.getAppId()).thenReturn(someConsumerAppId);
  when(consumerService.generateToken(someConsumerAppId,generationTime,someTokenSalt)).thenReturn(someToken);
  ConsumerToken consumerToken=new ConsumerToken();
  consumerToken.setConsumerId(someConsumerId);
  consumerToken.setDataChangeCreatedTime(generationTime);
  consumerService.generateAndEnrichToken(consumer,consumerToken);
  assertEquals(someToken,consumerToken.getToken());
}
