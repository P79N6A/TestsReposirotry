@Test public void testLoadFromRepositoryFailedAndThenRecovered(){
  String someKey="someKey";
  String someValue="someValue";
  String someDefaultValue="someDefaultValue";
  ConfigSourceType someSourceType=ConfigSourceType.REMOTE;
  when(configRepository.getConfig()).thenThrow(mock(RuntimeException.class));
  DefaultConfig defaultConfig=new DefaultConfig(someNamespace,configRepository);
  verify(configRepository,times(1)).addChangeListener(defaultConfig);
  assertEquals(ConfigSourceType.NONE,defaultConfig.getSourceType());
  assertEquals(someDefaultValue,defaultConfig.getProperty(someKey,someDefaultValue));
  someProperties=new Properties();
  someProperties.setProperty(someKey,someValue);
  when(configRepository.getSourceType()).thenReturn(someSourceType);
  defaultConfig.onRepositoryChange(someNamespace,someProperties);
  assertEquals(someSourceType,defaultConfig.getSourceType());
  assertEquals(someValue,defaultConfig.getProperty(someKey,someDefaultValue));
}
