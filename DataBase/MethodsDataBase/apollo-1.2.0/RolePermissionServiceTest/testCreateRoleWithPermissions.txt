@Test @Sql(scripts="/sql/permission/insert-test-permissions.sql",executionPhase=Sql.ExecutionPhase.BEFORE_TEST_METHOD) @Sql(scripts="/sql/cleanup.sql",executionPhase=Sql.ExecutionPhase.AFTER_TEST_METHOD) public void testCreateRoleWithPermissions() throws Exception {
  String someRoleName="someRoleName";
  Role role=assembleRole(someRoleName);
  Set<Long> permissionIds=Sets.newHashSet(990L,991L);
  Role created=rolePermissionService.createRoleWithPermissions(role,permissionIds);
  Role createdFromDB=roleRepository.findById(created.getId()).orElse(null);
  List<RolePermission> rolePermissions=rolePermissionRepository.findByRoleIdIn(Sets.newHashSet(createdFromDB.getId()));
  Set<Long> rolePermissionIds=FluentIterable.from(rolePermissions).transform(RolePermission::getPermissionId).toSet();
  assertEquals(someRoleName,createdFromDB.getRoleName());
  assertEquals(2,rolePermissionIds.size());
  assertTrue(rolePermissionIds.containsAll(permissionIds));
}
