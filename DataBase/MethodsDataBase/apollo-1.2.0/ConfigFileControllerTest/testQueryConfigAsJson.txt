@Test public void testQueryConfigAsJson() throws Exception {
  String someKey="someKey";
  String someValue="someValue";
  Gson gson=new Gson();
  Type responseType=new TypeToken<Map<String,String>>(){
  }
.getType();
  String someWatchKey="someWatchKey";
  Set<String> watchKeys=Sets.newHashSet(someWatchKey);
  Map<String,String> configurations=ImmutableMap.of(someKey,someValue);
  ApolloConfig someApolloConfig=mock(ApolloConfig.class);
  when(configController.queryConfig(someAppId,someClusterName,someNamespace,someDataCenter,"-1",someClientIp,null,someRequest,someResponse)).thenReturn(someApolloConfig);
  when(someApolloConfig.getConfigurations()).thenReturn(configurations);
  when(watchKeysUtil.assembleAllWatchKeys(someAppId,someClusterName,someNamespace,someDataCenter)).thenReturn(watchKeys);
  ResponseEntity<String> response=configFileController.queryConfigAsJson(someAppId,someClusterName,someNamespace,someDataCenter,someClientIp,someRequest,someResponse);
  assertEquals(HttpStatus.OK,response.getStatusCode());
  assertEquals(configurations,gson.fromJson(response.getBody(),responseType));
}
