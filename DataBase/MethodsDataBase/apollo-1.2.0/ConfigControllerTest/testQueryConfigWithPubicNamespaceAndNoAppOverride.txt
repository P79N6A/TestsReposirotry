@Test public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
  String someClientSideReleaseKey="1";
  String someServerSideReleaseKey="2";
  HttpServletResponse someResponse=mock(HttpServletResponse.class);
  String somePublicAppId="somePublicAppId";
  String somePublicClusterName="somePublicClusterName";
  AppNamespace somePublicAppNamespace=assemblePublicAppNamespace(somePublicAppId,somePublicNamespaceName);
  when(configService.loadConfig(someAppId,someClientIp,someAppId,someClusterName,somePublicNamespaceName,someDataCenter,someNotificationMessages)).thenReturn(null);
  when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName)).thenReturn(somePublicAppNamespace);
  when(configService.loadConfig(someAppId,someClientIp,somePublicAppId,someClusterName,somePublicNamespaceName,someDataCenter,someNotificationMessages)).thenReturn(somePublicRelease);
  when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
  when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
  when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
  when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
  ApolloConfig result=configController.queryConfig(someAppId,someClusterName,somePublicNamespaceName,someDataCenter,someClientSideReleaseKey,someClientIp,someMessagesAsString,someRequest,someResponse);
  assertEquals(someServerSideReleaseKey,result.getReleaseKey());
  assertEquals(someAppId,result.getAppId());
  assertEquals(someClusterName,result.getCluster());
  assertEquals(somePublicNamespaceName,result.getNamespaceName());
  assertEquals("foo",result.getConfigurations().get("apollo.public.bar"));
  verify(instanceConfigAuditUtil,times(1)).audit(someAppId,someClusterName,someDataCenter,someClientIp,somePublicAppId,somePublicClusterName,somePublicNamespaceName,someServerSideReleaseKey);
}
