@Test public void testOnRepositoryChange() throws Exception {
  Properties someProperties=new Properties();
  String key=ConfigConsts.CONFIG_FILE_CONTENT_KEY;
  String someValue="someValue";
  String anotherValue="anotherValue";
  someProperties.setProperty(key,someValue);
  when(configRepository.getConfig()).thenReturn(someProperties);
  XmlConfigFile configFile=new XmlConfigFile(someNamespace,configRepository);
  assertEquals(someValue,configFile.getContent());
  Properties anotherProperties=new Properties();
  anotherProperties.setProperty(key,anotherValue);
  final SettableFuture<ConfigFileChangeEvent> configFileChangeFuture=SettableFuture.create();
  ConfigFileChangeListener someListener=new ConfigFileChangeListener(){
    @Override public void onChange(    ConfigFileChangeEvent changeEvent){
      configFileChangeFuture.set(changeEvent);
    }
  }
;
  configFile.addChangeListener(someListener);
  configFile.onRepositoryChange(someNamespace,anotherProperties);
  ConfigFileChangeEvent changeEvent=configFileChangeFuture.get(500,TimeUnit.MILLISECONDS);
  assertEquals(anotherValue,configFile.getContent());
  assertEquals(someNamespace,changeEvent.getNamespace());
  assertEquals(someValue,changeEvent.getOldValue());
  assertEquals(anotherValue,changeEvent.getNewValue());
  assertEquals(PropertyChangeType.MODIFIED,changeEvent.getChangeType());
}
