@Test public void testAutoUpdateWithNewProperties() throws Exception {
  int initialTimeout=1000;
  int newTimeout=1001;
  int newBatch=2001;
  Properties applicationProperties=assembleProperties(TIMEOUT_PROPERTY,String.valueOf(initialTimeout));
  SimpleConfig applicationConfig=prepareConfig(ConfigConsts.NAMESPACE_APPLICATION,applicationProperties);
  AnnotationConfigApplicationContext context=new AnnotationConfigApplicationContext(AppConfig1.class);
  TestJavaConfigBean bean=context.getBean(TestJavaConfigBean.class);
  assertEquals(initialTimeout,bean.getTimeout());
  assertEquals(DEFAULT_BATCH,bean.getBatch());
  Properties newApplicationProperties=assembleProperties(TIMEOUT_PROPERTY,String.valueOf(newTimeout),BATCH_PROPERTY,String.valueOf(newBatch));
  applicationConfig.onRepositoryChange(ConfigConsts.NAMESPACE_APPLICATION,newApplicationProperties);
  TimeUnit.MILLISECONDS.sleep(100);
  assertEquals(newTimeout,bean.getTimeout());
  assertEquals(newBatch,bean.getBatch());
}
