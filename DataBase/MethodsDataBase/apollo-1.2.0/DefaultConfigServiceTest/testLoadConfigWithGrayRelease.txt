@Test public void testLoadConfigWithGrayRelease() throws Exception {
  Release grayRelease=mock(Release.class);
  long grayReleaseId=999;
  when(grayReleaseRulesHolder.findReleaseIdFromGrayReleaseRule(someClientAppId,someClientIp,someConfigAppId,someClusterName,defaultNamespaceName)).thenReturn(grayReleaseId);
  when(releaseService.findActiveOne(grayReleaseId)).thenReturn(grayRelease);
  when(releaseService.findLatestActiveRelease(someConfigAppId,someClusterName,defaultNamespaceName)).thenReturn(someRelease);
  Release release=configService.loadConfig(someClientAppId,someClientIp,someConfigAppId,someClusterName,defaultNamespaceName,someDataCenter,someNotificationMessages);
  verify(releaseService,times(1)).findActiveOne(grayReleaseId);
  verify(releaseService,never()).findLatestActiveRelease(someConfigAppId,someClusterName,defaultNamespaceName);
  assertEquals(grayRelease,release);
}
