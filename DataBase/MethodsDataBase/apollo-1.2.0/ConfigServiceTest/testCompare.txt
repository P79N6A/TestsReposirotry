@Test public void testCompare(){
  ItemDTO sourceItem1=new ItemDTO("a","b","comment",1);
  ItemDTO sourceItem2=new ItemDTO("newKey","c","comment",2);
  ItemDTO sourceItem3=new ItemDTO("c","newValue","comment",3);
  ItemDTO sourceItem4=new ItemDTO("d","b","newComment",4);
  List<ItemDTO> sourceItems=Arrays.asList(sourceItem1,sourceItem2,sourceItem3,sourceItem4);
  ItemDTO targetItem1=new ItemDTO("a","b","comment",1);
  ItemDTO targetItem2=new ItemDTO("c","oldValue","comment",2);
  ItemDTO targetItem3=new ItemDTO("d","b","oldComment",3);
  List<ItemDTO> targetItems=Arrays.asList(targetItem1,targetItem2,targetItem3);
  String appId="6666", env="LOCAL", clusterName=ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName=ConfigConsts.NAMESPACE_APPLICATION;
  List<NamespaceIdentifier> namespaceIdentifiers=generateNamespaceIdentifier(appId,env,clusterName,namespaceName);
  NamespaceDTO namespaceDTO=generateNamespaceDTO(appId,clusterName,namespaceName);
  when(namespaceAPI.loadNamespace(appId,Env.valueOf(env),clusterName,namespaceName)).thenReturn(namespaceDTO);
  when(itemAPI.findItems(appId,Env.valueOf(env),clusterName,namespaceName)).thenReturn(targetItems);
  UserInfo userInfo=new UserInfo();
  userInfo.setUserId("test");
  when(userInfoHolder.getUser()).thenReturn(userInfo);
  List<ItemDiffs> itemDiffses=configService.compare(namespaceIdentifiers,sourceItems);
  assertEquals(1,itemDiffses.size());
  ItemDiffs itemDiffs=itemDiffses.get(0);
  ItemChangeSets changeSets=itemDiffs.getDiffs();
  assertEquals(0,changeSets.getDeleteItems().size());
  assertEquals(2,changeSets.getUpdateItems().size());
  assertEquals(1,changeSets.getCreateItems().size());
  NamespaceIdentifier namespaceIdentifier=itemDiffs.getNamespace();
  assertEquals(appId,namespaceIdentifier.getAppId());
  assertEquals(Env.valueOf("LOCAL"),namespaceIdentifier.getEnv());
  assertEquals(clusterName,namespaceIdentifier.getClusterName());
  assertEquals(namespaceName,namespaceIdentifier.getNamespaceName());
  ItemDTO createdItem=changeSets.getCreateItems().get(0);
  assertEquals("newKey",createdItem.getKey());
  assertEquals("c",createdItem.getValue());
  assertEquals("comment",createdItem.getComment());
  assertEquals(4,createdItem.getLineNum());
  List<ItemDTO> updateItems=changeSets.getUpdateItems();
  ItemDTO updateItem1=updateItems.get(0);
  ItemDTO updateItem2=updateItems.get(1);
  assertEquals("c",updateItem1.getKey());
  assertEquals("newValue",updateItem1.getValue());
  assertEquals("comment",updateItem1.getComment());
  assertEquals(2,updateItem1.getLineNum());
  assertEquals("d",updateItem2.getKey());
  assertEquals("b",updateItem2.getValue());
  assertEquals("newComment",updateItem2.getComment());
  assertEquals(3,updateItem2.getLineNum());
}
