@Test public void shouldSendLargeTextFile() throws IOException {
  prepareResponse(response -> {
  }
);
  Resource resource=new ClassPathResource("largeTextFile.txt",getClass());
  byte[] expected=Files.readAllBytes(resource.getFile().toPath());
  Flux<DataBuffer> body=DataBufferUtils.read(resource,new DefaultDataBufferFactory(),4096);
  this.webClient.post().uri("/").body(body,DataBuffer.class).retrieve().bodyToMono(Void.class).block(Duration.ofSeconds(5));
  expectRequest(request -> {
    ByteArrayOutputStream actual=new ByteArrayOutputStream();
    try {
      request.getBody().copyTo(actual);
    }
 catch (    IOException ex) {
      throw new IllegalStateException(ex);
    }
    assertEquals(expected.length,actual.size());
    assertEquals(hash(expected),hash(actual.toByteArray()));
  }
);
}
