@Test public void readAndWriteAsynchronousFileChannel() throws Exception {
  Path source=Paths.get(DataBufferUtilsTests.class.getResource("DataBufferUtilsTests.txt").toURI());
  Flux<DataBuffer> sourceFlux=DataBufferUtils.readAsynchronousFileChannel(() -> AsynchronousFileChannel.open(source,StandardOpenOption.READ),this.bufferFactory,3);
  Path destination=Files.createTempFile("DataBufferUtilsTests",null);
  AsynchronousFileChannel channel=AsynchronousFileChannel.open(destination,StandardOpenOption.WRITE);
  CountDownLatch latch=new CountDownLatch(1);
  DataBufferUtils.write(sourceFlux,channel).subscribe(DataBufferUtils::release,throwable -> fail(throwable.getMessage()),() -> {
    try {
      String expected=String.join("",Files.readAllLines(source));
      String result=String.join("",Files.readAllLines(destination));
      assertEquals(expected,result);
      latch.countDown();
    }
 catch (    IOException e) {
      fail(e.getMessage());
    }
 finally {
      DataBufferUtils.closeChannel(channel);
    }
  }
);
  latch.await();
}
