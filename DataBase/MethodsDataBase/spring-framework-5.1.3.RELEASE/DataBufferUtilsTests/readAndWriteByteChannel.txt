@Test public void readAndWriteByteChannel() throws Exception {
  Path source=Paths.get(DataBufferUtilsTests.class.getResource("DataBufferUtilsTests.txt").toURI());
  Flux<DataBuffer> sourceFlux=DataBufferUtils.readByteChannel(() -> FileChannel.open(source,StandardOpenOption.READ),this.bufferFactory,3);
  Path destination=Files.createTempFile("DataBufferUtilsTests",null);
  WritableByteChannel channel=Files.newByteChannel(destination,StandardOpenOption.WRITE);
  DataBufferUtils.write(sourceFlux,channel).subscribe(DataBufferUtils.releaseConsumer(),throwable -> fail(throwable.getMessage()),() -> {
    try {
      String expected=String.join("",Files.readAllLines(source));
      String result=String.join("",Files.readAllLines(destination));
      assertEquals(expected,result);
    }
 catch (    IOException e) {
      fail(e.getMessage());
    }
 finally {
      DataBufferUtils.closeChannel(channel);
    }
  }
);
}
