@Test public void writeWritableByteChannelErrorInFlux() throws Exception {
  DataBuffer foo=stringBuffer("foo");
  DataBuffer bar=stringBuffer("bar");
  Flux<DataBuffer> flux=Flux.just(foo,bar).concatWith(Flux.error(new RuntimeException()));
  WritableByteChannel channel=Files.newByteChannel(tempFile,StandardOpenOption.WRITE);
  Flux<DataBuffer> writeResult=DataBufferUtils.write(flux,channel);
  StepVerifier.create(writeResult).consumeNextWith(stringConsumer("foo")).consumeNextWith(stringConsumer("bar")).expectError().verify(Duration.ofSeconds(5));
  String result=String.join("",Files.readAllLines(tempFile));
  assertEquals("foobar",result);
  channel.close();
}
