@Test public void writeAsynchronousFileChannelErrorInFlux() throws Exception {
  DataBuffer foo=stringBuffer("foo");
  DataBuffer bar=stringBuffer("bar");
  Flux<DataBuffer> flux=Flux.just(foo,bar).concatWith(Mono.error(new RuntimeException()));
  AsynchronousFileChannel channel=AsynchronousFileChannel.open(tempFile,StandardOpenOption.WRITE);
  Flux<DataBuffer> writeResult=DataBufferUtils.write(flux,channel);
  StepVerifier.create(writeResult).consumeNextWith(stringConsumer("foo")).consumeNextWith(stringConsumer("bar")).expectError(RuntimeException.class).verify();
  String result=String.join("",Files.readAllLines(tempFile));
  assertEquals("foobar",result);
  channel.close();
}
