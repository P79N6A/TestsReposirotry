@Test public void testExtendedResourceInjectionWithDestruction(){
  bf.registerBeanDefinition("annotatedBean",new RootBeanDefinition(TypedExtendedResourceInjectionBean.class));
  bf.registerBeanDefinition("testBean",new RootBeanDefinition(TestBean.class));
  NestedTestBean ntb=new NestedTestBean();
  bf.registerSingleton("nestedTestBean",ntb);
  TestBean tb=bf.getBean("testBean",TestBean.class);
  TypedExtendedResourceInjectionBean bean=(TypedExtendedResourceInjectionBean)bf.getBean("annotatedBean");
  assertSame(tb,bean.getTestBean());
  assertSame(tb,bean.getTestBean2());
  assertSame(tb,bean.getTestBean3());
  assertSame(tb,bean.getTestBean4());
  assertSame(ntb,bean.getNestedTestBean());
  assertSame(bf,bean.getBeanFactory());
  assertArrayEquals(new String[]{"testBean","nestedTestBean"},bf.getDependenciesForBean("annotatedBean"));
  bf.destroySingleton("testBean");
  assertFalse(bf.containsSingleton("testBean"));
  assertFalse(bf.containsSingleton("annotatedBean"));
  assertTrue(bean.destroyed);
  assertSame(0,bf.getDependenciesForBean("annotatedBean").length);
}
