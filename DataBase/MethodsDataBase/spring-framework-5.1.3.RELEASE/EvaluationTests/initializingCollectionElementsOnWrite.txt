/** 
 * SPR-6984: attempting to index a collection on write using an index that doesn't currently exist in the collection (address.crossStreets[0] below)
 */
@Test public void initializingCollectionElementsOnWrite(){
  TestPerson person=new TestPerson();
  EvaluationContext context=new StandardEvaluationContext(person);
  SpelParserConfiguration config=new SpelParserConfiguration(true,true);
  ExpressionParser parser=new SpelExpressionParser(config);
  Expression e=parser.parseExpression("name");
  e.setValue(context,"Oleg");
  assertEquals("Oleg",person.getName());
  e=parser.parseExpression("address.street");
  e.setValue(context,"123 High St");
  assertEquals("123 High St",person.getAddress().getStreet());
  e=parser.parseExpression("address.crossStreets[0]");
  e.setValue(context,"Blah");
  assertEquals("Blah",person.getAddress().getCrossStreets().get(0));
  e=parser.parseExpression("address.crossStreets[3]");
  e.setValue(context,"Wibble");
  assertEquals("Blah",person.getAddress().getCrossStreets().get(0));
  assertEquals("Wibble",person.getAddress().getCrossStreets().get(3));
}
