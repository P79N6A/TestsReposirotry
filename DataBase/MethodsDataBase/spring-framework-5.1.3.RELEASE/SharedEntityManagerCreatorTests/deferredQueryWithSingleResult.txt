@Test public void deferredQueryWithSingleResult(){
  EntityManagerFactory emf=mock(EntityManagerFactory.class);
  EntityManager targetEm=mock(EntityManager.class);
  Query query=mock(Query.class);
  given(emf.createEntityManager()).willReturn(targetEm);
  given(targetEm.createQuery("x")).willReturn(query);
  given(targetEm.isOpen()).willReturn(true);
  EntityManager em=SharedEntityManagerCreator.createSharedEntityManager(emf);
  em.createQuery("x").getSingleResult();
  verify(query).getSingleResult();
  verify(targetEm).close();
}
