@Test public void testMapInjectionWithPriority(){
  DefaultListableBeanFactory lbf=new DefaultListableBeanFactory();
  lbf.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);
  RootBeanDefinition bd1=new RootBeanDefinition(HighPriorityTestBean.class);
  RootBeanDefinition bd2=new RootBeanDefinition(LowPriorityTestBean.class);
  RootBeanDefinition bd3=new RootBeanDefinition(NullTestBeanFactoryBean.class);
  RootBeanDefinition bd4=new RootBeanDefinition(TestBeanRecipient.class,RootBeanDefinition.AUTOWIRE_CONSTRUCTOR,false);
  lbf.registerBeanDefinition("bd1",bd1);
  lbf.registerBeanDefinition("bd2",bd2);
  lbf.registerBeanDefinition("bd3",bd3);
  lbf.registerBeanDefinition("bd4",bd4);
  lbf.preInstantiateSingletons();
  TestBean bean=lbf.getBean(TestBeanRecipient.class).testBean;
  assertThat(bean.getBeanName(),equalTo("bd1"));
}
