@Test public void testBeanDefinitionOverridingNotAllowed(){
  DefaultListableBeanFactory lbf=new DefaultListableBeanFactory();
  lbf.setAllowBeanDefinitionOverriding(false);
  BeanDefinition oldDef=new RootBeanDefinition(TestBean.class);
  BeanDefinition newDef=new RootBeanDefinition(NestedTestBean.class);
  lbf.registerBeanDefinition("test",oldDef);
  try {
    lbf.registerBeanDefinition("test",newDef);
    fail("Should have thrown BeanDefinitionOverrideException");
  }
 catch (  BeanDefinitionOverrideException ex) {
    assertEquals("test",ex.getBeanName());
    assertSame(newDef,ex.getBeanDefinition());
    assertSame(oldDef,ex.getExistingDefinition());
  }
}
