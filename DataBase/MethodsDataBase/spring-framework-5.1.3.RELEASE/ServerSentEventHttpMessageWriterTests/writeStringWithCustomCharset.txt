@Test public void writeStringWithCustomCharset(){
  Flux<String> source=Flux.just("\u00A3");
  Charset charset=StandardCharsets.ISO_8859_1;
  MediaType mediaType=new MediaType("text","event-stream",charset);
  testWrite(source,mediaType,outputMessage,String.class);
  assertEquals(mediaType,outputMessage.getHeaders().getContentType());
  StepVerifier.create(outputMessage.getBody()).consumeNextWith(stringConsumer("data:")).consumeNextWith(dataBuffer -> {
    String value=DataBufferTestUtils.dumpString(dataBuffer,charset);
    DataBufferUtils.release(dataBuffer);
    assertEquals("\u00A3\n",value);
  }
).consumeNextWith(stringConsumer("\n")).expectComplete().verify();
}
