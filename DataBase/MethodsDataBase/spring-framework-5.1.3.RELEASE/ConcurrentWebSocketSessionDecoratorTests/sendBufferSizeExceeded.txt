@Test public void sendBufferSizeExceeded() throws IOException, InterruptedException {
  BlockingSession session=new BlockingSession();
  session.setId("123");
  session.setOpen(true);
  final ConcurrentWebSocketSessionDecorator decorator=new ConcurrentWebSocketSessionDecorator(session,10 * 1000,1024);
  sendBlockingMessage(decorator);
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < 1023; i++) {
    sb.append("a");
  }
  TextMessage message=new TextMessage(sb.toString());
  decorator.sendMessage(message);
  assertEquals(1023,decorator.getBufferSize());
  assertTrue(session.isOpen());
  try {
    decorator.sendMessage(message);
    fail("Expected exception");
  }
 catch (  SessionLimitExceededException ex) {
    String actual=ex.getMessage();
    String regex="Buffer size [\\d]+ bytes for session '123' exceeds the allowed limit 1024";
    assertTrue("Unexpected message: " + actual,actual.matches(regex));
    assertEquals(CloseStatus.SESSION_NOT_RELIABLE,ex.getStatus());
  }
}
