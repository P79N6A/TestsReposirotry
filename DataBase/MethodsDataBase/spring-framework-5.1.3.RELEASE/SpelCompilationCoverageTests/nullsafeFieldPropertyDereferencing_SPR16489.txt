@Test public void nullsafeFieldPropertyDereferencing_SPR16489() throws Exception {
  FooObjectHolder foh=new FooObjectHolder();
  StandardEvaluationContext context=new StandardEvaluationContext();
  context.setRootObject(foh);
  SpelExpression expression=(SpelExpression)parser.parseExpression("foo?.object");
  assertEquals("hello",expression.getValue(context));
  foh.foo=null;
  assertNull(expression.getValue(context));
  foh.foo=new FooObject();
  assertEquals("hello",expression.getValue(context));
  assertCanCompile(expression);
  assertEquals("hello",expression.getValue(context));
  foh.foo=null;
  assertNull(expression.getValue(context));
  expression=(SpelExpression)parser.parseExpression("#var?.propertya");
  context.setVariable("var",StaticsHelper.class);
  assertEquals("sh",expression.getValue(context).toString());
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
  assertCanCompile(expression);
  context.setVariable("var",StaticsHelper.class);
  assertEquals("sh",expression.getValue(context).toString());
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
  expression=(SpelExpression)parser.parseExpression("#var?.a");
  context.setVariable("var",new TestClass4());
  assertFalse((Boolean)expression.getValue(context));
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
  assertCanCompile(expression);
  context.setVariable("var",new TestClass4());
  assertFalse((Boolean)expression.getValue(context));
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
  expression=(SpelExpression)parser.parseExpression("#var?.four");
  context.setVariable("var",new Three());
  assertEquals("0.04",expression.getValue(context).toString());
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
  assertCanCompile(expression);
  context.setVariable("var",new Three());
  assertEquals("0.04",expression.getValue(context).toString());
  context.setVariable("var",null);
  assertNull(expression.getValue(context));
}
