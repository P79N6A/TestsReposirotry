@Test public void exchange() throws Exception {
  mockTextPlainHttpMessageConverter();
  HttpHeaders requestHeaders=new HttpHeaders();
  mockSentRequest(POST,"http://example.com",requestHeaders);
  mockResponseStatus(HttpStatus.OK);
  String expected="42";
  mockResponseBody(expected,MediaType.TEXT_PLAIN);
  HttpHeaders entityHeaders=new HttpHeaders();
  entityHeaders.set("MyHeader","MyValue");
  HttpEntity<String> entity=new HttpEntity<>("Hello World",entityHeaders);
  ResponseEntity<String> result=template.exchange("http://example.com",POST,entity,String.class);
  assertEquals("Invalid POST result",expected,result.getBody());
  assertEquals("Invalid Content-Type",MediaType.TEXT_PLAIN,result.getHeaders().getContentType());
  assertEquals("Invalid Accept header",MediaType.TEXT_PLAIN_VALUE,requestHeaders.getFirst("Accept"));
  assertEquals("Invalid custom header","MyValue",requestHeaders.getFirst("MyHeader"));
  assertEquals("Invalid status code",HttpStatus.OK,result.getStatusCode());
  verify(response).close();
}
