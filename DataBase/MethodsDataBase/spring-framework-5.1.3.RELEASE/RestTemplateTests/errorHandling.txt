@Test public void errorHandling() throws Exception {
  String url="http://example.com";
  mockSentRequest(GET,url);
  mockResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR);
  willThrow(new HttpServerErrorException(HttpStatus.INTERNAL_SERVER_ERROR)).given(errorHandler).handleError(new URI(url),GET,response);
  try {
    template.execute(url,GET,null,null);
    fail("HttpServerErrorException expected");
  }
 catch (  HttpServerErrorException ex) {
  }
  verify(response).close();
}
