@Test public void filterWrapsRequestResponseAndPerformsAsyncDispatch() throws Exception {
  MockMvc mockMvc=standaloneSetup(new PersonController()).addFilters(new WrappingRequestResponseFilter(),new ShallowEtagHeaderFilter()).build();
  MvcResult mvcResult=mockMvc.perform(get("/persons/1").accept(MediaType.APPLICATION_JSON)).andExpect(request().asyncStarted()).andExpect(request().asyncResult(new Person("Lukas"))).andReturn();
  mockMvc.perform(asyncDispatch(mvcResult)).andExpect(status().isOk()).andExpect(header().longValue("Content-Length",53)).andExpect(header().string("ETag","\"0e37becb4f0c90709cb2e1efcc61eaa00\"")).andExpect(content().string("{\"name\":\"Lukas\",\"someDouble\":0.0,\"someBoolean\":false}"));
}
