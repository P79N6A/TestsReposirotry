@Test public void forwardedRequestWithServletForward() throws Exception {
  this.request.setRequestURI("/foo");
  this.request.addHeader(X_FORWARDED_PROTO,"https");
  this.request.addHeader(X_FORWARDED_HOST,"www.mycompany.com");
  this.request.addHeader(X_FORWARDED_PORT,"443");
  this.filter.doFilter(this.request,new MockHttpServletResponse(),this.filterChain);
  HttpServletRequest wrappedRequest=(HttpServletRequest)this.filterChain.getRequest();
  this.request.setDispatcherType(DispatcherType.FORWARD);
  this.request.setRequestURI("/bar");
  this.filterChain.reset();
  this.filter.doFilter(wrappedRequest,new MockHttpServletResponse(),this.filterChain);
  HttpServletRequest actual=(HttpServletRequest)this.filterChain.getRequest();
  assertNotNull(actual);
  assertEquals("/bar",actual.getRequestURI());
  assertEquals("https://www.mycompany.com/bar",actual.getRequestURL().toString());
}
