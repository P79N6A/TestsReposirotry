@Test public void customExecutorBeanConfigWithThrowsException(){
  AnnotationConfigApplicationContext ctx=new AnnotationConfigApplicationContext();
  ctx.register(CustomExecutorBeanConfig.class,ExecutorPostProcessor.class);
  ctx.refresh();
  AsyncBean asyncBean=ctx.getBean(AsyncBean.class);
  TestableAsyncUncaughtExceptionHandler exceptionHandler=(TestableAsyncUncaughtExceptionHandler)ctx.getBean("exceptionHandler");
  assertFalse("handler should not have been called yet",exceptionHandler.isCalled());
  Method method=ReflectionUtils.findMethod(AsyncBean.class,"fail");
  asyncBean.fail();
  Awaitility.await().atMost(500,TimeUnit.MILLISECONDS).pollInterval(10,TimeUnit.MILLISECONDS).untilAsserted(() -> exceptionHandler.assertCalledWith(method,UnsupportedOperationException.class));
  ctx.close();
}
