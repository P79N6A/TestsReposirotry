@Test public void singleSubscriberWithResource() throws IOException {
  UnicastProcessor<Resource> processor=UnicastProcessor.create();
  Resource logo=new ClassPathResource("/org/springframework/http/converter/logo.jpg");
  Mono.just(logo).subscribe(processor);
  MultipartBodyBuilder bodyBuilder=new MultipartBodyBuilder();
  bodyBuilder.asyncPart("logo",processor,Resource.class);
  Mono<MultiValueMap<String,HttpEntity<?>>> result=Mono.just(bodyBuilder.build());
  Map<String,Object> hints=Collections.emptyMap();
  this.writer.write(result,null,MediaType.MULTIPART_FORM_DATA,this.response,hints).block();
  MultiValueMap<String,Part> requestParts=parse(hints);
  assertEquals(1,requestParts.size());
  Part part=requestParts.getFirst("logo");
  assertEquals("logo",part.name());
  assertTrue(part instanceof FilePart);
  assertEquals("logo.jpg",((FilePart)part).filename());
  assertEquals(MediaType.IMAGE_JPEG,part.headers().getContentType());
  assertEquals(logo.getFile().length(),part.headers().getContentLength());
}
