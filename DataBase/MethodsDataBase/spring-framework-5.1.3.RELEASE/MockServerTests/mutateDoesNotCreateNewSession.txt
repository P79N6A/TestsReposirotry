@Test public void mutateDoesNotCreateNewSession(){
  WebTestClient client=WebTestClient.bindToWebHandler(exchange -> {
    if (exchange.getRequest().getURI().getPath().equals("/set")) {
      return exchange.getSession().doOnNext(session -> session.getAttributes().put("foo","bar")).then();
    }
 else {
      return exchange.getSession().map(session -> session.getAttributeOrDefault("foo","none")).flatMap(value -> {
        DataBuffer buffer=toDataBuffer(value);
        return exchange.getResponse().writeWith(Mono.just(buffer));
      }
);
    }
  }
).build();
  EntityExchangeResult<Void> result=client.get().uri("/set").exchange().expectStatus().isOk().expectBody().isEmpty();
  ResponseCookie session=result.getResponseCookies().getFirst("SESSION");
  client.mutate().build().get().uri("/get").cookie(session.getName(),session.getValue()).exchange().expectBody(String.class).isEqualTo("bar");
}
