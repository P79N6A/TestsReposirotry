@Test public void responseEntityFluxWithCustomHeader() throws Exception {
  EmitterProcessor<SimpleBean> processor=EmitterProcessor.create();
  ResponseEntity<Flux<SimpleBean>> entity=ResponseEntity.ok().header("x-foo","bar").body(processor);
  ResolvableType bodyType=forClassWithGenerics(Flux.class,SimpleBean.class);
  MethodParameter type=on(TestController.class).resolveReturnType(ResponseEntity.class,bodyType);
  this.handler.handleReturnValue(entity,type,this.mavContainer,this.webRequest);
  assertTrue(this.request.isAsyncStarted());
  assertEquals(200,this.response.getStatus());
  assertEquals("bar",this.response.getHeader("x-foo"));
  assertFalse(this.response.isCommitted());
}
