@Test public void getParameterMap() throws Exception {
  this.request.setQueryString("name=value1&name=value2");
  this.request.addParameter("name","value1");
  this.request.addParameter("name","value2");
  this.request.setContent("name=value3&name4=value4".getBytes("ISO-8859-1"));
  this.filter.doFilter(this.request,this.response,this.filterChain);
  Map<String,String[]> parameters=this.filterChain.getRequest().getParameterMap();
  assertNotSame("Request not wrapped",this.request,this.filterChain.getRequest());
  assertEquals(2,parameters.size());
  assertArrayEquals(new String[]{"value1","value2","value3"},parameters.get("name"));
  assertArrayEquals(new String[]{"value4"},parameters.get("name4"));
}
