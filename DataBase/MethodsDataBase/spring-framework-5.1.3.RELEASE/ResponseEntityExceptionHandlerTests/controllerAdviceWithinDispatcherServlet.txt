@Test public void controllerAdviceWithinDispatcherServlet() throws Exception {
  StaticWebApplicationContext ctx=new StaticWebApplicationContext();
  ctx.registerSingleton("controller",ExceptionThrowingController.class);
  ctx.registerSingleton("exceptionHandler",ApplicationExceptionHandler.class);
  ctx.refresh();
  DispatcherServlet servlet=new DispatcherServlet(ctx);
  servlet.init(new MockServletConfig());
  servlet.service(this.servletRequest,this.servletResponse);
  assertEquals(400,this.servletResponse.getStatus());
  assertEquals("error content",this.servletResponse.getContentAsString());
  assertEquals("someHeaderValue",this.servletResponse.getHeader("someHeader"));
}
