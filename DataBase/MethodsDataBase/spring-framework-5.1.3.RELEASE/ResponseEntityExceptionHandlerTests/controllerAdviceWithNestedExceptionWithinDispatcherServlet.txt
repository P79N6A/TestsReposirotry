@Test public void controllerAdviceWithNestedExceptionWithinDispatcherServlet() throws Exception {
  StaticWebApplicationContext ctx=new StaticWebApplicationContext();
  ctx.registerSingleton("controller",NestedExceptionThrowingController.class);
  ctx.registerSingleton("exceptionHandler",ApplicationExceptionHandler.class);
  ctx.refresh();
  DispatcherServlet servlet=new DispatcherServlet(ctx);
  servlet.init(new MockServletConfig());
  try {
    servlet.service(this.servletRequest,this.servletResponse);
  }
 catch (  ServletException ex) {
    assertTrue(ex.getCause() instanceof IllegalStateException);
    assertTrue(ex.getCause().getCause() instanceof ServletRequestBindingException);
  }
}
