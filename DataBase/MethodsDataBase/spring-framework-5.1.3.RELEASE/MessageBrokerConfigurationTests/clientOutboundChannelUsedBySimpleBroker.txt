@Test public void clientOutboundChannelUsedBySimpleBroker(){
  ApplicationContext context=loadConfig(SimpleBrokerConfig.class);
  TestChannel outboundChannel=context.getBean("clientOutboundChannel",TestChannel.class);
  SimpleBrokerMessageHandler broker=context.getBean(SimpleBrokerMessageHandler.class);
  StompHeaderAccessor headers=StompHeaderAccessor.create(StompCommand.SUBSCRIBE);
  headers.setSessionId("sess1");
  headers.setSubscriptionId("subs1");
  headers.setDestination("/foo");
  Message<?> message=MessageBuilder.createMessage(new byte[0],headers.getMessageHeaders());
  broker.handleMessage(createConnectMessage("sess1",new long[]{0,0}));
  broker.handleMessage(message);
  headers=StompHeaderAccessor.create(StompCommand.SEND);
  headers.setSessionId("sess1");
  headers.setDestination("/foo");
  message=MessageBuilder.createMessage("bar".getBytes(),headers.getMessageHeaders());
  broker.handleMessage(message);
  message=outboundChannel.messages.get(1);
  headers=StompHeaderAccessor.wrap(message);
  assertEquals(SimpMessageType.MESSAGE,headers.getMessageType());
  assertEquals("/foo",headers.getDestination());
  assertEquals("bar",new String((byte[])message.getPayload()));
}
