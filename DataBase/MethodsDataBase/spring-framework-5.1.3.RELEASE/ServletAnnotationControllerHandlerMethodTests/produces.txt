@Test public void produces() throws Exception {
  initServlet(wac -> {
    List<HttpMessageConverter<?>> converters=new ArrayList<>();
    converters.add(new MappingJackson2HttpMessageConverter());
    converters.add(new Jaxb2RootElementHttpMessageConverter());
    RootBeanDefinition beanDef;
    beanDef=new RootBeanDefinition(RequestMappingHandlerAdapter.class);
    beanDef.getPropertyValues().add("messageConverters",converters);
    wac.registerBeanDefinition("handlerAdapter",beanDef);
    beanDef=new RootBeanDefinition(ExceptionHandlerExceptionResolver.class);
    beanDef.getPropertyValues().add("messageConverters",converters);
    wac.registerBeanDefinition("requestMappingResolver",beanDef);
  }
,ProducesController.class);
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","text/html");
  MockHttpServletResponse response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals("html",response.getContentAsString());
  request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","application/xml");
  response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals("xml",response.getContentAsString());
  request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","application/xml, text/html");
  response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals("xml",response.getContentAsString());
  request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","text/html;q=0.9, application/xml");
  response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals("xml",response.getContentAsString());
  request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","application/msword");
  response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals(406,response.getStatus());
  request=new MockHttpServletRequest("GET","/something");
  request.addHeader("Accept","text/csv,application/problem+json");
  response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals(500,response.getStatus());
  assertEquals("application/problem+json;charset=UTF-8",response.getContentType());
  assertEquals("{\"reason\":\"error\"}",response.getContentAsString());
}
