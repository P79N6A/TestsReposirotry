@Test public void testGetQueueInfoOverrideIntraQueuePreemption() throws Exception {
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  ReservationSystemTestUtil.setupQueueConfiguration(conf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_ENABLE_MONITORS,true);
  conf.set(YarnConfiguration.RM_SCHEDULER_MONITOR_POLICIES,"org.apache.hadoop.yarn.server.resourcemanager.monitor.capacity." + "ProportionalCapacityPreemptionPolicy");
  conf.setBoolean(CapacitySchedulerConfiguration.INTRAQUEUE_PREEMPTION_ENABLED,true);
  conf.setBoolean(CapacitySchedulerConfiguration.PREFIX + "root.intra-queue-preemption.disable_preemption",true);
  conf.setBoolean(CapacitySchedulerConfiguration.PREFIX + "root.a.a1.intra-queue-preemption.disable_preemption",false);
  MiniYARNCluster cluster=new MiniYARNCluster("testGetQueueInfoOverrideIntraQueuePreemption",2,1,1);
  YarnClient yarnClient=null;
  try {
    cluster.init(conf);
    cluster.start();
    final Configuration yarnConf=cluster.getConfig();
    yarnClient=YarnClient.createYarnClient();
    yarnClient.init(yarnConf);
    yarnClient.start();
    QueueCLI cli=new QueueCLI();
    cli.setClient(yarnClient);
    cli.setSysOutPrintStream(sysOut);
    cli.setSysErrPrintStream(sysErr);
    sysOutStream.reset();
    int result=cli.run(new String[]{"-status","a"});
    assertEquals(0,result);
    String queueStatusOut=sysOutStream.toString();
    Assert.assertTrue(queueStatusOut.contains("\tPreemption : enabled"));
    Assert.assertTrue(queueStatusOut.contains("Intra-queue Preemption : disabled"));
    cli=new QueueCLI();
    cli.setClient(yarnClient);
    cli.setSysOutPrintStream(sysOut);
    cli.setSysErrPrintStream(sysErr);
    sysOutStream.reset();
    result=cli.run(new String[]{"-status","a1"});
    assertEquals(0,result);
    queueStatusOut=sysOutStream.toString();
    Assert.assertTrue(queueStatusOut.contains("\tPreemption : enabled"));
    Assert.assertTrue(queueStatusOut.contains("Intra-queue Preemption : enabled"));
  }
  finally {
    if (yarnClient != null) {
      yarnClient.stop();
    }
    cluster.stop();
    cluster.close();
  }
}
