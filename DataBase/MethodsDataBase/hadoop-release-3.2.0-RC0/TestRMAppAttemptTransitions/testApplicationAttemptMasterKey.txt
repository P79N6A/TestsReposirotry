@Test public void testApplicationAttemptMasterKey() throws Exception {
  Container amContainer=allocateApplicationAttempt();
  ApplicationAttemptId appid=applicationAttempt.getAppAttemptId();
  boolean isMasterKeyExisted=clientToAMTokenManager.hasMasterKey(appid);
  if (isSecurityEnabled) {
    Assert.assertTrue(isMasterKeyExisted);
    Assert.assertNotNull(clientToAMTokenManager.getMasterKey(appid));
  }
 else {
    Assert.assertFalse(isMasterKeyExisted);
  }
  launchApplicationAttempt(amContainer);
  applicationAttempt.handle(new RMAppAttemptEvent(applicationAttempt.getAppAttemptId(),RMAppAttemptEventType.KILL));
  assertEquals(YarnApplicationAttemptState.LAUNCHED,applicationAttempt.createApplicationAttemptState());
  sendAttemptUpdateSavedEvent(applicationAttempt);
  isMasterKeyExisted=clientToAMTokenManager.hasMasterKey(appid);
  Assert.assertFalse(isMasterKeyExisted);
}
