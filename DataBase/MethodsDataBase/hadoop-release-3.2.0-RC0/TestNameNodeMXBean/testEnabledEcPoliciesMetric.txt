@Test public void testEnabledEcPoliciesMetric() throws Exception {
  MiniDFSCluster cluster=null;
  DistributedFileSystem fs=null;
  try {
    Configuration conf=new HdfsConfiguration();
    ErasureCodingPolicy defaultPolicy=StripedFileTestUtil.getDefaultECPolicy();
    int dataBlocks=defaultPolicy.getNumDataUnits();
    int parityBlocks=defaultPolicy.getNumParityUnits();
    int totalSize=dataBlocks + parityBlocks;
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(totalSize).build();
    fs=cluster.getFileSystem();
    final String defaultPolicyName=defaultPolicy.getName();
    final String rs104PolicyName="RS-10-4-1024k";
    assertEquals("Enabled EC policies metric should return with " + "the default EC policy",defaultPolicyName,getEnabledEcPoliciesMetric());
    fs.enableErasureCodingPolicy(rs104PolicyName);
    assertEquals("Enabled EC policies metric should return with " + "both enabled policies separated by a comma",rs104PolicyName + ", " + defaultPolicyName,getEnabledEcPoliciesMetric());
    fs.disableErasureCodingPolicy(defaultPolicyName);
    fs.disableErasureCodingPolicy(rs104PolicyName);
    assertEquals("Enabled EC policies metric should return with " + "an empty string if there is no enabled policy","",getEnabledEcPoliciesMetric());
  }
  finally {
    fs.close();
    cluster.shutdown();
  }
}
