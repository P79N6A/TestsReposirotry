/** 
 * This test doesn't require KDC or other security settings as it expects {@link java.net.BindException}. Testing is done with unprivileged port for  {@code dfs.datanode.http.address}.
 * @throws Exception
 */
@Test public void testWebServerAddrBindException() throws Exception {
  ServerSocket ss=new ServerSocket();
  try {
    ss.bind(new InetSocketAddress("localhost",0));
    thrown.expect(BindException.class);
    thrown.expectMessage("localhost/127.0.0.1:" + ss.getLocalPort());
    Configuration conf=new HdfsConfiguration();
    conf.set(DFSConfigKeys.DFS_DATANODE_ADDRESS_KEY,"localhost:" + NetUtils.getFreeSocketPort());
    conf.set(DFSConfigKeys.DFS_DATANODE_HTTP_ADDRESS_KEY,"localhost:" + ss.getLocalPort());
    SecureDataNodeStarter.getSecureResources(conf);
  }
  finally {
    ss.close();
  }
}
