@Test public void testSetAndClearQuota() throws Exception {
  String nsId="ns0";
  String src="/test-QuotaMounttable";
  String dest="/QuotaMounttable";
  String[] argv=new String[]{"-add",src,nsId,dest};
  assertEquals(0,ToolRunner.run(admin,argv));
  stateStore.loadCache(MountTableStoreImpl.class,true);
  GetMountTableEntriesRequest getRequest=GetMountTableEntriesRequest.newInstance(src);
  GetMountTableEntriesResponse getResponse=client.getMountTableManager().getMountTableEntries(getRequest);
  MountTable mountTable=getResponse.getEntries().get(0);
  RouterQuotaUsage quotaUsage=mountTable.getQuota();
  assertEquals(RouterQuotaUsage.QUOTA_USAGE_COUNT_DEFAULT,quotaUsage.getFileAndDirectoryCount());
  assertEquals(HdfsConstants.QUOTA_RESET,quotaUsage.getQuota());
  assertEquals(RouterQuotaUsage.QUOTA_USAGE_COUNT_DEFAULT,quotaUsage.getSpaceConsumed());
  assertEquals(HdfsConstants.QUOTA_RESET,quotaUsage.getSpaceQuota());
  long nsQuota=50;
  long ssQuota=100;
  argv=new String[]{"-setQuota",src,"-nsQuota",String.valueOf(nsQuota),"-ssQuota",String.valueOf(ssQuota)};
  assertEquals(0,ToolRunner.run(admin,argv));
  stateStore.loadCache(MountTableStoreImpl.class,true);
  getResponse=client.getMountTableManager().getMountTableEntries(getRequest);
  mountTable=getResponse.getEntries().get(0);
  quotaUsage=mountTable.getQuota();
  assertEquals(nsQuota,quotaUsage.getQuota());
  assertEquals(ssQuota,quotaUsage.getSpaceQuota());
  String newSsQuota="2m";
  argv=new String[]{"-setQuota",src,"-ssQuota",newSsQuota};
  assertEquals(0,ToolRunner.run(admin,argv));
  stateStore.loadCache(MountTableStoreImpl.class,true);
  getResponse=client.getMountTableManager().getMountTableEntries(getRequest);
  mountTable=getResponse.getEntries().get(0);
  quotaUsage=mountTable.getQuota();
  assertEquals(nsQuota,quotaUsage.getQuota());
  assertEquals(2 * 1024 * 1024,quotaUsage.getSpaceQuota());
  argv=new String[]{"-clrQuota",src};
  assertEquals(0,ToolRunner.run(admin,argv));
  stateStore.loadCache(MountTableStoreImpl.class,true);
  getResponse=client.getMountTableManager().getMountTableEntries(getRequest);
  mountTable=getResponse.getEntries().get(0);
  quotaUsage=mountTable.getQuota();
  assertEquals(HdfsConstants.QUOTA_RESET,quotaUsage.getQuota());
  assertEquals(HdfsConstants.QUOTA_RESET,quotaUsage.getSpaceQuota());
  System.setErr(new PrintStream(err));
  argv=new String[]{"-clrQuota",src,"check"};
  ToolRunner.run(admin,argv);
  assertTrue(err.toString(),err.toString().contains("Too many arguments, Max=1 argument allowed"));
  argv=new String[]{"-setQuota",src,"check","check2"};
  err.reset();
  ToolRunner.run(admin,argv);
  assertTrue(err.toString().contains("Invalid argument : check"));
}
