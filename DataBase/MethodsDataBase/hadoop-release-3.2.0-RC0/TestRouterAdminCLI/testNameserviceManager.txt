@Test public void testNameserviceManager() throws Exception {
  assertEquals(0,ToolRunner.run(admin,new String[]{"-nameservice","disable","ns0"}));
  stateStore.loadCache(DisabledNameserviceStoreImpl.class,true);
  System.setOut(new PrintStream(out));
  assertEquals(0,ToolRunner.run(admin,new String[]{"-getDisabledNameservices"}));
  assertTrue("ns0 should be reported: " + out,out.toString().contains("ns0"));
  assertEquals(0,ToolRunner.run(admin,new String[]{"-nameservice","enable","ns0"}));
  out.reset();
  stateStore.loadCache(DisabledNameserviceStoreImpl.class,true);
  assertEquals(0,ToolRunner.run(admin,new String[]{"-getDisabledNameservices"}));
  assertFalse("ns0 should not be reported: " + out,out.toString().contains("ns0"));
  System.setErr(new PrintStream(err));
  assertEquals(-1,ToolRunner.run(admin,new String[]{"-nameservice","enable"}));
  String msg="Not enough parameters specificed for cmd -nameservice";
  assertTrue("Got error: " + err.toString(),err.toString().startsWith(msg));
  err.reset();
  assertEquals(-1,ToolRunner.run(admin,new String[]{"-nameservice","wrong","ns0"}));
  assertTrue("Got error: " + err.toString(),err.toString().startsWith("nameservice: Unknown command: wrong"));
  err.reset();
  ToolRunner.run(admin,new String[]{"-nameservice","enable","ns0","check"});
  assertTrue(err.toString().contains("Too many arguments, Max=2 arguments allowed"));
  err.reset();
  ToolRunner.run(admin,new String[]{"-getDisabledNameservices","check"});
  assertTrue(err.toString().contains("No arguments allowed"));
}
