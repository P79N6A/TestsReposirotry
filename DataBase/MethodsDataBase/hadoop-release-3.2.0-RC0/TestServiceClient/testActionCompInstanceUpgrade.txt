@Test public void testActionCompInstanceUpgrade() throws Exception {
  Service service=createService();
  MockServiceClient client=MockServiceClient.create(rule,service,true);
  service.setVersion("v2");
  client.initiateUpgrade(service);
  Component comp=service.getComponents().iterator().next();
  ContainerId containerId=ContainerId.newContainerId(client.attemptId,1L);
  comp.addContainer(new Container().id(containerId.toString()));
  client.actionUpgrade(service,comp.getContainers());
  CompInstancesUpgradeResponseProto response=client.getLastProxyResponse(CompInstancesUpgradeResponseProto.class);
  Assert.assertNotNull("upgrade did not complete",response);
  client.stop();
}
