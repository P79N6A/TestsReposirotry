@Test(timeout=200000) public void testCreateServiceSameNameSameUser() throws Exception {
  String sameAppName="same-name";
  String user=UserGroupInformation.getCurrentUser().getUserName();
  System.setProperty("user.name",user);
  setupInternal(NUM_NMS);
  ServiceClient client=createClient(getConf());
  Service appA=new Service();
  appA.setName(sameAppName);
  appA.setVersion("v1");
  appA.addComponent(createComponent("comp",1,"sleep 1000"));
  Service appB=new Service();
  appB.setName(sameAppName);
  appB.setVersion("v1");
  appB.addComponent(createComponent("comp",1,"sleep 1000"));
  try {
    client.actionBuild(appA);
    client.actionBuild(appB);
  }
 catch (  Exception e) {
    String expectedMsg="Service Instance dir already exists:";
    if (e.getLocalizedMessage() != null) {
      Assert.assertThat(e.getLocalizedMessage(),CoreMatchers.containsString(expectedMsg));
    }
 else {
      Assert.fail("Message cannot be null. It has to say - " + expectedMsg);
    }
  }
 finally {
    client.actionDestroy(sameAppName);
  }
  try {
    client.actionCreate(appA);
    waitForServiceToBeStarted(client,appA);
    client.actionCreate(appB);
    waitForServiceToBeStarted(client,appB);
  }
 catch (  Exception e) {
    String expectedMsg="Failed to create service " + sameAppName + ", because it already exists.";
    if (e.getLocalizedMessage() != null) {
      Assert.assertThat(e.getLocalizedMessage(),CoreMatchers.containsString(expectedMsg));
    }
 else {
      Assert.fail("Message cannot be null. It has to say - " + expectedMsg);
    }
  }
 finally {
    client.actionStop(sameAppName,true);
    client.actionDestroy(sameAppName);
  }
}
