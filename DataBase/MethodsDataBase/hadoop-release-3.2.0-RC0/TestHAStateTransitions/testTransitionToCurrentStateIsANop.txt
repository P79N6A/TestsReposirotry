/** 
 * Test that transitioning a service to the state that it is already in is a nop, specifically, an exception is not thrown.
 */
@Test(timeout=300000) public void testTransitionToCurrentStateIsANop() throws Exception {
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_NAMENODE_PATH_BASED_CACHE_REFRESH_INTERVAL_MS,1L);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(1).build();
  LinkedList<Thread> crmThreads=new LinkedList<Thread>();
  try {
    cluster.waitActive();
    addCrmThreads(cluster,crmThreads);
    cluster.transitionToActive(0);
    addCrmThreads(cluster,crmThreads);
    cluster.transitionToActive(0);
    addCrmThreads(cluster,crmThreads);
    cluster.transitionToStandby(0);
    addCrmThreads(cluster,crmThreads);
    cluster.transitionToStandby(0);
    addCrmThreads(cluster,crmThreads);
  }
  finally {
    cluster.shutdown();
  }
  for (  Thread thread : crmThreads) {
    Uninterruptibles.joinUninterruptibly(thread);
  }
}
