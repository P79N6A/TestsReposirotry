@Test public void testUpgradeMultipleComps(){
  Service goodService=ServiceClientTest.buildLiveGoodService();
  goodService.getComponents().forEach(comp -> comp.setState(ComponentState.UPGRADING));
  Service serviceStatus=mockServerClient.getGoodServiceStatus();
  serviceStatus.setState(ServiceState.UPGRADING);
  Set<String> expectedInstances=new HashSet<>();
  serviceStatus.getComponents().forEach(liveComp -> {
    liveComp.setState(ComponentState.NEEDS_UPGRADE);
    liveComp.getContainers().forEach(liveContainer -> {
      expectedInstances.add(liveContainer.getComponentInstanceName());
      liveContainer.setState(ContainerState.NEEDS_UPGRADE);
    }
);
  }
);
  mockServerClient.setExpectedInstances(expectedInstances);
  final Response actual=apiServer.updateComponents(request,goodService.getName(),goodService.getComponents());
  assertEquals("Component upgrade is ",Response.status(Status.ACCEPTED).build().getStatus(),actual.getStatus());
}
