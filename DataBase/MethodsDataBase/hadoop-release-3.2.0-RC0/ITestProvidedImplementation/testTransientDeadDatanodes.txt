@Test(timeout=300000) public void testTransientDeadDatanodes() throws Exception {
  createImage(new FSTreeWalk(providedPath,conf),nnDirPath,FixedBlockResolver.class);
  startCluster(nnDirPath,3,null,new StorageType[][]{{StorageType.PROVIDED,StorageType.DISK},{StorageType.PROVIDED,StorageType.DISK},{StorageType.DISK}},false);
  DataNode providedDatanode=cluster.getDataNodes().get(0);
  DatanodeStorageInfo providedDNInfo=getProvidedDatanodeStorageInfo();
  int initialBRCount=providedDNInfo.getBlockReportCount();
  for (int i=0; i < numFiles; i++) {
    verifyFileLocation(i,2);
    BlockManagerTestUtil.noticeDeadDatanode(cluster.getNameNode(),providedDatanode.getDatanodeId().getXferAddr());
    cluster.waitActive();
    cluster.triggerHeartbeats();
    Thread.sleep(1000);
    assertEquals(initialBRCount + i + 1,providedDNInfo.getBlockReportCount());
    verifyFileLocation(i,2);
  }
}
