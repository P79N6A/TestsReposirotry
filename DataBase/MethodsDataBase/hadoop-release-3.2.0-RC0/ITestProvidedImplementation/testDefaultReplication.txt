@Test(timeout=500000) public void testDefaultReplication() throws Exception {
  int targetReplication=2;
  conf.setInt(FixedBlockMultiReplicaResolver.REPLICATION,targetReplication);
  createImage(new FSTreeWalk(providedPath,conf),nnDirPath,FixedBlockMultiReplicaResolver.class);
  startCluster(nnDirPath,3,null,new StorageType[][]{{StorageType.PROVIDED,StorageType.DISK},{StorageType.PROVIDED,StorageType.DISK},{StorageType.DISK}},false);
  Thread.sleep(50000);
  FileSystem fs=cluster.getFileSystem();
  int count=0;
  for (  TreePath e : new FSTreeWalk(providedPath,conf)) {
    FileStatus rs=e.getFileStatus();
    Path hp=removePrefix(providedPath,rs.getPath());
    LOG.info("path: " + hp.toUri().getPath());
    e.accept(count++);
    assertTrue(fs.exists(hp));
    FileStatus hs=fs.getFileStatus(hp);
    if (rs.isFile()) {
      BlockLocation[] bl=fs.getFileBlockLocations(hs.getPath(),0,hs.getLen());
      int i=0;
      for (; i < bl.length; i++) {
        int currentRep=bl[i].getHosts().length;
        assertEquals(targetReplication,currentRep);
      }
    }
  }
}
