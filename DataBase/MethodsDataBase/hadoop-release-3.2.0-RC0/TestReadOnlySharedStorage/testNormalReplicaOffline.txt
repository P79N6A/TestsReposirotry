/** 
 * Verify that the NameNode is able to still use <tt>READ_ONLY_SHARED</tt> replicas even  when the single NORMAL replica is offline (and the effective replication count is 0).
 */
@Test public void testNormalReplicaOffline() throws Exception {
  cluster.stopDataNode(normalDataNode.getXferAddr());
  BlockManagerTestUtil.noticeDeadDatanode(cluster.getNameNode(),normalDataNode.getXferAddr());
  NumberReplicas numberReplicas=blockManager.countNodes(storedBlock);
  assertThat(numberReplicas.liveReplicas(),is(0));
  BlockManagerTestUtil.updateState(blockManager);
  assertThat(blockManager.getLowRedundancyBlocksCount(),is(1L));
  BlockManagerTestUtil.computeAllPendingWork(blockManager);
  DFSTestUtil.waitForReplication(cluster,extendedBlock,1,1,0);
  assertThat(getLocatedBlock().getLocations().length,is(2));
  validateNumberReplicas(1);
}
