/** 
 * Tests the client classloader to verify the main class and its dependent class are loaded correctly by the application classloader, and others are loaded by the system classloader.
 */
@Test public void testClientClassLoader() throws Throwable {
  RunJar runJar=spy(new RunJar());
  when(runJar.useClientClassLoader()).thenReturn(true);
  String mainCls=ClassLoaderCheckMain.class.getName();
  String thirdCls=ClassLoaderCheckThird.class.getName();
  String systemClasses="-" + mainCls + ","+ "-"+ thirdCls+ ","+ ApplicationClassLoader.SYSTEM_CLASSES_DEFAULT;
  when(runJar.getSystemClasses()).thenReturn(systemClasses);
  File testJar=JarFinder.makeClassLoaderTestJar(this.getClass(),TEST_ROOT_DIR,TEST_JAR_2_NAME,BUFF_SIZE,mainCls,thirdCls);
  String[] args=new String[3];
  args[0]=testJar.getAbsolutePath();
  args[1]=mainCls;
  runJar.run(args);
  verify(runJar,times(1)).unJar(any(File.class),any(File.class));
}
