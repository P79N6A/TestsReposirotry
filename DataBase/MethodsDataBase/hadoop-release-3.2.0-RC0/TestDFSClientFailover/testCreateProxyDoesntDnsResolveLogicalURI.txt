/** 
 * Test that creating proxy doesn't ever try to DNS-resolve the logical URI. Regression test for HDFS-9364.
 */
@Test(timeout=60000) public void testCreateProxyDoesntDnsResolveLogicalURI() throws IOException {
  final NameService spyNS=spyOnNameService();
  final Configuration conf=new HdfsConfiguration();
  final String service="nameservice1";
  final String namenode="namenode113";
  conf.set(DFSConfigKeys.DFS_NAMESERVICES,service);
  conf.set(FileSystem.FS_DEFAULT_NAME_KEY,"hdfs://" + service);
  conf.set(HdfsClientConfigKeys.Failover.PROXY_PROVIDER_KEY_PREFIX + "." + service,"org.apache.hadoop.hdfs.server.namenode.ha." + "ConfiguredFailoverProxyProvider");
  conf.set(DFSConfigKeys.DFS_HA_NAMENODES_KEY_PREFIX + "." + service,namenode);
  conf.set(DFSConfigKeys.DFS_NAMENODE_RPC_ADDRESS_KEY + "." + service+ "."+ namenode,"localhost:8020");
  Path p=new Path("/");
  p.getFileSystem(conf);
  NameNodeProxiesClient.createProxyWithClientProtocol(conf,FileSystem.getDefaultUri(conf),null);
  NameNodeProxies.createProxy(conf,FileSystem.getDefaultUri(conf),NamenodeProtocol.class,null);
  Mockito.verify(spyNS,Mockito.never()).lookupAllHostAddr(Mockito.eq(service));
}
