/** 
 * Test copy a snapshot will not preserve its erasure coding policy info.
 */
@Test public void testCopySnapshotWillNotPreserveErasureCodingPolicy() throws Exception {
  final int len=1024;
  final Path ecDir=new Path("/ecdir");
  final Path ecFile=new Path(ecDir,"ecFile");
  fs.mkdirs(ecDir);
  fs.allowSnapshot(ecDir);
  fs.setErasureCodingPolicy(ecDir,ecPolicy.getName());
  DFSTestUtil.createFile(fs,ecFile,len,(short)1,0xFEED);
  final Path snap1=fs.createSnapshot(ecDir,"snap1");
  Path snap1Copy=new Path(ecDir.toString() + "-copy");
  final Path snap1CopyECDir=new Path("/ecdir-copy");
  String[] argv=new String[]{"-cp","-px",snap1.toUri().toString(),snap1Copy.toUri().toString()};
  int ret=ToolRunner.run(new FsShell(conf),argv);
  assertEquals("cp -px is not working on a snapshot",SUCCESS,ret);
  assertNull("Got unexpected erasure coding policy",fs.getErasureCodingPolicy(snap1CopyECDir));
  assertEquals("Got unexpected erasure coding policy",ecPolicy,fs.getErasureCodingPolicy(snap1));
}
