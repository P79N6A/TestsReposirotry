@Test public void testBucketConfigurationPropagation() throws Throwable {
  Configuration config=new Configuration(false);
  setBucketOption(config,"b","base","1024");
  String basekey="fs.s3a.base";
  assertOptionEquals(config,basekey,null);
  String bucketKey="fs.s3a.bucket.b.base";
  assertOptionEquals(config,bucketKey,"1024");
  Configuration updated=propagateBucketOptions(config,"b");
  assertOptionEquals(updated,basekey,"1024");
  assertOptionEquals(config,basekey,null);
  String[] sources=updated.getPropertySources(basekey);
  assertEquals(1,sources.length);
  String sourceInfo=sources[0];
  assertTrue("Wrong source " + sourceInfo,sourceInfo.contains(bucketKey));
}
