@Test public void testValidateRequestCapacityAgainstMinMaxAllocationWithDifferentUnits() throws Exception {
  Map<String,ResourceInformation> riMap=new HashMap<>();
  ResourceInformation memory=ResourceInformation.newInstance(ResourceInformation.MEMORY_MB.getName(),ResourceInformation.MEMORY_MB.getUnits(),YarnConfiguration.DEFAULT_RM_SCHEDULER_MINIMUM_ALLOCATION_MB,YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB);
  ResourceInformation vcores=ResourceInformation.newInstance(ResourceInformation.VCORES.getName(),ResourceInformation.VCORES.getUnits(),YarnConfiguration.DEFAULT_RM_SCHEDULER_MINIMUM_ALLOCATION_VCORES,DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES);
  ResourceInformation res1=ResourceInformation.newInstance("res_1","G",0,4);
  riMap.put(ResourceInformation.MEMORY_URI,memory);
  riMap.put(ResourceInformation.VCORES_URI,vcores);
  riMap.put("res_1",res1);
  ResourceUtils.initializeResourcesFromResourceInformationMap(riMap);
  FairSchedulerConfiguration fsConf=new FairSchedulerConfiguration();
  YarnConfiguration yarnConf=new YarnConfiguration(fsConf);
  yarnConf.setBoolean(TestResourceProfiles.TEST_CONF_RESET_RESOURCE_TYPES,false);
  yarnConf.setClass(YarnConfiguration.RM_SCHEDULER,FairScheduler.class,ResourceScheduler.class);
  yarnConf.setBoolean(YarnConfiguration.RM_RESOURCE_PROFILES_ENABLED,false);
  MockRM rm=new MockRM(yarnConf);
  rm.start();
  MockNM nm1=rm.registerNode("199.99.99.1:1234",ResourceTypesTestHelper.newResource(DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,ImmutableMap.<String,String>builder().put("res_1","5G").build()));
  RMApp app1=rm.submitApp(GB,"app","user",null,"default");
  MockAM am1=MockRM.launchAndRegisterAM(app1,rm,nm1);
  try {
    am1.allocate(Collections.singletonList(ResourceRequest.newBuilder().capability(ResourceTypesTestHelper.newResource(4 * GB,1,ImmutableMap.<String,String>builder().put("res_1","500M").build())).numContainers(1).resourceName("*").build()),null);
  }
 catch (  InvalidResourceRequestException e) {
    fail("Allocate request should be accepted but exception was thrown: " + e);
  }
  rm.close();
}
