@Test public void testContainerUpgradeSuccessAutoCommit() throws IOException, InterruptedException, YarnException {
  Listener listener=new Listener();
  ((NodeManager.DefaultContainerStateListener)containerManager.context.getContainerStateTransitionListener()).addListener(listener);
  testContainerReInitSuccess(true);
  try {
    containerManager.commitLastReInitialization(createContainerId(0));
    Assert.fail();
  }
 catch (  Exception e) {
    Assert.assertTrue(e.getMessage().contains("Nothing to Commit"));
  }
  List<org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState> containerStates=listener.states.get(createContainerId(0));
  Assert.assertEquals(Arrays.asList(org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.NEW,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.LOCALIZING,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.SCHEDULED,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.RUNNING,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.REINITIALIZING,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.REINITIALIZING_AWAITING_KILL,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.REINITIALIZING_AWAITING_KILL,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.SCHEDULED,org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.RUNNING),containerStates);
  List<ContainerEventType> containerEventTypes=listener.events.get(createContainerId(0));
  Assert.assertEquals(Arrays.asList(ContainerEventType.INIT_CONTAINER,ContainerEventType.RESOURCE_LOCALIZED,ContainerEventType.CONTAINER_LAUNCHED,ContainerEventType.REINITIALIZE_CONTAINER,ContainerEventType.RESOURCE_LOCALIZED,ContainerEventType.UPDATE_DIAGNOSTICS_MSG,ContainerEventType.CONTAINER_KILLED_ON_REQUEST,ContainerEventType.CONTAINER_LAUNCHED),containerEventTypes);
}
