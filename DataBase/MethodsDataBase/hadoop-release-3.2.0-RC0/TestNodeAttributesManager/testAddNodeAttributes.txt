@Test public void testAddNodeAttributes() throws IOException {
  Map<String,Set<NodeAttribute>> toAddAttributes=new HashMap<>();
  Map<NodeAttribute,AttributeValue> nodeAttributes;
  toAddAttributes.put(HOSTNAMES[0],createAttributesForTest(PREFIXES[0],3,"A","host1_v1"));
  attributesManager.addNodeAttributes(toAddAttributes);
  nodeAttributes=attributesManager.getAttributesForNode(HOSTNAMES[0]);
  Assert.assertEquals(3,nodeAttributes.size());
  Assert.assertTrue(sameAttributeSet(toAddAttributes.get(HOSTNAMES[0]),nodeAttributes.keySet()));
  toAddAttributes.clear();
  toAddAttributes.put(HOSTNAMES[1],createAttributesForTest(PREFIXES[0],2,"A","host2_v1"));
  attributesManager.addNodeAttributes(toAddAttributes);
  nodeAttributes=attributesManager.getAttributesForNode(HOSTNAMES[0]);
  Assert.assertEquals(3,nodeAttributes.size());
  nodeAttributes=attributesManager.getAttributesForNode(HOSTNAMES[1]);
  Assert.assertEquals(2,nodeAttributes.size());
  Assert.assertTrue(sameAttributeSet(toAddAttributes.get(HOSTNAMES[1]),nodeAttributes.keySet()));
  Set<NodeAttribute> clusterAttributes=attributesManager.getClusterNodeAttributes(Sets.newHashSet(PREFIXES[0]));
  Assert.assertEquals(3,clusterAttributes.size());
  clusterAttributes=attributesManager.getClusterNodeAttributes(Sets.newHashSet("non_exist_prefix"));
  Assert.assertEquals(0,clusterAttributes.size());
  clusterAttributes=attributesManager.getClusterNodeAttributes(null);
  Assert.assertEquals(3,clusterAttributes.size());
  toAddAttributes.clear();
  toAddAttributes.put(HOSTNAMES[0],createAttributesForTest(PREFIXES[1],10,"C","host1_v2"));
  toAddAttributes.put(HOSTNAMES[1],createAttributesForTest(PREFIXES[1],20,"C","host1_v2"));
  attributesManager.addNodeAttributes(toAddAttributes);
  nodeAttributes=attributesManager.getAttributesForNode(HOSTNAMES[0]);
  Assert.assertEquals(13,nodeAttributes.size());
  nodeAttributes=attributesManager.getAttributesForNode(HOSTNAMES[1]);
  Assert.assertEquals(22,nodeAttributes.size());
}
