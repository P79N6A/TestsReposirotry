@Test public void testStateStoreNodeHealth() throws IOException {
  DB keepDB=stateStore.getDB();
  DB myMocked=mock(DB.class);
  stateStore.setDB(myMocked);
  ApplicationId appId=ApplicationId.newInstance(1234,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  DBException toThrow=new DBException();
  Mockito.doThrow(toThrow).when(myMocked).put(any(byte[].class),any(byte[].class));
  try {
    ContainerId containerId=ContainerId.newContainerId(appAttemptId,1);
    stateStore.storeContainerKilled(containerId);
  }
 catch (  IOException ioErr) {
    assertTrue(ioErr.getCause() instanceof DBException);
    assertFalse("Statestore should have been unhealthy",stateStore.isHealthy());
    return;
  }
 finally {
    stateStore.setDB(keepDB);
  }
  Assert.fail("Expected exception not thrown");
}
