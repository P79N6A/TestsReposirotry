@Test public void testDataNodeMXBeanSecurityEnabled() throws Exception {
  Configuration simpleConf=new Configuration();
  Configuration secureConf=createSecureConfig("authentication");
  try (MiniDFSCluster cluster=new MiniDFSCluster.Builder(simpleConf).build()){
    List<DataNode> datanodes=cluster.getDataNodes();
    Assert.assertEquals(datanodes.size(),1);
    DataNode datanode=datanodes.get(0);
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=DataNode,name=DataNodeInfo");
    boolean securityEnabled=(boolean)mbs.getAttribute(mxbeanName,"SecurityEnabled");
    Assert.assertFalse(securityEnabled);
    Assert.assertEquals(datanode.isSecurityEnabled(),securityEnabled);
  }
   try (MiniDFSCluster cluster=new MiniDFSCluster.Builder(secureConf).build()){
    List<DataNode> datanodes=cluster.getDataNodes();
    Assert.assertEquals(datanodes.size(),1);
    DataNode datanode=datanodes.get(0);
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=DataNode,name=DataNodeInfo");
    boolean securityEnabled=(boolean)mbs.getAttribute(mxbeanName,"SecurityEnabled");
    Assert.assertTrue(securityEnabled);
    Assert.assertEquals(datanode.isSecurityEnabled(),securityEnabled);
  }
   UserGroupInformation.setConfiguration(simpleConf);
}
