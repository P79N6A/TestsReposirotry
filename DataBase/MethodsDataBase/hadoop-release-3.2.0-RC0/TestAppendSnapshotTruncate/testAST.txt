/** 
 * Test randomly mixing append, snapshot and truncate operations. 
 */
@Test(timeout=TEST_TIMEOUT_SECOND * 1000) public void testAST() throws Exception {
  final String dirPathString="/dir";
  final Path dir=new Path(dirPathString);
  dfs.mkdirs(dir);
  dfs.allowSnapshot(dir);
  final File localDir=GenericTestUtils.getTestDir(dirPathString);
  if (localDir.exists()) {
    FileUtil.fullyDelete(localDir);
  }
  localDir.mkdirs();
  final DirWorker w=new DirWorker(dir,localDir,FILE_WORKER_NUM);
  w.startAllFiles();
  w.start();
  Worker.sleep(TEST_TIME_SECOND * 1000);
  w.stop();
  w.stopAllFiles();
  w.checkEverything();
}
