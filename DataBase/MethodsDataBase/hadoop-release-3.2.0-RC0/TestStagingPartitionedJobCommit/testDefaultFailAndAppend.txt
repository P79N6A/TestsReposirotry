@Test public void testDefaultFailAndAppend() throws Exception {
  FileSystem mockS3=getMockS3A();
  for (  String mode : Arrays.asList(null,CONFLICT_MODE_FAIL,CONFLICT_MODE_APPEND)) {
    if (mode != null) {
      getJob().getConfiguration().set(FS_S3A_COMMITTER_STAGING_CONFLICT_MODE,mode);
    }
 else {
      getJob().getConfiguration().unset(FS_S3A_COMMITTER_STAGING_CONFLICT_MODE);
    }
    PartitionedStagingCommitter committer=newJobCommitter();
    committer.commitJob(getJob());
    reset(mockS3);
    pathsExist(mockS3,"dateint=20161116","dateint=20161116/hour=10");
    committer.commitJob(getJob());
    verifyCompletion(mockS3);
    reset(mockS3);
    pathsExist(mockS3,"dateint=20161115/hour=14");
    committer.commitJob(getJob());
    verifyCompletion(mockS3);
  }
}
