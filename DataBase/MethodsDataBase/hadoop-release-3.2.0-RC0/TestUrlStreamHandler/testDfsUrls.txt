/** 
 * Test opening and reading from an InputStream through a hdfs:// URL. <p> First generate a file with some content through the FileSystem API, then try to open and read the file through the URL stream API.
 * @throws IOException
 */
@Test public void testDfsUrls() throws IOException {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
  FileSystem fs=cluster.getFileSystem();
  Path filePath=new Path("/thefile");
  try {
    byte[] fileContent=new byte[1024];
    for (int i=0; i < fileContent.length; ++i)     fileContent[i]=(byte)i;
    OutputStream os=fs.create(filePath);
    os.write(fileContent);
    os.close();
    URI uri=fs.getUri();
    URL fileURL=new URL(uri.getScheme(),uri.getHost(),uri.getPort(),filePath.toString());
    InputStream is=fileURL.openStream();
    assertNotNull(is);
    byte[] bytes=new byte[4096];
    assertEquals(1024,is.read(bytes));
    is.close();
    for (int i=0; i < fileContent.length; ++i)     assertEquals(fileContent[i],bytes[i]);
    fs.delete(filePath,false);
  }
  finally {
    fs.close();
    cluster.shutdown();
  }
}
