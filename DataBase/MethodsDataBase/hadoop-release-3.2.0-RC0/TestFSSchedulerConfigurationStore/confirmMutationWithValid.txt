@Test public void confirmMutationWithValid() throws Exception {
  conf.setInt(YarnConfiguration.SCHEDULER_CONFIGURATION_FS_MAX_VERSION,2);
  conf.set("a","a");
  conf.set("b","b");
  conf.set("c","c");
  writeConf(conf);
  configurationStore.initialize(conf,conf,null);
  Configuration storeConf=configurationStore.retrieve();
  compareConfig(conf,storeConf);
  Map<String,String> updates=new HashMap<>();
  updates.put("a",null);
  updates.put("b","bb");
  Configuration expectConfig=new Configuration(conf);
  expectConfig.unset("a");
  expectConfig.set("b","bb");
  LogMutation logMutation=new LogMutation(updates,"test");
  configurationStore.logMutation(logMutation);
  configurationStore.confirmMutation(true);
  storeConf=configurationStore.retrieve();
  assertEquals(null,storeConf.get("a"));
  assertEquals("bb",storeConf.get("b"));
  assertEquals("c",storeConf.get("c"));
  compareConfig(expectConfig,storeConf);
  updates.put("b","bbb");
  configurationStore.logMutation(logMutation);
  configurationStore.confirmMutation(true);
  storeConf=configurationStore.retrieve();
  assertEquals(null,storeConf.get("a"));
  assertEquals("bbb",storeConf.get("b"));
  assertEquals("c",storeConf.get("c"));
}
