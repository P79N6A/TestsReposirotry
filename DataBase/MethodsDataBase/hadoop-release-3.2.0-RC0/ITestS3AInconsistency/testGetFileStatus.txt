@Test public void testGetFileStatus() throws Exception {
  S3AFileSystem fs=getFileSystem();
  Path dir=path("ancestor");
  fs.delete(dir,true);
  waitUntilDeleted(dir);
  touch(getFileSystem(),path("ancestor/file-" + DEFAULT_DELAY_KEY_SUBSTRING));
  try {
    FileStatus status=fs.getFileStatus(dir);
    if (fs.hasMetadataStore()) {
      assertTrue("Ancestor is dir",status.isDirectory());
    }
 else {
      fail("getFileStatus should fail due to delayed visibility.");
    }
  }
 catch (  FileNotFoundException e) {
    if (fs.hasMetadataStore()) {
      fail("S3Guard failed to list parent of inconsistent child.");
    }
    LOG.info("File not found, as expected.");
  }
}
