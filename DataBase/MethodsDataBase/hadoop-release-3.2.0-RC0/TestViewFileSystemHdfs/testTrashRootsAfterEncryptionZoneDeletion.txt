@Test public void testTrashRootsAfterEncryptionZoneDeletion() throws Exception {
  final Path zone=new Path("/EZ");
  fsTarget.mkdirs(zone);
  final Path zone1=new Path("/EZ/zone1");
  fsTarget.mkdirs(zone1);
  DFSTestUtil.createKey("test_key",cluster,CONF);
  HdfsAdmin hdfsAdmin=new HdfsAdmin(cluster.getURI(0),CONF);
  final EnumSet<CreateEncryptionZoneFlag> provisionTrash=EnumSet.of(CreateEncryptionZoneFlag.PROVISION_TRASH);
  hdfsAdmin.createEncryptionZone(zone1,"test_key",provisionTrash);
  final Path encFile=new Path(zone1,"encFile");
  DFSTestUtil.createFile(fsTarget,encFile,10240,(short)1,0xFEED);
  Configuration clientConf=new Configuration(CONF);
  clientConf.setLong(FS_TRASH_INTERVAL_KEY,1);
  clientConf.set("fs.default.name",fsTarget.getUri().toString());
  FsShell shell=new FsShell(clientConf);
  DFSTestUtil.verifyDelete(shell,fsTarget,encFile,true);
  assertTrue("ViewFileSystem trash roots should include EZ file trash",(fsView.getTrashRoots(true).size() == 1));
  DFSTestUtil.verifyDelete(shell,fsTarget,zone,true);
  assertTrue("ViewFileSystem trash roots should include EZ zone trash",(fsView.getTrashRoots(true).size() == 2));
}
