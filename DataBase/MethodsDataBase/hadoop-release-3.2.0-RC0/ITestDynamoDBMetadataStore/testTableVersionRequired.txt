/** 
 * Delete the version marker and verify that table init fails.
 */
@Test public void testTableVersionRequired() throws Exception {
  String tableName="testTableVersionRequired";
  Configuration conf=getFileSystem().getConf();
  int maxRetries=conf.getInt(S3GUARD_DDB_MAX_RETRIES,S3GUARD_DDB_MAX_RETRIES_DEFAULT);
  conf.setInt(S3GUARD_DDB_MAX_RETRIES,3);
  conf.set(S3GUARD_DDB_TABLE_NAME_KEY,tableName);
  try (DynamoDBMetadataStore ddbms=new DynamoDBMetadataStore()){
    ddbms.initialize(conf);
    Table table=verifyTableInitialized(tableName,ddbms.getDynamoDB());
    table.deleteItem(VERSION_MARKER_PRIMARY_KEY);
    intercept(IOException.class,E_NO_VERSION_MARKER,() -> ddbms.initTable());
    conf.setInt(S3GUARD_DDB_MAX_RETRIES,maxRetries);
    ddbms.destroy();
  }
 }
