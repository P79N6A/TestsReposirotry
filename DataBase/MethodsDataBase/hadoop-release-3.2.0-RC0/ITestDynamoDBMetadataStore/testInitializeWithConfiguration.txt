/** 
 * This tests that after initialize() using a Configuration object, the instance should have been initialized successfully, and tables are ACTIVE.
 */
@Test public void testInitializeWithConfiguration() throws IOException {
  final String tableName="testInitializeWithConfiguration";
  final Configuration conf=getFileSystem().getConf();
  conf.unset(S3GUARD_DDB_TABLE_NAME_KEY);
  String savedRegion=conf.get(S3GUARD_DDB_REGION_KEY,getFileSystem().getBucketLocation());
  conf.unset(S3GUARD_DDB_REGION_KEY);
  try (DynamoDBMetadataStore ddbms=new DynamoDBMetadataStore()){
    ddbms.initialize(conf);
    fail("Should have failed because the table name is not set!");
  }
 catch (  IllegalArgumentException ignored) {
  }
  conf.set(S3GUARD_DDB_TABLE_NAME_KEY,tableName);
  try (DynamoDBMetadataStore ddbms=new DynamoDBMetadataStore()){
    ddbms.initialize(conf);
    fail("Should have failed because as the region is not set!");
  }
 catch (  IllegalArgumentException ignored) {
  }
  conf.set(S3GUARD_DDB_REGION_KEY,savedRegion);
  try (DynamoDBMetadataStore ddbms=new DynamoDBMetadataStore()){
    ddbms.initialize(conf);
    verifyTableInitialized(tableName,ddbms.getDynamoDB());
    assertNotNull(ddbms.getTable());
    assertEquals(tableName,ddbms.getTable().getTableName());
    assertEquals("Unexpected key schema found!",keySchema(),ddbms.getTable().describe().getKeySchema());
    ddbms.destroy();
  }
 }
