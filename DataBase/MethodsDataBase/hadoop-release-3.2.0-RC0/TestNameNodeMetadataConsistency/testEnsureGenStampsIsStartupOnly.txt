/** 
 * Pretty much the same tests as above but does not setup safeMode == true, hence we should not have positive count of Blocks in future.
 */
@Test public void testEnsureGenStampsIsStartupOnly() throws Exception {
  String testData=" This is test data";
  cluster.restartDataNodes();
  cluster.restartNameNodes();
  cluster.waitActive();
  FileSystem fs=cluster.getFileSystem();
  OutputStream ostream=fs.create(filePath2);
  ostream.write(testData.getBytes());
  ostream.close();
  ExtendedBlock block=DFSTestUtil.getFirstBlock(fs,filePath2);
  long genStamp=block.getGenerationStamp();
  cluster.changeGenStampOfBlock(0,block,genStamp + 1);
  MiniDFSCluster.DataNodeProperties dnProps=cluster.stopDataNode(0);
  cluster.restartNameNode(true);
  BlockInfo bInfo=cluster.getNameNode().getNamesystem().getBlockManager().getStoredBlock(block.getLocalBlock());
  cluster.getNameNode().getNamesystem().writeLock();
  bInfo.delete();
  cluster.getNameNode().getNamesystem().getBlockManager().removeBlock(bInfo);
  cluster.getNameNode().getNamesystem().writeUnlock();
  cluster.restartDataNode(dnProps);
  waitForNumBytes(0);
  assertEquals(0,cluster.getNameNode().getBytesWithFutureGenerationStamps());
}
