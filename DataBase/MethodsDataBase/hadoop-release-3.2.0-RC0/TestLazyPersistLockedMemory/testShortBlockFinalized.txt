/** 
 * Verify that locked bytes are correctly updated when a block is finalized at less than its max length.
 */
@Test public void testShortBlockFinalized() throws IOException, TimeoutException, InterruptedException {
  getClusterBuilder().setNumDatanodes(1).build();
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  final FsDatasetSpi<?> fsd=cluster.getDataNodes().get(0).getFSDataset();
  Path path=new Path("/" + METHOD_NAME + ".dat");
  makeTestFile(path,1,true);
  assertThat(fsd.getCacheUsed(),is(osPageSize));
  fs.delete(path,false);
  waitForLockedBytesUsed(fsd,0);
}
