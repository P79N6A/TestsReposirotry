/** 
 * Tests to verify satisfier persistence working well with multiple restarts operations. This test case runs as below: 1. satisfy the storage policy of file1. 2. restart the cluster. 3. check whether all the blocks are satisfied. 4. satisfy the storage policy of file2. 5. restart the cluster. 6. check whether all the blocks are satisfied.
 * @throws Exception
 */
@Test(timeout=300000) public void testWithRestarts() throws Exception {
  try {
    clusterSetUp();
    fs.setStoragePolicy(testFile,ONE_SSD);
    fs.satisfyStoragePolicy(testFile);
    restartCluster();
    DFSTestUtil.waitExpectedStorageType(testFileName,StorageType.SSD,1,timeout,fs);
    DFSTestUtil.waitExpectedStorageType(testFileName,StorageType.DISK,2,timeout,fs);
    fs.setStoragePolicy(parentDir,COLD);
    fs.satisfyStoragePolicy(parentDir);
    restartCluster();
    DFSTestUtil.waitExpectedStorageType(parentFileName,StorageType.ARCHIVE,3,timeout,fs);
    DFSTestUtil.waitExpectedStorageType(childFileName,StorageType.ARCHIVE,3,timeout,fs);
  }
  finally {
    clusterShutdown();
  }
}
