/** 
 * Tests to verify SPS xattr is removed after SPS is dropped, expect that if the SPS is disabled/dropped, the SPS xattr should be removed accordingly: 1. satisfy storage policy of file1. 2. drop SPS thread in block manager. 3. make sure sps xattr is removed.
 * @throws Exception
 */
@Test(timeout=300000000) public void testDropSPS() throws Exception {
  try {
    clusterSetUp();
    fs.setStoragePolicy(testFile,ONE_SSD);
    fs.satisfyStoragePolicy(testFile);
    cluster.getNamesystem().getBlockManager().getSPSManager().changeModeEvent(StoragePolicySatisfierMode.NONE);
    DFSTestUtil.waitForXattrRemoved(testFileName,XATTR_SATISFY_STORAGE_POLICY,cluster.getNamesystem(),30000);
  }
  finally {
    clusterShutdown();
  }
}
