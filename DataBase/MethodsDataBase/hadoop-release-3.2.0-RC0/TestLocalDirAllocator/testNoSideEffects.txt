/** 
 * Test no side effect files are left over. After creating a temp temp file, remove both the temp file and its parent. Verify that no files or directories are left over as can happen when File objects are mistakenly created from fully qualified path strings.
 * @throws IOException
 */
@Test(timeout=30000) public void testNoSideEffects() throws IOException {
  assumeNotWindows();
  String dir=buildBufferDir(ROOT,0);
  try {
    conf.set(CONTEXT,dir);
    File result=dirAllocator.createTmpFileForWrite(FILENAME,-1,conf);
    assertTrue(result.delete());
    assertTrue(result.getParentFile().delete());
    assertFalse(new File(dir).exists());
  }
  finally {
    Shell.execCommand(Shell.getSetPermissionCommand("u+w",false,BUFFER_DIR_ROOT));
    rmBufferDirs();
  }
}
