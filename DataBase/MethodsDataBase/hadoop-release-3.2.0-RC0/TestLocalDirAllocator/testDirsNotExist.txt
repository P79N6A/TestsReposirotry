/** 
 * Two buffer dirs. Both do not exist but on a RW disk. Check if tmp dirs are allocated in a round-robin
 */
@Test(timeout=30000) public void testDirsNotExist() throws Exception {
  assumeNotWindows();
  String dir2=buildBufferDir(ROOT,2);
  String dir3=buildBufferDir(ROOT,3);
  try {
    conf.set(CONTEXT,dir2 + "," + dir3);
    createTempFile(SMALL_FILE_SIZE);
    int firstDirIdx=(dirAllocator.getCurrentDirectoryIndex() == 0) ? 2 : 3;
    int secondDirIdx=(firstDirIdx == 2) ? 3 : 2;
    validateTempDirCreation(buildBufferDir(ROOT,firstDirIdx));
    validateTempDirCreation(buildBufferDir(ROOT,secondDirIdx));
    validateTempDirCreation(buildBufferDir(ROOT,firstDirIdx));
  }
  finally {
    rmBufferDirs();
  }
}
