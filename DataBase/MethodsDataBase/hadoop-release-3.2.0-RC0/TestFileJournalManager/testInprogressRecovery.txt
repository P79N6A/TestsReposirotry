/** 
 * Test that inprogress files are handled correct. Set up a single edits directory. Fail on after the last roll. Then verify that the  logs have the expected number of transactions.
 */
@Test public void testInprogressRecovery() throws IOException {
  File f=new File(TestEditLog.TEST_DIR + "/inprogressrecovery");
  NNStorage storage=setupEdits(Collections.<URI>singletonList(f.toURI()),5,new AbortSpec(5,0));
  StorageDirectory sd=storage.dirIterator(NameNodeDirType.EDITS).next();
  FileJournalManager jm=new FileJournalManager(conf,sd,storage);
  assertEquals(5 * TXNS_PER_ROLL + TXNS_PER_FAIL,getNumberOfTransactions(jm,1,true,false));
}
