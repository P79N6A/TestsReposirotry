@Test(timeout=5000) public void testFetchRunningApplicationLogs() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  NodeId nodeId=NodeId.newInstance("localhost",1234);
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  ApplicationAttemptReport mockAttemptReport=mock(ApplicationAttemptReport.class);
  doReturn(appAttemptId).when(mockAttemptReport).getApplicationAttemptId();
  List<ApplicationAttemptReport> attemptReports=Arrays.asList(mockAttemptReport);
  ContainerId containerId1=ContainerId.newContainerId(appAttemptId,1);
  ContainerReport mockContainerReport1=mock(ContainerReport.class);
  doReturn(containerId1).when(mockContainerReport1).getContainerId();
  doReturn(nodeId).when(mockContainerReport1).getAssignedNode();
  doReturn("http://localhost:2345").when(mockContainerReport1).getNodeHttpAddress();
  ContainerId containerId2=ContainerId.newContainerId(appAttemptId,2);
  ContainerReport mockContainerReport2=mock(ContainerReport.class);
  doReturn(containerId2).when(mockContainerReport2).getContainerId();
  doReturn(nodeId).when(mockContainerReport2).getAssignedNode();
  doReturn("http://localhost:2345").when(mockContainerReport2).getNodeHttpAddress();
  List<ContainerReport> containerReports=Arrays.asList(mockContainerReport1,mockContainerReport2);
  YarnClient mockYarnClient=createMockYarnClient(YarnApplicationState.RUNNING,ugi.getShortUserName(),true,attemptReports,containerReports);
  LogsCLI cli=spy(new LogsCLIForTest(mockYarnClient));
  doReturn(0).when(cli).printContainerLogsFromRunningApplication(any(Configuration.class),any(ContainerLogsRequest.class),any(LogCLIHelpers.class),anyBoolean(),anyBoolean());
  Set<String> logTypes=new HashSet<>();
  logTypes.add("ALL");
  ContainerLogsRequest mockContainer1=mock(ContainerLogsRequest.class);
  doReturn(logTypes).when(mockContainer1).getLogTypes();
  ContainerLogsRequest mockContainer2=mock(ContainerLogsRequest.class);
  doReturn(logTypes).when(mockContainer2).getLogTypes();
  Map<String,ContainerLogsRequest> matchedLogTypes=new HashMap<>();
  matchedLogTypes.put(containerId1.toString(),mockContainer1);
  matchedLogTypes.put(containerId2.toString(),mockContainer2);
  doReturn(matchedLogTypes).when(cli).getMatchedLogTypesForRunningApp(anyListOf(ContainerLogsRequest.class),anyBoolean(),anyBoolean());
  cli.setConf(new YarnConfiguration());
  int exitCode=cli.run(new String[]{"-applicationId",appId.toString()});
  assertTrue(exitCode == 0);
  ArgumentCaptor<ContainerLogsRequest> logsRequestCaptor=ArgumentCaptor.forClass(ContainerLogsRequest.class);
  verify(cli,times(2)).printContainerLogsFromRunningApplication(any(Configuration.class),logsRequestCaptor.capture(),any(LogCLIHelpers.class),anyBoolean(),anyBoolean());
  List<ContainerLogsRequest> capturedRequests=logsRequestCaptor.getAllValues();
  Assert.assertEquals(2,capturedRequests.size());
  Set<String> logTypes0=capturedRequests.get(0).getLogTypes();
  Set<String> logTypes1=capturedRequests.get(1).getLogTypes();
  Assert.assertTrue(logTypes0.contains("ALL") && (logTypes0.size() == 1));
  Assert.assertTrue(logTypes1.contains("ALL") && (logTypes1.size() == 1));
  mockYarnClient=createMockYarnClientWithException(YarnApplicationState.RUNNING,ugi.getShortUserName());
  LogsCLI cli2=spy(new LogsCLIForTest(mockYarnClient));
  ContainerLogsRequest newOption=mock(ContainerLogsRequest.class);
  doReturn(newOption).when(cli2).getMatchedOptionForRunningApp(any(ContainerLogsRequest.class),anyBoolean(),anyBoolean());
  doReturn(0).when(cli2).printContainerLogsFromRunningApplication(any(Configuration.class),any(ContainerLogsRequest.class),any(LogCLIHelpers.class),anyBoolean(),anyBoolean());
  doReturn("123").when(cli2).getNodeHttpAddressFromRMWebString(any(ContainerLogsRequest.class));
  cli2.setConf(new YarnConfiguration());
  ContainerId containerId100=ContainerId.newContainerId(appAttemptId,100);
  exitCode=cli2.run(new String[]{"-applicationId",appId.toString(),"-containerId",containerId100.toString(),"-nodeAddress","NM:1234"});
  assertTrue(exitCode == 0);
  verify(cli2,times(1)).printContainerLogsFromRunningApplication(any(Configuration.class),logsRequestCaptor.capture(),any(LogCLIHelpers.class),anyBoolean(),anyBoolean());
}
