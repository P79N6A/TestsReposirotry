/** 
 * Test the sync returns false in the following scenarios: 1. the source/target dir are not snapshottable dir 2. the source/target does not have the given snapshots 3. changes have been made in target
 */
@Test public void testFallback() throws Exception {
  Assert.assertFalse(sync());
  final Path spath=new Path(source,HdfsConstants.DOT_SNAPSHOT_DIR + Path.SEPARATOR + "s2");
  Assert.assertEquals(spath,context.getSourcePaths().get(0));
  context.setSourcePaths(Collections.singletonList(source));
  dfs.allowSnapshot(source);
  dfs.allowSnapshot(target);
  Assert.assertFalse(sync());
  Assert.assertEquals(spath,context.getSourcePaths().get(0));
  context.setSourcePaths(Collections.singletonList(source));
  dfs.createSnapshot(source,"s1");
  dfs.createSnapshot(source,"s2");
  dfs.createSnapshot(target,"s1");
  Assert.assertTrue(sync());
  context.setSourcePaths(Collections.singletonList(source));
  final Path subTarget=new Path(target,"sub");
  dfs.mkdirs(subTarget);
  Assert.assertFalse(sync());
  Assert.assertEquals(spath,context.getSourcePaths().get(0));
  context.setSourcePaths(Collections.singletonList(source));
  dfs.delete(subTarget,true);
  Assert.assertTrue(sync());
}
