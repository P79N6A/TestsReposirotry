@Test public void testCodecClosesRandom() throws Exception {
  GenericTestUtils.assumeInNativeProfile();
  Configuration conf=new Configuration();
  conf.set(HADOOP_SECURITY_CRYPTO_CODEC_CLASSES_AES_CTR_NOPADDING_KEY,OpensslAesCtrCryptoCodec.class.getName());
  conf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_SECURE_RANDOM_IMPL_KEY,OsSecureRandom.class.getName());
  CryptoCodec codecWithRandom=CryptoCodec.getInstance(conf);
  assertNotNull("Unable to instantiate codec " + OpensslAesCtrCryptoCodec.class.getName() + ", is the required "+ "version of OpenSSL installed?",codecWithRandom);
  OsSecureRandom random=(OsSecureRandom)Whitebox.getInternalState(codecWithRandom,"random");
  random.nextBytes(new byte[10]);
  assertNotNull(Whitebox.getInternalState(random,"stream"));
  codecWithRandom.close();
  assertNull(Whitebox.getInternalState(random,"stream"));
}
