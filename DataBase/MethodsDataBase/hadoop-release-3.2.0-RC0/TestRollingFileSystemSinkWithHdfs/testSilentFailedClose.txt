/** 
 * Test that closing a file in HDFS silently fails when HDFS is unavailable.
 * @throws IOException thrown when reading or writing log files
 */
@Test public void testSilentFailedClose() throws IOException {
  final String path="hdfs://" + cluster.getNameNode().getHostAndPort() + "/tmp";
  MetricsSystem ms=initMetricsSystem(path,true,false);
  new MyMetrics1().registerWith(ms);
  ms.publishMetricsNow();
  shutdownHdfs();
  MockSink.errored=false;
  try {
    ms.stop();
    assertFalse("An exception was generated stopping sink " + "while HDFS was unavailable, even though the sink is set to " + "ignore errors",MockSink.errored);
  }
  finally {
    ms.shutdown();
  }
}
