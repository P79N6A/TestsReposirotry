/** 
 * Test NameNodeStatusMXBean with security enabled and disabled.
 * @throws Exception
 */
@Test public void testNameNodeStatusMXBeanSecurityEnabled() throws Exception {
  Configuration simpleConf=new Configuration();
  Configuration secureConf=createSecureConfig("authentication");
  UserGroupInformation.setConfiguration(simpleConf);
  try (MiniDFSCluster cluster=new MiniDFSCluster.Builder(simpleConf).build()){
    cluster.waitActive();
    NameNode namenode=cluster.getNameNode();
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=NameNode,name=NameNodeStatus");
    boolean securityEnabled=(boolean)mbs.getAttribute(mxbeanName,"SecurityEnabled");
    Assert.assertFalse(securityEnabled);
    Assert.assertEquals(namenode.isSecurityEnabled(),securityEnabled);
  }
   try (MiniDFSCluster cluster=new MiniDFSCluster.Builder(secureConf).build()){
    cluster.waitActive();
    NameNode namenode=cluster.getNameNode();
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=NameNode,name=NameNodeStatus");
    boolean securityEnabled=(boolean)mbs.getAttribute(mxbeanName,"SecurityEnabled");
    Assert.assertTrue(securityEnabled);
    Assert.assertEquals(namenode.isSecurityEnabled(),securityEnabled);
  }
 }
