/** 
 * Partial block movement. Here, first occurrence is #blocksStorageMovementUnReportedItemsCheck() and then #blockStorageMovementReportedItemsCheck().
 */
@Test(timeout=30000) public void testPartialBlockMovementShouldBeRetried2() throws Exception {
  Long item=new Long(1234);
  Block block=new Block(item);
  Long trackID=0L;
  DatanodeInfo dnInfo=DFSTestUtil.getLocalDatanodeInfo(9867);
  Set<StorageTypeNodePair> locs=new HashSet<>();
  locs.add(new StorageTypeNodePair(StorageType.ARCHIVE,dnInfo));
  Map<Block,Set<StorageTypeNodePair>> blocksMap=new HashMap<>();
  blocksMap.put(block,locs);
  bsmAttemptedItems.add(trackID,trackID,0L,blocksMap,0);
  bsmAttemptedItems.notifyReportedBlock(dnInfo,StorageType.ARCHIVE,block);
  Thread.sleep(selfRetryTimeout * 2);
  bsmAttemptedItems.blocksStorageMovementUnReportedItemsCheck();
  bsmAttemptedItems.blockStorageMovementReportedItemsCheck();
  assertTrue("Failed to add to the retry list",checkItemMovedForRetry(trackID,5000));
  assertEquals("Failed to remove from the attempted list",0,bsmAttemptedItems.getAttemptedItemsCount());
}
