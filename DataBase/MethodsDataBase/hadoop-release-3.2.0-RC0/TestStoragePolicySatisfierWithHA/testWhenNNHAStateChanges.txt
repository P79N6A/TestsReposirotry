/** 
 * Tests to verify that SPS should run/stop automatically when NN state changes between Standby and Active.
 */
@Test(timeout=90000) public void testWhenNNHAStateChanges() throws IOException {
  try {
    createCluster();
    cluster.transitionToStandby(0);
    cluster.waitActive();
    try {
      cluster.getNameNode(0).reconfigurePropertyImpl(DFSConfigKeys.DFS_STORAGE_POLICY_SATISFIER_MODE_KEY,StoragePolicySatisfierMode.NONE.toString());
      Assert.fail("It's not allowed to enable or disable" + " StoragePolicySatisfier on Standby NameNode");
    }
 catch (    ReconfigurationException e) {
      GenericTestUtils.assertExceptionContains("Could not change property " + DFSConfigKeys.DFS_STORAGE_POLICY_SATISFIER_MODE_KEY + " from 'EXTERNAL' to 'NONE'",e);
      GenericTestUtils.assertExceptionContains("Enabling or disabling storage policy satisfier service on " + "standby NameNode is not allowed",e.getCause());
    }
  }
  finally {
    cluster.shutdown();
  }
}
