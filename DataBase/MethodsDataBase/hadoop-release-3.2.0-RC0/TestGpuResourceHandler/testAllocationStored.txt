@Test public void testAllocationStored() throws Exception {
  Configuration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.NM_GPU_ALLOWED_DEVICES,"0:0,1:1,2:3,3:4");
  GpuDiscoverer.getInstance().initialize(conf);
  gpuResourceHandler.bootstrap(conf);
  Assert.assertEquals(4,gpuResourceHandler.getGpuAllocator().getAvailableGpus());
  Container container=mockContainerWithGpuRequest(1,3);
  gpuResourceHandler.preStart(container);
  verify(mockNMStateStore).storeAssignedResources(container,ResourceInformation.GPU_URI,Arrays.asList(new GpuDevice(0,0),new GpuDevice(1,1),new GpuDevice(2,3)));
  verifyDeniedDevices(getContainerId(1),Arrays.asList(new GpuDevice(3,4)));
  container=mockContainerWithGpuRequest(2,0);
  gpuResourceHandler.preStart(container);
  verifyDeniedDevices(getContainerId(2),Arrays.asList(new GpuDevice(0,0),new GpuDevice(1,1),new GpuDevice(2,3),new GpuDevice(3,4)));
  Assert.assertEquals(0,container.getResourceMappings().getAssignedResources(ResourceInformation.GPU_URI).size());
  verify(mockNMStateStore,never()).storeAssignedResources(eq(container),eq(ResourceInformation.GPU_URI),anyList());
}
