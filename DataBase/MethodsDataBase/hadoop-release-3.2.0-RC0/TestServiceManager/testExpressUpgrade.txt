@Test(timeout=TIMEOUT) public void testExpressUpgrade() throws Exception {
  ServiceContext context=createServiceContext("testExpressUpgrade");
  ServiceManager manager=context.getServiceManager();
  manager.getServiceSpec().setState(ServiceState.EXPRESS_UPGRADING);
  initUpgrade(context,"v2",true,true,true);
  List<String> comps=ServiceApiUtil.resolveCompsDependency(context.service);
  String compA=comps.get(0);
  makeInstancesReadyAfterUpgrade(context,compA);
  String compB=comps.get(1);
  makeInstancesReadyAfterUpgrade(context,compB);
  GenericTestUtils.waitFor(() -> context.service.getState().equals(ServiceState.STABLE),CHECK_EVERY_MILLIS,TIMEOUT);
  Assert.assertEquals("service not stable",ServiceState.STABLE,manager.getServiceSpec().getState());
  validateUpgradeFinalization(manager.getName(),"v2");
}
