/** 
 * Tests running multiple commands under on setup. This mainly covers {@link org.apache.hadoop.hdfs.server.diskbalancer.command.Command#close}
 */
@Test(timeout=60000) public void testRunMultipleCommandsUnderOneSetup() throws Exception {
  final int numDatanodes=1;
  MiniDFSCluster miniCluster=null;
  final Configuration hdfsConf=new HdfsConfiguration();
  try {
    miniCluster=DiskBalancerTestUtil.newImbalancedCluster(hdfsConf,numDatanodes,CAPACITIES,DEFAULT_BLOCK_SIZE,FILE_LEN);
    final String planFileFullName=runAndVerifyPlan(miniCluster,hdfsConf);
    final String cmdLine=String.format("hdfs diskbalancer -%s %s",EXECUTE,planFileFullName);
    runCommand(cmdLine,hdfsConf,miniCluster);
  }
  finally {
    if (miniCluster != null) {
      miniCluster.shutdown();
    }
  }
}
