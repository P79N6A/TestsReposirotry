/** 
 * Verify that a  {@link StorageLocation#check} timeout is correctly detectedas a failure. This is hard to test without a  {@link Thread#sleep} call.
 * @throws Exception
 */
@Test(timeout=300000) public void testTimeoutInCheck() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  conf.setTimeDuration(DFS_DATANODE_DISK_CHECK_TIMEOUT_KEY,1,TimeUnit.SECONDS);
  conf.setInt(DFS_DATANODE_FAILED_VOLUMES_TOLERATED_KEY,1);
  final FakeTimer timer=new FakeTimer();
  final List<StorageLocation> locations=makeSlowLocations(2000,1);
  StorageLocationChecker checker=new StorageLocationChecker(conf,timer);
  try {
    List<StorageLocation> filteredList=checker.check(conf,locations);
    assertThat(filteredList.size(),is(1));
  }
  finally {
    checker.shutdownAndWait(10,TimeUnit.SECONDS);
  }
}
