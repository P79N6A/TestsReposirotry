@Test public void testDisallowSnapshot() throws Exception {
  Path srcDir=new Path(System.getProperty("user.dir"),"/src");
  fs.mkdirs(srcDir);
  cluster.getNamesystem().allowSnapshot(srcDir.toString());
  String pattern=".*allowed=true.*ugi=" + System.getProperty("user.name") + ".*cmd=disallowSnapshot.*";
  try {
    ((DistributedFileSystem)fs).disallowSnapshot(srcDir);
    verifyAuditLogs(pattern);
  }
 catch (  Exception e) {
    fail("The operation should not have failed with Exception");
  }
  cluster.getNamesystem().allowSnapshot(srcDir.toString());
  fileSys=DFSTestUtil.getFileSystemAs(user1,conf);
  try {
    ((DistributedFileSystem)fileSys).disallowSnapshot(srcDir);
    fail("The operation should have failed with AccessControlException");
  }
 catch (  AccessControlException ace) {
    pattern=".*allowed=false.*ugi=theDoctor.*cmd=disallowSnapshot.*";
    verifyAuditLogs(pattern);
  }
  fileSys.close();
}
