@Test public void testFetchOrCreateRetries() throws Exception {
  try (ShortCircuitCache cache=Mockito.spy(new ShortCircuitCache(10,10000000,10,10000000,1,10000,0))){
    final TestFileDescriptorPair pair=new TestFileDescriptorPair();
    ExtendedBlockId extendedBlockId=new ExtendedBlockId(123,"test_bp1");
    SimpleReplicaCreator sRC=new SimpleReplicaCreator(123,cache,pair);
    Mockito.doThrow(new RetriableException("Retry")).when(cache).fetch(Mockito.eq(extendedBlockId),Mockito.any());
    cache.fetchOrCreate(extendedBlockId,sRC);
    cache.fetchOrCreate(extendedBlockId,sRC);
    Mockito.verify(cache,Mockito.atLeast(3)).fetch(Mockito.eq(extendedBlockId),Mockito.any());
  }
 }
