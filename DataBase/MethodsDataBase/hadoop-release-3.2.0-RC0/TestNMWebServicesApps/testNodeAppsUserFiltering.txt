@Test public void testNodeAppsUserFiltering() throws JSONException, Exception {
  Configuration yarnConf=new Configuration();
  yarnConf.setBoolean(YarnConfiguration.FILTER_ENTITY_LIST_BY_USER,true);
  yarnConf.setBoolean(YarnConfiguration.YARN_ACL_ENABLE,true);
  yarnConf.setStrings(YarnConfiguration.YARN_ADMIN_ACL,"admin");
  ApplicationACLsManager aclManager=new ApplicationACLsManager(yarnConf);
  NMContext context=new NodeManager.NMContext(null,null,dirsHandler,aclManager,null,false,yarnConf);
  Application app=new MockApp(1);
  context.getApplications().put(app.getAppId(),app);
  addAppContainers(app,context);
  Application app2=new MockApp("foo",1234,2);
  context.getApplications().put(app2.getAppId(),app2);
  addAppContainers(app2,context);
  NMWebServices webSvc=new NMWebServices(context,null,nmWebApp,mock(HttpServletResponse.class));
  HttpServletRequest mockHsr=mockHttpServletRequestByUserName("foo");
  AppsInfo appsInfo=webSvc.getNodeApps(mockHsr,null,null);
  assertEquals(1,appsInfo.getApps().size());
  HttpServletRequest mockHsrAdmin=mockHttpServletRequestByUserName("admin");
  AppsInfo appsInfo2=webSvc.getNodeApps(mockHsrAdmin,null,null);
  assertEquals(2,appsInfo2.getApps().size());
}
