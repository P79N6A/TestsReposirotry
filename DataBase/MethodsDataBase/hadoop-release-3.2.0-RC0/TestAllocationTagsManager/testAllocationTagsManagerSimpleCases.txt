@Test public void testAllocationTagsManagerSimpleCases() throws InvalidAllocationTagsQueryException {
  AllocationTagsManager atm=new AllocationTagsManager(rmContext);
  atm.addContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(1,1),ImmutableSet.of("mapper","reducer"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(1,2),ImmutableSet.of("mapper","reducer"));
  atm.addContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(1,3),ImmutableSet.of("service"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(1,4),ImmutableSet.of("reducer"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(2,3),ImmutableSet.of("service"));
  Assert.assertEquals(1,atm.getNodeCardinalityByOp(NodeId.fromString("host1:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper")),Long::max));
  Assert.assertEquals(2,atm.getRackCardinality("rack0",TestUtils.getMockApplicationId(1),"mapper"));
  Assert.assertEquals(1,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::min));
  Assert.assertEquals(2,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::max));
  Assert.assertEquals(3,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::sum));
  Assert.assertEquals(1,atm.getNodeCardinality(NodeId.fromString("host2:123"),TestUtils.getMockApplicationId(1),"mapper"));
  Assert.assertEquals(2,atm.getNodeCardinality(NodeId.fromString("host2:123"),TestUtils.getMockApplicationId(1),"reducer"));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("no_existed","reducer")),Long::min));
  Assert.assertEquals(2,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),null),Long::max));
  Assert.assertEquals(2,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),null),Long::max));
  Assert.assertEquals(2,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::max));
  Assert.assertEquals(4,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createGlobalAllocationTags(ImmutableSet.of()),Long::sum));
  Assert.assertEquals(3,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::sum));
  Assert.assertEquals(1,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(2),ImmutableSet.of()),Long::sum));
  atm.removeContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(1,1),ImmutableSet.of("mapper","reducer"));
  atm.removeContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(1,2),ImmutableSet.of("mapper","reducer"));
  atm.removeContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(1,3),ImmutableSet.of("service"));
  atm.removeContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(1,4),ImmutableSet.of("reducer"));
  atm.removeContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(2,3),ImmutableSet.of("service"));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host1:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper")),Long::max));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::min));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::max));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of("mapper","reducer")),Long::sum));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of(TestUtils.getMockApplicationId(1).toString())),Long::max));
  Assert.assertEquals(0,atm.getNodeCardinality(NodeId.fromString("host2:123"),TestUtils.getMockApplicationId(1),TestUtils.getMockApplicationId(1).toString()));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::max));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createGlobalAllocationTags(ImmutableSet.of()),Long::sum));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::sum));
  Assert.assertEquals(0,atm.getNodeCardinalityByOp(NodeId.fromString("host2:123"),AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::sum));
}
