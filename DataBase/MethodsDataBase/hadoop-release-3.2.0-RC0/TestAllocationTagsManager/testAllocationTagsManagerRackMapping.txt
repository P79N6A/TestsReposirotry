@Test public void testAllocationTagsManagerRackMapping() throws InvalidAllocationTagsQueryException {
  AllocationTagsManager atm=new AllocationTagsManager(rmContext);
  atm.addContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(1,1),ImmutableSet.of("mapper","reducer"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(2,2),ImmutableSet.of("mapper","reducer"));
  atm.addContainer(NodeId.fromString("host1:123"),TestUtils.getMockContainerId(2,4),ImmutableSet.of("reducer"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(1,3),ImmutableSet.of("service"));
  atm.addContainer(NodeId.fromString("host2:123"),TestUtils.getMockContainerId(2,3),ImmutableSet.of("service"));
  Assert.assertEquals(1,atm.getRackCardinality("rack0",TestUtils.getMockApplicationId(1),"mapper"));
  Assert.assertEquals(2,atm.getRackCardinality("rack0",TestUtils.getMockApplicationId(2),"reducer"));
  Assert.assertEquals(3,atm.getRackCardinality("rack0",null,"reducer"));
  Assert.assertEquals(1,atm.getRackCardinalityByOp("rack0",AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::max));
  Assert.assertEquals(1,atm.getRackCardinalityByOp("rack0",AllocationTags.createSingleAppAllocationTags(TestUtils.getMockApplicationId(1),ImmutableSet.of()),Long::min));
  Assert.assertEquals(3,atm.getRackCardinalityByOp("rack0",AllocationTags.createGlobalAllocationTags(ImmutableSet.of()),Long::max));
}
