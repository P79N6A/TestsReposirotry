/** 
 * Tests the case when client is upgraded to return  {@link FsServerDefaults}but then namenode is not upgraded.
 * @throws Exception
 */
@Test public void testFsserverDefaultsBackwardsCompatible() throws Exception {
  MiniDFSCluster cluster=null;
  final Configuration conf=WebHdfsTestUtil.createConf();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
    final WebHdfsFileSystem webfs=WebHdfsTestUtil.getWebHdfsFileSystem(conf,WebHdfsConstants.WEBHDFS_SCHEME);
    FSNamesystem fsnSpy=NameNodeAdapter.spyOnNamesystem(cluster.getNameNode());
    Mockito.when(fsnSpy.getServerDefaults()).thenThrow(new UnsupportedOperationException());
    try {
      webfs.getServerDefaults();
      Assert.fail("should have thrown UnSupportedOperationException.");
    }
 catch (    UnsupportedOperationException uoe) {
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
