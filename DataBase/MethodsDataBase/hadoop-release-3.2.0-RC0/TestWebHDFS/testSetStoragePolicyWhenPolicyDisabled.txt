@Test public void testSetStoragePolicyWhenPolicyDisabled() throws Exception {
  Configuration conf=new HdfsConfiguration();
  conf.setBoolean(DFSConfigKeys.DFS_STORAGE_POLICY_ENABLED_KEY,false);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
  try {
    cluster.waitActive();
    final WebHdfsFileSystem webHdfs=WebHdfsTestUtil.getWebHdfsFileSystem(conf,WebHdfsConstants.WEBHDFS_SCHEME);
    webHdfs.setStoragePolicy(new Path("/"),HdfsConstants.COLD_STORAGE_POLICY_NAME);
    fail("Should throw exception, when storage policy disabled");
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("Failed to set storage policy since"));
  }
 finally {
    cluster.shutdown();
  }
}
