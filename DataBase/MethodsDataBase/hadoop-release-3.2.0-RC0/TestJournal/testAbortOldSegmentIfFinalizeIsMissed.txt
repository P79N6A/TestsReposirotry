/** 
 * Assume that a client is writing to a journal, but loses its connection in the middle of a segment. Thus, any future journal() calls in that segment may fail, because some txns were missed while the connection was down. Eventually, the connection comes back, and the NN tries to start a new segment at a higher txid. This should abort the old one and succeed.
 */
@Test(timeout=10000) public void testAbortOldSegmentIfFinalizeIsMissed() throws Exception {
  journal.newEpoch(FAKE_NSINFO,1);
  journal.startLogSegment(makeRI(1),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  journal.journal(makeRI(2),1,1,3,QJMTestUtil.createTxnData(1,3));
  GenericTestUtils.assertExists(journal.getStorage().getInProgressEditLog(1));
  journal.startLogSegment(makeRI(3),6,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  journal.journal(makeRI(4),6,6,3,QJMTestUtil.createTxnData(6,3));
  GenericTestUtils.assertExists(journal.getStorage().getInProgressEditLog(1));
  GenericTestUtils.assertExists(journal.getStorage().getInProgressEditLog(6));
}
