/** 
 * Test if  {@link BlockManager#computeInvalidateWork(int)}can schedule invalidate work correctly for the striped block groups.
 */
@Test(timeout=120000) public void testComputeInvalidateStripedBlockGroups() throws Exception {
  final int blockInvalidateLimit=bm.getDatanodeManager().getBlockInvalidateLimit();
  namesystem.writeLock();
  try {
    int nodeCount=ecPolicy.getNumDataUnits() + ecPolicy.getNumParityUnits();
    for (int i=0; i < nodeCount; i++) {
      for (int j=0; j < 3 * blockInvalidateLimit + 1; j++) {
        Block blk=new Block(locatedStripedBlock.getBlock().getBlockId() + (i * 10 + j),stripesPerBlock * cellSize,locatedStripedBlock.getBlock().getGenerationStamp());
        bm.addToInvalidates(blk,nodes[i]);
      }
    }
    verifyInvalidationWorkCounts(blockInvalidateLimit);
  }
  finally {
    namesystem.writeUnlock();
  }
}
