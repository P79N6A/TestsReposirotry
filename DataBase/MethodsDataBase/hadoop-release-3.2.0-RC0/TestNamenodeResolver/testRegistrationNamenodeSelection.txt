@Test public void testRegistrationNamenodeSelection() throws InterruptedException, IOException {
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],HAServiceState.ACTIVE)));
  Thread.sleep(100);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],HAServiceState.STANDBY)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[0],2,FederationNamenodeServiceState.ACTIVE);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],HAServiceState.ACTIVE)));
  Thread.sleep(6000);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],HAServiceState.STANDBY)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[1],1,FederationNamenodeServiceState.STANDBY);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],HAServiceState.ACTIVE)));
  Thread.sleep(100);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],null)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[0],2,FederationNamenodeServiceState.ACTIVE);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],HAServiceState.STANDBY)));
  Thread.sleep(1000);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],null)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[1],2,FederationNamenodeServiceState.STANDBY);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],null)));
  Thread.sleep(100);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],HAServiceState.STANDBY)));
  Thread.sleep(100);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[2],HAServiceState.ACTIVE)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[2],3,FederationNamenodeServiceState.ACTIVE);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[0],HAServiceState.STANDBY)));
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[2],HAServiceState.STANDBY)));
  Thread.sleep(1500);
  assertTrue(namenodeResolver.registerNamenode(createNamenodeReport(NAMESERVICES[0],NAMENODES[1],HAServiceState.STANDBY)));
  stateStore.refreshCaches(true);
  verifyFirstRegistration(NAMESERVICES[0],NAMENODES[1],3,FederationNamenodeServiceState.STANDBY);
}
