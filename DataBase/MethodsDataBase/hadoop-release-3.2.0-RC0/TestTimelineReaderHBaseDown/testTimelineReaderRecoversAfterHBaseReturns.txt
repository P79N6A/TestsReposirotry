@Test(timeout=300000) public void testTimelineReaderRecoversAfterHBaseReturns() throws Exception {
  HBaseTestingUtility util=new HBaseTestingUtility();
  configure(util);
  try {
    util.startMiniCluster();
    DataGeneratorForTest.createSchema(util.getConfiguration());
    DataGeneratorForTest.loadApps(util,System.currentTimeMillis());
    TimelineReaderServer server=getTimelineReaderServer();
    server.init(util.getConfiguration());
    HBaseTimelineReaderImpl htr=getHBaseTimelineReaderImpl(server);
    util.shutdownMiniHBaseCluster();
    server.start();
    waitForHBaseDown(htr);
    util.startMiniHBaseCluster(1,1);
    GenericTestUtils.waitFor(() -> !htr.isHBaseDown(),1000,150000);
  }
  finally {
    util.shutdownMiniCluster();
  }
}
