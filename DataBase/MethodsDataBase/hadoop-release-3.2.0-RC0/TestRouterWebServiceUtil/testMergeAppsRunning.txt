/** 
 * This test validates the correctness of RouterWebServiceUtil#mergeAppsInfo in case we want to merge 2 UAMs and their own AM. The status of the AM is RUNNING, so we check the correctness of the merging of the runtime values. The expected result would be 1 report with the merged information.
 */
@Test public void testMergeAppsRunning(){
  AppsInfo apps=new AppsInfo();
  String amHost="http://i_am_the_AM2:1234";
  AppInfo am=new AppInfo();
  am.setAppId(APPID2.toString());
  am.setAMHostHttpAddress(amHost);
  am.setState(YarnApplicationState.RUNNING);
  int value=1000;
  setAppInfoRunning(am,value);
  apps.add(am);
  AppInfo uam1=new AppInfo();
  uam1.setAppId(APPID2.toString());
  uam1.setState(YarnApplicationState.RUNNING);
  apps.add(uam1);
  setAppInfoRunning(uam1,value);
  AppInfo uam2=new AppInfo();
  uam2.setAppId(APPID2.toString());
  uam2.setState(YarnApplicationState.RUNNING);
  apps.add(uam2);
  setAppInfoRunning(uam2,value);
  AppsInfo result=RouterWebServiceUtil.mergeAppsInfo(apps.getApps(),false);
  Assert.assertNotNull(result);
  Assert.assertEquals(1,result.getApps().size());
  AppInfo app=result.getApps().get(0);
  Assert.assertEquals(APPID2.toString(),app.getAppId());
  Assert.assertEquals(amHost,app.getAMHostHttpAddress());
  Assert.assertEquals(value * 3,app.getAllocatedMB());
  Assert.assertEquals(value * 3,app.getAllocatedVCores());
  Assert.assertEquals(value * 3,app.getReservedMB());
  Assert.assertEquals(value * 3,app.getReservedVCores());
  Assert.assertEquals(value * 3,app.getRunningContainers());
  Assert.assertEquals(value * 3,app.getMemorySeconds());
  Assert.assertEquals(value * 3,app.getVcoreSeconds());
  Assert.assertEquals(3,app.getResourceRequests().size());
}
