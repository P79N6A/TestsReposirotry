/** 
 * Test that the block safe decreases the block safe. The block manager stays in safe mode. The safe mode status lifecycle: OFF -> PENDING_THRESHOLD
 */
@Test(timeout=30000) public void testDecrementSafeBlockCount(){
  bmSafeMode.activate(BLOCK_TOTAL);
  Whitebox.setInternalState(bmSafeMode,"extension",0);
  mockBlockManagerForBlockSafeDecrement();
  setBlockSafe(BLOCK_THRESHOLD);
  for (long i=BLOCK_THRESHOLD; i > 0; i--) {
    BlockInfo blockInfo=mock(BlockInfo.class);
    bmSafeMode.decrementSafeBlockCount(blockInfo);
    assertEquals(i - 1,getblockSafe());
    assertTrue(bmSafeMode.isInSafeMode());
  }
}
