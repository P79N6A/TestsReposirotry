/** 
 * Test for the case when both of the NNs in the cluster are in the standby state, and thus are both creating checkpoints and uploading them to each other. In this circumstance, they should receive the error from the other node indicating that the other node already has a checkpoint for the given txid, but this should not cause an abort, etc.
 */
@Test(timeout=300000) public void testBothNodesInStandbyState() throws Exception {
  doEdits(0,10);
  cluster.transitionToStandby(0);
  HATestUtil.waitForCheckpoint(cluster,1,ImmutableList.of(12));
  HATestUtil.waitForCheckpoint(cluster,0,ImmutableList.of(12));
  assertEquals(12,nns[0].getNamesystem().getFSImage().getMostRecentCheckpointTxId());
  assertEquals(12,nns[1].getNamesystem().getFSImage().getMostRecentCheckpointTxId());
  List<File> dirs=Lists.newArrayList();
  dirs.addAll(FSImageTestUtil.getNameNodeCurrentDirs(cluster,0));
  dirs.addAll(FSImageTestUtil.getNameNodeCurrentDirs(cluster,1));
  FSImageTestUtil.assertParallelFilesAreIdentical(dirs,ImmutableSet.<String>of());
}
