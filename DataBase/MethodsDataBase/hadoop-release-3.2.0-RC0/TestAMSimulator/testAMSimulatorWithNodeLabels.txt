@Test public void testAMSimulatorWithNodeLabels() throws Exception {
  if (scheduler.equals(CapacityScheduler.class)) {
    RMAdminCLI rmAdminCLI=new RMAdminCLI(conf);
    String[] args={"-addToClusterNodeLabels","label1"};
    rmAdminCLI.run(args);
    MockAMSimulator app=new MockAMSimulator();
    String appId="app1";
    String queue="default";
    List<ContainerSimulator> containers=new ArrayList<>();
    app.init(1000,containers,rm,null,0,1000000L,"user1",queue,true,appId,0,SLSConfiguration.getAMContainerResource(conf),"label1",null);
    app.firstStep();
    verifySchedulerMetrics(appId);
    ConcurrentMap<ApplicationId,RMApp> rmApps=rm.getRMContext().getRMApps();
    Assert.assertEquals(1,rmApps.size());
    RMApp rmApp=rmApps.get(app.appId);
    Assert.assertNotNull(rmApp);
    Assert.assertEquals("label1",rmApp.getAmNodeLabelExpression());
  }
}
