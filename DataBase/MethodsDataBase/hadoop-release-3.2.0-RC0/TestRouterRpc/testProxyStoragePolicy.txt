@Test public void testProxyStoragePolicy() throws Exception {
  HdfsFileStatus status=namenode.getClient().getFileInfo(nnFile);
  BlockStoragePolicy[] policies=namenode.getClient().getStoragePolicies();
  BlockStoragePolicy policy=policies[0];
  while (policy.isCopyOnCreateFile()) {
    Random rand=new Random();
    int randIndex=rand.nextInt(policies.length);
    policy=policies[randIndex];
  }
  routerProtocol.setStoragePolicy(routerFile,policy.getName());
  HdfsFileStatus newStatus=namenode.getClient().getFileInfo(nnFile);
  assertTrue(newStatus.getStoragePolicy() == policy.getId());
  assertTrue(newStatus.getStoragePolicy() != status.getStoragePolicy());
  Method m=ClientProtocol.class.getMethod("setStoragePolicy",String.class,String.class);
  String badPath="/unknownlocation/unknowndir";
  compareResponses(routerProtocol,nnProtocol,m,new Object[]{badPath,"badpolicy"});
}
