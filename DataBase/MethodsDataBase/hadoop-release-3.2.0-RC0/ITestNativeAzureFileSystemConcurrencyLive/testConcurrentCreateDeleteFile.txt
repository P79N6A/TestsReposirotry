/** 
 * Validate contract for FileSystem.create when overwrite is true and there are concurrent callers of FileSystem.delete.  An existing file should be overwritten, even if the original destination exists but is deleted by an external agent during the create operation.
 */
@Test(timeout=TEST_EXECUTION_TIMEOUT) public void testConcurrentCreateDeleteFile() throws Exception {
  Path testFile=methodPath();
  List<CreateFileTask> tasks=new ArrayList<>(THREAD_COUNT);
  for (int i=0; i < THREAD_COUNT; i++) {
    tasks.add(new CreateFileTask(fs,testFile));
  }
  ExecutorService es=null;
  try {
    es=Executors.newFixedThreadPool(THREAD_COUNT);
    List<Future<Void>> futures=es.invokeAll(tasks);
    for (    Future<Void> future : futures) {
      Assert.assertTrue(future.isDone());
      Assert.assertEquals(null,future.get());
    }
  }
  finally {
    if (es != null) {
      es.shutdownNow();
    }
  }
}
