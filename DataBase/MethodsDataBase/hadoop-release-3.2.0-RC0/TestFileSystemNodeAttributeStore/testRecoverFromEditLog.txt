@Test(timeout=10000) public void testRecoverFromEditLog() throws Exception {
  NodeAttribute docker=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"DOCKER",NodeAttributeType.STRING,"docker-0");
  NodeAttribute gpu=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"GPU",NodeAttributeType.STRING,"nvidia");
  NodeAttribute fpga=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"FPGA",NodeAttributeType.STRING,"asus");
  Map<String,Set<NodeAttribute>> toAddAttributes=new HashMap<>();
  toAddAttributes.put("host0",ImmutableSet.of(gpu,fpga));
  toAddAttributes.put("host1",ImmutableSet.of(docker));
  mgr.addNodeAttributes(toAddAttributes);
  Assert.assertEquals("host0 size",2,mgr.getAttributesForNode("host0").size());
  for (int i=0; i < 5; i++) {
    toAddAttributes.clear();
    toAddAttributes.put("host0",ImmutableSet.of(gpu));
    mgr.removeNodeAttributes(toAddAttributes);
    toAddAttributes.clear();
    toAddAttributes.put("host1",ImmutableSet.of(docker));
    mgr.addNodeAttributes(toAddAttributes);
    toAddAttributes.clear();
    toAddAttributes.put("host0",ImmutableSet.of(gpu));
    mgr.replaceNodeAttributes(NodeAttribute.PREFIX_CENTRALIZED,toAddAttributes);
    toAddAttributes.clear();
    toAddAttributes.put("host1",ImmutableSet.of(gpu));
    mgr.addNodeAttributes(toAddAttributes);
  }
  mgr.stop();
  mgr=new MockNodeAttrbuteManager();
  mgr.init(conf);
  mgr.start();
  Assert.assertEquals("host0 size",1,mgr.getAttributesForNode("host0").size());
  Assert.assertEquals("host1 size",2,mgr.getAttributesForNode("host1").size());
  toAddAttributes.clear();
  NodeAttribute replaced=NodeAttribute.newInstance("GPU2",NodeAttributeType.STRING,"nvidia2");
  toAddAttributes.put("host0",ImmutableSet.of(replaced));
  mgr.replaceNodeAttributes(NodeAttribute.PREFIX_CENTRALIZED,toAddAttributes);
  mgr.stop();
  mgr=new MockNodeAttrbuteManager();
  mgr.init(conf);
  mgr.start();
  Map<NodeAttribute,AttributeValue> valueMap=mgr.getAttributesForNode("host0");
  Map.Entry<NodeAttribute,AttributeValue> entry=valueMap.entrySet().iterator().next();
  NodeAttribute attribute=entry.getKey();
  Assert.assertEquals("host0 size",1,mgr.getAttributesForNode("host0").size());
  Assert.assertEquals("host1 size",2,mgr.getAttributesForNode("host1").size());
  checkNodeAttributeEqual(replaced,attribute);
}
