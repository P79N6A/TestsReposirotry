@Test(timeout=10000) public void testRecoverWithMirror() throws Exception {
  NodeAttribute docker=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"DOCKER",NodeAttributeType.STRING,"docker-0");
  NodeAttribute gpu=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"GPU",NodeAttributeType.STRING,"nvidia");
  NodeAttribute fpga=NodeAttribute.newInstance(NodeAttribute.PREFIX_CENTRALIZED,"FPGA",NodeAttributeType.STRING,"asus");
  Map<String,Set<NodeAttribute>> toAddAttributes=new HashMap<>();
  toAddAttributes.put("host0",ImmutableSet.of(gpu,fpga));
  toAddAttributes.put("host1",ImmutableSet.of(gpu));
  mgr.addNodeAttributes(toAddAttributes);
  Assert.assertEquals("host0 size",2,mgr.getAttributesForNode("host0").size());
  toAddAttributes.clear();
  toAddAttributes.put("host0",ImmutableSet.of(gpu));
  mgr.removeNodeAttributes(toAddAttributes);
  toAddAttributes.clear();
  toAddAttributes.put("host0",ImmutableSet.of(docker));
  mgr.replaceNodeAttributes(NodeAttribute.PREFIX_CENTRALIZED,toAddAttributes);
  Map<NodeAttribute,AttributeValue> attrs=mgr.getAttributesForNode("host0");
  Assert.assertEquals(attrs.size(),1);
  Assert.assertEquals(attrs.keySet().toArray()[0],docker);
  mgr.stop();
  mgr=new MockNodeAttrbuteManager();
  mgr.init(conf);
  mgr.start();
  mgr.getAttributesForNode("host0");
  Assert.assertEquals("host0 size",1,mgr.getAttributesForNode("host0").size());
  Assert.assertEquals("host1 size",1,mgr.getAttributesForNode("host1").size());
  attrs=mgr.getAttributesForNode("host0");
  Assert.assertEquals(attrs.size(),1);
  Assert.assertEquals(attrs.keySet().toArray()[0],docker);
  toAddAttributes.clear();
  toAddAttributes.put("host0",ImmutableSet.of(gpu));
  mgr.replaceNodeAttributes(NodeAttribute.PREFIX_CENTRALIZED,toAddAttributes);
  toAddAttributes.clear();
  toAddAttributes.put("host1",ImmutableSet.of(docker));
  mgr.addNodeAttributes(toAddAttributes);
  mgr.stop();
  mgr=new MockNodeAttrbuteManager();
  mgr.init(conf);
  mgr.start();
  Assert.assertEquals("host0 size",1,mgr.getAttributesForNode("host0").size());
  Assert.assertEquals("host1 size",2,mgr.getAttributesForNode("host1").size());
  attrs=mgr.getAttributesForNode("host0");
  Assert.assertEquals(attrs.size(),1);
  Assert.assertEquals(attrs.keySet().toArray()[0],gpu);
  attrs=mgr.getAttributesForNode("host1");
  Assert.assertTrue(attrs.keySet().contains(docker));
  Assert.assertTrue(attrs.keySet().contains(gpu));
}
