@Test public void testConfiguredChain() throws Exception {
  URI uri1=new URI("s3a://bucket1"), uri2=new URI("s3a://bucket2");
  Configuration conf=new Configuration();
  List<Class<? extends AWSCredentialsProvider>> expectedClasses=Arrays.asList(EnvironmentVariableCredentialsProvider.class,InstanceProfileCredentialsProvider.class,AnonymousAWSCredentialsProvider.class);
  conf.set(AWS_CREDENTIALS_PROVIDER,buildClassListString(expectedClasses));
  AWSCredentialProviderList list1=S3AUtils.createAWSCredentialProviderSet(uri1,conf);
  AWSCredentialProviderList list2=S3AUtils.createAWSCredentialProviderSet(uri2,conf);
  assertCredentialProviders(expectedClasses,list1);
  assertCredentialProviders(expectedClasses,list2);
  assertSameInstanceProfileCredentialsProvider(list1.getProviders().get(1),list2.getProviders().get(1));
}
