@SuppressWarnings({"rawtypes"}) @Test(timeout=10000) public void testDrainDispatcherDrainEventsOnStop() throws Exception {
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.DISPATCHER_DRAIN_EVENTS_TIMEOUT,2000);
  BlockingQueue<Event> queue=new LinkedBlockingQueue<Event>();
  DrainDispatcher disp=new DrainDispatcher(queue);
  disp.init(conf);
  disp.register(DummyType.class,new DummyHandler());
  disp.setDrainEventsOnStop();
  disp.start();
  disp.waitForEventThreadToWait();
  dispatchDummyEvents(disp,2);
  disp.close();
  assertEquals(0,queue.size());
}
