/** 
 * HDFS-3062: DistributedFileSystem.getCanonicalServiceName() throws an exception if the URI is a logical URI. This bug fails the combination of ha + mapred + security.
 */
@Test(timeout=300000) public void testDFSGetCanonicalServiceName() throws Exception {
  URI hAUri=HATestUtil.getLogicalUri(cluster);
  String haService=HAUtilClient.buildTokenServiceForLogicalUri(hAUri,HdfsConstants.HDFS_URI_SCHEME).toString();
  assertEquals(haService,dfs.getCanonicalServiceName());
  final String renewer=UserGroupInformation.getCurrentUser().getShortUserName();
  final Token<DelegationTokenIdentifier> token=getDelegationToken(dfs,renewer);
  assertEquals(haService,token.getService().toString());
  token.renew(dfs.getConf());
  token.cancel(dfs.getConf());
}
