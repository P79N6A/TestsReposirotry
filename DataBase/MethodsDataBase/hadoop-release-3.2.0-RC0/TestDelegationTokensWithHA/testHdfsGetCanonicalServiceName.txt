@Test(timeout=300000) public void testHdfsGetCanonicalServiceName() throws Exception {
  Configuration conf=dfs.getConf();
  URI haUri=HATestUtil.getLogicalUri(cluster);
  AbstractFileSystem afs=AbstractFileSystem.createFileSystem(haUri,conf);
  String haService=HAUtilClient.buildTokenServiceForLogicalUri(haUri,HdfsConstants.HDFS_URI_SCHEME).toString();
  assertEquals(haService,afs.getCanonicalServiceName());
  Token<?> token=afs.getDelegationTokens(UserGroupInformation.getCurrentUser().getShortUserName()).get(0);
  assertEquals(haService,token.getService().toString());
  token.renew(conf);
  token.cancel(conf);
}
