@Test public void testRenameDirectoryCopyTaskPartialFailed() throws Exception {
  assumeTrue(renameSupported());
  Path srcOne=this.path("/test/hadoop/file/1");
  this.createFile(srcOne);
  Path dstOne=new Path("1");
  Path dstTwo=new Path("/test/new/file/2");
  Path dstThree=new Path("3");
  AliyunOSSCopyFileContext copyFileContext=new AliyunOSSCopyFileContext();
  AliyunOSSFileSystemStore store=((AliyunOSSFileSystem)this.fs).getStore();
  AliyunOSSCopyFileTask oneCopyFileTask=new AliyunOSSCopyFileTask(store,srcOne.toUri().getPath().substring(1),dstOne.toUri().getPath().substring(1),copyFileContext);
  oneCopyFileTask.run();
  assumeTrue(copyFileContext.isCopyFailure());
  AliyunOSSCopyFileTask twoCopyFileTask=new AliyunOSSCopyFileTask(store,srcOne.toUri().getPath().substring(1),dstTwo.toUri().getPath().substring(1),copyFileContext);
  twoCopyFileTask.run();
  assumeTrue(copyFileContext.isCopyFailure());
  AliyunOSSCopyFileTask threeCopyFileTask=new AliyunOSSCopyFileTask(store,srcOne.toUri().getPath().substring(1),dstThree.toUri().getPath().substring(1),copyFileContext);
  threeCopyFileTask.run();
  assumeTrue(copyFileContext.isCopyFailure());
  copyFileContext.lock();
  try {
    copyFileContext.awaitAllFinish(3);
  }
 catch (  InterruptedException e) {
    throw new Exception(e);
  }
 finally {
    copyFileContext.unlock();
  }
  assumeTrue(copyFileContext.isCopyFailure());
}
