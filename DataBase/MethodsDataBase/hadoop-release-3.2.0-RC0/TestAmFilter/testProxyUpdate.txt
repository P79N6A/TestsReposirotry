@Test(timeout=2000) public void testProxyUpdate() throws Exception {
  Map<String,String> params=new HashMap<>();
  params.put(AmIpFilter.PROXY_HOSTS,proxyHost);
  params.put(AmIpFilter.PROXY_URI_BASES,proxyUri);
  FilterConfig conf=new DummyFilterConfig(params);
  AmIpFilter filter=new AmIpFilter();
  int updateInterval=1000;
  AmIpFilter.setUpdateInterval(updateInterval);
  filter.init(conf);
  filter.getProxyAddresses();
  assertTrue(filter.getProxyAddresses().contains("127.0.0.1"));
  params=new HashMap<>();
  params.put(AmIpFilter.PROXY_HOSTS,"unknownhost");
  params.put(AmIpFilter.PROXY_URI_BASES,proxyUri);
  conf=new DummyFilterConfig(params);
  filter.init(conf);
  assertFalse(filter.getProxyAddresses().isEmpty());
  GenericTestUtils.waitFor(new Supplier<Boolean>(){
    @Override public Boolean get(){
      try {
        return filter.getProxyAddresses().isEmpty();
      }
 catch (      ServletException e) {
        return true;
      }
    }
  }
,500,updateInterval);
}
