@Test public void testStickyBitRecursiveDeleteDir() throws Exception {
  Path root=new Path("/" + GenericTestUtils.getMethodName());
  Path tmp=new Path(root,"tmp");
  Path dir=new Path(tmp,"dir");
  Path file=new Path(dir,"file");
  hdfs.mkdirs(tmp);
  hdfs.setPermission(root,new FsPermission((short)0777));
  hdfs.setPermission(tmp,new FsPermission((short)01777));
  hdfsAsUser1.mkdirs(dir);
  hdfsAsUser1.setPermission(dir,new FsPermission((short)0777));
  writeFile(hdfsAsUser1,file);
  hdfs.setPermission(file,new FsPermission((short)0666));
  try {
    hdfsAsUser2.delete(tmp,true);
    fail("Non-owner can not delete a directory protected by sticky bit" + " recursively");
  }
 catch (  AccessControlException e) {
    GenericTestUtils.assertExceptionContains(FSExceptionMessages.PERMISSION_DENIED_BY_STICKY_BIT,e);
  }
  hdfsAsUser1.delete(tmp,true);
}
