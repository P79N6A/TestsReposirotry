@Test public void testLocklessBlockPoolId() throws Exception {
  BPOfferService bpos=Mockito.spy(setupBPOSForNNs(mockNN1));
  assertNull(bpos.getBlockPoolId());
  Mockito.verify(bpos).readLock();
  Mockito.reset(bpos);
  NamespaceInfo nsInfo=new NamespaceInfo(1,FAKE_CLUSTERID,FAKE_BPID,0);
  assertNull(bpos.setNamespaceInfo(nsInfo));
  assertEquals(FAKE_BPID,bpos.getBlockPoolId());
  Mockito.verify(bpos,Mockito.never()).readLock();
  Mockito.reset(bpos);
  assertEquals(nsInfo,bpos.setNamespaceInfo(null));
  assertNull(bpos.getBlockPoolId());
  Mockito.verify(bpos).readLock();
  Mockito.reset(bpos);
  assertNull(bpos.setNamespaceInfo(nsInfo));
  assertEquals(FAKE_BPID,bpos.getBlockPoolId());
  Mockito.verify(bpos,Mockito.never()).readLock();
}
