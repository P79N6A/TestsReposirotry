@Test public void testNNHAStateUpdateFromVersionRequest() throws Exception {
  final BPOfferService bpos=setupBPOSForNNs(mockNN1,mockNN2);
  Mockito.doReturn(true).when(mockDn).areHeartbeatsDisabledForTests();
  BPServiceActor actor=bpos.getBPServiceActors().get(0);
  bpos.start();
  waitForInitialization(bpos);
  assertNull(bpos.getActiveNN());
  NamespaceInfo nsInfo=mockNN1.versionRequest();
  bpos.verifyAndSetNamespaceInfo(actor,nsInfo);
  assertNull(bpos.getActiveNN());
  Mockito.doReturn(new NamespaceInfo(1,FAKE_CLUSTERID,FAKE_BPID,0,HAServiceState.ACTIVE)).when(mockNN1).versionRequest();
  nsInfo=mockNN1.versionRequest();
  bpos.verifyAndSetNamespaceInfo(actor,nsInfo);
  assertNotNull(bpos.getActiveNN());
}
