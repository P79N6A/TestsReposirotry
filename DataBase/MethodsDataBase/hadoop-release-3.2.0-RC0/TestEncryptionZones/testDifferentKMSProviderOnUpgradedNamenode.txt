/** 
 * This test makes sure the client gets the key provider uri from namenode instead of its own conf. This test assumes both the namenode and client are upgraded.
 * @throws Exception
 */
@Test public void testDifferentKMSProviderOnUpgradedNamenode() throws Exception {
  Configuration clusterConf=cluster.getConfiguration(0);
  URI namenodeKeyProviderUri=URI.create(getKeyProviderURI());
  Assert.assertEquals("Key Provider for client and namenode are different",namenodeKeyProviderUri,cluster.getFileSystem().getClient().getKeyProviderUri());
  clusterConf.unset(CommonConfigurationKeysPublic.HADOOP_SECURITY_KEY_PROVIDER_PATH);
  Assert.assertEquals("Key Provider for client and namenode are different",namenodeKeyProviderUri,cluster.getFileSystem().getClient().getKeyProviderUri());
  clusterConf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_KEY_PROVIDER_PATH,"dummy://foo:bar@test_provider1");
  Assert.assertEquals("Key Provider for client and namenode are different",namenodeKeyProviderUri,cluster.getFileSystem().getClient().getKeyProviderUri());
}
