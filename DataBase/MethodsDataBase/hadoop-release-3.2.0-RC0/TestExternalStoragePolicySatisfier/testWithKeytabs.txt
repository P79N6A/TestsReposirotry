/** 
 * Test SPS runs fine when logging in with a keytab in kerberized env. Reusing testWhenStoragePolicySetToALLSSD here for basic functionality testing.
 */
@Test(timeout=300000) public void testWithKeytabs() throws Exception {
  try {
    initSecureConf(getConf());
    final UserGroupInformation ugi=UserGroupInformation.loginUserFromKeytabAndReturnUGI(principal,keytabFile.getAbsolutePath());
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        testWhenStoragePolicySetToALLSSD();
        Assert.assertTrue(UserGroupInformation.isLoginKeytabBased());
        return null;
      }
    }
);
  }
  finally {
    UserGroupInformation.reset();
    UserGroupInformation.setConfiguration(new Configuration());
  }
}
