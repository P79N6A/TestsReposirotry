/** 
 * If replica with expected storage type already exist in source DN then that DN should be skipped.
 */
@Test(timeout=300000) public void testSPSWhenReplicaWithExpectedStorageAlreadyAvailableInSource() throws Exception {
  StorageType[][] diskTypes=new StorageType[][]{{StorageType.DISK,StorageType.ARCHIVE},{StorageType.DISK,StorageType.ARCHIVE},{StorageType.DISK,StorageType.ARCHIVE}};
  try {
    hdfsCluster=startCluster(config,diskTypes,diskTypes.length,STORAGES_PER_DATANODE,CAPACITY);
    dfs=hdfsCluster.getFileSystem();
    DFSTestUtil.createFile(dfs,new Path(FILE),DEFAULT_BLOCK_SIZE,(short)2,0);
    dfs.setStoragePolicy(new Path(FILE),"COLD");
    dfs.setReplication(new Path(FILE),(short)3);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,2,30000,dfs);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.ARCHIVE,1,30000,dfs);
    dfs.setStoragePolicy(new Path(FILE),"HOT");
    dfs.satisfyStoragePolicy(new Path(FILE));
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,3,30000,dfs);
  }
  finally {
    shutdownCluster();
  }
}
