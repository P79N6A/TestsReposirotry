/** 
 * Tests to verify hdfsAdmin.satisfyStoragePolicy works well for file.
 * @throws Exception
 */
@Test(timeout=300000) public void testSatisfyFileWithHdfsAdmin() throws Exception {
  try {
    createCluster();
    HdfsAdmin hdfsAdmin=new HdfsAdmin(FileSystem.getDefaultUri(config),config);
    dfs.setStoragePolicy(new Path(FILE),COLD);
    StorageType[][] newtypes=new StorageType[][]{{StorageType.DISK,StorageType.ARCHIVE},{StorageType.DISK,StorageType.ARCHIVE},{StorageType.DISK,StorageType.ARCHIVE}};
    startAdditionalDNs(config,3,NUM_OF_DATANODES,newtypes,STORAGES_PER_DATANODE,CAPACITY,hdfsCluster);
    hdfsAdmin.satisfyStoragePolicy(new Path(FILE));
    hdfsCluster.triggerHeartbeats();
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.ARCHIVE,3,30000,dfs);
  }
  finally {
    shutdownCluster();
  }
}
