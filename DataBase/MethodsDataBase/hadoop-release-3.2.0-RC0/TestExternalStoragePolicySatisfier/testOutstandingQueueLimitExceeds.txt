/** 
 * Test verifies that SPS call will throw exception if the call Q exceeds OutstandingQueueLimit value.
 * @throws Exception
 */
@Test(timeout=300000) public void testOutstandingQueueLimitExceeds() throws Exception {
  try {
    getConf().setInt(DFS_SPS_MAX_OUTSTANDING_PATHS_KEY,3);
    createCluster();
    List<String> files=new ArrayList<>();
    files.add(FILE);
    DistributedFileSystem fs=getFS();
    externalSps.stopGracefully();
    for (int i=0; i < 3; i++) {
      String file1="/testOutstandingQueueLimitExceeds_" + i;
      files.add(file1);
      writeContent(file1);
      fs.satisfyStoragePolicy(new Path(file1));
    }
    String fileExceeds="/testOutstandingQueueLimitExceeds_" + 4;
    files.add(fileExceeds);
    writeContent(fileExceeds);
    try {
      fs.satisfyStoragePolicy(new Path(fileExceeds));
      Assert.fail("Should throw exception as it exceeds " + "outstanding SPS call Q limit");
    }
 catch (    IOException ioe) {
      GenericTestUtils.assertExceptionContains("Outstanding satisfier queue limit: 3 exceeded, try later!",ioe);
    }
  }
  finally {
    shutdownCluster();
  }
}
