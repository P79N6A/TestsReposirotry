/** 
 * Tests that moving block storage with in the same datanode. Let's say we have DN1[DISK,ARCHIVE], DN2[DISK, SSD], DN3[DISK,RAM_DISK] when storagepolicy set to ONE_SSD and request satisfyStoragePolicy, then block should move to DN2[SSD] successfully.
 */
@Test(timeout=300000) public void testBlockMoveInSameDatanodeWithONESSD() throws Exception {
  StorageType[][] diskTypes=new StorageType[][]{{StorageType.DISK,StorageType.ARCHIVE},{StorageType.DISK,StorageType.SSD},{StorageType.DISK,StorageType.RAM_DISK}};
  config.setLong("dfs.block.size",DEFAULT_BLOCK_SIZE);
  try {
    hdfsCluster=startCluster(config,diskTypes,NUM_OF_DATANODES,STORAGES_PER_DATANODE,CAPACITY);
    dfs=hdfsCluster.getFileSystem();
    writeContent(FILE);
    dfs.setStoragePolicy(new Path(FILE),ONE_SSD);
    dfs.satisfyStoragePolicy(new Path(FILE));
    hdfsCluster.triggerHeartbeats();
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.SSD,1,30000,dfs);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,2,30000,dfs);
  }
  finally {
    shutdownCluster();
  }
}
