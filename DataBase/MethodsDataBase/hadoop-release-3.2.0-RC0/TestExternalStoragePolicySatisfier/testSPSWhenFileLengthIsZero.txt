/** 
 * Test SPS with empty file. 1. Create one empty file. 2. Call satisfyStoragePolicy for empty file. 3. SPS should skip this file and xattr should not be added for empty file.
 */
@Test(timeout=300000) public void testSPSWhenFileLengthIsZero() throws Exception {
  try {
    hdfsCluster=startCluster(config,allDiskTypes,NUM_OF_DATANODES,STORAGES_PER_DATANODE,CAPACITY);
    hdfsCluster.waitActive();
    DistributedFileSystem fs=hdfsCluster.getFileSystem();
    Path filePath=new Path("/zeroSizeFile");
    DFSTestUtil.createFile(fs,filePath,0,(short)1,0);
    FSEditLog editlog=hdfsCluster.getNameNode().getNamesystem().getEditLog();
    long lastWrittenTxId=editlog.getLastWrittenTxId();
    fs.satisfyStoragePolicy(filePath);
    Assert.assertEquals("Xattr should not be added for the file",lastWrittenTxId,editlog.getLastWrittenTxId());
    INode inode=hdfsCluster.getNameNode().getNamesystem().getFSDirectory().getINode(filePath.toString());
    Assert.assertTrue("XAttrFeature should be null for file",inode.getXAttrFeature() == null);
  }
  finally {
    shutdownCluster();
  }
}
