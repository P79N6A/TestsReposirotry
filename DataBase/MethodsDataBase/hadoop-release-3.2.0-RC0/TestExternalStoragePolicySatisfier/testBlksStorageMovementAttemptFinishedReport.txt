/** 
 * Tests to verify that the block storage movement report will be propagated to Namenode via datanode heartbeat.
 */
@Test(timeout=300000) public void testBlksStorageMovementAttemptFinishedReport() throws Exception {
  try {
    createCluster();
    dfs.setStoragePolicy(new Path(FILE),ONE_SSD);
    StorageType[][] newtypes=new StorageType[][]{{StorageType.SSD,StorageType.DISK}};
    startAdditionalDNs(config,1,NUM_OF_DATANODES,newtypes,STORAGES_PER_DATANODE,CAPACITY,hdfsCluster);
    dfs.satisfyStoragePolicy(new Path(FILE));
    hdfsCluster.triggerHeartbeats();
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.SSD,1,30000,dfs);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,2,30000,dfs);
    waitForBlocksMovementAttemptReport(1,30000);
  }
  finally {
    shutdownCluster();
  }
}
