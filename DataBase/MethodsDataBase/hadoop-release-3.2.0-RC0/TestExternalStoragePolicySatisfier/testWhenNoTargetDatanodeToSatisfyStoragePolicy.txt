/** 
 * Tests to verify that for the given path, no blocks or block src locations(src nodes) under the given path will be scheduled for block movement as there are no available datanode with required storage type. For example, there are two block for a file: File1 => blk_1[locations=A(DISK),B(DISK),C(DISK)], blk_2[locations=A(DISK),B(DISK),C(DISK)]. Now, set storage policy to COLD. No datanode is available with storage type ARCHIVE. SPS won't schedule any block movement for this path.
 */
@Test(timeout=300000) public void testWhenNoTargetDatanodeToSatisfyStoragePolicy() throws Exception {
  try {
    createCluster();
    dfs.setStoragePolicy(new Path(FILE),COLD);
    StorageType[][] newtypes=new StorageType[][]{{StorageType.DISK,StorageType.DISK}};
    startAdditionalDNs(config,1,NUM_OF_DATANODES,newtypes,STORAGES_PER_DATANODE,CAPACITY,hdfsCluster);
    dfs.satisfyStoragePolicy(new Path(FILE));
    hdfsCluster.triggerHeartbeats();
    waitForAttemptedItems(1,30000);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,3,30000,dfs);
    waitForAttemptedItems(1,30000);
  }
  finally {
    shutdownCluster();
  }
}
