/** 
 * Tests that moving block storage with in the same datanode and remote node. Let's say we have DN1[DISK,ARCHIVE], DN2[ARCHIVE, SSD], DN3[DISK,DISK], DN4[DISK,DISK] when storagepolicy set to WARM and request satisfyStoragePolicy, then block should move to DN1[ARCHIVE] and DN2[ARCHIVE] successfully.
 */
@Test(timeout=300000) public void testBlockMoveInSameAndRemoteDatanodesWithWARM() throws Exception {
  StorageType[][] diskTypes=new StorageType[][]{{StorageType.DISK,StorageType.ARCHIVE},{StorageType.ARCHIVE,StorageType.SSD},{StorageType.DISK,StorageType.DISK},{StorageType.DISK,StorageType.DISK}};
  config.setLong("dfs.block.size",DEFAULT_BLOCK_SIZE);
  try {
    hdfsCluster=startCluster(config,diskTypes,diskTypes.length,STORAGES_PER_DATANODE,CAPACITY);
    dfs=hdfsCluster.getFileSystem();
    writeContent(FILE);
    dfs.setStoragePolicy(new Path(FILE),"WARM");
    dfs.satisfyStoragePolicy(new Path(FILE));
    hdfsCluster.triggerHeartbeats();
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.DISK,1,30000,dfs);
    DFSTestUtil.waitExpectedStorageType(FILE,StorageType.ARCHIVE,2,30000,dfs);
  }
  finally {
    shutdownCluster();
  }
}
