/** 
 * Test SPS for directory which has multilevel directories.
 */
@Test(timeout=300000) public void testMultipleLevelDirectoryForSatisfyStoragePolicy() throws Exception {
  try {
    StorageType[][] diskTypes=new StorageType[][]{{StorageType.DISK,StorageType.ARCHIVE},{StorageType.ARCHIVE,StorageType.SSD},{StorageType.DISK,StorageType.DISK}};
    config.setLong("dfs.block.size",DEFAULT_BLOCK_SIZE);
    hdfsCluster=startCluster(config,diskTypes,diskTypes.length,STORAGES_PER_DATANODE,CAPACITY);
    dfs=hdfsCluster.getFileSystem();
    createDirectoryTree(dfs);
    List<String> files=getDFSListOfTree();
    dfs.setStoragePolicy(new Path("/root"),COLD);
    dfs.satisfyStoragePolicy(new Path("/root"));
    for (    String fileName : files) {
      DFSTestUtil.waitExpectedStorageType(fileName,StorageType.ARCHIVE,2,30000,dfs);
    }
  }
  finally {
    shutdownCluster();
  }
}
