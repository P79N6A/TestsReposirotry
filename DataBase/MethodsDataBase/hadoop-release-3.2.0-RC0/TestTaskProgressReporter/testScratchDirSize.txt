@Test(timeout=60000) public void testScratchDirSize() throws Exception {
  String tmpPath=TEST_DIR + "/testBytesWrittenLimit-tmpFile-" + new Random(System.currentTimeMillis()).nextInt();
  File data=new File(tmpPath + "/out");
  File testDir=new File(tmpPath);
  testDir.mkdirs();
  testDir.deleteOnExit();
  JobConf conf=new JobConf();
  conf.setStrings(MRConfig.LOCAL_DIR,"file://" + tmpPath);
  conf.setLong(MRJobConfig.JOB_SINGLE_DISK_LIMIT_BYTES,1024L);
  conf.setBoolean(MRJobConfig.JOB_SINGLE_DISK_LIMIT_KILL_LIMIT_EXCEED,true);
  getBaseConfAndWriteToFile(-1,data);
  testScratchDirLimit(false,conf);
  data.delete();
  getBaseConfAndWriteToFile(100,data);
  testScratchDirLimit(false,conf);
  data.delete();
  getBaseConfAndWriteToFile(1536,data);
  testScratchDirLimit(true,conf);
  conf.setBoolean(MRJobConfig.JOB_SINGLE_DISK_LIMIT_KILL_LIMIT_EXCEED,false);
  testScratchDirLimit(false,conf);
  conf.setBoolean(MRJobConfig.JOB_SINGLE_DISK_LIMIT_KILL_LIMIT_EXCEED,true);
  conf.setLong(MRJobConfig.JOB_SINGLE_DISK_LIMIT_BYTES,-1L);
  testScratchDirLimit(false,conf);
  data.delete();
  FileUtil.fullyDelete(testDir);
}
