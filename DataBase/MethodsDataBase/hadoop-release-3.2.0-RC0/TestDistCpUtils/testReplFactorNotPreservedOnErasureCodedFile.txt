@Test(timeout=60000) public void testReplFactorNotPreservedOnErasureCodedFile() throws Exception {
  FileSystem fs=FileSystem.get(config);
  Path srcECDir=new Path("/tmp/srcECDir");
  Path srcECFile=new Path(srcECDir,"srcECFile");
  Path dstReplDir=new Path("/tmp/dstReplDir");
  Path dstReplFile=new Path(dstReplDir,"destReplFile");
  fs.mkdirs(srcECDir);
  fs.mkdirs(dstReplDir);
  String[] args={"-setPolicy","-path","/tmp/srcECDir","-policy","XOR-2-1-1024k"};
  int res=ToolRunner.run(config,new ECAdmin(config),args);
  assertEquals("Setting EC policy should succeed!",0,res);
  verifyReplFactorNotPreservedOnErasureCodedFile(srcECFile,true,dstReplFile,false);
  Path srcReplDir=new Path("/tmp/srcReplDir");
  Path srcReplFile=new Path(srcReplDir,"srcReplFile");
  Path dstECDir=new Path("/tmp/dstECDir");
  Path dstECFile=new Path(dstECDir,"destECFile");
  fs.mkdirs(srcReplDir);
  fs.mkdirs(dstECDir);
  args=new String[]{"-setPolicy","-path","/tmp/dstECDir","-policy","XOR-2-1-1024k"};
  res=ToolRunner.run(config,new ECAdmin(config),args);
  assertEquals("Setting EC policy should succeed!",0,res);
  verifyReplFactorNotPreservedOnErasureCodedFile(srcReplFile,false,dstECFile,true);
  verifyReplFactorNotPreservedOnErasureCodedFile(srcECFile,true,dstECFile,true);
}
