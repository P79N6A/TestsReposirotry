@Test public void testMultipleAppends() throws Throwable {
  int baseDataSize=50;
  byte[] baseDataBuffer=createBaseFileWithData(baseDataSize,testPath);
  int appendDataSize=100;
  int targetAppendCount=50;
  byte[] testData=new byte[baseDataSize + (appendDataSize * targetAppendCount)];
  int testDataIndex=0;
  System.arraycopy(baseDataBuffer,0,testData,testDataIndex,baseDataSize);
  testDataIndex+=baseDataSize;
  int appendCount=0;
  FSDataOutputStream appendStream=null;
  try {
    while (appendCount < targetAppendCount) {
      byte[] appendDataBuffer=getTestData(appendDataSize);
      appendStream=fs.append(testPath,30);
      appendStream.write(appendDataBuffer);
      appendStream.close();
      System.arraycopy(appendDataBuffer,0,testData,testDataIndex,appendDataSize);
      testDataIndex+=appendDataSize;
      appendCount++;
    }
    assertTrue(verifyAppend(testData,testPath));
  }
  finally {
    if (appendStream != null) {
      appendStream.close();
    }
  }
}
