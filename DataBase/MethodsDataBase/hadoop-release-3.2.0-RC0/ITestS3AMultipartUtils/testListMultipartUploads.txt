/** 
 * Main test case for upload part listing and iterator paging.
 * @throws Exception on failure.
 */
@Test public void testListMultipartUploads() throws Exception {
  S3AFileSystem fs=getFileSystem();
  Set<MultipartTestUtils.IdKey> keySet=new HashSet<>();
  try {
    for (int i=0; i < NUM_KEYS; i++) {
      Path filePath=getPartFilename(i);
      String key=fs.pathToKey(filePath);
      describe("creating upload part with key %s",key);
      MultipartTestUtils.IdKey idKey=MultipartTestUtils.createPartUpload(fs,key,UPLOAD_LEN,1);
      keySet.add(idKey);
    }
    describe("Verifying upload list by prefix");
    MultipartUtils.UploadIterator uploads=fs.listUploads(getPartPrefix(fs));
    assertUploadsPresent(uploads,keySet);
    describe("Verifying list all uploads");
    uploads=fs.listUploads(null);
    assertUploadsPresent(uploads,keySet);
  }
  finally {
    MultipartTestUtils.cleanupParts(fs,keySet);
  }
}
