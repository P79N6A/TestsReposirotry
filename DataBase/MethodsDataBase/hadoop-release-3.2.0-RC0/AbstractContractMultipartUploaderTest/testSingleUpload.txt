/** 
 * Assert that a multipart upload is successful.
 * @throws Exception failure
 */
@Test public void testSingleUpload() throws Exception {
  FileSystem fs=getFileSystem();
  Path file=path("testSingleUpload");
  MultipartUploader mpu=MultipartUploaderFactory.get(fs,null);
  UploadHandle uploadHandle=mpu.initialize(file);
  List<Pair<Integer,PartHandle>> partHandles=new ArrayList<>();
  MessageDigest origDigest=DigestUtils.getMd5Digest();
  byte[] payload=generatePayload(1);
  origDigest.update(payload);
  InputStream is=new ByteArrayInputStream(payload);
  PartHandle partHandle=mpu.putPart(file,is,1,uploadHandle,payload.length);
  partHandles.add(Pair.of(1,partHandle));
  PathHandle fd=completeUpload(file,mpu,uploadHandle,partHandles,origDigest,payload.length);
  PathHandle fd2=mpu.complete(file,partHandles,uploadHandle);
  assertArrayEquals("Path handles differ",fd.toByteArray(),fd2.toByteArray());
}
