/** 
 * Assert that a multipart upload is successful even when the parts are given in reverse order and the part numbers are not contiguous.
 */
@Test public void testMultipartUploadReverseOrderNonContiguousPartNumbers() throws Exception {
  describe("Upload in reverse order and the part numbers are not contiguous");
  FileSystem fs=getFileSystem();
  Path file=path("testMultipartUploadReverseOrderNonContiguousPartNumbers");
  MultipartUploader mpu=MultipartUploaderFactory.get(fs,null);
  UploadHandle uploadHandle=mpu.initialize(file);
  List<Pair<Integer,PartHandle>> partHandles=new ArrayList<>();
  MessageDigest origDigest=DigestUtils.getMd5Digest();
  int payloadCount=2 * getTestPayloadCount();
  for (int i=2; i <= payloadCount; i+=2) {
    byte[] payload=generatePayload(i);
    origDigest.update(payload);
  }
  for (int i=payloadCount; i > 0; i-=2) {
    byte[] payload=generatePayload(i);
    InputStream is=new ByteArrayInputStream(payload);
    PartHandle partHandle=mpu.putPart(file,is,i,uploadHandle,payload.length);
    partHandles.add(Pair.of(i,partHandle));
  }
  completeUpload(file,mpu,uploadHandle,partHandles,origDigest,getTestPayloadCount() * partSizeInBytes());
}
