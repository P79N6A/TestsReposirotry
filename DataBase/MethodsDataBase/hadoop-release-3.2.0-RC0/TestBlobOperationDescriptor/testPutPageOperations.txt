@Test public void testPutPageOperations() throws Exception {
  CloudBlobContainer container=getTestAccount().getRealContainer();
  OperationContext context=new OperationContext();
  context.getResponseReceivedEventHandler().addListener(new ResponseReceivedEventHandler());
  context.getSendingRequestEventHandler().addListener(new SendingRequestEventHandler());
  CloudPageBlob pageBlob=container.getPageBlobReference("testPutPageOperations");
  assertNull(lastOperationTypeSent);
  assertNull(lastOperationTypeReceived);
  assertEquals(0,lastContentLengthReceived);
  try (BlobOutputStream output=pageBlob.openWriteNew(1024,null,null,context)){
    assertEquals(BlobOperationDescriptor.OperationType.CreateBlob,lastOperationTypeReceived);
    assertEquals(0,lastContentLengthReceived);
    final int pageSize=512;
    byte[] buffer=new byte[pageSize];
    output.write(buffer);
    output.flush();
    assertEquals(BlobOperationDescriptor.OperationType.PutPage,lastOperationTypeSent);
    assertEquals(BlobOperationDescriptor.OperationType.PutPage,lastOperationTypeReceived);
    assertEquals(buffer.length,lastContentLengthReceived);
  }
 }
