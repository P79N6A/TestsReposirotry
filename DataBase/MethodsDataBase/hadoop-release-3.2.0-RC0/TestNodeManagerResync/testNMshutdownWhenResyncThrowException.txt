@SuppressWarnings("resource") @Test(timeout=10000) public void testNMshutdownWhenResyncThrowException() throws IOException, InterruptedException, YarnException {
  NodeManager nm=new TestNodeManager3();
  YarnConfiguration conf=createNMConfig();
  try {
    nm.init(conf);
    nm.start();
    Assert.assertEquals(1,((TestNodeManager3)nm).getNMRegistrationCount());
    nm.getNMDispatcher().getEventHandler().handle(new NodeManagerEvent(NodeManagerEventType.RESYNC));
synchronized (isNMShutdownCalled) {
      while (!isNMShutdownCalled.get()) {
        try {
          isNMShutdownCalled.wait();
        }
 catch (        InterruptedException e) {
        }
      }
    }
    Assert.assertTrue("NM shutdown not called.",isNMShutdownCalled.get());
  }
  finally {
    nm.stop();
  }
}
