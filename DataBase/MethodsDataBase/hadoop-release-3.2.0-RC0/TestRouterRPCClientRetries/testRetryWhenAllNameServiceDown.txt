@Test public void testRetryWhenAllNameServiceDown() throws Exception {
  MiniDFSCluster dfsCluster=cluster.getCluster();
  dfsCluster.shutdown();
  registerInvalidNameReport();
  String dirPath="/testRetryWhenClusterisDown";
  FsPermission permission=new FsPermission("705");
  try {
    routerProtocol.mkdirs(dirPath,permission,false);
    fail("Should have thrown RemoteException error.");
  }
 catch (  RemoteException e) {
    String ns0=cluster.getNameservices().get(0);
    assertExceptionContains("No namenode available under nameservice " + ns0,e);
  }
  FederationRPCMetrics rpcMetrics=routerContext.getRouter().getRpcServer().getRPCMetrics();
  assertEquals(1,rpcMetrics.getProxyOpRetries());
}
