/** 
 * Test  {@link DFSStripedInputStream#getBlockAt(long)}.
 */
@Test public void testRefreshBlock() throws Exception {
  final int numBlocks=4;
  DFSTestUtil.createStripedFile(cluster,filePath,null,numBlocks,stripesPerBlock,false,ecPolicy);
  LocatedBlocks lbs=fs.getClient().namenode.getBlockLocations(filePath.toString(),0,blockGroupSize * numBlocks);
  final DFSStripedInputStream in=new DFSStripedInputStream(fs.getClient(),filePath.toString(),false,ecPolicy,null);
  List<LocatedBlock> lbList=lbs.getLocatedBlocks();
  for (  LocatedBlock aLbList : lbList) {
    LocatedStripedBlock lsb=(LocatedStripedBlock)aLbList;
    LocatedBlock[] blks=StripedBlockUtil.parseStripedBlockGroup(lsb,cellSize,dataBlocks,parityBlocks);
    for (int j=0; j < dataBlocks; j++) {
      LocatedBlock refreshed=in.refreshLocatedBlock(blks[j]);
      assertEquals(blks[j].getBlock(),refreshed.getBlock());
      assertEquals(blks[j].getStartOffset(),refreshed.getStartOffset());
      assertArrayEquals(blks[j].getLocations(),refreshed.getLocations());
    }
  }
}
