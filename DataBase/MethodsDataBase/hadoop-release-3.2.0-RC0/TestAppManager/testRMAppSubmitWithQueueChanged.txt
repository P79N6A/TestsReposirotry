@Test public void testRMAppSubmitWithQueueChanged() throws Exception {
  PlacementManager placementMgr=mock(PlacementManager.class);
  doAnswer(new Answer<ApplicationPlacementContext>(){
    @Override public ApplicationPlacementContext answer(    InvocationOnMock invocation) throws Throwable {
      return new ApplicationPlacementContext("newQueue");
    }
  }
).when(placementMgr).placeApplication(any(ApplicationSubmissionContext.class),any(String.class));
  rmContext.setQueuePlacementManager(placementMgr);
  asContext.setQueue("oldQueue");
  appMonitor.submitApplication(asContext,"test");
  RMApp app=rmContext.getRMApps().get(appId);
  RMAppEvent event=new RMAppEvent(appId,RMAppEventType.START);
  rmContext.getRMApps().get(appId).handle(event);
  event=new RMAppEvent(appId,RMAppEventType.APP_NEW_SAVED);
  rmContext.getRMApps().get(appId).handle(event);
  Assert.assertNotNull("app is null",app);
  Assert.assertEquals("newQueue",asContext.getQueue());
  int timeoutSecs=0;
  while ((getAppEventType() == RMAppEventType.KILL) && timeoutSecs++ < 20) {
    Thread.sleep(1000);
  }
  Assert.assertEquals("app event type sent is wrong",RMAppEventType.START,getAppEventType());
}
