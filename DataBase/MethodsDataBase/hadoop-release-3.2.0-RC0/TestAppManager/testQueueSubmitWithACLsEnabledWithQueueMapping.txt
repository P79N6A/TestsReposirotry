@Test public void testQueueSubmitWithACLsEnabledWithQueueMapping() throws IOException, YarnException, InterruptedException {
  YarnConfiguration conf=new YarnConfiguration();
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration(conf,false);
  csConf.set(PREFIX + "root.queues","default,test");
  csConf.setFloat(PREFIX + "root.default.capacity",50.0f);
  csConf.setFloat(PREFIX + "root.default.maximum-capacity",100.0f);
  csConf.setFloat(PREFIX + "root.test.capacity",50.0f);
  csConf.setFloat(PREFIX + "root.test.maximum-capacity",100.0f);
  csConf.set(PREFIX + "root.acl_submit_applications"," ");
  csConf.set(PREFIX + "root.acl_administer_queue"," ");
  csConf.set(PREFIX + "root.default.acl_submit_applications"," ");
  csConf.set(PREFIX + "root.default.acl_administer_queue"," ");
  csConf.set(PREFIX + "root.test.acl_submit_applications","test");
  csConf.set(PREFIX + "root.test.acl_administer_queue","test");
  csConf.set(PREFIX + "root.test.acl_submit_applications","test");
  csConf.set(PREFIX + "root.test.acl_administer_queue","test");
  csConf.set(YarnConfiguration.YARN_ACL_ENABLE,"true");
  PlacementManager placementMgr=mock(PlacementManager.class);
  doAnswer(new Answer<ApplicationPlacementContext>(){
    @Override public ApplicationPlacementContext answer(    InvocationOnMock invocation) throws Throwable {
      return new ApplicationPlacementContext("test");
    }
  }
).when(placementMgr).placeApplication(any(ApplicationSubmissionContext.class),matches("test"));
  asContext.setQueue("oldQueue");
  MockRM newMockRM=new MockRM(conf);
  RMContext newMockRMContext=newMockRM.getRMContext();
  newMockRMContext.setQueuePlacementManager(placementMgr);
  ApplicationMasterService masterService=new ApplicationMasterService(newMockRMContext,newMockRMContext.getScheduler());
  TestRMAppManager newAppMonitor=new TestRMAppManager(newMockRMContext,new ClientToAMTokenSecretManagerInRM(),newMockRMContext.getScheduler(),masterService,new ApplicationACLsManager(conf),conf);
  newAppMonitor.submitApplication(asContext,"test");
  try {
    asContext.setApplicationId(appId=MockApps.newAppID(2));
    newAppMonitor.submitApplication(asContext,"test1");
  }
 catch (  YarnException e) {
    assertTrue(e.getCause() instanceof AccessControlException);
  }
}
