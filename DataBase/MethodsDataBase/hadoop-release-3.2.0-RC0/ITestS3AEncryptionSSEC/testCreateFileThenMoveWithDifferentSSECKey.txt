/** 
 * Ensures a file can't be created with keyA and then renamed with a different key. This is expected AWS S3 SSE-C behavior.
 * @throws Exception
 */
@Test public void testCreateFileThenMoveWithDifferentSSECKey() throws Exception {
  assumeEnabled();
  skipIfEncryptionTestsDisabled(getConfiguration());
  intercept(AccessDeniedException.class,SERVICE_AMAZON_S3_STATUS_CODE_403,() -> {
    int len=TEST_FILE_LEN;
    Path src=path(createFilename(len));
    writeThenReadFile(src,len);
    fsKeyB=createNewFileSystemWithSSECKey(KEY_3);
    Path dest=path(createFilename("different-path.txt"));
    getFileSystem().mkdirs(dest.getParent());
    return fsKeyB.rename(src,dest);
  }
);
}
