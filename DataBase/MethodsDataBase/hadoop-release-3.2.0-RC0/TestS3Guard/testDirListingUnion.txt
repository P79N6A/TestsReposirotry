/** 
 * Basic test to ensure results from S3 and MetadataStore are merged correctly.
 */
@Test public void testDirListingUnion() throws Exception {
  MetadataStore ms=new LocalMetadataStore();
  Path dirPath=new Path("s3a://bucket/dir");
  PathMetadata m1=makePathMeta("s3a://bucket/dir/ms-file1",false);
  PathMetadata m2=makePathMeta("s3a://bucket/dir/ms-file2",false);
  DirListingMetadata dirMeta=new DirListingMetadata(dirPath,Arrays.asList(m1,m2),false);
  List<FileStatus> s3Listing=Arrays.asList(makeFileStatus("s3a://bucket/dir/s3-file3",false),makeFileStatus("s3a://bucket/dir/s3-file4",false));
  FileStatus[] result=S3Guard.dirListingUnion(ms,dirPath,s3Listing,dirMeta,false);
  assertEquals("listing length",4,result.length);
  assertContainsPath(result,"s3a://bucket/dir/ms-file1");
  assertContainsPath(result,"s3a://bucket/dir/ms-file2");
  assertContainsPath(result,"s3a://bucket/dir/s3-file3");
  assertContainsPath(result,"s3a://bucket/dir/s3-file4");
}
