/** 
 * Test creates a file and closes it. The second datanode is started in the cluster. As soon as the replication process is completed test runs Block report and checks that no underreplicated blocks are left
 * @throws IOException in case of an error
 */
@Test(timeout=300000) public void blockReport_06() throws Exception {
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  Path filePath=new Path("/" + METHOD_NAME + ".dat");
  final int DN_N1=DN_N0 + 1;
  writeFile(METHOD_NAME,FILE_SIZE,filePath);
  startDNandWait(filePath,true);
  DataNode dn=cluster.getDataNodes().get(DN_N1);
  String poolId=cluster.getNamesystem().getBlockPoolId();
  DatanodeRegistration dnR=dn.getDNRegistrationForBP(poolId);
  StorageBlockReport[] reports=getBlockReports(dn,poolId,false,false);
  sendBlockReports(dnR,poolId,reports);
  printStats();
  assertEquals("Wrong number of PendingReplication Blocks",0,cluster.getNamesystem().getUnderReplicatedBlocks());
}
