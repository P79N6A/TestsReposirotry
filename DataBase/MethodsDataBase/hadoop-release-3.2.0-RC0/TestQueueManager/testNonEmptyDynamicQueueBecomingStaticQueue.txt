@Test public void testNonEmptyDynamicQueueBecomingStaticQueue(){
  AllocationConfiguration allocConf=scheduler.getAllocationConfiguration();
  queueManager.updateAllocationConfiguration(allocConf);
  FSLeafQueue q1=queueManager.getLeafQueue("root.leaf1",true);
  assertNotNull("Queue root.leaf1 was not created",q1);
  assertEquals("createQueue() returned wrong queue","root.leaf1",q1.getName());
  assertTrue("root.leaf1 is not a dynamic queue",q1.isDynamic());
  notEmptyQueues.add(q1);
  queueManager.removePendingIncompatibleQueues();
  queueManager.removeEmptyDynamicQueues();
  q1=queueManager.getLeafQueue("root.leaf1",false);
  assertNotNull("Queue root.leaf1 was deleted",q1);
  allocConf.configuredQueues.get(FSQueueType.LEAF).add("root.leaf1");
  queueManager.updateAllocationConfiguration(allocConf);
  assertFalse("root.leaf1 is not a static queue",q1.isDynamic());
  notEmptyQueues.clear();
  queueManager.removePendingIncompatibleQueues();
  queueManager.removeEmptyDynamicQueues();
  q1=queueManager.getLeafQueue("root.leaf1",false);
  assertNotNull("Queue root.leaf1 was deleted",q1);
  assertFalse("root.leaf1 is not a static queue",q1.isDynamic());
}
