/** 
 * Ensure that there is waiting (sleepDuration != 0) if the metrics have only been updated with failed requests.  Also ensure that the sleepDuration decreases over time.
 */
@Test public void testOnlyErrorsAndWaiting(){
  ClientThrottlingAnalyzer analyzer=new ClientThrottlingAnalyzer("test",ANALYSIS_PERIOD);
  validate(0,analyzer.getSleepDuration());
  analyzer.addBytesTransferred(4 * MEGABYTE,true);
  sleep(ANALYSIS_PERIOD_PLUS_10_PERCENT);
  final int expectedSleepDuration1=1100;
  validateLessThanOrEqual(expectedSleepDuration1,analyzer.getSleepDuration());
  sleep(10 * ANALYSIS_PERIOD);
  final int expectedSleepDuration2=900;
  validateLessThanOrEqual(expectedSleepDuration2,analyzer.getSleepDuration());
}
