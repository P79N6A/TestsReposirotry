@Test public void testInjectionNonEmpty() throws IOException {
  SimulatedFSDataset fsdataset=getSimulatedFSDataset();
  assertBlockReportCountAndSize(fsdataset,0);
  int bytesAdded=addSomeBlocks(fsdataset);
  assertBlockReportCountAndSize(fsdataset,NUMBLOCKS);
  assertBlockLengthInBlockReports(fsdataset);
  SimulatedFSDataset sfsdataset=getSimulatedFSDataset();
  bytesAdded+=addSomeBlocks(sfsdataset,NUMBLOCKS + 1,false);
  assertBlockReportCountAndSize(sfsdataset,NUMBLOCKS);
  injectBlocksFromBlockReport(fsdataset,sfsdataset);
  assertBlockReportCountAndSize(sfsdataset,NUMBLOCKS * 2);
  assertBlockLengthInBlockReports(fsdataset,sfsdataset);
  assertEquals(bytesAdded,sfsdataset.getDfsUsed());
  assertEquals(sfsdataset.getCapacity() - bytesAdded,sfsdataset.getRemaining());
  conf.setLong(SimulatedFSDataset.CONFIG_PROPERTY_CAPACITY,10);
  try {
    sfsdataset=getSimulatedFSDataset();
    sfsdataset.addBlockPool(bpid,conf);
    injectBlocksFromBlockReport(fsdataset,sfsdataset);
    assertTrue("Expected an IO exception",false);
  }
 catch (  IOException e) {
  }
}
