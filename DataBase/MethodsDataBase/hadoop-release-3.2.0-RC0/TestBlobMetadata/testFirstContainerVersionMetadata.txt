/** 
 * Tests that WASB works well with an older version container with ASV-era version and metadata.
 */
@Test public void testFirstContainerVersionMetadata() throws Exception {
  HashMap<String,String> containerMetadata=new HashMap<String,String>();
  containerMetadata.put(AzureNativeFileSystemStore.OLD_VERSION_METADATA_KEY,AzureNativeFileSystemStore.FIRST_WASB_VERSION);
  FsWithPreExistingContainer fsWithContainer=FsWithPreExistingContainer.create(containerMetadata);
  assertFalse(fsWithContainer.getFs().exists(new Path("/IDontExist")));
  assertEquals(0,fsWithContainer.getFs().listStatus(new Path("/")).length);
  assertEquals(AzureNativeFileSystemStore.FIRST_WASB_VERSION,fsWithContainer.getContainerMetadata().get(AzureNativeFileSystemStore.OLD_VERSION_METADATA_KEY));
  assertNull(fsWithContainer.getContainerMetadata().get(AzureNativeFileSystemStore.VERSION_METADATA_KEY));
  fsWithContainer.getFs().mkdirs(new Path("/dir"));
  assertEquals(AzureNativeFileSystemStore.CURRENT_WASB_VERSION,fsWithContainer.getContainerMetadata().get(AzureNativeFileSystemStore.VERSION_METADATA_KEY));
  assertNull(fsWithContainer.getContainerMetadata().get(AzureNativeFileSystemStore.OLD_VERSION_METADATA_KEY));
  fsWithContainer.close();
}
