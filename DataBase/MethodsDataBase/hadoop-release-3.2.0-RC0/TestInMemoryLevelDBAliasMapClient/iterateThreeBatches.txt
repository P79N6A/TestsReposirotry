@Test public void iterateThreeBatches() throws Exception {
  conf.set(DFSConfigKeys.DFS_PROVIDED_ALIASMAP_INMEMORY_BATCH_SIZE,"2");
  levelDBAliasMapServer.setConf(conf);
  levelDBAliasMapServer.start();
  inMemoryLevelDBAliasMapClient.setConf(conf);
  Block block1=new Block(42,43,44);
  Block block2=new Block(43,44,45);
  Block block3=new Block(44,45,46);
  Block block4=new Block(47,48,49);
  Block block5=new Block(50,51,52);
  Block block6=new Block(53,54,55);
  byte[] nonce1="blackbird".getBytes();
  byte[] nonce2="cuckoo".getBytes();
  byte[] nonce3="sparrow".getBytes();
  byte[] nonce4="magpie".getBytes();
  byte[] nonce5="seagull".getBytes();
  byte[] nonce6="finch".getBytes();
  ProvidedStorageLocation providedStorageLocation1=new ProvidedStorageLocation(new Path("eagle"),46,47,nonce1);
  ProvidedStorageLocation providedStorageLocation2=new ProvidedStorageLocation(new Path("falcon"),48,49,nonce2);
  ProvidedStorageLocation providedStorageLocation3=new ProvidedStorageLocation(new Path("robin"),50,51,nonce3);
  ProvidedStorageLocation providedStorageLocation4=new ProvidedStorageLocation(new Path("parakeet"),52,53,nonce4);
  ProvidedStorageLocation providedStorageLocation5=new ProvidedStorageLocation(new Path("heron"),54,55,nonce5);
  ProvidedStorageLocation providedStorageLocation6=new ProvidedStorageLocation(new Path("duck"),56,57,nonce6);
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block1,providedStorageLocation1));
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block2,providedStorageLocation2));
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block3,providedStorageLocation3));
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block4,providedStorageLocation4));
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block5,providedStorageLocation5));
  inMemoryLevelDBAliasMapClient.getWriter(null,BPID).store(new FileRegion(block6,providedStorageLocation6));
  BlockAliasMap.Reader<FileRegion> reader=inMemoryLevelDBAliasMapClient.getReader(null,BPID);
  List<FileRegion> actualFileRegions=Lists.newArrayListWithCapacity(6);
  for (  FileRegion fileRegion : reader) {
    actualFileRegions.add(fileRegion);
  }
  FileRegion[] expectedFileRegions=new FileRegion[]{new FileRegion(block1,providedStorageLocation1),new FileRegion(block2,providedStorageLocation2),new FileRegion(block3,providedStorageLocation3),new FileRegion(block4,providedStorageLocation4),new FileRegion(block5,providedStorageLocation5),new FileRegion(block6,providedStorageLocation6)};
  assertArrayEquals(expectedFileRegions,actualFileRegions.toArray());
}
