/** 
 * Machine under maintenance state won't be chosen for new block allocation.
 */
@Test(timeout=3600000) public void testWriteAfterMaintenance() throws IOException {
  LOG.info("Starting testWriteAfterMaintenance");
  startCluster(1,3);
  final Path file=new Path("/testWriteAfterMaintenance.dat");
  int replicas=3;
  final FileSystem fileSys=getCluster().getFileSystem(0);
  FSNamesystem ns=getCluster().getNamesystem(0);
  final DatanodeInfo nodeOutofService=takeNodeOutofService(0,null,Long.MAX_VALUE,null,AdminStates.IN_MAINTENANCE);
  writeFile(fileSys,file,replicas,2);
  checkWithRetry(ns,fileSys,file,replicas - 1,nodeOutofService,null);
  putNodeInService(0,nodeOutofService.getDatanodeUuid());
  checkWithRetry(ns,fileSys,file,replicas,null);
  cleanupFile(fileSys,file);
}
