/** 
 * Machine under maintenance state won't be chosen for invalidation.
 */
@Test(timeout=360000) public void testInvalidation() throws IOException {
  LOG.info("Starting testInvalidation");
  int numNamenodes=1;
  int numDatanodes=3;
  startCluster(numNamenodes,numDatanodes);
  Path file=new Path("/testInvalidation.dat");
  int replicas=3;
  FileSystem fileSys=getCluster().getFileSystem(0);
  FSNamesystem ns=getCluster().getNamesystem(0);
  writeFile(fileSys,file,replicas);
  DatanodeInfo nodeOutofService=takeNodeOutofService(0,null,Long.MAX_VALUE,null,AdminStates.IN_MAINTENANCE);
  DFSClient client=getDfsClient(0);
  client.setReplication(file.toString(),(short)1);
  checkWithRetry(ns,fileSys,file,1,nodeOutofService);
  getCluster().restartNameNode(0);
  ns=getCluster().getNamesystem(0);
  checkWithRetry(ns,fileSys,file,1,nodeOutofService);
  cleanupFile(fileSys,file);
}
