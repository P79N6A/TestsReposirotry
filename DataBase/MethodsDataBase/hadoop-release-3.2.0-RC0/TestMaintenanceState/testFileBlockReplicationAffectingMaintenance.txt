/** 
 * Test file block replication lesser than maintenance minimum.
 */
@Test(timeout=360000) public void testFileBlockReplicationAffectingMaintenance() throws Exception {
  int defaultReplication=getConf().getInt(DFSConfigKeys.DFS_REPLICATION_KEY,DFSConfigKeys.DFS_REPLICATION_DEFAULT);
  int defaultMaintenanceMinRepl=getConf().getInt(DFSConfigKeys.DFS_NAMENODE_MAINTENANCE_REPLICATION_MIN_KEY,DFSConfigKeys.DFS_NAMENODE_MAINTENANCE_REPLICATION_MIN_DEFAULT);
  int maintenanceMinRepl=defaultMaintenanceMinRepl + 1;
  int fileBlockReplication=maintenanceMinRepl + 1;
  int numAddedDataNodes=1;
  int numInitialDataNodes=(maintenanceMinRepl * 2 - numAddedDataNodes);
  Assert.assertTrue(maintenanceMinRepl <= defaultReplication);
  testFileBlockReplicationImpl(maintenanceMinRepl,numInitialDataNodes,numAddedDataNodes,fileBlockReplication);
  maintenanceMinRepl=defaultMaintenanceMinRepl + 1;
  fileBlockReplication=maintenanceMinRepl - 1;
  numAddedDataNodes=0;
  numInitialDataNodes=(maintenanceMinRepl * 2 - numAddedDataNodes);
  testFileBlockReplicationImpl(maintenanceMinRepl,numInitialDataNodes,numAddedDataNodes,fileBlockReplication);
}
