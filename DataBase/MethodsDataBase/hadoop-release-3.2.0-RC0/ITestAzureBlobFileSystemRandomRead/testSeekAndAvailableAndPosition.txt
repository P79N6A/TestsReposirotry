/** 
 * Validates the implementation of Seekable.seek, Seekable.getPos, and InputStream.available.
 * @throws Exception
 */
@Test public void testSeekAndAvailableAndPosition() throws Exception {
  assumeHugeFileExists();
  try (FSDataInputStream inputStream=this.getFileSystem().open(TEST_FILE_PATH)){
    byte[] expected1={(byte)'a',(byte)'b',(byte)'c'};
    byte[] expected2={(byte)'d',(byte)'e',(byte)'f'};
    byte[] expected3={(byte)'b',(byte)'c',(byte)'d'};
    byte[] expected4={(byte)'g',(byte)'h',(byte)'i'};
    byte[] buffer=new byte[3];
    int bytesRead=inputStream.read(buffer);
    assertEquals(buffer.length,bytesRead);
    assertArrayEquals(expected1,buffer);
    assertEquals(buffer.length,inputStream.getPos());
    assertEquals(testFileLength - inputStream.getPos(),inputStream.available());
    bytesRead=inputStream.read(buffer);
    assertEquals(buffer.length,bytesRead);
    assertArrayEquals(expected2,buffer);
    assertEquals(2 * buffer.length,inputStream.getPos());
    assertEquals(testFileLength - inputStream.getPos(),inputStream.available());
    int seekPos=0;
    inputStream.seek(seekPos);
    bytesRead=inputStream.read(buffer);
    assertEquals(buffer.length,bytesRead);
    assertArrayEquals(expected1,buffer);
    assertEquals(buffer.length + seekPos,inputStream.getPos());
    assertEquals(testFileLength - inputStream.getPos(),inputStream.available());
    seekPos=1;
    inputStream.seek(seekPos);
    bytesRead=inputStream.read(buffer);
    assertEquals(buffer.length,bytesRead);
    assertArrayEquals(expected3,buffer);
    assertEquals(buffer.length + seekPos,inputStream.getPos());
    assertEquals(testFileLength - inputStream.getPos(),inputStream.available());
    seekPos=6;
    inputStream.seek(seekPos);
    bytesRead=inputStream.read(buffer);
    assertEquals(buffer.length,bytesRead);
    assertArrayEquals(expected4,buffer);
    assertEquals(buffer.length + seekPos,inputStream.getPos());
    assertEquals(testFileLength - inputStream.getPos(),inputStream.available());
  }
 }
