/** 
 * Write data to a page blob, open it, seek, and then read a range of data. Then compare that the data read from that range is the same as the data originally written.
 */
@Test public void testPageBlobSeekAndReadAfterWrite() throws IOException {
  writeRandomData(PAGE_SIZE * MAX_PAGES);
  int recordSize=100;
  byte[] b=new byte[recordSize];
  try (FSDataInputStream stream=fs.open(blobPath)){
    int seekPosition=5 * PAGE_SIZE + 250;
    stream.seek(seekPosition);
    int bytesRead=stream.read(b);
    verifyReadRandomData(b,bytesRead,seekPosition,recordSize);
    seekPosition=10 * PAGE_SIZE + 250;
    stream.seek(seekPosition);
    recordSize=1000;
    b=new byte[recordSize];
    bytesRead=stream.read(b);
    verifyReadRandomData(b,bytesRead,seekPosition,recordSize);
    recordSize=100;
    seekPosition=PAGE_SIZE * MAX_PAGES - recordSize;
    stream.seek(seekPosition);
    b=new byte[recordSize];
    bytesRead=stream.read(b);
    verifyReadRandomData(b,bytesRead,seekPosition,recordSize);
    recordSize=100;
    seekPosition=PAGE_SIZE * MAX_PAGES - recordSize + 50;
    stream.seek(seekPosition);
    b=new byte[recordSize];
    bytesRead=stream.read(b);
    assertEquals(50,bytesRead);
    byte[] tail=Arrays.copyOfRange(randomData,seekPosition,randomData.length);
    assertTrue(comparePrefix(tail,b,50));
  }
 }
