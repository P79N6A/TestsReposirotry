@Test public void testRolesArentHeldIfAuthenticationPrincipalIsNull() throws Exception {
  Authentication auth=new TestingAuthenticationToken(null,"koala","ROLE_HELLO","ROLE_FOOBAR");
  SecurityContextHolder.getContext().setAuthentication(auth);
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestURI("/");
  SecurityContextHolderAwareRequestWrapper wrapper=new SecurityContextHolderAwareRequestWrapper(request,"");
  assertThat(wrapper.getRemoteUser()).isNull();
  assertThat(wrapper.isUserInRole("ROLE_HELLO")).isFalse();
  assertThat(wrapper.isUserInRole("ROLE_FOOBAR")).isFalse();
  assertThat(wrapper.getUserPrincipal()).isNull();
}
