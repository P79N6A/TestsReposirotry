@Test public void testCorrectOperationWithStringBasedPrincipal() throws Exception {
  Authentication auth=new TestingAuthenticationToken("rod","koala","ROLE_FOO");
  SecurityContextHolder.getContext().setAuthentication(auth);
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestURI("/");
  SecurityContextHolderAwareRequestWrapper wrapper=new SecurityContextHolderAwareRequestWrapper(request,"");
  assertThat(wrapper.getRemoteUser()).isEqualTo("rod");
  assertThat(wrapper.isUserInRole("ROLE_FOO")).isTrue();
  assertThat(wrapper.isUserInRole("ROLE_NOT_GRANTED")).isFalse();
  assertThat(wrapper.getUserPrincipal()).isEqualTo(auth);
}
