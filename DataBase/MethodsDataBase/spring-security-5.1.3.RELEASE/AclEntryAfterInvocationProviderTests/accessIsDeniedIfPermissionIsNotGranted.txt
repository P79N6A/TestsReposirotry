@Test(expected=AccessDeniedException.class) public void accessIsDeniedIfPermissionIsNotGranted(){
  AclService service=mock(AclService.class);
  Acl acl=mock(Acl.class);
  when(acl.isGranted(any(List.class),any(List.class),anyBoolean())).thenReturn(false);
  when(acl.isGranted(any(),any(List.class),anyBoolean())).thenThrow(new NotFoundException(""));
  when(service.readAclById(any(),any())).thenReturn(acl);
  AclEntryAfterInvocationProvider provider=new AclEntryAfterInvocationProvider(service,Arrays.asList(mock(Permission.class)));
  provider.setProcessConfigAttribute("MY_ATTRIBUTE");
  provider.setMessageSource(new SpringSecurityMessageSource());
  provider.setObjectIdentityRetrievalStrategy(mock(ObjectIdentityRetrievalStrategy.class));
  provider.setProcessDomainObjectClass(Object.class);
  provider.setSidRetrievalStrategy(mock(SidRetrievalStrategy.class));
  try {
    provider.decide(mock(Authentication.class),new Object(),SecurityConfig.createList("UNSUPPORTED","MY_ATTRIBUTE"),new Object());
    fail("Expected Exception");
  }
 catch (  AccessDeniedException expected) {
  }
  provider.decide(mock(Authentication.class),new Object(),SecurityConfig.createList("UNSUPPORTED","MY_ATTRIBUTE"),new Object());
}
