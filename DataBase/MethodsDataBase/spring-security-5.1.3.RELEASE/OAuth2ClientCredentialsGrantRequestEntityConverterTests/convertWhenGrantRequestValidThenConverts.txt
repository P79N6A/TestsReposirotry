@SuppressWarnings("unchecked") @Test public void convertWhenGrantRequestValidThenConverts(){
  RequestEntity<?> requestEntity=this.converter.convert(this.clientCredentialsGrantRequest);
  ClientRegistration clientRegistration=this.clientCredentialsGrantRequest.getClientRegistration();
  assertThat(requestEntity.getMethod()).isEqualTo(HttpMethod.POST);
  assertThat(requestEntity.getUrl().toASCIIString()).isEqualTo(clientRegistration.getProviderDetails().getTokenUri());
  HttpHeaders headers=requestEntity.getHeaders();
  assertThat(headers.getAccept()).contains(MediaType.APPLICATION_JSON_UTF8);
  assertThat(headers.getContentType()).isEqualTo(MediaType.valueOf(APPLICATION_FORM_URLENCODED_VALUE + ";charset=UTF-8"));
  assertThat(headers.getFirst(HttpHeaders.AUTHORIZATION)).startsWith("Basic ");
  MultiValueMap<String,String> formParameters=(MultiValueMap<String,String>)requestEntity.getBody();
  assertThat(formParameters.getFirst(OAuth2ParameterNames.GRANT_TYPE)).isEqualTo(AuthorizationGrantType.CLIENT_CREDENTIALS.getValue());
  assertThat(formParameters.getFirst(OAuth2ParameterNames.SCOPE)).isEqualTo("read write");
}
