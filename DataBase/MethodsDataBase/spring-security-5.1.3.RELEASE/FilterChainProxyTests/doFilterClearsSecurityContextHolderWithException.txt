@Test public void doFilterClearsSecurityContextHolderWithException() throws Exception {
  when(matcher.matches(any(HttpServletRequest.class))).thenReturn(true);
  doAnswer(new Answer<Object>(){
    public Object answer(    InvocationOnMock inv) throws Throwable {
      SecurityContextHolder.getContext().setAuthentication(new TestingAuthenticationToken("username","password"));
      throw new ServletException("oops");
    }
  }
).when(filter).doFilter(any(HttpServletRequest.class),any(HttpServletResponse.class),any(FilterChain.class));
  try {
    fcp.doFilter(request,response,chain);
    fail("Expected Exception");
  }
 catch (  ServletException success) {
  }
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNull();
}
