@Test public void callIsntMadeWhenAccessDecisionManagerRejectsAccess() throws Exception {
  SecurityContextHolder.getContext().setAuthentication(token);
  createTarget(true);
  mdsReturnsUserRole();
  when(authman.authenticate(token)).thenReturn(token);
  doThrow(new AccessDeniedException("rejected")).when(adm).decide(any(Authentication.class),any(MethodInvocation.class),any(List.class));
  try {
    advisedTarget.makeUpperCase("HELLO");
    fail("Expected Exception");
  }
 catch (  AccessDeniedException expected) {
  }
  verify(eventPublisher).publishEvent(any(AuthorizationFailureEvent.class));
}
