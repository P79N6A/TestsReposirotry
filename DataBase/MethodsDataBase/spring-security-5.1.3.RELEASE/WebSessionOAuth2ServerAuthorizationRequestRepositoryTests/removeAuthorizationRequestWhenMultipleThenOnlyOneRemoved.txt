@Test public void removeAuthorizationRequestWhenMultipleThenOnlyOneRemoved(){
  String oldState="state0";
  MockServerHttpRequest oldRequest=MockServerHttpRequest.get("/").queryParam(OAuth2ParameterNames.STATE,oldState).build();
  OAuth2AuthorizationRequest oldAuthorizationRequest=OAuth2AuthorizationRequest.authorizationCode().authorizationUri("https://example.com/oauth2/authorize").clientId("client-id").redirectUri("http://localhost/client-1").state(oldState).build();
  WebSessionManager sessionManager=e -> this.exchange.getSession();
  this.exchange=new DefaultServerWebExchange(this.exchange.getRequest(),new MockServerHttpResponse(),sessionManager,ServerCodecConfigurer.create(),new AcceptHeaderLocaleContextResolver());
  ServerWebExchange oldExchange=new DefaultServerWebExchange(oldRequest,new MockServerHttpResponse(),sessionManager,ServerCodecConfigurer.create(),new AcceptHeaderLocaleContextResolver());
  Mono<OAuth2AuthorizationRequest> saveAndSaveAndRemove=this.repository.saveAuthorizationRequest(oldAuthorizationRequest,oldExchange).then(this.repository.saveAuthorizationRequest(this.authorizationRequest,this.exchange)).then(this.repository.removeAuthorizationRequest(this.exchange));
  StepVerifier.create(saveAndSaveAndRemove).expectNext(this.authorizationRequest).verifyComplete();
  StepVerifier.create(this.repository.loadAuthorizationRequest(this.exchange)).verifyComplete();
  StepVerifier.create(this.repository.loadAuthorizationRequest(oldExchange)).expectNext(oldAuthorizationRequest).verifyComplete();
}
