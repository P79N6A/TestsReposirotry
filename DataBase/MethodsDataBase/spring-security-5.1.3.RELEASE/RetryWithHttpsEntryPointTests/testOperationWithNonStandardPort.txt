@Test public void testOperationWithNonStandardPort() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/bigWebApp/hello/pathInfo.html");
  request.setQueryString("open=true");
  request.setScheme("http");
  request.setServerName("www.example.com");
  request.setServerPort(8888);
  MockHttpServletResponse response=new MockHttpServletResponse();
  PortMapperImpl portMapper=new PortMapperImpl();
  Map<String,String> map=new HashMap<>();
  map.put("8888","9999");
  portMapper.setPortMappings(map);
  RetryWithHttpsEntryPoint ep=new RetryWithHttpsEntryPoint();
  ep.setPortResolver(new MockPortResolver(8888,9999));
  ep.setPortMapper(portMapper);
  ep.commence(request,response);
  assertThat(response.getRedirectedUrl()).isEqualTo("https://www.example.com:9999/bigWebApp/hello/pathInfo.html?open=true");
}
