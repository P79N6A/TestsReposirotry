@Test public void eagerlyLoadsRequiredAcls() throws Exception {
  AclService service=mock(AclService.class);
  AclPermissionCacheOptimizer pco=new AclPermissionCacheOptimizer(service);
  ObjectIdentityRetrievalStrategy oidStrat=mock(ObjectIdentityRetrievalStrategy.class);
  SidRetrievalStrategy sidStrat=mock(SidRetrievalStrategy.class);
  pco.setObjectIdentityRetrievalStrategy(oidStrat);
  pco.setSidRetrievalStrategy(sidStrat);
  Object[] dos={new Object(),null,new Object()};
  ObjectIdentity[] oids={new ObjectIdentityImpl("A","1"),new ObjectIdentityImpl("A","2")};
  when(oidStrat.getObjectIdentity(dos[0])).thenReturn(oids[0]);
  when(oidStrat.getObjectIdentity(dos[2])).thenReturn(oids[1]);
  pco.cachePermissionsFor(mock(Authentication.class),Arrays.asList(dos));
  verify(service).readAclsById(eq(Arrays.asList(oids)),any(List.class));
}
