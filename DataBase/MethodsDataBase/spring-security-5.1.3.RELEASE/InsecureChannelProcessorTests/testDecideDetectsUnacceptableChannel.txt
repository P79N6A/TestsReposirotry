@Test public void testDecideDetectsUnacceptableChannel() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setQueryString("info=true");
  request.setServerName("localhost");
  request.setContextPath("/bigapp");
  request.setServletPath("/servlet");
  request.setScheme("https");
  request.setSecure(true);
  request.setServerPort(8443);
  MockHttpServletResponse response=new MockHttpServletResponse();
  FilterInvocation fi=new FilterInvocation(request,response,mock(FilterChain.class));
  InsecureChannelProcessor processor=new InsecureChannelProcessor();
  processor.decide(fi,SecurityConfig.createList(new String[]{"SOME_IGNORED_ATTRIBUTE","REQUIRES_INSECURE_CHANNEL"}));
  assertThat(fi.getResponse().isCommitted()).isTrue();
}
