@Test public void filterWhenExistingContextAndPrincipalNotNullThenContextPopulated(){
  Mono<Void> result=this.filter.filter(this.exchange,new DefaultWebFilterChain(e -> e.getPrincipal().doOnSuccess(contextPrincipal -> assertThat(contextPrincipal).isEqualTo(principal)).flatMap(contextPrincipal -> Mono.subscriberContext()).doOnSuccess(context -> assertThat(context.<String>get("foo")).isEqualTo("bar")).then())).subscriberContext(context -> context.put("foo","bar")).subscriberContext(ReactiveSecurityContextHolder.withAuthentication(this.principal));
  StepVerifier.create(result).verifyComplete();
}
