@Test public void requestAuthorizationCodeGrantWhenValidAuthorizationResponseThenDisplayIndexPage() throws Exception {
  HtmlPage page=this.webClient.getPage("/");
  ClientRegistration clientRegistration=this.clientRegistrationRepository.findByRegistrationId("github");
  HtmlAnchor clientAnchorElement=this.getClientAnchorElement(page,clientRegistration);
  assertThat(clientAnchorElement).isNotNull();
  WebResponse response=this.followLinkDisableRedirects(clientAnchorElement);
  UriComponents authorizeRequestUriComponents=UriComponentsBuilder.fromUri(URI.create(response.getResponseHeaderValue("Location"))).build();
  Map<String,String> params=authorizeRequestUriComponents.getQueryParams().toSingleValueMap();
  String code="auth-code";
  String state=URLDecoder.decode(params.get(OAuth2ParameterNames.STATE),"UTF-8");
  String redirectUri=URLDecoder.decode(params.get(OAuth2ParameterNames.REDIRECT_URI),"UTF-8");
  String authorizationResponseUri=UriComponentsBuilder.fromHttpUrl(redirectUri).queryParam(OAuth2ParameterNames.CODE,code).queryParam(OAuth2ParameterNames.STATE,state).build().encode().toUriString();
  page=this.webClient.getPage(new URL(authorizationResponseUri));
  this.assertIndexPage(page);
}
