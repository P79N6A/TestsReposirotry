@Test public void authenticateWhenPasswordEncoderAndSuccessThenSuccess(){
  this.manager.setPasswordEncoder(this.passwordEncoder);
  when(this.passwordEncoder.matches(any(),any())).thenReturn(true);
  User user=new User(this.username,this.password,AuthorityUtils.createAuthorityList("ROLE_USER"));
  when(this.repository.findByUsername(user.getUsername())).thenReturn(Mono.just(user));
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken(this.username,this.password);
  Authentication authentication=this.manager.authenticate(token).block();
  assertThat(authentication).isEqualTo(authentication);
}
