@Test public void filterWhenRequestIsInsecureThenPortMapperRemapsPort(){
  PortMapper portMapper=mock(PortMapper.class);
  when(portMapper.lookupHttpsPort(314)).thenReturn(159);
  this.filter.setPortMapper(portMapper);
  ServerWebExchange exchange=get("http://localhost:314");
  this.filter.filter(exchange,this.chain).block();
  assertThat(statusCode(exchange)).isEqualTo(302);
  assertThat(redirectedUrl(exchange)).isEqualTo("https://localhost:159");
  verify(portMapper).lookupHttpsPort(314);
}
