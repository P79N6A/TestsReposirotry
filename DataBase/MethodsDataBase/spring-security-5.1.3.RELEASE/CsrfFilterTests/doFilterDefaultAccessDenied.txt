@Test public void doFilterDefaultAccessDenied() throws ServletException, IOException {
  this.filter=new CsrfFilter(this.tokenRepository);
  this.filter.setRequireCsrfProtectionMatcher(this.requestMatcher);
  when(this.requestMatcher.matches(this.request)).thenReturn(true);
  when(this.tokenRepository.loadToken(this.request)).thenReturn(this.token);
  this.filter.doFilter(this.request,this.response,this.filterChain);
  assertThat(this.request.getAttribute(this.token.getParameterName())).isEqualTo(this.token);
  assertThat(this.request.getAttribute(CsrfToken.class.getName())).isEqualTo(this.token);
  assertThat(this.response.getStatus()).isEqualTo(HttpServletResponse.SC_FORBIDDEN);
  verifyZeroInteractions(this.filterChain);
}
