@Test public void doFilterIsCsrfRequestGenerateToken() throws ServletException, IOException {
  when(this.requestMatcher.matches(this.request)).thenReturn(true);
  when(this.tokenRepository.generateToken(this.request)).thenReturn(this.token);
  this.request.setParameter(this.token.getParameterName(),this.token.getToken());
  this.filter.doFilter(this.request,this.response,this.filterChain);
  assertToken(this.request.getAttribute(this.token.getParameterName())).isEqualTo(this.token);
  assertToken(this.request.getAttribute(CsrfToken.class.getName())).isEqualTo(this.token);
  assertThat(this.request.getAttribute(HttpServletResponse.class.getName())).isEqualTo(this.response);
  verify(this.filterChain).doFilter(this.request,this.response);
  verify(this.tokenRepository).saveToken(this.token,this.request,this.response);
  verifyZeroInteractions(this.deniedHandler);
}
