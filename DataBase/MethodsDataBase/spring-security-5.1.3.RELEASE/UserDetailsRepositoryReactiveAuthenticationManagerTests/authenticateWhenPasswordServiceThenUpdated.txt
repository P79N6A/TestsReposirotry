@Test public void authenticateWhenPasswordServiceThenUpdated(){
  String encodedPassword="encoded";
  when(this.userDetailsService.findByUsername(any())).thenReturn(Mono.just(this.user));
  when(this.encoder.matches(any(),any())).thenReturn(true);
  when(this.encoder.upgradeEncoding(any())).thenReturn(true);
  when(this.encoder.encode(any())).thenReturn(encodedPassword);
  when(this.userDetailsPasswordService.updatePassword(any(),any())).thenReturn(Mono.just(this.user));
  this.manager.setPasswordEncoder(this.encoder);
  this.manager.setUserDetailsPasswordService(this.userDetailsPasswordService);
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken(this.user,this.user.getPassword());
  Authentication result=this.manager.authenticate(token).block();
  verify(this.encoder).encode(this.user.getPassword());
  verify(this.userDetailsPasswordService).updatePassword(eq(this.user),eq(encodedPassword));
}
