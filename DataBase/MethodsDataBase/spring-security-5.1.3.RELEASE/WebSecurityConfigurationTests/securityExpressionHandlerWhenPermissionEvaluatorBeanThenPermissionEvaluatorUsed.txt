@Test public void securityExpressionHandlerWhenPermissionEvaluatorBeanThenPermissionEvaluatorUsed() throws Exception {
  this.spring.register(WebSecurityExpressionHandlerPermissionEvaluatorBeanConfig.class).autowire();
  TestingAuthenticationToken authentication=new TestingAuthenticationToken("user","notused");
  FilterInvocation invocation=new FilterInvocation(new MockHttpServletRequest("GET",""),new MockHttpServletResponse(),new MockFilterChain());
  AbstractSecurityExpressionHandler handler=this.spring.getContext().getBean(AbstractSecurityExpressionHandler.class);
  EvaluationContext evaluationContext=handler.createEvaluationContext(authentication,invocation);
  Expression expression=handler.getExpressionParser().parseExpression("hasPermission(#study,'DELETE')");
  boolean granted=expression.getValue(evaluationContext,Boolean.class);
  assertThat(granted).isTrue();
}
