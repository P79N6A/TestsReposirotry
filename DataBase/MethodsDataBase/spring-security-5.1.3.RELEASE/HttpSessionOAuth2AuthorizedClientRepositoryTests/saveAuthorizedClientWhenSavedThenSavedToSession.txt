@Test public void saveAuthorizedClientWhenSavedThenSavedToSession(){
  OAuth2AuthorizedClient authorizedClient=new OAuth2AuthorizedClient(this.registration2,this.principalName1,mock(OAuth2AccessToken.class));
  this.authorizedClientRepository.saveAuthorizedClient(authorizedClient,null,this.request,this.response);
  HttpSession session=this.request.getSession(false);
  assertThat(session).isNotNull();
  @SuppressWarnings("unchecked") Map<String,OAuth2AuthorizedClient> authorizedClients=(Map<String,OAuth2AuthorizedClient>)session.getAttribute(HttpSessionOAuth2AuthorizedClientRepository.class.getName() + ".AUTHORIZED_CLIENTS");
  assertThat(authorizedClients).isNotEmpty();
  assertThat(authorizedClients).hasSize(1);
  assertThat(authorizedClients.values().iterator().next()).isSameAs(authorizedClient);
}
