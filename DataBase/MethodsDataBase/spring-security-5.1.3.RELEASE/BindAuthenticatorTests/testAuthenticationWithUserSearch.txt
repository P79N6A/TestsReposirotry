@Test public void testAuthenticationWithUserSearch() throws Exception {
  this.authenticator.setUserSearch(new FilterBasedLdapUserSearch("ou=people","(uid={0})",getContextSource()));
  this.authenticator.afterPropertiesSet();
  DirContextOperations result=this.authenticator.authenticate(this.bob);
  assertThat(result.getStringAttribute("cn")).isEqualTo("Bob Hamilton");
  this.authenticator.setUserSearch(new FilterBasedLdapUserSearch("ou=people","(cn={0})",getContextSource()));
  this.authenticator.authenticate(new UsernamePasswordAuthenticationToken("mouse, jerry","jerryspassword"));
  this.authenticator.authenticate(new UsernamePasswordAuthenticationToken("slash/guy","slashguyspassword"));
  this.authenticator.setUserSearch(new FilterBasedLdapUserSearch("ou=\\\"quoted people\\\"","(cn={0})",getContextSource()));
  this.authenticator.authenticate(new UsernamePasswordAuthenticationToken("quote\"guy","quoteguyspassword"));
  this.authenticator.setUserSearch(new FilterBasedLdapUserSearch("","(cn={0})",getContextSource()));
  this.authenticator.authenticate(new UsernamePasswordAuthenticationToken("quote\"guy","quoteguyspassword"));
}
