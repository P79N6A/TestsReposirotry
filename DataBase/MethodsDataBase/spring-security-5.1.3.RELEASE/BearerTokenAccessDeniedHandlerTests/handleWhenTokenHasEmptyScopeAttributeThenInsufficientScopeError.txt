@Test public void handleWhenTokenHasEmptyScopeAttributeThenInsufficientScopeError() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  Map<String,Object> attributes=Maps.newHashMap("scope","");
  Authentication token=new TestingOAuth2TokenAuthenticationToken(attributes);
  request.setUserPrincipal(token);
  this.accessDeniedHandler.handle(request,response,null);
  assertThat(response.getStatus()).isEqualTo(403);
  assertThat(response.getHeader("WWW-Authenticate")).isEqualTo("Bearer error=\"insufficient_scope\", " + "error_description=\"The token provided has insufficient scope [] for this request\", " + "error_uri=\"https://tools.ietf.org/html/rfc6750#section-3.1\"");
}
