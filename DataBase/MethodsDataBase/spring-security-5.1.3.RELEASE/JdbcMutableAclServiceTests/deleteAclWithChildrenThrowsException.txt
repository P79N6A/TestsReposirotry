@Test @Transactional public void deleteAclWithChildrenThrowsException() throws Exception {
  SecurityContextHolder.getContext().setAuthentication(auth);
  MutableAcl parent=jdbcMutableAclService.createAcl(getTopParentOid());
  MutableAcl child=jdbcMutableAclService.createAcl(getMiddleParentOid());
  child.setParent(parent);
  jdbcMutableAclService.updateAcl(child);
  try {
    jdbcMutableAclService.setForeignKeysInDatabase(false);
    jdbcMutableAclService.deleteAcl(getTopParentOid(),false);
    fail("It should have thrown ChildrenExistException");
  }
 catch (  ChildrenExistException expected) {
  }
 finally {
    jdbcMutableAclService.setForeignKeysInDatabase(true);
  }
}
