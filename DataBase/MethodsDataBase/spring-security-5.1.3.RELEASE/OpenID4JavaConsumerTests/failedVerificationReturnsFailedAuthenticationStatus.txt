@Test public void failedVerificationReturnsFailedAuthenticationStatus() throws Exception {
  ConsumerManager mgr=mock(ConsumerManager.class);
  OpenID4JavaConsumer consumer=new OpenID4JavaConsumer(mgr,new NullAxFetchListFactory());
  VerificationResult vr=mock(VerificationResult.class);
  DiscoveryInformation di=mock(DiscoveryInformation.class);
  when(mgr.verify(any(),any(ParameterList.class),any(DiscoveryInformation.class))).thenReturn(vr);
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.getSession().setAttribute(DiscoveryInformation.class.getName(),di);
  OpenIDAuthenticationToken auth=consumer.endConsumption(request);
  assertThat(auth.getStatus()).isEqualTo(OpenIDAuthenticationStatus.FAILURE);
}
