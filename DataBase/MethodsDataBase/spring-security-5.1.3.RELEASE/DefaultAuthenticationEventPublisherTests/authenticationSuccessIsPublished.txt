@Test public void authenticationSuccessIsPublished(){
  publisher=new DefaultAuthenticationEventPublisher();
  ApplicationEventPublisher appPublisher=mock(ApplicationEventPublisher.class);
  publisher.setApplicationEventPublisher(appPublisher);
  publisher.publishAuthenticationSuccess(mock(Authentication.class));
  verify(appPublisher).publishEvent(isA(AuthenticationSuccessEvent.class));
  publisher.setApplicationEventPublisher(null);
  publisher.publishAuthenticationSuccess(mock(Authentication.class));
}
