@Test public void childContext() throws Exception {
  ServletContext servletContext=pageContext.getServletContext();
  WebApplicationContext wac=(WebApplicationContext)servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  servletContext.removeAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  servletContext.setAttribute("org.springframework.web.servlet.FrameworkServlet.CONTEXT.dispatcher",wac);
  Object domainObject=new Object();
  when(pe.hasPermission(bob,domainObject,"READ")).thenReturn(true);
  tag.setDomainObject(domainObject);
  tag.setHasPermission("READ");
  tag.setVar("allowed");
  assertThat(tag.getDomainObject()).isSameAs(domainObject);
  assertThat(tag.getHasPermission()).isEqualTo("READ");
  assertThat(tag.doStartTag()).isEqualTo(Tag.EVAL_BODY_INCLUDE);
  assertThat((Boolean)pageContext.getAttribute("allowed")).isTrue();
}
