@Test(expected=BadCredentialsException.class) public void exceptionIsThrownOnFailedAuthenticationIfContinueFilterChainOnUnsuccessfulAuthenticationSetToFalse() throws Exception {
  AuthenticationManager am=mock(AuthenticationManager.class);
  when(am.authenticate(any(Authentication.class))).thenThrow(new BadCredentialsException(""));
  filter.setContinueFilterChainOnUnsuccessfulAuthentication(false);
  filter.setAuthenticationManager(am);
  filter.afterPropertiesSet();
  filter.doFilter(new MockHttpServletRequest(),new MockHttpServletResponse(),mock(FilterChain.class));
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNull();
}
