@Test public void testWithUserSearch(){
  authenticator=new PasswordComparisonAuthenticator(getContextSource());
  authenticator.setPasswordEncoder(NoOpPasswordEncoder.getInstance());
  assertThat(authenticator.getUserDns("Bob")).withFailMessage("User DN matches shouldn't be available").isEmpty();
  DirContextAdapter ctx=new DirContextAdapter(new DistinguishedName("uid=Bob,ou=people"));
  ctx.setAttributeValue("userPassword","bobspassword");
  authenticator.setUserSearch(new MockUserSearch(ctx));
  authenticator.authenticate(new UsernamePasswordAuthenticationToken("shouldntbeused","bobspassword"));
}
