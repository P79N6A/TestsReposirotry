@Test public void resetWhenForward() throws Exception {
  String denormalizedPath=testPaths.keySet().iterator().next();
  String forwardPath="/forward/path";
  HttpServletRequest mockRequest=mock(HttpServletRequest.class);
  HttpServletResponse mockResponse=mock(HttpServletResponse.class);
  RequestDispatcher mockDispatcher=mock(RequestDispatcher.class);
  when(mockRequest.getServletPath()).thenReturn("");
  when(mockRequest.getPathInfo()).thenReturn(denormalizedPath);
  when(mockRequest.getRequestDispatcher(forwardPath)).thenReturn(mockDispatcher);
  RequestWrapper wrapper=new RequestWrapper(mockRequest);
  RequestDispatcher dispatcher=wrapper.getRequestDispatcher(forwardPath);
  dispatcher.forward(mockRequest,mockResponse);
  verify(mockRequest).getRequestDispatcher(forwardPath);
  verify(mockDispatcher).forward(mockRequest,mockResponse);
  assertThat(wrapper.getPathInfo()).isEqualTo(denormalizedPath);
  verify(mockRequest,times(2)).getPathInfo();
  wrapper.getServletPath();
  verify(mockRequest,times(2)).getServletPath();
  verifyNoMoreInteractions(mockRequest,mockResponse,mockDispatcher);
}
