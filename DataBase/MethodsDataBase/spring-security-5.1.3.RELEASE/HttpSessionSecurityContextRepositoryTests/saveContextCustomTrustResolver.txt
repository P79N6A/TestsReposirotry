@Test public void saveContextCustomTrustResolver(){
  SecurityContext contextToSave=SecurityContextHolder.createEmptyContext();
  contextToSave.setAuthentication(testToken);
  HttpSessionSecurityContextRepository repo=new HttpSessionSecurityContextRepository();
  MockHttpServletRequest request=new MockHttpServletRequest();
  HttpRequestResponseHolder holder=new HttpRequestResponseHolder(request,new MockHttpServletResponse());
  repo.loadContext(holder);
  AuthenticationTrustResolver trustResolver=mock(AuthenticationTrustResolver.class);
  repo.setTrustResolver(trustResolver);
  repo.saveContext(contextToSave,holder.getRequest(),holder.getResponse());
  verify(trustResolver).isAnonymous(contextToSave.getAuthentication());
}
