@Test public void outputStreamCloseDelegate() throws Exception {
  HttpSessionSecurityContextRepository repo=new HttpSessionSecurityContextRepository();
  repo.setSpringSecurityContextKey("imTheContext");
  MockHttpServletRequest request=new MockHttpServletRequest();
  HttpServletResponse response=mock(HttpServletResponse.class);
  ServletOutputStream outputstream=mock(ServletOutputStream.class);
  when(response.getOutputStream()).thenReturn(outputstream);
  HttpRequestResponseHolder holder=new HttpRequestResponseHolder(request,response);
  SecurityContextHolder.setContext(repo.loadContext(holder));
  SecurityContextHolder.getContext().setAuthentication(testToken);
  holder.getResponse().getOutputStream().close();
  verify(outputstream).close();
}
