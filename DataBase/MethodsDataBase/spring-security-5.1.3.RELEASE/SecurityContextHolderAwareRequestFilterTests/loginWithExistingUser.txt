@Test public void loginWithExistingUser() throws Exception {
  TestingAuthenticationToken expectedAuth=new TestingAuthenticationToken("user","password","ROLE_USER");
  when(this.authenticationManager.authenticate(any(UsernamePasswordAuthenticationToken.class))).thenReturn(new TestingAuthenticationToken("newuser","not be found","ROLE_USER"));
  SecurityContextHolder.getContext().setAuthentication(expectedAuth);
  try {
    wrappedRequest().login(expectedAuth.getName(),String.valueOf(expectedAuth.getCredentials()));
    fail("Expected Exception");
  }
 catch (  ServletException success) {
    assertThat(SecurityContextHolder.getContext().getAuthentication()).isSameAs(expectedAuth);
    verifyZeroInteractions(this.authenticationEntryPoint,this.logoutHandler);
    verify(this.request,times(0)).login(anyString(),anyString());
  }
}
