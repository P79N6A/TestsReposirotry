@Test public void doFilterWhenMalformedBearerTokenThenPropagatesError() throws ServletException, IOException {
  BearerTokenError error=new BearerTokenError(BearerTokenErrorCodes.INVALID_REQUEST,HttpStatus.BAD_REQUEST,"description","uri");
  OAuth2AuthenticationException exception=new OAuth2AuthenticationException(error);
  when(this.bearerTokenResolver.resolve(this.request)).thenThrow(exception);
  dontAuthenticate();
  verify(this.authenticationEntryPoint).commence(this.request,this.response,exception);
}
