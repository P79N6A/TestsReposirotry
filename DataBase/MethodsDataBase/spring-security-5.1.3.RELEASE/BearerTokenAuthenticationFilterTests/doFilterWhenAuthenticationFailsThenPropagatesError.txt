@Test public void doFilterWhenAuthenticationFailsThenPropagatesError() throws ServletException, IOException {
  BearerTokenError error=new BearerTokenError(BearerTokenErrorCodes.INVALID_TOKEN,HttpStatus.UNAUTHORIZED,"description","uri");
  OAuth2AuthenticationException exception=new OAuth2AuthenticationException(error);
  when(this.bearerTokenResolver.resolve(this.request)).thenReturn("token");
  when(this.authenticationManager.authenticate(any(BearerTokenAuthenticationToken.class))).thenThrow(exception);
  this.filter.doFilter(this.request,this.response,this.filterChain);
  verify(this.authenticationEntryPoint).commence(this.request,this.response,exception);
}
