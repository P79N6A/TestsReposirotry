@Test public void doFilterWhenBearerTokenPresentThenAuthenticates() throws ServletException, IOException {
  when(this.bearerTokenResolver.resolve(this.request)).thenReturn("token");
  this.filter.doFilter(this.request,this.response,this.filterChain);
  ArgumentCaptor<BearerTokenAuthenticationToken> captor=ArgumentCaptor.forClass(BearerTokenAuthenticationToken.class);
  verify(this.authenticationManager).authenticate(captor.capture());
  assertThat(captor.getValue().getPrincipal()).isEqualTo("token");
}
