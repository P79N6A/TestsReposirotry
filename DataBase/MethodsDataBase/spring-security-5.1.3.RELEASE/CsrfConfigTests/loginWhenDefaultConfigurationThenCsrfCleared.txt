@Test public void loginWhenDefaultConfigurationThenCsrfCleared() throws Exception {
  this.spring.configLocations(this.xml("shared-controllers"),this.xml("AutoConfig")).autowire();
  MvcResult result=this.mvc.perform(get("/csrf")).andReturn();
  MockHttpSession session=(MockHttpSession)result.getRequest().getSession();
  this.mvc.perform(post("/login").param("username","user").param("password","password").session(session).with(csrf())).andExpect(status().isFound());
  this.mvc.perform(get("/csrf").session(session)).andExpect(csrfChanged(result));
}
