@Test public void testRespectsRolePrefix() throws Exception {
  UsernamePasswordAuthenticationToken inputToken=new UsernamePasswordAuthenticationToken("Test","Password",AuthorityUtils.createAuthorityList("ONE","TWO"));
  RunAsManagerImpl runAs=new RunAsManagerImpl();
  runAs.setKey("my_password");
  runAs.setRolePrefix("FOOBAR_");
  Authentication result=runAs.buildRunAs(inputToken,new Object(),SecurityConfig.createList("RUN_AS_SOMETHING"));
  assertThat(result instanceof RunAsUserToken).withFailMessage("Should have returned a RunAsUserToken").isTrue();
  assertThat(result.getPrincipal()).isEqualTo(inputToken.getPrincipal());
  assertThat(result.getCredentials()).isEqualTo(inputToken.getCredentials());
  Set<String> authorities=AuthorityUtils.authorityListToSet(result.getAuthorities());
  assertThat(authorities.contains("FOOBAR_RUN_AS_SOMETHING")).isTrue();
  assertThat(authorities.contains("ONE")).isTrue();
  assertThat(authorities.contains("TWO")).isTrue();
  RunAsUserToken resultCast=(RunAsUserToken)result;
  assertThat(resultCast.getKeyHash()).isEqualTo("my_password".hashCode());
}
