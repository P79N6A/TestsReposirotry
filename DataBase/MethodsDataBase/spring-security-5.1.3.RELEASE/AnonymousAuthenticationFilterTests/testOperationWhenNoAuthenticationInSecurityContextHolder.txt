@Test public void testOperationWhenNoAuthenticationInSecurityContextHolder() throws Exception {
  AnonymousAuthenticationFilter filter=new AnonymousAuthenticationFilter("qwerty","anonymousUsername",AuthorityUtils.createAuthorityList("ROLE_ANONYMOUS"));
  filter.afterPropertiesSet();
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestURI("x");
  executeFilterInContainerSimulator(mock(FilterConfig.class),filter,request,new MockHttpServletResponse(),new MockFilterChain(true));
  Authentication auth=SecurityContextHolder.getContext().getAuthentication();
  assertThat(auth.getPrincipal()).isEqualTo("anonymousUsername");
  assertThat(AuthorityUtils.authorityListToSet(auth.getAuthorities())).contains("ROLE_ANONYMOUS");
  SecurityContextHolder.getContext().setAuthentication(null);
}
