@Test public void testAccessDeniedWithRememberMe() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setServletPath("/secure/page.html");
  request.setServerPort(80);
  request.setScheme("http");
  request.setServerName("www.example.com");
  request.setContextPath("/mycontext");
  request.setRequestURI("/mycontext/secure/page.html");
  FilterChain fc=mock(FilterChain.class);
  doThrow(new AccessDeniedException("")).when(fc).doFilter(any(HttpServletRequest.class),any(HttpServletResponse.class));
  SecurityContext securityContext=SecurityContextHolder.createEmptyContext();
  securityContext.setAuthentication(new RememberMeAuthenticationToken("ignored","ignored",AuthorityUtils.createAuthorityList("IGNORED")));
  SecurityContextHolder.setContext(securityContext);
  ExceptionTranslationFilter filter=new ExceptionTranslationFilter(mockEntryPoint);
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,fc);
  assertThat(response.getRedirectedUrl()).isEqualTo("/mycontext/login.jsp");
  assertThat(getSavedRequestUrl(request)).isEqualTo("http://www.example.com/mycontext/secure/page.html");
}
