@Test public void redirectedToLoginFormAndSessionShowsOriginalTargetWhenAuthenticationException() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setServletPath("/secure/page.html");
  request.setServerPort(80);
  request.setScheme("http");
  request.setServerName("www.example.com");
  request.setContextPath("/mycontext");
  request.setRequestURI("/mycontext/secure/page.html");
  FilterChain fc=mock(FilterChain.class);
  doThrow(new BadCredentialsException("")).when(fc).doFilter(any(HttpServletRequest.class),any(HttpServletResponse.class));
  ExceptionTranslationFilter filter=new ExceptionTranslationFilter(mockEntryPoint);
  filter.afterPropertiesSet();
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,fc);
  assertThat(response.getRedirectedUrl()).isEqualTo("/mycontext/login.jsp");
  assertThat(getSavedRequestUrl(request)).isEqualTo("http://www.example.com/mycontext/secure/page.html");
}
