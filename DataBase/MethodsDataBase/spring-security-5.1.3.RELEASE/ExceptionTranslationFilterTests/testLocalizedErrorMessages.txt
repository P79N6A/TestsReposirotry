@Test public void testLocalizedErrorMessages() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setServletPath("/secure/page.html");
  FilterChain fc=mock(FilterChain.class);
  doThrow(new AccessDeniedException("")).when(fc).doFilter(any(HttpServletRequest.class),any(HttpServletResponse.class));
  SecurityContextHolder.getContext().setAuthentication(new AnonymousAuthenticationToken("ignored","ignored",AuthorityUtils.createAuthorityList("IGNORED")));
  ExceptionTranslationFilter filter=new ExceptionTranslationFilter((req,res,ae) -> res.sendError(403,ae.getMessage()));
  filter.setAuthenticationTrustResolver(new AuthenticationTrustResolverImpl());
  assertThat(filter.getAuthenticationTrustResolver()).isNotNull();
  LocaleContextHolder.setDefaultLocale(Locale.GERMAN);
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,fc);
  assertThat(response.getErrorMessage()).isEqualTo("Vollst\u00e4ndige Authentifikation wird ben\u00f6tigt um auf diese Resource zuzugreifen");
}
