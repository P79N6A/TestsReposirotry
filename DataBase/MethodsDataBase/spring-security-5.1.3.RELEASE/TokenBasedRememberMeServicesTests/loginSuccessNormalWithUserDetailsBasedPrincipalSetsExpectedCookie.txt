@Test public void loginSuccessNormalWithUserDetailsBasedPrincipalSetsExpectedCookie(){
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.addParameter(TokenBasedRememberMeServices.DEFAULT_PARAMETER,"true");
  MockHttpServletResponse response=new MockHttpServletResponse();
  services.loginSuccess(request,response,new TestingAuthenticationToken("someone","password","ROLE_ABC"));
  Cookie cookie=response.getCookie(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY);
  assertThat(cookie).isNotNull();
  assertThat(cookie.getMaxAge()).isEqualTo(services.getTokenValiditySeconds());
  assertThat(Base64.isArrayByteBase64(cookie.getValue().getBytes())).isTrue();
  assertThat(new Date().before(new Date(determineExpiryTimeFromBased64EncodedToken(cookie.getValue())))).isTrue();
}
