@Test public void autoLoginWithValidTokenAndUserSucceeds() throws Exception {
  udsWillReturnUser();
  Cookie cookie=new Cookie(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,generateCorrectCookieContentForToken(System.currentTimeMillis() + 1000000,"someone","password","key"));
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setCookies(cookie);
  MockHttpServletResponse response=new MockHttpServletResponse();
  Authentication result=services.autoLogin(request,response);
  assertThat(result).isNotNull();
  assertThat(result.getPrincipal()).isEqualTo(user);
}
