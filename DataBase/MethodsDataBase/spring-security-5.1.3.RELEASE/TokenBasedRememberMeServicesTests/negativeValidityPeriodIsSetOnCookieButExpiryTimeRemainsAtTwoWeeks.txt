@Test public void negativeValidityPeriodIsSetOnCookieButExpiryTimeRemainsAtTwoWeeks() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.addParameter(DEFAULT_PARAMETER,"true");
  MockHttpServletResponse response=new MockHttpServletResponse();
  services.setTokenValiditySeconds(-1);
  services.loginSuccess(request,response,new TestingAuthenticationToken("someone","password","ROLE_ABC"));
  Cookie cookie=response.getCookie(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY);
  assertThat(cookie).isNotNull();
  assertThat(determineExpiryTimeFromBased64EncodedToken(cookie.getValue()) - System.currentTimeMillis() > TWO_WEEKS_S - 50).isTrue();
  assertThat(cookie.getMaxAge()).isEqualTo(-1);
  assertThat(Base64.isArrayByteBase64(cookie.getValue().getBytes())).isTrue();
}
