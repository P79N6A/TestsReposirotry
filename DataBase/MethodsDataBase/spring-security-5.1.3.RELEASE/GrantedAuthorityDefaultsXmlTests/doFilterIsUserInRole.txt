@Test public void doFilterIsUserInRole() throws Exception {
  SecurityContext context=SecurityContextHolder.getContext();
  request.getSession().setAttribute(HttpSessionSecurityContextRepository.SPRING_SECURITY_CONTEXT_KEY,context);
  chain=new MockFilterChain(){
    @Override public void doFilter(    ServletRequest request,    ServletResponse response) throws IOException, ServletException {
      HttpServletRequest httpRequest=(HttpServletRequest)request;
      assertThat(httpRequest.isUserInRole("USER")).isTrue();
      assertThat(httpRequest.isUserInRole("INVALID")).isFalse();
      super.doFilter(request,response);
    }
  }
;
  springSecurityFilterChain.doFilter(request,response,chain);
  assertThat(chain.getRequest()).isNotNull();
}
