@Test public void expectedPrincipalIsReturned(){
  LdapUserDetailsImpl.Essence user=new LdapUserDetailsImpl.Essence();
  user.setUsername("joe");
  user.setDn(new DistinguishedName("uid=joe,ou=users"));
  AuthenticationSource source=new SpringSecurityAuthenticationSource();
  SecurityContextHolder.getContext().setAuthentication(new TestingAuthenticationToken(user.createUserDetails(),null));
  assertThat(source.getPrincipal()).isEqualTo("uid=joe,ou=users");
}
