@Test public void authenticationPrincipalExpressionWhenBeanExpressionSuppliedThenBeanUsed() throws Exception {
  User user=new User("user","password",AuthorityUtils.createAuthorityList("ROLE_USER"));
  SecurityContext context=SecurityContextHolder.createEmptyContext();
  context.setAuthentication(new UsernamePasswordAuthenticationToken(user,user.getPassword(),user.getAuthorities()));
  SecurityContextHolder.setContext(context);
  MockMvc mockMvc=MockMvcBuilders.webAppContextSetup(wac).build();
  mockMvc.perform(get("/users/self")).andExpect(status().isOk()).andExpect(content().string("extracted-user"));
}
