@Test public void decodeWhenUsingSignedJwtThenReturnsClaimsGivenByClaimSetConverter() throws Exception {
  try (MockWebServer server=new MockWebServer()){
    server.enqueue(new MockResponse().setBody(JWK_SET));
    String jwkSetUrl=server.url("/.well-known/jwks.json").toString();
    NimbusJwtDecoderJwkSupport decoder=new NimbusJwtDecoderJwkSupport(jwkSetUrl);
    Converter<Map<String,Object>,Map<String,Object>> claimSetConverter=mock(Converter.class);
    when(claimSetConverter.convert(any(Map.class))).thenReturn(Collections.singletonMap("custom","value"));
    decoder.setClaimSetConverter(claimSetConverter);
    Jwt jwt=decoder.decode(SIGNED_JWT);
    assertThat(jwt.getClaims().size()).isEqualTo(1);
    assertThat(jwt.getClaims().get("custom")).isEqualTo("value");
  }
 }
