@Test public void decodeWhenJwtValidationHasTwoErrorsThenJwtExceptionMessageShowsFirstError() throws Exception {
  try (MockWebServer server=new MockWebServer()){
    server.enqueue(new MockResponse().setBody(JWK_SET));
    String jwkSetUrl=server.url("/.well-known/jwks.json").toString();
    NimbusJwtDecoderJwkSupport decoder=new NimbusJwtDecoderJwkSupport(jwkSetUrl);
    OAuth2Error firstFailure=new OAuth2Error("mock-error","mock-description","mock-uri");
    OAuth2Error secondFailure=new OAuth2Error("another-error","another-description","another-uri");
    OAuth2TokenValidatorResult result=OAuth2TokenValidatorResult.failure(firstFailure,secondFailure);
    OAuth2TokenValidator<Jwt> jwtValidator=mock(OAuth2TokenValidator.class);
    when(jwtValidator.validate(any(Jwt.class))).thenReturn(result);
    decoder.setJwtValidator(jwtValidator);
    assertThatCode(() -> decoder.decode(SIGNED_JWT)).isInstanceOf(JwtValidationException.class).hasMessageContaining("mock-description").hasFieldOrPropertyWithValue("errors",Arrays.asList(firstFailure,secondFailure));
  }
 }
