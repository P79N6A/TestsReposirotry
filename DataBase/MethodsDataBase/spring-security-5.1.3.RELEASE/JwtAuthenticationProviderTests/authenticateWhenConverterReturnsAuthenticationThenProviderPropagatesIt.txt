@Test public void authenticateWhenConverterReturnsAuthenticationThenProviderPropagatesIt(){
  BearerTokenAuthenticationToken token=this.authentication();
  Object details=mock(Object.class);
  token.setDetails(details);
  Jwt jwt=this.jwt(Collections.singletonMap("some","value"));
  JwtAuthenticationToken authentication=new JwtAuthenticationToken(jwt);
  when(this.jwtDecoder.decode(token.getToken())).thenReturn(jwt);
  when(this.jwtAuthenticationConverter.convert(jwt)).thenReturn(authentication);
  assertThat(this.provider.authenticate(token)).isEqualTo(authentication).hasFieldOrPropertyWithValue("details",details);
}
