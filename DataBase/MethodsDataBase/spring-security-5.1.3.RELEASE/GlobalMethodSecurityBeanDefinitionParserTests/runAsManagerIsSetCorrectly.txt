@Test public void runAsManagerIsSetCorrectly() throws Exception {
  StaticApplicationContext parent=new StaticApplicationContext();
  MutablePropertyValues props=new MutablePropertyValues();
  props.addPropertyValue("key","blah");
  parent.registerSingleton("runAsMgr",RunAsManagerImpl.class,props);
  parent.refresh();
  setContext("<global-method-security run-as-manager-ref='runAsMgr'/>" + AUTH_PROVIDER_XML,parent);
  RunAsManagerImpl ram=(RunAsManagerImpl)appContext.getBean("runAsMgr");
  MethodSecurityMetadataSourceAdvisor msi=(MethodSecurityMetadataSourceAdvisor)appContext.getBeansOfType(MethodSecurityMetadataSourceAdvisor.class).values().toArray()[0];
  assertThat(ram).isSameAs(FieldUtils.getFieldValue(msi.getAdvice(),"runAsManager"));
}
