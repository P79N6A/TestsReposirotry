@Test public void formLoginWorks(){
  this.spring.register(Config.class).autowire();
  WebTestClient client=WebTestClientBuilder.bindToWebFilters(this.springSecurityFilterChain,(exchange,chain) -> Mono.subscriberContext().flatMap(c -> c.<Mono<Principal>>get(Authentication.class)).flatMap(principal -> exchange.getResponse().writeWith(Mono.just(toDataBuffer(principal.getName()))))).build();
  MultiValueMap<String,String> data=new LinkedMultiValueMap<>();
  data.add("username","user");
  data.add("password","password");
  client.mutateWith(csrf()).post().uri("/login").body(BodyInserters.fromFormData(data)).exchange().expectStatus().is3xxRedirection().expectHeader().valueMatches("Location","/");
}
