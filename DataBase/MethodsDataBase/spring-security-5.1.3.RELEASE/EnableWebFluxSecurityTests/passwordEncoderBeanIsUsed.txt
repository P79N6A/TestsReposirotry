@Test public void passwordEncoderBeanIsUsed(){
  this.spring.register(CustomPasswordEncoderConfig.class).autowire();
  WebTestClient client=WebTestClientBuilder.bindToWebFilters(this.springSecurityFilterChain,(exchange,chain) -> ReactiveSecurityContextHolder.getContext().map(SecurityContext::getAuthentication).flatMap(principal -> exchange.getResponse().writeWith(Mono.just(toDataBuffer(principal.getName()))))).build();
  client.get().uri("/").headers(headers -> headers.setBasicAuth("user","password")).exchange().expectStatus().isOk().expectBody(String.class).consumeWith(result -> assertThat(result.getResponseBody()).isEqualTo("user"));
}
