@Test public void authenticationWhenOAuth2UserFoundThenSuccess(){
  OAuth2AccessTokenResponse accessTokenResponse=OAuth2AccessTokenResponse.withToken("foo").tokenType(OAuth2AccessToken.TokenType.BEARER).build();
  when(this.accessTokenResponseClient.getTokenResponse(any())).thenReturn(Mono.just(accessTokenResponse));
  DefaultOAuth2User user=new DefaultOAuth2User(AuthorityUtils.createAuthorityList("ROLE_USER"),Collections.singletonMap("user","rob"),"user");
  when(this.userService.loadUser(any())).thenReturn(Mono.just(user));
  OAuth2LoginAuthenticationToken result=(OAuth2LoginAuthenticationToken)this.manager.authenticate(loginToken()).block();
  assertThat(result.getPrincipal()).isEqualTo(user);
  assertThat(result.getAuthorities()).containsOnlyElementsOf(user.getAuthorities());
  assertThat(result.isAuthenticated()).isTrue();
}
