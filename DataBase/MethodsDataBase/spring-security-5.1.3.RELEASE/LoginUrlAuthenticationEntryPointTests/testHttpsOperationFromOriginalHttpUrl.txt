@Test public void testHttpsOperationFromOriginalHttpUrl() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestURI("/some_path");
  request.setScheme("http");
  request.setServerName("www.example.com");
  request.setContextPath("/bigWebApp");
  request.setServerPort(80);
  MockHttpServletResponse response=new MockHttpServletResponse();
  LoginUrlAuthenticationEntryPoint ep=new LoginUrlAuthenticationEntryPoint("/hello");
  ep.setPortMapper(new PortMapperImpl());
  ep.setForceHttps(true);
  ep.setPortMapper(new PortMapperImpl());
  ep.setPortResolver(new MockPortResolver(80,443));
  ep.afterPropertiesSet();
  ep.commence(request,response,null);
  assertThat(response.getRedirectedUrl()).isEqualTo("https://www.example.com/bigWebApp/hello");
  request.setServerPort(8080);
  response=new MockHttpServletResponse();
  ep.setPortResolver(new MockPortResolver(8080,8443));
  ep.commence(request,response,null);
  assertThat(response.getRedirectedUrl()).isEqualTo("https://www.example.com:8443/bigWebApp/hello");
  request.setServerPort(8888);
  response=new MockHttpServletResponse();
  ep.commence(request,response,null);
  assertThat(response.getRedirectedUrl()).isEqualTo("https://www.example.com:8443/bigWebApp/hello");
  PortMapperImpl portMapper=new PortMapperImpl();
  Map<String,String> map=new HashMap<>();
  map.put("8888","9999");
  portMapper.setPortMappings(map);
  response=new MockHttpServletResponse();
  ep=new LoginUrlAuthenticationEntryPoint("/hello");
  ep.setPortMapper(new PortMapperImpl());
  ep.setForceHttps(true);
  ep.setPortMapper(portMapper);
  ep.setPortResolver(new MockPortResolver(8888,9999));
  ep.afterPropertiesSet();
  ep.commence(request,response,null);
  assertThat(response.getRedirectedUrl()).isEqualTo("https://www.example.com:9999/bigWebApp/hello");
}
