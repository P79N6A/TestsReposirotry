@Test public void testFailedAuthenticationThrowsException(){
  MockHttpServletRequest request=new MockHttpServletRequest("POST","/");
  request.addParameter(UsernamePasswordAuthenticationFilter.SPRING_SECURITY_FORM_USERNAME_KEY,"rod");
  UsernamePasswordAuthenticationFilter filter=new UsernamePasswordAuthenticationFilter();
  AuthenticationManager am=mock(AuthenticationManager.class);
  when(am.authenticate(any(Authentication.class))).thenThrow(new BadCredentialsException(""));
  filter.setAuthenticationManager(am);
  try {
    filter.attemptAuthentication(request,new MockHttpServletResponse());
    fail("Expected AuthenticationException");
  }
 catch (  AuthenticationException e) {
  }
}
