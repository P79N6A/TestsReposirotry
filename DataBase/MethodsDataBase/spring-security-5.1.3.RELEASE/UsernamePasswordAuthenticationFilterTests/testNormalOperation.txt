@Test public void testNormalOperation() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest("POST","/");
  request.addParameter(UsernamePasswordAuthenticationFilter.SPRING_SECURITY_FORM_USERNAME_KEY,"rod");
  request.addParameter(UsernamePasswordAuthenticationFilter.SPRING_SECURITY_FORM_PASSWORD_KEY,"koala");
  UsernamePasswordAuthenticationFilter filter=new UsernamePasswordAuthenticationFilter();
  filter.setAuthenticationManager(createAuthenticationManager());
  Authentication result=filter.attemptAuthentication(request,new MockHttpServletResponse());
  assertThat(result != null).isTrue();
  assertThat(((WebAuthenticationDetails)result.getDetails()).getRemoteAddress()).isEqualTo("127.0.0.1");
}
