@Test public void configureWhenRequestCacheProvidedAndClientAuthorizationRequiredExceptionThrownThenRequestCacheUsed() throws Exception {
  this.spring.register(OAuth2ClientConfig.class).autowire();
  MvcResult mvcResult=this.mockMvc.perform(get("/resource1").with(user("user1"))).andExpect(status().is3xxRedirection()).andReturn();
  assertThat(mvcResult.getResponse().getRedirectedUrl()).matches("https://provider.com/oauth2/authorize\\?response_type=code&client_id=client-1&scope=user&state=.{15,}&redirect_uri=http%3A%2F%2Flocalhost%2Fclient-1");
  verify(requestCache).saveRequest(any(HttpServletRequest.class),any(HttpServletResponse.class));
}
