@Test public void userDetails(){
  user(userDetails).postProcessRequest(request);
  verify(repository).saveContext(contextCaptor.capture(),eq(request),any(HttpServletResponse.class));
  SecurityContext context=contextCaptor.getValue();
  assertThat(context.getAuthentication()).isInstanceOf(UsernamePasswordAuthenticationToken.class);
  assertThat(context.getAuthentication().getPrincipal()).isSameAs(userDetails);
}
