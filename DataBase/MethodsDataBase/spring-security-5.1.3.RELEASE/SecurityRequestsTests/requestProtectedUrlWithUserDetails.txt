@Test public void requestProtectedUrlWithUserDetails() throws Exception {
  UserDetails user=userDetailsService.loadUserByUsername("user");
  mvc.perform(get("/").with(user(user))).andExpect(status().isNotFound()).andExpect(authenticated().withAuthenticationPrincipal(user));
}
