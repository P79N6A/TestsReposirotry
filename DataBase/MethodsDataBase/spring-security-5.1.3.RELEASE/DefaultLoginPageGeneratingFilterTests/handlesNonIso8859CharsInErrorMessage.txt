@Test public void handlesNonIso8859CharsInErrorMessage() throws Exception {
  DefaultLoginPageGeneratingFilter filter=new DefaultLoginPageGeneratingFilter(new UsernamePasswordAuthenticationFilter());
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/login");
  request.addParameter("login_error","true");
  MessageSourceAccessor messages=SpringSecurityMessageSource.getAccessor();
  String message=messages.getMessage("AbstractUserDetailsAuthenticationProvider.badCredentials","Bad credentials",Locale.KOREA);
  request.getSession().setAttribute(WebAttributes.AUTHENTICATION_EXCEPTION,new BadCredentialsException(message));
  filter.doFilter(request,new MockHttpServletResponse(),chain);
}
