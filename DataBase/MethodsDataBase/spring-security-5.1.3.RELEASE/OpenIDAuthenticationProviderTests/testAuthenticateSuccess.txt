@Test public void testAuthenticateSuccess(){
  OpenIDAuthenticationProvider provider=new OpenIDAuthenticationProvider();
  provider.setUserDetailsService(new MockUserDetailsService());
  Authentication preAuth=new OpenIDAuthenticationToken(OpenIDAuthenticationStatus.SUCCESS,USERNAME,"",null);
  assertThat(preAuth.isAuthenticated()).isFalse();
  Authentication postAuth=provider.authenticate(preAuth);
  assertThat(postAuth).isNotNull();
  assertThat(postAuth instanceof OpenIDAuthenticationToken).isTrue();
  assertThat(postAuth.isAuthenticated()).isTrue();
  assertThat(postAuth.getPrincipal()).isNotNull();
  assertThat(postAuth.getPrincipal() instanceof UserDetails).isTrue();
  assertThat(postAuth.getAuthorities()).isNotNull();
  assertThat(postAuth.getAuthorities().size() > 0).isTrue();
  assertThat(((OpenIDAuthenticationToken)postAuth).getStatus() == OpenIDAuthenticationStatus.SUCCESS).isTrue();
  assertThat(((OpenIDAuthenticationToken)postAuth).getMessage() == null).isTrue();
}
