@Test public void testAuthenticateSetupNeeded(){
  OpenIDAuthenticationProvider provider=new OpenIDAuthenticationProvider();
  provider.setUserDetailsService(new MockUserDetailsService());
  Authentication preAuth=new OpenIDAuthenticationToken(OpenIDAuthenticationStatus.SETUP_NEEDED,USERNAME,"",null);
  assertThat(preAuth.isAuthenticated()).isFalse();
  try {
    provider.authenticate(preAuth);
    fail("Should throw an AuthenticationException");
  }
 catch (  AuthenticationServiceException expected) {
    assertThat("The server responded setup was needed, which shouldn't happen").isEqualTo(expected.getMessage());
  }
}
