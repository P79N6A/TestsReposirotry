@Test public void testAuthenticateFailure(){
  OpenIDAuthenticationProvider provider=new OpenIDAuthenticationProvider();
  provider.setAuthenticationUserDetailsService(new UserDetailsByNameServiceWrapper<>(new MockUserDetailsService()));
  Authentication preAuth=new OpenIDAuthenticationToken(OpenIDAuthenticationStatus.FAILURE,USERNAME,"",null);
  assertThat(preAuth.isAuthenticated()).isFalse();
  try {
    provider.authenticate(preAuth);
    fail("Should throw an AuthenticationException");
  }
 catch (  BadCredentialsException expected) {
    assertThat("Log in failed - identity could not be verified").isEqualTo(expected.getMessage());
  }
}
