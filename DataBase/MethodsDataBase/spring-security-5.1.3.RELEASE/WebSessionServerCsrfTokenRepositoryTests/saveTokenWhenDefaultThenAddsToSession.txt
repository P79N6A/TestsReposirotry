@Test public void saveTokenWhenDefaultThenAddsToSession(){
  Mono<CsrfToken> result=this.repository.generateToken(this.exchange).delayUntil(t -> this.repository.saveToken(this.exchange,t));
  result.block();
  WebSession session=this.exchange.getSession().block();
  Map<String,Object> attributes=session.getAttributes();
  assertThat(session.isStarted()).isTrue();
  assertThat(attributes).hasSize(1);
  assertThat(attributes.values().iterator().next()).isInstanceOf(CsrfToken.class);
}
