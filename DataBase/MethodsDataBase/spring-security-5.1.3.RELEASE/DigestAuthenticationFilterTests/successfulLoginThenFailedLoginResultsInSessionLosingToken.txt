@Test public void successfulLoginThenFailedLoginResultsInSessionLosingToken() throws Exception {
  String responseDigest=DigestAuthUtils.generateDigest(false,USERNAME,REALM,PASSWORD,"GET",REQUEST_URI,QOP,NONCE,NC,CNONCE);
  request.addHeader("Authorization",createAuthorizationHeader(USERNAME,REALM,NONCE,REQUEST_URI,responseDigest,QOP,NC,CNONCE));
  executeFilterInContainerSimulator(filter,request,true);
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNotNull();
  responseDigest=DigestAuthUtils.generateDigest(false,USERNAME,REALM,"WRONG_PASSWORD","GET",REQUEST_URI,QOP,NONCE,NC,CNONCE);
  request=new MockHttpServletRequest();
  request.addHeader("Authorization",createAuthorizationHeader(USERNAME,REALM,NONCE,REQUEST_URI,responseDigest,QOP,NC,CNONCE));
  MockHttpServletResponse response=executeFilterInContainerSimulator(filter,request,false);
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNull();
  assertThat(response.getStatus()).isEqualTo(401);
}
