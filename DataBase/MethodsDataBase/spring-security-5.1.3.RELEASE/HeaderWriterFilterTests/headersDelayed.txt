@Test public void headersDelayed() throws Exception {
  HeaderWriterFilter filter=new HeaderWriterFilter(Arrays.<HeaderWriter>asList(this.writer1));
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,new FilterChain(){
    @Override public void doFilter(    ServletRequest request,    ServletResponse response) throws IOException, ServletException {
      verifyZeroInteractions(HeaderWriterFilterTests.this.writer1);
      response.flushBuffer();
      verify(HeaderWriterFilterTests.this.writer1).writeHeaders(any(HttpServletRequest.class),any(HttpServletResponse.class));
    }
  }
);
  verifyNoMoreInteractions(this.writer1);
}
