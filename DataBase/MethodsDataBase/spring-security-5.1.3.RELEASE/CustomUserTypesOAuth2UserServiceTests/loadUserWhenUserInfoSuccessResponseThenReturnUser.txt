@Test public void loadUserWhenUserInfoSuccessResponseThenReturnUser(){
  String userInfoResponse="{\n" + "	\"id\": \"12345\",\n" + "   \"name\": \"first last\",\n"+ "   \"login\": \"user1\",\n"+ "   \"email\": \"user1@example.com\"\n"+ "}\n";
  this.server.enqueue(jsonResponse(userInfoResponse));
  String userInfoUri=this.server.url("/user").toString();
  when(this.userInfoEndpoint.getUri()).thenReturn(userInfoUri);
  when(this.accessToken.getTokenValue()).thenReturn("access-token");
  OAuth2User user=this.userService.loadUser(new OAuth2UserRequest(this.clientRegistration,this.accessToken));
  assertThat(user.getName()).isEqualTo("first last");
  assertThat(user.getAttributes().size()).isEqualTo(4);
  assertThat(user.getAttributes().get("id")).isEqualTo("12345");
  assertThat(user.getAttributes().get("name")).isEqualTo("first last");
  assertThat(user.getAttributes().get("login")).isEqualTo("user1");
  assertThat(user.getAttributes().get("email")).isEqualTo("user1@example.com");
  assertThat(user.getAuthorities().size()).isEqualTo(1);
  assertThat(user.getAuthorities().iterator().next().getAuthority()).isEqualTo("ROLE_USER");
}
