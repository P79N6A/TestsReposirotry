@Test public void strategyIsInvokedIfUserIsNewlyAuthenticated() throws Exception {
  SecurityContextRepository repo=mock(SecurityContextRepository.class);
  SessionAuthenticationStrategy strategy=mock(SessionAuthenticationStrategy.class);
  SessionManagementFilter filter=new SessionManagementFilter(repo,strategy);
  HttpServletRequest request=new MockHttpServletRequest();
  authenticateUser();
  filter.doFilter(request,new MockHttpServletResponse(),new MockFilterChain());
  verify(strategy).onAuthentication(any(Authentication.class),any(HttpServletRequest.class),any(HttpServletResponse.class));
  filter.doFilter(request,new MockHttpServletResponse(),new MockFilterChain());
  verifyNoMoreInteractions(strategy);
}
