@Test public void responseIsRedirectedToTimeoutUrlIfSetAndSessionIsInvalid() throws Exception {
  SecurityContextRepository repo=mock(SecurityContextRepository.class);
  SessionAuthenticationStrategy strategy=mock(SessionAuthenticationStrategy.class);
  SessionManagementFilter filter=new SessionManagementFilter(repo,strategy);
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setRequestedSessionId("xxx");
  request.setRequestedSessionIdValid(false);
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,new MockFilterChain());
  assertThat(response.getRedirectedUrl()).isNull();
  request=new MockHttpServletRequest();
  request.setRequestedSessionId("xxx");
  request.setRequestedSessionIdValid(false);
  SimpleRedirectInvalidSessionStrategy iss=new SimpleRedirectInvalidSessionStrategy("/timedOut");
  iss.setCreateNewSession(true);
  filter.setInvalidSessionStrategy(iss);
  FilterChain fc=mock(FilterChain.class);
  filter.doFilter(request,response,fc);
  verifyZeroInteractions(fc);
  assertThat(response.getRedirectedUrl()).isEqualTo("/timedOut");
}
