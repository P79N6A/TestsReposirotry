@Test public void loadUserWhenUserInfoErrorResponseWwwAuthenticateHeaderThenThrowOAuth2AuthenticationException(){
  this.exception.expect(OAuth2AuthenticationException.class);
  this.exception.expectMessage(containsString("[invalid_user_info_response] An error occurred while attempting to retrieve the UserInfo Resource"));
  this.exception.expectMessage(containsString("Error Code: insufficient_scope, Error Description: The access token expired"));
  String wwwAuthenticateHeader="Bearer realm=\"auth-realm\" error=\"insufficient_scope\" error_description=\"The access token expired\"";
  MockResponse response=new MockResponse();
  response.setHeader(HttpHeaders.WWW_AUTHENTICATE,wwwAuthenticateHeader);
  response.setResponseCode(400);
  this.server.enqueue(response);
  String userInfoUri=this.server.url("/user").toString();
  when(this.userInfoEndpoint.getUri()).thenReturn(userInfoUri);
  when(this.userInfoEndpoint.getAuthenticationMethod()).thenReturn(AuthenticationMethod.HEADER);
  when(this.userInfoEndpoint.getUserNameAttributeName()).thenReturn("user-name");
  when(this.accessToken.getTokenValue()).thenReturn("access-token");
  this.userService.loadUser(new OAuth2UserRequest(this.clientRegistration,this.accessToken));
}
