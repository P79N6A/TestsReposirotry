@Test public void detectsExpiredSessions() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpSession session=new MockHttpSession();
  request.setSession(session);
  MockHttpServletResponse response=new MockHttpServletResponse();
  SessionRegistry registry=new SessionRegistryImpl();
  registry.registerNewSession(session.getId(),"principal");
  registry.getSessionInformation(session.getId()).expireNow();
  SimpleRedirectSessionInformationExpiredStrategy expiredSessionStrategy=new SimpleRedirectSessionInformationExpiredStrategy("/expired.jsp");
  ConcurrentSessionFilter filter=new ConcurrentSessionFilter(registry,expiredSessionStrategy);
  filter.setLogoutHandlers(new LogoutHandler[]{new SecurityContextLogoutHandler()});
  filter.afterPropertiesSet();
  FilterChain fc=mock(FilterChain.class);
  filter.doFilter(request,response,fc);
  verifyZeroInteractions(fc);
  assertThat(response.getRedirectedUrl()).isEqualTo("/expired.jsp");
}
