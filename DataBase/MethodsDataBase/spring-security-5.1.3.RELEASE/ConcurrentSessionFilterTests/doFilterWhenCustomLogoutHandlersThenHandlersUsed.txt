@Test public void doFilterWhenCustomLogoutHandlersThenHandlersUsed() throws Exception {
  LogoutHandler handler=mock(LogoutHandler.class);
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpSession session=new MockHttpSession();
  request.setSession(session);
  MockHttpServletResponse response=new MockHttpServletResponse();
  SessionRegistry registry=mock(SessionRegistry.class);
  SessionInformation information=new SessionInformation("user","sessionId",new Date(System.currentTimeMillis() - 1000));
  information.expireNow();
  when(registry.getSessionInformation(anyString())).thenReturn(information);
  ConcurrentSessionFilter filter=new ConcurrentSessionFilter(registry);
  filter.setLogoutHandlers(new LogoutHandler[]{handler});
  filter.doFilter(request,response,new MockFilterChain());
  verify(handler).logout(eq(request),eq(response),any());
}
