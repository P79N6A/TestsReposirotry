@Test public void lastRequestTimeUpdatesCorrectly() throws Exception {
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpSession session=new MockHttpSession();
  request.setSession(session);
  MockHttpServletResponse response=new MockHttpServletResponse();
  FilterChain fc=mock(FilterChain.class);
  SessionRegistry registry=new SessionRegistryImpl();
  registry.registerNewSession(session.getId(),"principal");
  SimpleRedirectSessionInformationExpiredStrategy expiredSessionStrategy=new SimpleRedirectSessionInformationExpiredStrategy("/expired.jsp");
  ConcurrentSessionFilter filter=new ConcurrentSessionFilter(registry,expiredSessionStrategy);
  Date lastRequest=registry.getSessionInformation(session.getId()).getLastRequest();
  Thread.sleep(1000);
  filter.doFilter(request,response,fc);
  verify(fc).doFilter(request,response);
  assertThat(registry.getSessionInformation(session.getId()).getLastRequest().after(lastRequest)).isTrue();
}
