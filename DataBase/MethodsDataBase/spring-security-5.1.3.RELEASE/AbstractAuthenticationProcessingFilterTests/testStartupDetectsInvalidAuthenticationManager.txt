@Test public void testStartupDetectsInvalidAuthenticationManager() throws Exception {
  AbstractAuthenticationProcessingFilter filter=new MockAuthenticationFilter();
  filter.setAuthenticationFailureHandler(failureHandler);
  successHandler.setDefaultTargetUrl("/");
  filter.setAuthenticationSuccessHandler(successHandler);
  filter.setFilterProcessesUrl("/login");
  try {
    filter.afterPropertiesSet();
    fail("Should have thrown IllegalArgumentException");
  }
 catch (  IllegalArgumentException expected) {
    assertThat(expected.getMessage()).isEqualTo("authenticationManager must be specified");
  }
}
