@Test public void testSuccessfulAuthenticationInvokesSuccessHandlerAndSetsContext() throws Exception {
  MockHttpServletRequest request=createMockAuthenticationRequest();
  MockFilterConfig config=new MockFilterConfig(null,null);
  MockFilterChain chain=new MockFilterChain(true);
  MockHttpServletResponse response=new MockHttpServletResponse();
  MockAuthenticationFilter filter=new MockAuthenticationFilter(true);
  filter.setFilterProcessesUrl("/j_mock_post");
  AuthenticationSuccessHandler successHandler=mock(AuthenticationSuccessHandler.class);
  filter.setAuthenticationSuccessHandler(successHandler);
  filter.doFilter(request,response,chain);
  verify(successHandler).onAuthenticationSuccess(any(HttpServletRequest.class),any(HttpServletResponse.class),any(Authentication.class));
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNotNull();
}
