/** 
 * SEC-1919
 */
@Test public void loginErrorWithInternAuthenticationServiceExceptionLogsError() throws Exception {
  MockHttpServletRequest request=createMockAuthenticationRequest();
  MockFilterChain chain=new MockFilterChain(true);
  MockHttpServletResponse response=new MockHttpServletResponse();
  Log logger=mock(Log.class);
  MockAuthenticationFilter filter=new MockAuthenticationFilter(false);
  ReflectionTestUtils.setField(filter,"logger",logger);
  filter.exceptionToThrow=new InternalAuthenticationServiceException("Mock requested to do so");
  successHandler.setDefaultTargetUrl("http://monkeymachine.co.uk/");
  filter.setAuthenticationSuccessHandler(successHandler);
  filter.doFilter(request,response,chain);
  verify(logger).error(anyString(),eq(filter.exceptionToThrow));
  assertThat(response.getStatus()).isEqualTo(HttpServletResponse.SC_UNAUTHORIZED);
}
