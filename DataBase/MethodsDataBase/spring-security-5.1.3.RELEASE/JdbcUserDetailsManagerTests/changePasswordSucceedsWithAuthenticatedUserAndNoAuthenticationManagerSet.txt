@Test public void changePasswordSucceedsWithAuthenticatedUserAndNoAuthenticationManagerSet(){
  insertJoe();
  authenticateJoe();
  manager.changePassword("wrongpassword","newPassword");
  UserDetails newJoe=manager.loadUserByUsername("joe");
  assertThat(newJoe.getPassword()).isEqualTo("newPassword");
  assertThat(cache.getUserMap().containsKey("joe")).isFalse();
}
