@Test public void onAuthenticationSuccessHasSavedRequest() throws Exception {
  String redirectUrl="http://localhost/appcontext/page";
  RedirectStrategy redirectStrategy=mock(RedirectStrategy.class);
  RequestCache requestCache=mock(RequestCache.class);
  SavedRequest savedRequest=mock(SavedRequest.class);
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  when(savedRequest.getRedirectUrl()).thenReturn(redirectUrl);
  when(requestCache.getRequest(request,response)).thenReturn(savedRequest);
  SavedRequestAwareAuthenticationSuccessHandler handler=new SavedRequestAwareAuthenticationSuccessHandler();
  handler.setRequestCache(requestCache);
  handler.setRedirectStrategy(redirectStrategy);
  handler.onAuthenticationSuccess(request,response,mock(Authentication.class));
  verify(redirectStrategy).sendRedirect(request,response,redirectUrl);
}
