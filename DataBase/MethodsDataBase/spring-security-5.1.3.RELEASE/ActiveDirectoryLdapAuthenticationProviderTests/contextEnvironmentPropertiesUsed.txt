@Test public void contextEnvironmentPropertiesUsed() throws Exception {
  Hashtable<String,Object> env=new Hashtable<>();
  env.put("java.naming.ldap.factory.socket","unknown.package.NonExistingSocketFactory");
  provider.setContextEnvironmentProperties(env);
  try {
    provider.authenticate(joe);
    fail("CommunicationException was expected with a root cause of ClassNotFoundException");
  }
 catch (  org.springframework.ldap.CommunicationException expected) {
    assertThat(expected.getRootCause()).isInstanceOf(ClassNotFoundException.class);
  }
}
