@Test(expected=BadCredentialsException.class) public void failedUserSearchCausesBadCredentials() throws Exception {
  DirContext ctx=mock(DirContext.class);
  when(ctx.getNameInNamespace()).thenReturn("");
  when(ctx.search(any(Name.class),any(String.class),any(Object[].class),any(SearchControls.class))).thenThrow(new NameNotFoundException());
  provider.contextFactory=createContextFactoryReturning(ctx);
  provider.authenticate(joe);
}
