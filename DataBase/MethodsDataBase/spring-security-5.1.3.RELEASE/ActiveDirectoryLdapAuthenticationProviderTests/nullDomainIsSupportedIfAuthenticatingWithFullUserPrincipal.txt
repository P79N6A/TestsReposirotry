@Test public void nullDomainIsSupportedIfAuthenticatingWithFullUserPrincipal() throws Exception {
  provider=new ActiveDirectoryLdapAuthenticationProvider(null,"ldap://192.168.1.200/");
  DirContext ctx=mock(DirContext.class);
  when(ctx.getNameInNamespace()).thenReturn("");
  DirContextAdapter dca=new DirContextAdapter();
  SearchResult sr=new SearchResult("CN=Joe Jannsen,CN=Users",dca,dca.getAttributes());
  when(ctx.search(eq(new DistinguishedName("DC=mydomain,DC=eu")),any(String.class),any(Object[].class),any(SearchControls.class))).thenReturn(new MockNamingEnumeration(sr));
  provider.contextFactory=createContextFactoryReturning(ctx);
  try {
    provider.authenticate(joe);
    fail("Expected BadCredentialsException for user with no domain information");
  }
 catch (  BadCredentialsException expected) {
  }
  provider.authenticate(new UsernamePasswordAuthenticationToken("joe@mydomain.eu","password"));
}
