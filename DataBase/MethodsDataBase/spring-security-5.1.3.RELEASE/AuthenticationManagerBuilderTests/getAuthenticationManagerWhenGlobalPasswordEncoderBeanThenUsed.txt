@Test public void getAuthenticationManagerWhenGlobalPasswordEncoderBeanThenUsed() throws Exception {
  this.spring.register(PasswordEncoderGlobalConfig.class).autowire();
  AuthenticationManager manager=this.spring.getContext().getBean(AuthenticationConfiguration.class).getAuthenticationManager();
  Authentication auth=manager.authenticate(new UsernamePasswordAuthenticationToken("user","password"));
  assertThat(auth.getName()).isEqualTo("user");
  assertThat(auth.getAuthorities()).extracting(GrantedAuthority::getAuthority).containsOnly("ROLE_USER");
}
