@Test public void customAuthenticationEventPublisherWithWeb() throws Exception {
  ObjectPostProcessor<Object> opp=mock(ObjectPostProcessor.class);
  AuthenticationEventPublisher aep=mock(AuthenticationEventPublisher.class);
  when(opp.postProcess(any())).thenAnswer(a -> a.getArgument(0));
  AuthenticationManager am=new AuthenticationManagerBuilder(opp).authenticationEventPublisher(aep).inMemoryAuthentication().and().build();
  try {
    am.authenticate(new UsernamePasswordAuthenticationToken("user","password"));
  }
 catch (  AuthenticationException success) {
  }
  verify(aep).publishAuthenticationFailure(any(),any());
}
