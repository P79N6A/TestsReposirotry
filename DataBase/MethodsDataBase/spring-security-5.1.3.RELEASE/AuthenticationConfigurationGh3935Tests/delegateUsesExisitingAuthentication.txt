@Test public void delegateUsesExisitingAuthentication(){
  String username="user";
  String password="password";
  when(this.uds.loadUserByUsername(username)).thenReturn(PasswordEncodedUser.user());
  AuthenticationManager authenticationManager=this.adapter.authenticationManager;
  assertThat(authenticationManager).isNotNull();
  Authentication auth=authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(username,password));
  verify(this.uds).loadUserByUsername(username);
  assertThat(auth.getPrincipal()).isEqualTo(PasswordEncodedUser.user());
}
