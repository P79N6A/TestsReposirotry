@Test public void refererIsUsedIfUseRefererIsSet() throws Exception {
  SimpleUrlAuthenticationSuccessHandler ash=new SimpleUrlAuthenticationSuccessHandler("/defaultTarget");
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  ash.setUseReferer(true);
  request.addHeader("Referer","http://www.springsource.com/");
  ash.onAuthenticationSuccess(request,response,mock(Authentication.class));
  assertThat(response.getRedirectedUrl()).isEqualTo("http://www.springsource.com/");
}
