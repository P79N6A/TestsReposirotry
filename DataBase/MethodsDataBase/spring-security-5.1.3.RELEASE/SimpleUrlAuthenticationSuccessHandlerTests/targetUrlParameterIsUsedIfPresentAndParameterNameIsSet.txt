/** 
 * SEC-213
 */
@Test public void targetUrlParameterIsUsedIfPresentAndParameterNameIsSet() throws Exception {
  SimpleUrlAuthenticationSuccessHandler ash=new SimpleUrlAuthenticationSuccessHandler("/defaultTarget");
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  request.setParameter("targetUrl","/target");
  ash.onAuthenticationSuccess(request,response,mock(Authentication.class));
  assertThat(response.getRedirectedUrl()).isEqualTo("/defaultTarget");
  ash.setTargetUrlParameter("targetUrl");
  response=new MockHttpServletResponse();
  ash.onAuthenticationSuccess(request,response,mock(Authentication.class));
  assertThat(response.getRedirectedUrl()).isEqualTo("/target");
}
