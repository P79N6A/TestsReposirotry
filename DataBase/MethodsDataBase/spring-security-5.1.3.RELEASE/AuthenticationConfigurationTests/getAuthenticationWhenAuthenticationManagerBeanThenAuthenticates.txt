@Test public void getAuthenticationWhenAuthenticationManagerBeanThenAuthenticates() throws Exception {
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("user","password");
  this.spring.register(AuthenticationConfiguration.class,ObjectPostProcessorConfiguration.class,AuthenticationManagerBeanConfig.class).autowire();
  AuthenticationManager authentication=this.spring.getContext().getBean(AuthenticationConfiguration.class).getAuthenticationManager();
  when(authentication.authenticate(token)).thenReturn(TestAuthentication.authenticatedUser());
  assertThat(authentication.authenticate(token).getName()).isEqualTo(token.getName());
}
