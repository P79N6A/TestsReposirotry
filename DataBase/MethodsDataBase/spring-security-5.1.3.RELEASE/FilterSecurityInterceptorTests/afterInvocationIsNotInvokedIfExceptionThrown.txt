@Test public void afterInvocationIsNotInvokedIfExceptionThrown() throws Exception {
  Authentication token=new TestingAuthenticationToken("Test","Password","NOT_USED");
  SecurityContextHolder.getContext().setAuthentication(token);
  FilterInvocation fi=createinvocation();
  FilterChain chain=fi.getChain();
  doThrow(new RuntimeException()).when(chain).doFilter(any(HttpServletRequest.class),any(HttpServletResponse.class));
  when(ods.getAttributes(fi)).thenReturn(SecurityConfig.createList("MOCK_OK"));
  AfterInvocationManager aim=mock(AfterInvocationManager.class);
  interceptor.setAfterInvocationManager(aim);
  try {
    interceptor.invoke(fi);
    fail("Expected exception");
  }
 catch (  RuntimeException expected) {
  }
  verifyZeroInteractions(aim);
}
