/** 
 * SEC-2057
 */
@Test public void autowireWhenConcurrencyControlIsSetThenLogoutHandlersGetAuthenticationObject() throws Exception {
  this.spring.configLocations(this.xml("ConcurrencyControlCustomLogoutHandler")).autowire();
  MvcResult result=this.mvc.perform(get("/auth").with(httpBasic("user","password"))).andExpect(session()).andReturn();
  MockHttpSession session=(MockHttpSession)result.getRequest().getSession(false);
  SessionRegistry sessionRegistry=this.spring.getContext().getBean(SessionRegistry.class);
  sessionRegistry.getSessionInformation(session.getId()).expireNow();
  this.mvc.perform(get("/auth").session(session)).andExpect(header().string("X-Username","user"));
}
