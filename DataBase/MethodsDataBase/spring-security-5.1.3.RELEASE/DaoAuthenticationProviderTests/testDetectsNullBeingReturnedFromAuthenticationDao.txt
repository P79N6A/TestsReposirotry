@Test public void testDetectsNullBeingReturnedFromAuthenticationDao(){
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("rod","koala");
  DaoAuthenticationProvider provider=createProvider();
  provider.setUserDetailsService(new MockUserDetailsServiceReturnsNull());
  try {
    provider.authenticate(token);
    fail("Should have thrown AuthenticationServiceException");
  }
 catch (  AuthenticationServiceException expected) {
    assertThat("UserDetailsService returned null, which is an interface contract violation").isEqualTo(expected.getMessage());
  }
}
