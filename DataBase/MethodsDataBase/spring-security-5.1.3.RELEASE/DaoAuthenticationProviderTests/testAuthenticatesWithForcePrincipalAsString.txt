@Test public void testAuthenticatesWithForcePrincipalAsString(){
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("rod","koala");
  DaoAuthenticationProvider provider=createProvider();
  provider.setUserDetailsService(new MockUserDetailsServiceUserRod());
  provider.setUserCache(new MockUserCache());
  provider.setForcePrincipalAsString(true);
  Authentication result=provider.authenticate(token);
  if (!(result instanceof UsernamePasswordAuthenticationToken)) {
    fail("Should have returned instance of UsernamePasswordAuthenticationToken");
  }
  UsernamePasswordAuthenticationToken castResult=(UsernamePasswordAuthenticationToken)result;
  assertThat(castResult.getPrincipal().getClass()).isEqualTo(String.class);
  assertThat(castResult.getPrincipal()).isEqualTo("rod");
}
