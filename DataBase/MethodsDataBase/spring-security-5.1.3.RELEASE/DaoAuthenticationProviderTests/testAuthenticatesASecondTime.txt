@Test public void testAuthenticatesASecondTime(){
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("rod","koala");
  DaoAuthenticationProvider provider=createProvider();
  provider.setUserDetailsService(new MockUserDetailsServiceUserRod());
  provider.setUserCache(new MockUserCache());
  Authentication result=provider.authenticate(token);
  if (!(result instanceof UsernamePasswordAuthenticationToken)) {
    fail("Should have returned instance of UsernamePasswordAuthenticationToken");
  }
  Authentication result2=provider.authenticate(result);
  if (!(result2 instanceof UsernamePasswordAuthenticationToken)) {
    fail("Should have returned instance of UsernamePasswordAuthenticationToken");
  }
  assertThat(result2.getCredentials()).isEqualTo(result.getCredentials());
}
