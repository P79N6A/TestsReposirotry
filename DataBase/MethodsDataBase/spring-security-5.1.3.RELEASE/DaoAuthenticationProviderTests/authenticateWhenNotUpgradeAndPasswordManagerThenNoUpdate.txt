@Test public void authenticateWhenNotUpgradeAndPasswordManagerThenNoUpdate(){
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("user","password");
  PasswordEncoder encoder=mock(PasswordEncoder.class);
  UserDetailsService userDetailsService=mock(UserDetailsService.class);
  UserDetailsPasswordService passwordManager=mock(UserDetailsPasswordService.class);
  DaoAuthenticationProvider provider=new DaoAuthenticationProvider();
  provider.setPasswordEncoder(encoder);
  provider.setUserDetailsService(userDetailsService);
  provider.setUserDetailsPasswordService(passwordManager);
  UserDetails user=PasswordEncodedUser.user();
  when(encoder.matches(any(),any())).thenReturn(true);
  when(encoder.upgradeEncoding(any())).thenReturn(false);
  when(userDetailsService.loadUserByUsername(any())).thenReturn(user);
  Authentication result=provider.authenticate(token);
  verifyZeroInteractions(passwordManager);
}
