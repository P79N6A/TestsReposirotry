@Test public void testGoesBackToAuthenticationDaoToObtainLatestPasswordIfCachedPasswordSeemsIncorrect(){
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("rod","koala");
  MockUserDetailsServiceUserRod authenticationDao=new MockUserDetailsServiceUserRod();
  MockUserCache cache=new MockUserCache();
  DaoAuthenticationProvider provider=createProvider();
  provider.setUserDetailsService(authenticationDao);
  provider.setUserCache(cache);
  provider.authenticate(token);
  assertThat(cache.getUserFromCache("rod").getPassword()).isEqualTo("koala");
  authenticationDao.setPassword("easternLongNeckTurtle");
  token=new UsernamePasswordAuthenticationToken("rod","easternLongNeckTurtle");
  provider.authenticate(token);
  assertThat(cache.getUserFromCache("rod").getPassword()).isEqualTo("easternLongNeckTurtle");
}
