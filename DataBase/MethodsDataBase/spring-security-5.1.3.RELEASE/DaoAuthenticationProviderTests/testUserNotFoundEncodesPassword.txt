@Test public void testUserNotFoundEncodesPassword() throws Exception {
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken("missing","koala");
  PasswordEncoder encoder=mock(PasswordEncoder.class);
  when(encoder.encode(anyString())).thenReturn("koala");
  DaoAuthenticationProvider provider=new DaoAuthenticationProvider();
  provider.setHideUserNotFoundExceptions(false);
  provider.setPasswordEncoder(encoder);
  provider.setUserDetailsService(new MockUserDetailsServiceUserRod());
  provider.afterPropertiesSet();
  try {
    provider.authenticate(token);
    fail("Expected Exception");
  }
 catch (  UsernameNotFoundException success) {
  }
  verify(encoder).matches(isA(String.class),isA(String.class));
}
