@Test public void logoutRemovesCsrfTokenAndSavesNew(){
  when(this.csrfTokenRepository.loadToken(this.request)).thenReturn(this.existingToken);
  when(this.csrfTokenRepository.generateToken(this.request)).thenReturn(this.generatedToken);
  this.strategy.onAuthentication(new TestingAuthenticationToken("user","password","ROLE_USER"),this.request,this.response);
  verify(this.csrfTokenRepository).saveToken(null,this.request,this.response);
  verify(this.csrfTokenRepository).saveToken(eq(this.generatedToken),any(HttpServletRequest.class),any(HttpServletResponse.class));
  CsrfToken tokenInRequest=(CsrfToken)this.request.getAttribute(CsrfToken.class.getName());
  assertThat(tokenInRequest.getToken()).isSameAs(this.generatedToken.getToken());
  assertThat(tokenInRequest.getHeaderName()).isSameAs(this.generatedToken.getHeaderName());
  assertThat(tokenInRequest.getParameterName()).isSameAs(this.generatedToken.getParameterName());
  assertThat(this.request.getAttribute(this.generatedToken.getParameterName())).isSameAs(tokenInRequest);
}
