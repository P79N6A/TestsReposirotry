@Test public void delaySavingCsrf(){
  this.strategy=new CsrfAuthenticationStrategy(new LazyCsrfTokenRepository(this.csrfTokenRepository));
  when(this.csrfTokenRepository.loadToken(this.request)).thenReturn(this.existingToken);
  when(this.csrfTokenRepository.generateToken(this.request)).thenReturn(this.generatedToken);
  this.strategy.onAuthentication(new TestingAuthenticationToken("user","password","ROLE_USER"),this.request,this.response);
  verify(this.csrfTokenRepository).saveToken(null,this.request,this.response);
  verify(this.csrfTokenRepository,never()).saveToken(eq(this.generatedToken),any(HttpServletRequest.class),any(HttpServletResponse.class));
  CsrfToken tokenInRequest=(CsrfToken)this.request.getAttribute(CsrfToken.class.getName());
  tokenInRequest.getToken();
  verify(this.csrfTokenRepository).saveToken(eq(this.generatedToken),any(HttpServletRequest.class),any(HttpServletResponse.class));
}
