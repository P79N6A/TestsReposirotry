@Test public void useWithNullAuthoritiesPopulatorReturnsCorrectRole(){
  LdapAuthenticationProvider ldapProvider=new LdapAuthenticationProvider(new MockAuthenticator());
  LdapUserDetailsMapper userMapper=new LdapUserDetailsMapper();
  userMapper.setRoleAttributes(new String[]{"ou"});
  ldapProvider.setUserDetailsContextMapper(userMapper);
  UsernamePasswordAuthenticationToken authRequest=new UsernamePasswordAuthenticationToken("ben","benspassword");
  UserDetails user=(UserDetails)ldapProvider.authenticate(authRequest).getPrincipal();
  assertThat(user.getAuthorities()).hasSize(1);
  assertThat(AuthorityUtils.authorityListToSet(user.getAuthorities())).contains("ROLE_FROM_ENTRY");
}
