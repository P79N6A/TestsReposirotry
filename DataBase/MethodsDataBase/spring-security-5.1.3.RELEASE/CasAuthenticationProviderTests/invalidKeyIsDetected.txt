@Test(expected=BadCredentialsException.class) public void invalidKeyIsDetected() throws Exception {
  final Assertion assertion=new AssertionImpl("test");
  CasAuthenticationProvider cap=new CasAuthenticationProvider();
  cap.setAuthenticationUserDetailsService(new MockAuthoritiesPopulator());
  cap.setKey("qwerty");
  StatelessTicketCache cache=new MockStatelessTicketCache();
  cap.setStatelessTicketCache(cache);
  cap.setTicketValidator(new MockTicketValidator(true));
  cap.setServiceProperties(makeServiceProperties());
  cap.afterPropertiesSet();
  CasAuthenticationToken token=new CasAuthenticationToken("WRONG_KEY",makeUserDetails(),"credentials",AuthorityUtils.createAuthorityList("XX"),makeUserDetails(),assertion);
  cap.authenticate(token);
}
