@Test public void authenticateAllNullService() throws Exception {
  String serviceUrl="https://service/context";
  ServiceAuthenticationDetails details=mock(ServiceAuthenticationDetails.class);
  when(details.getServiceUrl()).thenReturn(serviceUrl);
  TicketValidator validator=mock(TicketValidator.class);
  when(validator.validate(any(String.class),any(String.class))).thenReturn(new AssertionImpl("rod"));
  ServiceProperties serviceProperties=makeServiceProperties();
  serviceProperties.setAuthenticateAllArtifacts(true);
  CasAuthenticationProvider cap=new CasAuthenticationProvider();
  cap.setAuthenticationUserDetailsService(new MockAuthoritiesPopulator());
  cap.setKey("qwerty");
  cap.setTicketValidator(validator);
  cap.setServiceProperties(serviceProperties);
  cap.afterPropertiesSet();
  String ticket="ST-456";
  UsernamePasswordAuthenticationToken token=new UsernamePasswordAuthenticationToken(CasAuthenticationFilter.CAS_STATELESS_IDENTIFIER,ticket);
  Authentication result=cap.authenticate(token);
}
