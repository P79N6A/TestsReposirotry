@Test public void switchAuthorityRoleCanBeChanged() throws Exception {
  String switchAuthorityRole="PREVIOUS_ADMINISTRATOR";
  UsernamePasswordAuthenticationToken source=new UsernamePasswordAuthenticationToken("orig","hawaii50",ROLES_12);
  SecurityContextHolder.getContext().setAuthentication(source);
  SecurityContextHolder.getContext().setAuthentication(switchToUser("jacklord"));
  Authentication switched=switchToUserWithAuthorityRole("dano",switchAuthorityRole);
  SwitchUserGrantedAuthority switchedFrom=null;
  for (  GrantedAuthority ga : switched.getAuthorities()) {
    if (ga instanceof SwitchUserGrantedAuthority) {
      switchedFrom=(SwitchUserGrantedAuthority)ga;
      break;
    }
  }
  assertThat(switchedFrom).isNotNull();
  assertThat(switchedFrom.getSource()).isSameAs(source);
  assertThat(switchAuthorityRole).isEqualTo(switchedFrom.getAuthority());
}
