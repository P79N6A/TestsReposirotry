@Test(expected=AuthenticationException.class) public void exitUserWithNoCurrentUserFails() throws Exception {
  SecurityContextHolder.clearContext();
  MockHttpServletRequest request=createMockSwitchRequest();
  request.setRequestURI("/logout/impersonate");
  SwitchUserFilter filter=new SwitchUserFilter();
  filter.setUserDetailsService(new MockUserDetailsService());
  filter.setExitUserUrl("/logout/impersonate");
  FilterChain chain=mock(FilterChain.class);
  MockHttpServletResponse response=new MockHttpServletResponse();
  filter.doFilter(request,response,chain);
  verify(chain,never()).doFilter(request,response);
}
