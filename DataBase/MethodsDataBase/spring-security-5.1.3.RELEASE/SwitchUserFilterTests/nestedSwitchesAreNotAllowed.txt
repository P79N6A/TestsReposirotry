@Test public void nestedSwitchesAreNotAllowed() throws Exception {
  UsernamePasswordAuthenticationToken source=new UsernamePasswordAuthenticationToken("orig","hawaii50",ROLES_12);
  SecurityContextHolder.getContext().setAuthentication(source);
  SecurityContextHolder.getContext().setAuthentication(switchToUser("jacklord"));
  Authentication switched=switchToUser("dano");
  SwitchUserGrantedAuthority switchedFrom=null;
  for (  GrantedAuthority ga : switched.getAuthorities()) {
    if (ga instanceof SwitchUserGrantedAuthority) {
      switchedFrom=(SwitchUserGrantedAuthority)ga;
      break;
    }
  }
  assertThat(switchedFrom).isNotNull();
  assertThat(source).isSameAs(switchedFrom.getSource());
}
