@Test public void requestWithRememberMeWhenUsingCustomDataSourceThenAutomaticallyReauthenticates() throws Exception {
  this.spring.configLocations(this.xml("WithDataSource")).autowire();
  TestDataSource dataSource=this.spring.getContext().getBean(TestDataSource.class);
  JdbcTemplate template=new JdbcTemplate(dataSource);
  template.execute(CREATE_TABLE_SQL);
  MvcResult result=this.rememberAuthentication("user","password").andExpect(cookie().secure(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,false)).andReturn();
  Cookie cookie=rememberMeCookie(result);
  this.mvc.perform(get("/authenticated").cookie(cookie)).andExpect(status().isOk());
  int count=template.queryForObject("select count(*) from persistent_logins",int.class);
  assertThat(count).isEqualTo(1);
}
