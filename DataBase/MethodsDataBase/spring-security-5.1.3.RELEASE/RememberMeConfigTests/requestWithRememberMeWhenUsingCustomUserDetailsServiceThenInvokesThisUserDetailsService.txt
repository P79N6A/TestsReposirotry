@Test public void requestWithRememberMeWhenUsingCustomUserDetailsServiceThenInvokesThisUserDetailsService() throws Exception {
  this.spring.configLocations(this.xml("WithUserDetailsService")).autowire();
  UserDetailsService userDetailsService=this.spring.getContext().getBean(UserDetailsService.class);
  when(userDetailsService.loadUserByUsername("user")).thenAnswer((invocation) -> new User("user","{noop}password",Collections.emptyList()));
  MvcResult result=this.rememberAuthentication("user","password").andReturn();
  Cookie cookie=rememberMeCookie(result);
  this.mvc.perform(get("/authenticated").cookie(cookie)).andExpect(status().isOk());
  verify(userDetailsService,atLeastOnce()).loadUserByUsername("user");
}
