@Test public void requestWithRememberMeWhenUsingCustomTokenRepositoryThenAutomaticallyReauthenticates() throws Exception {
  this.spring.configLocations(this.xml("WithTokenRepository")).autowire();
  MvcResult result=this.rememberAuthentication("user","password").andExpect(cookie().secure(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,false)).andReturn();
  Cookie cookie=rememberMeCookie(result);
  this.mvc.perform(get("/authenticated").cookie(cookie)).andExpect(status().isOk());
  JdbcTemplate template=this.spring.getContext().getBean(JdbcTemplate.class);
  int count=template.queryForObject("select count(*) from persistent_logins",int.class);
  assertThat(count).isEqualTo(1);
}
