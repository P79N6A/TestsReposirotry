@Test public void requestWithRememberMeWhenUsingCustomRememberMeServicesThenAuthenticates() throws Exception {
  this.spring.configLocations(this.xml("WithServicesRef")).autowire();
  MvcResult result=this.rememberAuthentication("user","password").andExpect(cookie().secure(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,false)).andExpect(cookie().maxAge(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,5000)).andReturn();
  Cookie cookie=rememberMeCookie(result);
  this.mvc.perform(get("/authenticated").cookie(cookie)).andExpect(status().isOk());
  this.mvc.perform(post("/logout").cookie(cookie).with(csrf())).andExpect(cookie().maxAge(SPRING_SECURITY_REMEMBER_ME_COOKIE_KEY,0)).andReturn();
}
