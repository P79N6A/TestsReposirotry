@Test @SuppressWarnings({"rawtypes","unchecked"}) public void beforeTestMethodNoApplicationContext() throws Exception {
  Class testClass=FakeTest.class;
  when(testContext.getApplicationContext()).thenThrow(new IllegalStateException());
  when(testContext.getTestMethod()).thenReturn(ReflectionUtils.findMethod(testClass,"testWithMockUser"));
  listener.beforeTestMethod(testContext);
  assertThat(TestSecurityContextHolder.getContext().getAuthentication().getName()).isEqualTo("user");
}
