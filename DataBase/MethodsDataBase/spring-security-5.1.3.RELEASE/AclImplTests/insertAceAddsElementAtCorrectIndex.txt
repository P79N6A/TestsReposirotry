@Test public void insertAceAddsElementAtCorrectIndex() throws Exception {
  MutableAcl acl=new AclImpl(objectIdentity,1,authzStrategy,pgs,null,null,true,new PrincipalSid("joe"));
  MockAclService service=new MockAclService();
  acl.insertAce(0,BasePermission.READ,new GrantedAuthoritySid("ROLE_TEST1"),true);
  service.updateAcl(acl);
  assertThat(acl.getEntries()).hasSize(1);
  assertThat(acl).isEqualTo(acl.getEntries().get(0).getAcl());
  assertThat(BasePermission.READ).isEqualTo(acl.getEntries().get(0).getPermission());
  assertThat(acl.getEntries().get(0).getSid()).isEqualTo(new GrantedAuthoritySid("ROLE_TEST1"));
  acl.insertAce(1,BasePermission.READ,new GrantedAuthoritySid("ROLE_TEST2"),true);
  service.updateAcl(acl);
  assertThat(acl.getEntries()).hasSize(2);
  assertThat(acl).isEqualTo(acl.getEntries().get(1).getAcl());
  assertThat(BasePermission.READ).isEqualTo(acl.getEntries().get(1).getPermission());
  assertThat(acl.getEntries().get(1).getSid()).isEqualTo(new GrantedAuthoritySid("ROLE_TEST2"));
  acl.insertAce(1,BasePermission.WRITE,new GrantedAuthoritySid("ROLE_TEST3"),false);
  service.updateAcl(acl);
  assertThat(acl.getEntries()).hasSize(3);
  assertThat(BasePermission.READ).isEqualTo(acl.getEntries().get(0).getPermission());
  assertThat(acl.getEntries().get(0).getSid()).isEqualTo(new GrantedAuthoritySid("ROLE_TEST1"));
  assertThat(BasePermission.WRITE).isEqualTo(acl.getEntries().get(1).getPermission());
  assertThat(acl.getEntries().get(1).getSid()).isEqualTo(new GrantedAuthoritySid("ROLE_TEST3"));
  assertThat(BasePermission.READ).isEqualTo(acl.getEntries().get(2).getPermission());
  assertThat(acl.getEntries().get(2).getSid()).isEqualTo(new GrantedAuthoritySid("ROLE_TEST2"));
}
