@Test public void auditableEntryFlagsAreUpdatedCorrectly() throws Exception {
  Authentication auth=new TestingAuthenticationToken("ben","ignored","ROLE_AUDITING","ROLE_GENERAL");
  auth.setAuthenticated(true);
  SecurityContextHolder.getContext().setAuthentication(auth);
  MutableAcl acl=new AclImpl(objectIdentity,1,authzStrategy,pgs,null,null,false,new PrincipalSid("joe"));
  MockAclService service=new MockAclService();
  acl.insertAce(0,BasePermission.READ,new GrantedAuthoritySid("ROLE_USER_READ"),true);
  acl.insertAce(1,BasePermission.WRITE,new GrantedAuthoritySid("ROLE_USER_READ"),true);
  service.updateAcl(acl);
  assertThat(((AuditableAccessControlEntry)acl.getEntries().get(0)).isAuditFailure()).isFalse();
  assertThat(((AuditableAccessControlEntry)acl.getEntries().get(1)).isAuditFailure()).isFalse();
  assertThat(((AuditableAccessControlEntry)acl.getEntries().get(0)).isAuditSuccess()).isFalse();
  assertThat(((AuditableAccessControlEntry)acl.getEntries().get(1)).isAuditSuccess()).isFalse();
  ((AuditableAcl)acl).updateAuditing(0,true,true);
  ((AuditableAcl)acl).updateAuditing(1,true,true);
  assertThat(acl.getEntries()).extracting("auditSuccess").containsOnly(true,true);
  assertThat(acl.getEntries()).extracting("auditFailure").containsOnly(true,true);
}
