@Test public void contextIsStillClearedIfExceptionIsThrowByFilterChain() throws Exception {
  final FilterChain chain=mock(FilterChain.class);
  final MockHttpServletRequest request=new MockHttpServletRequest();
  final MockHttpServletResponse response=new MockHttpServletResponse();
  SecurityContextPersistenceFilter filter=new SecurityContextPersistenceFilter();
  SecurityContextHolder.getContext().setAuthentication(testToken);
  doThrow(new IOException()).when(chain).doFilter(any(ServletRequest.class),any(ServletResponse.class));
  try {
    filter.doFilter(request,response,chain);
    fail("IOException should have been thrown");
  }
 catch (  IOException expected) {
  }
  assertThat(SecurityContextHolder.getContext().getAuthentication()).isNull();
}
