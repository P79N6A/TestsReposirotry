@Test public void authenticationSucceedsWithSupportedTokenAndReturnsExpectedObject() throws Exception {
  final Authentication a=mock(Authentication.class);
  ProviderManager mgr=new ProviderManager(Arrays.asList(createProviderWhichReturns(a)));
  AuthenticationEventPublisher publisher=mock(AuthenticationEventPublisher.class);
  mgr.setAuthenticationEventPublisher(publisher);
  Authentication result=mgr.authenticate(a);
  assertThat(result).isEqualTo(a);
  verify(publisher).publishAuthenticationSuccess(result);
}
