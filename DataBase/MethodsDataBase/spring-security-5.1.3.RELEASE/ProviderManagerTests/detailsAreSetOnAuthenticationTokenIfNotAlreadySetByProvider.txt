@Test public void detailsAreSetOnAuthenticationTokenIfNotAlreadySetByProvider() throws Exception {
  Object details=new Object();
  ProviderManager authMgr=makeProviderManager();
  TestingAuthenticationToken request=createAuthenticationToken();
  request.setDetails(details);
  Authentication result=authMgr.authenticate(request);
  assertThat(result.getCredentials()).isNotNull();
  assertThat(result.getDetails()).isSameAs(details);
}
