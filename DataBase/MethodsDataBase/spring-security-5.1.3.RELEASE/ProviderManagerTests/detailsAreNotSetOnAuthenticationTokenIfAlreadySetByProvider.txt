@Test public void detailsAreNotSetOnAuthenticationTokenIfAlreadySetByProvider() throws Exception {
  Object requestDetails="(Request Details)";
  final Object resultDetails="(Result Details)";
  AuthenticationProvider provider=new AuthenticationProvider(){
    public Authentication authenticate(    Authentication authentication) throws AuthenticationException {
      ((TestingAuthenticationToken)authentication).setDetails(resultDetails);
      return authentication;
    }
    public boolean supports(    Class<?> authentication){
      return true;
    }
  }
;
  ProviderManager authMgr=new ProviderManager(Arrays.asList(provider));
  TestingAuthenticationToken request=createAuthenticationToken();
  request.setDetails(requestDetails);
  Authentication result=authMgr.authenticate(request);
  assertThat(result.getDetails()).isEqualTo(resultDetails);
}
