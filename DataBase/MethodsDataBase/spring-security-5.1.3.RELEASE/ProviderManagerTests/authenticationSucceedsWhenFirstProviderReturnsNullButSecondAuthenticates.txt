@Test public void authenticationSucceedsWhenFirstProviderReturnsNullButSecondAuthenticates(){
  final Authentication a=mock(Authentication.class);
  ProviderManager mgr=new ProviderManager(Arrays.asList(createProviderWhichReturns(null),createProviderWhichReturns(a)));
  AuthenticationEventPublisher publisher=mock(AuthenticationEventPublisher.class);
  mgr.setAuthenticationEventPublisher(publisher);
  Authentication result=mgr.authenticate(a);
  assertThat(result).isSameAs(a);
  verify(publisher).publishAuthenticationSuccess(result);
}
