@Test public void authenticationExceptionFromParentOverridesPreviousOnes() throws Exception {
  AuthenticationManager parent=mock(AuthenticationManager.class);
  ProviderManager mgr=new ProviderManager(Arrays.asList(createProviderWhichThrows(new BadCredentialsException(""))),parent);
  final Authentication authReq=mock(Authentication.class);
  AuthenticationEventPublisher publisher=mock(AuthenticationEventPublisher.class);
  mgr.setAuthenticationEventPublisher(publisher);
  final BadCredentialsException expected=new BadCredentialsException("I'm the one from the parent");
  when(parent.authenticate(authReq)).thenThrow(expected);
  try {
    mgr.authenticate(authReq);
    fail("Expected exception");
  }
 catch (  BadCredentialsException e) {
    assertThat(e).isSameAs(expected);
  }
}
