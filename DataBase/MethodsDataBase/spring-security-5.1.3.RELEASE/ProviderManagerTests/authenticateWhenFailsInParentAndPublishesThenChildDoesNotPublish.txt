@Test public void authenticateWhenFailsInParentAndPublishesThenChildDoesNotPublish(){
  BadCredentialsException badCredentialsExParent=new BadCredentialsException("Bad Credentials in parent");
  ProviderManager parentMgr=new ProviderManager(Collections.singletonList(createProviderWhichThrows(badCredentialsExParent)));
  ProviderManager childMgr=new ProviderManager(Collections.singletonList(createProviderWhichThrows(new BadCredentialsException("Bad Credentials in child"))),parentMgr);
  AuthenticationEventPublisher publisher=mock(AuthenticationEventPublisher.class);
  parentMgr.setAuthenticationEventPublisher(publisher);
  childMgr.setAuthenticationEventPublisher(publisher);
  final Authentication authReq=mock(Authentication.class);
  try {
    childMgr.authenticate(authReq);
    fail("Expected exception");
  }
 catch (  BadCredentialsException e) {
    assertThat(e).isSameAs(badCredentialsExParent);
  }
  verify(publisher).publishAuthenticationFailure(badCredentialsExParent,authReq);
  verifyNoMoreInteractions(publisher);
}
