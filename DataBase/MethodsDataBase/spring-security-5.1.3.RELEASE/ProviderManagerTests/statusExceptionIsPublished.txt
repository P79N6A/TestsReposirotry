@Test @SuppressWarnings("deprecation") public void statusExceptionIsPublished() throws Exception {
  AuthenticationManager parent=mock(AuthenticationManager.class);
  final LockedException expected=new LockedException("");
  ProviderManager mgr=new ProviderManager(Arrays.asList(createProviderWhichThrows(expected)),parent);
  final Authentication authReq=mock(Authentication.class);
  AuthenticationEventPublisher publisher=mock(AuthenticationEventPublisher.class);
  mgr.setAuthenticationEventPublisher(publisher);
  try {
    mgr.authenticate(authReq);
    fail("Expected exception");
  }
 catch (  LockedException e) {
    assertThat(e).isSameAs(expected);
  }
  verify(publisher).publishAuthenticationFailure(expected,authReq);
}
