@Test public void requestWhenFormLoginAndResourceServerEntryPointsThenSessionCreatedByRequest() throws Exception {
  this.spring.register(FormAndResourceServerConfig.class,JwtDecoderConfig.class).autowire();
  JwtDecoder decoder=this.spring.getContext().getBean(JwtDecoder.class);
  when(decoder.decode(anyString())).thenThrow(JwtException.class);
  MvcResult result=this.mvc.perform(get("/authenticated")).andExpect(status().isFound()).andExpect(redirectedUrl("http://localhost/login")).andReturn();
  assertThat(result.getRequest().getSession(false)).isNotNull();
  result=this.mvc.perform(get("/authenticated").with(bearerToken("token"))).andExpect(status().isUnauthorized()).andReturn();
  assertThat(result.getRequest().getSession(false)).isNull();
}
