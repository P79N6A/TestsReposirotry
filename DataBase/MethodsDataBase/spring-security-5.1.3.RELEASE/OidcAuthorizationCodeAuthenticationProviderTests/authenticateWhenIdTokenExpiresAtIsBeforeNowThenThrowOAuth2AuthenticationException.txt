@Test public void authenticateWhenIdTokenExpiresAtIsBeforeNowThenThrowOAuth2AuthenticationException() throws Exception {
  this.exception.expect(OAuth2AuthenticationException.class);
  this.exception.expectMessage(containsString("invalid_id_token"));
  Map<String,Object> claims=new HashMap<>();
  claims.put(IdTokenClaimNames.ISS,"https://provider.com");
  claims.put(IdTokenClaimNames.SUB,"subject1");
  claims.put(IdTokenClaimNames.AUD,Arrays.asList("client1","client2"));
  claims.put(IdTokenClaimNames.AZP,"client1");
  Instant issuedAt=Instant.now().minusSeconds(10);
  Instant expiresAt=Instant.from(issuedAt).plusSeconds(5);
  this.setUpIdToken(claims,issuedAt,expiresAt);
  this.authenticationProvider.authenticate(new OAuth2LoginAuthenticationToken(this.clientRegistration,this.authorizationExchange));
}
