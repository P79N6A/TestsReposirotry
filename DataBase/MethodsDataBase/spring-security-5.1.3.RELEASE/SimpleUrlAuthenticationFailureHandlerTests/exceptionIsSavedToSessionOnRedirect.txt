@Test public void exceptionIsSavedToSessionOnRedirect() throws Exception {
  SimpleUrlAuthenticationFailureHandler afh=new SimpleUrlAuthenticationFailureHandler();
  afh.setDefaultFailureUrl("/target");
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  AuthenticationException e=mock(AuthenticationException.class);
  afh.onAuthenticationFailure(request,response,e);
  assertThat(request.getSession().getAttribute(WebAttributes.AUTHENTICATION_EXCEPTION)).isSameAs(e);
  assertThat(response.getRedirectedUrl()).isEqualTo("/target");
}
