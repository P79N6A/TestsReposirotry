@Test public void responseIsForwardedIfUseForwardIsTrue() throws Exception {
  SimpleUrlAuthenticationFailureHandler afh=new SimpleUrlAuthenticationFailureHandler("/target");
  afh.setUseForward(true);
  assertThat(afh.isUseForward()).isTrue();
  MockHttpServletRequest request=new MockHttpServletRequest();
  MockHttpServletResponse response=new MockHttpServletResponse();
  AuthenticationException e=mock(AuthenticationException.class);
  afh.onAuthenticationFailure(request,response,e);
  assertThat(request.getSession(false)).isNull();
  assertThat(response.getRedirectedUrl()).isNull();
  assertThat(response.getForwardedUrl()).isEqualTo("/target");
  assertThat(request.getAttribute(WebAttributes.AUTHENTICATION_EXCEPTION)).isSameAs(e);
}
