@Test public void withUsernameWhenPasswordAndPasswordEncoderTwiceThenEncodesOnce(){
  Function<String,String> encoder=p -> p + "encoded";
  UserDetails withEncodedPassword=User.withUsername("user").passwordEncoder(encoder).password("password").passwordEncoder(encoder).roles("USER").build();
  assertThat(withEncodedPassword.getPassword()).isEqualTo("passwordencoded");
}
