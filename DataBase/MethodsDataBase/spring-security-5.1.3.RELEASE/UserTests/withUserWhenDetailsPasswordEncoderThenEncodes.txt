@Test public void withUserWhenDetailsPasswordEncoderThenEncodes(){
  UserDetails userDetails=User.withUsername("user").password("password").roles("USER").build();
  UserDetails withEncodedPassword=User.withUserDetails(userDetails).passwordEncoder(p -> p + "encoded").build();
  assertThat(withEncodedPassword.getPassword()).isEqualTo("passwordencoded");
}
