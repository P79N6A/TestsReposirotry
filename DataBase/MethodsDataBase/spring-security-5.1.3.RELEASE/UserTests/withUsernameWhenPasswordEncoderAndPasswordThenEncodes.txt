@Test public void withUsernameWhenPasswordEncoderAndPasswordThenEncodes(){
  UserDetails withEncodedPassword=User.withUsername("user").password("password").passwordEncoder(p -> p + "encoded").roles("USER").build();
  assertThat(withEncodedPassword.getPassword()).isEqualTo("passwordencoded");
}
