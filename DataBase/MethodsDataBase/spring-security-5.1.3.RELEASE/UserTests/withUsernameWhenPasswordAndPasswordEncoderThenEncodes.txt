@Test public void withUsernameWhenPasswordAndPasswordEncoderThenEncodes(){
  UserDetails withEncodedPassword=User.withUsername("user").passwordEncoder(p -> p + "encoded").password("password").roles("USER").build();
  assertThat(withEncodedPassword.getPassword()).isEqualTo("passwordencoded");
}
