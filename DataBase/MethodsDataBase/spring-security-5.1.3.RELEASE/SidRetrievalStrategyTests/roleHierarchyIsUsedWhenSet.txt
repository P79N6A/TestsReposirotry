@Test public void roleHierarchyIsUsedWhenSet() throws Exception {
  RoleHierarchy rh=mock(RoleHierarchy.class);
  List rhAuthorities=AuthorityUtils.createAuthorityList("D");
  when(rh.getReachableGrantedAuthorities(anyCollection())).thenReturn(rhAuthorities);
  SidRetrievalStrategy strat=new SidRetrievalStrategyImpl(rh);
  List<Sid> sids=strat.getSids(authentication);
  assertThat(sids).hasSize(2);
  assertThat(sids.get(0)).isNotNull();
  assertThat(sids.get(0) instanceof PrincipalSid).isTrue();
  assertThat(((GrantedAuthoritySid)sids.get(1)).getGrantedAuthority()).isEqualTo("D");
}
