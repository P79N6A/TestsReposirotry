@Test public void doFilterInternalRegistersSecurityContextCallableProcessorContextUpdated() throws Exception {
  SecurityContextHolder.setContext(SecurityContextHolder.createEmptyContext());
  asyncManager.registerCallableInterceptors(new CallableProcessingInterceptorAdapter(){
    @Override public <T>void postProcess(    NativeWebRequest request,    Callable<T> task,    Object concurrentResult) throws Exception {
      assertThat(SecurityContextHolder.getContext()).isNotSameAs(securityContext);
    }
  }
);
  filter.doFilterInternal(request,response,filterChain);
  SecurityContextHolder.setContext(securityContext);
  VerifyingCallable verifyingCallable=new VerifyingCallable();
  asyncManager.startCallableProcessing(verifyingCallable);
  threadFactory.join();
  assertThat(asyncManager.getConcurrentResult()).isSameAs(securityContext);
}
