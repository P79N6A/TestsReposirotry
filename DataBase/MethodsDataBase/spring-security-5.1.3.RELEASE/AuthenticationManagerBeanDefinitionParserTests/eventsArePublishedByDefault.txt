@Test public void eventsArePublishedByDefault() throws Exception {
  ConfigurableApplicationContext appContext=this.spring.context(CONTEXT).getContext();
  AuthListener listener=new AuthListener();
  appContext.addApplicationListener(listener);
  ProviderManager pm=(ProviderManager)appContext.getBeansOfType(ProviderManager.class).values().toArray()[0];
  Object eventPublisher=FieldUtils.getFieldValue(pm,"eventPublisher");
  assertThat(eventPublisher).isNotNull();
  assertThat(eventPublisher instanceof DefaultAuthenticationEventPublisher).isTrue();
  pm.authenticate(new UsernamePasswordAuthenticationToken("bob","bobspassword"));
  assertThat(listener.events).hasSize(1);
}
