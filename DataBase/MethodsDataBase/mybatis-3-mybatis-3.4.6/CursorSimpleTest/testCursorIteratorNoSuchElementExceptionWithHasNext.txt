@Test public void testCursorIteratorNoSuchElementExceptionWithHasNext(){
  SqlSession sqlSession=sqlSessionFactory.openSession();
  Cursor<User> usersCursor=sqlSession.selectCursor("getAllUsers",null,new RowBounds(1,1));
  try {
    Iterator<User> iterator=usersCursor.iterator();
    User user=iterator.next();
    Assert.assertEquals("User2",user.getName());
    Assert.assertEquals(1,usersCursor.getCurrentIndex());
    Assert.assertFalse(iterator.hasNext());
    iterator.next();
    Assert.fail("We should have failed since we call next() when hasNext() returned false");
  }
 catch (  NoSuchElementException e) {
    Assert.assertFalse(usersCursor.isOpen());
    Assert.assertTrue(usersCursor.isConsumed());
  }
 finally {
    sqlSession.close();
  }
}
