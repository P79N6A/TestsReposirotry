@Test public void shouldGetAllUserUsingAnnotationBasedMapper(){
  SqlSession sqlSession=sqlSessionFactory.openSession();
  sqlSession.getConfiguration().getMapperRegistry().addMapper(AnnotationMapper.class);
  AnnotationMapper mapper=sqlSession.getMapper(AnnotationMapper.class);
  Cursor<User> usersCursor=mapper.getAllUsers();
  try {
    Assert.assertFalse(usersCursor.isOpen());
    Assert.assertFalse(usersCursor.isConsumed());
    Assert.assertEquals(-1,usersCursor.getCurrentIndex());
    List<User> userList=new ArrayList<User>();
    for (    User user : usersCursor) {
      userList.add(user);
      Assert.assertEquals(userList.size() - 1,usersCursor.getCurrentIndex());
    }
    Assert.assertFalse(usersCursor.isOpen());
    Assert.assertTrue(usersCursor.isConsumed());
    Assert.assertEquals(4,usersCursor.getCurrentIndex());
    Assert.assertEquals(5,userList.size());
    User user=userList.get(0);
    Assert.assertEquals("User1",user.getName());
    user=userList.get(1);
    Assert.assertEquals("User2",user.getName());
    user=userList.get(2);
    Assert.assertEquals("User3",user.getName());
    user=userList.get(3);
    Assert.assertEquals("User4",user.getName());
    user=userList.get(4);
    Assert.assertEquals("User5",user.getName());
  }
  finally {
    sqlSession.close();
  }
}
