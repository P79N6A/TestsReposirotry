@Test public void shouldInsertNewAuthorWithAutoKey() throws Exception {
  Executor executor=createExecutor(new JdbcTransaction(ds,null,false));
  try {
    Author author=new Author(-1,"someone","******","someone@apache.org",null,Section.NEWS);
    MappedStatement insertStatement=ExecutorTestHelper.prepareInsertAuthorMappedStatementWithAutoKey(config);
    MappedStatement selectStatement=ExecutorTestHelper.prepareSelectOneAuthorMappedStatement(config);
    int rows=executor.update(insertStatement,author);
    assertTrue(rows > 0 || rows == BatchExecutor.BATCH_UPDATE_RETURN_VALUE);
    if (rows == BatchExecutor.BATCH_UPDATE_RETURN_VALUE) {
      executor.flushStatements();
    }
    assertTrue(-1 != author.getId());
    if (author.getId() != BatchExecutor.BATCH_UPDATE_RETURN_VALUE) {
      List<Author> authors=executor.query(selectStatement,author.getId(),RowBounds.DEFAULT,Executor.NO_RESULT_HANDLER);
      executor.rollback(true);
      assertEquals(1,authors.size());
      assertEquals(author.toString(),authors.get(0).toString());
      assertTrue(author.getId() >= 10000);
    }
  }
  finally {
    executor.rollback(true);
    executor.close(false);
  }
}
