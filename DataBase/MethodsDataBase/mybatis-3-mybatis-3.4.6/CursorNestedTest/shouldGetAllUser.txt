@Test public void shouldGetAllUser(){
  SqlSession sqlSession=sqlSessionFactory.openSession();
  Mapper mapper=sqlSession.getMapper(Mapper.class);
  Cursor<User> usersCursor=mapper.getAllUsers();
  try {
    Assert.assertFalse(usersCursor.isOpen());
    Iterator<User> iterator=usersCursor.iterator();
    Assert.assertTrue(iterator.hasNext());
    Assert.assertTrue(usersCursor.isOpen());
    Assert.assertFalse(usersCursor.isConsumed());
    User user=iterator.next();
    Assert.assertEquals(2,user.getGroups().size());
    Assert.assertEquals(3,user.getRoles().size());
    user=iterator.next();
    Assert.assertEquals(1,user.getGroups().size());
    Assert.assertEquals(3,user.getRoles().size());
    user=iterator.next();
    Assert.assertEquals(3,user.getGroups().size());
    Assert.assertEquals(1,user.getRoles().size());
    user=iterator.next();
    Assert.assertEquals(2,user.getGroups().size());
    Assert.assertEquals(2,user.getRoles().size());
    Assert.assertFalse(iterator.hasNext());
    Assert.assertFalse(usersCursor.isOpen());
    Assert.assertTrue(usersCursor.isConsumed());
  }
  finally {
    sqlSession.close();
  }
  Assert.assertFalse(usersCursor.isOpen());
}
