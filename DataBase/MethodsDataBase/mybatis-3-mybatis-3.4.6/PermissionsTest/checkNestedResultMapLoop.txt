@Test public void checkNestedResultMapLoop(){
  SqlSession sqlSession=sqlSessionFactory.openSession();
  try {
    final PermissionsMapper mapper=sqlSession.getMapper(PermissionsMapper.class);
    final List<Resource> resources=mapper.getResources();
    Assert.assertEquals(2,resources.size());
    final Resource firstResource=resources.get(0);
    final List<Principal> principalPermissions=firstResource.getPrincipals();
    Assert.assertEquals(1,principalPermissions.size());
    final Principal firstPrincipal=principalPermissions.get(0);
    final List<Permission> permissions=firstPrincipal.getPermissions();
    Assert.assertEquals(2,permissions.size());
    final Permission firstPermission=firstPrincipal.getPermissions().get(0);
    Assert.assertSame(firstResource,firstPermission.getResource());
    final Permission secondPermission=firstPrincipal.getPermissions().get(1);
    Assert.assertSame(firstResource,secondPermission.getResource());
  }
  finally {
    sqlSession.close();
  }
}
