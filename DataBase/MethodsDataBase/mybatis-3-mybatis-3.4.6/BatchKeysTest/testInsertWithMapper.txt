@Test public void testInsertWithMapper() throws Exception {
  SqlSession sqlSession=sqlSessionFactory.openSession(ExecutorType.BATCH);
  try {
    Mapper userMapper=sqlSession.getMapper(Mapper.class);
    User user1=new User(null,"Pocoyo");
    userMapper.insert(user1);
    User user2=new User(null,"Valentina");
    userMapper.insert(user2);
    sqlSession.flushStatements();
    assertEquals(new Integer(50),user1.getId());
    assertEquals(new Integer(50),user2.getId());
    sqlSession.commit();
  }
  finally {
    sqlSession.close();
  }
  try {
    sqlSession=sqlSessionFactory.openSession();
    List<User> users=sqlSession.selectList("select");
    Assert.assertTrue(users.size() == 2);
  }
  finally {
    sqlSession.close();
  }
}
