@Test public void testCallback() throws Exception {
  MyHealthCheckCallback myCallback=new MyHealthCheckCallback(true);
  Assert.assertTrue(client instanceof DiscoveryClient);
  DiscoveryClient clientImpl=(DiscoveryClient)client;
  InstanceInfoReplicator instanceInfoReplicator=clientImpl.getInstanceInfoReplicator();
  instanceInfoReplicator.run();
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.STARTING,clientImpl.getInstanceInfo().getStatus());
  Assert.assertFalse("Healthcheck callback invoked when status is STARTING.",myCallback.isInvoked());
  client.registerHealthCheckCallback(myCallback);
  clientImpl.getInstanceInfo().setStatus(InstanceInfo.InstanceStatus.OUT_OF_SERVICE);
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.OUT_OF_SERVICE,clientImpl.getInstanceInfo().getStatus());
  myCallback.reset();
  instanceInfoReplicator.run();
  Assert.assertFalse("Healthcheck callback invoked when status is OOS.",myCallback.isInvoked());
  clientImpl.getInstanceInfo().setStatus(InstanceInfo.InstanceStatus.DOWN);
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.DOWN,clientImpl.getInstanceInfo().getStatus());
  myCallback.reset();
  instanceInfoReplicator.run();
  Assert.assertTrue("Healthcheck callback not invoked.",myCallback.isInvoked());
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.UP,clientImpl.getInstanceInfo().getStatus());
}
