@Test public void testHandler() throws Exception {
  MyHealthCheckHandler myHealthCheckHandler=new MyHealthCheckHandler(InstanceInfo.InstanceStatus.UP);
  Assert.assertTrue(client instanceof DiscoveryClient);
  DiscoveryClient clientImpl=(DiscoveryClient)client;
  InstanceInfoReplicator instanceInfoReplicator=clientImpl.getInstanceInfoReplicator();
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.STARTING,clientImpl.getInstanceInfo().getStatus());
  client.registerHealthCheck(myHealthCheckHandler);
  instanceInfoReplicator.run();
  Assert.assertTrue("Healthcheck callback not invoked when status is STARTING.",myHealthCheckHandler.isInvoked());
  Assert.assertEquals("Instance info status not as expected post healthcheck.",InstanceInfo.InstanceStatus.UP,clientImpl.getInstanceInfo().getStatus());
  clientImpl.getInstanceInfo().setStatus(InstanceInfo.InstanceStatus.OUT_OF_SERVICE);
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.OUT_OF_SERVICE,clientImpl.getInstanceInfo().getStatus());
  myHealthCheckHandler.reset();
  instanceInfoReplicator.run();
  Assert.assertTrue("Healthcheck callback not invoked when status is OUT_OF_SERVICE.",myHealthCheckHandler.isInvoked());
  Assert.assertEquals("Instance info status not as expected post healthcheck.",InstanceInfo.InstanceStatus.UP,clientImpl.getInstanceInfo().getStatus());
  clientImpl.getInstanceInfo().setStatus(InstanceInfo.InstanceStatus.DOWN);
  Assert.assertEquals("Instance info status not as expected.",InstanceInfo.InstanceStatus.DOWN,clientImpl.getInstanceInfo().getStatus());
  myHealthCheckHandler.reset();
  instanceInfoReplicator.run();
  Assert.assertTrue("Healthcheck callback not invoked when status is DOWN.",myHealthCheckHandler.isInvoked());
  Assert.assertEquals("Instance info status not as expected post healthcheck.",InstanceInfo.InstanceStatus.UP,clientImpl.getInstanceInfo().getStatus());
  clientImpl.getInstanceInfo().setStatus(InstanceInfo.InstanceStatus.UP);
  myHealthCheckHandler.reset();
  myHealthCheckHandler.shouldException=true;
  instanceInfoReplicator.run();
  Assert.assertTrue("Healthcheck callback not invoked when status is UP.",myHealthCheckHandler.isInvoked());
  Assert.assertEquals("Instance info status not as expected post healthcheck.",InstanceInfo.InstanceStatus.DOWN,clientImpl.getInstanceInfo().getStatus());
}
