/** 
 * parse discovery response with an unreasonable timeout, so that the parsing job is cancelled
 * @throws Exception
 */
@Test public void testDecodeTimeout() throws Exception {
  ExecutorService executor=Executors.newFixedThreadPool(5);
  File localDiscovery=downloadRegistration(System.getProperty("discovery.url"));
  Callable<Applications> task=() -> {
    try (InputStream is=new FileInputStream(localDiscovery)){
      return codec.readValue(Applications.class,is);
    }
   }
;
  final int cancelAllButNthTask=3;
  for (int i=0; i < 30; i++) {
    Future<Applications> appsFuture=executor.submit(task);
    if (i % cancelAllButNthTask < cancelAllButNthTask - 1) {
      Thread.sleep(UNREASONABLE_TIMEOUT_MS);
      System.out.println("cancelling..." + " i: " + i + " - "+ (i % 3));
      appsFuture.cancel(true);
    }
    try {
      Applications apps=appsFuture.get();
      System.out.println("found some applications: " + apps.toString() + ":"+ apps.getRegisteredApplications().size()+ " i: "+ i+ " - "+ (i % 3));
    }
 catch (    Exception e) {
      System.out.println(e + " cause: " + " i: "+ i+ " - "+ (i % 3));
    }
  }
}
