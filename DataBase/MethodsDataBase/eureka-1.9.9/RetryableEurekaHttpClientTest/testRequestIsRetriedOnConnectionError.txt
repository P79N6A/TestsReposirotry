@Test public void testRequestIsRetriedOnConnectionError() throws Exception {
  when(clientFactory.newClient(Matchers.<EurekaEndpoint>anyVararg())).thenReturn(clusterDelegates.get(0),clusterDelegates.get(1));
  when(requestExecutor.execute(clusterDelegates.get(0))).thenThrow(new TransportException("simulated network error"));
  when(requestExecutor.execute(clusterDelegates.get(1))).thenReturn(EurekaHttpResponse.status(200));
  EurekaHttpResponse<Void> httpResponse=retryableClient.execute(requestExecutor);
  assertThat(httpResponse.getStatusCode(),is(equalTo(200)));
  verify(clientFactory,times(2)).newClient(Matchers.<EurekaEndpoint>anyVararg());
  verify(requestExecutor,times(1)).execute(clusterDelegates.get(0));
  verify(requestExecutor,times(1)).execute(clusterDelegates.get(1));
}
