@Test public void test5xxStatusCodeResultsInRequestRetry() throws Exception {
  when(clientFactory.newClient(Matchers.<EurekaEndpoint>anyVararg())).thenReturn(clusterDelegates.get(0),clusterDelegates.get(1));
  when(requestExecutor.execute(clusterDelegates.get(0))).thenReturn(EurekaHttpResponse.status(500));
  when(requestExecutor.execute(clusterDelegates.get(1))).thenReturn(EurekaHttpResponse.status(200));
  EurekaHttpResponse<Void> httpResponse=retryableClient.execute(requestExecutor);
  assertThat(httpResponse.getStatusCode(),is(equalTo(200)));
  verify(requestExecutor,times(1)).execute(clusterDelegates.get(0));
  verify(requestExecutor,times(1)).execute(clusterDelegates.get(1));
}
