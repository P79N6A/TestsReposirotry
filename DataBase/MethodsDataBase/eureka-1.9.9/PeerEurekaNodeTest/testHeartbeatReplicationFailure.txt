@Test public void testHeartbeatReplicationFailure() throws Throwable {
  httpReplicationClient.withNetworkStatusCode(200,200);
  httpReplicationClient.withBatchReply(404);
  createPeerEurekaNode().heartbeat(instanceInfo.getAppName(),instanceInfo.getId(),instanceInfo,null,false);
  ReplicationInstance replicationInstance=expectSingleBatchRequest();
  assertThat(replicationInstance.getAction(),is(equalTo(Action.Heartbeat)));
  replicationInstance=expectSingleBatchRequest();
  assertThat(replicationInstance.getAction(),is(equalTo(Action.Register)));
}
