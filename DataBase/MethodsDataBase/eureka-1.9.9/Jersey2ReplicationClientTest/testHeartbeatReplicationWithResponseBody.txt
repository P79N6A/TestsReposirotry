@Test public void testHeartbeatReplicationWithResponseBody() throws Exception {
  InstanceInfo remoteInfo=new InstanceInfo(this.instanceInfo);
  remoteInfo.setStatus(InstanceStatus.DOWN);
  byte[] responseBody=toGzippedJson(remoteInfo);
  serverMockClient.when(request().withMethod("PUT").withHeader(header(PeerEurekaNode.HEADER_REPLICATION,"true")).withPath("/eureka/v2/apps/" + this.instanceInfo.getAppName() + '/'+ this.instanceInfo.getId())).respond(response().withStatusCode(Status.CONFLICT.getStatusCode()).withHeader(header("Content-Type",MediaType.APPLICATION_JSON)).withHeader(header("Content-Encoding","gzip")).withBody(responseBody));
  EurekaHttpResponse<InstanceInfo> response=replicationClient.sendHeartBeat(this.instanceInfo.getAppName(),this.instanceInfo.getId(),this.instanceInfo,null);
  assertThat(response.getStatusCode(),is(equalTo(Status.CONFLICT.getStatusCode())));
  assertThat(response.getEntity(),is(notNullValue()));
}
