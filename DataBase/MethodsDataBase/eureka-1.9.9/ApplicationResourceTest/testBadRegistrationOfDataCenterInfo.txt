@Test public void testBadRegistrationOfDataCenterInfo() throws Exception {
  try {
    ConfigurationManager.getConfigInstance().setProperty("eureka.experimental.registration.validation.dataCenterInfoId","true");
    InstanceInfo instanceInfo=spy(InstanceInfoGenerator.takeOne());
    when(instanceInfo.getDataCenterInfo()).thenReturn(new TestDataCenterInfo());
    Response response=applicationResource.addInstance(instanceInfo,false + "");
    assertThat(response.getStatus(),is(400));
    ConfigurationManager.getConfigInstance().setProperty("eureka.experimental.registration.validation.dataCenterInfoId","false");
    instanceInfo=spy(InstanceInfoGenerator.takeOne());
    assertThat(instanceInfo.getDataCenterInfo(),instanceOf(AmazonInfo.class));
    ((AmazonInfo)instanceInfo.getDataCenterInfo()).getMetadata().remove(AmazonInfo.MetaDataKey.instanceId.getName());
    response=applicationResource.addInstance(instanceInfo,false + "");
    assertThat(response.getStatus(),is(204));
  }
  finally {
    ConfigurationManager.getConfigInstance().clearProperty("eureka.experimental.registration.validation.dataCenterInfoId");
  }
}
