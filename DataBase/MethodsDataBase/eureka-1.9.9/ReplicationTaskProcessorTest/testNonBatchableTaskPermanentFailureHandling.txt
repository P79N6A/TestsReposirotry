@Test public void testNonBatchableTaskPermanentFailureHandling() throws Exception {
  TestableInstanceReplicationTask task=aReplicationTask().withAction(Action.Heartbeat).withReplyStatusCode(406).build();
  ProcessingResult status=replicationTaskProcessor.process(task);
  assertThat(status,is(ProcessingResult.PermanentError));
  assertThat(task.getProcessingState(),is(ProcessingState.Failed));
}
