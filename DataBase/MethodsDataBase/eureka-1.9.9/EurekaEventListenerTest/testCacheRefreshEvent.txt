@Test public void testCacheRefreshEvent() throws Exception {
  CapturingEurekaEventListener listener=new CapturingEurekaEventListener();
  Applications initialApps=toApplications(discoveryClientResource.getMyInstanceInfo());
  when(requestHandler.getApplications()).thenReturn(anEurekaHttpResponse(200,initialApps).type(MediaType.APPLICATION_JSON_TYPE).build());
  DiscoveryClient client=(DiscoveryClient)discoveryClientResource.getClient();
  client.registerEventListener(listener);
  client.refreshRegistry();
  assertNotNull(listener.event);
  assertThat(listener.event,is(instanceOf(CacheRefreshedEvent.class)));
}
