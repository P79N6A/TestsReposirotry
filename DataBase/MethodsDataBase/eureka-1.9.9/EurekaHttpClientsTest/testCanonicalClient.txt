@Test public void testCanonicalClient() throws Exception {
  Applications apps=instanceGen.toApplications();
  when(writeRequestHandler.getApplications()).thenReturn(anEurekaHttpResponse(302,Applications.class).headers("Location",readServerURI + "/v2/apps").build());
  when(readRequestHandler.getApplications()).thenReturn(anEurekaHttpResponse(200,apps).headers(HttpHeaders.CONTENT_TYPE,"application/json").build());
  EurekaHttpClient eurekaHttpClient=clientFactory.newClient();
  EurekaHttpResponse<Applications> result=eurekaHttpClient.getApplications();
  assertThat(result.getStatusCode(),is(equalTo(200)));
  assertThat(EurekaEntityComparators.equal(result.getEntity(),apps),is(true));
}
