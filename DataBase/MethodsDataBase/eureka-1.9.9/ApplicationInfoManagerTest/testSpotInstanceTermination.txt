@Test public void testSpotInstanceTermination(){
  AmazonInfo initialAmazonInfo=AmazonInfo.Builder.newBuilder().build();
  RefreshableAmazonInfoProvider refreshableAmazonInfoProvider=spy(new RefreshableAmazonInfoProvider(initialAmazonInfo,new Archaius1AmazonInfoConfig(CommonConstants.DEFAULT_CONFIG_NAMESPACE)));
  config=spy(new CloudInstanceConfig(CommonConstants.DEFAULT_CONFIG_NAMESPACE,refreshableAmazonInfoProvider));
  this.applicationInfoManager=new ApplicationInfoManager(config,instanceInfo,null);
  String terminationTime="2015-01-05T18:02:00Z";
  String spotInstanceAction="{\"action\": \"terminate\", \"time\": \"2017-09-18T08:22:00Z\"}";
  AmazonInfo newAmazonInfo=AmazonInfo.Builder.newBuilder().addMetadata(AmazonInfo.MetaDataKey.spotTerminationTime,terminationTime).addMetadata(AmazonInfo.MetaDataKey.spotInstanceAction,spotInstanceAction).addMetadata(AmazonInfo.MetaDataKey.publicHostname,instanceInfo.getHostName()).addMetadata(AmazonInfo.MetaDataKey.instanceId,instanceInfo.getInstanceId()).addMetadata(AmazonInfo.MetaDataKey.localIpv4,instanceInfo.getIPAddr()).build();
  when(refreshableAmazonInfoProvider.getNewAmazonInfo()).thenReturn(newAmazonInfo);
  applicationInfoManager.refreshDataCenterInfoIfRequired();
  assertThat(((AmazonInfo)instanceInfo.getDataCenterInfo()).getMetadata().get(AmazonInfo.MetaDataKey.spotTerminationTime.getName()),is(terminationTime));
  assertThat(((AmazonInfo)instanceInfo.getDataCenterInfo()).getMetadata().get(AmazonInfo.MetaDataKey.spotInstanceAction.getName()),is(spotInstanceAction));
}
