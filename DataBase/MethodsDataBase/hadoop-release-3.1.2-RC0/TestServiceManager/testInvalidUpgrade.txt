@Test public void testInvalidUpgrade() throws Exception {
  ServiceContext serviceContext=createServiceContext("testInvalidUpgrade");
  ServiceManager manager=serviceContext.getServiceManager();
  manager.getServiceSpec().setState(ServiceState.UPGRADING_AUTO_FINALIZE);
  Service upgradedDef=ServiceTestUtils.createExampleApplication();
  upgradedDef.setName(manager.getName());
  upgradedDef.setVersion("v2");
  upgradedDef.setLifetime(2L);
  writeUpgradedDef(upgradedDef);
  try {
    manager.processUpgradeRequest("v2",true,false);
  }
 catch (  Exception ex) {
    Assert.assertTrue(ex instanceof UnsupportedOperationException);
    return;
  }
  Assert.fail();
}
