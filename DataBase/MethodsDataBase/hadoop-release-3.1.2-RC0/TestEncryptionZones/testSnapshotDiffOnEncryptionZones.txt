/** 
 * Test correctness of snapshotDiff for encryption zone. snapshtoDiff should work when the path parameter is prefixed with /.reserved/raw for path that's both snapshottable and encryption zone.
 */
@Test public void testSnapshotDiffOnEncryptionZones() throws Exception {
  final String TEST_KEY2="testkey2";
  DFSTestUtil.createKey(TEST_KEY2,cluster,conf);
  final int len=8196;
  final Path zone=new Path("/zone");
  final Path rawZone=new Path("/.reserved/raw/zone");
  final Path zoneFile=new Path(zone,"zoneFile");
  fsWrapper.mkdir(zone,FsPermission.getDirDefault(),true);
  dfsAdmin.allowSnapshot(zone);
  dfsAdmin.createEncryptionZone(zone,TEST_KEY,NO_TRASH);
  DFSTestUtil.createFile(fs,zoneFile,len,(short)1,0xFEED);
  fs.createSnapshot(zone,"snap1");
  fsWrapper.delete(zoneFile,true);
  fs.createSnapshot(zone,"snap2");
  verifyDiffReport(zone,"snap1","snap2",new DiffReportEntry(DiffType.MODIFY,DFSUtil.string2Bytes("")),new DiffReportEntry(DiffType.DELETE,DFSUtil.string2Bytes("zoneFile")));
  verifyDiffReport(rawZone,"snap1","snap2",new DiffReportEntry(DiffType.MODIFY,DFSUtil.string2Bytes("")),new DiffReportEntry(DiffType.DELETE,DFSUtil.string2Bytes("zoneFile")));
}
