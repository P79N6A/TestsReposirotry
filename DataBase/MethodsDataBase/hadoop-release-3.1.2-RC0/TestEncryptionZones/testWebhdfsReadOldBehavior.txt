@Test public void testWebhdfsReadOldBehavior() throws Exception {
  Path zonePath=new Path("/TestEncryptionZone");
  fsWrapper.mkdir(zonePath,FsPermission.getDirDefault(),false);
  dfsAdmin.createEncryptionZone(zonePath,TEST_KEY,NO_TRASH);
  final Path encryptedFilePath=new Path("/TestEncryptionZone/foo");
  final String content="hello world";
  DFSTestUtil.writeFile(fs,encryptedFilePath,content);
  InetSocketAddress addr=cluster.getNameNode().getHttpAddress();
  URL url=new URL("http",addr.getHostString(),addr.getPort(),WebHdfsFileSystem.PATH_PREFIX + encryptedFilePath.toString() + "?op=OPEN");
  HttpURLConnection namenodeConnection=returnConnection(url,"GET",false);
  String location=namenodeConnection.getHeaderField("Location");
  URL datanodeURL=new URL(location);
  String path=datanodeURL.getPath();
  Assert.assertEquals(WebHdfsFileSystem.PATH_PREFIX + encryptedFilePath.toString(),path);
  HttpURLConnection datanodeConnection=returnConnection(datanodeURL,"GET",false);
  InputStream in=datanodeConnection.getInputStream();
  verifyStreamsSame(content,in);
}
