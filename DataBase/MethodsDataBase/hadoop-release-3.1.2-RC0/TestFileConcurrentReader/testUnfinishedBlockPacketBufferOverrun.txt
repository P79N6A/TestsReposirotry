/** 
 * test case: if the BlockSender decides there is only one packet to send, the previous computation of the pktSize based on transferToAllowed would result in too small a buffer to do the buffer-copy needed for partial chunks.
 */
@Test(timeout=30000) public void testUnfinishedBlockPacketBufferOverrun() throws IOException {
  Path path=new Path("/");
  System.out.println("Path : \"" + path.toString() + "\"");
  Path file1=new Path("/unfinished-block");
  final FSDataOutputStream stm=TestFileCreation.createFile(fileSystem,file1,1);
  final int bytesPerChecksum=conf.getInt("io.bytes.per.checksum",512);
  final int partialBlockSize=bytesPerChecksum - 1;
  writeFileAndSync(stm,partialBlockSize);
  checkCanRead(fileSystem,file1,partialBlockSize);
  stm.close();
}
