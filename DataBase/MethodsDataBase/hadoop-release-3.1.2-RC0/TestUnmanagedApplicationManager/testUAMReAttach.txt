@Test(timeout=5000) public void testUAMReAttach() throws YarnException, IOException, InterruptedException {
  launchUAM(attemptId);
  registerApplicationMaster(RegisterApplicationMasterRequest.newInstance(null,0,null),attemptId);
  allocateAsync(AllocateRequest.newInstance(0,0,null,null,null),callback,attemptId);
  waitForCallBackCountAndCheckZeroPending(callback,1);
  MockResourceManagerFacade rmProxy=uam.getRMProxy();
  uam=new TestableUnmanagedApplicationManager(conf,attemptId.getApplicationId(),null,"submitter","appNameSuffix",true);
  uam.setRMProxy(rmProxy);
  reAttachUAM(null,attemptId);
  registerApplicationMaster(RegisterApplicationMasterRequest.newInstance(null,0,null),attemptId);
  allocateAsync(AllocateRequest.newInstance(0,0,null,null,null),callback,attemptId);
  waitForCallBackCountAndCheckZeroPending(callback,2);
  finishApplicationMaster(FinishApplicationMasterRequest.newInstance(null,null,null),attemptId);
}
