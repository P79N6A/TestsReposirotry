@Test public void testAMRMDecommissioningNodes() throws Exception {
  MockNM nm1=rm.registerNode("127.0.0.1:1234",10000);
  MockNM nm2=rm.registerNode("127.0.0.2:1234",10000);
  rm.drainEvents();
  RMApp app1=rm.submitApp(2000);
  nm1.nodeHeartbeat(true);
  RMAppAttempt attempt1=app1.getCurrentAppAttempt();
  MockAM am1=rm.sendAMLaunched(attempt1.getAppAttemptId());
  am1.registerAppAttempt();
  Integer decommissioningTimeout=600;
  syncNodeGracefulDecommission(nm2,decommissioningTimeout);
  AllocateRequest allocateRequest1=AllocateRequest.newInstance(0,0F,null,null,null);
  AllocateResponse response1=allocate(attempt1.getAppAttemptId(),allocateRequest1);
  List<NodeReport> updatedNodes=response1.getUpdatedNodes();
  Assert.assertEquals(1,updatedNodes.size());
  NodeReport nr=updatedNodes.iterator().next();
  Assert.assertEquals(decommissioningTimeout,nr.getDecommissioningTimeout());
  Assert.assertEquals(NodeUpdateType.NODE_DECOMMISSIONING,nr.getNodeUpdateType());
}
