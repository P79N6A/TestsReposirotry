@Test(timeout=20000) public void testInvalidEnvSyntaxDiagnostics() throws IOException {
  File shellFile=null;
  try {
    shellFile=Shell.appendScriptExtension(tmpDir,"hello");
    Map<Path,List<String>> resources=new HashMap<Path,List<String>>();
    FileOutputStream fos=new FileOutputStream(shellFile);
    FileUtil.setExecutable(shellFile,true);
    Map<String,String> env=new HashMap<String,String>();
    env.put("APPLICATION_WORKFLOW_CONTEXT","{\"workflowId\":\"609f91c5cd83\"," + "\"workflowName\":\"\n\ninsert table " + "\npartition (cd_education_status)\nselect cd_demo_sk, cd_gender, ");
    List<String> commands=new ArrayList<String>();
    DefaultContainerExecutor defaultContainerExecutor=new DefaultContainerExecutor();
    defaultContainerExecutor.setConf(new YarnConfiguration());
    LinkedHashSet<String> nmVars=new LinkedHashSet<>();
    defaultContainerExecutor.writeLaunchEnv(fos,env,resources,commands,new Path(localLogDir.getAbsolutePath()),"user",nmVars);
    fos.flush();
    fos.close();
    Map<String,String> cmdEnv=new HashMap<String,String>();
    cmdEnv.put("LANG","C");
    Shell.ShellCommandExecutor shexc=new Shell.ShellCommandExecutor(new String[]{shellFile.getAbsolutePath()},tmpDir,cmdEnv);
    String diagnostics=null;
    try {
      shexc.execute();
      Assert.fail("Should catch exception");
    }
 catch (    ExitCodeException e) {
      List<String> error=Files.readAllLines(Paths.get(localLogDir.getAbsolutePath(),ContainerLaunch.CONTAINER_PRE_LAUNCH_STDERR),Charset.forName("UTF-8"));
      diagnostics=StringUtils.join("\n",error);
    }
    Assert.assertTrue(diagnostics.contains(Shell.WINDOWS ? "is not recognized as an internal or external command" : "command not found"));
    Assert.assertTrue(shexc.getExitCode() != 0);
  }
  finally {
    if (shellFile != null && shellFile.exists()) {
      shellFile.delete();
    }
  }
}
