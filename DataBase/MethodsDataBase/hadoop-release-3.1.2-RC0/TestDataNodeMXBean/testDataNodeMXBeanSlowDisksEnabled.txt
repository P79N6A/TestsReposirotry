@Test public void testDataNodeMXBeanSlowDisksEnabled() throws Exception {
  Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_DATANODE_FILEIO_PROFILING_SAMPLING_PERCENTAGE_KEY,100);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).build();
  try {
    List<DataNode> datanodes=cluster.getDataNodes();
    Assert.assertEquals(datanodes.size(),1);
    DataNode datanode=datanodes.get(0);
    String slowDiskPath="test/data1/slowVolume";
    datanode.getDiskMetrics().addSlowDiskForTesting(slowDiskPath,null);
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=DataNode,name=DataNodeInfo");
    String slowDisks=(String)mbs.getAttribute(mxbeanName,"SlowDisks");
    Assert.assertEquals(datanode.getSlowDisks(),slowDisks);
    Assert.assertTrue(slowDisks.contains(slowDiskPath));
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
