/** 
 * Delete the version marker and verify that table init fails.
 */
@Test public void testTableVersionRequired() throws Exception {
  Configuration conf=getFileSystem().getConf();
  int maxRetries=conf.getInt(S3GUARD_DDB_MAX_RETRIES,S3GUARD_DDB_MAX_RETRIES_DEFAULT);
  conf.setInt(S3GUARD_DDB_MAX_RETRIES,3);
  final DynamoDBMetadataStore ddbms=createContract(conf).getMetadataStore();
  String tableName=conf.get(S3GUARD_DDB_TABLE_NAME_KEY,BUCKET);
  Table table=verifyTableInitialized(tableName);
  table.deleteItem(VERSION_MARKER_PRIMARY_KEY);
  intercept(IOException.class,E_NO_VERSION_MARKER,new VoidCallable(){
    @Override public void call() throws Exception {
      ddbms.initTable();
    }
  }
);
  conf.setInt(S3GUARD_DDB_MAX_RETRIES,maxRetries);
}
