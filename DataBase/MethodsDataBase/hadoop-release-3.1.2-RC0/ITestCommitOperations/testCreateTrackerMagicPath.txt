/** 
 * On a magic path, the magic tracker is returned.
 * @throws Throwable failure
 */
@Test public void testCreateTrackerMagicPath() throws Throwable {
  S3AFileSystem fs=getFileSystem();
  MagicCommitIntegration integration=new MagicCommitIntegration(fs,true);
  String filename="delayed.txt";
  Path destFile=methodPath(filename);
  String origKey=fs.pathToKey(destFile);
  Path pendingPath=makeMagic(destFile);
  verifyIsMagicCommitPath(fs,pendingPath);
  String pendingPathKey=fs.pathToKey(pendingPath);
  assertTrue("wrong path of " + pendingPathKey,pendingPathKey.endsWith(filename));
  final List<String> elements=splitPathToElements(pendingPath);
  assertEquals("splitPathToElements()",filename,lastElement(elements));
  List<String> finalDestination=finalDestination(elements);
  assertEquals("finalDestination()",filename,lastElement(finalDestination));
  final String destKey=elementsToKey(finalDestination);
  assertEquals("destination key",origKey,destKey);
  PutTracker tracker=integration.createTracker(pendingPath,pendingPathKey);
  assertTrue("wrong type: " + tracker + " for "+ pendingPathKey,tracker instanceof MagicCommitTracker);
  assertEquals("tracker destination key",origKey,tracker.getDestKey());
  Path pendingSuffixedPath=new Path(pendingPath,"part-0000" + PENDING_SUFFIX);
  assertFalse("still a delayed complete path " + pendingSuffixedPath,fs.isMagicCommitPath(pendingSuffixedPath));
  Path pendingSet=new Path(pendingPath,"part-0000" + PENDINGSET_SUFFIX);
  assertFalse("still a delayed complete path " + pendingSet,fs.isMagicCommitPath(pendingSet));
}
