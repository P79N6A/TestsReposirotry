@Test public void testUploadSmallFile() throws Throwable {
  File tempFile=File.createTempFile("commit",".txt");
  String text="hello, world";
  FileUtils.write(tempFile,text,"UTF-8");
  CommitOperations actions=newCommitOperations();
  Path dest=methodPath("testUploadSmallFile");
  S3AFileSystem fs=getFileSystem();
  fullThrottle();
  SinglePendingCommit pendingCommit=actions.uploadFileToPendingCommit(tempFile,dest,null,DEFAULT_MULTIPART_SIZE);
  resetFailures();
  assertPathDoesNotExist("pending commit",dest);
  fullThrottle();
  actions.commitOrFail(pendingCommit);
  resetFailures();
  String s=readUTF8(fs,dest,-1);
  assertEquals(text,s);
}
