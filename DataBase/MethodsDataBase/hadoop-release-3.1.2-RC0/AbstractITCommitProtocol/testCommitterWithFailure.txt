/** 
 * Simulate a failure on the first job commit; expect the second to succeed.
 */
@Test public void testCommitterWithFailure() throws Exception {
  describe("Fail the first job commit then retry");
  JobData jobData=startJob(new FailingCommitterFactory(),true);
  JobContext jContext=jobData.jContext;
  TaskAttemptContext tContext=jobData.tContext;
  AbstractS3ACommitter committer=jobData.committer;
  committer.commitTask(tContext);
  expectSimulatedFailureOnJobCommit(jContext,committer);
  committer.commitJob(jContext);
  validateContent(outDir,shouldExpectSuccessMarker());
  expectJobCommitToFail(jContext,committer);
}
