/** 
 * Test that the HarFileSystem works with underlying HDFS URIs that have no port specified, as is often the case with an HA setup.
 */
@Test public void testHarUriWithHaUriWithNoPort() throws Exception {
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).nnTopology(MiniDFSNNTopology.simpleHATopology()).build();
    cluster.transitionToActive(0);
    HATestUtil.setFailoverConfigurations(cluster,conf);
    createEmptyHarArchive(HATestUtil.configureFailoverFs(cluster,conf),TEST_HAR_PATH);
    URI failoverUri=FileSystem.getDefaultUri(conf);
    Path p=new Path("har://hdfs-" + failoverUri.getAuthority() + TEST_HAR_PATH);
    p.getFileSystem(conf);
  }
  finally {
    cluster.shutdown();
  }
}
