@Test(timeout=30000) public void testNumberOfProvidedLocations() throws Exception {
  conf.setInt(DFSConfigKeys.DFS_REPLICATION_KEY,4);
  createImage(new FSTreeWalk(providedPath,conf),nnDirPath,FixedBlockResolver.class);
  startCluster(nnDirPath,4,new StorageType[]{StorageType.PROVIDED,StorageType.DISK},null,false);
  int expectedLocations=4;
  for (int i=0; i < numFiles; i++) {
    verifyFileLocation(i,expectedLocations);
  }
  for (int i=1; i <= 2; i++) {
    DataNode dn=cluster.getDataNodes().get(0);
    cluster.stopDataNode(0);
    BlockManagerTestUtil.noticeDeadDatanode(cluster.getNameNode(),dn.getDatanodeId().getXferAddr());
    expectedLocations=4 - i;
    for (int j=0; j < numFiles; j++) {
      verifyFileLocation(j,expectedLocations);
    }
  }
}
