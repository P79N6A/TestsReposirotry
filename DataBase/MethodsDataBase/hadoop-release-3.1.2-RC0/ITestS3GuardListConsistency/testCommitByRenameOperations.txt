@Test public void testCommitByRenameOperations() throws Throwable {
  S3AFileSystem fs=getFileSystem();
  Assume.assumeTrue(fs.hasMetadataStore());
  Path work=path("test-commit-by-rename-" + DEFAULT_DELAY_KEY_SUBSTRING);
  Path task00=new Path(work,"task00");
  fs.mkdirs(task00);
  String name="part-00";
  try (FSDataOutputStream out=fs.create(new Path(task00,name),false)){
    out.writeChars("hello");
  }
   for (  FileStatus stat : fs.listStatus(task00)) {
    fs.rename(stat.getPath(),work);
  }
  List<FileStatus> files=new ArrayList<>(2);
  for (  FileStatus stat : fs.listStatus(work)) {
    if (stat.isFile()) {
      files.add(stat);
    }
  }
  assertFalse("renamed file " + name + " not found in "+ work,files.isEmpty());
  assertEquals("more files found than expected in " + work + " "+ ls(work),1,files.size());
  FileStatus status=files.get(0);
  assertEquals("Wrong filename in " + status,name,status.getPath().getName());
}
