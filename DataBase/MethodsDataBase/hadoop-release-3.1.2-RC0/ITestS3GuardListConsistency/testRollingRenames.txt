/** 
 * Tests a circular sequence of renames to verify that overwriting recently deleted files and reading recently created files from rename operations works as expected.
 * @throws Exception
 */
@Test public void testRollingRenames() throws Exception {
  Path[] dir0={path("rolling/1")};
  Path[] dir1={path("rolling/2")};
  Path[] dir2={path("rolling/3")};
  Path[] setA={dir1[0],dir0[0]};
  Path[] setB={dir2[0],dir1[0]};
  Path[] setC={dir0[0],dir2[0]};
  for (int i=0; i < 2; i++) {
    Path[] firstSet=i == 0 ? setA : null;
    doTestRenameSequence(firstSet,setA,setB,setB,dir0);
    doTestRenameSequence(null,setB,setC,setC,dir1);
    doTestRenameSequence(null,setC,setA,setA,dir2);
  }
  S3AFileSystem fs=getFileSystem();
  assertFalse("Renaming deleted file should have failed",fs.rename(dir2[0],dir1[0]));
  assertTrue("Renaming over existing file should have succeeded",fs.rename(dir1[0],dir0[0]));
}
