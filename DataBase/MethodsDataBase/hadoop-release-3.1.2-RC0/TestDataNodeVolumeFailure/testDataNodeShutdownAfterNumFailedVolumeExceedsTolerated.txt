/** 
 * Test DataNode stops when the number of failed volumes exceeds dfs.datanode.failed.volumes.tolerated .
 */
@Test(timeout=10000) public void testDataNodeShutdownAfterNumFailedVolumeExceedsTolerated() throws Exception {
  assumeNotWindows();
  final File dn0Vol1=cluster.getInstanceStorageDir(0,0);
  final File dn0Vol2=cluster.getInstanceStorageDir(0,1);
  DataNodeTestUtils.injectDataDirFailure(dn0Vol1,dn0Vol2);
  DataNode dn0=cluster.getDataNodes().get(0);
  DataNodeTestUtils.waitForDiskError(dn0,DataNodeTestUtils.getVolume(dn0,dn0Vol1));
  DataNodeTestUtils.waitForDiskError(dn0,DataNodeTestUtils.getVolume(dn0,dn0Vol2));
  assertFalse(dn0.shouldRun());
}
