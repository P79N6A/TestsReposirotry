@Test public void testFormatStateStoreCmdForZK() throws Exception {
  StateChangeRequestInfo req=new StateChangeRequestInfo(HAServiceProtocol.RequestSource.REQUEST_BY_USER);
  try (TestingServer curatorTestingServer=TestZKRMStateStore.setupCuratorServer();CuratorFramework curatorFramework=TestZKRMStateStore.setupCuratorFramework(curatorTestingServer)){
    Configuration conf=TestZKRMStateStore.createHARMConf("rm1,rm2","rm1",1234,false,curatorTestingServer);
    ResourceManager rm=new MockRM(conf);
    rm.start();
    rm.getRMContext().getRMAdminService().transitionToActive(req);
    String zkStateRoot=ZKRMStateStore.ROOT_ZNODE_NAME;
    assertEquals("RM State store parent path should have a child node " + zkStateRoot,zkStateRoot,curatorFramework.getChildren().forPath(YarnConfiguration.DEFAULT_ZK_RM_STATE_STORE_PARENT_PATH).get(0));
    rm.close();
    try {
      ResourceManager.deleteRMStateStore(conf);
    }
 catch (    Exception e) {
      fail("Exception should not be thrown during format rm state store" + " operation.");
    }
    assertTrue("After store format parent path should have no child nodes",curatorFramework.getChildren().forPath(YarnConfiguration.DEFAULT_ZK_RM_STATE_STORE_PARENT_PATH).isEmpty());
  }
 }
