@Test(timeout=15000) public void testQueueStateTransit() throws Exception {
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  csConf.setQueues(CapacitySchedulerConfiguration.ROOT,new String[]{Q1});
  csConf.setQueues(Q1_PATH,new String[]{Q2,Q3});
  csConf.setCapacity(Q1_PATH,100);
  csConf.setCapacity(Q2_PATH,50);
  csConf.setCapacity(Q3_PATH,50);
  conf=new YarnConfiguration(csConf);
  cs=new CapacityScheduler();
  RMContext rmContext=TestUtils.getMockRMContext();
  cs.setConf(conf);
  cs.setRMContext(rmContext);
  cs.init(conf);
  Assert.assertEquals(QueueState.RUNNING,cs.getQueue(Q1).getState());
  Assert.assertEquals(QueueState.RUNNING,cs.getQueue(Q2).getState());
  Assert.assertEquals(QueueState.RUNNING,cs.getQueue(Q3).getState());
  ApplicationId appId=ApplicationId.newInstance(System.currentTimeMillis(),1);
  String userName="testUser";
  cs.getQueue(Q2).submitApplication(appId,userName,Q2);
  FiCaSchedulerApp app=getMockApplication(appId,userName,Resources.createResource(4,0));
  cs.getQueue(Q2).submitApplicationAttempt(app,userName);
  csConf.setState(Q2_PATH,QueueState.STOPPED);
  conf=new YarnConfiguration(csConf);
  cs.reinitialize(conf,rmContext);
  Assert.assertEquals(QueueState.RUNNING,cs.getQueue(Q1).getState());
  Assert.assertEquals(QueueState.DRAINING,cs.getQueue(Q2).getState());
  Assert.assertEquals(QueueState.RUNNING,cs.getQueue(Q3).getState());
  csConf.setState(Q1_PATH,QueueState.STOPPED);
  conf=new YarnConfiguration(csConf);
  cs.reinitialize(conf,rmContext);
  Assert.assertEquals(QueueState.DRAINING,cs.getQueue(Q1).getState());
  Assert.assertEquals(QueueState.DRAINING,cs.getQueue(Q2).getState());
  Assert.assertEquals(QueueState.STOPPED,cs.getQueue(Q3).getState());
  csConf.setState(Q3_PATH,QueueState.RUNNING);
  conf=new YarnConfiguration(csConf);
  try {
    cs.reinitialize(conf,rmContext);
    Assert.fail("Should throw an Exception.");
  }
 catch (  Exception ex) {
  }
  cs.getQueue(Q2).finishApplicationAttempt(app,Q2);
  cs.getQueue(Q2).finishApplication(appId,userName);
  Assert.assertEquals(QueueState.STOPPED,cs.getQueue(Q1).getState());
  Assert.assertEquals(QueueState.STOPPED,cs.getQueue(Q2).getState());
  Assert.assertEquals(QueueState.STOPPED,cs.getQueue(Q3).getState());
}
