@Test public void testManualCgroupSetting() throws IOException {
  CgroupsLCEResourcesHandler handler=new CgroupsLCEResourcesHandler();
  YarnConfiguration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.NM_LINUX_CONTAINER_CGROUPS_MOUNT_PATH,cgroupDir.getAbsolutePath());
  handler.setConf(conf);
  File cpu=new File(new File(cgroupDir,"cpuacct,cpu"),"/hadoop-yarn");
  try {
    Assert.assertTrue("temp dir should be created",cpu.mkdirs());
    final int numProcessors=4;
    ResourceCalculatorPlugin plugin=Mockito.mock(ResourceCalculatorPlugin.class);
    Mockito.doReturn(numProcessors).when(plugin).getNumProcessors();
    Mockito.doReturn(numProcessors).when(plugin).getNumCores();
    when(plugin.getNumProcessors()).thenReturn(8);
    handler.init(null,plugin);
    Assert.assertEquals("CPU CGRoup path was not set",cpu.getParent(),handler.getControllerPaths().get("cpu"));
  }
  finally {
    FileUtils.deleteQuietly(cpu);
  }
}
