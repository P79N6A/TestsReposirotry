/** 
 * Ensure that an IBR is generated immediately for a block received by the DN.
 * @throws InterruptedException
 * @throws IOException
 */
@Test(timeout=60000) public void testReportBlockReceived() throws InterruptedException, IOException {
  try {
    DatanodeProtocolClientSideTranslatorPB nnSpy=spyOnDnCallsToNn();
    injectBlockReceived();
    Thread.sleep(2000);
    Mockito.verify(nnSpy,times(1)).blockReceivedAndDeleted(any(DatanodeRegistration.class),anyString(),any(StorageReceivedDeletedBlocks[].class));
  }
  finally {
    cluster.shutdown();
    cluster=null;
  }
}
