@Test public void testStatusUpdateEventCoalescing() throws IOException, InterruptedException {
  configureMocks();
  startListener(true);
  listener.statusUpdate(attemptID,firstReduceStatus);
  listener.statusUpdate(attemptID,secondReduceStatus);
  verify(ea).handle(any(Event.class));
  ConcurrentMap<TaskAttemptId,AtomicReference<TaskAttemptStatus>> attemptIdToStatus=listener.getAttemptIdToStatus();
  TaskAttemptStatus status=attemptIdToStatus.get(attemptId).get();
  assertTrue(status.fetchFailedMaps.contains(TASKATTEMPTID1));
  assertTrue(status.fetchFailedMaps.contains(TASKATTEMPTID2));
  assertEquals(2,status.fetchFailedMaps.size());
  assertEquals(Phase.SORT,status.phase);
}
