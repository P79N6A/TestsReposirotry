@Test public void testChangeDefaultPolicy() throws Exception {
  final HdfsConfiguration conf=new HdfsConfiguration();
  final String testPolicy="RS-3-2-1024k";
  final String defaultPolicy=conf.getTrimmed(DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY_DEFAULT);
  assertNotEquals("The default policy and the next default policy " + "should not be the same!",testPolicy,defaultPolicy);
  ErasureCodingPolicyManager manager=ErasureCodingPolicyManager.getInstance();
  conf.set(DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,testPolicy);
  manager.init(conf);
  manager.loadPolicies(constructAllDisabledInitialPolicies(),conf);
  ErasureCodingPolicyInfo[] getPoliciesResult=manager.getPolicies();
  boolean isEnabled=isPolicyEnabled(testPolicy,getPoliciesResult);
  assertTrue("The new default policy should be " + "in enabled state!",isEnabled);
  ErasureCodingPolicyInfo[] getPersistedPoliciesResult=manager.getPersistedPolicies();
  isEnabled=isPolicyEnabled(testPolicy,getPersistedPoliciesResult);
  assertFalse("The new default policy should be " + "in disabled state in the persisted list!",isEnabled);
  manager.disablePolicy(testPolicy);
  getPoliciesResult=manager.getPolicies();
  isEnabled=isPolicyEnabled(testPolicy,getPoliciesResult);
  assertFalse("The new default policy should be " + "in disabled state!",isEnabled);
  getPersistedPoliciesResult=manager.getPersistedPolicies();
  isEnabled=isPolicyEnabled(testPolicy,getPersistedPoliciesResult);
  assertFalse("The new default policy should be " + "in disabled state in the persisted list!",isEnabled);
  manager.enablePolicy(testPolicy);
  getPoliciesResult=manager.getPolicies();
  isEnabled=isPolicyEnabled(testPolicy,getPoliciesResult);
  assertTrue("The new default policy should be " + "in enabled state!",isEnabled);
  getPersistedPoliciesResult=manager.getPersistedPolicies();
  isEnabled=isPolicyEnabled(testPolicy,getPersistedPoliciesResult);
  assertTrue("The new default policy should be " + "in enabled state in the persisted list!",isEnabled);
  final String emptyPolicy="";
  conf.set(DFSConfigKeys.DFS_NAMENODE_EC_SYSTEM_DEFAULT_POLICY,emptyPolicy);
  manager.init(conf);
  manager.loadPolicies(constructAllDisabledInitialPolicies(),conf);
  getPoliciesResult=manager.getPolicies();
  assertAllPoliciesAreDisabled(getPoliciesResult);
}
