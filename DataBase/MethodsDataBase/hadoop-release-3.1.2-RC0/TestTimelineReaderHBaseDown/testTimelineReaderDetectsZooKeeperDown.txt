@Test(timeout=300000) public void testTimelineReaderDetectsZooKeeperDown() throws Exception {
  HBaseTestingUtility util=new HBaseTestingUtility();
  configure(util);
  try {
    util.startMiniCluster();
    DataGeneratorForTest.createSchema(util.getConfiguration());
    DataGeneratorForTest.loadApps(util,System.currentTimeMillis());
    TimelineReaderServer server=getTimelineReaderServer();
    server.init(util.getConfiguration());
    HBaseTimelineReaderImpl htr=getHBaseTimelineReaderImpl(server);
    util.shutdownMiniCluster();
    server.start();
    waitForHBaseDown(htr);
  }
  finally {
    util.shutdownMiniCluster();
  }
}
