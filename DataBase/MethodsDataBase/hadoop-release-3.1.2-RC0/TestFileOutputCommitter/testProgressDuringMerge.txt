@Test public void testProgressDuringMerge() throws Exception {
  Job job=Job.getInstance();
  FileOutputFormat.setOutputPath(job,outDir);
  Configuration conf=job.getConfiguration();
  conf.set(MRJobConfig.TASK_ATTEMPT_ID,attempt);
  conf.setInt(FileOutputCommitter.FILEOUTPUTCOMMITTER_ALGORITHM_VERSION,2);
  JobContext jContext=new JobContextImpl(conf,taskID.getJobID());
  TaskAttemptContext tContext=spy(new TaskAttemptContextImpl(conf,taskID));
  FileOutputCommitter committer=new FileOutputCommitter(outDir,tContext);
  committer.setupJob(jContext);
  committer.setupTask(tContext);
  MapFileOutputFormat theOutputFormat=new MapFileOutputFormat();
  RecordWriter theRecordWriter=theOutputFormat.getRecordWriter(tContext);
  writeMapFileOutput(theRecordWriter,tContext);
  committer.commitTask(tContext);
  verify(tContext,atLeast(2)).progress();
}
