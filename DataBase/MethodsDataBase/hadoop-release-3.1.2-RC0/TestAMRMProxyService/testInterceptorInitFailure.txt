/** 
 * Tests the case when interceptor pipeline initialization fails.
 * @throws IOException
 */
@Test public void testInterceptorInitFailure() throws IOException {
  Configuration conf=this.getConf();
  conf.set(YarnConfiguration.AMRM_PROXY_INTERCEPTOR_CLASS_PIPELINE,"class.that.does.not.exist");
  createAndStartAMRMProxyService(conf);
  int testAppId=1;
  try {
    registerApplicationMaster(testAppId);
    Assert.fail("Should not reach here. Expecting an exception thrown");
  }
 catch (  Exception e) {
    Map<ApplicationId,RequestInterceptorChainWrapper> pipelines=getAMRMProxyService().getPipelines();
    ApplicationId id=getApplicationId(testAppId);
    Assert.assertTrue("The interceptor pipeline should be removed if initializtion fails",pipelines.get(id) == null);
  }
}
