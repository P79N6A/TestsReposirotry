@Test public void testMultipleAttemptsSameNode() throws YarnException, IOException, Exception {
  String user="hadoop";
  ApplicationId appId=ApplicationId.newInstance(1,1);
  ApplicationAttemptId applicationAttemptId;
  RegisterApplicationMasterResponse response1=registerApplicationMaster(appId.getId());
  Assert.assertNotNull(response1);
  AllocateResponse allocateResponse=allocate(appId.getId());
  Assert.assertNotNull(allocateResponse);
  applicationAttemptId=ApplicationAttemptId.newInstance(appId,2);
  getAMRMProxyService().initializePipeline(applicationAttemptId,user,new Token<AMRMTokenIdentifier>(),null,null,false,null);
  RequestInterceptorChainWrapper chain2=getAMRMProxyService().getPipelines().get(appId);
  Assert.assertEquals(applicationAttemptId,chain2.getApplicationAttemptId());
  allocateResponse=allocate(appId.getId());
  Assert.assertNotNull(allocateResponse);
}
