/** 
 * Test AMRMProxy restart with application recovery failure.
 */
@Test public void testAppRecoveryFailure() throws YarnException, Exception {
  Configuration conf=createConfiguration();
  conf.set(YarnConfiguration.AMRM_PROXY_INTERCEPTOR_CLASS_PIPELINE,BadRequestInterceptorAcrossRestart.class.getName());
  mockRM=new MockResourceManagerFacade(new YarnConfiguration(conf),0);
  createAndStartAMRMProxyService(conf);
  registerApplicationMaster(1);
  RecoveredAMRMProxyState state=getNMContext().getNMStateStore().loadAMRMProxyState();
  Assert.assertEquals(1,state.getAppContexts().size());
  createAndStartAMRMProxyService(conf);
  state=getNMContext().getNMStateStore().loadAMRMProxyState();
  Assert.assertEquals(0,state.getAppContexts().size());
}
