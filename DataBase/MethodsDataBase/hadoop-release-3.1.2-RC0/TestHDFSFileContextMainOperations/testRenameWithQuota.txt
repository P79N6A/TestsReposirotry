@Test public void testRenameWithQuota() throws Exception {
  DistributedFileSystem fs=cluster.getFileSystem();
  Path src1=getTestRootPath(fc,"test/testRenameWithQuota/srcdir/src1");
  Path src2=getTestRootPath(fc,"test/testRenameWithQuota/srcdir/src2");
  Path dst1=getTestRootPath(fc,"test/testRenameWithQuota/dstdir/dst1");
  Path dst2=getTestRootPath(fc,"test/testRenameWithQuota/dstdir/dst2");
  createFile(src1);
  createFile(src2);
  fs.setQuota(src1.getParent(),HdfsConstants.QUOTA_DONT_SET,HdfsConstants.QUOTA_DONT_SET);
  fc.mkdir(dst1.getParent(),FileContext.DEFAULT_PERM,true);
  fs.setQuota(dst1.getParent(),2,HdfsConstants.QUOTA_DONT_SET);
  rename(src1,dst1,false,true,Rename.NONE);
  rename(src2,dst1,false,true,Rename.OVERWRITE);
  createFile(src2);
  try {
    rename(src2,dst2,true,false,Rename.NONE);
    fail("NSQuotaExceededException excepted");
  }
 catch (  NSQuotaExceededException e) {
  }
  fs.setQuota(src1.getParent(),1,HdfsConstants.QUOTA_DONT_SET);
  try {
    rename(dst1,src1,true,false,Rename.NONE);
    fail("NSQuotaExceededException excepted");
  }
 catch (  NSQuotaExceededException e) {
  }
  fs.setQuota(src1.getParent(),100,HdfsConstants.QUOTA_DONT_SET);
  createFile(src1);
  fs.setQuota(src1.getParent(),1,HdfsConstants.QUOTA_DONT_SET);
  rename(dst1,src1,false,true,Rename.OVERWRITE);
}
