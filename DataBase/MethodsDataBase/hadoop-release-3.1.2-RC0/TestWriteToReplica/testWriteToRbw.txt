@Test public void testWriteToRbw() throws Exception {
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(new HdfsConfiguration(),new File(GenericTestUtils.getRandomizedTempPath())).build();
  try {
    cluster.waitActive();
    DataNode dn=cluster.getDataNodes().get(0);
    FsDatasetImpl dataSet=(FsDatasetImpl)DataNodeTestUtils.getFSDataset(dn);
    String bpid=cluster.getNamesystem().getBlockPoolId();
    ExtendedBlock[] blocks=setup(bpid,cluster.getFsDatasetTestUtils(dn));
    testWriteToRbw(dataSet,blocks);
  }
  finally {
    cluster.shutdown();
  }
}
