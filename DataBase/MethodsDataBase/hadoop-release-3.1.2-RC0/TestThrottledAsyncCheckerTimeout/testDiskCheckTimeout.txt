@Test public void testDiskCheckTimeout() throws Exception {
  LOG.info("Executing {}",testName.getMethodName());
  final DummyCheckable target=new DummyCheckable();
  final FakeTimer timer=new FakeTimer();
  ThrottledAsyncChecker<Boolean,Boolean> checker=new ThrottledAsyncChecker<>(timer,0,DISK_CHECK_TIMEOUT,getExecutorService());
  lock.lock();
  final Optional<ListenableFuture<Boolean>> olf=checker.schedule(target,true);
  final AtomicLong numCallbackInvocationsSuccess=new AtomicLong(0);
  final AtomicLong numCallbackInvocationsFailure=new AtomicLong(0);
  AtomicBoolean callbackResult=new AtomicBoolean(false);
  final Throwable[] throwable=new Throwable[1];
  assertTrue(olf.isPresent());
  Futures.addCallback(olf.get(),new FutureCallback<Boolean>(){
    @Override public void onSuccess(    Boolean result){
      numCallbackInvocationsSuccess.incrementAndGet();
      callbackResult.set(true);
    }
    @Override public void onFailure(    Throwable t){
      throwable[0]=t;
      numCallbackInvocationsFailure.incrementAndGet();
      callbackResult.set(true);
    }
  }
);
  while (!callbackResult.get()) {
    Thread.sleep(DISK_CHECK_TIMEOUT);
  }
  lock.unlock();
  assertThat(numCallbackInvocationsFailure.get(),is(1L));
  assertThat(numCallbackInvocationsSuccess.get(),is(0L));
  assertTrue(throwable[0] instanceof TimeoutException);
}
