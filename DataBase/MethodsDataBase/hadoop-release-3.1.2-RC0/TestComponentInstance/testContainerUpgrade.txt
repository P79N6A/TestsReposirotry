@Test public void testContainerUpgrade() throws Exception {
  ServiceContext context=TestComponent.createTestContext(rule,"testContainerUpgrade");
  Component component=context.scheduler.getAllComponents().entrySet().iterator().next().getValue();
  upgradeComponent(component);
  ComponentInstance instance=component.getAllComponentInstances().iterator().next();
  ComponentInstanceEvent instanceEvent=new ComponentInstanceEvent(instance.getContainer().getId(),ComponentInstanceEventType.UPGRADE);
  instance.handle(instanceEvent);
  Container containerSpec=component.getComponentSpec().getContainer(instance.getContainer().getId().toString());
  Assert.assertEquals("instance not upgrading",ContainerState.UPGRADING,containerSpec.getState());
}
