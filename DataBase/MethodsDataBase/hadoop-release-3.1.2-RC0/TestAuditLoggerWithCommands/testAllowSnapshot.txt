@Test public void testAllowSnapshot() throws Exception {
  Path srcDir=new Path(System.getProperty("user.dir"),"/src");
  fs.mkdirs(srcDir);
  String pattern=".*allowed=true.*ugi=" + System.getProperty("user.name") + ".*cmd=allowSnapshot.*";
  try {
    ((DistributedFileSystem)fs).allowSnapshot(srcDir);
    verifyAuditLogs(pattern);
  }
 catch (  Exception e) {
    fail("The operation should not have failed with Exception");
  }
  fileSys=DFSTestUtil.getFileSystemAs(user1,conf);
  try {
    ((DistributedFileSystem)fileSys).allowSnapshot(srcDir);
    fail("The operation should have failed with AccessControlException");
  }
 catch (  AccessControlException ace) {
  }
  pattern=".*allowed=false.*ugi=theDoctor.*cmd=allowSnapshot.*";
  verifyAuditLogs(pattern);
  fs.delete(srcDir,true);
  fileSys.close();
}
