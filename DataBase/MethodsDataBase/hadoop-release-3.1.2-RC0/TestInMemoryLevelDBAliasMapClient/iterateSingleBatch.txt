@Test public void iterateSingleBatch() throws Exception {
  levelDBAliasMapServer.setConf(conf);
  levelDBAliasMapServer.start();
  inMemoryLevelDBAliasMapClient.setConf(conf);
  Block block1=new Block(42,43,44);
  Block block2=new Block(43,44,45);
  byte[] nonce1="blackbird".getBytes();
  byte[] nonce2="cuckoo".getBytes();
  ProvidedStorageLocation providedStorageLocation1=new ProvidedStorageLocation(new Path("eagle"),46,47,nonce1);
  ProvidedStorageLocation providedStorageLocation2=new ProvidedStorageLocation(new Path("falcon"),46,47,nonce2);
  BlockAliasMap.Writer<FileRegion> writer1=inMemoryLevelDBAliasMapClient.getWriter(null,BPID);
  writer1.store(new FileRegion(block1,providedStorageLocation1));
  BlockAliasMap.Writer<FileRegion> writer2=inMemoryLevelDBAliasMapClient.getWriter(null,BPID);
  writer2.store(new FileRegion(block2,providedStorageLocation2));
  BlockAliasMap.Reader<FileRegion> reader=inMemoryLevelDBAliasMapClient.getReader(null,BPID);
  List<FileRegion> actualFileRegions=Lists.newArrayListWithCapacity(2);
  for (  FileRegion fileRegion : reader) {
    actualFileRegions.add(fileRegion);
  }
  assertArrayEquals(new FileRegion[]{new FileRegion(block1,providedStorageLocation1),new FileRegion(block2,providedStorageLocation2)},actualFileRegions.toArray());
}
