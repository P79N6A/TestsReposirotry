@Test public void testNewDirInitAfterCheckpointing() throws Exception {
  File hdfsDir=new File(PathUtils.getTestDir(TestStandbyCheckpoints.class),"testNewDirInitAfterCheckpointing");
  File nameDir=new File(hdfsDir,"name1");
  assert nameDir.mkdirs();
  String existingDir=cluster.getConfiguration(0).get(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY);
  cluster.getConfiguration(0).set(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,existingDir + "," + Util.fileAsURI(nameDir).toString());
  cluster.restartNameNode(0);
  nns[0]=cluster.getNameNode(0);
  cluster.transitionToActive(0);
  File currDir=new File(nameDir,"current");
  File versionFile=new File(currDir,"VERSION");
  assert currDir.exists();
  assert !versionFile.exists();
  doEdits(0,10);
  HATestUtil.waitForStandbyToCatchUp(nns[0],nns[1]);
  for (int i=0; i < 20; i++) {
    if (versionFile.exists()) {
      break;
    }
    Thread.sleep(500);
  }
  assert versionFile.exists();
}
