/** 
 * Test Balancer runs fine when logging in with a keytab in kerberized env. Reusing testUnknownDatanode here for basic functionality testing.
 */
@Test(timeout=300000) public void testBalancerWithKeytabs() throws Exception {
  final Configuration conf=new HdfsConfiguration();
  try {
    initSecureConf(conf);
    final UserGroupInformation ugi=UserGroupInformation.loginUserFromKeytabAndReturnUGI(principal,keytabFile.getAbsolutePath());
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        testUnknownDatanode(conf);
        assertTrue(UserGroupInformation.isLoginKeytabBased());
        return null;
      }
    }
);
  }
  finally {
    UserGroupInformation.reset();
    UserGroupInformation.setConfiguration(new Configuration());
  }
}
