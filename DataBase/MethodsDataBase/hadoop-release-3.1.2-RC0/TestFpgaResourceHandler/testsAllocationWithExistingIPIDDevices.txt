@Test public void testsAllocationWithExistingIPIDDevices() throws ResourceHandlerException, PrivilegedOperationException {
  configuration.set(YarnConfiguration.NM_FPGA_ALLOWED_DEVICES,"0,1,2");
  fpgaResourceHandler.bootstrap(configuration);
  fpgaResourceHandler.preStart(mockContainer(0,3,"GEMM"));
  Assert.assertEquals(3,fpgaResourceHandler.getFpgaAllocator().getUsedFpgaCount());
  List<FpgaResourceAllocator.FpgaDevice> list=fpgaResourceHandler.getFpgaAllocator().getUsedFpga().get(getContainerId(0).toString());
  fpgaResourceHandler.postComplete(getContainerId(0));
  for (  FpgaResourceAllocator.FpgaDevice device : list) {
    Assert.assertEquals("IP should be updated to GEMM","GEMM",device.getIPID());
  }
  fpgaResourceHandler.preStart(mockContainer(1,1,"GEMM"));
  fpgaResourceHandler.preStart(mockContainer(2,1,"GEMM"));
  verify(mockVendorPlugin,times(3)).configureIP(anyString(),anyString());
  fpgaResourceHandler.postComplete(getContainerId(1));
  fpgaResourceHandler.postComplete(getContainerId(2));
  fpgaResourceHandler.preStart(mockContainer(1,1,"GZIP"));
  verify(mockVendorPlugin,times(4)).configureIP(anyString(),anyString());
}
