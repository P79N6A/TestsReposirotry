@Test public void testRead() throws Exception {
  MiniDFSCluster cluster=null;
  int numDataNodes=2;
  Configuration conf=getConf(numDataNodes);
  try {
    cluster=new MiniDFSCluster.Builder(conf).nameNodePort(ServerSocketUtil.getPort(18020,100)).nameNodeHttpPort(ServerSocketUtil.getPort(19870,100)).numDataNodes(numDataNodes).build();
    cluster.waitActive();
    assertEquals(numDataNodes,cluster.getDataNodes().size());
    doTestRead(conf,cluster,false);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
