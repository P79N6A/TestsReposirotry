@Test public void testVolumeMetrics() throws Exception {
  MiniDFSCluster cluster=setupClusterForVolumeMetrics();
  try {
    FileSystem fs=cluster.getFileSystem();
    final Path fileName=new Path("/test.dat");
    final long fileLen=Integer.MAX_VALUE + 1L;
    DFSTestUtil.createFile(fs,fileName,false,BLOCK_SIZE,fileLen,fs.getDefaultBlockSize(fileName),REPL,1L,true);
    try (FSDataOutputStream out=fs.append(fileName)){
      out.writeBytes("hello world");
      ((DFSOutputStream)out.getWrappedStream()).hsync();
    }
     verifyDataNodeVolumeMetrics(fs,cluster,fileName);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
