@Test public void testUpgradeMultipleInstances(){
  Service goodService=ServiceClientTest.buildLiveGoodService();
  Component comp=goodService.getComponents().iterator().next();
  comp.getContainers().forEach(container -> container.setState(ContainerState.UPGRADING));
  Service serviceStatus=mockServerClient.getGoodServiceStatus();
  serviceStatus.setState(ServiceState.UPGRADING);
  Set<String> expectedInstances=new HashSet<>();
  serviceStatus.getComponents().iterator().next().getContainers().forEach(container -> {
    container.setState(ContainerState.NEEDS_UPGRADE);
    expectedInstances.add(container.getComponentInstanceName());
  }
);
  mockServerClient.setExpectedInstances(expectedInstances);
  final Response actual=apiServer.updateComponentInstances(request,goodService.getName(),comp.getContainers());
  assertEquals("Instance upgrade is ",Response.status(Status.ACCEPTED).build().getStatus(),actual.getStatus());
}
