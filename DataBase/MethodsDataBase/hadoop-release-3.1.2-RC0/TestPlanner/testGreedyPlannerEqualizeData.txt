/** 
 * In this test we pass 3 volumes with 30, 20 and 10 GB of data used. We expect the planner to print out 20 GB on each volume. <p/> That is the plan should say move 10 GB from volume30 to volume10.
 */
@Test public void testGreedyPlannerEqualizeData() throws Exception {
  NullConnector nullConnector=new NullConnector();
  DiskBalancerCluster cluster=new DiskBalancerCluster(nullConnector);
  DiskBalancerDataNode node=new DiskBalancerDataNode(UUID.randomUUID().toString());
  DiskBalancerVolume volume30=createVolume("volume30",100,30);
  DiskBalancerVolume volume20=createVolume("volume20",100,20);
  DiskBalancerVolume volume10=createVolume("volume10",100,10);
  node.addVolume(volume10);
  node.addVolume(volume20);
  node.addVolume(volume30);
  nullConnector.addNode(node);
  cluster.readClusterInfo();
  Assert.assertEquals(1,cluster.getNodes().size());
  GreedyPlanner planner=new GreedyPlanner(5.0f,node);
  NodePlan plan=new NodePlan(node.getDataNodeUUID(),node.getDataNodePort());
  planner.balanceVolumeSet(node,node.getVolumeSets().get("SSD"),plan);
  assertEquals(1,plan.getVolumeSetPlans().size());
  Step step=plan.getVolumeSetPlans().get(0);
  assertEquals("volume30",step.getSourceVolume().getPath());
  assertEquals("volume10",step.getDestinationVolume().getPath());
  assertEquals("10 G",step.getSizeString(step.getBytesToMove()));
}
