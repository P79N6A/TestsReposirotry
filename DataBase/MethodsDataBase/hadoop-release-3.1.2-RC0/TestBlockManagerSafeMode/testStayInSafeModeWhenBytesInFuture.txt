/** 
 * Test block manager won't leave safe mode if there are blocks with generation stamp (GS) in future.
 */
@Test(timeout=30000) public void testStayInSafeModeWhenBytesInFuture() throws Exception {
  bmSafeMode.activate(BLOCK_TOTAL);
  injectBlocksWithFugureGS(100L);
  assertEquals(100L,bmSafeMode.getBytesInFuture());
  setBlockSafe(BLOCK_THRESHOLD);
  bmSafeMode.checkSafeMode();
  assertFalse("Shouldn't leave safe mode in case of blocks with future GS! ",bmSafeMode.leaveSafeMode(false));
  assertTrue("Leaving safe mode forcefully should succeed regardless of " + "blocks with future GS.",bmSafeMode.leaveSafeMode(true));
  assertEquals("Number of blocks with future GS should have been cleared " + "after leaving safe mode",0L,bmSafeMode.getBytesInFuture());
  assertTrue("Leaving safe mode should succeed after blocks with future GS " + "are cleared.",bmSafeMode.leaveSafeMode(false));
}
