/** 
 * Rename of the underconstruction file in snapshot should not fail NN restart after checkpoint. Unit test for HDFS-5425.
 */
@Test public void testRenameUCFileInSnapshot() throws Exception {
  final Path test=new Path("/test");
  final Path foo=new Path(test,"foo");
  final Path bar=new Path(foo,"bar");
  hdfs.mkdirs(foo);
  hdfs.create(bar);
  SnapshotTestHelper.createSnapshot(hdfs,test,"s0");
  final Path bar2=new Path(foo,"bar2");
  hdfs.rename(bar,bar2);
  restartClusterAndCheckImage(true);
}
