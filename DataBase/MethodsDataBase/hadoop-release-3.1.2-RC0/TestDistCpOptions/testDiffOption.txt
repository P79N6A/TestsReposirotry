@Test public void testDiffOption(){
  DistCpOptions options=new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withSyncFolder(true).withUseDiff("s1","s2").build();
  Assert.assertTrue(options.shouldUseDiff());
  Assert.assertEquals("s1",options.getFromSnapshot());
  Assert.assertEquals("s2",options.getToSnapshot());
  options=new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withSyncFolder(true).withUseDiff("s1",".").build();
  Assert.assertTrue(options.shouldUseDiff());
  Assert.assertEquals("s1",options.getFromSnapshot());
  Assert.assertEquals(".",options.getToSnapshot());
  try {
    new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withUseDiff("s1","s2").build();
    fail("-diff should fail if -update option is not specified");
  }
 catch (  IllegalArgumentException e) {
    assertExceptionContains("-diff/-rdiff is valid only with -update option",e);
  }
  try {
    new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withSyncFolder(true).withUseDiff("s1","s2").withDeleteMissing(true).build();
    fail("Should fail as -delete and -diff/-rdiff are mutually exclusive.");
  }
 catch (  IllegalArgumentException e) {
    assertExceptionContains("-delete and -diff/-rdiff are mutually exclusive.",e);
  }
  try {
    new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withUseDiff("s1","s2").withDeleteMissing(true).build();
    fail("-diff should fail if -update option is not specified");
  }
 catch (  IllegalArgumentException e) {
    assertExceptionContains("-delete and -diff/-rdiff are mutually exclusive.",e);
  }
  try {
    new DistCpOptions.Builder(new Path("hdfs://localhost:8020/source/first"),new Path("hdfs://localhost:8020/target/")).withDeleteMissing(true).withUseDiff("s1","s2").build();
    fail("Should have failed as -delete and -diff are mutually exclusive");
  }
 catch (  IllegalArgumentException e) {
    assertExceptionContains("-delete and -diff/-rdiff are mutually exclusive",e);
  }
}
