@Test(timeout=30000) public void testAMUsedResource() throws Exception {
  MockRM rm=setUpMove();
  rm.registerNode("127.0.0.1:1234",4 * GB);
  Configuration conf=rm.getConfig();
  int minAllocMb=conf.getInt(YarnConfiguration.RM_SCHEDULER_MINIMUM_ALLOCATION_MB,YarnConfiguration.DEFAULT_RM_SCHEDULER_MINIMUM_ALLOCATION_MB);
  int amMemory=50;
  assertTrue("AM memory is greater than or equal to minAllocation",amMemory < minAllocMb);
  Resource minAllocResource=Resource.newInstance(minAllocMb,1);
  String queueName="a1";
  RMApp rmApp=rm.submitApp(amMemory,"app-1","user_0",null,queueName);
  assertEquals("RMApp does not containes minimum allocation",minAllocResource,rmApp.getAMResourceRequests().get(0).getCapability());
  ResourceScheduler scheduler=rm.getRMContext().getScheduler();
  LeafQueue queueA=(LeafQueue)((CapacityScheduler)scheduler).getQueue(queueName);
  assertEquals("Minimum Resource for AM is incorrect",minAllocResource,queueA.getUser("user_0").getResourceUsage().getAMUsed());
  rm.stop();
}
