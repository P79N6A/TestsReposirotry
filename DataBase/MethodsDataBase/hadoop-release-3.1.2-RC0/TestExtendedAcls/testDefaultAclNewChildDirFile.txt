/** 
 * Set default ACL to a directory. Create subdirectory, it must have default acls set. Create sub file and it should have default acls.
 * @throws IOException
 */
@Test public void testDefaultAclNewChildDirFile() throws IOException {
  Path parent=new Path("/testDefaultAclNewChildDirFile");
  List<AclEntry> acls=Lists.newArrayList(aclEntry(DEFAULT,USER,"foo",ALL));
  hdfs.mkdirs(parent);
  hdfs.setAcl(parent,acls);
  Path childDir=new Path(parent,"childDir");
  hdfs.mkdirs(childDir);
  AclEntry[] childDirExpectedAcl=new AclEntry[]{aclEntry(ACCESS,USER,"foo",ALL),aclEntry(ACCESS,GROUP,READ_EXECUTE),aclEntry(DEFAULT,USER,ALL),aclEntry(DEFAULT,USER,"foo",ALL),aclEntry(DEFAULT,GROUP,READ_EXECUTE),aclEntry(DEFAULT,MASK,ALL),aclEntry(DEFAULT,OTHER,READ_EXECUTE)};
  AclStatus childDirAcl=hdfs.getAclStatus(childDir);
  assertArrayEquals(childDirExpectedAcl,childDirAcl.getEntries().toArray());
  Path childFile=new Path(parent,"childFile");
  hdfs.create(childFile).close();
  AclEntry[] childFileExpectedAcl=new AclEntry[]{aclEntry(ACCESS,USER,"foo",ALL),aclEntry(ACCESS,GROUP,READ_EXECUTE)};
  AclStatus childFileAcl=hdfs.getAclStatus(childFile);
  assertArrayEquals(childFileExpectedAcl,childFileAcl.getEntries().toArray());
  hdfs.delete(parent,true);
}
