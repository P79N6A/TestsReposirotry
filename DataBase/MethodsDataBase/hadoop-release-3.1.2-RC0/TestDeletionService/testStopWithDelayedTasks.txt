@Test public void testStopWithDelayedTasks() throws Exception {
  DeletionService del=new DeletionService(Mockito.mock(ContainerExecutor.class));
  Configuration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.DEBUG_NM_DELETE_DELAY_SEC,60);
  try {
    del.init(conf);
    del.start();
    FileDeletionTask deletionTask=new FileDeletionTask(del,"dingo",new Path("/does/not/exist"),null);
    del.delete(deletionTask);
  }
  finally {
    del.stop();
  }
  assertTrue(del.isTerminated());
}
