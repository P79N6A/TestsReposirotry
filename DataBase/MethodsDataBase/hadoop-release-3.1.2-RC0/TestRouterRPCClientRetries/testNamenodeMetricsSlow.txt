@Test public void testNamenodeMetricsSlow() throws Exception {
  final Router router=routerContext.getRouter();
  final NamenodeBeanMetrics metrics=router.getNamenodeMetrics();
  final String jsonString0=metrics.getLiveNodes();
  assertEquals(4,getNumDatanodes(jsonString0));
  assertEquals(jsonString0,metrics.getLiveNodes());
  waitUpdateLiveNodes(jsonString0,metrics);
  final String jsonString2=metrics.getLiveNodes();
  assertNotEquals(jsonString0,jsonString2);
  assertEquals(4,getNumDatanodes(jsonString2));
  MiniDFSCluster dfsCluster=cluster.getCluster();
  NameNode nn0=dfsCluster.getNameNode(0);
  simulateSlowNamenode(nn0,3);
  waitUpdateLiveNodes(jsonString2,metrics);
  final String jsonString3=metrics.getLiveNodes();
  assertEquals(2,getNumDatanodes(jsonString3));
  NameNode nn1=dfsCluster.getNameNode(1);
  simulateSlowNamenode(nn1,3);
  waitUpdateLiveNodes(jsonString3,metrics);
  final String jsonString4=metrics.getLiveNodes();
  assertEquals(0,getNumDatanodes(jsonString4));
}
