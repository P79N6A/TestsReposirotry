/** 
 * Test for including the snapshot files in fsck report.
 */
@Test public void testFsckForSnapshotFiles() throws Exception {
  File builderBaseDir=new File(GenericTestUtils.getRandomizedTempPath());
  cluster=new MiniDFSCluster.Builder(conf,builderBaseDir).numDataNodes(1).build();
  String runFsck=runFsck(conf,0,true,"/","-includeSnapshots","-files");
  assertTrue(runFsck.contains("HEALTHY"));
  final String fileName="/srcdat";
  DistributedFileSystem hdfs=cluster.getFileSystem();
  Path file1=new Path(fileName);
  DFSTestUtil.createFile(hdfs,file1,1024,(short)1,1000L);
  hdfs.allowSnapshot(new Path("/"));
  hdfs.createSnapshot(new Path("/"),"mySnapShot");
  runFsck=runFsck(conf,0,true,"/","-includeSnapshots","-files");
  assertTrue(runFsck.contains("/.snapshot/mySnapShot/srcdat"));
  runFsck=runFsck(conf,0,true,"/","-files");
  assertFalse(runFsck.contains("mySnapShot"));
}
