@Test public void testIncreaseContainerResourceWithInvalidRequests() throws Exception {
  containerManager.start();
  List<StartContainerRequest> list=new ArrayList<>();
  for (int i=0; i < 4; i++) {
    ContainerId cId=createContainerId(i);
    long identifier=DUMMY_RM_IDENTIFIER;
    Token containerToken=createContainerToken(cId,identifier,context.getNodeId(),user,context.getContainerTokenSecretManager());
    StartContainerRequest request=StartContainerRequest.newInstance(recordFactory.newRecordInstance(ContainerLaunchContext.class),containerToken);
    list.add(request);
  }
  StartContainersRequest requestList=StartContainersRequest.newInstance(list);
  StartContainersResponse response=containerManager.startContainers(requestList);
  Assert.assertEquals(4,response.getSuccessfullyStartedContainers().size());
  int i=0;
  for (  ContainerId id : response.getSuccessfullyStartedContainers()) {
    Assert.assertEquals(i,id.getContainerId());
    i++;
  }
  Thread.sleep(2000);
  List<Token> increaseTokens=new ArrayList<>();
  ContainerId cId0=createContainerId(0);
  Token containerToken=createContainerToken(cId0,1,DUMMY_RM_IDENTIFIER,context.getNodeId(),user,Resource.newInstance(1234,3),context.getContainerTokenSecretManager(),null);
  increaseTokens.add(containerToken);
  ContainerId cId7=createContainerId(7);
  containerToken=createContainerToken(cId7,DUMMY_RM_IDENTIFIER,context.getNodeId(),user,Resource.newInstance(1234,3),context.getContainerTokenSecretManager(),null);
  increaseTokens.add(containerToken);
  ContainerUpdateRequest updateRequest=ContainerUpdateRequest.newInstance(increaseTokens);
  ContainerUpdateResponse updateResponse=containerManager.updateContainer(updateRequest);
  Assert.assertEquals(1,updateResponse.getSuccessfullyUpdatedContainers().size());
  Assert.assertEquals(1,updateResponse.getFailedRequests().size());
  for (  Map.Entry<ContainerId,SerializedException> entry : updateResponse.getFailedRequests().entrySet()) {
    Assert.assertNotNull("Failed message",entry.getValue().getMessage());
    if (cId7.equals(entry.getKey())) {
      Assert.assertTrue(entry.getValue().getMessage().contains("Container " + cId7.toString() + " is not handled by this NodeManager"));
    }
 else {
      throw new YarnException("Received failed request from wrong" + " container: " + entry.getKey().toString());
    }
  }
}
