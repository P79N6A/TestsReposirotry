@Test public void testMoveApplicationAdminTargetQueue() throws Exception {
  ApplicationId applicationId=getApplicationId(1);
  UserGroupInformation aclUGI=UserGroupInformation.getCurrentUser();
  QueueACLsManager queueAclsManager=getQueueAclManager("allowed_queue",QueueACL.ADMINISTER_QUEUE,aclUGI);
  ApplicationACLsManager appAclsManager=getAppAclManager();
  ClientRMService rmService=createClientRMServiceForMoveApplicationRequest(applicationId,aclUGI.getShortUserName(),appAclsManager,queueAclsManager);
  MoveApplicationAcrossQueuesRequest moveAppRequest=MoveApplicationAcrossQueuesRequest.newInstance(applicationId,"allowed_queue");
  rmService.moveApplicationAcrossQueues(moveAppRequest);
  moveAppRequest=MoveApplicationAcrossQueuesRequest.newInstance(applicationId,"not_allowed");
  try {
    rmService.moveApplicationAcrossQueues(moveAppRequest);
    Assert.fail("The request should fail with an AccessControlException");
  }
 catch (  YarnException rex) {
    Assert.assertTrue("AccessControlException is expected",rex.getCause() instanceof AccessControlException);
  }
  aclUGI=UserGroupInformation.createUserForTesting("moveuser",new String[]{});
  queueAclsManager=getQueueAclManager("move_queue",QueueACL.ADMINISTER_QUEUE,aclUGI);
  appAclsManager=getAppAclManager();
  ClientRMService rmService2=createClientRMServiceForMoveApplicationRequest(applicationId,aclUGI.getShortUserName(),appAclsManager,queueAclsManager);
  MoveApplicationAcrossQueuesRequest moveAppRequest2=MoveApplicationAcrossQueuesRequest.newInstance(applicationId,"move_queue");
  try {
    rmService2.moveApplicationAcrossQueues(moveAppRequest2);
    Assert.fail("The request should fail with an AccessControlException");
  }
 catch (  YarnException rex) {
    Assert.assertTrue("AccessControlException is expected",rex.getCause() instanceof AccessControlException);
  }
  aclUGI.doAs(new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws Exception {
      return rmService2.moveApplicationAcrossQueues(moveAppRequest2);
    }
  }
);
}
