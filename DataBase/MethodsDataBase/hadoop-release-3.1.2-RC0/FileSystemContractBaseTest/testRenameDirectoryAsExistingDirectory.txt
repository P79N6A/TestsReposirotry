@Test public void testRenameDirectoryAsExistingDirectory() throws Exception {
  assumeTrue(renameSupported());
  final Path src=path("testRenameDirectoryAsExistingDirectory/dir");
  fs.mkdirs(src);
  createFile(path(src + "/file1"));
  createFile(path(src + "/subdir/file2"));
  final Path dst=path("testRenameDirectoryAsExistingDirectoryNew/newdir");
  fs.mkdirs(dst);
  rename(src,dst,true,false,true);
  assertTrue("Destination changed",fs.exists(path(dst + "/dir")));
  assertFalse("Nested file1 exists",fs.exists(path(src + "/file1")));
  assertFalse("Nested file2 exists",fs.exists(path(src + "/dir/subdir/file2")));
  assertTrue("Renamed nested file1 exists",fs.exists(path(dst + "/dir/file1")));
  assertTrue("Renamed nested exists",fs.exists(path(dst + "/dir/subdir/file2")));
}
