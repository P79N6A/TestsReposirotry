@Test public void testLegacyBlockInInvalidateBlocks(){
  final long legancyGenerationStampLimit=10000;
  BlockIdManager bim=Mockito.mock(BlockIdManager.class);
  when(bim.getLegacyGenerationStampLimit()).thenReturn(legancyGenerationStampLimit);
  when(bim.isStripedBlock(any(Block.class))).thenCallRealMethod();
  when(bim.isLegacyBlock(any(Block.class))).thenCallRealMethod();
  InvalidateBlocks ibs=new InvalidateBlocks(100,30000,bim);
  Block legacy=new Block(-1,10,legancyGenerationStampLimit / 10);
  Block striped=new Block(bm.nextBlockId(BlockType.STRIPED),10,legancyGenerationStampLimit + 10);
  DatanodeInfo legacyDnInfo=DFSTestUtil.getLocalDatanodeInfo();
  DatanodeInfo stripedDnInfo=DFSTestUtil.getLocalDatanodeInfo();
  ibs.add(legacy,legacyDnInfo,false);
  assertEquals(1,ibs.getBlocks());
  assertEquals(0,ibs.getECBlocks());
  ibs.add(striped,stripedDnInfo,false);
  assertEquals(1,ibs.getBlocks());
  assertEquals(1,ibs.getECBlocks());
  ibs.remove(legacyDnInfo);
  assertEquals(0,ibs.getBlocks());
  assertEquals(1,ibs.getECBlocks());
  ibs.remove(stripedDnInfo);
  assertEquals(0,ibs.getBlocks());
  assertEquals(0,ibs.getECBlocks());
}
