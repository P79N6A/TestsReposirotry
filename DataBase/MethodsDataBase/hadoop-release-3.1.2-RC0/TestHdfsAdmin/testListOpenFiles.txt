@Test(timeout=120000L) public void testListOpenFiles() throws IOException {
  HashSet<Path> closedFileSet=new HashSet<>();
  HashMap<Path,FSDataOutputStream> openFileMap=new HashMap<>();
  FileSystem fs=FileSystem.get(conf);
  verifyOpenFiles(closedFileSet,openFileMap);
  int numClosedFiles=OPEN_FILES_BATCH_SIZE * 4;
  int numOpenFiles=(OPEN_FILES_BATCH_SIZE * 3) + 1;
  for (int i=0; i < numClosedFiles; i++) {
    Path filePath=new Path("/closed-file-" + i);
    DFSTestUtil.createFile(fs,filePath,SIZE,REPL,0);
    closedFileSet.add(filePath);
  }
  verifyOpenFiles(closedFileSet,openFileMap);
  openFileMap.putAll(DFSTestUtil.createOpenFiles(fs,"open-file-1",numOpenFiles));
  verifyOpenFiles(closedFileSet,openFileMap);
  closedFileSet.addAll(DFSTestUtil.closeOpenFiles(openFileMap,openFileMap.size() / 2));
  verifyOpenFiles(closedFileSet,openFileMap);
  openFileMap.putAll(DFSTestUtil.createOpenFiles(fs,"open-file-2",10));
  verifyOpenFiles(closedFileSet,openFileMap);
  while (openFileMap.size() > 0) {
    closedFileSet.addAll(DFSTestUtil.closeOpenFiles(openFileMap,1));
    verifyOpenFiles(closedFileSet,openFileMap);
  }
}
