/** 
 * When the two DataNodes with partial data blocks fail.
 */
@Test public void testCloseWithExceptionsInStreamer() throws Exception {
  final HdfsConfiguration conf=newHdfsConfiguration();
  final int[] fileLengths={cellSize * (dataBlocks * 2 - 2),(cellSize * dataBlocks) + 123};
  int[] dnIndex=null;
  if (parityBlocks > 1) {
    dnIndex=new int[]{dataBlocks - 2,dataBlocks - 1};
  }
 else {
    dnIndex=new int[]{dataBlocks - 1};
  }
  for (  int length : fileLengths) {
    final int[] killPos=getKillPositions(length,dnIndex.length);
    try {
      LOG.info("runTestWithMultipleFailure2: length==" + length + ", killPos="+ Arrays.toString(killPos)+ ", dnIndex="+ Arrays.toString(dnIndex));
      setup(conf);
      runTest(length,killPos,dnIndex,false);
    }
 catch (    Throwable e) {
      final String err="failed, killPos=" + Arrays.toString(killPos) + ", dnIndex="+ Arrays.toString(dnIndex)+ ", length="+ length;
      LOG.error(err);
      throw e;
    }
 finally {
      tearDown();
    }
  }
}
