/** 
 * Test writing very short EC files with many failures.
 */
@Test public void runTestWithShortStripe() throws Exception {
  final HdfsConfiguration conf=newHdfsConfiguration();
  final int length=cellSize - 123;
  final int[] dnIndex=new int[dataBlocks + parityBlocks - 1];
  for (int i=0; i < dnIndex.length; i++) {
    dnIndex[i]=i;
  }
  final int[] killPos=getKillPositions(length,dnIndex.length);
  try {
    LOG.info("runTestWithShortStripe: length==" + length + ", killPos="+ Arrays.toString(killPos)+ ", dnIndex="+ Arrays.toString(dnIndex));
    setup(conf);
    runTest(length,killPos,dnIndex,false);
  }
 catch (  Throwable e) {
    final String err="failed, killPos=" + Arrays.toString(killPos) + ", dnIndex="+ Arrays.toString(dnIndex)+ ", length="+ length;
    LOG.error(err);
    throw e;
  }
 finally {
    tearDown();
  }
}
