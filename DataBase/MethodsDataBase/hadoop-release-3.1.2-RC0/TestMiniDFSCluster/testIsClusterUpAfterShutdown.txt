@Test(timeout=100000) public void testIsClusterUpAfterShutdown() throws Throwable {
  Configuration conf=new HdfsConfiguration();
  File testDataCluster4=new File(testDataPath,CLUSTER_4);
  MiniDFSCluster cluster4=new MiniDFSCluster.Builder(conf,testDataCluster4).build();
  try {
    DistributedFileSystem dfs=cluster4.getFileSystem();
    dfs.setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_ENTER);
    cluster4.shutdown();
  }
  finally {
    while (cluster4.isClusterUp()) {
      Thread.sleep(1000);
    }
  }
}
