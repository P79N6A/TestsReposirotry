@Test public void getNumberOfUsableGpusFromConfig() throws YarnException {
  Configuration conf=new Configuration(false);
  conf.set(YarnConfiguration.NM_GPU_ALLOWED_DEVICES,"0:0,1:1,2:2,3");
  GpuDiscoverer plugin=new GpuDiscoverer();
  try {
    plugin.initialize(conf);
    plugin.getGpusUsableByYarn();
    Assert.fail("Illegal format, should fail.");
  }
 catch (  YarnException e) {
  }
  conf.set(YarnConfiguration.NM_GPU_ALLOWED_DEVICES,"0:0,1:1,2:2,3:4");
  plugin=new GpuDiscoverer();
  plugin.initialize(conf);
  List<GpuDevice> usableGpuDevices=plugin.getGpusUsableByYarn();
  Assert.assertEquals(4,usableGpuDevices.size());
  Assert.assertTrue(0 == usableGpuDevices.get(0).getIndex());
  Assert.assertTrue(1 == usableGpuDevices.get(1).getIndex());
  Assert.assertTrue(2 == usableGpuDevices.get(2).getIndex());
  Assert.assertTrue(3 == usableGpuDevices.get(3).getIndex());
  Assert.assertTrue(0 == usableGpuDevices.get(0).getMinorNumber());
  Assert.assertTrue(1 == usableGpuDevices.get(1).getMinorNumber());
  Assert.assertTrue(2 == usableGpuDevices.get(2).getMinorNumber());
  Assert.assertTrue(4 == usableGpuDevices.get(3).getMinorNumber());
}
