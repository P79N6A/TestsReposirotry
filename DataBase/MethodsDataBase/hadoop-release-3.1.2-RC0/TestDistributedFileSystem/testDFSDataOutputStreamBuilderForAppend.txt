@Test public void testDFSDataOutputStreamBuilderForAppend() throws IOException {
  Configuration conf=getTestConfiguration();
  String testFile="/testDFSDataOutputStreamBuilderForAppend";
  Path path=new Path(testFile);
  Random random=new Random();
  try (MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build()){
    DistributedFileSystem fs=cluster.getFileSystem();
    byte[] buf=new byte[16];
    random.nextBytes(buf);
    try (FSDataOutputStream out=fs.appendFile(path).build()){
      out.write(buf);
      fail("should fail on appending to non-existent file");
    }
 catch (    IOException e) {
      GenericTestUtils.assertExceptionContains("non-existent",e);
    }
    random.nextBytes(buf);
    try (FSDataOutputStream out=fs.createFile(path).build()){
      out.write(buf);
    }
     random.nextBytes(buf);
    try (FSDataOutputStream out=fs.appendFile(path).build()){
      out.write(buf);
    }
     FileStatus status=fs.getFileStatus(path);
    assertEquals(16 * 2,status.getLen());
  }
 }
