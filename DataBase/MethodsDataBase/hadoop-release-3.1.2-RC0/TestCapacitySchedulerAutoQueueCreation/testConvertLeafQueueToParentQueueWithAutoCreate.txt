@Test public void testConvertLeafQueueToParentQueueWithAutoCreate() throws Exception {
  CapacityScheduler newCS=new CapacityScheduler();
  try {
    CapacitySchedulerConfiguration newConf=new CapacitySchedulerConfiguration();
    setupQueueConfiguration(newConf);
    newConf.setAutoCreatedLeafQueueConfigCapacity(A1,A1_CAPACITY / 10);
    newConf.setAutoCreateChildQueueEnabled(A1,true);
    newCS.setConf(new YarnConfiguration());
    newCS.setRMContext(mockRM.getRMContext());
    newCS.init(cs.getConf());
    newCS.start();
    final LeafQueue a1Queue=(LeafQueue)newCS.getQueue("a1");
    a1Queue.stopQueue();
    newCS.reinitialize(newConf,new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(newConf),new NMTokenSecretManagerInRM(newConf),new ClientToAMTokenSecretManagerInRM(),null));
  }
  finally {
    newCS.stop();
  }
}
