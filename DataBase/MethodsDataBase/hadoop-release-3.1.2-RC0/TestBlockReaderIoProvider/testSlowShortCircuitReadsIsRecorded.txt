@Test(timeout=300_000) public void testSlowShortCircuitReadsIsRecorded() throws IOException {
  HdfsConfiguration conf=new HdfsConfiguration();
  conf.setInt(HdfsClientConfigKeys.Read.ShortCircuit.METRICS_SAMPLING_PERCENTAGE_KEY,100);
  DfsClientConf clientConf=new DfsClientConf(conf);
  BlockReaderLocalMetrics metrics=Mockito.mock(BlockReaderLocalMetrics.class);
  FileChannel dataIn=Mockito.mock(FileChannel.class);
  Mockito.when(dataIn.read(any(ByteBuffer.class),anyLong())).thenAnswer(new Answer<Object>(){
    @Override public Object answer(    InvocationOnMock invocation) throws Throwable {
      TIMER.advance(SLOW_READ_THRESHOLD);
      return 0;
    }
  }
);
  BlockReaderIoProvider blockReaderIoProvider=new BlockReaderIoProvider(clientConf.getShortCircuitConf(),metrics,TIMER);
  blockReaderIoProvider.read(dataIn,any(ByteBuffer.class),anyLong());
  Mockito.verify(metrics,times(1)).addShortCircuitReadLatency(anyLong());
}
