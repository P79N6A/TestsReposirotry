@Test public void testSetRepOnECFile() throws Exception {
  ClientProtocol client;
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  client=NameNodeProxies.createProxy(conf,cluster.getFileSystem(0).getUri(),ClientProtocol.class).getProxy();
  client.enableErasureCodingPolicy(StripedFileTestUtil.getDefaultECPolicy().getName());
  client.setErasureCodingPolicy("/",StripedFileTestUtil.getDefaultECPolicy().getName());
  FileSystem dfs=cluster.getFileSystem();
  try {
    Path d=new Path("/tmp");
    dfs.mkdirs(d);
    Path f=new Path(d,"foo");
    dfs.createNewFile(f);
    FileStatus file=dfs.getFileStatus(f);
    assertTrue(file.isErasureCoded());
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    System.setOut(new PrintStream(out));
    String[] args={"-setrep","2","" + f};
    FsShell shell=new FsShell();
    shell.setConf(conf);
    assertEquals(0,shell.run(args));
    assertTrue(out.toString().contains("Did not set replication for: /tmp/foo"));
    file=dfs.getFileStatus(f);
    assertEquals(1,file.getReplication());
  }
  finally {
    dfs.close();
    cluster.shutdown();
  }
}
