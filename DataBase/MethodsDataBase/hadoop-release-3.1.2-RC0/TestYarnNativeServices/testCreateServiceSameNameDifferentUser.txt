@Test(timeout=200000) public void testCreateServiceSameNameDifferentUser() throws Exception {
  String sameAppName="same-name";
  String userA="usera";
  String userB="userb";
  setupInternal(NUM_NMS);
  ServiceClient client=createClient(getConf());
  String origBasePath=getConf().get(YARN_SERVICE_BASE_PATH);
  Service userAApp=new Service();
  userAApp.setName(sameAppName);
  userAApp.setVersion("v1");
  userAApp.addComponent(createComponent("comp",1,"sleep 1000"));
  Service userBApp=new Service();
  userBApp.setName(sameAppName);
  userBApp.setVersion("v1");
  userBApp.addComponent(createComponent("comp",1,"sleep 1000"));
  File userABasePath=null, userBBasePath=null;
  try {
    userABasePath=new File(origBasePath,userA);
    userABasePath.mkdirs();
    getConf().set(YARN_SERVICE_BASE_PATH,userABasePath.getAbsolutePath());
    client.actionCreate(userAApp);
    waitForServiceToBeStarted(client,userAApp);
    userBBasePath=new File(origBasePath,userB);
    userBBasePath.mkdirs();
    getConf().set(YARN_SERVICE_BASE_PATH,userBBasePath.getAbsolutePath());
    client.actionBuild(userBApp);
  }
 catch (  Exception e) {
    Assert.fail("Exception should not be thrown - " + e.getLocalizedMessage());
  }
 finally {
    if (userABasePath != null) {
      getConf().set(YARN_SERVICE_BASE_PATH,userABasePath.getAbsolutePath());
      client.actionStop(sameAppName,true);
      client.actionDestroy(sameAppName);
    }
    if (userBBasePath != null) {
      getConf().set(YARN_SERVICE_BASE_PATH,userBBasePath.getAbsolutePath());
      client.actionDestroy(sameAppName);
    }
  }
}
