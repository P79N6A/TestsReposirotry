@Test public void testAllocationWithoutAllowedGpus() throws Exception {
  Configuration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.NM_GPU_ALLOWED_DEVICES," ");
  GpuDiscoverer.getInstance().initialize(conf);
  try {
    gpuResourceHandler.bootstrap(conf);
    Assert.fail("Should fail because no GPU available");
  }
 catch (  ResourceHandlerException e) {
  }
  gpuResourceHandler.preStart(mockContainerWithGpuRequest(1,0));
  verifyDeniedDevices(getContainerId(1),Collections.emptyList());
  boolean failedToAllocate=false;
  try {
    gpuResourceHandler.preStart(mockContainerWithGpuRequest(2,1));
  }
 catch (  ResourceHandlerException e) {
    failedToAllocate=true;
  }
  Assert.assertTrue(failedToAllocate);
  gpuResourceHandler.postComplete(getContainerId(1));
  verify(mockCGroupsHandler,times(1)).createCGroup(CGroupsHandler.CGroupController.DEVICES,getContainerId(1).toString());
  Assert.assertEquals(0,gpuResourceHandler.getGpuAllocator().getAvailableGpus());
}
