@Test public void testDefault() throws Exception {
  FileSystem mockS3=getMockS3A();
  JobContext job=getJob();
  job.getConfiguration().unset(FS_S3A_COMMITTER_STAGING_CONFLICT_MODE);
  final PartitionedStagingCommitter committer=newTaskCommitter();
  committer.setupTask(getTAC());
  assertConflictResolution(committer,job,ConflictResolution.FAIL);
  createTestOutputFiles(relativeFiles,committer.getTaskAttemptPath(getTAC()),getTAC().getConfiguration());
  reset(mockS3);
  pathExists(mockS3,new Path(OUTPUT_PATH,relativeFiles.get(0)).getParent());
  intercept(PathExistsException.class,InternalCommitterConstants.E_DEST_EXISTS,"Expected a PathExistsException as a partition already exists",() -> committer.commitTask(getTAC()));
  reset(mockS3);
  committer.commitTask(getTAC());
  Set<String> files=Sets.newHashSet();
  for (  InitiateMultipartUploadRequest request : getMockResults().getRequests().values()) {
    assertEquals(BUCKET,request.getBucketName());
    files.add(request.getKey());
  }
  assertEquals("Should have the right number of uploads",relativeFiles.size(),files.size());
  Set<String> expected=buildExpectedList(committer);
  assertEquals("Should have correct paths",expected,files);
}
