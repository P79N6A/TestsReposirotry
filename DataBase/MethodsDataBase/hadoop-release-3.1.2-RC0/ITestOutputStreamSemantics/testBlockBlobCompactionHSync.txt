@Test public void testBlockBlobCompactionHSync() throws Exception {
  Path path=getBlobPathWithTestName(BLOCK_BLOB_COMPACTION_DIR);
  byte[] buffer=getRandomBytes();
  try (FSDataOutputStream stream=fs.create(path)){
    assertTrue(isBlockBlobAppendStreamWrapper(stream));
    for (int i=0; i < 10; i++) {
      stream.write(buffer);
      stream.hsync();
    }
  }
   String blobPath=path.toUri().getPath();
  CloudBlockBlob blob=testAccount.getBlobReference(blobPath.substring(1));
  ArrayList<BlockEntry> blockList=blob.downloadBlockList(BlockListingFilter.COMMITTED,null,null,null);
  assertEquals(10,blockList.size());
}
