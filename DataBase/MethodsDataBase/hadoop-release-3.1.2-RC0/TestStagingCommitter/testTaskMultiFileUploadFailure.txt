@Test public void testTaskMultiFileUploadFailure() throws Exception {
  committer.setupTask(tac);
  errors.failOnUpload(5);
  Path attemptPath=committer.getTaskAttemptPath(tac);
  FileSystem fs=attemptPath.getFileSystem(conf);
  writeOutputFile(tac.getTaskAttemptID(),attemptPath,UUID.randomUUID().toString(),10);
  writeOutputFile(tac.getTaskAttemptID(),attemptPath,UUID.randomUUID().toString(),10);
  intercept((Class<? extends Exception>)AWSClientIOException.class,"Fail on upload 5","Should fail during upload",() -> {
    committer.commitTask(tac);
    return committer.toString();
  }
);
  assertEquals("Should have attempted two file uploads",2,results.getUploads().size());
  assertEquals("Should abort the upload",new HashSet<>(results.getUploads()),getAbortedIds(results.getAborts()));
  assertPathDoesNotExist(fs,"Should remove the attempt path",attemptPath);
}
