@Test public void testRenameDirectoryCopyTaskAllSucceed() throws Exception {
  assumeTrue(renameSupported());
  Path srcOne=this.path("/test/hadoop/file/1");
  this.createFile(srcOne);
  Path dstOne=this.path("/test/new/file/1");
  Path dstTwo=this.path("/test/new/file/2");
  AliyunOSSCopyFileContext copyFileContext=new AliyunOSSCopyFileContext();
  AliyunOSSFileSystemStore store=((AliyunOSSFileSystem)this.fs).getStore();
  store.storeEmptyFile("test/new/file/");
  AliyunOSSCopyFileTask oneCopyFileTask=new AliyunOSSCopyFileTask(store,srcOne.toUri().getPath().substring(1),data.length,dstOne.toUri().getPath().substring(1),copyFileContext);
  oneCopyFileTask.run();
  assumeFalse(copyFileContext.isCopyFailure());
  AliyunOSSCopyFileTask twoCopyFileTask=new AliyunOSSCopyFileTask(store,srcOne.toUri().getPath().substring(1),data.length,dstTwo.toUri().getPath().substring(1),copyFileContext);
  twoCopyFileTask.run();
  assumeFalse(copyFileContext.isCopyFailure());
  copyFileContext.lock();
  try {
    copyFileContext.awaitAllFinish(2);
  }
 catch (  InterruptedException e) {
    throw new Exception(e);
  }
 finally {
    copyFileContext.unlock();
  }
  assumeFalse(copyFileContext.isCopyFailure());
}
