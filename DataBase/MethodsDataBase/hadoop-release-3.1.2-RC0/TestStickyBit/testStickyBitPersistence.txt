/** 
 * Ensure that when we set a sticky bit and shut down the file system, we get the sticky bit back on re-start, and that no extra sticky bits appear after re-start.
 */
@Test public void testStickyBitPersistence() throws Exception {
  Path sbSet=new Path("/Housemartins");
  Path sbNotSpecified=new Path("/INXS");
  Path sbSetOff=new Path("/Easyworld");
  for (  Path p : new Path[]{sbSet,sbNotSpecified,sbSetOff})   hdfs.mkdirs(p);
  hdfs.setPermission(sbSet,new FsPermission((short)01777));
  hdfs.setPermission(sbSetOff,new FsPermission((short)00777));
  shutdown();
  initCluster(false);
  assertTrue(hdfs.exists(sbSet));
  assertTrue(hdfs.getFileStatus(sbSet).getPermission().getStickyBit());
  assertTrue(hdfs.exists(sbNotSpecified));
  assertFalse(hdfs.getFileStatus(sbNotSpecified).getPermission().getStickyBit());
  assertTrue(hdfs.exists(sbSetOff));
  assertFalse(hdfs.getFileStatus(sbSetOff).getPermission().getStickyBit());
}
