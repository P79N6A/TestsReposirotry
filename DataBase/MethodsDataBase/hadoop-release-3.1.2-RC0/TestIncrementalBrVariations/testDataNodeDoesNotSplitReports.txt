/** 
 * Verify that the DataNode sends a single incremental block report for all storages.
 * @throws IOException
 * @throws InterruptedException
 */
@Test(timeout=60000) public void testDataNodeDoesNotSplitReports() throws IOException, InterruptedException {
  LocatedBlocks blocks=createFileGetBlocks(GenericTestUtils.getMethodName());
  assertThat(cluster.getDataNodes().size(),is(1));
  for (  LocatedBlock block : blocks.getLocatedBlocks()) {
    dn0.notifyNamenodeDeletedBlock(block.getBlock(),block.getStorageIDs()[0]);
  }
  LOG.info("Triggering report after deleting blocks");
  long ops=getLongCounter("BlockReceivedAndDeletedOps",getMetrics(NN_METRICS));
  DataNodeTestUtils.triggerBlockReport(dn0);
  Thread.sleep(5000);
  assertCounter("BlockReceivedAndDeletedOps",ops + 1,getMetrics(NN_METRICS));
}
