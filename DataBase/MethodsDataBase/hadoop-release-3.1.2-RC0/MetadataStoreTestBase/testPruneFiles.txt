@Test public void testPruneFiles() throws Exception {
  Assume.assumeTrue(supportsPruning());
  createNewDirs("/pruneFiles");
  long oldTime=getTime();
  ms.put(new PathMetadata(makeFileStatus("/pruneFiles/old",1,oldTime,oldTime)));
  DirListingMetadata ls2=ms.listChildren(strToPath("/pruneFiles"));
  if (!allowMissing()) {
    assertListingsEqual(ls2.getListing(),"/pruneFiles/old");
  }
  Thread.sleep(1);
  long cutoff=System.currentTimeMillis();
  long newTime=getTime();
  ms.put(new PathMetadata(makeFileStatus("/pruneFiles/new",1,newTime,newTime)));
  DirListingMetadata ls;
  ls=ms.listChildren(strToPath("/pruneFiles"));
  if (!allowMissing()) {
    assertListingsEqual(ls.getListing(),"/pruneFiles/new","/pruneFiles/old");
  }
  ms.prune(cutoff);
  ls=ms.listChildren(strToPath("/pruneFiles"));
  if (allowMissing()) {
    assertDeleted("/pruneFiles/old");
  }
 else {
    assertListingsEqual(ls.getListing(),"/pruneFiles/new");
  }
}
