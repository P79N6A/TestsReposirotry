/** 
 * Regression test for HDFS-9305. Delayed processing of a heartbeat can cause a subsequent heartbeat storm.
 */
@Test public void testScheduleDelayedHeartbeat(){
  for (  final long now : getTimestamps()) {
    Scheduler scheduler=makeMockScheduler(now);
    scheduler.scheduleNextHeartbeat();
    assertFalse(scheduler.isHeartbeatDue(now));
    scheduler.nextHeartbeatTime=now - (HEARTBEAT_INTERVAL_MS * 10);
    scheduler.scheduleNextHeartbeat();
    assertFalse(scheduler.isHeartbeatDue(now));
  }
}
