@Test public void testPutBlockOperations() throws Exception {
  CloudBlobContainer container=getTestAccount().getRealContainer();
  OperationContext context=new OperationContext();
  context.getResponseReceivedEventHandler().addListener(new ResponseReceivedEventHandler());
  context.getSendingRequestEventHandler().addListener(new SendingRequestEventHandler());
  CloudBlockBlob blockBlob=container.getBlockBlobReference("testPutBlockOperations");
  assertNull(lastOperationTypeSent);
  assertNull(lastOperationTypeReceived);
  assertEquals(0,lastContentLengthReceived);
  try (BlobOutputStream output=blockBlob.openOutputStream(null,null,context)){
    assertNull(lastOperationTypeReceived);
    assertEquals(0,lastContentLengthReceived);
    String message="this is a test";
    output.write(message.getBytes("UTF-8"));
    output.flush();
    assertEquals(BlobOperationDescriptor.OperationType.PutBlock,lastOperationTypeSent);
    assertEquals(BlobOperationDescriptor.OperationType.PutBlock,lastOperationTypeReceived);
    assertEquals(message.length(),lastContentLengthReceived);
  }
   assertEquals(BlobOperationDescriptor.OperationType.PutBlockList,lastOperationTypeSent);
  assertEquals(BlobOperationDescriptor.OperationType.PutBlockList,lastOperationTypeReceived);
  assertEquals(0,lastContentLengthReceived);
}
