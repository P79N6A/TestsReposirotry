/** 
 * If NN restarted then lazyPersist files should not deleted
 */
@Test(timeout=20000) public void testFileShouldNotDiscardedIfNNRestarted() throws IOException, InterruptedException, TimeoutException {
  getClusterBuilder().setRamDiskReplicaCapacity(2).build();
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  Path path1=new Path("/" + METHOD_NAME + ".01.dat");
  makeTestFile(path1,BLOCK_SIZE,true);
  ensureFileReplicasOnStorageType(path1,RAM_DISK);
  cluster.shutdownDataNodes();
  cluster.restartNameNodes();
  Long corruptBlkCount;
  do {
    Thread.sleep(DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT * 1000);
    corruptBlkCount=(long)Iterators.size(cluster.getNameNode().getNamesystem().getBlockManager().getCorruptReplicaBlockIterator());
  }
 while (corruptBlkCount != 1L);
  Assert.assertTrue(fs.exists(path1));
}
