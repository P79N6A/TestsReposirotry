@Test(timeout=120000L) public void testListOpenFilesViaNameNodeRPC() throws Exception {
  HashMap<Path,FSDataOutputStream> openFiles=new HashMap<>();
  createFiles(fs,"closed",10);
  verifyOpenFiles(openFiles);
  BatchedEntries<OpenFileEntry> openFileEntryBatchedEntries=nnRpc.listOpenFiles(0,EnumSet.of(OpenFilesType.ALL_OPEN_FILES),OpenFilesIterator.FILTER_PATH_DEFAULT);
  assertTrue("Open files list should be empty!",openFileEntryBatchedEntries.size() == 0);
  BatchedEntries<OpenFileEntry> openFilesBlockingDecomEntries=nnRpc.listOpenFiles(0,EnumSet.of(OpenFilesType.BLOCKING_DECOMMISSION),OpenFilesIterator.FILTER_PATH_DEFAULT);
  assertTrue("Open files list blocking decommission should be empty!",openFilesBlockingDecomEntries.size() == 0);
  openFiles.putAll(DFSTestUtil.createOpenFiles(fs,"open-1",1));
  verifyOpenFiles(openFiles);
  openFiles.putAll(DFSTestUtil.createOpenFiles(fs,"open-2",(BATCH_SIZE * 2 + BATCH_SIZE / 2)));
  verifyOpenFiles(openFiles);
  DFSTestUtil.closeOpenFiles(openFiles,openFiles.size() / 2);
  verifyOpenFiles(openFiles);
  openFiles.putAll(DFSTestUtil.createOpenFiles(fs,"open-3",(BATCH_SIZE * 5)));
  verifyOpenFiles(openFiles);
  while (openFiles.size() > 0) {
    DFSTestUtil.closeOpenFiles(openFiles,1);
    verifyOpenFiles(openFiles);
  }
}
