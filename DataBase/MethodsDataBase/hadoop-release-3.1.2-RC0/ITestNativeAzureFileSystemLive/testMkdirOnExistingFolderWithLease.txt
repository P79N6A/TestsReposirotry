/** 
 * Tests fs.mkdir() function to create a target blob while another thread is holding the lease on the blob. mkdir should not fail since the blob already exists. This is a scenario that would happen in HBase distributed log splitting. Multiple threads will try to create and update "recovered.edits" folder under the same path.
 */
@Test public void testMkdirOnExistingFolderWithLease() throws Exception {
  SelfRenewingLease lease;
  Path path=methodPath();
  fs.mkdirs(path);
  NativeAzureFileSystem nfs=fs;
  String fullKey=nfs.pathToKey(nfs.makeAbsolute(path));
  AzureNativeFileSystemStore store=nfs.getStore();
  lease=store.acquireLease(fullKey);
  assertNotNull("lease ID",lease.getLeaseID() != null);
  store.storeEmptyFolder(fullKey,nfs.createPermissionStatus(FsPermission.getDirDefault()));
  lease.free();
}
