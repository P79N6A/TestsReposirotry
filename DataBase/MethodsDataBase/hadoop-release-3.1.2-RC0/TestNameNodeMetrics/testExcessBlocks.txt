/** 
 * Create excess blocks by reducing the replication factor for for a file and ensure metrics reflects it
 */
@Test public void testExcessBlocks() throws Exception {
  Path file=getTestPath("testExcessBlocks");
  createFile(file,100,(short)2);
  NameNodeAdapter.setReplication(namesystem,file.toString(),(short)1);
  MetricsRecordBuilder rb=getMetrics(NS_METRICS);
  assertGauge("ExcessBlocks",1L,rb);
  fs.delete(file,true);
  rb=getMetrics(NS_METRICS);
  assertGauge("ExcessBlocks",0L,rb);
  assertEquals(0L,bm.getExcessBlocksCount());
}
