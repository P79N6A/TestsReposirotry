@Test public void testSkewedRack3() throws Exception {
  final int dataUnits=ecPolicy.getNumDataUnits();
  final int parityUnits=ecPolicy.getNumParityUnits();
  int numRacks=dataUnits - parityUnits + 2;
  setupCluster(dataUnits + parityUnits * 4,numRacks,dataUnits - parityUnits);
  final int filesize=ecPolicy.getNumDataUnits() * ecPolicy.getCellSize();
  byte[] contents=new byte[filesize];
  for (int i=0; i < 10; ++i) {
    final Path path=new Path("/testfile" + i);
    LOG.info("Writing file " + path);
    DFSTestUtil.writeFile(dfs,path,contents);
    ExtendedBlock extendedBlock=DFSTestUtil.getFirstBlock(dfs,path);
    DFSTestUtil.waitForReplication(cluster,extendedBlock,numRacks,ecPolicy.getNumDataUnits() + ecPolicy.getNumParityUnits(),0);
    BlockLocation[] blocks=dfs.getFileBlockLocations(path,0,Long.MAX_VALUE);
    assertEquals(ecPolicy.getNumDataUnits() + ecPolicy.getNumParityUnits(),blocks[0].getHosts().length);
    assertRackFailureTolerated(blocks[0].getTopologyPaths());
  }
}
