/** 
 * {@link DFSStripedOutputStream} doesn't support hflush() or hsync() yet.This test is to make sure that DFSStripedOutputStream doesn't throw any {@link UnsupportedOperationException} on hflush() or hsync() so as tocomply with output stream spec.
 * @throws Exception
 */
@Test public void testStreamFlush() throws Exception {
  final byte[] bytes=StripedFileTestUtil.generateBytes(blockSize * dataBlocks * 3 + cellSize * dataBlocks + cellSize + 123);
  try (FSDataOutputStream os=fs.create(new Path("/ec-file-1"))){
    assertFalse("DFSStripedOutputStream should not have hflush() capability yet!",os.hasCapability(StreamCapability.HFLUSH.getValue()));
    assertFalse("DFSStripedOutputStream should not have hsync() capability yet!",os.hasCapability(StreamCapability.HSYNC.getValue()));
    try (InputStream is=new ByteArrayInputStream(bytes)){
      IOUtils.copyBytes(is,os,bytes.length);
      os.hflush();
      IOUtils.copyBytes(is,os,bytes.length);
      os.hsync();
      IOUtils.copyBytes(is,os,bytes.length);
    }
     assertTrue("stream is not a DFSStripedOutputStream",os.getWrappedStream() instanceof DFSStripedOutputStream);
    final DFSStripedOutputStream dfssos=(DFSStripedOutputStream)os.getWrappedStream();
    dfssos.hsync(EnumSet.of(SyncFlag.UPDATE_LENGTH));
  }
 }
