@Test public void checkFilterNotAllowedUser() throws ServletException, IOException {
  Map<String,String> map=new HashMap<String,String>();
  map.put(YarnConfiguration.TIMELINE_SERVICE_READ_AUTH_ENABLED,"true");
  map.put(YarnConfiguration.TIMELINE_SERVICE_READ_ALLOWED_USERS,"user1,user2");
  TimelineReaderWhitelistAuthorizationFilter f=new TimelineReaderWhitelistAuthorizationFilter();
  FilterConfig fc=new DummyFilterConfig(map);
  f.init(fc);
  HttpServletRequest mockHsr=Mockito.mock(HttpServletRequest.class);
  String userName="testuser1";
  Mockito.when(mockHsr.getUserPrincipal()).thenReturn(new Principal(){
    @Override public String getName(){
      return userName;
    }
  }
);
  HttpServletResponse r=Mockito.mock(HttpServletResponse.class);
  f.doFilter(mockHsr,r,null);
  String msg="User " + userName + " is not allowed to read TimelineService V2 data.";
  Mockito.verify(r).sendError(eq(HttpServletResponse.SC_FORBIDDEN),eq(msg));
}
