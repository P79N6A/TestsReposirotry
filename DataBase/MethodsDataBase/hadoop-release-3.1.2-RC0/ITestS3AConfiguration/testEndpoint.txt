/** 
 * Test if custom endpoint is picked up. <p> The test expects  {@link S3ATestConstants#CONFIGURATION_TEST_ENDPOINT}to be defined in the Configuration describing the endpoint of the bucket to which TEST_FS_S3A_NAME points (i.e. "s3-eu-west-1.amazonaws.com" if the bucket is located in Ireland). Evidently, the bucket has to be hosted in the region denoted by the endpoint for the test to succeed. <p> More info and the list of endpoint identifiers:
 * @see <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">endpoint list</a>.
 * @throws Exception
 */
@Test public void testEndpoint() throws Exception {
  conf=new Configuration();
  String endpoint=conf.getTrimmed(S3ATestConstants.CONFIGURATION_TEST_ENDPOINT,"");
  if (endpoint.isEmpty()) {
    LOG.warn("Custom endpoint test skipped as " + S3ATestConstants.CONFIGURATION_TEST_ENDPOINT + "config "+ "setting was not detected");
  }
 else {
    conf.set(Constants.ENDPOINT,endpoint);
    fs=S3ATestUtils.createTestFileSystem(conf);
    AmazonS3 s3=fs.getAmazonS3ClientForTesting("test endpoint");
    String endPointRegion="";
    String[] endpointParts=StringUtils.split(endpoint,'.');
    if (endpointParts.length == 3) {
      endPointRegion=endpointParts[0].substring(3);
    }
 else     if (endpointParts.length == 4) {
      endPointRegion=endpointParts[1];
    }
 else {
      fail("Unexpected endpoint");
    }
    assertEquals("Endpoint config setting and bucket location differ: ",endPointRegion,s3.getBucketLocation(fs.getUri().getHost()));
  }
}
