/** 
 * Transition from IN_MAINTENANCE to DECOMMISSIONED.
 */
@Test(timeout=360000) public void testTransitionToDecommission() throws IOException {
  LOG.info("Starting testTransitionToDecommission");
  final int numNamenodes=1;
  final int numDatanodes=4;
  startCluster(numNamenodes,numDatanodes);
  final Path file=new Path("testTransitionToDecommission.dat");
  final int replicas=3;
  FileSystem fileSys=getCluster().getFileSystem(0);
  FSNamesystem ns=getCluster().getNamesystem(0);
  writeFile(fileSys,file,replicas,25);
  DatanodeInfo nodeOutofService=takeNodeOutofService(0,getFirstBlockFirstReplicaUuid(fileSys,file),Long.MAX_VALUE,null,AdminStates.IN_MAINTENANCE);
  DFSClient client=getDfsClient(0);
  assertEquals("All datanodes must be alive",numDatanodes,client.datanodeReport(DatanodeReportType.LIVE).length);
  checkWithRetry(ns,fileSys,file,replicas - 1,nodeOutofService);
  takeNodeOutofService(0,nodeOutofService.getDatanodeUuid(),0,null,AdminStates.DECOMMISSIONED);
  checkWithRetry(ns,fileSys,file,replicas + 1,null);
  putNodeInService(0,nodeOutofService.getDatanodeUuid());
  checkWithRetry(ns,fileSys,file,replicas,null);
  cleanupFile(fileSys,file);
}
