/** 
 * When a dead node is put to maintenance, it transitions directly to AdminStates.IN_MAINTENANCE.
 */
@Test(timeout=360000) public void testPutDeadNodeToMaintenance() throws Exception {
  LOG.info("Starting testPutDeadNodeToMaintenance");
  final int replicas=1;
  final Path file=new Path("/testPutDeadNodeToMaintenance.dat");
  startCluster(1,1);
  final FileSystem fileSys=getCluster().getFileSystem(0);
  final FSNamesystem ns=getCluster().getNamesystem(0);
  writeFile(fileSys,file,replicas,1);
  final MiniDFSCluster.DataNodeProperties dnProp=getCluster().stopDataNode(0);
  DFSTestUtil.waitForDatanodeState(getCluster(),dnProp.datanode.getDatanodeUuid(),false,20000);
  int deadInMaintenance=ns.getNumInMaintenanceDeadDataNodes();
  int liveInMaintenance=ns.getNumInMaintenanceLiveDataNodes();
  takeNodeOutofService(0,dnProp.datanode.getDatanodeUuid(),Long.MAX_VALUE,null,AdminStates.IN_MAINTENANCE);
  assertEquals(deadInMaintenance + 1,ns.getNumInMaintenanceDeadDataNodes());
  assertEquals(liveInMaintenance,ns.getNumInMaintenanceLiveDataNodes());
  cleanupFile(fileSys,file);
}
