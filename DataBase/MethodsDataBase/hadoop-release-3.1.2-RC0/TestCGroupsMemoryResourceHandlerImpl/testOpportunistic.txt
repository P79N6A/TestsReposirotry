@Test public void testOpportunistic() throws Exception {
  Configuration conf=new YarnConfiguration();
  conf.setBoolean(YarnConfiguration.NM_PMEM_CHECK_ENABLED,false);
  conf.setBoolean(YarnConfiguration.NM_VMEM_CHECK_ENABLED,false);
  cGroupsMemoryResourceHandler.bootstrap(conf);
  ContainerTokenIdentifier tokenId=mock(ContainerTokenIdentifier.class);
  when(tokenId.getExecutionType()).thenReturn(ExecutionType.OPPORTUNISTIC);
  Container container=mock(Container.class);
  String id="container_01_01";
  ContainerId mockContainerId=mock(ContainerId.class);
  when(mockContainerId.toString()).thenReturn(id);
  when(container.getContainerId()).thenReturn(mockContainerId);
  when(container.getContainerTokenIdentifier()).thenReturn(tokenId);
  when(container.getResource()).thenReturn(Resource.newInstance(1024,2));
  cGroupsMemoryResourceHandler.preStart(container);
  verify(mockCGroupsHandler,times(1)).updateCGroupParam(CGroupsHandler.CGroupController.MEMORY,id,CGroupsHandler.CGROUP_PARAM_MEMORY_SOFT_LIMIT_BYTES,"0M");
  verify(mockCGroupsHandler,times(1)).updateCGroupParam(CGroupsHandler.CGroupController.MEMORY,id,CGroupsHandler.CGROUP_PARAM_MEMORY_SWAPPINESS,"100");
  verify(mockCGroupsHandler,times(1)).updateCGroupParam(CGroupsHandler.CGroupController.MEMORY,id,CGroupsHandler.CGROUP_PARAM_MEMORY_HARD_LIMIT_BYTES,"1024M");
}
