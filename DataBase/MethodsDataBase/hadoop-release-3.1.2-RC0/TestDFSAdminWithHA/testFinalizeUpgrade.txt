@Test(timeout=30000) public void testFinalizeUpgrade() throws Exception {
  setUpHaCluster(false);
  int exitCode=admin.run(new String[]{"-finalizeUpgrade"});
  assertNotEquals(err.toString().trim(),0,exitCode);
  String message=".*Cannot finalize with no NameNode active";
  assertOutputMatches(message + newLine);
  cluster.getDfsCluster().transitionToActive(0);
  exitCode=admin.run(new String[]{"-finalizeUpgrade"});
  assertEquals(err.toString().trim(),0,exitCode);
  message="Finalize upgrade successful for.*";
  assertOutputMatches(message + newLine + message+ newLine);
}
