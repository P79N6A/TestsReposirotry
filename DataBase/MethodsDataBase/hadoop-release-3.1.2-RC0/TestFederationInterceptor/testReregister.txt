@Test public void testReregister() throws Exception {
  RegisterApplicationMasterRequest registerReq=Records.newRecord(RegisterApplicationMasterRequest.class);
  registerReq.setHost(Integer.toString(testAppId));
  registerReq.setRpcPort(0);
  registerReq.setTrackingUrl("");
  RegisterApplicationMasterResponse registerResponse=interceptor.registerApplicationMaster(registerReq);
  Assert.assertNotNull(registerResponse);
  Assert.assertEquals(0,interceptor.getUnmanagedAMPoolSize());
  registerSubCluster(SubClusterId.newInstance("SC-1"));
  registerSubCluster(SubClusterId.newInstance(HOME_SC_ID));
  interceptor.setShouldReRegisterNext();
  int numberOfContainers=3;
  List<Container> containers=getContainersAndAssert(numberOfContainers,numberOfContainers * 2);
  Assert.assertEquals(1,interceptor.getUnmanagedAMPoolSize());
  interceptor.setShouldReRegisterNext();
  releaseContainersAndAssert(containers);
  interceptor.setShouldReRegisterNext();
  FinishApplicationMasterRequest finishReq=Records.newRecord(FinishApplicationMasterRequest.class);
  finishReq.setDiagnostics("");
  finishReq.setTrackingUrl("");
  finishReq.setFinalApplicationStatus(FinalApplicationStatus.SUCCEEDED);
  FinishApplicationMasterResponse finshResponse=interceptor.finishApplicationMaster(finishReq);
  Assert.assertNotNull(finshResponse);
  Assert.assertEquals(true,finshResponse.getIsUnregistered());
}
