/** 
 * Between AM and AMRMProxy, FederationInterceptor modifies the RM behavior, so that when AM registers more than once, it returns the same register success response instead of throwing {@link InvalidApplicationMasterRequestException}We did this because FederationInterceptor can receive concurrent register requests from AM because of timeout between AM and AMRMProxy. This can possible since the timeout between FederationInterceptor and RM longer because of performFailover + timeout.
 */
@Test public void testTwoIdenticalRegisterRequest() throws Exception {
  RegisterApplicationMasterRequest registerReq=Records.newRecord(RegisterApplicationMasterRequest.class);
  registerReq.setHost(Integer.toString(testAppId));
  registerReq.setRpcPort(0);
  registerReq.setTrackingUrl("");
  for (int i=0; i < 2; i++) {
    RegisterApplicationMasterResponse registerResponse=interceptor.registerApplicationMaster(registerReq);
    Assert.assertNotNull(registerResponse);
  }
}
