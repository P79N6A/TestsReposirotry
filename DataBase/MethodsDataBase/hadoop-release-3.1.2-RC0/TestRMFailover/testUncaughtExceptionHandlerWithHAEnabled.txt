/** 
 * Throw  {@link RuntimeException} inside a thread of{@link ResourceManager} with HA enabled and check if the{@link ResourceManager} is transited to standby state.
 * @throws InterruptedException if any
 */
@Test public void testUncaughtExceptionHandlerWithHAEnabled() throws InterruptedException {
  conf.set(YarnConfiguration.RM_CLUSTER_ID,"yarn-test-cluster");
  conf.set(YarnConfiguration.RM_ZK_ADDRESS,hostPort);
  cluster.init(conf);
  cluster.start();
  assertFalse("RM never turned active",-1 == cluster.getActiveRMIndex());
  ResourceManager resourceManager=cluster.getResourceManager(cluster.getActiveRMIndex());
  final RMCriticalThreadUncaughtExceptionHandler exHandler=new RMCriticalThreadUncaughtExceptionHandler(resourceManager.getRMContext());
  final RuntimeException rte=new RuntimeException("TestRuntimeException");
  final Thread testThread=new Thread(new Runnable(){
    @Override public void run(){
      throw rte;
    }
  }
);
  testThread.setName("TestThread");
  testThread.setUncaughtExceptionHandler(exHandler);
  testThread.start();
  testThread.join();
  verifyRMTransitionToStandby(resourceManager);
}
