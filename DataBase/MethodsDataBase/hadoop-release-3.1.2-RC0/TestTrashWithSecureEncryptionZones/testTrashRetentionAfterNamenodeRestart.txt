@Test public void testTrashRetentionAfterNamenodeRestart() throws Exception {
  final Path zone1=new Path("/zone" + zoneCounter.getAndIncrement());
  fs.mkdirs(zone1);
  dfsAdmin.createEncryptionZone(zone1,TEST_KEY,PROVISION_TRASH);
  final Path encFile1=new Path(zone1,"encFile" + fileCounter.getAndIncrement());
  DFSTestUtil.createFile(fs,encFile1,LEN,(short)1,0xFEED);
  final Path trashFile=new Path(shell.getCurrentTrashDir(encFile1) + "/" + encFile1);
  String[] argv=new String[]{"-rm","-r",encFile1.toString()};
  int res=ToolRunner.run(shell,argv);
  assertEquals("rm failed",0,res);
  assertTrue("File not in trash : " + trashFile,fs.exists(trashFile));
  cluster.restartNameNode(0);
  cluster.waitActive();
  fs=cluster.getFileSystem();
  assertTrue("On Namenode restart, file deleted from trash : " + trashFile,fs.exists(trashFile));
}
