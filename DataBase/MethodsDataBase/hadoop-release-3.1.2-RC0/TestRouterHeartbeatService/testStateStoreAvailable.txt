@Test public void testStateStoreAvailable() throws Exception {
  StateStoreService stateStore=router.getStateStore();
  assertTrue(router.getStateStore().isDriverReady());
  RouterStore routerStore=router.getRouterStateManager();
  stateStore.refreshCaches(true);
  GetRouterRegistrationRequest request=GetRouterRegistrationRequest.newInstance(routerId);
  GetRouterRegistrationResponse response=router.getRouterStateManager().getRouterRegistration(request);
  RouterState routerState=response.getRouter();
  String id=routerState.getRouterId();
  StateStoreVersion version=routerState.getStateStoreVersion();
  assertNull(id);
  assertNull(version);
  RouterHeartbeatService heartbeatService=new RouterHeartbeatService(router);
  heartbeatService.updateStateStore();
  stateStore.refreshCaches(true);
  request=GetRouterRegistrationRequest.newInstance(routerId);
  response=routerStore.getRouterRegistration(request);
  routerState=response.getRouter();
  id=routerState.getRouterId();
  version=routerState.getStateStoreVersion();
  assertNotNull(id);
  assertNotNull(version);
}
