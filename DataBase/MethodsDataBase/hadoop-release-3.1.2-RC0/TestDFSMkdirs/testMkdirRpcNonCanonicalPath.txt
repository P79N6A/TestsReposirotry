/** 
 * Regression test for HDFS-3626. Creates a file using a non-canonical path (i.e. with extra slashes between components) and makes sure that the NN rejects it.
 */
@Test public void testMkdirRpcNonCanonicalPath() throws IOException {
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
  try {
    NamenodeProtocols nnrpc=cluster.getNameNodeRpc();
    for (    String pathStr : NON_CANONICAL_PATHS) {
      try {
        nnrpc.mkdirs(pathStr,new FsPermission((short)0755),true);
        fail("Did not fail when called with a non-canonicalized path: " + pathStr);
      }
 catch (      InvalidPathException ipe) {
      }
    }
  }
  finally {
    cluster.shutdown();
  }
}
