@Test public void testDeleteCachedWhileReadingFromUpstreamWithReadOnlyCacheDataSourceDoesNotCrash() throws Exception {
  FakeDataSource upstream=new FakeDataSource();
  upstream.getDataSet().newDefaultData().appendReadData(1024).endData();
  DataSpec dataSpec=new DataSpec(testDataUri,512,C.LENGTH_UNSET,fixedCacheKey);
  CacheUtil.cache(dataSpec,cache,upstream,null,null);
  CacheDataSource cacheDataSource=new CacheDataSource(cache,upstream,new FileDataSource(),null,0,null);
  dataSpec=new DataSpec(testDataUri,0,C.LENGTH_UNSET,fixedCacheKey);
  cacheDataSource.open(dataSpec);
  TestUtil.readExactly(cacheDataSource,100);
  CacheUtil.remove(cache,expectedCacheKey);
  assertCacheEmpty(cache);
  TestUtil.readToEnd(cacheDataSource);
  cacheDataSource.close();
}
