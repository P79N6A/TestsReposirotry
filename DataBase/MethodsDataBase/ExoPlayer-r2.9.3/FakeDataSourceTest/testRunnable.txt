@Test public void testRunnable() throws IOException {
  TestRunnable[] runnables=new TestRunnable[3];
  for (int i=0; i < 3; i++) {
    runnables[i]=new TestRunnable();
  }
  FakeDataSource dataSource=new FakeDataSource(new FakeDataSet().newData(uri.toString()).appendReadData(TEST_DATA).appendReadAction(runnables[0]).appendReadData(TEST_DATA).appendReadAction(runnables[1]).appendReadAction(runnables[2]).appendReadData(TEST_DATA).endData());
  assertThat(dataSource.open(new DataSpec(uri))).isEqualTo(45);
  assertThat(dataSource.read(BUFFER,0,BUFFER.length)).isEqualTo(15);
  assertBuffer(TEST_DATA);
  for (int i=0; i < 3; i++) {
    assertThat(runnables[i].ran).isFalse();
  }
  assertThat(dataSource.read(BUFFER,0,BUFFER.length)).isEqualTo(15);
  assertBuffer(TEST_DATA);
  assertThat(runnables[0].ran).isTrue();
  assertThat(runnables[1].ran).isFalse();
  assertThat(runnables[2].ran).isFalse();
  assertThat(dataSource.read(BUFFER,0,BUFFER.length)).isEqualTo(15);
  assertBuffer(TEST_DATA);
  for (int i=0; i < 3; i++) {
    assertThat(runnables[i].ran).isTrue();
  }
  assertThat(dataSource.read(BUFFER,0,BUFFER.length)).isEqualTo(C.RESULT_END_OF_INPUT);
  dataSource.close();
}
