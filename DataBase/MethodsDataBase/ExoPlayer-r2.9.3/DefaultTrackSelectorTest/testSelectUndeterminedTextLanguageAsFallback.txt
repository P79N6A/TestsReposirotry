/** 
 * Tests that the default track selector will select a text track with undetermined language if no text track with the preferred language is available but {@link Parameters#selectUndeterminedTextLanguage} is true.
 */
@Test public void testSelectUndeterminedTextLanguageAsFallback() throws ExoPlaybackException {
  Format spanish=buildTextFormat("spanish","spa");
  Format german=buildTextFormat("german","de");
  Format undeterminedUnd=buildTextFormat("undeterminedUnd","und");
  Format undeterminedNull=buildTextFormat("undeterminedNull",null);
  RendererCapabilities[] textRendererCapabilites=new RendererCapabilities[]{ALL_TEXT_FORMAT_SUPPORTED_RENDERER_CAPABILITIES};
  TrackSelectorResult result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(spanish,german,undeterminedUnd,undeterminedNull));
  assertThat(result.selections.get(0)).isNull();
  trackSelector.setParameters(new ParametersBuilder().setSelectUndeterminedTextLanguage(true).build());
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(spanish,german,undeterminedUnd,undeterminedNull));
  assertThat(result.selections.get(0).getFormat(0)).isSameAs(undeterminedUnd);
  ParametersBuilder builder=new ParametersBuilder().setPreferredTextLanguage("spa");
  trackSelector.setParameters(builder.build());
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(spanish,german,undeterminedUnd,undeterminedNull));
  assertThat(result.selections.get(0).getFormat(0)).isSameAs(spanish);
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(german,undeterminedUnd,undeterminedNull));
  assertThat(result.selections.get(0)).isNull();
  trackSelector.setParameters(builder.setSelectUndeterminedTextLanguage(true).build());
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(german,undeterminedUnd,undeterminedNull));
  assertThat(result.selections.get(0).getFormat(0)).isSameAs(undeterminedUnd);
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(german,undeterminedNull));
  assertThat(result.selections.get(0).getFormat(0)).isSameAs(undeterminedNull);
  result=trackSelector.selectTracks(textRendererCapabilites,wrapFormats(german));
  assertThat(result.selections.get(0)).isNull();
}
