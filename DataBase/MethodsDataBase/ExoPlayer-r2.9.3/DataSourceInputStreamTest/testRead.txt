@Test public void testRead() throws IOException {
  DataSourceInputStream inputStream=buildTestInputStream();
  byte[] readBytes=new byte[TEST_DATA.length];
  int totalBytesRead=0;
  while (totalBytesRead < TEST_DATA.length) {
    int bytesRead=inputStream.read(readBytes,totalBytesRead,TEST_DATA.length - totalBytesRead);
    assertThat(bytesRead).isGreaterThan(0);
    totalBytesRead+=bytesRead;
    assertThat(inputStream.bytesRead()).isEqualTo(totalBytesRead);
  }
  assertThat(readBytes).isEqualTo(TEST_DATA);
  assertThat(inputStream.bytesRead()).isEqualTo(TEST_DATA.length);
  assertThat(totalBytesRead).isEqualTo(TEST_DATA.length);
  assertThat(inputStream.read()).isEqualTo(-1);
  inputStream.close();
}
