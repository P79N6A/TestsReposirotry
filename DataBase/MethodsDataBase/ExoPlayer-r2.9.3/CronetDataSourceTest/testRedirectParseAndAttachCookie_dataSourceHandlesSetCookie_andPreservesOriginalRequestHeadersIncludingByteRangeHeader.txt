@Test public void testRedirectParseAndAttachCookie_dataSourceHandlesSetCookie_andPreservesOriginalRequestHeadersIncludingByteRangeHeader() throws HttpDataSourceException {
  testDataSpec=new DataSpec(Uri.parse(TEST_URL),1000,5000,null);
  dataSourceUnderTest=new CronetDataSource(mockCronetEngine,mockExecutor,mockContentTypePredicate,TEST_CONNECT_TIMEOUT_MS,TEST_READ_TIMEOUT_MS,true,Clock.DEFAULT,null,true);
  dataSourceUnderTest.addTransferListener(mockTransferListener);
  dataSourceUnderTest.setRequestProperty("Content-Type",TEST_CONTENT_TYPE);
  mockSingleRedirectSuccess();
  testResponseHeader.put("Set-Cookie","testcookie=testcookie; Path=/video");
  dataSourceUnderTest.open(testDataSpec);
  verify(mockUrlRequestBuilder).addHeader(eq("Cookie"),any(String.class));
  verify(mockUrlRequestBuilder,times(2)).addHeader("Range","bytes=1000-5999");
  verify(mockUrlRequestBuilder,times(2)).addHeader("Content-Type",TEST_CONTENT_TYPE);
  verify(mockUrlRequest,never()).followRedirect();
  verify(mockUrlRequest,times(2)).start();
}
