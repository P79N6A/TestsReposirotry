@Test public void testAutomaticPeriodTransition() throws Exception {
  MediaSource mediaSource=new ConcatenatingMediaSource(new FakeMediaSource(SINGLE_PERIOD_TIMELINE,null,Builder.VIDEO_FORMAT,Builder.AUDIO_FORMAT),new FakeMediaSource(SINGLE_PERIOD_TIMELINE,null,Builder.VIDEO_FORMAT,Builder.AUDIO_FORMAT));
  TestAnalyticsListener listener=runAnalyticsTest(mediaSource);
  populateEventIds(listener.lastReportedTimeline);
  assertThat(listener.getEvents(EVENT_PLAYER_STATE_CHANGED)).containsExactly(WINDOW_0,WINDOW_0,period0,period1);
  assertThat(listener.getEvents(EVENT_TIMELINE_CHANGED)).containsExactly(WINDOW_0);
  assertThat(listener.getEvents(EVENT_POSITION_DISCONTINUITY)).containsExactly(period1);
  assertThat(listener.getEvents(EVENT_LOADING_CHANGED)).containsExactly(period0,period0,period0,period0);
  assertThat(listener.getEvents(EVENT_TRACKS_CHANGED)).containsExactly(period0,period1);
  assertThat(listener.getEvents(EVENT_LOAD_STARTED)).containsExactly(WINDOW_0,period0,WINDOW_1,period1);
  assertThat(listener.getEvents(EVENT_LOAD_COMPLETED)).containsExactly(WINDOW_0,period0,WINDOW_1,period1);
  assertThat(listener.getEvents(EVENT_DOWNSTREAM_FORMAT_CHANGED)).containsExactly(period0,period0,period1,period1);
  assertThat(listener.getEvents(EVENT_MEDIA_PERIOD_CREATED)).containsExactly(period0,period1);
  assertThat(listener.getEvents(EVENT_MEDIA_PERIOD_RELEASED)).containsExactly(period0);
  assertThat(listener.getEvents(EVENT_READING_STARTED)).containsExactly(period0,period1);
  assertThat(listener.getEvents(EVENT_DECODER_ENABLED)).containsExactly(period0,period0);
  assertThat(listener.getEvents(EVENT_DECODER_INIT)).containsExactly(period0,period0,period1,period1);
  assertThat(listener.getEvents(EVENT_DECODER_FORMAT_CHANGED)).containsExactly(period0,period0,period1,period1);
  assertThat(listener.getEvents(EVENT_AUDIO_SESSION_ID)).containsExactly(period0);
  assertThat(listener.getEvents(EVENT_DROPPED_VIDEO_FRAMES)).containsExactly(period1);
  assertThat(listener.getEvents(EVENT_VIDEO_SIZE_CHANGED)).containsExactly(period0);
  assertThat(listener.getEvents(EVENT_RENDERED_FIRST_FRAME)).containsExactly(period0);
  listener.assertNoMoreEvents();
}
