@Test public void seekToUnpreparedWindowWithNonZeroOffsetInConcatenationStartsAtCorrectPosition() throws Exception {
  Timeline timeline=new FakeTimeline(1);
  FakeMediaSource mediaSource=new FakeMediaSource(null,null);
  MediaSource clippedMediaSource=new ClippingMediaSource(mediaSource,3 * C.MICROS_PER_SECOND,C.TIME_END_OF_SOURCE);
  MediaSource concatenatedMediaSource=new ConcatenatingMediaSource(clippedMediaSource);
  AtomicLong positionWhenReady=new AtomicLong();
  ActionSchedule actionSchedule=new ActionSchedule.Builder("seekToUnpreparedWindowWithNonZeroOffsetInConcatenation").pause().waitForPlaybackState(Player.STATE_BUFFERING).seek(10).waitForTimelineChanged().executeRunnable(() -> mediaSource.setNewSourceInfo(timeline,null)).waitForTimelineChanged().waitForPlaybackState(Player.STATE_READY).executeRunnable(new PlayerRunnable(){
    @Override public void run(    SimpleExoPlayer player){
      positionWhenReady.set(player.getContentPosition());
    }
  }
).play().build();
  new Builder().setMediaSource(concatenatedMediaSource).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  assertThat(positionWhenReady.get()).isEqualTo(10);
}
