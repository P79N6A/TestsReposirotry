@Test public void testPlaybackErrorDuringSourceInfoRefreshStillUpdatesTimeline() throws Exception {
  final Timeline timeline=new FakeTimeline(1);
  final FakeMediaSource mediaSource=new FakeMediaSource(null,null);
  ActionSchedule actionSchedule=new ActionSchedule.Builder("testPlaybackErrorDuringSourceInfoRefreshStillUpdatesTimeline").waitForPlaybackState(Player.STATE_BUFFERING).seek(100,0).executeRunnable(() -> mediaSource.setNewSourceInfo(timeline,null)).waitForPlaybackState(Player.STATE_IDLE).build();
  ExoPlayerTestRunner testRunner=new ExoPlayerTestRunner.Builder().setMediaSource(mediaSource).setActionSchedule(actionSchedule).build(context);
  try {
    testRunner.start().blockUntilActionScheduleFinished(TIMEOUT_MS).blockUntilEnded(TIMEOUT_MS);
    fail();
  }
 catch (  ExoPlaybackException e) {
    assertThat(e.getUnexpectedException()).isInstanceOf(IllegalSeekPositionException.class);
  }
  testRunner.assertTimelinesEqual(timeline);
  testRunner.assertTimelineChangeReasonsEqual(Player.TIMELINE_CHANGE_REASON_PREPARED);
}
