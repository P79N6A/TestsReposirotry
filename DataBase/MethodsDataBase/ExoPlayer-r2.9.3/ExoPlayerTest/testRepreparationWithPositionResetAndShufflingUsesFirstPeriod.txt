@Test public void testRepreparationWithPositionResetAndShufflingUsesFirstPeriod() throws Exception {
  Timeline fakeTimeline=new FakeTimeline(new TimelineWindowDefinition(true,false,100000));
  ConcatenatingMediaSource firstMediaSource=new ConcatenatingMediaSource(false,new FakeShuffleOrder(2),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT));
  ConcatenatingMediaSource secondMediaSource=new ConcatenatingMediaSource(false,new FakeShuffleOrder(2),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT));
  ActionSchedule actionSchedule=new ActionSchedule.Builder("testRepreparationWithShuffle").pause().waitForPlaybackState(Player.STATE_READY).setShuffleModeEnabled(true).prepareSource(secondMediaSource,true,false).play().build();
  ExoPlayerTestRunner testRunner=new ExoPlayerTestRunner.Builder().setMediaSource(firstMediaSource).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  testRunner.assertPlayedPeriodIndices(0,1,0);
}
