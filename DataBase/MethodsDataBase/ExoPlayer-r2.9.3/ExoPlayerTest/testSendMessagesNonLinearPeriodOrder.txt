@Test public void testSendMessagesNonLinearPeriodOrder() throws Exception {
  Timeline fakeTimeline=new FakeTimeline(1);
  MediaSource[] fakeMediaSources={new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT),new FakeMediaSource(fakeTimeline,null,Builder.VIDEO_FORMAT)};
  ConcatenatingMediaSource mediaSource=new ConcatenatingMediaSource(false,new FakeShuffleOrder(3),fakeMediaSources);
  PositionGrabbingMessageTarget target1=new PositionGrabbingMessageTarget();
  PositionGrabbingMessageTarget target2=new PositionGrabbingMessageTarget();
  PositionGrabbingMessageTarget target3=new PositionGrabbingMessageTarget();
  ActionSchedule actionSchedule=new ActionSchedule.Builder("testSendMessages").pause().waitForPlaybackState(Player.STATE_READY).sendMessage(target1,0,50).sendMessage(target2,1,50).sendMessage(target3,2,50).setShuffleModeEnabled(true).seek(2,0).play().build();
  new ExoPlayerTestRunner.Builder().setMediaSource(mediaSource).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  assertThat(target1.windowIndex).isEqualTo(0);
  assertThat(target2.windowIndex).isEqualTo(1);
  assertThat(target3.windowIndex).isEqualTo(2);
}
