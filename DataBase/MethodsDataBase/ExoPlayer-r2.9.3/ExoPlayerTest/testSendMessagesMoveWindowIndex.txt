@Test public void testSendMessagesMoveWindowIndex() throws Exception {
  Timeline timeline=new FakeTimeline(new TimelineWindowDefinition(1,0),new TimelineWindowDefinition(1,1));
  final Timeline secondTimeline=new FakeTimeline(new TimelineWindowDefinition(1,1),new TimelineWindowDefinition(1,0));
  final FakeMediaSource mediaSource=new FakeMediaSource(timeline,null,Builder.VIDEO_FORMAT);
  PositionGrabbingMessageTarget target=new PositionGrabbingMessageTarget();
  ActionSchedule actionSchedule=new ActionSchedule.Builder("testSendMessages").pause().waitForTimelineChanged(timeline).sendMessage(target,1,50).executeRunnable(() -> mediaSource.setNewSourceInfo(secondTimeline,null)).waitForTimelineChanged(secondTimeline).seek(0,0).play().build();
  new Builder().setMediaSource(mediaSource).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  assertThat(target.positionMs).isAtLeast(50L);
  assertThat(target.windowIndex).isEqualTo(0);
}
