@Test public void testRepeatModeChanges() throws Exception {
  Timeline timeline=new FakeTimeline(3);
  FakeRenderer renderer=new FakeRenderer(Builder.VIDEO_FORMAT);
  ActionSchedule actionSchedule=new ActionSchedule.Builder("testRepeatMode").pause().waitForTimelineChanged(timeline).playUntilStartOfWindow(1).setRepeatMode(Player.REPEAT_MODE_ONE).playUntilStartOfWindow(1).setRepeatMode(Player.REPEAT_MODE_OFF).playUntilStartOfWindow(2).setRepeatMode(Player.REPEAT_MODE_ONE).playUntilStartOfWindow(2).setRepeatMode(Player.REPEAT_MODE_ALL).playUntilStartOfWindow(0).setRepeatMode(Player.REPEAT_MODE_ONE).playUntilStartOfWindow(0).playUntilStartOfWindow(0).setRepeatMode(Player.REPEAT_MODE_OFF).play().build();
  ExoPlayerTestRunner testRunner=new ExoPlayerTestRunner.Builder().setTimeline(timeline).setRenderers(renderer).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  testRunner.assertPlayedPeriodIndices(0,1,1,2,2,0,0,0,1,2);
  testRunner.assertPositionDiscontinuityReasonsEqual(Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION,Player.DISCONTINUITY_REASON_PERIOD_TRANSITION);
  testRunner.assertTimelinesEqual(timeline);
  testRunner.assertTimelineChangeReasonsEqual(Player.TIMELINE_CHANGE_REASON_PREPARED);
  assertThat(renderer.isEnded).isTrue();
}
