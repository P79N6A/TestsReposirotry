@Test public void seekToUnpreparedWindowWithMultiplePeriodsInConcatenationStartsAtCorrectPeriod() throws Exception {
  long periodDurationMs=5000;
  Timeline timeline=new FakeTimeline(new TimelineWindowDefinition(2,new Object(),true,false,2 * periodDurationMs * 1000));
  FakeMediaSource mediaSource=new FakeMediaSource(null,null);
  MediaSource concatenatedMediaSource=new ConcatenatingMediaSource(mediaSource);
  AtomicInteger periodIndexWhenReady=new AtomicInteger();
  AtomicLong positionWhenReady=new AtomicLong();
  ActionSchedule actionSchedule=new ActionSchedule.Builder("seekToUnpreparedWindowWithMultiplePeriodsInConcatenation").pause().waitForPlaybackState(Player.STATE_BUFFERING).seek(periodDurationMs + 10).waitForTimelineChanged().executeRunnable(() -> mediaSource.setNewSourceInfo(timeline,null)).waitForTimelineChanged().waitForPlaybackState(Player.STATE_READY).executeRunnable(new PlayerRunnable(){
    @Override public void run(    SimpleExoPlayer player){
      periodIndexWhenReady.set(player.getCurrentPeriodIndex());
      positionWhenReady.set(player.getContentPosition());
    }
  }
).play().build();
  new Builder().setMediaSource(concatenatedMediaSource).setActionSchedule(actionSchedule).build(context).start().blockUntilEnded(TIMEOUT_MS);
  assertThat(periodIndexWhenReady.get()).isEqualTo(1);
  assertThat(positionWhenReady.get()).isEqualTo(periodDurationMs + 10);
}
