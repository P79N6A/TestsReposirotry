@Test @SuppressWarnings({"NonAtomicVolatileUpdate","NonAtomicOperationOnVolatileField"}) public void testDownloadRetryCountResetsOnProgress() throws Throwable {
  FakeDownloadAction downloadAction=createDownloadAction(uri1);
  downloadAction.post();
  FakeDownloader fakeDownloader=downloadAction.getFakeDownloader();
  fakeDownloader.enableDownloadIOException=true;
  fakeDownloader.downloadedBytes=0;
  for (int i=0; i <= MIN_RETRY_COUNT + 10; i++) {
    fakeDownloader.assertStarted(MAX_RETRY_DELAY);
    fakeDownloader.downloadedBytes++;
    if (i == MIN_RETRY_COUNT + 10) {
      fakeDownloader.enableDownloadIOException=false;
    }
    fakeDownloader.unblock();
  }
  downloadAction.assertCompleted();
  downloadManagerListener.blockUntilTasksCompleteAndThrowAnyDownloadError();
}
