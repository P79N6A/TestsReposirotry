@Test public void testDownloadRetriesThenFails() throws Throwable {
  FakeDownloadAction downloadAction=createDownloadAction(uri1);
  downloadAction.post();
  FakeDownloader fakeDownloader=downloadAction.getFakeDownloader();
  fakeDownloader.enableDownloadIOException=true;
  for (int i=0; i <= MIN_RETRY_COUNT; i++) {
    fakeDownloader.assertStarted(MAX_RETRY_DELAY).unblock();
  }
  downloadAction.assertFailed();
  downloadManagerListener.clearDownloadError();
  downloadManagerListener.blockUntilTasksCompleteAndThrowAnyDownloadError();
}
