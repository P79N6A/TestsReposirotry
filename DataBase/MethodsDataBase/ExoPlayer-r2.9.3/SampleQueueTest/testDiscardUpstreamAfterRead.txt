@Test public void testDiscardUpstreamAfterRead(){
  writeTestData();
  assertReadTestData(null,0,3);
  sampleQueue.discardUpstreamSamples(8);
  assertAllocationCount(10);
  sampleQueue.discardToRead();
  assertAllocationCount(7);
  sampleQueue.discardUpstreamSamples(7);
  assertAllocationCount(6);
  sampleQueue.discardUpstreamSamples(6);
  assertAllocationCount(4);
  sampleQueue.discardUpstreamSamples(5);
  assertAllocationCount(2);
  sampleQueue.discardUpstreamSamples(4);
  assertAllocationCount(1);
  sampleQueue.discardUpstreamSamples(3);
  assertAllocationCount(0);
  assertReadFormat(false,FORMAT_2);
  assertNoSamplesToRead(FORMAT_2);
}
