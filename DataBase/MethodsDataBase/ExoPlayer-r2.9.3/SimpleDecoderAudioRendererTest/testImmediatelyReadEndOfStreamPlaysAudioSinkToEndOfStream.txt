@Test public void testImmediatelyReadEndOfStreamPlaysAudioSinkToEndOfStream() throws Exception {
  audioRenderer.enable(RendererConfiguration.DEFAULT,new Format[]{FORMAT},new FakeSampleStream(FORMAT,null,false),0,false,0);
  audioRenderer.setCurrentStreamFinal();
  when(mockAudioSink.isEnded()).thenReturn(true);
  while (!audioRenderer.isEnded()) {
    audioRenderer.render(0,0);
  }
  verify(mockAudioSink,times(1)).playToEndOfStream();
  audioRenderer.disable();
  verify(mockAudioSink,times(1)).release();
}
