@Test public void testMergingMediaSourcePeriodCreation() throws Exception {
  FakeMediaSource[] mediaSources=new FakeMediaSource[2];
  for (int i=0; i < mediaSources.length; i++) {
    mediaSources[i]=new FakeMediaSource(new FakeTimeline(2),null);
  }
  MergingMediaSource mediaSource=new MergingMediaSource(mediaSources);
  MediaSourceTestRunner testRunner=new MediaSourceTestRunner(mediaSource,null);
  try {
    testRunner.prepareSource();
    testRunner.assertPrepareAndReleaseAllPeriods();
    for (    FakeMediaSource element : mediaSources) {
      assertThat(element.getCreatedMediaPeriods()).isNotEmpty();
    }
    testRunner.releaseSource();
  }
  finally {
    testRunner.release();
  }
}
