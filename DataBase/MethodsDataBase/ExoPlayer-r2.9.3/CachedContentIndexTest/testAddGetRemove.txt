@Test public void testAddGetRemove() throws Exception {
  final String key1="key1";
  final String key2="key2";
  final String key3="key3";
  CachedContent cachedContent1=index.getOrAdd(key1);
  CachedContent cachedContent2=index.getOrAdd(key2);
  assertThat(cachedContent1.id != cachedContent2.id).isTrue();
  File cacheSpanFile=SimpleCacheSpanTest.createCacheSpanFile(cacheDir,cachedContent1.id,10,20,30);
  SimpleCacheSpan span=SimpleCacheSpan.createCacheEntry(cacheSpanFile,index);
  assertThat(span).isNotNull();
  cachedContent1.addSpan(span);
  assertThat(index.get(key1)).isEqualTo(cachedContent1);
  assertThat(index.get(key2)).isEqualTo(cachedContent2);
  assertThat(index.get(key3)).isNull();
  Collection<CachedContent> cachedContents=index.getAll();
  assertThat(cachedContents).containsExactly(cachedContent1,cachedContent2);
  Set<String> keys=index.getKeys();
  assertThat(keys).containsExactly(key1,key2);
  assertThat(index.getKeyForId(cachedContent1.id)).isEqualTo(key1);
  assertThat(index.getKeyForId(cachedContent2.id)).isEqualTo(key2);
  index.maybeRemove(key2);
  index.maybeRemove(key3);
  assertThat(index.get(key1)).isEqualTo(cachedContent1);
  assertThat(index.get(key2)).isNull();
  assertThat(cacheSpanFile.exists()).isTrue();
  index.getOrAdd(key2);
  index.removeEmpty();
  assertThat(index.get(key1)).isEqualTo(cachedContent1);
  assertThat(index.get(key2)).isNull();
  assertThat(cacheSpanFile.exists()).isTrue();
}
