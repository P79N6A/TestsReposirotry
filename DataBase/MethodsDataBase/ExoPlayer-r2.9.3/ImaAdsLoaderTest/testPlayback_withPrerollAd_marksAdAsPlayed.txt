@Test public void testPlayback_withPrerollAd_marksAdAsPlayed(){
  setupPlayback(CONTENT_TIMELINE,PREROLL_ADS_DURATIONS_US,PREROLL_CUE_POINTS_SECONDS);
  imaAdsLoader.attachPlayer(fakeExoPlayer,adsLoaderListener,adUiViewGroup);
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.LOADED,UNSKIPPABLE_AD));
  imaAdsLoader.loadAd(TEST_URI.toString());
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.CONTENT_PAUSE_REQUESTED,UNSKIPPABLE_AD));
  imaAdsLoader.playAd();
  fakeExoPlayer.setPlayingAdPosition(0,0,0,0);
  fakeExoPlayer.setState(Player.STATE_READY,true);
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.STARTED,UNSKIPPABLE_AD));
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.FIRST_QUARTILE,UNSKIPPABLE_AD));
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.MIDPOINT,UNSKIPPABLE_AD));
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.THIRD_QUARTILE,UNSKIPPABLE_AD));
  fakeExoPlayer.setPlayingContentPosition(0);
  imaAdsLoader.stopAd();
  imaAdsLoader.onAdEvent(getAdEvent(AdEventType.CONTENT_RESUME_REQUESTED,null));
  assertThat(adsLoaderListener.adPlaybackState).isEqualTo(new AdPlaybackState(0).withContentDurationUs(CONTENT_DURATION_US).withAdCount(0,1).withAdUri(0,0,TEST_URI).withAdDurationsUs(PREROLL_ADS_DURATIONS_US).withPlayedAd(0,0).withAdResumePositionUs(0));
}
