@Test public void testCustomCallbackAfterPreparationSetShuffleOrder() throws Exception {
  DummyMainThread dummyMainThread=new DummyMainThread();
  try {
    mediaSource.addMediaSources(Arrays.asList(createFakeMediaSource(),createFakeMediaSource(),createFakeMediaSource()));
    testRunner.prepareSource();
    TimelineGrabber timelineGrabber=new TimelineGrabber(testRunner);
    dummyMainThread.runOnMainThread(() -> mediaSource.setShuffleOrder(new ShuffleOrder.UnshuffledShuffleOrder(3),timelineGrabber));
    Timeline timeline=timelineGrabber.assertTimelineChangeBlocking();
    assertThat(timeline.getFirstWindowIndex(true)).isEqualTo(0);
  }
  finally {
    dummyMainThread.release();
  }
}
