@Test public void testCustomCallbackAfterPreparationAddSingle() throws IOException {
  DummyMainThread dummyMainThread=new DummyMainThread();
  try {
    testRunner.prepareSource();
    final TimelineGrabber timelineGrabber=new TimelineGrabber(testRunner);
    dummyMainThread.runOnMainThread(() -> mediaSource.addMediaSource(createFakeMediaSource(),timelineGrabber));
    Timeline timeline=timelineGrabber.assertTimelineChangeBlocking();
    assertThat(timeline.getWindowCount()).isEqualTo(1);
  }
  finally {
    dummyMainThread.release();
  }
}
