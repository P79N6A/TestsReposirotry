@Test public void testPeriodCreationWithAds() throws IOException, InterruptedException {
  Timeline timelineContentOnly=new FakeTimeline(new TimelineWindowDefinition(2,111,true,false,10 * C.MICROS_PER_SECOND));
  Timeline timelineWithAds=new FakeTimeline(new TimelineWindowDefinition(2,222,true,false,10 * C.MICROS_PER_SECOND,FakeTimeline.createAdPlaybackState(1,0)));
  FakeMediaSource mediaSourceContentOnly=new FakeMediaSource(timelineContentOnly,null);
  FakeMediaSource mediaSourceWithAds=new FakeMediaSource(timelineWithAds,null);
  mediaSource.addMediaSource(mediaSourceContentOnly);
  mediaSource.addMediaSource(mediaSourceWithAds);
  Timeline timeline=testRunner.prepareSource();
  TimelineAsserts.assertAdGroupCounts(timeline,0,0,1,1);
  testRunner.assertPrepareAndReleaseAllPeriods();
  Object timelineContentOnlyPeriodUid0=timelineContentOnly.getUidOfPeriod(0);
  Object timelineContentOnlyPeriodUid1=timelineContentOnly.getUidOfPeriod(1);
  Object timelineWithAdsPeriodUid0=timelineWithAds.getUidOfPeriod(0);
  Object timelineWithAdsPeriodUid1=timelineWithAds.getUidOfPeriod(1);
  mediaSourceContentOnly.assertMediaPeriodCreated(new MediaPeriodId(timelineContentOnlyPeriodUid0,0));
  mediaSourceContentOnly.assertMediaPeriodCreated(new MediaPeriodId(timelineContentOnlyPeriodUid1,0));
  mediaSourceWithAds.assertMediaPeriodCreated(new MediaPeriodId(timelineWithAdsPeriodUid0,1));
  mediaSourceWithAds.assertMediaPeriodCreated(new MediaPeriodId(timelineWithAdsPeriodUid1,1));
  mediaSourceWithAds.assertMediaPeriodCreated(new MediaPeriodId(timelineWithAdsPeriodUid0,0,0,1));
  mediaSourceWithAds.assertMediaPeriodCreated(new MediaPeriodId(timelineWithAdsPeriodUid1,0,0,1));
  testRunner.assertCompletedManifestLoads(0,1);
  assertCompletedAllMediaPeriodLoads(timeline);
}
