@Test public void testAtomicTimelineWindowOrder() throws IOException {
  testRunner.release();
  ConcatenatingMediaSource mediaSource=new ConcatenatingMediaSource(true,new FakeShuffleOrder(0));
  testRunner=new MediaSourceTestRunner(mediaSource,null);
  mediaSource.addMediaSources(Arrays.asList(createMediaSources(3)));
  Timeline timeline=testRunner.prepareSource();
  TimelineAsserts.assertWindowTags(timeline,111,222,333);
  TimelineAsserts.assertPeriodCounts(timeline,1,2,3);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_OFF,false,C.INDEX_UNSET,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_OFF,true,C.INDEX_UNSET,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ONE,false,2,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ONE,true,2,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ALL,false,2,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ALL,true,2,0,1);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_OFF,false,1,2,C.INDEX_UNSET);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_OFF,true,1,2,C.INDEX_UNSET);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ONE,false,1,2,0);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ONE,true,1,2,0);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ALL,false,1,2,0);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ALL,true,1,2,0);
  assertThat(timeline.getFirstWindowIndex(false)).isEqualTo(0);
  assertThat(timeline.getFirstWindowIndex(true)).isEqualTo(0);
  assertThat(timeline.getLastWindowIndex(false)).isEqualTo(2);
  assertThat(timeline.getLastWindowIndex(true)).isEqualTo(2);
}
