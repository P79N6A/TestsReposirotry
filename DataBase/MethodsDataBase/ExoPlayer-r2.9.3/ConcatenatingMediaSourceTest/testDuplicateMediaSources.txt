@Test public void testDuplicateMediaSources() throws IOException, InterruptedException {
  Timeline childTimeline=new FakeTimeline(2);
  FakeMediaSource childSource=new FakeMediaSource(childTimeline,null);
  mediaSource.addMediaSource(childSource);
  mediaSource.addMediaSource(childSource);
  testRunner.prepareSource();
  mediaSource.addMediaSources(Arrays.asList(childSource,childSource));
  Timeline timeline=testRunner.assertTimelineChangeBlocking();
  TimelineAsserts.assertPeriodCounts(timeline,1,1,1,1,1,1,1,1);
  testRunner.assertPrepareAndReleaseAllPeriods();
  Object childPeriodUid0=childTimeline.getUidOfPeriod(0);
  Object childPeriodUid1=childTimeline.getUidOfPeriod(1);
  assertThat(childSource.getCreatedMediaPeriods()).containsAllOf(new MediaPeriodId(childPeriodUid0,0),new MediaPeriodId(childPeriodUid0,2),new MediaPeriodId(childPeriodUid0,4),new MediaPeriodId(childPeriodUid0,6),new MediaPeriodId(childPeriodUid1,1),new MediaPeriodId(childPeriodUid1,3),new MediaPeriodId(childPeriodUid1,5),new MediaPeriodId(childPeriodUid1,7));
  testRunner.assertCompletedManifestLoads(0);
  assertCompletedAllMediaPeriodLoads(timeline);
  testRunner.releaseSource();
  childSource.assertReleased();
}
