@Test public void testEmptyTimelineMediaSource() throws IOException, InterruptedException {
  Timeline timeline=testRunner.prepareSource();
  TimelineAsserts.assertEmpty(timeline);
  mediaSource.addMediaSource(new FakeMediaSource(Timeline.EMPTY,null));
  timeline=testRunner.assertTimelineChangeBlocking();
  TimelineAsserts.assertEmpty(timeline);
  mediaSource.addMediaSources(Arrays.asList(new MediaSource[]{new FakeMediaSource(Timeline.EMPTY,null),new FakeMediaSource(Timeline.EMPTY,null),new FakeMediaSource(Timeline.EMPTY,null),new FakeMediaSource(Timeline.EMPTY,null),new FakeMediaSource(Timeline.EMPTY,null),new FakeMediaSource(Timeline.EMPTY,null)}));
  timeline=testRunner.assertTimelineChangeBlocking();
  TimelineAsserts.assertEmpty(timeline);
  testRunner.assertCompletedManifestLoads();
  MediaSource[] mediaSources=createMediaSources(3);
  mediaSource.addMediaSource(1,mediaSources[0]);
  testRunner.assertTimelineChangeBlocking();
  mediaSource.addMediaSource(4,mediaSources[1]);
  testRunner.assertTimelineChangeBlocking();
  mediaSource.addMediaSource(6,mediaSources[2]);
  timeline=testRunner.assertTimelineChangeBlocking();
  TimelineAsserts.assertWindowTags(timeline,111,222,333);
  TimelineAsserts.assertPeriodCounts(timeline,1,2,3);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_OFF,false,C.INDEX_UNSET,0,1);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ONE,false,0,1,2);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ALL,false,2,0,1);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_OFF,false,1,2,C.INDEX_UNSET);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ONE,false,0,1,2);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ALL,false,1,2,0);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_OFF,true,1,2,C.INDEX_UNSET);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ONE,true,0,1,2);
  TimelineAsserts.assertPreviousWindowIndices(timeline,Player.REPEAT_MODE_ALL,true,1,2,0);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_OFF,true,C.INDEX_UNSET,0,1);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ONE,true,0,1,2);
  TimelineAsserts.assertNextWindowIndices(timeline,Player.REPEAT_MODE_ALL,true,2,0,1);
  assertThat(timeline.getFirstWindowIndex(false)).isEqualTo(0);
  assertThat(timeline.getLastWindowIndex(false)).isEqualTo(2);
  assertThat(timeline.getFirstWindowIndex(true)).isEqualTo(2);
  assertThat(timeline.getLastWindowIndex(true)).isEqualTo(0);
  testRunner.assertPrepareAndReleaseAllPeriods();
  testRunner.assertCompletedManifestLoads(0,1,2);
  assertCompletedAllMediaPeriodLoads(timeline);
}
