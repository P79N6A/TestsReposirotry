@Test public void testCustomCallbackAfterPreparationRemove() throws IOException {
  DummyMainThread dummyMainThread=new DummyMainThread();
  try {
    testRunner.prepareSource();
    dummyMainThread.runOnMainThread(() -> mediaSource.addMediaSource(createFakeMediaSource()));
    testRunner.assertTimelineChangeBlocking();
    final TimelineGrabber timelineGrabber=new TimelineGrabber(testRunner);
    dummyMainThread.runOnMainThread(() -> mediaSource.removeMediaSource(0,timelineGrabber));
    Timeline timeline=timelineGrabber.assertTimelineChangeBlocking();
    assertThat(timeline.getWindowCount()).isEqualTo(0);
  }
  finally {
    dummyMainThread.release();
  }
}
