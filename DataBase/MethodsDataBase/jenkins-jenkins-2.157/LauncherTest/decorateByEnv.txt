@Issue("JENKINS-15733") @Test public void decorateByEnv() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  TaskListener l=new StreamBuildListener(baos);
  Launcher base=new Launcher.LocalLauncher(l);
  EnvVars env=new EnvVars("key1","val1");
  Launcher decorated=base.decorateByEnv(env);
  int res=decorated.launch().envs("key2=val2").cmds(Functions.isWindows() ? new String[]{"cmd","/q","/c","echo %key1% %key2%"} : new String[]{"sh","-c","echo $key1 $key2"}).stdout(l).join();
  String log=baos.toString();
  assertEquals(log,0,res);
  assertTrue(log,log.contains("val1 val2"));
}
