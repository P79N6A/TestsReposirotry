@Issue("JENKINS-52729") @Test public void multipleStdioCalls() throws Exception {
  Node master=rule.jenkins;
  Node agent=rule.createOnlineSlave();
  for (  Node node : new Node[]{master,agent}) {
    assertMultipleStdioCalls("first TaskListener then OutputStream",node,false,(ps,os1,os2,os2Listener) -> {
      ps.stdout(os2Listener).stdout(os1);
      assertEquals(os1,ps.stdout());
    }
,false);
    assertMultipleStdioCalls("first OutputStream then TaskListener",node,false,(ps,os1,os2,os2Listener) -> {
      ps.stdout(os1).stdout(os2Listener);
      assertEquals(os2Listener.getLogger(),ps.stdout());
    }
,true);
    assertMultipleStdioCalls("stdout then stderr",node,true,(ps,os1,os2,os2Listener) -> {
      ps.stdout(os1).stderr(os2);
      assertEquals(os1,ps.stdout());
      assertEquals(os2,ps.stderr());
    }
,true);
    assertMultipleStdioCalls("stderr then stdout",node,true,(ps,os1,os2,os2Listener) -> {
      ps.stdout(os1).stderr(os2);
      assertEquals(os1,ps.stdout());
      assertEquals(os2,ps.stderr());
    }
,true);
  }
}
