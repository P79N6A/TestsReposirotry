@Test @Issue("SECURITY-383") public void testPostJobXml() throws Exception {
  File exploitFile=f.newFile();
  try {
    if (exploitFile.exists() && !exploitFile.delete()) {
      throw new IllegalStateException("file exists and cannot be deleted");
    }
    File tempJobDir=new File(j.jenkins.getRootDir(),"security383");
    String exploitXml=IOUtils.toString(XStream2Security383Test.class.getResourceAsStream("/hudson/util/XStream2Security383Test/config.xml"),"UTF-8");
    exploitXml=exploitXml.replace("@TOKEN@",exploitFile.getAbsolutePath());
    when(req.getMethod()).thenReturn("POST");
    when(req.getInputStream()).thenReturn(new Stream(IOUtils.toInputStream(exploitXml)));
    when(req.getContentType()).thenReturn("application/xml");
    when(req.getParameter("name")).thenReturn("foo");
    try {
      j.jenkins.doCreateItem(req,rsp);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    assertFalse("no file should be created here",exploitFile.exists());
  }
  finally {
    exploitFile.delete();
  }
}
