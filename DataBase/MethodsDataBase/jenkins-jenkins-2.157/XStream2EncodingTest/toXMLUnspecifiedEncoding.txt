@SuppressWarnings("deprecation") @Test public void toXMLUnspecifiedEncoding() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XStream2 xs=new XStream2();
  String msg="k chybÄ›";
  xs.toXML(new Thing(msg),baos);
  byte[] ambiguousXml=baos.toByteArray();
  Thing t=(Thing)xs.fromXML(new ByteArrayInputStream(ambiguousXml));
  assertThat(t.field,not(msg));
  ByteArrayOutputStream baos2=new ByteArrayOutputStream();
  baos2.write("<?xml version='1.0' encoding='UTF-8'?>\n".getBytes("UTF-8"));
  baos2.write(ambiguousXml);
  t=(Thing)xs.fromXML(new ByteArrayInputStream(ambiguousXml));
  assertThat(t.field,not(msg));
}
