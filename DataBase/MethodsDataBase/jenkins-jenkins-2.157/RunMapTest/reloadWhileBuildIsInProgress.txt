/** 
 * Makes sure that reloading the project while a build is in progress won't clobber that in-progress build.
 */
@Issue("JENKNS-12318") @Test public void reloadWhileBuildIsInProgress() throws Exception {
  FreeStyleProject p=r.createFreeStyleProject();
  FreeStyleBuild b1=r.assertBuildStatusSuccess(p.scheduleBuild2(0));
  p.getBuildersList().add(new SleepBuilder(9999999));
  FreeStyleBuild b2=p.scheduleBuild2(0).waitForStart();
  assertEquals(2,b2.number);
  p.updateByXml((Source)new StreamSource(p.getConfigFile().getFile()));
  assertSame(p.getBuildByNumber(b2.number),b2);
  assertNotSame(b1,p.getBuildByNumber(1));
  b1=p.getBuildByNumber(1);
  assertSame(b1.getNextBuild(),b2);
  assertSame(b2.getPreviousBuild(),b1);
}
