/** 
 * Make sure that SCMTrigger doesn't poll when there is a polling veto in place.
 */
@Test @Issue("JENKINS-36123") public void pollingExcludedByExtensionPoint() throws Exception {
  FreeStyleProject p=j.createFreeStyleProject();
  PollDecisionHandlerImpl handler=ExtensionList.lookup(SCMDecisionHandler.class).get(PollDecisionHandlerImpl.class);
  handler.blacklist.add(p);
  final OneShotEvent checkoutStarted=new OneShotEvent();
  p.setScm(new TestSCM(checkoutStarted));
  assertFalse("SCM-poll with blacklist should report no changes",p.pollSCMChanges(StreamTaskListener.fromStdout()));
  handler.blacklist.remove(p);
  assertTrue("SCM-poll with blacklist removed should report changes",p.pollSCMChanges(StreamTaskListener.fromStdout()));
}
