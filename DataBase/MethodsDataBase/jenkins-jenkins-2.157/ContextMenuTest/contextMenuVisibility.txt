@Issue("JENKINS-19173") @Test public void contextMenuVisibility() throws Exception {
  final FreeStyleProject p=j.createFreeStyleProject("p");
  Callable<ContextMenu> doContextMenu=new Callable<ContextMenu>(){
    @Override public ContextMenu call() throws Exception {
      return p.doContextMenu(Stapler.getCurrentRequest(),Stapler.getCurrentResponse());
    }
  }
;
  ActionFactory f=j.jenkins.getExtensionList(TransientProjectActionFactory.class).get(ActionFactory.class);
  f.visible=true;
  ContextMenu menu=j.executeOnServer(doContextMenu);
  Map<String,String> parsed=parse(menu);
  assertEquals(parsed.toString(),"Hello",parsed.get("testing"));
  f.visible=false;
  menu=j.executeOnServer(doContextMenu);
  parsed=parse(menu);
  assertEquals(parsed.toString(),null,parsed.get("testing"));
}
