@Test public void testToWindowsCommand(){
  ArgumentListBuilder builder=new ArgumentListBuilder().add("ant.bat").add("-Dfoo1=abc").add("-Dfoo2=foo bar").add("-Dfoo3=/u*r").add("-Dfoo4=/us?").add("-Dfoo10=bar,baz").add("-Dfoo5=foo;bar^baz").add("-Dfoo6=<xml>&here;</xml>").add("-Dfoo7=foo|bar\"baz").add("-Dfoo8=% %QED% %comspec% %-%(%.%").add("-Dfoo9=%'''%%@%");
  assertThat(builder.toWindowsCommand().toCommandArray(),is(new String[]{"cmd.exe","/C","\"ant.bat","-Dfoo1=abc","\"-Dfoo2=foo bar\"","\"-Dfoo3=/u*r\"","\"-Dfoo4=/us?\"","\"-Dfoo10=bar,baz\"","\"-Dfoo5=foo;bar^baz\"","\"-Dfoo6=<xml>&here;</xml>\"","\"-Dfoo7=foo|bar\"\"baz\"","\"-Dfoo8=% %QED% %comspec% %-%(%.%\"","-Dfoo9=%'''%%@%","&&","exit","%%ERRORLEVEL%%\""}));
  assertThat(builder.toWindowsCommand(true).toCommandArray(),is(new String[]{"cmd.exe","/C","\"ant.bat","-Dfoo1=abc","\"-Dfoo2=foo bar\"","\"-Dfoo3=/u*r\"","\"-Dfoo4=/us?\"","\"-Dfoo10=bar,baz\"","\"-Dfoo5=foo;bar^baz\"","\"-Dfoo6=<xml>&here;</xml>\"","\"-Dfoo7=foo|bar\"\"baz\"","\"-Dfoo8=% %\"Q\"ED% %\"c\"omspec% %-%(%.%\"","-Dfoo9=%'''%%@%","&&","exit","%%ERRORLEVEL%%\""}));
  builder.add("-Dpassword=hidden",true);
  assertThat(builder.toWindowsCommand().toString(),is("cmd.exe /C \"ant.bat -Dfoo1=abc \"\"-Dfoo2=foo bar\"\" \"-Dfoo3=/u*r\" \"-Dfoo4=/us?\" \"-Dfoo10=bar,baz\" \"-Dfoo5=foo;bar^baz\" \"-Dfoo6=<xml>&here;</xml>\" \"-Dfoo7=foo|bar\"\"baz\" \"\"-Dfoo8=% %QED% %comspec% %-%(%.%\"\" -Dfoo9=%'''%%@% ****** && exit %%ERRORLEVEL%%\""));
  assertThat(builder.toWindowsCommand(true).toString(),is("cmd.exe /C \"ant.bat -Dfoo1=abc \"\"-Dfoo2=foo bar\"\" \"-Dfoo3=/u*r\" \"-Dfoo4=/us?\" \"-Dfoo10=bar,baz\" \"-Dfoo5=foo;bar^baz\" \"-Dfoo6=<xml>&here;</xml>\" \"-Dfoo7=foo|bar\"\"baz\" \"\"-Dfoo8=% %\"Q\"ED% %\"c\"omspec% %-%(%.%\"\" -Dfoo9=%'''%%@% ****** && exit %%ERRORLEVEL%%\""));
}
