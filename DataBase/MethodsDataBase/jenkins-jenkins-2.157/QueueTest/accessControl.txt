/** 
 * Make sure that the running build actually carries an credential.
 */
@Test public void accessControl() throws Exception {
  FreeStyleProject p=r.createFreeStyleProject();
  QueueItemAuthenticatorConfiguration.get().getAuthenticators().add(new MockQueueItemAuthenticator(Collections.singletonMap(p.getFullName(),alice)));
  p.getBuildersList().add(new TestBuilder(){
    @Override public boolean perform(    AbstractBuild<?,?> build,    Launcher launcher,    BuildListener listener) throws InterruptedException, IOException {
      assertEquals(alice,Jenkins.getAuthentication());
      return true;
    }
  }
);
  r.assertBuildStatusSuccess(p.scheduleBuild2(0));
}
