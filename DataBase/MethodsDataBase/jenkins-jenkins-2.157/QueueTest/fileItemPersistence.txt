@Test public void fileItemPersistence() throws Exception {
  byte[] testData=new byte[1024];
  for (int i=0; i < testData.length; i++)   testData[i]=(byte)i;
  Server server=new Server();
  ServerConnector connector=new ServerConnector(server);
  server.addConnector(connector);
  ServletHandler handler=new ServletHandler();
  handler.addServletWithMapping(new ServletHolder(new FileItemPersistenceTestServlet()),"/");
  server.setHandler(handler);
  server.start();
  try {
    JenkinsRule.WebClient wc=r.createWebClient();
    @SuppressWarnings("deprecation") HtmlPage p=(HtmlPage)wc.getPage("http://localhost:" + connector.getLocalPort() + '/');
    HtmlForm f=p.getFormByName("main");
    HtmlFileInput input=(HtmlFileInput)f.getInputByName("test");
    input.setData(testData);
    HtmlFormUtil.submit(f);
  }
  finally {
    server.stop();
  }
}
