@Test public void waitForStartAndCancelBeforeStart() throws Exception {
  final OneShotEvent ev=new OneShotEvent();
  FreeStyleProject p=r.createFreeStyleProject();
  QueueTaskFuture<FreeStyleBuild> f=p.scheduleBuild2(10);
  final Queue.Item item=Queue.getInstance().getItem(p);
  assertNotNull(item);
  final ScheduledThreadPoolExecutor executor=new ScheduledThreadPoolExecutor(1);
  executor.schedule(new Runnable(){
    @Override public void run(){
      try {
        Queue.getInstance().doCancelItem(item.getId());
      }
 catch (      IOException|ServletException e) {
        e.printStackTrace();
      }
    }
  }
,2,TimeUnit.SECONDS);
  try {
    f.waitForStart();
    fail("Expected an CancellationException to be thrown");
  }
 catch (  CancellationException e) {
  }
}
