@Test @Issue("JENKINS-39465") public void agentProtocols_multipleEnable_roundtrip() throws Exception {
  final Set<String> defaultProtocols=Collections.unmodifiableSet(j.jenkins.getAgentProtocols());
  final Set<String> newProtocols=new HashSet<>(defaultProtocols);
  newProtocols.add(MockOptInProtocol1.NAME);
  newProtocols.add(MockOptInProtocol2.NAME);
  j.jenkins.setAgentProtocols(newProtocols);
  j.jenkins.save();
  final Set<String> agentProtocolsBeforeReload=j.jenkins.getAgentProtocols();
  assertProtocolEnabled(MockOptInProtocol1.NAME,"before the roundtrip");
  assertProtocolEnabled(MockOptInProtocol2.NAME,"before the roundtrip");
  j.jenkins.reload();
  final Set<String> reloadedProtocols=j.jenkins.getAgentProtocols();
  assertFalse("The protocol list must have been really reloaded",agentProtocolsBeforeReload == reloadedProtocols);
  assertThat("There should be two additional enabled protocols",reloadedProtocols.size(),equalTo(defaultProtocols.size() + 2));
  assertProtocolEnabled(MockOptInProtocol1.NAME,"after the roundtrip");
  assertProtocolEnabled(MockOptInProtocol2.NAME,"after the roundtrip");
}
