@Test public void buildPendingWhenBuildInPostProduction() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject("project");
  project.getBuildersList().add(new SleepBuilder(1000));
  project.scheduleBuild2(1);
  int count=0;
  while (!JobQueueTest.fireCompletedFlag && count < 100) {
    Thread.sleep(100);
    count++;
  }
  if (JobQueueTest.fireCompletedFlag) {
    project.scheduleBuild2(0);
    assertTrue(project.isInQueue());
    j.jenkins.getQueue().maintain();
    while (j.jenkins.getQueue().getItem(project) instanceof WaitingItem) {
      System.out.println(j.jenkins.getQueue().getItem(project));
      j.jenkins.getQueue().maintain();
      Thread.sleep(10);
    }
    assertTrue(j.jenkins.getQueue().getItem(project) instanceof BlockedItem);
  }
 else {
    fail("The maximum attempts for checking if the job is in POST_PRODUCTION State have reached");
  }
  count=0;
  while (!JobQueueTest.fireFinalizeFlag && count < 100) {
    Thread.sleep(100);
    count++;
  }
  if (JobQueueTest.fireFinalizeFlag) {
    j.jenkins.getQueue().maintain();
    assertFalse(j.jenkins.getQueue().getItem(project) instanceof BlockedItem);
  }
 else {
    fail("The maximum attempts for checking if the job is in COMPLETED State have reached");
  }
  Thread.sleep(1000);
}
