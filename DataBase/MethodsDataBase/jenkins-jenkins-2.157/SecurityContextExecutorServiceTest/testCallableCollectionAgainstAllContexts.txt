@Test @PresetData(PresetData.DataSet.NO_ANONYMOUS_READACCESS) public void testCallableCollectionAgainstAllContexts() throws Exception {
  Collection<Callable<SecurityContext>> callables=new LinkedList<Callable<SecurityContext>>();
  Callable<SecurityContext> c=new Callable<SecurityContext>(){
    public SecurityContext call() throws Exception {
      return SecurityContextHolder.getContext();
    }
  }
;
  callables.add(c);
  callables.add(c);
  callables.add(c);
  SecurityContextHolder.setContext(systemContext);
  Collection<Future<SecurityContext>> results=wrappedService.invokeAll(callables);
  for (  Future<SecurityContext> result : results) {
    SecurityContext value=result.get();
    assertEquals(systemContext,value);
  }
  SecurityContextHolder.setContext(userContext);
  results=wrappedService.invokeAll(callables);
  for (  Future<SecurityContext> result : results) {
    assertEquals(userContext,result.get());
  }
  SecurityContextHolder.setContext(nullContext);
  results=wrappedService.invokeAll(callables);
  for (  Future<SecurityContext> result : results) {
    assertEquals(nullContext,result.get());
  }
}
