@Test @Issue("JENKINS-50599") public void addNodeShouldFailAtomically() throws Exception {
  InvalidNode node=new InvalidNode("foo","temp",r.createComputerLauncher(null));
  try {
    r.jenkins.addNode(node);
    fail("Adding the node should have thrown an exception during serialization");
  }
 catch (  IOException e) {
    String className=InvalidNode.class.getName();
    assertThat("The exception should be from failing to serialize the node",e.getMessage(),containsString("Failed to serialize " + className + "#cl for class "+ className));
  }
  assertThat("The node should not exist since #addNode threw an exception",r.jenkins.getNode("foo"),nullValue());
}
