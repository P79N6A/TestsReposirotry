@Test @LocalData public void upgradeFromJenkins2WithOlderDependency(){
  VersionNumber since=new VersionNumber("2.0");
  rr.then(r -> {
    List<DetachedPlugin> detachedPlugins=ClassicPluginStrategy.getDetachedPlugins(since);
    assertThat("Plugins have been detached since the pre-upgrade version",detachedPlugins.size(),greaterThan(1));
    assertThat("Plugins detached between the pre-upgrade version and the current version should be installed",getInstalledDetachedPlugins(r,detachedPlugins).size(),equalTo(detachedPlugins.size()));
    Plugin scriptSecurity=r.jenkins.getPlugin("script-security");
    assertThat("Script-security should be installed",scriptSecurity,notNullValue());
    assertThat("Dependencies of detached plugins should be upgraded to the required version",scriptSecurity.getWrapper().getVersionNumber(),equalTo(new VersionNumber("1.18.1")));
    assertNoFailedPlugins(r);
  }
);
}
