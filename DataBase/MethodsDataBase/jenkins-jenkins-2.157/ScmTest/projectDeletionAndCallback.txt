/** 
 * Makes sure that  {@link SCM#processWorkspaceBeforeDeletion(AbstractProject,FilePath,Node)} is calledbefore a project deletion.
 */
@Test @Issue("JENKINS-2271") public void projectDeletionAndCallback() throws Exception {
  FreeStyleProject p=j.createFreeStyleProject();
  final boolean[] callback=new boolean[1];
  p.setScm(new NullSCM(){
    public boolean processWorkspaceBeforeDeletion(    AbstractProject<?,?> project,    FilePath workspace,    Node node){
      callback[0]=true;
      return true;
    }
    private Object writeReplace(){
      return new NullSCM();
    }
  }
);
  p.scheduleBuild2(0).get();
  p.delete();
  assertTrue(callback[0]);
}
