/** 
 * Tests that permissions are kept when using  {@link FilePath#copyToWithPermission(FilePath)}. Also tries to check that a problem with setting the last-modified date on Windows doesn't fail the whole copy - well at least when running this test on a Windows OS. See JENKINS-11073
 */
@Test public void copyToWithPermission() throws IOException, InterruptedException {
  File tmp=temp.getRoot();
  File child=new File(tmp,"child");
  FilePath childP=new FilePath(child);
  childP.touch(4711);
  Chmod chmodTask=new Chmod();
  chmodTask.setProject(new Project());
  chmodTask.setFile(child);
  chmodTask.setPerm("0400");
  chmodTask.execute();
  FilePath copy=new FilePath(channels.british,tmp.getPath()).child("copy");
  childP.copyToWithPermission(copy);
  assertEquals(childP.mode(),copy.mode());
  if (!Functions.isWindows()) {
    assertEquals(childP.lastModified(),copy.lastModified());
  }
  for (int i=0; i < 100; i++) {
    copy=new FilePath(channels.british,tmp.getPath()).child("copy" + i);
    childP.copyToWithPermission(copy);
  }
}
