@Issue("JENKINS-23507") @Test public void installIfNecessaryFollowsRedirects() throws Exception {
  File tmp=temp.getRoot();
  final FilePath d=new FilePath(tmp);
  FilePath.UrlFactory urlFactory=mock(FilePath.UrlFactory.class);
  d.setUrlFactory(urlFactory);
  final HttpURLConnection con=mock(HttpURLConnection.class);
  final HttpURLConnection con2=mock(HttpURLConnection.class);
  final URL url=someUrlToZipFile(con);
  when(con.getResponseCode()).thenReturn(HttpURLConnection.HTTP_MOVED_TEMP);
  URL url2=someUrlToZipFile(con2);
  String someUrl=url2.toExternalForm();
  when(con.getHeaderField("Location")).thenReturn(someUrl);
  when(urlFactory.newURL(someUrl)).thenReturn(url2);
  when(con2.getResponseCode()).thenReturn(HttpURLConnection.HTTP_OK);
  when(con2.getInputStream()).thenReturn(someZippedContent());
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  String message="going ahead";
  assertTrue(d.installIfNecessaryFrom(url,new StreamTaskListener(baos),message));
}
