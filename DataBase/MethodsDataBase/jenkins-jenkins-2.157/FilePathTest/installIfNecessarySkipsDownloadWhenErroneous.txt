@Issue("JENKINS-26196") @Test public void installIfNecessarySkipsDownloadWhenErroneous() throws Exception {
  File tmp=temp.getRoot();
  final FilePath d=new FilePath(tmp);
  d.child(".timestamp").touch(123000);
  final HttpURLConnection con=mock(HttpURLConnection.class);
  final URL url=someUrlToZipFile(con);
  when(con.getResponseCode()).thenReturn(HttpURLConnection.HTTP_GATEWAY_TIMEOUT);
  when(con.getResponseMessage()).thenReturn("Gateway Timeout");
  when(con.getInputStream()).thenThrow(new ConnectException());
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  String message="going ahead";
  assertFalse(d.installIfNecessaryFrom(url,new StreamTaskListener(baos),message));
  verify(con).setIfModifiedSince(123000);
  String log=baos.toString();
  assertFalse(log,log.contains(message));
  assertTrue(log,log.contains("504 Gateway Timeout"));
}
