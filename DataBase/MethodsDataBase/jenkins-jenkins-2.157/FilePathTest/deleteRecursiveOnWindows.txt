@Test public void deleteRecursiveOnWindows() throws Exception {
  assumeTrue("Uses Windows-specific features",Functions.isWindows());
  Path targetDir=temp.newFolder("targetDir").toPath();
  Path targetContents=Files.createFile(targetDir.resolve("contents.txt"));
  Path toDelete=temp.newFolder("toDelete").toPath();
  Process p=new ProcessBuilder().directory(toDelete.toFile()).command("cmd.exe","/C","mklink /J junction ..\\targetDir").start();
  assumeThat("unable to create junction",p.waitFor(),is(0));
  Files.createFile(toDelete.resolve("foo"));
  Files.createFile(toDelete.resolve("bar"));
  FilePath f=new FilePath(toDelete.toFile());
  f.deleteRecursive();
  assertTrue("junction target should not be deleted",Files.exists(targetDir));
  assertTrue("junction target contents should not be deleted",Files.exists(targetContents));
  assertFalse("could not delete target",Files.exists(toDelete));
}
