@Test @Issue("JENKINS-9104") public void considersKillingVetosOnSlave() throws Exception {
  assumeTrue(ProcessTree.get() != ProcessTree.DEFAULT);
  ProcessBuilder pb=new ProcessBuilder();
  pb.environment().put("cookie","testKeepDaemonsAlive");
  if (File.pathSeparatorChar == ';') {
    pb.command("cmd");
  }
 else {
    pb.command("sleep","5m");
  }
  Slave s=j.createSlave();
  s.toComputer().connect(false).get();
  process=pb.start();
  StringWriter out=new StringWriter();
  s.createLauncher(new StreamTaskListener(out)).kill(ImmutableMap.of("cookie","testKeepDaemonsAlive"));
  try {
    process.exitValue();
    fail("Process should have been excluded from the killing");
  }
 catch (  IllegalThreadStateException e) {
  }
}
