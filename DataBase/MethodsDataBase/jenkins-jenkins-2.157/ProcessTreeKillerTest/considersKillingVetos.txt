@Test @Issue("JENKINS-9104") public void considersKillingVetos() throws Exception {
  assumeTrue(ProcessTree.get() != ProcessTree.DEFAULT);
  ProcessBuilder pb=new ProcessBuilder();
  pb.environment().put("cookie","testKeepDaemonsAlive");
  if (File.pathSeparatorChar == ';') {
    pb.command("cmd");
  }
 else {
    pb.command("sleep","5m");
  }
  process=pb.start();
  ProcessTree processTree=ProcessTree.get();
  processTree.killAll(ImmutableMap.of("cookie","testKeepDaemonsAlive"));
  try {
    process.exitValue();
    fail("Process should have been excluded from the killing");
  }
 catch (  IllegalThreadStateException e) {
  }
}
