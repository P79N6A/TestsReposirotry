@Test @Issue("SECURITY-904") public void isDescendant_worksEvenInSymbolicWorkspace() throws Exception {
  FilePath rootFolder=new FilePath(temp.newFolder("root"));
  FilePath wFolder=rootFolder.child("w");
  FilePath workspaceFolder=rootFolder.child("workspace");
  FilePath aFolder=workspaceFolder.child("a");
  FilePath bFolder=workspaceFolder.child("b");
  FilePath protectedFolder=rootFolder.child("protected");
  FilePath regularFile=workspaceFolder.child("regular.txt");
  regularFile.write("regular-file",StandardCharsets.UTF_8.name());
  FilePath aFile=aFolder.child("a.txt");
  aFile.write("a-file",StandardCharsets.UTF_8.name());
  FilePath bFile=bFolder.child("a.txt");
  bFile.write("b-file",StandardCharsets.UTF_8.name());
  bFolder.child("_a").symlinkTo("../a",null);
  bFolder.child("_atxt").symlinkTo("../a/a.txt",null);
  workspaceFolder.child("_protected").symlinkTo("../protected",null);
  workspaceFolder.child("_protected2").symlinkTo("../../protected",null);
  workspaceFolder.child("_nonexistent").symlinkTo("nonexistent",null);
  workspaceFolder.child("_nonexistentUp").symlinkTo("../nonexistent",null);
  workspaceFolder.child("_secrettxt").symlinkTo("../protected/secret.txt",null);
  workspaceFolder.child("_secrettxt2").symlinkTo("../../protected/secret.txt",null);
  wFolder.mkdirs();
  FilePath symbolicWorkspace=wFolder.child("_w");
  symbolicWorkspace.symlinkTo("../workspace",null);
  FilePath secretFile=protectedFolder.child("secret.txt");
  secretFile.write("secrets",StandardCharsets.UTF_8.name());
  assertTrue(symbolicWorkspace.isDescendant("regular.txt"));
  assertTrue(symbolicWorkspace.isDescendant("_nonexistent"));
  assertTrue(symbolicWorkspace.isDescendant("a"));
  assertTrue(symbolicWorkspace.isDescendant("a/a.txt"));
  assertTrue(symbolicWorkspace.isDescendant("b"));
  assertTrue(symbolicWorkspace.isDescendant("b/_a/a.txt"));
  assertTrue(symbolicWorkspace.isDescendant("b/_atxt"));
  assertFalse(symbolicWorkspace.isDescendant("_nonexistentUp"));
  assertFalse(symbolicWorkspace.isDescendant("_protected"));
  assertFalse(symbolicWorkspace.isDescendant("_protected/"));
  assertFalse(symbolicWorkspace.isDescendant("_protected/secret.txt"));
  assertFalse(symbolicWorkspace.isDescendant("./_protected/secret.txt"));
  assertFalse(symbolicWorkspace.isDescendant("_protected2"));
  assertFalse(symbolicWorkspace.isDescendant("_protected2/secret.txt"));
  assertFalse(symbolicWorkspace.isDescendant("_secrettxt"));
  assertFalse(symbolicWorkspace.isDescendant("./_secrettxt"));
  assertFalse(symbolicWorkspace.isDescendant("_secrettxt2"));
}
