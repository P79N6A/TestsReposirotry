@Test public void testOfflineCause() throws Exception {
  Node node=j.createOnlineSlave();
  Computer computer=node.toComputer();
  OfflineCause.UserCause cause;
  final User someone=User.get("someone@somewhere.com");
  ACL.impersonate(someone.impersonate());
  computer.doToggleOffline("original message");
  cause=(UserCause)computer.getOfflineCause();
  assertTrue(cause.toString(),cause.toString().matches("^.*?Disconnected by someone@somewhere.com : original message"));
  assertEquals(someone,cause.getUser());
  final User root=User.get("root@localhost");
  ACL.impersonate(root.impersonate());
  computer.doChangeOfflineCause("new message");
  cause=(UserCause)computer.getOfflineCause();
  assertTrue(cause.toString(),cause.toString().matches("^.*?Disconnected by root@localhost : new message"));
  assertEquals(root,cause.getUser());
  computer.doToggleOffline(null);
  assertNull(computer.getOfflineCause());
}
