@Test public void testOfflineCauseAsAnonymous() throws Exception {
  Node node=j.createOnlineSlave();
  final Computer computer=node.toComputer();
  OfflineCause.UserCause cause;
  try (ACLContext ctxt=ACL.as(Jenkins.ANONYMOUS)){
    computer.doToggleOffline("original message");
  }
   cause=(UserCause)computer.getOfflineCause();
  assertThat(cause.toString(),endsWith("Disconnected by anonymous : original message"));
  assertEquals(User.getUnknown(),cause.getUser());
  final User root=User.get("root@localhost");
  try (ACLContext ctxt=ACL.as(root.impersonate())){
    computer.doChangeOfflineCause("new message");
  }
   cause=(UserCause)computer.getOfflineCause();
  assertThat(cause.toString(),endsWith("Disconnected by root@localhost : new message"));
  assertEquals(root,cause.getUser());
  computer.doToggleOffline(null);
  assertNull(computer.getOfflineCause());
}
