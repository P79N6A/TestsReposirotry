@Test public void testAuthHeaderCaseInSensitive() throws Exception {
  ApiTokenTestHelper.enableLegacyBehavior();
  j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
  User foo=User.get("foo");
  wc=j.createWebClient();
  String[] basicCandidates={"Basic","BASIC","basic","bASIC"};
  for (  String prefix : basicCandidates) {
    ApiTokenProperty t=foo.getProperty(ApiTokenProperty.class);
    final String token=t.getApiToken();
    String authCode1=encode(prefix,"foo:" + token);
    makeRequestWithAuthCodeAndVerify(authCode1,"foo");
    spySecurityListener.authenticatedCalls.assertLastEventIsAndThenRemoveIt(u -> u.getUsername().equals("foo"));
    String authCode2=encode(prefix,"foo:abcd" + token);
    makeRequestWithAuthCodeAndFail(authCode2);
    spySecurityListener.failedToAuthenticateCalls.assertLastEventIsAndThenRemoveIt("foo");
    String authCode3=encode(prefix,"foo:foo");
    makeRequestWithAuthCodeAndVerify(authCode3,"foo");
    spySecurityListener.authenticatedCalls.assertLastEventIsAndThenRemoveIt(u -> u.getUsername().equals("foo"));
    String authCode4=encode(prefix,"foo:bar");
    makeRequestWithAuthCodeAndFail(authCode4);
    spySecurityListener.failedToAuthenticateCalls.assertLastEventIsAndThenRemoveIt("foo");
  }
}
