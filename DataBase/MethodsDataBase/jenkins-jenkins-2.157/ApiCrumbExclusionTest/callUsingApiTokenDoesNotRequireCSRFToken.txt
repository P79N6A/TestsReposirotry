@Test @Issue("JENKINS-22474") public void callUsingApiTokenDoesNotRequireCSRFToken() throws Exception {
  ApiTokenTestHelper.enableLegacyBehavior();
  j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
  j.jenkins.setCrumbIssuer(null);
  User foo=User.get("foo");
  wc=j.createWebClient();
  wc.withBasicApiToken(foo);
  makeRequestAndVerify("foo");
  wc=j.createWebClient();
  wc.withBasicCredentials("foo");
  makeRequestAndVerify("foo");
  wc=j.createWebClient();
  wc.login("foo");
  checkWeCanChangeMyDescription(200);
  wc=j.createWebClient();
  j.jenkins.setCrumbIssuer(new DefaultCrumbIssuer(false));
  wc.withBasicApiToken(foo);
  makeRequestAndVerify("foo");
  wc=j.createWebClient();
  wc.withBasicCredentials("foo");
  makeRequestAndFail(403);
  wc=j.createWebClient();
  wc.login("foo");
  checkWeCanChangeMyDescription(200);
}
