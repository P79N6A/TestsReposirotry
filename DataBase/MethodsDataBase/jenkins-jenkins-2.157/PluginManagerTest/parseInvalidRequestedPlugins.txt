@Issue("SECURITY-167") @Test public void parseInvalidRequestedPlugins() throws Exception {
  String evilXML="<?xml version='1.0' encoding='UTF-8'?>\n" + "<!DOCTYPE project[<!ENTITY foo SYSTEM \"file:///\">]>\n" + "<root>\n"+ "  <stuff plugin='stuff@1.0'>\n"+ "&foo;"+ "    <more plugin='other@2.0'>\n"+ "      <things plugin='stuff@1.2'/>\n"+ "    </more>\n"+ "  </stuff>\n"+ "</root>\n";
  PluginManager pluginManager=new LocalPluginManager(Util.createTempDir());
  try {
    pluginManager.parseRequestedPlugins(new StringInputStream(evilXML));
    fail("XML contains an external entity, but no exception was thrown.");
  }
 catch (  IOException ex) {
    assertThat(ex.getCause(),instanceOf(SAXException.class));
    assertThat(ex.getCause().getMessage(),containsString("Refusing to resolve entity with publicId(null) and systemId (file:///)"));
  }
}
