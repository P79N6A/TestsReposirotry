@Test public void prevalidateConfig() throws Exception {
  assumeFalse("TODO: Implement this test on Windows",Functions.isWindows());
  PersistedList<UpdateSite> sites=r.jenkins.getUpdateCenter().getSites();
  sites.clear();
  URL url=PluginManagerTest.class.getResource("/plugins/tasks-update-center.json");
  UpdateSite site=new UpdateSite(UpdateCenter.ID_DEFAULT,url.toString());
  sites.add(site);
  assertEquals(FormValidation.ok(),site.updateDirectly(false).get());
  assertNotNull(site.getData());
  assertEquals(Collections.emptyList(),r.jenkins.getPluginManager().prevalidateConfig(new StringInputStream("<whatever><runant plugin=\"ant@1.1\"/></whatever>")));
  assertNull(r.jenkins.getPluginManager().getPlugin("tasks"));
  List<Future<UpdateCenterJob>> jobs=r.jenkins.getPluginManager().prevalidateConfig(new StringInputStream("<whatever><tasks plugin=\"tasks@2.23\"/></whatever>"));
  assertEquals(1,jobs.size());
  UpdateCenterJob job=jobs.get(0).get();
  assertEquals("InstallationJob",job.getType());
  UpdateCenter.InstallationJob ijob=(UpdateCenter.InstallationJob)job;
  assertEquals("tasks",ijob.plugin.name);
  assertNotNull(r.jenkins.getPluginManager().getPlugin("tasks"));
}
