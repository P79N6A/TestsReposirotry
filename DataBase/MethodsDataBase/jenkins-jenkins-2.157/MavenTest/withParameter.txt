@Test public void withParameter() throws Exception {
  MavenInstallation maven=ToolInstallations.configureDefaultMaven();
  String mavenHome=maven.getHome();
  String mavenHomeVar="${VAR_MAVEN}" + mavenHome.substring(3);
  String mavenVar=mavenHome.substring(0,3);
  MavenInstallation varMaven=new MavenInstallation("varMaven",mavenHomeVar,JenkinsRule.NO_PROPERTIES);
  j.jenkins.getDescriptorByType(Maven.DescriptorImpl.class).setInstallations(maven,varMaven);
  JDK jdk=j.jenkins.getJDK("default");
  String javaHome=jdk.getHome();
  String javaHomeVar="${VAR_JAVA}" + javaHome.substring(3);
  String javaVar=javaHome.substring(0,3);
  JDK varJDK=new JDK("varJDK",javaHomeVar);
  j.jenkins.getJDKs().add(varJDK);
  FreeStyleProject project=j.createFreeStyleProject();
  project.addProperty(new ParametersDefinitionProperty(new StringParameterDefinition("VAR_MAVEN","XXX"),new StringParameterDefinition("VAR_JAVA","XXX")));
  project.getBuildersList().add(new Maven("--help",varMaven.getName()));
  project.setJDK(varJDK);
  FreeStyleBuild build=project.scheduleBuild2(0,new LegacyCodeCause(),new ParametersAction(new StringParameterValue("VAR_MAVEN",mavenVar),new StringParameterValue("VAR_JAVA",javaVar))).get();
  j.assertBuildStatusSuccess(build);
}
