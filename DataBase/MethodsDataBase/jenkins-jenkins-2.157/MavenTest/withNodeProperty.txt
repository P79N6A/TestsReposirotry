@Test public void withNodeProperty() throws Exception {
  MavenInstallation maven=ToolInstallations.configureDefaultMaven();
  String mavenHome=maven.getHome();
  String mavenHomeVar="${VAR_MAVEN}" + mavenHome.substring(3);
  String mavenVar=mavenHome.substring(0,3);
  MavenInstallation varMaven=new MavenInstallation("varMaven",mavenHomeVar,JenkinsRule.NO_PROPERTIES);
  j.jenkins.getDescriptorByType(Maven.DescriptorImpl.class).setInstallations(maven,varMaven);
  JDK jdk=j.jenkins.getJDK("default");
  String javaHome=jdk.getHome();
  String javaHomeVar="${VAR_JAVA}" + javaHome.substring(3);
  String javaVar=javaHome.substring(0,3);
  JDK varJDK=new JDK("varJDK",javaHomeVar);
  j.jenkins.getJDKs().add(varJDK);
  j.jenkins.getNodeProperties().replaceBy(Collections.singleton(new EnvironmentVariablesNodeProperty(new Entry("VAR_MAVEN",mavenVar),new Entry("VAR_JAVA",javaVar))));
  FreeStyleProject project=j.createFreeStyleProject();
  project.getBuildersList().add(new Maven("--help",varMaven.getName()));
  project.setJDK(varJDK);
  Build<?,?> build=project.scheduleBuild2(0).get();
  assertEquals(Result.SUCCESS,build.getResult());
}
