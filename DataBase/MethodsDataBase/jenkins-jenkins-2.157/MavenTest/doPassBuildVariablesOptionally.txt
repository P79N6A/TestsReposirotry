@Test public void doPassBuildVariablesOptionally() throws Exception {
  MavenInstallation maven=ToolInstallations.configureMaven3();
  FreeStyleProject p=j.createFreeStyleProject();
  p.updateByXml((Source)new StreamSource(getClass().getResourceAsStream("MavenTest/doPassBuildVariablesOptionally.xml")));
  String log=j.buildAndAssertSuccess(p).getLog();
  assertTrue("Build variables injection should be enabled by default when loading from XML",p.getBuildersList().get(Maven.class).isInjectBuildVariables());
  assertTrue("Build variables should be injected by default when loading from XML",log.contains("-DNAME=VALUE"));
  p.getBuildersList().clear();
  p.getBuildersList().add(new Maven("--help",maven.getName(),null,null,null,false,null,null,false));
  log=j.buildAndAssertSuccess(p).getLog();
  assertFalse("Build variables should not be injected",log.contains("-DNAME=VALUE"));
  p.getBuildersList().clear();
  p.getBuildersList().add(new Maven("--help",maven.getName(),null,null,null,false,null,null,true));
  log=j.buildAndAssertSuccess(p).getLog();
  assertTrue("Build variables should be injected",log.contains("-DNAME=VALUE"));
  assertFalse("Build variables injection should be disabled by default",new Maven("","").isInjectBuildVariables());
}
