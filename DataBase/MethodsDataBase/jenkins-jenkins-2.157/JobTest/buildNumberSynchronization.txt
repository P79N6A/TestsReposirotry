@Test public void buildNumberSynchronization() throws Exception {
  AbstractProject project=j.createFreeStyleProject();
  CountDownLatch startLatch=new CountDownLatch(1);
  CountDownLatch stopLatch=new CountDownLatch(2);
  BuildNumberSyncTester test1=new BuildNumberSyncTester(project,startLatch,stopLatch,true);
  BuildNumberSyncTester test2=new BuildNumberSyncTester(project,startLatch,stopLatch,false);
  new Thread(test1).start();
  new Thread(test2).start();
  startLatch.countDown();
  stopLatch.await();
  assertTrue(test1.message,test2.passed);
  assertTrue(test2.message,test2.passed);
}
