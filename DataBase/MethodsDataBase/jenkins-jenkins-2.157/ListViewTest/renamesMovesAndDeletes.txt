@Issue("JENKINS-18680") @Test public void renamesMovesAndDeletes() throws Exception {
  MockFolder top=j.createFolder("top");
  MockFolder sub=top.createProject(MockFolder.class,"sub");
  FreeStyleProject p1=top.createProject(FreeStyleProject.class,"p1");
  FreeStyleProject p2=sub.createProject(FreeStyleProject.class,"p2");
  FreeStyleProject p3=top.createProject(FreeStyleProject.class,"p3");
  ListView v=new ListView("v");
  v.setRecurse(true);
  top.addView(v);
  v.add(p1);
  v.add(p2);
  v.add(p3);
  assertEquals(new HashSet<TopLevelItem>(Arrays.asList(p1,p2,p3)),new HashSet<TopLevelItem>(v.getItems()));
  sub.renameTo("lower");
  MockFolder stuff=top.createProject(MockFolder.class,"stuff");
  Items.move(p1,stuff);
  p3.delete();
  top.createProject(FreeStyleProject.class,"p3");
  assertEquals(new HashSet<TopLevelItem>(Arrays.asList(p1,p2)),new HashSet<TopLevelItem>(v.getItems()));
  top.renameTo("upper");
  assertEquals(new HashSet<TopLevelItem>(Arrays.asList(p1,p2)),new HashSet<TopLevelItem>(v.getItems()));
}
