@Test public void testSubmission() throws Exception {
  j.jenkins.setNoUsageStatistics(false);
  assertEquals("no requests received",0,counter);
  ExtensionList.lookupSingleton(Telemetry.TelemetryReporter.class).doRun();
  do {
    Thread.sleep(250);
  }
 while (counter == 0);
  assertThat(logger.getMessages(),hasItem("Telemetry submission received response '200 OK' for: test-data"));
  assertThat(logger.getMessages(),hasItem("Skipping telemetry for 'future' as it is configured to start later"));
  assertThat(logger.getMessages(),hasItem("Skipping telemetry for 'past' as it is configured to end in the past"));
  assertThat(logger.getMessages(),hasItem("Skipping telemetry for 'empty' as it has no data"));
  assertThat(types,hasItem("test-data"));
  assertThat(types,not(hasItem("future")));
  assertThat(types,not(hasItem("past")));
  assertThat(correlators.size(),is(counter));
  assertTrue(Pattern.compile("[0-9a-f]+").matcher(correlators.first()).matches());
  assertThat(types,not(hasItem("empty")));
  assertTrue("at least one request received",counter > 0);
}
