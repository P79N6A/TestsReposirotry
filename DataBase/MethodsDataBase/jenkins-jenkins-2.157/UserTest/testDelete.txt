@Test public void testDelete() throws Exception {
{
    User user=User.get("John Smith",true,Collections.emptyMap());
    user.save();
    File configFolder=user.getUserFolder();
    user.delete();
    assertFalse("User should be deleted with his persistent data.",configFolder.exists());
    assertFalse("User should be deleted from memory.",User.getAll().contains(user));
    user=User.get("John Smith",false,Collections.emptyMap());
    assertNull("User should be deleted from memory.",user);
  }
  j.jenkins.reload();
{
    boolean contained=false;
    for (    User u : User.getAll()) {
      if (u.getId().equals("John Smith")) {
        contained=true;
        break;
      }
    }
    assertFalse("User should not be loaded.",contained);
  }
}
