@Issue("SECURITY-200") @Test public void adminsShouldBeUnableToChangeTokensByDefault() throws Exception {
  j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
  User foo=User.get("foo");
  User bar=User.get("bar");
  final ApiTokenProperty t=foo.getProperty(ApiTokenProperty.class);
  final ApiTokenProperty.DescriptorImpl descriptor=(ApiTokenProperty.DescriptorImpl)t.getDescriptor();
  WebClient wc=createClientForUser("bar");
  wc.getOptions().setThrowExceptionOnFailingStatusCode(false);
  HtmlPage requirePOST=wc.goTo(foo.getUrl() + "/" + descriptor.getDescriptorUrl()+ "/changeToken");
  assertEquals("method should not be allowed",405,requirePOST.getWebResponse().getStatusCode());
  wc.getOptions().setThrowExceptionOnFailingStatusCode(true);
  WebRequest request=new WebRequest(new URL(j.getURL().toString() + foo.getUrl() + "/"+ descriptor.getDescriptorUrl()+ "/changeToken"),HttpMethod.POST);
  HtmlPage res=wc.getPage(request);
  assertEquals("Update token response is incorrect",Messages.ApiTokenProperty_ChangeToken_SuccessHidden(),"<div>" + res.getBody().asText() + "</div>");
}
