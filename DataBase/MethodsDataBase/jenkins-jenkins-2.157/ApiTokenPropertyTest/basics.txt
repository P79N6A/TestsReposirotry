/** 
 * Tests the UI interaction and authentication.
 */
@Test public void basics() throws Exception {
  j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
  User u=User.getById("foo",true);
  final ApiTokenProperty t=u.getProperty(ApiTokenProperty.class);
  final String token=t.getApiToken();
  try (ACLContext acl=ACL.as(u)){
    assertEquals("User is unable to get its own token",token,t.getApiToken());
  }
   WebClient wc=createClientForUser("foo");
  assertEquals(u,wc.executeOnServer(new Callable<User>(){
    public User call() throws Exception {
      return User.current();
    }
  }
));
  HtmlPage config=wc.goTo(u.getUrl() + "/configure");
  HtmlForm form=config.getFormByName("config");
  assertEquals(token,form.getInputByName("_.apiToken").getValueAttribute());
  j.submit(form);
  assertSame(t,u.getProperty(ApiTokenProperty.class));
}
