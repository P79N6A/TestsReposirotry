@Issue("SECURITY-786") @Test public void controlCharacterAreNoMoreValid_CustomRegex() throws Exception {
  HudsonPrivateSecurityRealm securityRealm=new HudsonPrivateSecurityRealm(true,false,null);
  j.jenkins.setSecurityRealm(securityRealm);
  String currentRegex="^[A-Z]+[0-9]*$";
  Field field=HudsonPrivateSecurityRealm.class.getDeclaredField("ID_REGEX");
  field.setAccessible(true);
  field.set(null,currentRegex);
  String password="testPwd";
  String email="test@test.com";
  int i=0;
  checkUserCanBeCreatedWith(securityRealm,"TEST" + i,password,"Test" + i,email);
  assertNotNull(User.getById("TEST" + i,false));
  i++;
  checkUserCanBeCreatedWith(securityRealm,"TEST123" + i,password,"Test" + i,email);
  assertNotNull(User.getById("TEST123" + i,false));
  i++;
{
    checkUserCannotBeCreatedWith_custom(securityRealm,"test " + i,password,"Test" + i,email,currentRegex);
    i++;
    checkUserCannotBeCreatedWith_custom(securityRealm,"@" + i,password,"Test" + i,email,currentRegex);
    i++;
    checkUserCannotBeCreatedWith_custom(securityRealm,"T2A" + i,password,"Test" + i,email,currentRegex);
    i++;
  }
{
    currentRegex="^[0-9]*$";
    field.set(null,currentRegex);
    checkUserCanBeCreatedWith(securityRealm,"125213" + i,password,"Test" + i,email);
    assertNotNull(User.getById("125213" + i,false));
    i++;
    checkUserCannotBeCreatedWith_custom(securityRealm,"TEST12" + i,password,"Test" + i,email,currentRegex);
    i++;
  }
}
