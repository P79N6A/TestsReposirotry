@Issue("SECURITY-243") @Test public void fullNameCollisionToken() throws Exception {
  ApiTokenTestHelper.enableLegacyBehavior();
  HudsonPrivateSecurityRealm securityRealm=new HudsonPrivateSecurityRealm(false,false,null);
  j.jenkins.setSecurityRealm(securityRealm);
  User u1=securityRealm.createAccount("user1","password1");
  u1.setFullName("User One");
  u1.save();
  String u1Token=u1.getProperty(ApiTokenProperty.class).getApiToken();
  User u2=securityRealm.createAccount("user2","password2");
  u2.setFullName("User Two");
  u2.save();
  String u2Token=u2.getProperty(ApiTokenProperty.class).getApiToken();
  WebClient wc1=j.createWebClient();
  wc1.addRequestHeader("Authorization",basicHeader("user1",u1Token));
  WebClient wc2=j.createWebClient();
  wc2.addRequestHeader("Authorization",basicHeader("user2",u2Token));
  XmlPage w1=(XmlPage)wc1.goTo("whoAmI/api/xml","application/xml");
  assertThat(w1,hasXPath("//name",is("user1")));
  XmlPage w2=(XmlPage)wc2.goTo("whoAmI/api/xml","application/xml");
  assertThat(w2,hasXPath("//name",is("user2")));
  u1.setFullName("user2");
  u1.save();
  w1=(XmlPage)wc1.goTo("whoAmI/api/xml","application/xml");
  assertThat(w1,hasXPath("//name",is("user1")));
  w2=(XmlPage)wc2.goTo("whoAmI/api/xml","application/xml");
  assertThat(w2,hasXPath("//name",is("user2")));
}
