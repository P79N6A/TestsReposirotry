@Ignore("TODO calling restart seems to break Surefire") @Issue("JENKINS-50164") @LocalData @Test public void fromPreviousCustomSetup(){
  assumeFalse("Default Windows lifecycle does not support restart.",Functions.isWindows());
  final String newBuildsDirValueBySysprop="/tmp/${ITEM_ROOTDIR}/bluh";
  story.then(j -> {
    assertEquals("${ITEM_ROOTDIR}/ze-previous-custom-builds",j.jenkins.getRawBuildsDir());
    setBuildsDirProperty(newBuildsDirValueBySysprop);
  }
);
  story.then(j -> {
    assertEquals(newBuildsDirValueBySysprop,j.jenkins.getRawBuildsDir());
    assertThat(FileUtils.readFileToString(new File(j.jenkins.getRootDir(),"config.xml")),containsString("<buildsDir>" + newBuildsDirValueBySysprop + "</buildsDir>"));
    String rootDirBeforeRestart=j.jenkins.getRootDir().toString();
    clearSystemProperties();
    j.jenkins.restart();
    int maxLoops=50;
    while (j.jenkins.getInitLevel() != InitMilestone.COMPLETED && maxLoops-- > 0) {
      Thread.sleep(300);
    }
    assertEquals(rootDirBeforeRestart,j.jenkins.getRootDir().toString());
    assertThat(FileUtils.readFileToString(new File(j.jenkins.getRootDir(),"config.xml")),containsString("<buildsDir>" + newBuildsDirValueBySysprop + "</buildsDir>"));
    assertEquals(newBuildsDirValueBySysprop,j.jenkins.getRawBuildsDir());
  }
);
}
