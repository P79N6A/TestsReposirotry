@Test @Issue("JENKINS-17137") public void externalBuildDirectorySymlinks() throws Exception {
  assumeFalse(Functions.isWindows());
  final List<String> builds=new ArrayList<>();
  story.then(steps -> {
    builds.add(story.j.createTmpDir().toString());
    setBuildsDirProperty(builds.get(0) + "/${ITEM_FULL_NAME}");
  }
);
  story.then(steps -> {
    assertEquals(builds.get(0) + "/${ITEM_FULL_NAME}",story.j.jenkins.getRawBuildsDir());
    FreeStyleProject p=story.j.jenkins.createProject(MockFolder.class,"d").createProject(FreeStyleProject.class,"p");
    FreeStyleBuild b1=p.scheduleBuild2(0).get();
    File link=new File(p.getRootDir(),"lastStable");
    assertTrue(link.exists());
    assertEquals(resolveAll(link).getAbsolutePath(),b1.getRootDir().getAbsolutePath());
    FreeStyleBuild b2=p.scheduleBuild2(0).get();
    assertTrue(link.exists());
    assertEquals(resolveAll(link).getAbsolutePath(),b2.getRootDir().getAbsolutePath());
    b2.delete();
    assertTrue(link.exists());
    assertEquals(resolveAll(link).getAbsolutePath(),b1.getRootDir().getAbsolutePath());
    b1.delete();
    assertFalse(link.exists());
  }
);
}
