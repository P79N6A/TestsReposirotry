@Issue("SECURITY-385") @Test public void testInaccessibleViews() throws IOException {
  j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
  GlobalMatrixAuthorizationStrategy strategy=new GlobalMatrixAuthorizationStrategy();
  strategy.add(Jenkins.READ,"alice");
  j.jenkins.setAuthorizationStrategy(strategy);
  j.jenkins.addView(new ListView("foo",j.jenkins));
  assertEquals("two views exist",2,Jenkins.getInstance().getViews().size());
  List<SearchItem> results=new ArrayList<>();
  j.jenkins.getSearchIndex().suggest("foo",results);
  assertEquals("nonempty results list",1,results.size());
  assertFalse("no permission",j.jenkins.getView("foo").hasPermission(User.get("alice").impersonate(),View.READ));
  ACL.impersonate(User.get("alice").impersonate(),new Runnable(){
    @Override public void run(){
      assertEquals("no visible views",0,Jenkins.getInstance().getViews().size());
      List<SearchItem> results=new ArrayList<>();
      j.jenkins.getSearchIndex().suggest("foo",results);
      assertEquals("empty results list",Collections.emptyList(),results);
    }
  }
);
}
