/** 
 * A common non-admin user should not be able to see references to a deleted job even if he used to have READ permissions before the deletion.
 * @throws Exception Test error
 */
@Test @Issue("SECURITY-153") public void commonUserShouldBeUnableToSeeReferencesOfDeletedJobs() throws Exception {
  FreeStyleProject project=createAndRunProjectWithPublisher("project","test.txt");
  FreeStyleBuild build=project.getLastBuild();
  final Fingerprint fp=getFingerprint(build,"test.txt");
  User user1=User.get("user1");
  setupProjectMatrixAuthStrategy(Jenkins.READ,Item.READ,Item.DISCOVER);
  project.delete();
  try (ACLContext acl=ACL.as(user1)){
    assertThat("user1 should be unable to see the origin",fp.getOriginal(),nullValue());
    assertEquals("No jobs should be visible to user1",0,fp._getUsages().size());
  }
 }
