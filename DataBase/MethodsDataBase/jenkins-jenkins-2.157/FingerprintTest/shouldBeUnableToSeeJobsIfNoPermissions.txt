@Test @Issue("SECURITY-153") public void shouldBeUnableToSeeJobsIfNoPermissions() throws Exception {
  final FreeStyleProject project1=createAndRunProjectWithPublisher("fpProducer","test.txt");
  final FreeStyleBuild build=project1.getLastBuild();
  final FreeStyleProject project2=rule.createFreeStyleProject("project2");
  project2.getBuildersList().add(new WorkspaceCopyFileBuilder("test.txt",project1.getName(),build.getNumber()));
  project2.getPublishersList().add(new Fingerprinter("test.txt"));
  final FreeStyleBuild build2=rule.buildAndAssertSuccess(project2);
  final Fingerprint fp=getFingerprint(build,"test.txt");
  User user1=User.get("user1");
  User user2=User.get("user2");
  User user3=User.get("user3");
  setupProjectMatrixAuthStrategy(Jenkins.READ);
  setJobPermissionsOnce(project1,"user1",Item.READ,Item.DISCOVER);
  setJobPermissionsOnce(project2,"user2",Item.READ,Item.DISCOVER);
  try (ACLContext acl=ACL.as(user1)){
    Fingerprint.BuildPtr original=fp.getOriginal();
    assertThat("user1 should be able to see the origin",fp.getOriginal(),notNullValue());
    assertEquals("user1 should be able to see the origin's project name",project1.getName(),original.getName());
    assertEquals("user1 should be able to see the origin's build number",build.getNumber(),original.getNumber());
    assertEquals("Only one usage should be visible to user1",1,fp._getUsages().size());
    assertEquals("Only project1 should be visible to user1",project1.getFullName(),fp._getUsages().get(0).name);
  }
   try (ACLContext acl=ACL.as(user2)){
    assertThat("user2 should be unable to see the origin",fp.getOriginal(),nullValue());
    assertEquals("Only one usage should be visible to user2",1,fp._getUsages().size());
    assertEquals("Only project2 should be visible to user2",project2.getFullName(),fp._getUsages().get(0).name);
  }
   try (ACLContext acl=ACL.as(user3)){
    Fingerprint.BuildPtr original=fp.getOriginal();
    assertThat("user3 should be unable to see the origin",fp.getOriginal(),nullValue());
    assertEquals("All usages should be invisible for user3",0,fp._getUsages().size());
  }
 }
