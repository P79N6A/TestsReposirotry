@Test public void consoleShouldSuccessWithLastNLines() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject("aProject");
  if (Functions.isWindows()) {
    project.getBuildersList().add(new BatchFile("echo 1\r\necho 2\r\necho 3\r\necho 4\r\necho 5"));
  }
 else {
    project.getBuildersList().add(new Shell("echo 1\necho 2\necho 3\necho 4\necho 5"));
  }
  project.scheduleBuild2(0).get();
  assertThat(project.getBuildByNumber(1).getLog(),containsString("echo 1"));
  assertThat(project.getBuildByNumber(1).getLog(),containsString("echo 5"));
  final CLICommandInvoker.Result result=command.authorizedTo(Jenkins.READ,Job.READ,Item.BUILD).invokeWithArgs("aProject","1","-n",Functions.isWindows() ? "5" : "4");
  assertThat(result,succeeded());
  assertThat(result.stdout(),not(containsString("echo 1")));
  assertThat(result.stdout(),containsString("echo 5"));
}
