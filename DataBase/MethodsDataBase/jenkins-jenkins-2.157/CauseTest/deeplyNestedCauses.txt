@Issue("JENKINS-14814") @Test public void deeplyNestedCauses() throws Exception {
  FreeStyleProject a=j.createFreeStyleProject("a");
  FreeStyleProject b=j.createFreeStyleProject("b");
  Run<?,?> early=null;
  Run<?,?> last=null;
  for (int i=1; i <= 15; i++) {
    last=b.scheduleBuild2(0,new Cause.UpstreamCause((Run<?,?>)a.scheduleBuild2(0,last == null ? null : new Cause.UpstreamCause(last)).get())).get();
    if (i == 5) {
      early=last;
    }
  }
  String buildXml=new XmlFile(Run.XSTREAM,new File(early.getRootDir(),"build.xml")).asString();
  assertTrue("keeps full history:\n" + buildXml,buildXml.contains("<upstreamBuild>1</upstreamBuild>"));
  buildXml=new XmlFile(Run.XSTREAM,new File(last.getRootDir(),"build.xml")).asString();
  assertFalse("too big:\n" + buildXml,buildXml.contains("<upstreamBuild>1</upstreamBuild>"));
}
