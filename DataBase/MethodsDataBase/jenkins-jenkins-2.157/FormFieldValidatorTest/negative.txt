/** 
 * Make sure that the validation methods are really called by testing a negative case.
 */
@Test @Issue("JENKINS-3382") public void negative() throws Exception {
  DescriptorImpl d=new DescriptorImpl();
  Publisher.all().add(d);
  try {
    FreeStyleProject p=j.createFreeStyleProject();
    p.getPublishersList().add(new BrokenFormValidatorBuilder());
    JenkinsRule.WebClient webclient=j.createWebClient();
    WebResponseListener.StatusListener statusListener=new WebResponseListener.StatusListener(500);
    webclient.addWebResponseListener(statusListener);
    webclient.getPage(p,"configure");
    statusListener.assertHasResponses();
    String contentAsString=statusListener.getResponses().get(0).getContentAsString();
    Assert.assertTrue(contentAsString.contains("doCheckXyz is broken"));
  }
  finally {
    Publisher.all().remove(d);
  }
}
