/** 
 * Basic operation of the permalink generation.
 */
@Test public void basics() throws Exception {
  Assume.assumeFalse("can't run on windows because we rely on symlinks",Functions.isWindows());
  FreeStyleProject p=j.createFreeStyleProject();
  FreeStyleBuild b1=j.assertBuildStatusSuccess(p.scheduleBuild2(0));
  File lsb=new File(p.getBuildDir(),"lastSuccessfulBuild");
  File lfb=new File(p.getBuildDir(),"lastFailedBuild");
  assertLink(lsb,b1);
  p.getBuildersList().add(new FailureBuilder());
  FreeStyleBuild b2=p.scheduleBuild2(0).get();
  assertLink(lsb,b1);
  assertLink(lfb,b2);
  p.getBuildersList().clear();
  FreeStyleBuild b3=j.assertBuildStatusSuccess(p.scheduleBuild2(0));
  assertLink(lsb,b3);
  assertLink(lfb,b2);
  b3.delete();
  assertLink(lsb,b1);
  assertLink(lfb,b2);
  b1.delete();
  assertLink(lsb,null);
  assertLink(lfb,b2);
  b2.delete();
  assertLink(lsb,null);
  assertLink(lfb,null);
}
