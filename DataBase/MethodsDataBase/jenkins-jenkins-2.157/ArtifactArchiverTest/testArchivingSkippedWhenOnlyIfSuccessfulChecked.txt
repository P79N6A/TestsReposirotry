@Test @Issue("JENKINS-22698") public void testArchivingSkippedWhenOnlyIfSuccessfulChecked() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject();
  ArtifactArchiver aa=new ArtifactArchiver("f");
  project.getPublishersList().replaceBy(Collections.singleton(aa));
  project.getBuildersList().replaceBy(Collections.singleton(new CreateArtifactAndFail()));
  assertEquals(Result.FAILURE,build(project));
  assertTrue(project.getBuildByNumber(1).getHasArtifacts());
  aa.setOnlyIfSuccessful(true);
  assertEquals(Result.FAILURE,build(project));
  assertTrue(project.getBuildByNumber(1).getHasArtifacts());
  assertFalse(project.getBuildByNumber(2).getHasArtifacts());
}
