@Test @Issue("JENKINS-21905") public void archiveNotReadable() throws Exception {
  assumeFalse(Functions.isWindows());
  final String FILENAME="myfile";
  DumbSlave slave=j.createOnlineSlave(Label.get("target"));
  FreeStyleProject p=j.createFreeStyleProject();
  p.getBuildersList().add(new TestBuilder(){
    @Override public boolean perform(    AbstractBuild<?,?> build,    Launcher launcher,    BuildListener listener) throws InterruptedException, IOException {
      FilePath file=build.getWorkspace().child(FILENAME);
      file.act(new RemoveReadPermission());
      return true;
    }
  }
);
  p.getPublishersList().add(new ArtifactArchiver(FILENAME));
  p.setAssignedNode(slave);
  FreeStyleBuild build=p.scheduleBuild2(0).get();
  j.assertBuildStatus(Result.FAILURE,build);
  String expectedPath=build.getWorkspace().child(FILENAME).getRemote();
  j.assertLogContains("ERROR: Step ‘Archive the artifacts’ failed: java.nio.file.AccessDeniedException: " + expectedPath,build);
  assertThat("No stacktrace shown",build.getLog(31),Matchers.iterableWithSize(lessThan(30)));
}
