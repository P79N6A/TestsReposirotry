@Test @Issue("JENKINS-3227") public void testEmptyDirectories() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject();
  Publisher artifactArchiver=new ArtifactArchiver("dir/");
  project.getPublishersList().replaceBy(Collections.singleton(artifactArchiver));
  project.getBuildersList().replaceBy(Collections.singleton(new TestBuilder(){
    public boolean perform(    AbstractBuild<?,?> build,    Launcher launcher,    BuildListener listener) throws InterruptedException, IOException {
      FilePath dir=build.getWorkspace().child("dir");
      dir.child("subdir1").mkdirs();
      FilePath subdir2=dir.child("subdir2");
      subdir2.mkdirs();
      subdir2.child("file").write("content","UTF-8");
      return true;
    }
  }
));
  assertEquals(Result.SUCCESS,build(project));
  File artifacts=project.getBuildByNumber(1).getArtifactsDir();
  File[] kids=artifacts.listFiles();
  assertEquals(1,kids.length);
  assertEquals("dir",kids[0].getName());
  kids=kids[0].listFiles();
  assertEquals(1,kids.length);
  assertEquals("subdir2",kids[0].getName());
  kids=kids[0].listFiles();
  assertEquals(1,kids.length);
  assertEquals("file",kids[0].getName());
}
