@Test public void testDoCancelQueue() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject("project");
  GlobalMatrixAuthorizationStrategy auth=new GlobalMatrixAuthorizationStrategy();
  j.jenkins.setAuthorizationStrategy(auth);
  j.jenkins.setCrumbIssuer(null);
  HudsonPrivateSecurityRealm realm=new HudsonPrivateSecurityRealm(false);
  j.jenkins.setSecurityRealm(realm);
  User user=realm.createAccount("John Smith","password");
  try (ACLContext as=ACL.as(user)){
    project.doCancelQueue(null,null);
    fail("User should not have permission to build project");
  }
 catch (  Exception e) {
    if (!(e.getClass().isAssignableFrom(AccessDeniedException2.class))) {
      fail("AccessDeniedException should be thrown.");
    }
  }
}
