@Test @Issue("JENKINS-1986") public void buildSymlinks() throws Exception {
  Assume.assumeFalse("If we're on Windows, don't bother doing this",Functions.isWindows());
  FreeStyleProject job=j.createFreeStyleProject();
  job.getBuildersList().add(new Shell("echo \"Build #$BUILD_NUMBER\"\n"));
  FreeStyleBuild build=job.scheduleBuild2(0,new Cause.UserCause()).get();
  File lastSuccessful=new File(job.getRootDir(),"lastSuccessful"), lastStable=new File(job.getRootDir(),"lastStable");
  assertSymlinkForBuild(lastSuccessful,1);
  assertSymlinkForBuild(lastStable,1);
  FreeStyleBuild build2=job.scheduleBuild2(0,new Cause.UserCause()).get();
  assertSymlinkForBuild(lastSuccessful,2);
  assertSymlinkForBuild(lastStable,2);
  build2.delete();
  assertSymlinkForBuild(lastSuccessful,1);
  assertSymlinkForBuild(lastStable,1);
  build.delete();
  assertFalse("lastSuccessful link should be removed",lastSuccessful.exists());
  assertFalse("lastStable link should be removed",lastStable.exists());
}
