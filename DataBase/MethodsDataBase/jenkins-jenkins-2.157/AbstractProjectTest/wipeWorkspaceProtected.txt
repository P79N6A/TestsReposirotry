/** 
 * Makes sure that the workspace deletion is protected.
 */
@Test @PresetData(DataSet.NO_ANONYMOUS_READACCESS) public void wipeWorkspaceProtected() throws Exception {
  FreeStyleProject project=j.createFreeStyleProject();
  project.getBuildersList().add(Functions.isWindows() ? new BatchFile("echo hello") : new Shell("echo hello"));
  FreeStyleBuild b=project.scheduleBuild2(0).get();
  assert b.getWorkspace().exists() : "Workspace should exist by now";
  JenkinsRule.WebClient wc=j.createWebClient();
  try {
    wc.getPage(new WebRequest(new URL(wc.getContextPath() + project.getUrl() + "doWipeOutWorkspace"),HttpMethod.POST));
    fail("Expected HTTP status code 403");
  }
 catch (  FailingHttpStatusCodeException e) {
    assertEquals(HttpURLConnection.HTTP_FORBIDDEN,e.getStatusCode());
  }
}
