@Test @Issue("JENKINS-2543") public void symlinkForPostBuildFailure() throws Exception {
  Assume.assumeFalse("If we're on Windows, don't bother doing this",Functions.isWindows());
  FreeStyleProject job=j.createFreeStyleProject();
  job.getBuildersList().add(new Shell("echo \"Build #$BUILD_NUMBER\"\n"));
  FreeStyleBuild build=job.scheduleBuild2(0,new Cause.UserCause()).get();
  assert Result.SUCCESS == build.getResult();
  File lastSuccessful=new File(job.getRootDir(),"lastSuccessful"), lastStable=new File(job.getRootDir(),"lastStable");
  assertSymlinkForBuild(lastSuccessful,1);
  assertSymlinkForBuild(lastStable,1);
  job.getPublishersList().add(new ArtifactArchiver("*.foo","",false,false));
  build=job.scheduleBuild2(0,new Cause.UserCause()).get();
  assert Result.FAILURE == build.getResult();
  assertSymlinkForBuild(lastSuccessful,1);
  assertSymlinkForBuild(lastStable,1);
}
