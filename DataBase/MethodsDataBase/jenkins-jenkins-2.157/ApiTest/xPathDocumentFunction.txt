/** 
 * Test that calling the XML API with the XPath <code>document</code> function fails.
 * @throws Exception if so
 */
@Issue("SECURITY-165") @Test public void xPathDocumentFunction() throws Exception {
  File f=new File(j.jenkins.getRootDir(),"queue.xml");
  JenkinsRule.WebClient client=j.createWebClient();
  try {
    client.goTo("api/xml?xpath=document(\"" + f.getAbsolutePath() + "\")","application/xml");
    fail("Should become 500 error");
  }
 catch (  com.gargoylesoftware.htmlunit.FailingHttpStatusCodeException e) {
    String contentAsString=e.getResponse().getContentAsString();
    j.assertStringContains(contentAsString,"Illegal function: document");
  }
}
