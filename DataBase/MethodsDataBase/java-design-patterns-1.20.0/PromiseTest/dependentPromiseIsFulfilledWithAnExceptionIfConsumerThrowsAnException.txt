@Test public void dependentPromiseIsFulfilledWithAnExceptionIfConsumerThrowsAnException() throws InterruptedException, ExecutionException, TimeoutException {
  Promise<Void> dependentPromise=promise.fulfillInAsync(new NumberCrunchingTask(),executor).thenAccept(new Consumer<Integer>(){
    @Override public void accept(    Integer value){
      throw new RuntimeException("Barf!");
    }
  }
);
  try {
    dependentPromise.get();
    fail("Fetching dependent promise should result in exception " + "if the action threw an exception");
  }
 catch (  ExecutionException ex) {
    assertTrue(promise.isDone());
    assertFalse(promise.isCancelled());
  }
  try {
    dependentPromise.get(1000,TimeUnit.SECONDS);
    fail("Fetching dependent promise should result in exception " + "if the action threw an exception");
  }
 catch (  ExecutionException ex) {
    assertTrue(promise.isDone());
    assertFalse(promise.isCancelled());
  }
}
