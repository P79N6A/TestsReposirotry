@SuppressWarnings("unchecked") @Test public void exceptionHandlerIsCalledWhenPromiseIsFulfilledExceptionally(){
  Promise<Object> promise=new Promise<>();
  Consumer<Throwable> exceptionHandler=mock(Consumer.class);
  promise.onError(exceptionHandler);
  Exception exception=new Exception("barf!");
  promise.fulfillExceptionally(exception);
  verify(exceptionHandler).accept(eq(exception));
}
