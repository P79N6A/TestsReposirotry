@SuppressWarnings("unchecked") @Test public void testRetrySubscribesAgainAfterError() throws Exception {
  Consumer<Integer> record=mock(Consumer.class);
  InOrder inOrder=inOrder(record);
  Consumer<Integer> throwException=mock(Consumer.class);
  doThrow(new RuntimeException()).when(throwException).accept(Mockito.anyInt());
  PublishSubject<Integer> subject=PublishSubject.create();
  subject.doOnNext(record).doOnNext(throwException).retry().subscribe();
  inOrder.verifyNoMoreInteractions();
  subject.onNext(1);
  inOrder.verify(record).accept(1);
  subject.onNext(2);
  inOrder.verify(record).accept(2);
  subject.onNext(3);
  inOrder.verify(record).accept(3);
  inOrder.verifyNoMoreInteractions();
}
