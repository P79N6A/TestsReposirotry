/** 
 * Test unsubscribing the concatenated Flowable in a single thread.
 */
@Test public void testConcatUnsubscribe(){
  final CountDownLatch callOnce=new CountDownLatch(1);
  final CountDownLatch okToContinue=new CountDownLatch(1);
  final TestObservable<String> w1=new TestObservable<String>("one","two","three");
  final TestObservable<String> w2=new TestObservable<String>(callOnce,okToContinue,"four","five","six");
  Subscriber<String> subscriber=TestHelper.mockSubscriber();
  TestSubscriber<String> ts=new TestSubscriber<String>(subscriber,0L);
  final Flowable<String> concat=Flowable.concat(Flowable.unsafeCreate(w1),Flowable.unsafeCreate(w2));
  try {
    concat.subscribe(ts);
    callOnce.await();
    ts.dispose();
    okToContinue.countDown();
    w1.t.join();
    w2.t.join();
  }
 catch (  Throwable e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
  InOrder inOrder=inOrder(subscriber);
  inOrder.verify(subscriber,times(1)).onNext("one");
  inOrder.verify(subscriber,times(1)).onNext("two");
  inOrder.verify(subscriber,times(1)).onNext("three");
  inOrder.verify(subscriber,times(1)).onNext("four");
  inOrder.verify(subscriber,never()).onNext("five");
  inOrder.verify(subscriber,never()).onNext("six");
  inOrder.verify(subscriber,never()).onComplete();
}
