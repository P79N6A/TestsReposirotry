@Test(timeout=30000) public void testIssue2890NoStackoverflow() throws InterruptedException {
  final ExecutorService executor=Executors.newFixedThreadPool(2);
  final Scheduler sch=Schedulers.from(executor);
  Function<Integer,Flowable<Integer>> func=new Function<Integer,Flowable<Integer>>(){
    @Override public Flowable<Integer> apply(    Integer t){
      Flowable<Integer> flowable=Flowable.just(t).subscribeOn(sch);
      FlowableProcessor<Integer> processor=UnicastProcessor.create();
      flowable.subscribe(processor);
      return processor;
    }
  }
;
  int n=5000;
  final AtomicInteger counter=new AtomicInteger();
  Flowable.range(1,n).concatMap(func).subscribe(new DefaultSubscriber<Integer>(){
    @Override public void onNext(    Integer t){
      try {
        Thread.sleep(1);
      }
 catch (      InterruptedException e) {
      }
      if (counter.getAndIncrement() % 100 == 0) {
        System.out.print("testIssue2890NoStackoverflow -> ");
        System.out.println(counter.get());
      }
      ;
    }
    @Override public void onComplete(){
      executor.shutdown();
    }
    @Override public void onError(    Throwable e){
      executor.shutdown();
    }
  }
);
  executor.awaitTermination(20000,TimeUnit.MILLISECONDS);
  assertEquals(n,counter.get());
}
