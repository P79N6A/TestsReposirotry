@Test(timeout=1000) public void settingUnderlyingWhenUnsubscribedCausesImmediateUnsubscriptionConcurrently() throws InterruptedException {
  final Disposable firstSet=mock(Disposable.class);
  serialDisposable.update(firstSet);
  final CountDownLatch start=new CountDownLatch(1);
  final int count=10;
  final CountDownLatch end=new CountDownLatch(count);
  final List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < count; i++) {
    final Thread t=new Thread(){
      @Override public void run(){
        try {
          start.await();
          serialDisposable.dispose();
        }
 catch (        InterruptedException e) {
          fail(e.getMessage());
        }
 finally {
          end.countDown();
        }
      }
    }
;
    t.start();
    threads.add(t);
  }
  final Disposable underlying=mock(Disposable.class);
  start.countDown();
  serialDisposable.update(underlying);
  end.await();
  verify(firstSet).dispose();
  verify(underlying).dispose();
  for (  final Thread t : threads) {
    t.join();
  }
}
