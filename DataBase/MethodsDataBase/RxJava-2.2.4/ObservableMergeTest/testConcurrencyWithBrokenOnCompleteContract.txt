@Test public void testConcurrencyWithBrokenOnCompleteContract(){
  Observable<Integer> o=Observable.unsafeCreate(new ObservableSource<Integer>(){
    @Override public void subscribe(    final Observer<? super Integer> observer){
      Worker inner=Schedulers.newThread().createWorker();
      final CompositeDisposable as=new CompositeDisposable();
      as.add(Disposables.empty());
      as.add(inner);
      observer.onSubscribe(as);
      inner.schedule(new Runnable(){
        @Override public void run(){
          try {
            for (int i=0; i < 10000; i++) {
              observer.onNext(i);
            }
          }
 catch (          Exception e) {
            observer.onError(e);
          }
          as.dispose();
          observer.onComplete();
          observer.onComplete();
          observer.onComplete();
        }
      }
);
    }
  }
);
  for (int i=0; i < 10; i++) {
    Observable<Integer> merge=Observable.merge(o,o,o);
    TestObserver<Integer> to=new TestObserver<Integer>();
    merge.subscribe(to);
    to.awaitTerminalEvent();
    to.assertNoErrors();
    to.assertComplete();
    List<Integer> onNextEvents=to.values();
    assertEquals(30000,onNextEvents.size());
  }
}
