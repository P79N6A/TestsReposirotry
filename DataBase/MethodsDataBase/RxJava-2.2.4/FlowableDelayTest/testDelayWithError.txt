@Test public void testDelayWithError(){
  Flowable<Long> source=Flowable.interval(1L,TimeUnit.SECONDS,scheduler).map(new Function<Long,Long>(){
    @Override public Long apply(    Long value){
      if (value == 1L) {
        throw new RuntimeException("error!");
      }
      return value;
    }
  }
);
  Flowable<Long> delayed=source.delay(1L,TimeUnit.SECONDS,scheduler);
  delayed.subscribe(subscriber);
  InOrder inOrder=inOrder(subscriber);
  scheduler.advanceTimeTo(1999L,TimeUnit.MILLISECONDS);
  verify(subscriber,never()).onNext(anyLong());
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
  scheduler.advanceTimeTo(2000L,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,times(1)).onError(any(Throwable.class));
  inOrder.verify(subscriber,never()).onNext(anyLong());
  verify(subscriber,never()).onComplete();
  scheduler.advanceTimeTo(5000L,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,never()).onNext(anyLong());
  inOrder.verify(subscriber,never()).onError(any(Throwable.class));
  verify(subscriber,never()).onComplete();
}
