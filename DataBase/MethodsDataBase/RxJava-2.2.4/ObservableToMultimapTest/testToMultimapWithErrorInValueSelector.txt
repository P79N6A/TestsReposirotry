@Test public void testToMultimapWithErrorInValueSelector(){
  Observable<String> source=Observable.just("a","b","cc","dd");
  Function<String,String> duplicateErr=new Function<String,String>(){
    @Override public String apply(    String t1){
      if ("b".equals(t1)) {
        throw new RuntimeException("Forced failure");
      }
      return t1 + t1;
    }
  }
;
  Single<Map<Integer,Collection<String>>> mapped=source.toMultimap(lengthFunc,duplicateErr);
  Map<Integer,Collection<String>> expected=new HashMap<Integer,Collection<String>>();
  expected.put(1,Arrays.asList("aa","bb"));
  expected.put(2,Arrays.asList("cccc","dddd"));
  mapped.subscribe(singleObserver);
  verify(singleObserver,times(1)).onError(any(Throwable.class));
  verify(singleObserver,never()).onSuccess(expected);
}
