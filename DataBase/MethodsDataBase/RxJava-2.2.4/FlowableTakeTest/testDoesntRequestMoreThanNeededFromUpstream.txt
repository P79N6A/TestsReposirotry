@Test public void testDoesntRequestMoreThanNeededFromUpstream() throws InterruptedException {
  final AtomicLong requests=new AtomicLong();
  TestSubscriber<Long> ts=new TestSubscriber<Long>(0L);
  Flowable.interval(100,TimeUnit.MILLISECONDS).doOnRequest(new LongConsumer(){
    @Override public void accept(    long n){
      System.out.println(n);
      requests.addAndGet(n);
    }
  }
).take(2).subscribe(ts);
  Thread.sleep(50);
  ts.request(1);
  ts.request(1);
  ts.request(1);
  ts.awaitTerminalEvent();
  ts.assertComplete();
  ts.assertNoErrors();
  assertEquals(3,requests.get());
}
