@Test public void testDelayedErrorDeliveryWhenSafeSubscriberUnsubscribes(){
  TestScheduler testScheduler=new TestScheduler();
  Flowable<Integer> source=Flowable.concat(Flowable.<Integer>error(new TestException()),Flowable.just(1));
  Subscriber<Integer> subscriber=TestHelper.mockSubscriber();
  InOrder inOrder=inOrder(subscriber);
  source.observeOn(testScheduler).subscribe(subscriber);
  inOrder.verify(subscriber,never()).onError(any(TestException.class));
  testScheduler.advanceTimeBy(1,TimeUnit.SECONDS);
  inOrder.verify(subscriber).onError(any(TestException.class));
  inOrder.verify(subscriber,never()).onNext(anyInt());
  inOrder.verify(subscriber,never()).onComplete();
}
