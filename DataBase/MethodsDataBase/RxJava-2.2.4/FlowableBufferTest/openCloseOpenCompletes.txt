@Test @SuppressWarnings("unchecked") public void openCloseOpenCompletes(){
  PublishProcessor<Integer> source=PublishProcessor.create();
  PublishProcessor<Integer> openIndicator=PublishProcessor.create();
  PublishProcessor<Integer> closeIndicator=PublishProcessor.create();
  TestSubscriber<List<Integer>> ts=source.buffer(openIndicator,Functions.justFunction(closeIndicator)).test();
  openIndicator.onNext(1);
  assertTrue(closeIndicator.hasSubscribers());
  openIndicator.onComplete();
  assertTrue(source.hasSubscribers());
  assertTrue(closeIndicator.hasSubscribers());
  closeIndicator.onComplete();
  assertFalse(source.hasSubscribers());
  ts.assertResult(Collections.<Integer>emptyList());
}
