@Test public void testToMultimapWithMapThrowingFactoryFlowable(){
  Flowable<String> source=Flowable.just("a","b","cc","dd","eee","fff");
  Callable<Map<Integer,Collection<String>>> mapFactory=new Callable<Map<Integer,Collection<String>>>(){
    @Override public Map<Integer,Collection<String>> call(){
      throw new RuntimeException("Forced failure");
    }
  }
;
  Flowable<Map<Integer,Collection<String>>> mapped=source.toMultimap(lengthFunc,new Function<String,String>(){
    @Override public String apply(    String v){
      return v;
    }
  }
,mapFactory).toFlowable();
  Map<Integer,Collection<String>> expected=new HashMap<Integer,Collection<String>>();
  expected.put(2,Arrays.asList("cc","dd"));
  expected.put(3,Arrays.asList("eee","fff"));
  mapped.subscribe(objectSubscriber);
  verify(objectSubscriber,times(1)).onError(any(Throwable.class));
  verify(objectSubscriber,never()).onNext(expected);
  verify(objectSubscriber,never()).onComplete();
}
