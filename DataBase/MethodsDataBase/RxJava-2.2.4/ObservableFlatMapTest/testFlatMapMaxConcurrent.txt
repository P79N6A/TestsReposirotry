@Test public void testFlatMapMaxConcurrent(){
  final int m=4;
  final AtomicInteger subscriptionCount=new AtomicInteger();
  Observable<Integer> source=Observable.range(1,10).flatMap(new Function<Integer,Observable<Integer>>(){
    @Override public Observable<Integer> apply(    Integer t1){
      return composer(Observable.range(t1 * 10,2),subscriptionCount,m).subscribeOn(Schedulers.computation());
    }
  }
,m);
  TestObserver<Integer> to=new TestObserver<Integer>();
  source.subscribe(to);
  to.awaitTerminalEvent();
  to.assertNoErrors();
  Set<Integer> expected=new HashSet<Integer>(Arrays.asList(10,11,20,21,30,31,40,41,50,51,60,61,70,71,80,81,90,91,100,101));
  Assert.assertEquals(expected.size(),to.valueCount());
  Assert.assertTrue(expected.containsAll(to.values()));
}
