@Test public void failSingleObservableBlockingFirst(){
  try {
    RxJavaPlugins.setFailOnNonBlockingScheduler(true);
    Observable.just(1).subscribeOn(Schedulers.single()).map(new Function<Integer,Integer>(){
      @Override public Integer apply(      Integer v) throws Exception {
        Observable.just(1).delay(10,TimeUnit.SECONDS).blockingFirst();
        return v;
      }
    }
).test().awaitDone(5,TimeUnit.SECONDS).assertFailure(IllegalStateException.class);
  }
  finally {
    RxJavaPlugins.reset();
  }
}
