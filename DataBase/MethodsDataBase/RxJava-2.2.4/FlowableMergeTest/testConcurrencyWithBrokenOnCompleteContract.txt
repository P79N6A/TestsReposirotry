@Test public void testConcurrencyWithBrokenOnCompleteContract(){
  Flowable<Integer> f=Flowable.unsafeCreate(new Publisher<Integer>(){
    @Override public void subscribe(    final Subscriber<? super Integer> s){
      Worker inner=Schedulers.newThread().createWorker();
      final AsyncSubscription as=new AsyncSubscription();
      as.setSubscription(new BooleanSubscription());
      as.setResource(inner);
      s.onSubscribe(as);
      inner.schedule(new Runnable(){
        @Override public void run(){
          try {
            for (int i=0; i < 10000; i++) {
              s.onNext(i);
            }
          }
 catch (          Exception e) {
            s.onError(e);
          }
          as.dispose();
          s.onComplete();
          s.onComplete();
          s.onComplete();
        }
      }
);
    }
  }
);
  for (int i=0; i < 10; i++) {
    Flowable<Integer> merge=Flowable.merge(f.onBackpressureBuffer(),f.onBackpressureBuffer(),f.onBackpressureBuffer());
    TestSubscriber<Integer> ts=new TestSubscriber<Integer>();
    merge.subscribe(ts);
    ts.awaitTerminalEvent();
    ts.assertNoErrors();
    ts.assertComplete();
    List<Integer> onNextEvents=ts.values();
    assertEquals(30000,onNextEvents.size());
  }
}
