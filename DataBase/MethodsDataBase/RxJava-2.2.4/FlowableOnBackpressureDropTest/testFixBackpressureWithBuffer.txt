@Test(timeout=5000) public void testFixBackpressureWithBuffer() throws InterruptedException {
  final CountDownLatch l1=new CountDownLatch(100);
  final CountDownLatch l2=new CountDownLatch(150);
  TestSubscriber<Long> ts=new TestSubscriber<Long>(new DefaultSubscriber<Long>(){
    @Override protected void onStart(){
    }
    @Override public void onComplete(){
    }
    @Override public void onError(    Throwable e){
    }
    @Override public void onNext(    Long t){
      l1.countDown();
      l2.countDown();
    }
  }
,0L);
  ts.request(100);
  infinite.subscribeOn(Schedulers.computation()).onBackpressureDrop().take(500).subscribe(ts);
  l1.await();
  assertEquals(100,ts.values().size());
  ts.request(50);
  l2.await();
  assertEquals(150,ts.values().size());
  ts.request(350);
  ts.awaitTerminalEvent();
  assertEquals(500,ts.values().size());
  ts.assertNoErrors();
  assertEquals(0,ts.values().get(0).intValue());
}
