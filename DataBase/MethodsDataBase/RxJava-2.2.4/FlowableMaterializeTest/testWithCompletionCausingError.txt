@Test public void testWithCompletionCausingError(){
  TestSubscriber<Notification<Integer>> ts=new TestSubscriber<Notification<Integer>>();
  final RuntimeException ex=new RuntimeException("boo");
  Flowable.<Integer>empty().materialize().doOnNext(new Consumer<Object>(){
    @Override public void accept(    Object t){
      throw ex;
    }
  }
).subscribe(ts);
  ts.assertError(ex);
  ts.assertNoValues();
  ts.assertTerminated();
}
