@Test public void testBackpressureWithEmissionThenError(){
  TestSubscriber<Notification<Integer>> ts=new TestSubscriber<Notification<Integer>>(0L);
  IllegalArgumentException ex=new IllegalArgumentException();
  Flowable.fromIterable(Arrays.asList(1)).concatWith(Flowable.<Integer>error(ex)).materialize().subscribe(ts);
  ts.assertNoValues();
  ts.request(1);
  ts.assertValueCount(1);
  assertTrue(ts.values().get(0).isOnNext());
  ts.request(1);
  ts.assertValueCount(2);
  assertTrue(ts.values().get(1).isOnError());
  assertEquals(ex,ts.values().get(1).getError());
  ts.assertComplete();
}
