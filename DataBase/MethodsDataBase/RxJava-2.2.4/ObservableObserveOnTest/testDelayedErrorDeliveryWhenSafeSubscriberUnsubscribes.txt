@Test public void testDelayedErrorDeliveryWhenSafeSubscriberUnsubscribes(){
  TestScheduler testScheduler=new TestScheduler();
  Observable<Integer> source=Observable.concat(Observable.<Integer>error(new TestException()),Observable.just(1));
  Observer<Integer> o=TestHelper.mockObserver();
  InOrder inOrder=inOrder(o);
  source.observeOn(testScheduler).subscribe(o);
  inOrder.verify(o,never()).onError(any(TestException.class));
  testScheduler.advanceTimeBy(1,TimeUnit.SECONDS);
  inOrder.verify(o).onError(any(TestException.class));
  inOrder.verify(o,never()).onNext(anyInt());
  inOrder.verify(o,never()).onComplete();
}
