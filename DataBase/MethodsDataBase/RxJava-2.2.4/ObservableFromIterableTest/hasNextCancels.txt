@Test public void hasNextCancels(){
  final TestObserver<Integer> to=new TestObserver<Integer>();
  Observable.fromIterable(new Iterable<Integer>(){
    @Override public Iterator<Integer> iterator(){
      return new Iterator<Integer>(){
        int count;
        @Override public boolean hasNext(){
          if (++count == 2) {
            to.cancel();
          }
          return true;
        }
        @Override public Integer next(){
          return 1;
        }
        @Override public void remove(){
          throw new UnsupportedOperationException();
        }
      }
;
    }
  }
).subscribe(to);
  to.assertValue(1).assertNoErrors().assertNotComplete();
}
