@SuppressWarnings("unchecked") @Test public void shouldNotDeliverResultIfSubscriberUnsubscribedBeforeEmission() throws Exception {
  Callable<String> func=mock(Callable.class);
  final CountDownLatch funcLatch=new CountDownLatch(1);
  final CountDownLatch observerLatch=new CountDownLatch(1);
  when(func.call()).thenAnswer(new Answer<String>(){
    @Override public String answer(    InvocationOnMock invocation) throws Throwable {
      observerLatch.countDown();
      try {
        funcLatch.await();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
      return "should_not_be_delivered";
    }
  }
);
  Flowable<String> fromCallableFlowable=Flowable.fromCallable(func);
  Subscriber<String> subscriber=TestHelper.mockSubscriber();
  TestSubscriber<String> outer=new TestSubscriber<String>(subscriber);
  fromCallableFlowable.subscribeOn(Schedulers.computation()).subscribe(outer);
  observerLatch.await();
  outer.cancel();
  funcLatch.countDown();
  verify(func).call();
  verify(subscriber).onSubscribe(any(Subscription.class));
  verifyNoMoreInteractions(subscriber);
}
