@SuppressWarnings("unchecked") @Test public void testRetrySubscribesAgainAfterError() throws Exception {
  Consumer<Integer> record=mock(Consumer.class);
  InOrder inOrder=inOrder(record);
  Consumer<Integer> throwException=mock(Consumer.class);
  doThrow(new RuntimeException()).when(throwException).accept(Mockito.anyInt());
  PublishProcessor<Integer> processor=PublishProcessor.create();
  processor.doOnNext(record).doOnNext(throwException).retry().subscribe();
  inOrder.verifyNoMoreInteractions();
  processor.onNext(1);
  inOrder.verify(record).accept(1);
  processor.onNext(2);
  inOrder.verify(record).accept(2);
  processor.onNext(3);
  inOrder.verify(record).accept(3);
  inOrder.verifyNoMoreInteractions();
}
