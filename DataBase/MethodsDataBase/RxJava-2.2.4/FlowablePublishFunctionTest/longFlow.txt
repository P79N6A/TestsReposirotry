@Test public void longFlow(){
  Flowable.range(1,1000000).publish(new Function<Flowable<Integer>,Publisher<Integer>>(){
    @SuppressWarnings("unchecked") @Override public Publisher<Integer> apply(    Flowable<Integer> v) throws Exception {
      return Flowable.mergeArray(v.filter(new Predicate<Integer>(){
        @Override public boolean test(        Integer w) throws Exception {
          return w % 2 == 0;
        }
      }
),v.filter(new Predicate<Integer>(){
        @Override public boolean test(        Integer w) throws Exception {
          return w % 2 != 0;
        }
      }
));
    }
  }
).takeLast(1).test().assertResult(1000000);
}
