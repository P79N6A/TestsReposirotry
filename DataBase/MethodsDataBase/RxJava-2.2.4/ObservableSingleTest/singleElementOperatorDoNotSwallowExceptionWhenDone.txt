@Test public void singleElementOperatorDoNotSwallowExceptionWhenDone(){
  final Throwable exception=new RuntimeException("some error");
  final AtomicReference<Throwable> error=new AtomicReference<Throwable>();
  try {
    RxJavaPlugins.setErrorHandler(new Consumer<Throwable>(){
      @Override public void accept(      final Throwable throwable) throws Exception {
        error.set(throwable);
      }
    }
);
    Observable.unsafeCreate(new ObservableSource<Integer>(){
      @Override public void subscribe(      final Observer<? super Integer> observer){
        observer.onComplete();
        observer.onError(exception);
      }
    }
).singleElement().test().assertComplete();
    assertSame(exception,error.get().getCause());
  }
  finally {
    RxJavaPlugins.reset();
  }
}
