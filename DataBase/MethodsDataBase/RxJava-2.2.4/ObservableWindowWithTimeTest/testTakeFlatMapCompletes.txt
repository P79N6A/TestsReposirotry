@Test public void testTakeFlatMapCompletes(){
  TestObserver<Integer> to=new TestObserver<Integer>();
  final AtomicInteger wip=new AtomicInteger();
  final int indicator=999999999;
  ObservableWindowWithSizeTest.hotStream().window(300,TimeUnit.MILLISECONDS).take(10).doOnComplete(new Action(){
    @Override public void run(){
      System.out.println("Main done!");
    }
  }
).flatMap(new Function<Observable<Integer>,Observable<Integer>>(){
    @Override public Observable<Integer> apply(    Observable<Integer> w){
      return w.startWith(indicator).doOnComplete(new Action(){
        @Override public void run(){
          System.out.println("inner done: " + wip.incrementAndGet());
        }
      }
);
    }
  }
).doOnNext(new Consumer<Integer>(){
    @Override public void accept(    Integer pv){
      System.out.println(pv);
    }
  }
).subscribe(to);
  to.awaitTerminalEvent(5,TimeUnit.SECONDS);
  to.assertComplete();
  Assert.assertTrue(to.valueCount() != 0);
}
