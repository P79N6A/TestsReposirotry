@Test public void innerCancelledOnMainError(){
  final PublishProcessor<Integer> main=PublishProcessor.create();
  final PublishProcessor<Integer> inner=PublishProcessor.create();
  TestSubscriber<Integer> ts=main.switchMap(Functions.justFunction(inner)).test();
  assertTrue(main.hasSubscribers());
  main.onNext(1);
  assertTrue(inner.hasSubscribers());
  main.onError(new TestException());
  assertFalse(inner.hasSubscribers());
  ts.assertFailure(TestException.class);
}
