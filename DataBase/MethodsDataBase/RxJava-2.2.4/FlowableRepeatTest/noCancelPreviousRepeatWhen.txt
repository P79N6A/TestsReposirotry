@Test public void noCancelPreviousRepeatWhen(){
  final AtomicInteger counter=new AtomicInteger();
  Flowable<Integer> source=Flowable.just(1).doOnCancel(new Action(){
    @Override public void run() throws Exception {
      counter.getAndIncrement();
    }
  }
);
  final AtomicInteger times=new AtomicInteger();
  source.repeatWhen(new Function<Flowable<Object>,Flowable<?>>(){
    @Override public Flowable<?> apply(    Flowable<Object> e) throws Exception {
      return e.takeWhile(new Predicate<Object>(){
        @Override public boolean test(        Object v) throws Exception {
          return times.getAndIncrement() < 4;
        }
      }
);
    }
  }
).test().assertResult(1,1,1,1,1);
  assertEquals(0,counter.get());
}
