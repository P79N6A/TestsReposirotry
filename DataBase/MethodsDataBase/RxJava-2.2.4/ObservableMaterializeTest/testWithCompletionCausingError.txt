@Test public void testWithCompletionCausingError(){
  TestObserver<Notification<Integer>> to=new TestObserver<Notification<Integer>>();
  final RuntimeException ex=new RuntimeException("boo");
  Observable.<Integer>empty().materialize().doOnNext(new Consumer<Object>(){
    @Override public void accept(    Object t){
      throw ex;
    }
  }
).subscribe(to);
  to.assertError(ex);
  to.assertNoValues();
  to.assertTerminated();
}
