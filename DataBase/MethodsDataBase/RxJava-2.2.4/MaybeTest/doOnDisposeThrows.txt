@Test public void doOnDisposeThrows(){
  List<Throwable> list=TestHelper.trackPluginErrors();
  try {
    PublishProcessor<Integer> pp=PublishProcessor.create();
    TestObserver<Integer> to=pp.singleElement().doOnDispose(new Action(){
      @Override public void run() throws Exception {
        throw new TestException();
      }
    }
).test();
    assertTrue(pp.hasSubscribers());
    to.cancel();
    assertFalse(pp.hasSubscribers());
    to.assertSubscribed().assertNoValues().assertNoErrors().assertNotComplete();
    TestHelper.assertUndeliverable(list,0,TestException.class);
  }
  finally {
    RxJavaPlugins.reset();
  }
}
