@Test public void testUnsubscribeRecursiveScheduleWithDelay() throws InterruptedException {
  final CountDownLatch latch=new CountDownLatch(1);
  final CountDownLatch unsubscribeLatch=new CountDownLatch(1);
  final AtomicInteger counter=new AtomicInteger();
  final Worker inner=getScheduler().createWorker();
  try {
    inner.schedule(new Runnable(){
      @Override public void run(){
        inner.schedule(new Runnable(){
          long i=1L;
          @Override public void run(){
            if (i++ == 10) {
              latch.countDown();
              try {
                unsubscribeLatch.await();
              }
 catch (              InterruptedException e) {
              }
            }
            counter.incrementAndGet();
            inner.schedule(this,10,TimeUnit.MILLISECONDS);
          }
        }
,10,TimeUnit.MILLISECONDS);
      }
    }
);
    latch.await();
    inner.dispose();
    unsubscribeLatch.countDown();
    Thread.sleep(200);
    assertEquals(10,counter.get());
  }
  finally {
    inner.dispose();
  }
}
