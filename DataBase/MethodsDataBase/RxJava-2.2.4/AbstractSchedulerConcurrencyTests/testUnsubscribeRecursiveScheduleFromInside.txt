@Test public void testUnsubscribeRecursiveScheduleFromInside() throws InterruptedException {
  final CountDownLatch unsubscribeLatch=new CountDownLatch(1);
  final AtomicInteger counter=new AtomicInteger();
  final Worker inner=getScheduler().createWorker();
  try {
    inner.schedule(new Runnable(){
      @Override public void run(){
        inner.schedule(new Runnable(){
          int i;
          @Override public void run(){
            System.out.println("Run: " + i++);
            if (i == 10) {
              inner.dispose();
            }
            counter.incrementAndGet();
            inner.schedule(this);
          }
        }
);
      }
    }
);
    unsubscribeLatch.countDown();
    Thread.sleep(200);
    assertEquals(10,counter.get());
  }
  finally {
    inner.dispose();
  }
}
