@Test public void testUnsubscribesFromUpstream(){
  final AtomicBoolean unsubscribed=new AtomicBoolean(false);
  Action unsubscribeAction=new Action(){
    @Override public void run(){
      unsubscribed.set(true);
    }
  }
;
  Observable.just(1).concatWith(Observable.<Integer>never()).doOnDispose(unsubscribeAction).takeLast(1).subscribe().dispose();
  assertTrue(unsubscribed.get());
}
