@Test public void noReentrantDispose(){
  final AtomicInteger cancelCalled=new AtomicInteger();
  final BehaviorProcessor<Integer> p=BehaviorProcessor.create();
  p.doOnCancel(new Action(){
    @Override public void run() throws Exception {
      cancelCalled.incrementAndGet();
      p.onNext(2);
    }
  }
).firstOrError().subscribe().dispose();
  assertEquals(1,cancelCalled.get());
}
