@Test public void testUsingDisposesEagerlyBeforeCompletion(){
  final List<String> events=new ArrayList<String>();
  Callable<Resource> resourceFactory=createResourceFactory(events);
  final Action completion=createOnCompletedAction(events);
  final Action unsub=createUnsubAction(events);
  Function<Resource,Flowable<String>> observableFactory=new Function<Resource,Flowable<String>>(){
    @Override public Flowable<String> apply(    Resource resource){
      return Flowable.fromArray(resource.getTextFromWeb().split(" "));
    }
  }
;
  Subscriber<String> subscriber=TestHelper.mockSubscriber();
  Flowable<String> flowable=Flowable.using(resourceFactory,observableFactory,new DisposeAction(),true).doOnCancel(unsub).doOnComplete(completion);
  flowable.safeSubscribe(subscriber);
  assertEquals(Arrays.asList("disposed","completed"),events);
}
