@Test public void onSubscribeCancelsImmediately(){
  PublishSubject<Integer> ps=PublishSubject.create();
  TestObserver<Integer> to=ps.test();
  ps.subscribe(new Observer<Integer>(){
    @Override public void onSubscribe(    Disposable d){
      d.dispose();
      d.dispose();
    }
    @Override public void onNext(    Integer t){
    }
    @Override public void onError(    Throwable t){
    }
    @Override public void onComplete(){
    }
  }
);
  to.cancel();
  assertFalse(ps.hasObservers());
}
