@Test public void basicWithError(){
  final Disposable d=Disposables.empty();
  Observable.<Integer>create(new ObservableOnSubscribe<Integer>(){
    @Override public void subscribe(    ObservableEmitter<Integer> e) throws Exception {
      e.setDisposable(d);
      e.onNext(1);
      e.onNext(2);
      e.onNext(3);
      e.onError(new TestException());
      e.onComplete();
      e.onNext(4);
      e.onError(new TestException());
    }
  }
).test().assertFailure(TestException.class,1,2,3);
  assertTrue(d.isDisposed());
}
