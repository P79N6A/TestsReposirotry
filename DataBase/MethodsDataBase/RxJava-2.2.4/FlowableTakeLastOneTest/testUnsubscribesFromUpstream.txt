@Test public void testUnsubscribesFromUpstream(){
  final AtomicBoolean unsubscribed=new AtomicBoolean(false);
  Action unsubscribeAction=new Action(){
    @Override public void run(){
      unsubscribed.set(true);
    }
  }
;
  Flowable.just(1).concatWith(Flowable.<Integer>never()).doOnCancel(unsubscribeAction).takeLast(1).subscribe().dispose();
  assertTrue(unsubscribed.get());
}
