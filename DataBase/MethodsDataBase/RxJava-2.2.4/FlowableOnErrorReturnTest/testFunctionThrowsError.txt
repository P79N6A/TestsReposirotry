/** 
 * Test that when a function throws an exception this is propagated through onError.
 */
@Test public void testFunctionThrowsError(){
  TestFlowable f=new TestFlowable("one");
  Flowable<String> w=Flowable.unsafeCreate(f);
  final AtomicReference<Throwable> capturedException=new AtomicReference<Throwable>();
  Flowable<String> flowable=w.onErrorReturn(new Function<Throwable,String>(){
    @Override public String apply(    Throwable e){
      capturedException.set(e);
      throw new RuntimeException("exception from function");
    }
  }
);
  Subscriber<String> subscriber=TestHelper.mockSubscriber();
  flowable.subscribe(subscriber);
  try {
    f.t.join();
  }
 catch (  InterruptedException e) {
    fail(e.getMessage());
  }
  verify(subscriber,times(1)).onNext("one");
  verify(subscriber,times(1)).onError(any(Throwable.class));
  verify(subscriber,times(0)).onComplete();
  assertNotNull(capturedException.get());
}
