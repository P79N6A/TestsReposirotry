/** 
 * This test verifies that open() and close() are correctly called by the StreamTask.
 */
@Test @SuppressWarnings("unchecked") public void testOpenClose() throws Exception {
  final StreamTaskTestHarness<String> testHarness=new StreamTaskTestHarness<>(SourceStreamTask::new,BasicTypeInfo.STRING_TYPE_INFO);
  testHarness.setupOutputForSingletonOperatorChain();
  StreamConfig streamConfig=testHarness.getStreamConfig();
  StreamSource<String,?> sourceOperator=new StreamSource<>(new OpenCloseTestSource());
  streamConfig.setStreamOperator(sourceOperator);
  streamConfig.setOperatorID(new OperatorID());
  testHarness.invoke();
  testHarness.waitForTaskCompletion();
  Assert.assertTrue("RichFunction methods where not called.",OpenCloseTestSource.closeCalled);
  List<String> resultElements=TestHarnessUtil.getRawElementsFromOutput(testHarness.getOutput());
  Assert.assertEquals(10,resultElements.size());
}
