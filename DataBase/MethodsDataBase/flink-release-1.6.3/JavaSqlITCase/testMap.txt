@Test public void testMap() throws Exception {
  ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  BatchTableEnvironment tableEnv=TableEnvironment.getTableEnvironment(env,config());
  List<Tuple2<Integer,Map<String,String>>> rows=new ArrayList<>();
  rows.add(new Tuple2<>(1,Collections.singletonMap("foo","bar")));
  rows.add(new Tuple2<>(2,Collections.singletonMap("foo","spam")));
  TypeInformation<Tuple2<Integer,Map<String,String>>> ty=new TupleTypeInfo<>(BasicTypeInfo.INT_TYPE_INFO,new MapTypeInfo<>(BasicTypeInfo.STRING_TYPE_INFO,BasicTypeInfo.STRING_TYPE_INFO));
  DataSet<Tuple2<Integer,Map<String,String>>> ds1=env.fromCollection(rows,ty);
  tableEnv.registerDataSet("t1",ds1,"a, b");
  String sqlQuery="SELECT b['foo'] FROM t1";
  Table result=tableEnv.sqlQuery(sqlQuery);
  DataSet<Row> resultSet=tableEnv.toDataSet(result,Row.class);
  List<Row> results=resultSet.collect();
  String expected="bar\n" + "spam\n";
  compareResultAsText(results,expected);
}
