@Test public void testCompression() throws Exception {
  final Path outputPath=new Path(File.createTempFile("avro-output-file","avro").getAbsolutePath());
  final AvroOutputFormat<User> outputFormat=new AvroOutputFormat<>(outputPath,User.class);
  outputFormat.setWriteMode(FileSystem.WriteMode.OVERWRITE);
  final Path compressedOutputPath=new Path(File.createTempFile("avro-output-file","compressed.avro").getAbsolutePath());
  final AvroOutputFormat<User> compressedOutputFormat=new AvroOutputFormat<>(compressedOutputPath,User.class);
  compressedOutputFormat.setWriteMode(FileSystem.WriteMode.OVERWRITE);
  compressedOutputFormat.setCodec(AvroOutputFormat.Codec.SNAPPY);
  output(outputFormat);
  output(compressedOutputFormat);
  assertTrue(fileSize(outputPath) > fileSize(compressedOutputPath));
  FileSystem fs=FileSystem.getLocalFileSystem();
  fs.delete(outputPath,false);
  fs.delete(compressedOutputPath,false);
}
