/** 
 * Tests basic correctness of buffer-or-event interleaving and correct <code>null</code> return value after receiving all end-of-partition events.
 */
@Test(timeout=120 * 1000) public void testBasicGetNextLogic() throws Exception {
  final SingleInputGate inputGate=createInputGate();
  final TestInputChannel[] inputChannels=new TestInputChannel[]{new TestInputChannel(inputGate,0),new TestInputChannel(inputGate,1)};
  inputGate.setInputChannel(new IntermediateResultPartitionID(),inputChannels[0]);
  inputGate.setInputChannel(new IntermediateResultPartitionID(),inputChannels[1]);
  inputChannels[0].readBuffer();
  inputChannels[0].readBuffer();
  inputChannels[1].readBuffer();
  inputChannels[1].readEndOfPartitionEvent();
  inputChannels[0].readEndOfPartitionEvent();
  inputGate.notifyChannelNonEmpty(inputChannels[0]);
  inputGate.notifyChannelNonEmpty(inputChannels[1]);
  verifyBufferOrEvent(inputGate,true,0,true);
  verifyBufferOrEvent(inputGate,true,1,true);
  verifyBufferOrEvent(inputGate,true,0,true);
  verifyBufferOrEvent(inputGate,false,1,true);
  verifyBufferOrEvent(inputGate,false,0,false);
  assertTrue(inputGate.isFinished());
}
