/** 
 * Tests that the cluster retrieval of a finished YARN application fails.
 */
@Test(expected=ClusterRetrieveException.class) public void testClusterClientRetrievalOfFinishedYarnApplication() throws Exception {
  final ApplicationId applicationId=ApplicationId.newInstance(System.currentTimeMillis(),42);
  final ApplicationReport applicationReport=createApplicationReport(applicationId,YarnApplicationState.FINISHED,FinalApplicationStatus.SUCCEEDED);
  final YarnClient yarnClient=new TestingYarnClient(Collections.singletonMap(applicationId,applicationReport));
  final YarnConfiguration yarnConfiguration=new YarnConfiguration();
  yarnClient.init(yarnConfiguration);
  yarnClient.start();
  final TestingAbstractYarnClusterDescriptor clusterDescriptor=new TestingAbstractYarnClusterDescriptor(new Configuration(),yarnConfiguration,temporaryFolder.newFolder().getAbsolutePath(),yarnClient,false);
  try {
    clusterDescriptor.retrieve(applicationId);
  }
  finally {
    clusterDescriptor.close();
  }
}
