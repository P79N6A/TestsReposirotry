/** 
 * Tests that reporting the handle of a completed snapshot works as expected and that the directory for completed snapshot is not deleted by  {@link #deleteIfNotCompeltedSnapshot()}.
 */
@Test public void completeSnapshotAndGetHandle() throws Exception {
  File folderRoot=temporaryFolder.getRoot();
  File folderA=new File(folderRoot,String.valueOf(UUID.randomUUID()));
  Assert.assertTrue(folderA.mkdirs());
  Path folderAPath=new Path(folderA.toURI());
  SnapshotDirectory snapshotDirectory=SnapshotDirectory.permanent(folderAPath);
  DirectoryStateHandle handle=snapshotDirectory.completeSnapshotAndGetHandle();
  Assert.assertNotNull(handle);
  Assert.assertTrue(snapshotDirectory.cleanup());
  Assert.assertTrue(folderA.isDirectory());
  Assert.assertEquals(folderAPath,handle.getDirectory());
  handle.discardState();
  Assert.assertFalse(folderA.isDirectory());
  Assert.assertTrue(folderA.mkdirs());
  snapshotDirectory=SnapshotDirectory.permanent(folderAPath);
  Assert.assertTrue(snapshotDirectory.cleanup());
  try {
    snapshotDirectory.completeSnapshotAndGetHandle();
    Assert.fail();
  }
 catch (  IOException ignore) {
  }
}
