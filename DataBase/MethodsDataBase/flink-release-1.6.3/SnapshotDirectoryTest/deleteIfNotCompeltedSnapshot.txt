/** 
 * Tests that snapshot director behaves correct for delete calls. Completed snapshots should not be deleted, only ongoing snapshots can.
 */
@Test public void deleteIfNotCompeltedSnapshot() throws Exception {
  File folderRoot=temporaryFolder.getRoot();
  File folderA=new File(folderRoot,String.valueOf(UUID.randomUUID()));
  File folderB=new File(folderA,String.valueOf(UUID.randomUUID()));
  Assert.assertTrue(folderB.mkdirs());
  File file=new File(folderA,"test.txt");
  Assert.assertTrue(file.createNewFile());
  Path folderAPath=new Path(folderA.toURI());
  SnapshotDirectory snapshotDirectory=SnapshotDirectory.permanent(folderAPath);
  Assert.assertTrue(snapshotDirectory.cleanup());
  Assert.assertFalse(folderA.isDirectory());
  Assert.assertTrue(folderA.mkdirs());
  Assert.assertTrue(file.createNewFile());
  snapshotDirectory=SnapshotDirectory.permanent(folderAPath);
  snapshotDirectory.completeSnapshotAndGetHandle();
  Assert.assertTrue(snapshotDirectory.cleanup());
  Assert.assertTrue(folderA.isDirectory());
  Assert.assertTrue(file.exists());
}
