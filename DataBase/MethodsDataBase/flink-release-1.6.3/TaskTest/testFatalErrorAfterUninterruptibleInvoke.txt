/** 
 * The invoke() method blocks infinitely, but cancel() does not block. Only resolved by a fatal error.
 */
@Test public void testFatalErrorAfterUninterruptibleInvoke() throws Exception {
  Configuration config=new Configuration();
  config.setLong(TaskManagerOptions.TASK_CANCELLATION_INTERVAL,5);
  config.setLong(TaskManagerOptions.TASK_CANCELLATION_TIMEOUT,50);
  Task task=createTask(InvokableUninterruptibleBlockingInvoke.class,config);
  try {
    task.startTaskThread();
    awaitLatch.await();
    task.cancelExecution();
    for (int i=0; i < 10; i++) {
      Object msg=taskManagerMessages.poll(1,TimeUnit.SECONDS);
      if (msg instanceof TaskManagerMessages.FatalError) {
        return;
      }
    }
    fail("Did not receive expected task manager message");
  }
  finally {
    cancelLatch.trigger();
    task.getExecutingThread().interrupt();
    task.getExecutingThread().join();
  }
}
