/** 
 * The invoke() method holds a lock (trigger awaitLatch after acquisition) and cancel cannot complete because it also tries to acquire the same lock. This is resolved by the watch dog, no fatal error.
 */
@Test public void testInterruptableSharedLockInInvokeAndCancel() throws Exception {
  Configuration config=new Configuration();
  config.setLong(TaskManagerOptions.TASK_CANCELLATION_INTERVAL,5);
  config.setLong(TaskManagerOptions.TASK_CANCELLATION_TIMEOUT,50);
  Task task=createTask(InvokableInterruptableSharedLockInInvokeAndCancel.class,config);
  task.startTaskThread();
  awaitLatch.await();
  task.cancelExecution();
  task.getExecutingThread().join();
  for (  Object msg : taskManagerMessages) {
    assertFalse("Unexpected FatalError message",msg instanceof TaskManagerMessages.FatalError);
  }
}
