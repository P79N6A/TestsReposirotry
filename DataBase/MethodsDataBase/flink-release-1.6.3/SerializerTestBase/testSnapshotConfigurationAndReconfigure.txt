@Test public void testSnapshotConfigurationAndReconfigure() throws Exception {
  final TypeSerializerConfigSnapshot configSnapshot=getSerializer().snapshotConfiguration();
  byte[] serializedConfig;
  try (ByteArrayOutputStream out=new ByteArrayOutputStream()){
    TypeSerializerSerializationUtil.writeSerializerConfigSnapshot(new DataOutputViewStreamWrapper(out),configSnapshot);
    serializedConfig=out.toByteArray();
  }
   TypeSerializerConfigSnapshot restoredConfig;
  try (ByteArrayInputStream in=new ByteArrayInputStream(serializedConfig)){
    restoredConfig=TypeSerializerSerializationUtil.readSerializerConfigSnapshot(new DataInputViewStreamWrapper(in),Thread.currentThread().getContextClassLoader());
  }
   CompatibilityResult strategy=getSerializer().ensureCompatibility(restoredConfig);
  assertFalse(strategy.isRequiresMigration());
  strategy=getSerializer().ensureCompatibility(new TestIncompatibleSerializerConfigSnapshot());
  assertTrue(strategy.isRequiresMigration());
}
