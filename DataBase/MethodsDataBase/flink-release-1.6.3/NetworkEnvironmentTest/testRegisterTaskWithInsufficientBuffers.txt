/** 
 * Verifies that  {@link NetworkEnvironment#registerTask(Task)} fails if the bare minimum ofrequired buffers is not available (we are one buffer short).
 */
@Test public void testRegisterTaskWithInsufficientBuffers() throws Exception {
  final int bufferCount;
  if (!enableCreditBasedFlowControl) {
    bufferCount=19;
  }
 else {
    bufferCount=10 + 10 * TaskManagerOptions.NETWORK_BUFFERS_PER_CHANNEL.defaultValue() - 1;
  }
  expectedException.expect(IOException.class);
  expectedException.expectMessage("Insufficient number of network buffers");
  testRegisterTaskWithLimitedBuffers(bufferCount);
}
