@Test public void testNullGaugeHandling() throws IOException {
  MetricDumpSerialization.MetricDumpSerializer serializer=new MetricDumpSerialization.MetricDumpSerializer();
  MetricDumpSerialization.MetricDumpDeserializer deserializer=new MetricDumpSerialization.MetricDumpDeserializer();
  Map<Gauge<?>,Tuple2<QueryScopeInfo,String>> gauges=new HashMap<>();
  gauges.put(new Gauge<Object>(){
    @Override public Object getValue(){
      return null;
    }
  }
,new Tuple2<QueryScopeInfo,String>(new QueryScopeInfo.JobManagerQueryScopeInfo("A"),"g"));
  MetricDumpSerialization.MetricSerializationResult output=serializer.serialize(Collections.<Counter,Tuple2<QueryScopeInfo,String>>emptyMap(),gauges,Collections.<Histogram,Tuple2<QueryScopeInfo,String>>emptyMap(),Collections.<Meter,Tuple2<QueryScopeInfo,String>>emptyMap());
  Assert.assertEquals(0,output.serializedCounters.length);
  Assert.assertEquals(0,output.serializedGauges.length);
  Assert.assertEquals(0,output.serializedHistograms.length);
  Assert.assertEquals(0,output.serializedMeters.length);
  List<MetricDump> deserialized=deserializer.deserialize(output);
  Assert.assertEquals(0,deserialized.size());
}
