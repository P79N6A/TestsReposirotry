/** 
 * Going into SUSPENDING out of RUNNING vertices should cancel all vertices once with RPC calls.
 */
@Test public void testSuspendedOutOfRunning() throws Exception {
  final TaskManagerGateway gateway=spy(new SimpleAckingTaskManagerGateway());
  final int parallelism=10;
  final ExecutionGraph eg=createExecutionGraph(gateway,parallelism);
  eg.scheduleForExecution();
  ExecutionGraphTestUtils.switchAllVerticesToRunning(eg);
  assertEquals(JobStatus.RUNNING,eg.getState());
  validateAllVerticesInState(eg,ExecutionState.RUNNING);
  eg.suspend(new Exception("suspend"));
  assertEquals(JobStatus.SUSPENDING,eg.getState());
  validateAllVerticesInState(eg,ExecutionState.CANCELING);
  validateCancelRpcCalls(gateway,parallelism);
  ExecutionGraphTestUtils.completeCancellingForAllVertices(eg);
  assertEquals(JobStatus.SUSPENDED,eg.getState());
  ensureCannotLeaveSuspendedState(eg,gateway);
}
