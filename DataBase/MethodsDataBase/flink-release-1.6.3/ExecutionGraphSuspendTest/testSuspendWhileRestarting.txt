/** 
 * Tests that we can suspend a job when in state RESTARTING.
 */
@Test public void testSuspendWhileRestarting() throws Exception {
  final ExecutionGraph eg=ExecutionGraphTestUtils.createSimpleTestGraph(new InfiniteDelayRestartStrategy(10));
  eg.scheduleForExecution();
  assertEquals(JobStatus.RUNNING,eg.getState());
  ExecutionGraphTestUtils.switchAllVerticesToRunning(eg);
  eg.failGlobal(new Exception("test"));
  assertEquals(JobStatus.FAILING,eg.getState());
  ExecutionGraphTestUtils.completeCancellingForAllVertices(eg);
  assertEquals(JobStatus.RESTARTING,eg.getState());
  final Exception exception=new Exception("Suspended");
  eg.suspend(exception);
  assertEquals(JobStatus.SUSPENDED,eg.getState());
  assertEquals(exception,eg.getFailureCause());
}
