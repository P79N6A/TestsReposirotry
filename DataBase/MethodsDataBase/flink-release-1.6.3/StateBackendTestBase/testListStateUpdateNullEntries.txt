/** 
 * This test verifies that all ListState implementations are consistent in not allowing {@link ListState#addAll(List)} to be called with {@code null} entries in the list of entriesto add.
 */
@Test public void testListStateUpdateNullEntries() throws Exception {
  AbstractKeyedStateBackend<String> keyedBackend=createKeyedBackend(StringSerializer.INSTANCE);
  final ListStateDescriptor<Long> stateDescr=new ListStateDescriptor<>("my-state",Long.class);
  try {
    ListState<Long> state=keyedBackend.getPartitionedState(VoidNamespace.INSTANCE,VoidNamespaceSerializer.INSTANCE,stateDescr);
    keyedBackend.setCurrentKey("abc");
    assertNull(state.get());
    expectedException.expect(NullPointerException.class);
    List<Long> adding=new ArrayList<>();
    adding.add(3L);
    adding.add(null);
    adding.add(5L);
    state.update(adding);
  }
  finally {
    keyedBackend.close();
    keyedBackend.dispose();
  }
}
