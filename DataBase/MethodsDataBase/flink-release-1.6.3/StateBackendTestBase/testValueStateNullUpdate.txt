/** 
 * This test verifies that passing  {@code null} to {@link ValueState#update(Object)} actsthe same as  {@link ValueState#clear()}.
 * @throws Exception
 */
@Test @SuppressWarnings("unchecked") public void testValueStateNullUpdate() throws Exception {
  try {
    LongSerializer.INSTANCE.serialize(null,new DataOutputViewStreamWrapper(new ByteArrayOutputStream()));
    fail("Should fail with NullPointerException");
  }
 catch (  NullPointerException e) {
  }
  CheckpointStreamFactory streamFactory=createStreamFactory();
  SharedStateRegistry sharedStateRegistry=new SharedStateRegistry();
  AbstractKeyedStateBackend<Integer> backend=createKeyedBackend(IntSerializer.INSTANCE);
  ValueStateDescriptor<Long> kvId=new ValueStateDescriptor<>("id",LongSerializer.INSTANCE,42L);
  ValueState<Long> state=backend.getPartitionedState(VoidNamespace.INSTANCE,VoidNamespaceSerializer.INSTANCE,kvId);
  backend.setCurrentKey(1);
  assertEquals(42L,(long)state.value());
  state.update(1L);
  assertEquals(1L,(long)state.value());
  backend.setCurrentKey(2);
  assertEquals(42L,(long)state.value());
  backend.setCurrentKey(1);
  state.clear();
  assertEquals(42L,(long)state.value());
  state.update(17L);
  assertEquals(17L,(long)state.value());
  state.update(null);
  assertEquals(42L,(long)state.value());
  KeyedStateHandle snapshot1=runSnapshot(backend.snapshot(682375462378L,2,streamFactory,CheckpointOptions.forCheckpointWithDefaultLocation()),sharedStateRegistry);
  backend.dispose();
  backend=restoreKeyedBackend(IntSerializer.INSTANCE,snapshot1);
  snapshot1.discardState();
  backend.getPartitionedState(VoidNamespace.INSTANCE,VoidNamespaceSerializer.INSTANCE,kvId);
  backend.dispose();
}
