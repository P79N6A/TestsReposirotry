@Test public void testApplyToAllKeysLambdaFunction() throws Exception {
  AbstractKeyedStateBackend<Integer> backend=createKeyedBackend(IntSerializer.INSTANCE);
  try {
    ListStateDescriptor<String> listStateDescriptor=new ListStateDescriptor<>("foo",StringSerializer.INSTANCE);
    ListState<String> listState=backend.getPartitionedState(VoidNamespace.INSTANCE,VoidNamespaceSerializer.INSTANCE,listStateDescriptor);
    for (int i=0; i < 100; ++i) {
      backend.setCurrentKey(i);
      listState.add("Hello" + i);
    }
    backend.applyToAllKeys(VoidNamespace.INSTANCE,VoidNamespaceSerializer.INSTANCE,listStateDescriptor,(    Integer key,    ListState<String> state) -> assertEquals("Hello" + key,state.get().iterator().next()));
  }
  finally {
    IOUtils.closeQuietly(backend);
    backend.dispose();
  }
}
