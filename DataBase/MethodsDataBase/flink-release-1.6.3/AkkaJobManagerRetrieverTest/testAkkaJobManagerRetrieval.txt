/** 
 * Tests that we can retrieve the current leading job manager.
 */
@Test public void testAkkaJobManagerRetrieval() throws Exception {
  AkkaJobManagerRetriever akkaJobManagerRetriever=new AkkaJobManagerRetriever(actorSystem,timeout,0,Time.milliseconds(0L));
  SettableLeaderRetrievalService settableLeaderRetrievalService=new SettableLeaderRetrievalService();
  CompletableFuture<JobManagerGateway> gatewayFuture=akkaJobManagerRetriever.getFuture();
  final UUID leaderSessionId=UUID.randomUUID();
  ActorRef actorRef=null;
  try {
    actorRef=actorSystem.actorOf(Props.create(JobClientActorTest.PlainActor.class,leaderSessionId));
    final String address=actorRef.path().toString();
    settableLeaderRetrievalService.start(akkaJobManagerRetriever);
    assertFalse(gatewayFuture.isDone());
    settableLeaderRetrievalService.notifyListener(address,leaderSessionId);
    JobManagerGateway jobManagerGateway=gatewayFuture.get(timeout.toMilliseconds(),TimeUnit.MILLISECONDS);
    assertEquals(address,jobManagerGateway.getAddress());
  }
  finally {
    settableLeaderRetrievalService.stop();
    if (actorRef != null) {
      TestingUtils.stopActorGracefully(actorRef);
    }
  }
}
