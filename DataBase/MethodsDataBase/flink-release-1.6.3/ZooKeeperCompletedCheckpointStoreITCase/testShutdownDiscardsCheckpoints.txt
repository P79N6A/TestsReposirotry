/** 
 * Tests that shutdown discards all checkpoints.
 */
@Test public void testShutdownDiscardsCheckpoints() throws Exception {
  CuratorFramework client=ZOOKEEPER.getClient();
  SharedStateRegistry sharedStateRegistry=new SharedStateRegistry();
  CompletedCheckpointStore store=createCompletedCheckpoints(1);
  TestCompletedCheckpoint checkpoint=createCheckpoint(0,sharedStateRegistry);
  store.addCheckpoint(checkpoint);
  assertEquals(1,store.getNumberOfRetainedCheckpoints());
  assertNotNull(client.checkExists().forPath(CHECKPOINT_PATH + ZooKeeperCompletedCheckpointStore.checkpointIdToPath(checkpoint.getCheckpointID())));
  store.shutdown(JobStatus.FINISHED);
  assertEquals(0,store.getNumberOfRetainedCheckpoints());
  assertNull(client.checkExists().forPath(CHECKPOINT_PATH + ZooKeeperCompletedCheckpointStore.checkpointIdToPath(checkpoint.getCheckpointID())));
  sharedStateRegistry.close();
  store.recover();
  assertEquals(0,store.getNumberOfRetainedCheckpoints());
}
