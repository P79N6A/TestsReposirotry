@Test public void testSnapshotAndRestoreWrappedCheckpointedFunction() throws Exception {
  StreamMap<Integer,Integer> operator=new StreamMap<>(new WrappingTestFun(new WrappingTestFun(new InnerTestFun())));
  OneInputStreamOperatorTestHarness<Integer,Integer> testHarness=new OneInputStreamOperatorTestHarness<>(operator);
  testHarness.setup();
  testHarness.open();
  testHarness.processElement(new StreamRecord<>(5,12L));
  OperatorSubtaskState snapshot=testHarness.snapshot(0,0);
  testHarness.close();
  InnerTestFun innerTestFun=new InnerTestFun();
  operator=new StreamMap<>(new WrappingTestFun(new WrappingTestFun(innerTestFun)));
  testHarness=new OneInputStreamOperatorTestHarness<>(operator);
  testHarness.setup();
  testHarness.initializeState(snapshot);
  testHarness.open();
  Assert.assertTrue(innerTestFun.wasRestored);
  testHarness.close();
}
