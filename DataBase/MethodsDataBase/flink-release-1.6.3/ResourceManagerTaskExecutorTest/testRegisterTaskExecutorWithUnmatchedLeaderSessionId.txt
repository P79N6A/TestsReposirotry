/** 
 * Test receive registration with unmatched leadershipId from task executor
 */
@Test public void testRegisterTaskExecutorWithUnmatchedLeaderSessionId() throws Exception {
  try {
    CompletableFuture<RegistrationResponse> unMatchedLeaderFuture=wronglyFencedGateway.registerTaskExecutor(taskExecutorAddress,taskExecutorResourceID,dataPort,hardwareDescription,timeout);
    try {
      unMatchedLeaderFuture.get(timeout.toMilliseconds(),TimeUnit.MILLISECONDS);
      fail("Should have failed because we are using a wrongly fenced ResourceManagerGateway.");
    }
 catch (    ExecutionException e) {
      assertTrue(ExceptionUtils.stripExecutionException(e) instanceof FencingTokenException);
    }
  }
  finally {
    if (testingFatalErrorHandler.hasExceptionOccurred()) {
      testingFatalErrorHandler.rethrowError();
    }
  }
}
