/** 
 * Test receive normal registration from task executor and receive duplicate registration from task executor.
 */
@Test public void testRegisterTaskExecutor() throws Exception {
  try {
    CompletableFuture<RegistrationResponse> successfulFuture=rmGateway.registerTaskExecutor(taskExecutorAddress,taskExecutorResourceID,dataPort,hardwareDescription,timeout);
    RegistrationResponse response=successfulFuture.get(timeout.toMilliseconds(),TimeUnit.MILLISECONDS);
    assertTrue(response instanceof TaskExecutorRegistrationSuccess);
    final TaskManagerInfo taskManagerInfo=rmGateway.requestTaskManagerInfo(taskExecutorResourceID,timeout).get();
    assertThat(taskManagerInfo.getResourceId(),equalTo(taskExecutorResourceID));
    CompletableFuture<RegistrationResponse> duplicateFuture=rmGateway.registerTaskExecutor(taskExecutorAddress,taskExecutorResourceID,dataPort,hardwareDescription,timeout);
    RegistrationResponse duplicateResponse=duplicateFuture.get();
    assertTrue(duplicateResponse instanceof TaskExecutorRegistrationSuccess);
    assertNotEquals(((TaskExecutorRegistrationSuccess)response).getRegistrationId(),((TaskExecutorRegistrationSuccess)duplicateResponse).getRegistrationId());
  }
  finally {
    if (testingFatalErrorHandler.hasExceptionOccurred()) {
      testingFatalErrorHandler.rethrowError();
    }
  }
}
