/** 
 * Tests that we receive a HandshakeException when connecting to a rpc endpoint which does not support the requested rpc gateway.
 */
@Test public void testWrongGatewayEndpointConnection() throws Exception {
  AkkaRpcActorTest.DummyRpcEndpoint rpcEndpoint=new AkkaRpcActorTest.DummyRpcEndpoint(akkaRpcService1);
  rpcEndpoint.start();
  CompletableFuture<WrongRpcGateway> futureGateway=akkaRpcService2.connect(rpcEndpoint.getAddress(),WrongRpcGateway.class);
  try {
    futureGateway.get(timeout.getSize(),timeout.getUnit());
    fail("We expected a HandshakeException.");
  }
 catch (  ExecutionException executionException) {
    assertThat(ExceptionUtils.stripExecutionException(executionException),instanceOf(HandshakeException.class));
  }
 finally {
    RpcUtils.terminateRpcEndpoint(rpcEndpoint,timeout);
  }
}
