@Test public void testRegisterStates() throws Exception {
  final OperatorStateBackend operatorStateBackend=new DefaultOperatorStateBackend(classLoader,new ExecutionConfig(),false);
  ListStateDescriptor<Serializable> stateDescriptor1=new ListStateDescriptor<>("test1",new JavaSerializer<>());
  ListStateDescriptor<Serializable> stateDescriptor2=new ListStateDescriptor<>("test2",new JavaSerializer<>());
  ListStateDescriptor<Serializable> stateDescriptor3=new ListStateDescriptor<>("test3",new JavaSerializer<>());
  ListState<Serializable> listState1=operatorStateBackend.getListState(stateDescriptor1);
  assertNotNull(listState1);
  assertEquals(1,operatorStateBackend.getRegisteredStateNames().size());
  Iterator<Serializable> it=listState1.get().iterator();
  assertFalse(it.hasNext());
  listState1.add(42);
  listState1.add(4711);
  it=listState1.get().iterator();
  assertEquals(42,it.next());
  assertEquals(4711,it.next());
  assertFalse(it.hasNext());
  ListState<Serializable> listState2=operatorStateBackend.getListState(stateDescriptor2);
  assertNotNull(listState2);
  assertEquals(2,operatorStateBackend.getRegisteredStateNames().size());
  assertFalse(it.hasNext());
  listState2.add(7);
  listState2.add(13);
  listState2.add(23);
  it=listState2.get().iterator();
  assertEquals(7,it.next());
  assertEquals(13,it.next());
  assertEquals(23,it.next());
  assertFalse(it.hasNext());
  ListState<Serializable> listState3=operatorStateBackend.getUnionListState(stateDescriptor3);
  assertNotNull(listState3);
  assertEquals(3,operatorStateBackend.getRegisteredStateNames().size());
  assertFalse(it.hasNext());
  listState3.add(17);
  listState3.add(3);
  listState3.add(123);
  it=listState3.get().iterator();
  assertEquals(17,it.next());
  assertEquals(3,it.next());
  assertEquals(123,it.next());
  assertFalse(it.hasNext());
  ListState<Serializable> listState1b=operatorStateBackend.getListState(stateDescriptor1);
  assertNotNull(listState1b);
  listState1b.add(123);
  it=listState1b.get().iterator();
  assertEquals(42,it.next());
  assertEquals(4711,it.next());
  assertEquals(123,it.next());
  assertFalse(it.hasNext());
  it=listState1.get().iterator();
  assertEquals(42,it.next());
  assertEquals(4711,it.next());
  assertEquals(123,it.next());
  assertFalse(it.hasNext());
  it=listState1b.get().iterator();
  assertEquals(42,it.next());
  assertEquals(4711,it.next());
  assertEquals(123,it.next());
  assertFalse(it.hasNext());
  try {
    operatorStateBackend.getUnionListState(stateDescriptor2);
    fail("Did not detect changed mode");
  }
 catch (  IllegalStateException ignored) {
  }
  try {
    operatorStateBackend.getListState(stateDescriptor3);
    fail("Did not detect changed mode");
  }
 catch (  IllegalStateException ignored) {
  }
}
