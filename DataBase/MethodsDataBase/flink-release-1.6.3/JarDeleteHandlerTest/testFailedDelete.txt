@Test public void testFailedDelete() throws Exception {
  makeJarDirReadOnly();
  final HandlerRequest<EmptyRequestBody,JarDeleteMessageParameters> request=createRequest(TEST_JAR_NAME);
  try {
    jarDeleteHandler.handleRequest(request,restfulGateway).get();
  }
 catch (  final ExecutionException e) {
    final Throwable throwable=ExceptionUtils.stripCompletionException(e.getCause());
    assertThat(throwable,instanceOf(RestHandlerException.class));
    final RestHandlerException restHandlerException=(RestHandlerException)throwable;
    assertThat(restHandlerException.getMessage(),containsString("Failed to delete jar"));
    assertThat(restHandlerException.getHttpResponseStatus(),equalTo(HttpResponseStatus.INTERNAL_SERVER_ERROR));
  }
}
