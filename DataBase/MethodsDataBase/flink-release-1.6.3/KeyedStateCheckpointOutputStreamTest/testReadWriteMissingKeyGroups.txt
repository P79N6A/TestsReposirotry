@Test public void testReadWriteMissingKeyGroups() throws Exception {
  final KeyGroupRange keyRange=new KeyGroupRange(0,2);
  KeyedStateCheckpointOutputStream stream=createStream(keyRange);
  DataOutputView dov=new DataOutputViewStreamWrapper(stream);
  stream.startNewKeyGroup(1);
  dov.writeInt(1);
  KeyGroupsStateHandle fullHandle=stream.closeAndGetHandle();
  int count=0;
  try (FSDataInputStream in=fullHandle.openInputStream()){
    DataInputView div=new DataInputViewStreamWrapper(in);
    for (    int kg : fullHandle.getKeyGroupRange()) {
      long off=fullHandle.getOffsetForKeyGroup(kg);
      if (off >= 0) {
        in.seek(off);
        Assert.assertEquals(1,div.readInt());
        ++count;
      }
    }
  }
   Assert.assertEquals(1,count);
}
