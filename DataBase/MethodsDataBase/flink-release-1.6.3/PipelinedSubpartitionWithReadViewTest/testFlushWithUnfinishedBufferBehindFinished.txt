/** 
 * After flush call unfinished BufferConsumers should be reported as available, otherwise we might not flush some of the data.
 */
@Test public void testFlushWithUnfinishedBufferBehindFinished() throws Exception {
  subpartition.add(createFilledBufferConsumer(1025));
  subpartition.add(createFilledBufferBuilder(1024).createBufferConsumer());
  long oldNumNotifications=availablityListener.getNumNotifications();
  subpartition.flush();
  assertThat(oldNumNotifications,greaterThan(0L));
  assertEquals(oldNumNotifications,availablityListener.getNumNotifications());
  assertNextBuffer(readView,1025,true,1,false,true);
  assertNextBuffer(readView,1024,false,1,false,false);
  assertNoNextBuffer(readView);
}
