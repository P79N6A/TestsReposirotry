/** 
 * A flush call with a buffer size of 1 should always notify consumers (unless already flushed).
 */
@Test public void testFlushWithUnfinishedBufferBehindFinished2() throws Exception {
  subpartition.flush();
  assertEquals(0,availablityListener.getNumNotifications());
  subpartition.add(createFilledBufferConsumer(1025));
  subpartition.add(createFilledBufferBuilder(1024).createBufferConsumer());
  assertNextBuffer(readView,1025,false,1,false,true);
  long oldNumNotifications=availablityListener.getNumNotifications();
  subpartition.flush();
  assertEquals(oldNumNotifications + 1,availablityListener.getNumNotifications());
  subpartition.flush();
  assertEquals(oldNumNotifications + 1,availablityListener.getNumNotifications());
  assertNextBuffer(readView,1024,false,1,false,false);
  assertNoNextBuffer(readView);
}
