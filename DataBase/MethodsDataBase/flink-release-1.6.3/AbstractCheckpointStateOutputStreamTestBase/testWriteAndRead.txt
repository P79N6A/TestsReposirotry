/** 
 * Simple write and read test
 */
@Test public void testWriteAndRead() throws Exception {
  final FileSystem fs=FileSystem.getLocalFileSystem();
  final Path folder=baseFolder();
  final String fileName="fooBarName";
  final Random rnd=new Random();
  final byte[] data=new byte[1694523];
  final FileStateHandle handle;
  try (FSDataOutputStream stream=createTestStream(fs,folder,fileName)){
    for (int i=0; i < data.length; ) {
      if (rnd.nextBoolean()) {
        stream.write(data[i++]);
      }
 else {
        int len=rnd.nextInt(Math.min(data.length - i,32));
        stream.write(data,i,len);
        i+=len;
      }
    }
    handle=closeAndGetResult(stream);
  }
   try (FSDataInputStream in=handle.openInputStream()){
    byte[] buffer=new byte[data.length];
    readFully(in,buffer);
    assertArrayEquals(data,buffer);
  }
   try (FSDataInputStream in=fs.open(handle.getFilePath())){
    byte[] buffer=new byte[data.length];
    readFully(in,buffer);
    assertArrayEquals(data,buffer);
  }
 }
