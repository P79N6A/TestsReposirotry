/** 
 * Tests that all checkpoints are discarded (using the correct class loader).
 */
@Test public void testDiscardAllCheckpoints() throws Exception {
  SharedStateRegistry sharedStateRegistry=new SharedStateRegistry();
  CompletedCheckpointStore checkpoints=createCompletedCheckpoints(4);
  TestCompletedCheckpoint[] expected=new TestCompletedCheckpoint[]{createCheckpoint(0,sharedStateRegistry),createCheckpoint(1,sharedStateRegistry),createCheckpoint(2,sharedStateRegistry),createCheckpoint(3,sharedStateRegistry)};
  for (  TestCompletedCheckpoint checkpoint : expected) {
    checkpoints.addCheckpoint(checkpoint);
  }
  checkpoints.shutdown(JobStatus.FINISHED);
  assertNull(checkpoints.getLatestCheckpoint());
  assertEquals(0,checkpoints.getAllCheckpoints().size());
  assertEquals(0,checkpoints.getNumberOfRetainedCheckpoints());
  for (  TestCompletedCheckpoint checkpoint : expected) {
    checkpoint.awaitDiscard();
    assertTrue(checkpoint.isDiscarded());
  }
}
