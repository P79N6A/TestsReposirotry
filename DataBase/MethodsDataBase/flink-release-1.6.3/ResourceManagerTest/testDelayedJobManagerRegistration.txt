/** 
 * Tests delayed or erroneous registration of the ResourceManager with the JobManager
 */
@Test public void testDelayedJobManagerRegistration(){
  new JavaTestKit(system){
{
      new Within(duration("10 seconds")){
        @Override protected void run(){
          Configuration shortTimeoutConfig=config.clone();
          shortTimeoutConfig.setString(AkkaOptions.LOOKUP_TIMEOUT,"1 s");
          fakeJobManager=TestingUtils.createForwardingActor(system,getTestActor(),HighAvailabilityServices.DEFAULT_LEADER_ID,Option.<String>empty());
          jobManagerLeaderRetrievalService.notifyListener(fakeJobManager.path(),HighAvailabilityServices.DEFAULT_LEADER_ID);
          resourceManager=TestingUtils.createResourceManager(system,shortTimeoutConfig,highAvailabilityServices);
          RegisterResourceManager msg=expectMsgClass(RegisterResourceManager.class);
          getLastSender().tell(new JobManagerMessages.LeaderSessionMessage(null,new Object()),fakeJobManager.actor());
          expectMsgClass(RegisterResourceManager.class);
          expectMsgClass(RegisterResourceManager.class);
        }
      }
;
    }
  }
;
}
