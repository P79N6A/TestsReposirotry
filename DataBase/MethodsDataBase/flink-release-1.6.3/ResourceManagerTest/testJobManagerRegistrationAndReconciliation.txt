/** 
 * Tests the registration and reconciliation of the ResourceManager with the JobManager
 */
@Test public void testJobManagerRegistrationAndReconciliation(){
  new JavaTestKit(system){
{
      new Within(duration("10 seconds")){
        @Override protected void run(){
          fakeJobManager=TestingUtils.createForwardingActor(system,getTestActor(),HighAvailabilityServices.DEFAULT_LEADER_ID,Option.<String>empty());
          jobManagerLeaderRetrievalService.notifyListener(fakeJobManager.path(),HighAvailabilityServices.DEFAULT_LEADER_ID);
          resourceManager=TestingUtils.createResourceManager(system,config,highAvailabilityServices);
          expectMsgClass(RegisterResourceManager.class);
          List<ResourceID> resourceList=new ArrayList<>();
          resourceList.add(ResourceID.generate());
          resourceList.add(ResourceID.generate());
          resourceList.add(ResourceID.generate());
          resourceManager.tell(new RegisterResourceManagerSuccessful(fakeJobManager.actor(),resourceList),fakeJobManager);
          resourceManager.tell(new TestingResourceManager.GetRegisteredResources(),fakeJobManager);
          TestingResourceManager.GetRegisteredResourcesReply reply=expectMsgClass(TestingResourceManager.GetRegisteredResourcesReply.class);
          for (          ResourceID id : resourceList) {
            if (!reply.resources.contains(id)) {
              fail("Expected to find all resources that were provided during registration.");
            }
          }
        }
      }
;
    }
  }
;
}
