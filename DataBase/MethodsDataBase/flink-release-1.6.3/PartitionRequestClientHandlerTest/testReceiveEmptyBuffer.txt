/** 
 * Tests a fix for FLINK-1761. <p>FLINK-1761 discovered an IndexOutOfBoundsException, when receiving buffers of size 0.
 */
@Test public void testReceiveEmptyBuffer() throws Exception {
  final BufferProvider bufferProvider=mock(BufferProvider.class);
  when(bufferProvider.requestBuffer()).thenReturn(TestBufferFactory.createBuffer(0));
  final RemoteInputChannel inputChannel=mock(RemoteInputChannel.class);
  when(inputChannel.getInputChannelId()).thenReturn(new InputChannelID());
  when(inputChannel.getBufferProvider()).thenReturn(bufferProvider);
  final Buffer emptyBuffer=TestBufferFactory.createBuffer(0);
  final int backlog=-1;
  final BufferResponse receivedBuffer=createBufferResponse(emptyBuffer,0,inputChannel.getInputChannelId(),backlog);
  final PartitionRequestClientHandler client=new PartitionRequestClientHandler();
  client.addInputChannel(inputChannel);
  client.channelRead(mock(ChannelHandlerContext.class),receivedBuffer);
  verify(inputChannel,never()).onError(any(Throwable.class));
  verify(inputChannel,times(1)).onEmptyBuffer(0,backlog);
}
