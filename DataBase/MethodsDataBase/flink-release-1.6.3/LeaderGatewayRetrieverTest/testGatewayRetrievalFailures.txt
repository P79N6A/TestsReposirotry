/** 
 * Tests that the gateway retrieval is retried in case of a failure.
 */
@Test public void testGatewayRetrievalFailures() throws Exception {
  final String address="localhost";
  final UUID leaderId=UUID.randomUUID();
  RpcGateway rpcGateway=mock(RpcGateway.class);
  TestingLeaderGatewayRetriever leaderGatewayRetriever=new TestingLeaderGatewayRetriever(rpcGateway);
  SettableLeaderRetrievalService settableLeaderRetrievalService=new SettableLeaderRetrievalService();
  settableLeaderRetrievalService.start(leaderGatewayRetriever);
  CompletableFuture<RpcGateway> gatewayFuture=leaderGatewayRetriever.getFuture();
  settableLeaderRetrievalService.notifyListener(address,leaderId);
  try {
    gatewayFuture.get();
    fail("The first future should have been failed.");
  }
 catch (  ExecutionException ignored) {
  }
  assertFalse((leaderGatewayRetriever.getNow().isPresent()));
  assertEquals(rpcGateway,leaderGatewayRetriever.getNow().get());
}
