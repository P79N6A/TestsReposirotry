/** 
 * Verify that a  {@link KeyedStream#process(KeyedProcessFunction)} call is correctly translated to an operator.
 */
@Test public void testKeyedStreamKeyedProcessTranslation(){
  StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  DataStreamSource<Long> src=env.generateSequence(0,0);
  KeyedProcessFunction<Long,Long,Integer> keyedProcessFunction=new KeyedProcessFunction<Long,Long,Integer>(){
    private static final long serialVersionUID=1L;
    @Override public void processElement(    Long value,    Context ctx,    Collector<Integer> out) throws Exception {
    }
    @Override public void onTimer(    long timestamp,    OnTimerContext ctx,    Collector<Integer> out) throws Exception {
    }
  }
;
  DataStream<Integer> processed=src.keyBy(new IdentityKeySelector<Long>()).process(keyedProcessFunction);
  processed.addSink(new DiscardingSink<Integer>());
  assertEquals(keyedProcessFunction,getFunctionForDataStream(processed));
  assertTrue(getOperatorForDataStream(processed) instanceof KeyedProcessOperator);
}
