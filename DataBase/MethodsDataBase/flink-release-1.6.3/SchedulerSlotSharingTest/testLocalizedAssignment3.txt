/** 
 * Tests that the scheduler can fall back to non-local
 */
@Test public void testLocalizedAssignment3(){
  try {
    JobVertexID jid1=new JobVertexID();
    JobVertexID jid2=new JobVertexID();
    SlotSharingGroup sharingGroup=new SlotSharingGroup(jid1,jid2);
    TaskManagerLocation loc1=testingSlotProvider.addTaskManager(2);
    TaskManagerLocation loc2=testingSlotProvider.addTaskManager(2);
    LogicalSlot s1=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid1,0,2,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    LogicalSlot s2=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid1,1,2,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    LogicalSlot s3=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid2,0,4,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    LogicalSlot s4=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid2,1,4,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    LogicalSlot s5=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid2,3,4,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    LogicalSlot s6=testingSlotProvider.allocateSlot(new ScheduledUnit(getTestVertexWithLocation(jid2,4,4,sharingGroup,loc1),sharingGroup.getSlotSharingGroupId()),false,slotProfileForLocation(loc1),TestingUtils.infiniteTime()).get();
    assertNotNull(s1);
    assertNotNull(s2);
    assertNotNull(s3);
    assertNotNull(s4);
    assertNotNull(s5);
    assertNotNull(s6);
    assertEquals(4,testingSlotProvider.getNumberOfSlots(sharingGroup));
    assertEquals(loc1,s1.getTaskManagerLocation());
    assertEquals(loc1,s2.getTaskManagerLocation());
    assertEquals(loc1,s3.getTaskManagerLocation());
    assertEquals(loc1,s4.getTaskManagerLocation());
    assertEquals(loc2,s5.getTaskManagerLocation());
    assertEquals(loc2,s6.getTaskManagerLocation());
    assertEquals(4,testingSlotProvider.getNumberOfLocalizedAssignments());
    assertTrue(2 == testingSlotProvider.getNumberOfNonLocalizedAssignments() || 2 == testingSlotProvider.getNumberOfHostLocalizedAssignments());
    assertEquals(0,testingSlotProvider.getNumberOfUnconstrainedAssignments());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
