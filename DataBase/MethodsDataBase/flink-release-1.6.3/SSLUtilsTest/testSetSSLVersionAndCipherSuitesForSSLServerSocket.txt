/** 
 * Tests if SSLUtils set the right ssl version and cipher suites for SSLServerSocket.
 */
@Test public void testSetSSLVersionAndCipherSuitesForSSLServerSocket() throws Exception {
  Configuration serverConfig=createInternalSslConfigWithKeyAndTrustStores();
  serverConfig.setString(SecurityOptions.SSL_PROTOCOL,"TLSv1.1");
  serverConfig.setString(SecurityOptions.SSL_ALGORITHMS,"TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256");
  try (ServerSocket socket=SSLUtils.createSSLServerSocketFactory(serverConfig).createServerSocket(0)){
    assertTrue(socket instanceof SSLServerSocket);
    final SSLServerSocket sslSocket=(SSLServerSocket)socket;
    String[] protocols=sslSocket.getEnabledProtocols();
    String[] algorithms=sslSocket.getEnabledCipherSuites();
    assertEquals(1,protocols.length);
    assertEquals("TLSv1.1",protocols[0]);
    assertEquals(2,algorithms.length);
    assertThat(algorithms,arrayContainingInAnyOrder("TLS_RSA_WITH_AES_128_CBC_SHA","TLS_RSA_WITH_AES_128_CBC_SHA256"));
  }
 }
