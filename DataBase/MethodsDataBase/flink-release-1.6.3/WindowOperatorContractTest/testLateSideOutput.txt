@Test public void testLateSideOutput() throws Exception {
  OutputTag<Integer> lateOutputTag=new OutputTag<Integer>("late"){
  }
;
  WindowAssigner<Integer,TimeWindow> mockAssigner=mockTimeWindowAssigner();
  Trigger<Integer,TimeWindow> mockTrigger=mockTrigger();
  InternalWindowFunction<Iterable<Integer>,Void,Integer,TimeWindow> mockWindowFunction=mockWindowFunction();
  OneInputStreamOperatorTestHarness<Integer,Void> testHarness=createWindowOperator(mockAssigner,mockTrigger,0L,mockWindowFunction,lateOutputTag);
  testHarness.open();
  when(mockAssigner.assignWindows(anyInt(),anyLong(),anyAssignerContext())).thenReturn(Collections.singletonList(new TimeWindow(0,0)));
  testHarness.processWatermark(20);
  testHarness.processElement(new StreamRecord<>(0,5L));
  verify(mockAssigner,times(1)).assignWindows(eq(0),eq(5L),anyAssignerContext());
  assertThat(testHarness.getSideOutput(lateOutputTag),contains(isStreamRecord(0,5L)));
  when(mockAssigner.assignWindows(anyInt(),anyLong(),anyAssignerContext())).thenReturn(Collections.<TimeWindow>emptyList());
  testHarness.processElement(new StreamRecord<>(0,10L));
  verify(mockAssigner,times(1)).assignWindows(eq(0),eq(5L),anyAssignerContext());
  verify(mockAssigner,times(1)).assignWindows(eq(0),eq(10L),anyAssignerContext());
  assertThat(testHarness.getSideOutput(lateOutputTag),contains(isStreamRecord(0,5L),isStreamRecord(0,10L)));
}
