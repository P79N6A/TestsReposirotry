@Test public void testCancelWhileFailing() throws Exception {
  final RestartStrategy restartStrategy=new InfiniteDelayRestartStrategy();
  final ExecutionGraph graph=createExecutionGraph(restartStrategy).f0;
  assertEquals(JobStatus.RUNNING,graph.getState());
  for (  ExecutionVertex vertex : graph.getVerticesTopologically().iterator().next().getTaskVertices()) {
    vertex.getCurrentExecutionAttempt().switchToRunning();
  }
  graph.failGlobal(new Exception("test"));
  assertEquals(JobStatus.FAILING,graph.getState());
  graph.cancel();
  assertEquals(JobStatus.CANCELLING,graph.getState());
  completeCanceling(graph);
  assertEquals(JobStatus.CANCELED,graph.getState());
}
