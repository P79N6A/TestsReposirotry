@Test public void testWakeupWakesOnlyOnce() throws Exception {
  final Handover handover=new Handover();
  handover.produce(createTestRecords());
  handover.wakeupProducer();
  try {
    handover.produce(createTestRecords());
    fail();
  }
 catch (  WakeupException e) {
  }
  CheckedThread producer=new CheckedThread(){
    @Override public void go() throws Exception {
      handover.produce(createTestRecords());
    }
  }
;
  producer.start();
  producer.waitUntilThreadHoldsLock(10000);
  assertNotNull(handover.pollNext());
  producer.sync();
}
