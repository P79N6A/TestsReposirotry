@Test public void testGetStatisticsMultipleOneFileWithCachedVersion() throws IOException {
  FileSystem fs=FileSystem.getLocalFileSystem();
  final long size1=50873;
  final long fakeSize=10065;
  String tempFile1=TestFileUtils.createTempFile(size1);
  final long lastModTime1=fs.getFileStatus(new Path(tempFile1)).getModificationTime();
  final long size2=52573;
  String tempFile2=TestFileUtils.createTempFile(size2);
  final long lastModTime2=fs.getFileStatus(new Path(tempFile2)).getModificationTime();
  final long sizeTotal=size1 + size2;
  MultiDummyFileInputFormat format=new MultiDummyFileInputFormat();
  format.setFilePaths(tempFile1,tempFile2);
  format.configure(new Configuration());
  FileBaseStatistics stats=format.getStatistics(null);
  Assert.assertEquals("The file size from the statistics is wrong.",sizeTotal,stats.getTotalInputSize());
  format=new MultiDummyFileInputFormat();
  format.setFilePath(tempFile1);
  format.configure(new Configuration());
  FileBaseStatistics newStats=format.getStatistics(stats);
  Assert.assertTrue("Statistics object was changed",newStats == stats);
  format=new MultiDummyFileInputFormat();
  format.setFilePath(tempFile1);
  format.configure(new Configuration());
  FileBaseStatistics fakeStats=new FileBaseStatistics(stats.getLastModificationTime(),fakeSize,BaseStatistics.AVG_RECORD_BYTES_UNKNOWN);
  BaseStatistics latest=format.getStatistics(fakeStats);
  Assert.assertEquals("The file size from the statistics is wrong.",fakeSize,latest.getTotalInputSize());
  format=new MultiDummyFileInputFormat();
  format.setFilePaths(tempFile1,tempFile2);
  format.configure(new Configuration());
  FileBaseStatistics outDatedFakeStats=new FileBaseStatistics(Math.min(lastModTime1,lastModTime2) - 1,fakeSize,BaseStatistics.AVG_RECORD_BYTES_UNKNOWN);
  BaseStatistics reGathered=format.getStatistics(outDatedFakeStats);
  Assert.assertEquals("The file size from the statistics is wrong.",sizeTotal,reGathered.getTotalInputSize());
}
