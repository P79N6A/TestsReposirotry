@Test public void testGetStatisticsMultipleFilesWithCachedVersion(){
  try {
    FileSystem fs=FileSystem.getLocalFileSystem();
    final long SIZE1=2077;
    final long SIZE2=31909;
    final long SIZE3=10;
    final long TOTAL=SIZE1 + SIZE2 + SIZE3;
    final long FAKE_SIZE=10065;
    File tempDirFile=temporaryFolder.newFolder();
    String tempDir=tempDirFile.getAbsolutePath();
    String f1=TestFileUtils.createTempFileInDirectory(tempDir,SIZE1);
    long modTime1=fs.getFileStatus(new Path(f1)).getModificationTime();
    String f2=TestFileUtils.createTempFileInDirectory(tempDir,SIZE2);
    long modTime2=fs.getFileStatus(new Path(f2)).getModificationTime();
    String f3=TestFileUtils.createTempFileInDirectory(tempDir,SIZE3);
    long modTime3=fs.getFileStatus(new Path(f3)).getModificationTime();
    DummyFileInputFormat format=new DummyFileInputFormat();
    format.setFilePath(tempDir);
    format.configure(new Configuration());
    FileBaseStatistics stats=format.getStatistics(null);
    Assert.assertEquals("The file size from the statistics is wrong.",TOTAL,stats.getTotalInputSize());
    format=new DummyFileInputFormat();
    format.setFilePath(tempDir);
    format.configure(new Configuration());
    FileBaseStatistics newStats=format.getStatistics(stats);
    Assert.assertTrue("Statistics object was changed",newStats == stats);
    format=new DummyFileInputFormat();
    format.setFilePath(tempDir);
    format.configure(new Configuration());
    FileBaseStatistics fakeStats=new FileBaseStatistics(stats.getLastModificationTime(),FAKE_SIZE,BaseStatistics.AVG_RECORD_BYTES_UNKNOWN);
    BaseStatistics latest=format.getStatistics(fakeStats);
    Assert.assertEquals("The file size from the statistics is wrong.",FAKE_SIZE,latest.getTotalInputSize());
    format=new DummyFileInputFormat();
    format.setFilePath(tempDir);
    format.configure(new Configuration());
    FileBaseStatistics outDatedFakeStats=new FileBaseStatistics(Math.min(Math.min(modTime1,modTime2),modTime3) - 1,FAKE_SIZE,BaseStatistics.AVG_RECORD_BYTES_UNKNOWN);
    BaseStatistics reGathered=format.getStatistics(outDatedFakeStats);
    Assert.assertEquals("The file size from the statistics is wrong.",TOTAL,reGathered.getTotalInputSize());
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    Assert.fail(ex.getMessage());
  }
}
