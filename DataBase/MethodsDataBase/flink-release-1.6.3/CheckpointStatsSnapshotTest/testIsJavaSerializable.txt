/** 
 * Tests that the snapshot is actually serializable.
 */
@Test public void testIsJavaSerializable() throws Exception {
  CheckpointStatsCounts counts=new CheckpointStatsCounts();
  counts.incrementInProgressCheckpoints();
  counts.incrementInProgressCheckpoints();
  counts.incrementInProgressCheckpoints();
  counts.incrementCompletedCheckpoints();
  counts.incrementFailedCheckpoints();
  counts.incrementRestoredCheckpoints();
  CompletedCheckpointStatsSummary summary=new CompletedCheckpointStatsSummary();
  summary.updateSummary(createCompletedCheckpointsStats(12398,9919,12));
  summary.updateSummary(createCompletedCheckpointsStats(2221,3333,9122));
  CheckpointStatsHistory history=new CheckpointStatsHistory(1);
  RestoredCheckpointStats restored=new RestoredCheckpointStats(1,CheckpointProperties.forCheckpoint(CheckpointRetentionPolicy.NEVER_RETAIN_AFTER_TERMINATION),99119,null);
  CheckpointStatsSnapshot snapshot=new CheckpointStatsSnapshot(counts,summary,history,restored);
  CheckpointStatsSnapshot copy=CommonTestUtils.createCopySerializable(snapshot);
  assertEquals(counts.getNumberOfCompletedCheckpoints(),copy.getCounts().getNumberOfCompletedCheckpoints());
  assertEquals(counts.getNumberOfFailedCheckpoints(),copy.getCounts().getNumberOfFailedCheckpoints());
  assertEquals(counts.getNumberOfInProgressCheckpoints(),copy.getCounts().getNumberOfInProgressCheckpoints());
  assertEquals(counts.getNumberOfRestoredCheckpoints(),copy.getCounts().getNumberOfRestoredCheckpoints());
  assertEquals(counts.getTotalNumberOfCheckpoints(),copy.getCounts().getTotalNumberOfCheckpoints());
  assertEquals(summary.getStateSizeStats().getSum(),copy.getSummaryStats().getStateSizeStats().getSum());
  assertEquals(summary.getEndToEndDurationStats().getSum(),copy.getSummaryStats().getEndToEndDurationStats().getSum());
  assertEquals(summary.getAlignmentBufferedStats().getSum(),copy.getSummaryStats().getAlignmentBufferedStats().getSum());
  assertEquals(restored.getCheckpointId(),copy.getLatestRestoredCheckpoint().getCheckpointId());
}
