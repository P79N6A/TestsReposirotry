@Test public void testCheckpointWithMasterAndTaskState() throws Exception {
  final Random rnd=new Random();
  final int maxNumMasterStates=5;
  final int maxTaskStates=20;
  final int maxNumSubtasks=20;
  for (int i=0; i < 100; ++i) {
    final long checkpointId=rnd.nextLong() & 0x7fffffffffffffffL;
    final int numTasks=rnd.nextInt(maxTaskStates) + 1;
    final int numSubtasks=rnd.nextInt(maxNumSubtasks) + 1;
    final Collection<OperatorState> taskStates=CheckpointTestUtils.createOperatorStates(rnd,numTasks,numSubtasks);
    final int numMasterStates=rnd.nextInt(maxNumMasterStates) + 1;
    final Collection<MasterState> masterStates=CheckpointTestUtils.createRandomMasterStates(rnd,numMasterStates);
    testCheckpointSerialization(checkpointId,taskStates,masterStates);
  }
}
