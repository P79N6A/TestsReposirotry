@Test public void testAggregatingStateInstantiation() throws Exception {
  final ExecutionConfig config=new ExecutionConfig();
  config.registerKryoType(Path.class);
  final AtomicReference<Object> descriptorCapture=new AtomicReference<>();
  StreamingRuntimeContext context=new StreamingRuntimeContext(createDescriptorCapturingMockOp(descriptorCapture,config),createMockEnvironment(),Collections.<String,Accumulator<?,?>>emptyMap());
  @SuppressWarnings("unchecked") AggregateFunction<String,TaskInfo,String> aggregate=(AggregateFunction<String,TaskInfo,String>)mock(AggregateFunction.class);
  AggregatingStateDescriptor<String,TaskInfo,String> descr=new AggregatingStateDescriptor<>("name",aggregate,TaskInfo.class);
  context.getAggregatingState(descr);
  AggregatingStateDescriptor<?,?,?> descrIntercepted=(AggregatingStateDescriptor<?,?,?>)descriptorCapture.get();
  TypeSerializer<?> serializer=descrIntercepted.getSerializer();
  assertTrue(serializer instanceof KryoSerializer);
  assertTrue(((KryoSerializer<?>)serializer).getKryo().getRegistration(Path.class).getId() > 0);
}
