@Test public void testNextStringEndPos() throws Exception {
  FieldParser parser=new TestFieldParser<String>();
  byte[] singleCharDelim="|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  byte[] bytes1="a|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  assertEquals(1,parser.nextStringEndPos(bytes1,0,bytes1.length,singleCharDelim));
  assertEquals(-1,parser.nextStringEndPos(bytes1,1,bytes1.length,singleCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(bytes1,1,1,singleCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(bytes1,2,bytes1.length,singleCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  byte[] bytes2="a||".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(bytes2,1,bytes2.length,singleCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  byte[] bytes3="a|c".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(bytes3,1,bytes3.length,singleCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  parser.resetParserState();
  assertEquals(3,parser.nextStringEndPos(bytes3,2,bytes3.length,singleCharDelim));
  assertEquals(ParseErrorState.NONE,parser.getErrorState());
  byte[] bytes4="a|c|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(3,parser.nextStringEndPos(bytes4,2,bytes4.length,singleCharDelim));
  assertEquals(ParseErrorState.NONE,parser.getErrorState());
  byte[] multiCharDelim="|#|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  byte[] mBytes1="a|#|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(1,parser.nextStringEndPos(mBytes1,0,mBytes1.length,multiCharDelim));
  assertEquals(-1,parser.nextStringEndPos(mBytes1,1,mBytes1.length,multiCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(mBytes1,1,1,multiCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  byte[] mBytes2="a|#||#|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(mBytes2,1,mBytes2.length,multiCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  byte[] mBytes3="a|#|b".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(-1,parser.nextStringEndPos(mBytes3,1,mBytes3.length,multiCharDelim));
  assertEquals(ParseErrorState.EMPTY_COLUMN,parser.getErrorState());
  parser.resetParserState();
  assertEquals(5,parser.nextStringEndPos(mBytes3,2,mBytes3.length,multiCharDelim));
  assertEquals(ParseErrorState.NONE,parser.getErrorState());
  byte[] mBytes4="a|#|b|#|".getBytes(ConfigConstants.DEFAULT_CHARSET);
  parser.resetParserState();
  assertEquals(5,parser.nextStringEndPos(mBytes4,2,mBytes4.length,multiCharDelim));
  assertEquals(ParseErrorState.NONE,parser.getErrorState());
}
