@Test public void testInterruptHandledCorrectly() throws Exception {
  ResourceGuard resourceGuard=new ResourceGuard();
  ResourceGuard.Lease lease=resourceGuard.acquireResource();
  AtomicBoolean checker=new AtomicBoolean(true);
  Thread closerThread=new Thread(){
    @Override public void run(){
      resourceGuard.close();
      checker.set(false);
    }
  }
;
  closerThread.start();
  while (!resourceGuard.isClosed()) {
    Thread.yield();
  }
  closerThread.interrupt();
  closerThread.join(100);
  Assert.assertTrue(checker.get());
  lease.close();
  closerThread.join(60_000);
  Assert.assertFalse(checker.get());
}
