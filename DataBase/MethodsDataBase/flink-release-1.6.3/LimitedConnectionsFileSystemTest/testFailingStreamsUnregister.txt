@Test public void testFailingStreamsUnregister() throws Exception {
  final LimitedConnectionsFileSystem fs=new LimitedConnectionsFileSystem(new FailFs(),1);
  assertEquals(0,fs.getNumberOfOpenInputStreams());
  assertEquals(0,fs.getNumberOfOpenOutputStreams());
  assertEquals(0,fs.getTotalNumberOfOpenStreams());
  try {
    fs.open(new Path(tempFolder.newFile().toURI()));
    fail("this is expected to fail with an exception");
  }
 catch (  IOException e) {
  }
  try {
    fs.create(new Path(tempFolder.newFile().toURI()),WriteMode.NO_OVERWRITE);
    fail("this is expected to fail with an exception");
  }
 catch (  IOException e) {
  }
  assertEquals(0,fs.getNumberOfOpenInputStreams());
  assertEquals(0,fs.getNumberOfOpenOutputStreams());
  assertEquals(0,fs.getTotalNumberOfOpenStreams());
}
