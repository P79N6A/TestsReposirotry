@Test public void testLimitingMixedStreams() throws Exception {
  final int maxConcurrentOpen=2;
  final int numThreads=61;
  final LimitedConnectionsFileSystem limitedFs=new LimitedConnectionsFileSystem(LocalFileSystem.getSharedInstance(),maxConcurrentOpen);
  final Random rnd=new Random();
  final CheckedThread[] threads=new CheckedThread[numThreads];
  for (int i=0; i < numThreads; i++) {
    File file=tempFolder.newFile();
    Path path=new Path(file.toURI());
    if (rnd.nextBoolean()) {
      createRandomContents(file,rnd);
      threads[i]=new ReaderThread(limitedFs,path,Integer.MAX_VALUE,maxConcurrentOpen);
    }
 else {
      threads[i]=new WriterThread(limitedFs,path,Integer.MAX_VALUE,maxConcurrentOpen);
    }
  }
  for (  CheckedThread t : threads) {
    t.start();
  }
  for (  CheckedThread t : threads) {
    t.sync();
  }
}
