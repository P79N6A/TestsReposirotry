@Test public void testConnectedComponentsWithParametrizableConvergence() throws Exception {
  final String updatedElements="updated.elements.aggr";
  final long convergenceThreshold=3;
  final ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  DataSet<Tuple2<Long,Long>> initialSolutionSet=env.fromCollection(verticesInput);
  DataSet<Tuple2<Long,Long>> edges=env.fromCollection(edgesInput);
  IterativeDataSet<Tuple2<Long,Long>> iteration=initialSolutionSet.iterate(10);
  iteration.registerAggregationConvergenceCriterion(updatedElements,new LongSumAggregator(),new UpdatedElementsConvergenceCriterion(convergenceThreshold));
  DataSet<Tuple2<Long,Long>> verticesWithNewComponents=iteration.join(edges).where(0).equalTo(0).with(new NeighborWithComponentIDJoin()).groupBy(0).min(1);
  DataSet<Tuple2<Long,Long>> updatedComponentId=verticesWithNewComponents.join(iteration).where(0).equalTo(0).flatMap(new MinimumIdFilter(updatedElements));
  List<Tuple2<Long,Long>> result=iteration.closeWith(updatedComponentId).collect();
  Collections.sort(result,new TestBaseUtils.TupleComparator<Tuple2<Long,Long>>());
  assertEquals(expectedResult,result);
}
