@Test public void testDeltaConnectedComponentsWithParametrizableConvergence() throws Exception {
  final String updatedElements="updated.elements.aggr";
  final long convergenceThreshold=3;
  final ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  DataSet<Tuple2<Long,Long>> initialSolutionSet=env.fromCollection(verticesInput);
  DataSet<Tuple2<Long,Long>> edges=env.fromCollection(edgesInput);
  DeltaIteration<Tuple2<Long,Long>,Tuple2<Long,Long>> iteration=initialSolutionSet.iterateDelta(initialSolutionSet,10,0);
  iteration.registerAggregationConvergenceCriterion(updatedElements,new LongSumAggregator(),new UpdatedElementsConvergenceCriterion(convergenceThreshold));
  DataSet<Tuple2<Long,Long>> verticesWithNewComponents=iteration.getWorkset().join(edges).where(0).equalTo(0).with(new NeighborWithComponentIDJoin()).groupBy(0).min(1);
  DataSet<Tuple2<Long,Long>> updatedComponentId=verticesWithNewComponents.join(iteration.getSolutionSet()).where(0).equalTo(0).flatMap(new MinimumIdFilter(updatedElements));
  List<Tuple2<Long,Long>> result=iteration.closeWith(updatedComponentId,updatedComponentId).collect();
  Collections.sort(result,new TestBaseUtils.TupleComparator<Tuple2<Long,Long>>());
  assertEquals(expectedResult,result);
}
