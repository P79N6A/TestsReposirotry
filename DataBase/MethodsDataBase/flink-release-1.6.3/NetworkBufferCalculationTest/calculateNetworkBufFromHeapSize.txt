/** 
 * Test for  {@link TaskManagerServices#calculateNetworkBufferMemory(TaskManagerServicesConfiguration,long)}using the same (manual) test cases as in  {@link TaskManagerServicesTest#calculateHeapSizeMB()}.
 */
@Test public void calculateNetworkBufFromHeapSize() throws Exception {
  TaskManagerServicesConfiguration tmConfig;
  tmConfig=getTmConfig(Long.valueOf(TaskManagerOptions.MANAGED_MEMORY_SIZE.defaultValue()),TaskManagerOptions.MANAGED_MEMORY_FRACTION.defaultValue(),0.1f,60L << 20,1L << 30,MemoryType.HEAP);
  assertEquals((100L << 20) + 1,TaskManagerServices.calculateNetworkBufferMemory(tmConfig,900L << 20));
  tmConfig=getTmConfig(Long.valueOf(TaskManagerOptions.MANAGED_MEMORY_SIZE.defaultValue()),TaskManagerOptions.MANAGED_MEMORY_FRACTION.defaultValue(),0.2f,60L << 20,1L << 30,MemoryType.HEAP);
  assertEquals((200L << 20) + 3,TaskManagerServices.calculateNetworkBufferMemory(tmConfig,800L << 20));
  tmConfig=getTmConfig(10,TaskManagerOptions.MANAGED_MEMORY_FRACTION.defaultValue(),0.1f,60L << 20,1L << 30,MemoryType.OFF_HEAP);
  assertEquals((100L << 20) + 1,TaskManagerServices.calculateNetworkBufferMemory(tmConfig,890L << 20));
  tmConfig=getTmConfig(-1,0.1f,0.1f,60L << 20,1L << 30,MemoryType.OFF_HEAP);
  assertEquals((100L << 20) + 1,TaskManagerServices.calculateNetworkBufferMemory(tmConfig,810L << 20));
}
