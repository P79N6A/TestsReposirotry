@Test public void testBulkRead() throws IOException {
  final byte[] data={34,25,22,66};
  final ByteStreamStateHandle handle=new ByteStreamStateHandle("name",data);
  final int targetLen=8;
  for (int start=0; start < data.length; start++) {
    for (int num=0; num < targetLen; num++) {
      FSDataInputStream in=handle.openInputStream();
      in.seek(start);
      final byte[] target=new byte[targetLen];
      final int read=in.read(target,targetLen - num,num);
      assertEquals(Math.min(num,data.length - start),read);
      for (int i=0; i < read; i++) {
        assertEquals(data[start + i],target[targetLen - num + i]);
      }
      int newPos=start + read;
      assertEquals(newPos,(int)in.getPos());
      assertEquals(newPos < data.length ? data[newPos] : -1,in.read());
    }
  }
}
