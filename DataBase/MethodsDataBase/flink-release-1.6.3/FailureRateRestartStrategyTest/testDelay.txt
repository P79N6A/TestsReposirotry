@Test public void testDelay() throws Exception {
  final long restartDelay=2;
  final int numberRestarts=10;
  final FailureRateRestartStrategy strategy=new FailureRateRestartStrategy(numberRestarts + 1,Time.milliseconds(1),Time.milliseconds(restartDelay));
  for (int restartsLeft=numberRestarts; restartsLeft > 0; --restartsLeft) {
    assertTrue(strategy.canRestart());
    final OneShotLatch sync=new OneShotLatch();
    final RestartCallback restarter=new LatchedRestarter(sync);
    final long time=System.nanoTime();
    strategy.restart(restarter,executor);
    sync.await();
    final long elapsed=System.nanoTime() - time;
    assertTrue("Not enough delay",elapsed >= restartDelay * 1_000_000);
  }
}
