@Test public void testExceptionOnReordering() throws Exception {
  final SingleInputGate inputGate=mock(SingleInputGate.class);
  final RemoteInputChannel inputChannel=createRemoteInputChannel(inputGate);
  final Buffer buffer=TestBufferFactory.createBuffer(TestBufferFactory.BUFFER_SIZE);
  inputChannel.onBuffer(buffer.retainBuffer(),0,-1);
  inputChannel.onBuffer(buffer,29,-1);
  try {
    inputChannel.getNextBuffer();
    fail("Did not throw expected exception after enqueuing an out-of-order buffer.");
  }
 catch (  Exception expected) {
    assertFalse(buffer.isRecycled());
    inputChannel.releaseAllResources();
    assertTrue(buffer.isRecycled());
  }
  verify(inputGate,times(2)).notifyChannelNonEmpty(eq(inputChannel));
}
