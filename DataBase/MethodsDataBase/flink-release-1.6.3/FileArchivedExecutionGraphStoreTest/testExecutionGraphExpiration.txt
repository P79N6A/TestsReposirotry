/** 
 * Tests that an expired execution graph is removed from the execution graph store.
 */
@Test public void testExecutionGraphExpiration() throws Exception {
  final File rootDir=temporaryFolder.newFolder();
  final Time expirationTime=Time.milliseconds(1L);
  final ManuallyTriggeredScheduledExecutor scheduledExecutor=new ManuallyTriggeredScheduledExecutor();
  final ManualTicker manualTicker=new ManualTicker();
  try (final FileArchivedExecutionGraphStore executionGraphStore=new FileArchivedExecutionGraphStore(rootDir,expirationTime,10000L,scheduledExecutor,manualTicker)){
    final ArchivedExecutionGraph executionGraph=new ArchivedExecutionGraphBuilder().setState(JobStatus.FINISHED).build();
    executionGraphStore.put(executionGraph);
    assertThat(executionGraphStore.size(),Matchers.equalTo(1));
    manualTicker.advanceTime(expirationTime.toMilliseconds(),TimeUnit.MILLISECONDS);
    scheduledExecutor.triggerScheduledTasks();
    assertThat(executionGraphStore.size(),Matchers.equalTo(0));
    assertThat(executionGraphStore.get(executionGraph.getJobID()),Matchers.nullValue());
    final File storageDirectory=executionGraphStore.getStorageDir();
    assertThat(storageDirectory.listFiles().length,Matchers.equalTo(0));
  }
 }
