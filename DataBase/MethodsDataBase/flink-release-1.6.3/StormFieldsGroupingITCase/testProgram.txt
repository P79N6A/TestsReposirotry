@Test public void testProgram() throws Exception {
  String resultPath=this.getTempDirPath("result");
  final String[] tokens=resultPath.split(":");
  final String outputFile=tokens[tokens.length - 1];
  final TopologyBuilder builder=new TopologyBuilder();
  builder.setSpout(spoutId,new FiniteRandomSpout(0,10,2));
  builder.setBolt(boltId,new TaskIdBolt(),2).fieldsGrouping(spoutId,FiniteRandomSpout.STREAM_PREFIX + 0,new Fields("number"));
  builder.setBolt(sinkId,new BoltFileSink(outputFile)).shuffleGrouping(boltId);
  final FlinkLocalCluster cluster=FlinkLocalCluster.getLocalCluster();
  Config conf=new Config();
  conf.put(FlinkLocalCluster.SUBMIT_BLOCKING,true);
  cluster.submitTopology(topologyId,conf,FlinkTopology.createTopology(builder));
  cluster.shutdown();
  List<String> expectedResults=Arrays.asList("-1155484576","1033096058","-1930858313","1431162155","-1557280266","-1728529858","1654374947","-65105105","-518907128","-252332814");
  List<String> actualResults=new ArrayList<>();
  readAllResultLines(actualResults,resultPath,new String[0],false);
  for (int i=0; i < actualResults.size(); ++i) {
    String s=actualResults.get(i);
    if (s.contains(">")) {
      s=s.substring(s.indexOf(">") + 2);
      actualResults.set(i,s);
    }
  }
  Assert.assertEquals(expectedResults.size(),actualResults.size());
  Collections.sort(actualResults);
  Collections.sort(expectedResults);
  System.out.println(actualResults);
  for (int i=0; i < actualResults.size(); ++i) {
    Assert.assertEquals(expectedResults.get(i),actualResults.get(i));
  }
}
