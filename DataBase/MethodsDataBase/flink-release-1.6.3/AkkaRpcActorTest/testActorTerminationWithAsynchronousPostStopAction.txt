/** 
 * Tests that the  {@link AkkaRpcActor} only completes after the asynchronouspost stop action has completed.
 */
@Test public void testActorTerminationWithAsynchronousPostStopAction() throws Exception {
  final CompletableFuture<Void> postStopFuture=new CompletableFuture<>();
  final AsynchronousPostStopEndpoint endpoint=new AsynchronousPostStopEndpoint(akkaRpcService,postStopFuture);
  try {
    endpoint.start();
    final CompletableFuture<Void> terminationFuture=endpoint.getTerminationFuture();
    endpoint.shutDown();
    assertFalse(terminationFuture.isDone());
    postStopFuture.complete(null);
    terminationFuture.get();
  }
  finally {
    RpcUtils.terminateRpcEndpoint(endpoint,timeout);
  }
}
