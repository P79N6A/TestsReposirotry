/** 
 * Test that failing in state restarting will retrigger the restarting logic. This means that it only goes into the state FAILED after the restart strategy says the job is no longer restartable.
 */
@Test public void testFailureWhileRestarting() throws Exception {
  final ExecutionGraph eg=ExecutionGraphTestUtils.createSimpleTestGraph(new InfiniteDelayRestartStrategy(2));
  eg.scheduleForExecution();
  assertEquals(JobStatus.RUNNING,eg.getState());
  ExecutionGraphTestUtils.switchAllVerticesToRunning(eg);
  eg.failGlobal(new Exception("Test 1"));
  assertEquals(JobStatus.FAILING,eg.getState());
  ExecutionGraphTestUtils.completeCancellingForAllVertices(eg);
  assertEquals(JobStatus.RESTARTING,eg.getState());
  eg.failGlobal(new Exception("Test 2"));
  assertEquals(JobStatus.RESTARTING,eg.getState());
  eg.failGlobal(new Exception("Test 3"));
  assertEquals(JobStatus.FAILED,eg.getState());
}
