/** 
 * Tests that a  {@link SuppressRestartsException} in state RESTARTING stops the restartingimmediately and sets the execution graph's state to FAILED.
 */
@Test public void testSuppressRestartFailureWhileRestarting() throws Exception {
  final ExecutionGraph eg=ExecutionGraphTestUtils.createSimpleTestGraph(new InfiniteDelayRestartStrategy(10));
  eg.scheduleForExecution();
  assertEquals(JobStatus.RUNNING,eg.getState());
  ExecutionGraphTestUtils.switchAllVerticesToRunning(eg);
  eg.failGlobal(new Exception("test"));
  assertEquals(JobStatus.FAILING,eg.getState());
  ExecutionGraphTestUtils.completeCancellingForAllVertices(eg);
  assertEquals(JobStatus.RESTARTING,eg.getState());
  eg.failGlobal(new SuppressRestartsException(new Exception("Test")));
  assertEquals(JobStatus.FAILED,eg.getState());
}
