@Test public void testBroadcastStateMetaInfoReadSerializerFailureResilience() throws Exception {
  String broadcastName="broadcastTest";
  TypeSerializer<?> keySerializer=DoubleSerializer.INSTANCE;
  TypeSerializer<?> valueSerializer=StringSerializer.INSTANCE;
  StateMetaInfoSnapshot snapshot=new RegisteredBroadcastStateBackendMetaInfo<>(broadcastName,OperatorStateHandle.Mode.BROADCAST,keySerializer,valueSerializer).snapshot();
  byte[] serialized;
  try (ByteArrayOutputStreamWithPos out=new ByteArrayOutputStreamWithPos()){
    StateMetaInfoSnapshotReadersWriters.getWriter().writeStateMetaInfoSnapshot(snapshot,new DataOutputViewStreamWrapper(out));
    serialized=out.toByteArray();
  }
   Set<String> cnfThrowingSerializerClasses=new HashSet<>();
  cnfThrowingSerializerClasses.add(DoubleSerializer.class.getName());
  cnfThrowingSerializerClasses.add(StringSerializer.class.getName());
  try (ByteArrayInputStreamWithPos in=new ByteArrayInputStreamWithPos(serialized)){
    final StateMetaInfoReader reader=StateMetaInfoSnapshotReadersWriters.getReader(CURRENT_STATE_META_INFO_SNAPSHOT_VERSION,StateMetaInfoSnapshotReadersWriters.StateTypeHint.OPERATOR_STATE);
    final ClassLoader classLoader=new ArtificialCNFExceptionThrowingClassLoader(Thread.currentThread().getContextClassLoader(),cnfThrowingSerializerClasses);
    snapshot=reader.readStateMetaInfoSnapshot(new DataInputViewStreamWrapper(in),classLoader);
  }
   RegisteredBroadcastStateBackendMetaInfo<?,?> restoredMetaInfo=new RegisteredBroadcastStateBackendMetaInfo<>(snapshot);
  Assert.assertEquals(broadcastName,restoredMetaInfo.getName());
  Assert.assertEquals(OperatorStateHandle.Mode.BROADCAST,restoredMetaInfo.getAssignmentMode());
  Assert.assertTrue(restoredMetaInfo.getKeySerializer() instanceof UnloadableDummyTypeSerializer);
  Assert.assertEquals(keySerializer.snapshotConfiguration(),snapshot.getTypeSerializerConfigSnapshot(StateMetaInfoSnapshot.CommonSerializerKeys.KEY_SERIALIZER));
  Assert.assertTrue(restoredMetaInfo.getValueSerializer() instanceof UnloadableDummyTypeSerializer);
  Assert.assertEquals(valueSerializer.snapshotConfiguration(),snapshot.getTypeSerializerConfigSnapshot(StateMetaInfoSnapshot.CommonSerializerKeys.VALUE_SERIALIZER));
}
