@Test public void testSimpleSuccessfulRegistration() throws Exception {
  final String testId="laissez les bon temps roulez";
  final String testEndpointAddress="<test-address>";
  final UUID leaderId=UUID.randomUUID();
  TestRegistrationGateway testGateway=new TestRegistrationGateway(new TestRegistrationSuccess(testId));
  try {
    rpcService.registerGateway(testEndpointAddress,testGateway);
    TestRetryingRegistration registration=new TestRetryingRegistration(rpcService,testEndpointAddress,leaderId);
    registration.startRegistration();
    CompletableFuture<Tuple2<TestRegistrationGateway,TestRegistrationSuccess>> future=registration.getFuture();
    assertNotNull(future);
    assertEquals(future,registration.getFuture());
    Tuple2<TestRegistrationGateway,TestRegistrationSuccess> success=future.get(10L,TimeUnit.SECONDS);
    assertEquals(testId,success.f1.getCorrelationId());
    assertEquals(leaderId,testGateway.getInvocations().take().leaderId());
  }
  finally {
    testGateway.stop();
  }
}
