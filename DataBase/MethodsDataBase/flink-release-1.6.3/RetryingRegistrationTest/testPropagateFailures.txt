@Test public void testPropagateFailures() throws Exception {
  final String testExceptionMessage="testExceptionMessage";
  RpcService rpc=mock(RpcService.class);
  when(rpc.connect(anyString(),any(Class.class))).thenThrow(new RuntimeException(testExceptionMessage));
  TestRetryingRegistration registration=new TestRetryingRegistration(rpc,"testaddress",UUID.randomUUID());
  registration.startRegistration();
  CompletableFuture<?> future=registration.getFuture();
  assertTrue(future.isDone());
  try {
    future.get();
    fail("We expected an ExecutionException.");
  }
 catch (  ExecutionException e) {
    assertEquals(testExceptionMessage,e.getCause().getMessage());
  }
}
