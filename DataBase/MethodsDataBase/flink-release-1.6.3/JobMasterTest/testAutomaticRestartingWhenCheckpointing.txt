/** 
 * Tests that in a streaming use case where checkpointing is enabled, a fixed delay with Integer.MAX_VALUE retries is instantiated if no other restart strategy has been specified.
 */
@Test public void testAutomaticRestartingWhenCheckpointing() throws Exception {
  final long savepointId=42L;
  final File savepointFile=createSavepoint(savepointId);
  final SavepointRestoreSettings savepointRestoreSettings=SavepointRestoreSettings.forPath(savepointFile.getAbsolutePath(),true);
  final JobGraph jobGraph=createJobGraphWithCheckpointing(savepointRestoreSettings);
  final StandaloneCompletedCheckpointStore completedCheckpointStore=new StandaloneCompletedCheckpointStore(1);
  final TestingCheckpointRecoveryFactory testingCheckpointRecoveryFactory=new TestingCheckpointRecoveryFactory(completedCheckpointStore,new StandaloneCheckpointIDCounter());
  haServices.setCheckpointRecoveryFactory(testingCheckpointRecoveryFactory);
  final JobMaster jobMaster=createJobMaster(new Configuration(),jobGraph,haServices,new TestingJobManagerSharedServicesBuilder().setRestartStrategyFactory(RestartStrategyFactory.createRestartStrategyFactory(configuration)).build());
  RestartStrategy restartStrategy=jobMaster.getRestartStrategy();
  assertNotNull(restartStrategy);
  assertTrue(restartStrategy instanceof FixedDelayRestartStrategy);
}
