/** 
 * Tests broadcasting events when no records have been emitted yet.
 */
@Test public void testBroadcastEventNoRecords() throws Exception {
  int numChannels=4;
  int bufferSize=32;
  @SuppressWarnings("unchecked") Queue<BufferConsumer>[] queues=new Queue[numChannels];
  for (int i=0; i < numChannels; i++) {
    queues[i]=new ArrayDeque<>();
  }
  TestPooledBufferProvider bufferProvider=new TestPooledBufferProvider(Integer.MAX_VALUE,bufferSize);
  ResultPartitionWriter partitionWriter=new CollectingPartitionWriter(queues,bufferProvider);
  RecordWriter<ByteArrayIO> writer=new RecordWriter<>(partitionWriter,new RoundRobin<ByteArrayIO>());
  CheckpointBarrier barrier=new CheckpointBarrier(Integer.MAX_VALUE + 919192L,Integer.MAX_VALUE + 18828228L,CheckpointOptions.forCheckpointWithDefaultLocation());
  writer.broadcastEvent(barrier);
  assertEquals(0,bufferProvider.getNumberOfCreatedBuffers());
  for (int i=0; i < numChannels; i++) {
    assertEquals(1,queues[i].size());
    BufferOrEvent boe=parseBuffer(queues[i].remove(),i);
    assertTrue(boe.isEvent());
    assertEquals(barrier,boe.getEvent());
    assertEquals(0,queues[i].size());
  }
}
