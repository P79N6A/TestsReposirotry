@Test public void testDecliningHandler(){
  DeclineDummyEnvironment environment=new DeclineDummyEnvironment();
  CheckpointExceptionHandlerFactory checkpointExceptionHandlerFactory=new CheckpointExceptionHandlerFactory();
  CheckpointExceptionHandler exceptionHandler=checkpointExceptionHandlerFactory.createCheckpointExceptionHandler(false,environment);
  CheckpointMetaData failedCheckpointMetaData=new CheckpointMetaData(42L,4711L);
  Exception testException=new Exception("test");
  try {
    exceptionHandler.tryHandleCheckpointException(failedCheckpointMetaData,testException);
  }
 catch (  Exception e) {
    Assert.fail("Exception not handled, but rethrown.");
  }
  Assert.assertEquals(failedCheckpointMetaData.getCheckpointId(),environment.getLastDeclinedCheckpointId());
  Assert.assertEquals(testException,environment.getLastDeclinedCheckpointCause());
}
