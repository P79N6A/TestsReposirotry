/** 
 * Tests that in detached mode, the  {@link MiniDispatcher} will complete the future thatsignals job termination.
 */
@Test public void testTerminationAfterJobCompletion() throws Exception {
  final MiniDispatcher miniDispatcher=createMiniDispatcher(ClusterEntrypoint.ExecutionMode.DETACHED);
  miniDispatcher.start();
  try {
    dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();
    jobGraphFuture.get();
    resultFuture.complete(archivedExecutionGraph);
    miniDispatcher.getJobTerminationFuture().get();
  }
  finally {
    RpcUtils.terminateRpcEndpoint(miniDispatcher,timeout);
  }
}
