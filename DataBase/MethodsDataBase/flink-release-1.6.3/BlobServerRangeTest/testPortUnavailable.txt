/** 
 * Try allocating on an unavailable port.
 */
@Test(expected=IOException.class) public void testPortUnavailable() throws IOException {
  ServerSocket socket=null;
  try {
    socket=new ServerSocket(0);
  }
 catch (  IOException e) {
    e.printStackTrace();
    Assert.fail("An exception was thrown while preparing the test " + e.getMessage());
  }
  Configuration conf=new Configuration();
  conf.setString(BlobServerOptions.PORT,String.valueOf(socket.getLocalPort()));
  conf.setString(BlobServerOptions.STORAGE_DIRECTORY,temporaryFolder.newFolder().getAbsolutePath());
  try {
    BlobServer server=new BlobServer(conf,new VoidBlobStore());
    server.start();
  }
  finally {
    socket.close();
  }
}
