/** 
 * Give the BlobServer a choice of three ports, where two of them are allocated.
 */
@Test public void testOnePortAvailable() throws IOException {
  int numAllocated=2;
  ServerSocket[] sockets=new ServerSocket[numAllocated];
  for (int i=0; i < numAllocated; i++) {
    try {
      sockets[i]=new ServerSocket(0);
    }
 catch (    IOException e) {
      e.printStackTrace();
      Assert.fail("An exception was thrown while preparing the test " + e.getMessage());
    }
  }
  int availablePort=NetUtils.getAvailablePort();
  Configuration conf=new Configuration();
  conf.setString(BlobServerOptions.PORT,sockets[0].getLocalPort() + "," + sockets[1].getLocalPort()+ ","+ availablePort);
  conf.setString(BlobServerOptions.STORAGE_DIRECTORY,temporaryFolder.newFolder().getAbsolutePath());
  try {
    BlobServer server=new BlobServer(conf,new VoidBlobStore());
    server.start();
    Assert.assertEquals(availablePort,server.getPort());
    server.close();
  }
  finally {
    for (int i=0; i < numAllocated; ++i) {
      sockets[i].close();
    }
  }
}
