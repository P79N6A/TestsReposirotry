@Test public void testCassandraBatchTupleFormat() throws Exception {
  OutputFormat<Tuple3<String,Integer,Integer>> sink=new CassandraOutputFormat<>(injectTableName(INSERT_DATA_QUERY),builder);
  sink.configure(new Configuration());
  sink.open(0,1);
  for (  Tuple3<String,Integer,Integer> value : collection) {
    sink.writeRecord(value);
  }
  sink.close();
  sink=new CassandraTupleOutputFormat<>(injectTableName(INSERT_DATA_QUERY),builder);
  sink.configure(new Configuration());
  sink.open(0,1);
  for (  Tuple3<String,Integer,Integer> value : collection) {
    sink.writeRecord(value);
  }
  sink.close();
  InputFormat<Tuple3<String,Integer,Integer>,InputSplit> source=new CassandraInputFormat<>(injectTableName(SELECT_DATA_QUERY),builder);
  source.configure(new Configuration());
  source.open(null);
  List<Tuple3<String,Integer,Integer>> result=new ArrayList<>();
  while (!source.reachedEnd()) {
    result.add(source.nextRecord(new Tuple3<String,Integer,Integer>()));
  }
  source.close();
  Assert.assertEquals(20,result.size());
}
