@Test public void testCassandraTableSink() throws Exception {
  StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  env.setParallelism(4);
  StreamTableEnvironment tEnv=StreamTableEnvironment.getTableEnvironment(env);
  DataStreamSource<Row> source=env.fromCollection(rowCollection);
  tEnv.registerDataStreamInternal("testFlinkTable",source);
  tEnv.sql("select * from testFlinkTable").writeToSink(new CassandraAppendTableSink(builder,injectTableName(INSERT_DATA_QUERY)));
  env.execute();
  ResultSet rs=session.execute(injectTableName(SELECT_DATA_QUERY));
  List<Row> input=new ArrayList<>(rowCollection);
  List<com.datastax.driver.core.Row> output=rs.all();
  for (  com.datastax.driver.core.Row o : output) {
    Row cmp=new Row(3);
    cmp.setField(0,o.getString(0));
    cmp.setField(1,o.getInt(2));
    cmp.setField(2,o.getInt(1));
    Assert.assertTrue("Row " + cmp + " was written to Cassandra but not in input.",input.remove(cmp));
  }
  Assert.assertTrue("The input data was not completely written to Cassandra",input.isEmpty());
}
