/** 
 * Tests that state handles are correctly removed.
 */
@Test public void testRemove() throws Exception {
  LongStateStorage stateHandleProvider=new LongStateStorage();
  ZooKeeperStateHandleStore<Long> store=new ZooKeeperStateHandleStore<>(ZOOKEEPER.getClient(),stateHandleProvider);
  final String pathInZooKeeper="/testRemove";
  final Long state=27255442L;
  store.addAndLock(pathInZooKeeper,state);
  final int numberOfGlobalDiscardCalls=LongRetrievableStateHandle.getNumberOfGlobalDiscardCalls();
  store.releaseAndTryRemove(pathInZooKeeper);
  assertEquals(0,ZOOKEEPER.getClient().getChildren().forPath("/").size());
  assertEquals(numberOfGlobalDiscardCalls + 1,LongRetrievableStateHandle.getNumberOfGlobalDiscardCalls());
}
