@Test public void testFailedUpload() throws Exception {
  final Path uploadedFile=jarDir.resolve("Kafka010Example.jar");
  final HandlerRequest<EmptyRequestBody,EmptyMessageParameters> request=createRequest(uploadedFile);
  try {
    jarUploadHandler.handleRequest(request,mockDispatcherGateway).get();
    fail("Expected exception not thrown.");
  }
 catch (  final ExecutionException e) {
    final Throwable throwable=ExceptionUtils.stripCompletionException(e.getCause());
    assertThat(throwable,instanceOf(RestHandlerException.class));
    final RestHandlerException restHandlerException=(RestHandlerException)throwable;
    assertThat(restHandlerException.getMessage(),containsString("Could not move uploaded jar file"));
    assertThat(restHandlerException.getHttpResponseStatus(),equalTo(HttpResponseStatus.INTERNAL_SERVER_ERROR));
  }
}
