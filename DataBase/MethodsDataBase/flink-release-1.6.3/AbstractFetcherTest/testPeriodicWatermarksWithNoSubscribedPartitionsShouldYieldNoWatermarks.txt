@Test public void testPeriodicWatermarksWithNoSubscribedPartitionsShouldYieldNoWatermarks() throws Exception {
  final String testTopic="test topic name";
  Map<KafkaTopicPartition,Long> originalPartitions=new HashMap<>();
  TestSourceContext<Long> sourceContext=new TestSourceContext<>();
  TestProcessingTimeService processingTimeProvider=new TestProcessingTimeService();
  TestFetcher<Long> fetcher=new TestFetcher<>(sourceContext,originalPartitions,new SerializedValue<AssignerWithPeriodicWatermarks<Long>>(new PeriodicTestExtractor()),null,processingTimeProvider,10);
  processingTimeProvider.setCurrentTime(10);
  assertFalse(sourceContext.hasWatermark());
  fetcher.addDiscoveredPartitions(Collections.singletonList(new KafkaTopicPartition(testTopic,0)));
  fetcher.emitRecord(100L,fetcher.subscribedPartitionStates().get(0),3L);
  processingTimeProvider.setCurrentTime(20);
  assertEquals(100,sourceContext.getLatestWatermark().getTimestamp());
}
