@Test public void testPersist() throws Exception {
  @SuppressWarnings("unchecked") ListState<Tuple2<TimeWindow,TimeWindow>> mockState=mock(ListState.class);
  MergingWindowSet<TimeWindow> windowSet=new MergingWindowSet<>(EventTimeSessionWindows.withGap(Time.milliseconds(3)),mockState);
  TestingMergeFunction mergeFunction=new TestingMergeFunction();
  windowSet.addWindow(new TimeWindow(1,2),mergeFunction);
  windowSet.addWindow(new TimeWindow(17,42),mergeFunction);
  assertEquals(new TimeWindow(1,2),windowSet.getStateWindow(new TimeWindow(1,2)));
  assertEquals(new TimeWindow(17,42),windowSet.getStateWindow(new TimeWindow(17,42)));
  windowSet.persist();
  verify(mockState).add(eq(new Tuple2<>(new TimeWindow(1,2),new TimeWindow(1,2))));
  verify(mockState).add(eq(new Tuple2<>(new TimeWindow(17,42),new TimeWindow(17,42))));
  verify(mockState,times(2)).add(Matchers.<Tuple2<TimeWindow,TimeWindow>>anyObject());
}
