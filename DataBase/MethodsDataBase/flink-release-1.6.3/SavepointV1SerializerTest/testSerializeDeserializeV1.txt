/** 
 * Test serialization of  {@link SavepointV1} instance.
 */
@Test public void testSerializeDeserializeV1() throws Exception {
  final Random r=new Random(42);
  for (int i=0; i < 50; ++i) {
    SavepointV1 expected=new SavepointV1(i + 123123,CheckpointTestUtils.createTaskStates(r,1 + r.nextInt(64),1 + r.nextInt(64)));
    SavepointV1Serializer serializer=SavepointV1Serializer.INSTANCE;
    ByteArrayOutputStreamWithPos baos=new ByteArrayOutputStreamWithPos();
    serializer.serializeOld(expected,new DataOutputViewStreamWrapper(baos));
    byte[] bytes=baos.toByteArray();
    ByteArrayInputStream bais=new ByteArrayInputStream(bytes);
    SavepointV2 actual=serializer.deserialize(new DataInputViewStreamWrapper(bais),Thread.currentThread().getContextClassLoader());
    assertEquals(expected.getCheckpointId(),actual.getCheckpointId());
    assertEquals(expected.getTaskStates(),actual.getTaskStates());
    assertTrue(actual.getMasterStates().isEmpty());
  }
}
