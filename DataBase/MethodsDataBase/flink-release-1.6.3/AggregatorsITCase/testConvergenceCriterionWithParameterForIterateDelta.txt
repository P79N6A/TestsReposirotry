@Test public void testConvergenceCriterionWithParameterForIterateDelta() throws Exception {
  final ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  env.setParallelism(parallelism);
  DataSet<Tuple2<Integer,Integer>> initialSolutionSet=CollectionDataSets.getIntegerDataSet(env).map(new TupleMakerMap());
  DeltaIteration<Tuple2<Integer,Integer>,Tuple2<Integer,Integer>> iteration=initialSolutionSet.iterateDelta(initialSolutionSet,MAX_ITERATIONS,0);
  LongSumAggregator aggr=new LongSumAggregator();
  iteration.registerAggregator(NEGATIVE_ELEMENTS_AGGR,aggr);
  iteration.registerAggregationConvergenceCriterion(NEGATIVE_ELEMENTS_AGGR,aggr,new NegativeElementsConvergenceCriterionWithParam(3));
  DataSet<Tuple2<Integer,Integer>> updatedDs=iteration.getWorkset().map(new AggregateAndSubtractOneDelta());
  DataSet<Tuple2<Integer,Integer>> newElements=updatedDs.join(iteration.getSolutionSet()).where(0).equalTo(0).projectFirst(0,1);
  DataSet<Tuple2<Integer,Integer>> iterationRes=iteration.closeWith(newElements,newElements);
  List<Integer> result=iterationRes.map(new ProjectSecondMapper()).collect();
  Collections.sort(result);
  List<Integer> expected=Arrays.asList(-3,-2,-2,-1,-1,-1,0,0,0,0,1,1,1,1,1);
  assertEquals(expected,result);
}
