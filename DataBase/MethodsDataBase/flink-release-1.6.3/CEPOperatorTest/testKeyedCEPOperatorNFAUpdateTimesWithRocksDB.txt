@Test public void testKeyedCEPOperatorNFAUpdateTimesWithRocksDB() throws Exception {
  String rocksDbPath=tempFolder.newFolder().getAbsolutePath();
  RocksDBStateBackend rocksDBStateBackend=new RocksDBStateBackend(new MemoryStateBackend());
  rocksDBStateBackend.setDbStoragePath(rocksDbPath);
  SelectCepOperator<Event,Integer,Map<String,List<Event>>> operator=CepOperatorTestUtilities.getKeyedCepOpearator(true,new SimpleNFAFactory());
  OneInputStreamOperatorTestHarness<Event,Map<String,List<Event>>> harness=CepOperatorTestUtilities.getCepTestHarness(operator);
  try {
    harness.setStateBackend(rocksDBStateBackend);
    harness.open();
    final ValueState nfaOperatorState=(ValueState)Whitebox.<ValueState>getInternalState(operator,"computationStates");
    final ValueState nfaOperatorStateSpy=Mockito.spy(nfaOperatorState);
    Whitebox.setInternalState(operator,"computationStates",nfaOperatorStateSpy);
    Event startEvent=new Event(42,"c",1.0);
    SubEvent middleEvent=new SubEvent(42,"a",1.0,10.0);
    Event endEvent=new Event(42,"b",1.0);
    harness.processElement(new StreamRecord<>(startEvent,1L));
    harness.processElement(new StreamRecord<>(new Event(42,"d",1.0),4L));
    harness.processElement(new StreamRecord<Event>(middleEvent,4L));
    harness.processElement(new StreamRecord<>(endEvent,4L));
    Mockito.verify(nfaOperatorStateSpy,Mockito.times(3)).update(Mockito.any());
    Queue<Object> result=harness.getOutput();
    assertEquals(1,result.size());
    verifyPattern(result.poll(),startEvent,middleEvent,endEvent);
  }
  finally {
    harness.close();
  }
}
