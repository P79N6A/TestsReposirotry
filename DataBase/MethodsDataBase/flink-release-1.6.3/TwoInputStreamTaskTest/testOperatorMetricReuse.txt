@Test public void testOperatorMetricReuse() throws Exception {
  final TwoInputStreamTaskTestHarness<String,String,String> testHarness=new TwoInputStreamTaskTestHarness<>(TwoInputStreamTask::new,BasicTypeInfo.STRING_TYPE_INFO,BasicTypeInfo.STRING_TYPE_INFO,BasicTypeInfo.STRING_TYPE_INFO);
  testHarness.setupOperatorChain(new OperatorID(),new DuplicatingOperator()).chain(new OperatorID(),new OneInputStreamTaskTest.DuplicatingOperator(),BasicTypeInfo.STRING_TYPE_INFO.createSerializer(new ExecutionConfig())).chain(new OperatorID(),new OneInputStreamTaskTest.DuplicatingOperator(),BasicTypeInfo.STRING_TYPE_INFO.createSerializer(new ExecutionConfig())).finish();
  final TaskMetricGroup taskMetricGroup=new UnregisteredMetricGroups.UnregisteredTaskMetricGroup(){
    @Override public OperatorMetricGroup addOperator(    OperatorID operatorID,    String name){
      return new OperatorMetricGroup(NoOpMetricRegistry.INSTANCE,this,operatorID,name);
    }
  }
;
  final StreamMockEnvironment env=new StreamMockEnvironment(testHarness.jobConfig,testHarness.taskConfig,testHarness.memorySize,new MockInputSplitProvider(),testHarness.bufferSize,new TestTaskStateManager()){
    @Override public TaskMetricGroup getMetricGroup(){
      return taskMetricGroup;
    }
  }
;
  final Counter numRecordsInCounter=taskMetricGroup.getIOMetricGroup().getNumRecordsInCounter();
  final Counter numRecordsOutCounter=taskMetricGroup.getIOMetricGroup().getNumRecordsOutCounter();
  testHarness.invoke(env);
  testHarness.waitForTaskRunning();
  final int numRecords1=5;
  final int numRecords2=3;
  for (int x=0; x < numRecords1; x++) {
    testHarness.processElement(new StreamRecord<>("hello"),0,0);
  }
  for (int x=0; x < numRecords2; x++) {
    testHarness.processElement(new StreamRecord<>("hello"),1,0);
  }
  testHarness.waitForInputProcessing();
  assertEquals(numRecords1 + numRecords2,numRecordsInCounter.getCount());
  assertEquals((numRecords1 + numRecords2) * 2 * 2* 2,numRecordsOutCounter.getCount());
}
