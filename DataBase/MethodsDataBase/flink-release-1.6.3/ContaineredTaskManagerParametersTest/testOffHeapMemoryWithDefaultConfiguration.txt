/** 
 * This tests that per default the off heap memory is set to what the network buffers require.
 */
@Test public void testOffHeapMemoryWithDefaultConfiguration(){
  Configuration conf=new Configuration();
  ContaineredTaskManagerParameters params=ContaineredTaskManagerParameters.create(conf,CONTAINER_MEMORY,1);
  final float memoryCutoffRatio=conf.getFloat(ConfigConstants.CONTAINERIZED_HEAP_CUTOFF_RATIO,ConfigConstants.DEFAULT_YARN_HEAP_CUTOFF_RATIO);
  final int minCutoff=conf.getInteger(ConfigConstants.CONTAINERIZED_HEAP_CUTOFF_MIN,ConfigConstants.DEFAULT_YARN_HEAP_CUTOFF);
  long cutoff=Math.max((long)(CONTAINER_MEMORY * memoryCutoffRatio),minCutoff);
  final long networkBufMB=calculateNetworkBufferMemory((CONTAINER_MEMORY - cutoff) << 20,conf) >> 20;
  assertEquals(networkBufMB + cutoff,params.taskManagerDirectMemoryLimitMB());
}
