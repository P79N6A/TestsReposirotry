/** 
 * Tests that slot context future failures will release the root slot
 */
@Test public void testSlotContextFutureFailure(){
  final TestingAllocatedSlotActions allocatedSlotActions=new TestingAllocatedSlotActions();
  SlotSharingManager slotSharingManager=new SlotSharingManager(SLOT_SHARING_GROUP_ID,allocatedSlotActions,SLOT_OWNER);
  CompletableFuture<SlotContext> slotContextFuture=new CompletableFuture<>();
  assertTrue(slotSharingManager.isEmpty());
  SlotSharingManager.MultiTaskSlot rootSlot=slotSharingManager.createRootSlot(new SlotRequestId(),slotContextFuture,new SlotRequestId());
  SlotSharingManager.SingleTaskSlot singleTaskSlot=rootSlot.allocateSingleTaskSlot(new SlotRequestId(),new AbstractID(),Locality.LOCAL);
  slotContextFuture.completeExceptionally(new FlinkException("Test exception"));
  assertTrue(singleTaskSlot.getLogicalSlotFuture().isCompletedExceptionally());
  assertTrue(slotSharingManager.isEmpty());
  assertTrue(slotSharingManager.getResolvedRootSlots().isEmpty());
  assertTrue(slotSharingManager.getUnresolvedRootSlots().isEmpty());
}
