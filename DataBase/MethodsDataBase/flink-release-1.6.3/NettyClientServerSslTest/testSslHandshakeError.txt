/** 
 * Verify SSL handshake error when untrusted server certificate is used.
 */
@Test public void testSslHandshakeError() throws Exception {
  NettyProtocol protocol=new NoOpProtocol();
  Configuration config=createSslConfig();
  config.setString(SecurityOptions.SSL_INTERNAL_KEYSTORE,"src/test/resources/untrusted.keystore");
  NettyConfig nettyConfig=createNettyConfig(config);
  NettyTestUtil.NettyServerAndClient serverAndClient=NettyTestUtil.initServerAndClient(protocol,nettyConfig);
  Channel ch=NettyTestUtil.connect(serverAndClient);
  ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
  assertFalse(ch.writeAndFlush("test").await().isSuccess());
  NettyTestUtil.shutdown(serverAndClient);
}
