@Test public void testClientUntrustedCertificate() throws Exception {
  final Configuration serverConfig=createSslConfig();
  final Configuration clientConfig=createSslConfig();
  clientConfig.setString(SecurityOptions.SSL_INTERNAL_KEYSTORE,"src/test/resources/untrusted.keystore");
  final NettyConfig nettyServerConfig=createNettyConfig(serverConfig);
  final NettyConfig nettyClientConfig=createNettyConfig(clientConfig);
  final NettyBufferPool bufferPool=new NettyBufferPool(1);
  final NettyProtocol protocol=new NoOpProtocol();
  final NettyServer server=NettyTestUtil.initServer(nettyServerConfig,protocol,bufferPool);
  final NettyClient client=NettyTestUtil.initClient(nettyClientConfig,protocol,bufferPool);
  final NettyServerAndClient serverAndClient=new NettyServerAndClient(server,client);
  final Channel ch=NettyTestUtil.connect(serverAndClient);
  ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
  assertFalse(ch.writeAndFlush("test").await().isSuccess());
  NettyTestUtil.shutdown(serverAndClient);
}
