/** 
 * This test validates that vertices that have only one input stream try to co-locate their tasks with the producer.
 */
@Test public void testLocalityInputBasedForward() throws Exception {
  final int parallelism=10;
  final TaskManagerLocation[] locations=new TaskManagerLocation[parallelism];
  final ExecutionGraph graph=createTestGraph(parallelism,false);
  for (int i=0; i < parallelism; i++) {
    ExecutionVertex source=graph.getAllVertices().get(sourceVertexId).getTaskVertices()[i];
    TaskManagerLocation location=new TaskManagerLocation(ResourceID.generate(),InetAddress.getLoopbackAddress(),10000 + i);
    locations[i]=location;
    initializeLocation(source,location);
  }
  for (int i=0; i < parallelism; i++) {
    ExecutionVertex target=graph.getAllVertices().get(targetVertexId).getTaskVertices()[i];
    Iterator<CompletableFuture<TaskManagerLocation>> preference=target.getPreferredLocations().iterator();
    assertTrue(preference.hasNext());
    assertEquals(locations[i],preference.next().get());
    assertFalse(preference.hasNext());
  }
}
