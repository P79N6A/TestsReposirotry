@Test public void testAddAfterFinish() throws Exception {
  final ResultSubpartition subpartition=createSubpartition();
  try {
    subpartition.finish();
    assertEquals(1,subpartition.getTotalNumberOfBuffers());
    assertEquals(0,subpartition.getTotalNumberOfBytes());
    assertEquals(1,subpartition.getTotalNumberOfBuffers());
    assertEquals(0,subpartition.getBuffersInBacklog());
    assertEquals(0,subpartition.getTotalNumberOfBytes());
    BufferConsumer bufferConsumer=createFilledBufferConsumer(4096,4096);
    assertFalse(subpartition.add(bufferConsumer));
    assertEquals(1,subpartition.getTotalNumberOfBuffers());
    assertEquals(0,subpartition.getBuffersInBacklog());
    assertEquals(0,subpartition.getTotalNumberOfBytes());
  }
  finally {
    if (subpartition != null) {
      subpartition.release();
    }
  }
}
