/** 
 * Tests that the TaskManager sends a proper exception back to the sender if the trigger stack trace message fails.
 */
@Test public void testUpdateTaskInputPartitionsFailure() throws Exception {
  ActorGateway jobManager=null;
  ActorGateway taskManager=null;
  try {
    final ExecutionAttemptID executionAttemptId=new ExecutionAttemptID();
    ActorRef jm=system.actorOf(Props.create(SimpleJobManager.class,LEADER_SESSION_ID));
    jobManager=new AkkaActorGateway(jm,LEADER_SESSION_ID);
    highAvailabilityServices.setJobMasterLeaderRetriever(HighAvailabilityServices.DEFAULT_JOB_ID,new StandaloneLeaderRetrievalService(jobManager.path(),jobManager.leaderSessionID()));
    taskManager=TestingUtils.createTaskManager(system,highAvailabilityServices,new Configuration(),true,true);
    TaskDeploymentDescriptor tdd=createTaskDeploymentDescriptor(new JobID(),"test job",new JobVertexID(),executionAttemptId,new SerializedValue<>(new ExecutionConfig()),"test task",1,0,1,0,new Configuration(),new Configuration(),BlockingNoOpInvokable.class.getName(),Collections.<ResultPartitionDeploymentDescriptor>emptyList(),Collections.<InputGateDeploymentDescriptor>emptyList(),Collections.emptyList(),Collections.emptyList(),0);
    Future<Object> submitResponse=taskManager.ask(new SubmitTask(tdd),timeout);
    Await.result(submitResponse,timeout);
    Future<Object> partitionUpdateResponse=taskManager.ask(new TaskMessages.UpdateTaskSinglePartitionInfo(executionAttemptId,new IntermediateDataSetID(),new InputChannelDeploymentDescriptor(new ResultPartitionID(),ResultPartitionLocation.createLocal())),timeout);
    try {
      Await.result(partitionUpdateResponse,timeout);
      fail("The update task input partitions message should have failed.");
    }
 catch (    Exception e) {
    }
  }
  finally {
    TestingUtils.stopActor(jobManager);
    TestingUtils.stopActor(taskManager);
  }
}
