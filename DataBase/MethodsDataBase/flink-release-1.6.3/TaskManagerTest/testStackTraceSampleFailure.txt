/** 
 * Tests that the TaskManager sends a proper exception back to the sender if the trigger stack trace message fails.
 */
@Test public void testStackTraceSampleFailure() throws Exception {
  ActorGateway jobManager=null;
  ActorGateway taskManager=null;
  try {
    ActorRef jm=system.actorOf(Props.create(SimpleJobManager.class,LEADER_SESSION_ID));
    jobManager=new AkkaActorGateway(jm,LEADER_SESSION_ID);
    highAvailabilityServices.setJobMasterLeaderRetriever(HighAvailabilityServices.DEFAULT_JOB_ID,new StandaloneLeaderRetrievalService(jobManager.path(),jobManager.leaderSessionID()));
    taskManager=TestingUtils.createTaskManager(system,highAvailabilityServices,new Configuration(),true,true);
    Future<Object> stackTraceResponse=taskManager.ask(new TriggerStackTraceSample(0,new ExecutionAttemptID(),0,Time.milliseconds(1L),0),timeout);
    try {
      Await.result(stackTraceResponse,timeout);
      fail("The trigger stack trace message should have failed.");
    }
 catch (    IllegalStateException e) {
    }
  }
  finally {
    TestingUtils.stopActor(jobManager);
    TestingUtils.stopActor(taskManager);
  }
}
