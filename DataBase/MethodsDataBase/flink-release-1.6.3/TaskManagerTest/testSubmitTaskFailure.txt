/** 
 * Tests that the TaskManager sends a proper exception back to the sender if the submit task message fails.
 */
@Test public void testSubmitTaskFailure() throws Exception {
  ActorGateway jobManager=null;
  ActorGateway taskManager=null;
  try {
    ActorRef jm=system.actorOf(Props.create(SimpleJobManager.class,LEADER_SESSION_ID));
    jobManager=new AkkaActorGateway(jm,LEADER_SESSION_ID);
    highAvailabilityServices.setJobMasterLeaderRetriever(HighAvailabilityServices.DEFAULT_JOB_ID,new StandaloneLeaderRetrievalService(jobManager.path(),jobManager.leaderSessionID()));
    taskManager=TestingUtils.createTaskManager(system,highAvailabilityServices,new Configuration(),true,true);
    TaskDeploymentDescriptor tdd=createTaskDeploymentDescriptor(new JobID(),"test job",new JobVertexID(),new ExecutionAttemptID(),new SerializedValue<>(new ExecutionConfig()),"test task",0,0,1,0,new Configuration(),new Configuration(),"Foobar",Collections.<ResultPartitionDeploymentDescriptor>emptyList(),Collections.<InputGateDeploymentDescriptor>emptyList(),Collections.emptyList(),Collections.emptyList(),0);
    Future<Object> submitResponse=taskManager.ask(new SubmitTask(tdd),timeout);
    try {
      Await.result(submitResponse,timeout);
      fail("The submit task message should have failed.");
    }
 catch (    IllegalArgumentException e) {
    }
  }
  finally {
    TestingUtils.stopActor(jobManager);
    TestingUtils.stopActor(taskManager);
  }
}
