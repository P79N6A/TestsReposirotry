@Test public void testTerminationOnFatalError(){
  highAvailabilityServices.setJobMasterLeaderRetriever(HighAvailabilityServices.DEFAULT_JOB_ID,new SettableLeaderRetrievalService());
  new JavaTestKit(system){
{
      final ActorGateway taskManager=TestingUtils.createTaskManager(system,highAvailabilityServices,new Configuration(),true,false);
      try {
        watch(taskManager.actor());
        taskManager.tell(new FatalError("test fatal error",new Exception("something super bad")));
        expectTerminated(d,taskManager.actor());
      }
  finally {
        taskManager.tell(Kill.getInstance());
      }
    }
  }
;
}
