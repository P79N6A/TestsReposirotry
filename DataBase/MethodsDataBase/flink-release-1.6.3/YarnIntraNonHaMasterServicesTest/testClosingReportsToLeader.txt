@Test public void testClosingReportsToLeader() throws Exception {
  final Configuration flinkConfig=new Configuration();
  try (YarnHighAvailabilityServices services=new YarnIntraNonHaMasterServices(flinkConfig,hadoopConfig)){
    final LeaderElectionService elector=services.getResourceManagerLeaderElectionService();
    final LeaderRetrievalService retrieval=services.getResourceManagerLeaderRetriever();
    final LeaderContender contender=mockContender(elector);
    final LeaderRetrievalListener listener=mock(LeaderRetrievalListener.class);
    elector.start(contender);
    retrieval.start(listener);
    verify(listener,timeout(1000L).times(1)).notifyLeaderAddress(anyString(),any(UUID.class));
    services.close();
    verify(contender,timeout(1000L).times(1)).handleError(any(Exception.class));
  }
 }
