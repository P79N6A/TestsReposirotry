@Test public void testCommitAfterPersist() throws Exception {
  final RecoverableWriter writer=getNewFileSystemWriter();
  final Path testDir=getBasePathForTest();
  final Path path=new Path(testDir,"part-0");
  try (final RecoverableFsDataOutputStream stream=writer.open(path)){
    stream.write(testData1.getBytes(StandardCharsets.UTF_8));
    stream.persist();
    stream.write(testData2.getBytes(StandardCharsets.UTF_8));
    stream.closeForCommit().commit();
    for (    Map.Entry<Path,String> fileContents : getFileContentByPath(testDir).entrySet()) {
      Assert.assertEquals("part-0",fileContents.getKey().getName());
      Assert.assertEquals(testData1 + testData2,fileContents.getValue());
    }
  }
 }
