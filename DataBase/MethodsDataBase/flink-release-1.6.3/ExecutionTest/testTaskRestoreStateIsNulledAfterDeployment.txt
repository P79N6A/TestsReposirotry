/** 
 * Tests that the task restore state is nulled after the  {@link Execution} has beendeployed. See FLINK-9693.
 */
@Test public void testTaskRestoreStateIsNulledAfterDeployment() throws Exception {
  final JobVertex jobVertex=createNoOpJobVertex();
  final JobVertexID jobVertexId=jobVertex.getID();
  final SingleSlotTestingSlotOwner slotOwner=new SingleSlotTestingSlotOwner();
  final ProgrammedSlotProvider slotProvider=createProgrammedSlotProvider(1,Collections.singleton(jobVertexId),slotOwner);
  ExecutionGraph executionGraph=ExecutionGraphTestUtils.createSimpleTestGraph(new JobID(),slotProvider,new NoRestartStrategy(),jobVertex);
  ExecutionJobVertex executionJobVertex=executionGraph.getJobVertex(jobVertexId);
  ExecutionVertex executionVertex=executionJobVertex.getTaskVertices()[0];
  final Execution execution=executionVertex.getCurrentExecutionAttempt();
  final JobManagerTaskRestore taskRestoreState=new JobManagerTaskRestore(1L,new TaskStateSnapshot());
  execution.setInitialState(taskRestoreState);
  assertThat(execution.getTaskRestore(),is(notNullValue()));
  executionVertex.scheduleForExecution(slotProvider,false,LocationPreferenceConstraint.ANY,Collections.emptySet()).get();
  assertThat(execution.getTaskRestore(),is(nullValue()));
}
