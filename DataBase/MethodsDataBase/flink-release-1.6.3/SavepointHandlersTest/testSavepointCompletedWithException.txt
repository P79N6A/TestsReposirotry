@Test public void testSavepointCompletedWithException() throws Exception {
  TestingRestfulGateway testingRestfulGateway=new TestingRestfulGateway.Builder().setTriggerSavepointFunction((  JobID jobId,  String directory) -> FutureUtils.completedExceptionally(new RuntimeException("expected"))).build();
  final TriggerId triggerId=savepointTriggerHandler.handleRequest(triggerSavepointRequest(),testingRestfulGateway).get().getTriggerId();
  final AsynchronousOperationResult<SavepointInfo> savepointResponseBody=savepointStatusHandler.handleRequest(savepointStatusRequest(triggerId),testingRestfulGateway).get();
  assertThat(savepointResponseBody.queueStatus().getId(),equalTo(QueueStatus.Id.COMPLETED));
  assertThat(savepointResponseBody.resource(),notNullValue());
  assertThat(savepointResponseBody.resource().getFailureCause(),notNullValue());
  final Throwable savepointError=savepointResponseBody.resource().getFailureCause().deserializeError(ClassLoader.getSystemClassLoader());
  assertThat(savepointError.getMessage(),equalTo("expected"));
  assertThat(savepointError,instanceOf(RuntimeException.class));
}
