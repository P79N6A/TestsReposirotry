/** 
 * Tests that regular heartbeat signal triggers the right callback functions in the {@link HeartbeatListener}.
 */
@Test public void testRegularHeartbeat(){
  long heartbeatTimeout=1000L;
  ResourceID ownResourceID=new ResourceID("foobar");
  ResourceID targetResourceID=new ResourceID("barfoo");
  @SuppressWarnings("unchecked") HeartbeatListener<Object,Object> heartbeatListener=mock(HeartbeatListener.class);
  ScheduledExecutor scheduledExecutor=mock(ScheduledExecutor.class);
  Object expectedObject=new Object();
  when(heartbeatListener.retrievePayload(any(ResourceID.class))).thenReturn(CompletableFuture.completedFuture(expectedObject));
  HeartbeatManagerImpl<Object,Object> heartbeatManager=new HeartbeatManagerImpl<>(heartbeatTimeout,ownResourceID,heartbeatListener,new DirectExecutorService(),scheduledExecutor,LOG);
  @SuppressWarnings("unchecked") HeartbeatTarget<Object> heartbeatTarget=mock(HeartbeatTarget.class);
  heartbeatManager.monitorTarget(targetResourceID,heartbeatTarget);
  heartbeatManager.requestHeartbeat(targetResourceID,expectedObject);
  verify(heartbeatListener,times(1)).reportPayload(targetResourceID,expectedObject);
  verify(heartbeatListener,times(1)).retrievePayload(any(ResourceID.class));
  verify(heartbeatTarget,times(1)).receiveHeartbeat(ownResourceID,expectedObject);
  heartbeatManager.receiveHeartbeat(targetResourceID,expectedObject);
  verify(heartbeatListener,times(2)).reportPayload(targetResourceID,expectedObject);
}
