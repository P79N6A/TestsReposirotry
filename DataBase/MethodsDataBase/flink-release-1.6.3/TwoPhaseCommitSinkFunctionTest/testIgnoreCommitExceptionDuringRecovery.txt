@Test public void testIgnoreCommitExceptionDuringRecovery() throws Exception {
  clock.setEpochMilli(0);
  harness.open();
  harness.processElement("42",0);
  final OperatorSubtaskState snapshot=harness.snapshot(0,1);
  harness.notifyOfCompletedCheckpoint(1);
  final long transactionTimeout=1000;
  sinkFunction.setTransactionTimeout(transactionTimeout);
  sinkFunction.ignoreFailuresAfterTransactionTimeout();
  throwException.set(true);
  try {
    harness.initializeState(snapshot);
    fail("Expected exception not thrown");
  }
 catch (  RuntimeException e) {
    assertEquals("Expected exception",e.getMessage());
  }
  clock.setEpochMilli(transactionTimeout + 1);
  harness.initializeState(snapshot);
  assertExactlyOnce(Collections.singletonList("42"));
}
