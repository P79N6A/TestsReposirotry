@Test public void testExactExpirationOnRead() throws Exception {
  initTest(StateTtlConfig.UpdateType.OnReadAndWrite,StateTtlConfig.StateVisibility.NeverReturnExpired);
  timeProvider.time=0;
  ctx().update(ctx().updateEmpty);
  takeAndRestoreSnapshot();
  timeProvider.time=50;
  assertEquals("Unexpired state should be available",ctx().getUpdateEmpty,ctx().get());
  takeAndRestoreSnapshot();
  timeProvider.time=120;
  assertEquals("Unexpired state should be available after read",ctx().getUpdateEmpty,ctx().get());
  takeAndRestoreSnapshot();
  timeProvider.time=250;
  assertEquals("Expired state should be unavailable",ctx().emptyValue,ctx().get());
  assertEquals("Original state should be cleared on access",ctx().emptyValue,ctx().getOriginal());
}
