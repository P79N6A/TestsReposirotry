@Test public void testMergeNamespaces() throws Exception {
  assumeThat(ctx,instanceOf(TtlMergingStateTestContext.class));
  initTest();
  timeProvider.time=0;
  List<Tuple2<String,Object>> expiredUpdatesToMerge=mctx().generateExpiredUpdatesToMerge();
  mctx().applyStateUpdates(expiredUpdatesToMerge);
  takeAndRestoreSnapshot();
  timeProvider.time=120;
  List<Tuple2<String,Object>> unexpiredUpdatesToMerge=mctx().generateUnexpiredUpdatesToMerge();
  mctx().applyStateUpdates(unexpiredUpdatesToMerge);
  takeAndRestoreSnapshot();
  timeProvider.time=150;
  List<Tuple2<String,Object>> finalUpdatesToMerge=mctx().generateFinalUpdatesToMerge();
  mctx().applyStateUpdates(finalUpdatesToMerge);
  takeAndRestoreSnapshot();
  timeProvider.time=230;
  mctx().ttlState.mergeNamespaces("targetNamespace",TtlMergingStateTestContext.NAMESPACES);
  mctx().ttlState.setCurrentNamespace("targetNamespace");
  assertEquals("Unexpected result of merge operation",mctx().getMergeResult(unexpiredUpdatesToMerge,finalUpdatesToMerge),mctx().get());
}
