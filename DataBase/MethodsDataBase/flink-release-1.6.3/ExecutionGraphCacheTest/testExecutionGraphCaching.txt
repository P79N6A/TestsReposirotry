/** 
 * Tests that we can cache AccessExecutionGraphs over multiple accesses.
 */
@Test public void testExecutionGraphCaching() throws Exception {
  final Time timeout=Time.milliseconds(100L);
  final Time timeToLive=Time.hours(1L);
  final CountingRestfulGateway restfulGateway=createCountingRestfulGateway(expectedJobId,CompletableFuture.completedFuture(expectedExecutionGraph));
  try (ExecutionGraphCache executionGraphCache=new ExecutionGraphCache(timeout,timeToLive)){
    CompletableFuture<AccessExecutionGraph> accessExecutionGraphFuture=executionGraphCache.getExecutionGraph(expectedJobId,restfulGateway);
    assertEquals(expectedExecutionGraph,accessExecutionGraphFuture.get());
    accessExecutionGraphFuture=executionGraphCache.getExecutionGraph(expectedJobId,restfulGateway);
    assertEquals(expectedExecutionGraph,accessExecutionGraphFuture.get());
    assertThat(restfulGateway.getNumRequestJobCalls(),Matchers.equalTo(1));
  }
 }
