@Test public void testFileHandling() throws Exception {
  final String dcEntryName="entry";
  CompletableFuture<JobGraph> submittedJobGraphFuture=new CompletableFuture<>();
  DispatcherGateway dispatcherGateway=new TestingDispatcherGateway.Builder().setBlobServerPort(blobServer.getPort()).setSubmitFunction(submittedJobGraph -> {
    submittedJobGraphFuture.complete(submittedJobGraph);
    return CompletableFuture.completedFuture(Acknowledge.get());
  }
).build();
  JobSubmitHandler handler=new JobSubmitHandler(CompletableFuture.completedFuture("http://localhost:1234"),() -> CompletableFuture.completedFuture(dispatcherGateway),RpcUtils.INF_TIMEOUT,Collections.emptyMap(),TestingUtils.defaultExecutor(),configuration);
  final Path jobGraphFile=TEMPORARY_FOLDER.newFile().toPath();
  final Path jarFile=TEMPORARY_FOLDER.newFile().toPath();
  final Path artifactFile=TEMPORARY_FOLDER.newFile().toPath();
  final JobGraph jobGraph=new JobGraph();
  jobGraph.addUserArtifact(dcEntryName,new DistributedCache.DistributedCacheEntry("random",false));
  try (ObjectOutputStream objectOut=new ObjectOutputStream(Files.newOutputStream(jobGraphFile))){
    objectOut.writeObject(jobGraph);
  }
   JobSubmitRequestBody request=new JobSubmitRequestBody(jobGraphFile.getFileName().toString(),Collections.singletonList(jarFile.getFileName().toString()),Collections.singleton(new JobSubmitRequestBody.DistributedCacheFile(dcEntryName,artifactFile.getFileName().toString())));
  handler.handleRequest(new HandlerRequest<>(request,EmptyMessageParameters.getInstance(),Collections.emptyMap(),Collections.emptyMap(),Arrays.asList(jobGraphFile.toFile(),jarFile.toFile(),artifactFile.toFile())),dispatcherGateway).get();
  Assert.assertTrue("No JobGraph was submitted.",submittedJobGraphFuture.isDone());
  final JobGraph submittedJobGraph=submittedJobGraphFuture.get();
  Assert.assertEquals(1,submittedJobGraph.getUserJarBlobKeys().size());
  Assert.assertEquals(1,submittedJobGraph.getUserArtifacts().size());
  Assert.assertNotNull(submittedJobGraph.getUserArtifacts().get(dcEntryName).blobKey);
}
