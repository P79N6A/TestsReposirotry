/** 
 * Tests that shutdown discards all checkpoints.
 */
@Test public void testShutdownDiscardsCheckpoints() throws Exception {
  SharedStateRegistry sharedStateRegistry=new SharedStateRegistry();
  CompletedCheckpointStore store=createCompletedCheckpoints(1);
  TestCompletedCheckpoint checkpoint=createCheckpoint(0,sharedStateRegistry);
  Collection<OperatorState> operatorStates=checkpoint.getOperatorStates().values();
  store.addCheckpoint(checkpoint);
  assertEquals(1,store.getNumberOfRetainedCheckpoints());
  verifyCheckpointRegistered(operatorStates,sharedStateRegistry);
  store.shutdown(JobStatus.FINISHED);
  assertEquals(0,store.getNumberOfRetainedCheckpoints());
  assertTrue(checkpoint.isDiscarded());
  verifyCheckpointDiscarded(operatorStates);
}
