@Test public void testSimpleFileWriteAndRead() throws Exception {
  final long deadline=System.nanoTime() + 30_000_000_000L;
  final Configuration conf=new Configuration();
  conf.setString("s3.access.key",ACCESS_KEY);
  conf.setString("s3.secret.key",SECRET_KEY);
  final String testLine="Hello Upload!";
  FileSystem.initialize(conf);
  final Path path=new Path(getBasePath() + "/test.txt");
  final FileSystem fs=path.getFileSystem();
  try {
    try (FSDataOutputStream out=fs.create(path,WriteMode.OVERWRITE);OutputStreamWriter writer=new OutputStreamWriter(out,StandardCharsets.UTF_8)){
      writer.write(testLine);
    }
     checkPathEventualExistence(fs,path,true,deadline);
    try (FSDataInputStream in=fs.open(path);InputStreamReader ir=new InputStreamReader(in,StandardCharsets.UTF_8);BufferedReader reader=new BufferedReader(ir)){
      String line=reader.readLine();
      assertEquals(testLine,line);
    }
   }
  finally {
    fs.delete(path,false);
  }
  checkPathEventualExistence(fs,path,false,deadline);
}
