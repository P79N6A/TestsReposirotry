@Test public void testCloseAndFinalizeCheckpointStreamResultPrimaryAndSecondary() throws Exception {
  CheckpointStreamFactory primaryFactory=createCheckpointStreamFactory();
  LocalRecoveryDirectoryProvider directoryProvider=createLocalRecoveryDirectoryProvider();
  CheckpointStreamWithResultProvider resultProvider=CheckpointStreamWithResultProvider.createDuplicatingStream(42L,CheckpointedStateScope.EXCLUSIVE,primaryFactory,directoryProvider);
  SnapshotResult<StreamStateHandle> result=writeCheckpointTestData(resultProvider);
  Assert.assertNotNull(result.getJobManagerOwnedSnapshot());
  Assert.assertNotNull(result.getTaskLocalSnapshot());
  try (FSDataInputStream inputStream=result.getJobManagerOwnedSnapshot().openInputStream()){
    Assert.assertEquals(0x42,inputStream.read());
    Assert.assertEquals(-1,inputStream.read());
  }
   try (FSDataInputStream inputStream=result.getTaskLocalSnapshot().openInputStream()){
    Assert.assertEquals(0x42,inputStream.read());
    Assert.assertEquals(-1,inputStream.read());
  }
 }
