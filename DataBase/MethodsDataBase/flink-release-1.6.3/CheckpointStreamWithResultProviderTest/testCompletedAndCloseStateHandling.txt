@Test public void testCompletedAndCloseStateHandling() throws Exception {
  CheckpointStreamFactory primaryFactory=createCheckpointStreamFactory();
  testCloseBeforeComplete(new CheckpointStreamWithResultProvider.PrimaryStreamOnly(primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE)));
  testCompleteBeforeClose(new CheckpointStreamWithResultProvider.PrimaryStreamOnly(primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE)));
  testCloseBeforeComplete(new CheckpointStreamWithResultProvider.PrimaryAndSecondaryStream(primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE),primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE)));
  testCompleteBeforeClose(new CheckpointStreamWithResultProvider.PrimaryAndSecondaryStream(primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE),primaryFactory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE)));
}
