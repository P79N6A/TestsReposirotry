@Test public void testReadCustomDelimiterWithCharset() throws IOException {
  String[] records=new String[]{"\u020e\u021f\u05c0\u020b\u020f","Apache","\nFlink","\u0000","\u05c0"};
  String delimiter="\u05c0\u05c0";
  String fileContent=StringUtils.join(records,delimiter);
  for (  final String charset : new String[]{"UTF-8","UTF-16BE","UTF-16LE"}) {
    DelimitedInputFormat<String> format=new DelimitedInputFormat<String>(){
      @Override public String readRecord(      String reuse,      byte[] bytes,      int offset,      int numBytes) throws IOException {
        return new String(bytes,offset,numBytes,charset);
      }
    }
;
    format.setFilePath("file:///some/file/that/will/not/be/read");
    final FileInputSplit split=createTempFile(fileContent,charset);
    format.setDelimiter(delimiter);
    format.setCharset(charset);
    format.configure(new Configuration());
    format.open(split);
    for (    String record : records) {
      String value=format.nextRecord(null);
      assertEquals(record,value);
    }
    assertNull(format.nextRecord(null));
    assertTrue(format.reachedEnd());
  }
}
