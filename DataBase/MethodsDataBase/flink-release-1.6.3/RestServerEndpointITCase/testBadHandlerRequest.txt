/** 
 * Tests that a bad handler request (HandlerRequest cannot be created) is reported as a BAD_REQUEST and not an internal server error. <p>See FLINK-7663
 */
@Test public void testBadHandlerRequest() throws Exception {
  final FaultyTestParameters parameters=new FaultyTestParameters();
  parameters.faultyJobIDPathParameter.resolve(PATH_JOB_ID);
  ((TestParameters)parameters).jobIDQueryParameter.resolve(Collections.singletonList(QUERY_JOB_ID));
  CompletableFuture<TestResponse> response=restClient.sendRequest(serverAddress.getHostName(),serverAddress.getPort(),new TestHeaders(),parameters,new TestRequest(2));
  try {
    response.get();
    fail("The request should fail with a bad request return code.");
  }
 catch (  ExecutionException ee) {
    Throwable t=ExceptionUtils.stripExecutionException(ee);
    assertTrue(t instanceof RestClientException);
    RestClientException rce=(RestClientException)t;
    assertEquals(HttpResponseStatus.BAD_REQUEST,rce.getHttpResponseStatus());
  }
}
