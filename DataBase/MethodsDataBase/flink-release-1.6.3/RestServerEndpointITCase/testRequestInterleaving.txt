/** 
 * Tests that request are handled as individual units which don't interfere with each other. This means that request responses can overtake each other.
 */
@Test public void testRequestInterleaving() throws Exception {
  final HandlerBlocker handlerBlocker=new HandlerBlocker(timeout);
  testHandler.handlerBody=id -> {
    if (id == 1) {
      handlerBlocker.arriveAndBlock();
    }
    return CompletableFuture.completedFuture(new TestResponse(id));
  }
;
  final CompletableFuture<TestResponse> response1=sendRequestToTestHandler(new TestRequest(1));
  handlerBlocker.awaitRequestToArrive();
  final CompletableFuture<TestResponse> response2=sendRequestToTestHandler(new TestRequest(2));
  assertEquals(2,response2.get().id);
  handlerBlocker.unblockRequest();
  assertEquals(1,response1.get().id);
}
