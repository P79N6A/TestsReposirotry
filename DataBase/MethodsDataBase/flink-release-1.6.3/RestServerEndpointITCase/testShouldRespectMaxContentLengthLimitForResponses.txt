/** 
 * Tests that responses larger than  {@link #TEST_REST_MAX_CONTENT_LENGTH} are rejected.
 */
@Test public void testShouldRespectMaxContentLengthLimitForResponses() throws Exception {
  testHandler.handlerBody=id -> CompletableFuture.completedFuture(new TestResponse(id,createStringOfSize(TEST_REST_MAX_CONTENT_LENGTH)));
  try {
    sendRequestToTestHandler(new TestRequest(1)).get();
    fail("Expected exception not thrown");
  }
 catch (  final ExecutionException e) {
    final Throwable throwable=ExceptionUtils.stripExecutionException(e);
    assertThat(throwable,instanceOf(TooLongFrameException.class));
    assertThat(throwable.getMessage(),containsString("Try to raise"));
  }
}
