/** 
 * Test callbacks from {@link org.apache.flink.runtime.jobmanager.SubmittedJobGraphStore.SubmittedJobGraphListener}.
 */
@Test public void testSubmittedJobGraphListener() throws Exception {
  dispatcher=createAndStartDispatcher(heartbeatServices,haServices,new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID,createdJobManagerRunnerLatch));
  dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();
  final DispatcherGateway dispatcherGateway=dispatcher.getSelfGateway(DispatcherGateway.class);
  dispatcherGateway.submitJob(jobGraph,TIMEOUT).get();
  jobMasterLeaderElectionService.isLeader(UUID.randomUUID()).get();
  final SubmittedJobGraph submittedJobGraph=submittedJobGraphStore.recoverJobGraph(TEST_JOB_ID);
  submittedJobGraphStore.removeJobGraph(TEST_JOB_ID);
  dispatcher.onRemovedJobGraph(TEST_JOB_ID);
  assertThat(dispatcherGateway.listJobs(TIMEOUT).get(),empty());
  runningJobsRegistry.clearJob(TEST_JOB_ID);
  submittedJobGraphStore.putJobGraph(submittedJobGraph);
  dispatcher.onAddedJobGraph(TEST_JOB_ID);
  createdJobManagerRunnerLatch.await();
  assertThat(dispatcherGateway.listJobs(TIMEOUT).get(),hasSize(1));
}
