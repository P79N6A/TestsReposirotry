/** 
 * Test that  {@link JobResult} is cached when the job finishes.
 */
@Test public void testCacheJobExecutionResult() throws Exception {
  dispatcher=createAndStartDispatcher(heartbeatServices,haServices,new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID,createdJobManagerRunnerLatch));
  dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();
  final DispatcherGateway dispatcherGateway=dispatcher.getSelfGateway(DispatcherGateway.class);
  final JobID failedJobId=new JobID();
  final JobStatus expectedState=JobStatus.FAILED;
  final ArchivedExecutionGraph failedExecutionGraph=new ArchivedExecutionGraphBuilder().setJobID(failedJobId).setState(expectedState).setFailureCause(new ErrorInfo(new RuntimeException("expected"),1L)).build();
  dispatcher.completeJobExecution(failedExecutionGraph);
  assertThat(dispatcherGateway.requestJobStatus(failedJobId,TIMEOUT).get(),equalTo(expectedState));
  assertThat(dispatcherGateway.requestJob(failedJobId,TIMEOUT).get(),equalTo(failedExecutionGraph));
}
