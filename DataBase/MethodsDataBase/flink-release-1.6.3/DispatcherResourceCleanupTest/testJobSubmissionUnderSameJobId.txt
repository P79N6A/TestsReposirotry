/** 
 * Tests that the previous JobManager needs to be completely terminated before a new job with the same  {@link JobID} is started.
 */
@Test public void testJobSubmissionUnderSameJobId() throws Exception {
  submitJob();
  runningJobsRegistry.setJobRunning(jobId);
  resultFuture.completeExceptionally(new JobNotFinishedException(jobId));
  final CompletableFuture<Acknowledge> submissionFuture=dispatcherGateway.submitJob(jobGraph,timeout);
  try {
    submissionFuture.get(10L,TimeUnit.MILLISECONDS);
    fail("The job submission future should not complete until the previous JobManager " + "termination future has been completed.");
  }
 catch (  TimeoutException ignored) {
  }
 finally {
    terminationFuture.complete(null);
  }
  assertThat(submissionFuture.get(),equalTo(Acknowledge.get()));
}
