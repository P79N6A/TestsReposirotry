@Test public void testLogicalScopeCachingForMultipleReporters() throws Exception {
  Configuration config=new Configuration();
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test1." + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,LogicalScopeReporter1.class.getName());
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test2." + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,LogicalScopeReporter2.class.getName());
  MetricRegistryImpl testRegistry=new MetricRegistryImpl(MetricRegistryConfiguration.fromConfiguration(config));
  try {
    MetricGroup tmGroup=new TaskManagerMetricGroup(testRegistry,"host","id").addGroup("B").addGroup("C");
    tmGroup.counter("1");
    assertEquals("Reporters were not properly instantiated",2,testRegistry.getReporters().size());
    for (    MetricReporter reporter : testRegistry.getReporters()) {
      ScopeCheckingTestReporter typedReporter=(ScopeCheckingTestReporter)reporter;
      if (typedReporter.failureCause != null) {
        throw typedReporter.failureCause;
      }
    }
  }
  finally {
    testRegistry.shutdown().get();
  }
}
