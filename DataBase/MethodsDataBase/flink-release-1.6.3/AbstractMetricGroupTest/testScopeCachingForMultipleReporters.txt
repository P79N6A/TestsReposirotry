@Test public void testScopeCachingForMultipleReporters() throws Exception {
  Configuration config=new Configuration();
  config.setString(MetricOptions.SCOPE_NAMING_TM,"A.B.C.D");
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test1." + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,TestReporter1.class.getName());
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test1." + ConfigConstants.METRICS_REPORTER_SCOPE_DELIMITER,"-");
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test2." + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,TestReporter2.class.getName());
  config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "test2." + ConfigConstants.METRICS_REPORTER_SCOPE_DELIMITER,"!");
  MetricRegistryImpl testRegistry=new MetricRegistryImpl(MetricRegistryConfiguration.fromConfiguration(config));
  try {
    MetricGroup tmGroup=new TaskManagerMetricGroup(testRegistry,"host","id");
    tmGroup.counter("1");
    assertEquals("Reporters were not properly instantiated",2,testRegistry.getReporters().size());
    for (    MetricReporter reporter : testRegistry.getReporters()) {
      ScopeCheckingTestReporter typedReporter=(ScopeCheckingTestReporter)reporter;
      if (typedReporter.failureCause != null) {
        throw typedReporter.failureCause;
      }
    }
  }
  finally {
    testRegistry.shutdown().get();
  }
}
