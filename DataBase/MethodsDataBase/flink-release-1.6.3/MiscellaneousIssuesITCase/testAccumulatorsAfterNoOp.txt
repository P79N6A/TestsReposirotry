@Test public void testAccumulatorsAfterNoOp(){
  final String accName="test_accumulator";
  try {
    ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
    env.setParallelism(6);
    env.getConfig().disableSysoutLogging();
    env.generateSequence(1,1000000).rebalance().flatMap(new RichFlatMapFunction<Long,Long>(){
      private LongCounter counter;
      @Override public void open(      Configuration parameters){
        counter=getRuntimeContext().getLongCounter(accName);
      }
      @Override public void flatMap(      Long value,      Collector<Long> out){
        counter.add(1L);
      }
    }
).output(new DiscardingOutputFormat<Long>());
    JobExecutionResult result=env.execute();
    assertEquals(1000000L,result.getAllAccumulatorResults().get(accName));
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
