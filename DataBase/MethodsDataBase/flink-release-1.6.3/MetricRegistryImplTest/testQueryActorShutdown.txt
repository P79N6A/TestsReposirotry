/** 
 * Tests that the query actor will be stopped when the MetricRegistry is shut down.
 */
@Test public void testQueryActorShutdown() throws Exception {
  final FiniteDuration timeout=new FiniteDuration(10L,TimeUnit.SECONDS);
  MetricRegistryImpl registry=new MetricRegistryImpl(MetricRegistryConfiguration.defaultMetricRegistryConfiguration());
  final ActorSystem actorSystem=AkkaUtils.createDefaultActorSystem();
  registry.startQueryService(actorSystem,null);
  ActorRef queryServiceActor=registry.getQueryService();
  registry.shutdown().get();
  try {
    Await.result(actorSystem.actorSelection(queryServiceActor.path()).resolveOne(timeout),timeout);
    fail("The query actor should be terminated resulting in a ActorNotFound exception.");
  }
 catch (  ActorNotFound e) {
  }
}
