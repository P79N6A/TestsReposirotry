/** 
 * Tests the JobManager leader retrieval for a given job.
 */
@Test public void testJobManagerLeaderRetrieval() throws Exception {
  final String address="foobar";
  JobID jobId=new JobID();
  LeaderRetrievalListener leaderRetrievalListener=mock(LeaderRetrievalListener.class);
  LeaderContender leaderContender=mock(LeaderContender.class);
  when(leaderContender.getAddress()).thenReturn(address);
  LeaderElectionService leaderElectionService=embeddedHaServices.getJobManagerLeaderElectionService(jobId);
  LeaderRetrievalService leaderRetrievalService=embeddedHaServices.getJobManagerLeaderRetriever(jobId);
  leaderRetrievalService.start(leaderRetrievalListener);
  leaderElectionService.start(leaderContender);
  ArgumentCaptor<UUID> leaderIdArgumentCaptor=ArgumentCaptor.forClass(UUID.class);
  verify(leaderContender).grantLeadership(leaderIdArgumentCaptor.capture());
  final UUID leaderId=leaderIdArgumentCaptor.getValue();
  leaderElectionService.confirmLeaderSessionID(leaderId);
  verify(leaderRetrievalListener).notifyLeaderAddress(eq(address),eq(leaderId));
}
