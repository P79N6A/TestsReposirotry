/** 
 * Tests that the registered classes in Kryo did not change. <p>Once we have proper serializer versioning this test will become obsolete. But currently a change in the serializers can break savepoint backwards compatibility between Flink versions.
 */
@Test public void testDefaultKryoRegisteredClassesDidNotChange() throws Exception {
  final Kryo kryo=new KryoSerializer<>(Integer.class,new ExecutionConfig()).getKryo();
  try (BufferedReader reader=new BufferedReader(new InputStreamReader(getClass().getClassLoader().getResourceAsStream("flink_11-kryo_registrations")))){
    String line;
    while ((line=reader.readLine()) != null) {
      String[] split=line.split(",");
      final int tag=Integer.parseInt(split[0]);
      final String registeredClass=split[1];
      Registration registration=kryo.getRegistration(tag);
      if (registration == null) {
        fail(String.format("Registration for %d = %s got lost",tag,registeredClass));
      }
 else       if (!registeredClass.equals(registration.getType().getName())) {
        fail(String.format("Registration for %d = %s changed to %s",tag,registeredClass,registration.getType().getName()));
      }
    }
  }
 }
