/** 
 * Tests request failure serialization.
 */
@Test public void testKvStateRequestFailureSerialization() throws Exception {
  long requestId=Integer.MAX_VALUE + 1111222L;
  IllegalStateException cause=new IllegalStateException("Expected test");
  ByteBuf buf=MessageSerializer.serializeRequestFailure(alloc,requestId,cause);
  int frameLength=buf.readInt();
  assertEquals(MessageType.REQUEST_FAILURE,MessageSerializer.deserializeHeader(buf));
  RequestFailure requestFailure=MessageSerializer.deserializeRequestFailure(buf);
  assertEquals(buf.readerIndex(),frameLength + 4);
  assertEquals(requestId,requestFailure.getRequestId());
  assertEquals(cause.getClass(),requestFailure.getCause().getClass());
  assertEquals(cause.getMessage(),requestFailure.getCause().getMessage());
}
