/** 
 * Tests server failure serialization.
 */
@Test public void testServerFailureSerialization() throws Exception {
  IllegalStateException cause=new IllegalStateException("Expected test");
  ByteBuf buf=MessageSerializer.serializeServerFailure(alloc,cause);
  int frameLength=buf.readInt();
  assertEquals(MessageType.SERVER_FAILURE,MessageSerializer.deserializeHeader(buf));
  Throwable request=MessageSerializer.deserializeServerFailure(buf);
  assertEquals(buf.readerIndex(),frameLength + 4);
  assertEquals(cause.getClass(),request.getClass());
  assertEquals(cause.getMessage(),request.getMessage());
}
