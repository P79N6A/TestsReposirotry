/** 
 * Tests request serialization with zero-length serialized key and namespace.
 */
@Test public void testRequestSerializationWithZeroLengthKeyAndNamespace() throws Exception {
  long requestId=Integer.MAX_VALUE + 1337L;
  KvStateID kvStateId=new KvStateID();
  byte[] serializedKeyAndNamespace=new byte[0];
  final KvStateInternalRequest request=new KvStateInternalRequest(kvStateId,serializedKeyAndNamespace);
  final MessageSerializer<KvStateInternalRequest,KvStateResponse> serializer=new MessageSerializer<>(new KvStateInternalRequest.KvStateInternalRequestDeserializer(),new KvStateResponse.KvStateResponseDeserializer());
  ByteBuf buf=MessageSerializer.serializeRequest(alloc,requestId,request);
  int frameLength=buf.readInt();
  assertEquals(MessageType.REQUEST,MessageSerializer.deserializeHeader(buf));
  assertEquals(requestId,MessageSerializer.getRequestId(buf));
  KvStateInternalRequest requestDeser=serializer.deserializeRequest(buf);
  assertEquals(buf.readerIndex(),frameLength + 4);
  assertEquals(kvStateId,requestDeser.getKvStateId());
  assertArrayEquals(serializedKeyAndNamespace,requestDeser.getSerializedKeyAndNamespace());
}
