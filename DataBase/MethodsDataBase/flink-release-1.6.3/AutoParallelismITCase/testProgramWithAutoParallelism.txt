@Test public void testProgramWithAutoParallelism() throws Exception {
  ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  env.setParallelism(ExecutionConfig.PARALLELISM_AUTO_MAX);
  env.getConfig().disableSysoutLogging();
  DataSet<Integer> result=env.createInput(new ParallelismDependentInputFormat()).rebalance().mapPartition(new ParallelismDependentMapPartition());
  List<Integer> resultCollection=new ArrayList<>();
  result.output(new LocalCollectionOutputFormat<>(resultCollection));
  try {
    env.execute();
    assertEquals(PARALLELISM,resultCollection.size());
  }
 catch (  Exception ex) {
    if (MINI_CLUSTER_RESOURCE.getCodebaseType() == TestBaseUtils.CodebaseType.LEGACY) {
      throw ex;
    }
    assertTrue(ExceptionUtils.findThrowableWithMessage(ex,ExecutionGraphBuilder.PARALLELISM_AUTO_MAX_ERROR_MESSAGE).isPresent());
  }
}
