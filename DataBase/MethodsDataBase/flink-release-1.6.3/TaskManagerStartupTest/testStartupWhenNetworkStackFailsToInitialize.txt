/** 
 * Tests that the task manager start-up fails if the network stack cannot be initialized.
 * @throws Exception
 */
@Test(expected=IOException.class) public void testStartupWhenNetworkStackFailsToInitialize() throws Exception {
  ServerSocket blocker=null;
  try {
    blocker=new ServerSocket(0,50,InetAddress.getByName("localhost"));
    final Configuration cfg=new Configuration();
    cfg.setString(TaskManagerOptions.HOST,"localhost");
    cfg.setInteger(TaskManagerOptions.DATA_PORT,blocker.getLocalPort());
    cfg.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE,"1m");
    ActorSystem actorSystem=AkkaUtils.createLocalActorSystem(cfg);
    TaskManager.startTaskManagerComponentsAndActor(cfg,ResourceID.generate(),actorSystem,highAvailabilityServices,NoOpMetricRegistry.INSTANCE,"localhost",Option.<String>empty(),false,TaskManager.class);
  }
  finally {
    if (blocker != null) {
      try {
        blocker.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
