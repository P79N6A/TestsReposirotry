/** 
 * Tests that the TaskManager startup fails synchronously when the I/O directories are not writable.
 */
@Test public void testIODirectoryNotWritable() throws Exception {
  File nonWritable=tempFolder.newFolder();
  Assume.assumeTrue("Cannot create non-writable temporary file directory. Skipping test.",nonWritable.setWritable(false,false));
  try {
    Configuration cfg=new Configuration();
    cfg.setString(CoreOptions.TMP_DIRS,nonWritable.getAbsolutePath());
    cfg.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE,"4m");
    cfg.setString(JobManagerOptions.ADDRESS,"localhost");
    cfg.setInteger(JobManagerOptions.PORT,21656);
    try {
      TaskManager.runTaskManager("localhost",ResourceID.generate(),0,cfg,highAvailabilityServices);
      fail("Should fail synchronously with an exception");
    }
 catch (    IOException e) {
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
 finally {
    nonWritable.setWritable(true,false);
    try {
      FileUtils.deleteDirectory(nonWritable);
    }
 catch (    IOException e) {
    }
    highAvailabilityServices.closeAndCleanupAllData();
  }
}
