/** 
 * Tests that the TaskManager startup fails synchronously when the I/O directories are not writable.
 */
@Test public void testMemoryConfigWrong(){
  try {
    Configuration cfg=new Configuration();
    cfg.setString(JobManagerOptions.ADDRESS,"localhost");
    cfg.setInteger(JobManagerOptions.PORT,21656);
    cfg.setBoolean(TaskManagerOptions.MANAGED_MEMORY_PRE_ALLOCATE,true);
    cfg.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE,"-42m");
    try {
      TaskManager.runTaskManager("localhost",ResourceID.generate(),0,cfg,highAvailabilityServices);
      fail("Should fail synchronously with an exception");
    }
 catch (    IllegalConfigurationException e) {
    }
    final long memSize=(((long)Integer.MAX_VALUE - 1) * MemorySize.parse(TaskManagerOptions.MEMORY_SEGMENT_SIZE.defaultValue()).getBytes()) >> 20;
    cfg.setString(TaskManagerOptions.MANAGED_MEMORY_SIZE,memSize + "m");
    try {
      TaskManager.runTaskManager("localhost",ResourceID.generate(),0,cfg,highAvailabilityServices);
      fail("Should fail synchronously with an exception");
    }
 catch (    Exception e) {
      assertTrue(e.getCause() instanceof OutOfMemoryError);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
