/** 
 * Tests that the file state handle does not attempt to check and clean up the parent directory. Doing directory contents checks and cleaning up the parent directory in the state handle disposal has previously led to excessive file system metadata requests, which especially on systems like Amazon S3 is prohibitively expensive.
 */
@Test public void testDisposeDoesNotDeleteParentDirectory() throws Exception {
  File parentDir=tempFolder.newFolder();
  assertTrue(parentDir.exists());
  File file=new File(parentDir,"test");
  writeTestData(file);
  assertTrue(file.exists());
  FileStateHandle handle=new FileStateHandle(Path.fromLocalFile(file),file.length());
  handle.discardState();
  assertFalse(file.exists());
  assertTrue(parentDir.exists());
}
