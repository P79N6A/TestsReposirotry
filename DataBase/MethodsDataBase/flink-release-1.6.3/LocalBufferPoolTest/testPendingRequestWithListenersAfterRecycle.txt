@Test public void testPendingRequestWithListenersAfterRecycle() throws Exception {
  BufferListener twoTimesListener=createBufferListener(2);
  BufferListener oneTimeListener=createBufferListener(1);
  localBufferPool.setNumBuffers(2);
  Buffer available1=localBufferPool.requestBuffer();
  Buffer available2=localBufferPool.requestBuffer();
  assertNull(localBufferPool.requestBuffer());
  assertTrue(localBufferPool.addBufferListener(twoTimesListener));
  assertTrue(localBufferPool.addBufferListener(oneTimeListener));
  available1.recycleBuffer();
  verify(oneTimeListener,times(1)).notifyBufferAvailable(any(Buffer.class));
  verify(twoTimesListener,times(1)).notifyBufferAvailable(any(Buffer.class));
  available2.recycleBuffer();
  verify(oneTimeListener,times(1)).notifyBufferAvailable(any(Buffer.class));
  verify(twoTimesListener,times(2)).notifyBufferAvailable(any(Buffer.class));
}
