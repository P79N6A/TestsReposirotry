@Test public void testSuccessfulRpcConnection() throws Exception {
  final String testRpcConnectionEndpointAddress="<TestRpcConnectionEndpointAddress>";
  final UUID leaderId=UUID.randomUUID();
  final String connectionID="Test RPC Connection ID";
  TestRegistrationGateway testGateway=new TestRegistrationGateway(new RetryingRegistrationTest.TestRegistrationSuccess(connectionID));
  try {
    rpcService.registerGateway(testRpcConnectionEndpointAddress,testGateway);
    TestRpcConnection connection=new TestRpcConnection(testRpcConnectionEndpointAddress,leaderId,rpcService.getExecutor(),rpcService);
    connection.start();
    final String actualConnectionId=connection.getConnectionFuture().get();
    assertTrue(connection.isConnected());
    assertEquals(testRpcConnectionEndpointAddress,connection.getTargetAddress());
    assertEquals(leaderId,connection.getTargetLeaderId());
    assertEquals(testGateway,connection.getTargetGateway());
    assertEquals(connectionID,actualConnectionId);
  }
  finally {
    testGateway.stop();
  }
}
