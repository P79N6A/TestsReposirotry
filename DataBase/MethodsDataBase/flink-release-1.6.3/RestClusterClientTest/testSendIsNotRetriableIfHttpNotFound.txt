/** 
 * Tests that the send operation is not being retried when receiving a NOT_FOUND return code.
 */
@Test public void testSendIsNotRetriableIfHttpNotFound() throws Exception {
  final String exceptionMessage="test exception";
  final PingRestHandler pingRestHandler=new PingRestHandler(FutureUtils.completedExceptionally(new RestHandlerException(exceptionMessage,HttpResponseStatus.NOT_FOUND)));
  try (final TestRestServerEndpoint restServerEndpoint=createRestServerEndpoint(pingRestHandler)){
    try {
      restClusterClient.sendRequest(PingRestHandlerHeaders.INSTANCE).get();
      fail("The rest request should have failed.");
    }
 catch (    Exception e) {
      assertThat(ExceptionUtils.findThrowableWithMessage(e,exceptionMessage).isPresent(),is(true));
    }
  }
 }
