/** 
 * Tests that the send operation is being retried.
 */
@Test public void testRetriableSendOperationIfConnectionErrorOrServiceUnavailable() throws Exception {
  final PingRestHandler pingRestHandler=new PingRestHandler(FutureUtils.completedExceptionally(new RestHandlerException("test exception",HttpResponseStatus.SERVICE_UNAVAILABLE)),CompletableFuture.completedFuture(EmptyResponseBody.getInstance()));
  try (final TestRestServerEndpoint restServerEndpoint=createRestServerEndpoint(pingRestHandler)){
    final AtomicBoolean firstPollFailed=new AtomicBoolean();
    failHttpRequest=(messageHeaders,messageParameters,requestBody) -> messageHeaders instanceof PingRestHandlerHeaders && !firstPollFailed.getAndSet(true);
    restClusterClient.sendRequest(PingRestHandlerHeaders.INSTANCE).get();
  }
 }
