@Test public void testRunOutOfProducersInThePool() throws Exception {
  String topic="flink-kafka-run-out-of-producers";
  try (OneInputStreamOperatorTestHarness<Integer,Object> testHarness=createTestHarness(topic)){
    testHarness.setup();
    testHarness.open();
    for (int i=0; i < FlinkKafkaProducer011.DEFAULT_KAFKA_PRODUCERS_POOL_SIZE * 2; i++) {
      testHarness.processElement(i,i * 2);
      testHarness.snapshot(i,i * 2 + 1);
    }
  }
 catch (  Exception ex) {
    if (!ex.getCause().getMessage().startsWith("Too many ongoing")) {
      throw ex;
    }
  }
  deleteTestTopic(topic);
}
