@Test public void testRecoverCommittedTransaction() throws Exception {
  String topic="flink-kafka-producer-recover-committed-transaction";
  OneInputStreamOperatorTestHarness<Integer,Object> testHarness=createTestHarness(topic);
  testHarness.setup();
  testHarness.open();
  testHarness.processElement(42,0);
  OperatorSubtaskState checkpoint0=testHarness.snapshot(0,1);
  testHarness.processElement(43,2);
  testHarness.notifyOfCompletedCheckpoint(0);
  testHarness.snapshot(1,3);
  testHarness.processElement(44,4);
  testHarness.close();
  testHarness=createTestHarness(topic);
  testHarness.initializeState(checkpoint0);
  testHarness.close();
  assertExactlyOnceForTopic(createProperties(),topic,0,Arrays.asList(42));
  deleteTestTopic(topic);
}
