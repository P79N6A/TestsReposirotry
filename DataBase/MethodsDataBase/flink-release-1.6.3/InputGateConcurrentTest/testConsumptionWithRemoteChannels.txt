@Test public void testConsumptionWithRemoteChannels() throws Exception {
  final int numChannels=11;
  final int buffersPerChannel=1000;
  final ConnectionManager connManager=createDummyConnectionManager();
  final Source[] sources=new Source[numChannels];
  final SingleInputGate gate=new SingleInputGate("Test Task Name",new JobID(),new IntermediateDataSetID(),ResultPartitionType.PIPELINED,0,numChannels,mock(TaskActions.class),UnregisteredMetricGroups.createUnregisteredTaskMetricGroup().getIOMetricGroup(),true);
  for (int i=0; i < numChannels; i++) {
    RemoteInputChannel channel=new RemoteInputChannel(gate,i,new ResultPartitionID(),mock(ConnectionID.class),connManager,0,0,UnregisteredMetricGroups.createUnregisteredTaskMetricGroup().getIOMetricGroup());
    gate.setInputChannel(new IntermediateResultPartitionID(),channel);
    sources[i]=new RemoteChannelSource(channel);
  }
  ProducerThread producer=new ProducerThread(sources,numChannels * buffersPerChannel,4,10);
  ConsumerThread consumer=new ConsumerThread(gate,numChannels * buffersPerChannel);
  producer.start();
  consumer.start();
  producer.sync();
  consumer.sync();
}
