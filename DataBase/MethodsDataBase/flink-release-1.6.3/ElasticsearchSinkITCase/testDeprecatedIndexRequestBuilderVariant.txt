/** 
 * Tests that behaviour of the deprecated  {@link IndexRequestBuilder} constructor works properly.
 */
@Test public void testDeprecatedIndexRequestBuilderVariant() throws Exception {
  final String index="index-req-builder-test-index";
  final StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  DataStreamSource<Tuple2<Integer,String>> source=env.addSource(new SourceSinkDataTestKit.TestDataSourceFunction());
  Map<String,String> userConfig=new HashMap<>();
  userConfig.put(ElasticsearchSinkBase.CONFIG_KEY_BULK_FLUSH_MAX_ACTIONS,"1");
  userConfig.put("cluster.name",CLUSTER_NAME);
  userConfig.put("node.local","true");
  List<TransportAddress> transports=new ArrayList<>();
  transports.add(new LocalTransportAddress("1"));
  source.addSink(new ElasticsearchSink<>(userConfig,transports,new TestIndexRequestBuilder(index)));
  env.execute("Elasticsearch Deprecated IndexRequestBuilder Bridge Test");
  Client client=embeddedNodeEnv.getClient();
  SourceSinkDataTestKit.verifyProducedSinkData(client,index);
  client.close();
}
