@Test public void testCancelledJobThrowsJobCancellationException() throws Exception {
  final FlinkException cause=new FlinkException("Test exception");
  final JobResult jobResult=JobResult.createFrom(new ArchivedExecutionGraphBuilder().setJobID(new JobID()).setState(JobStatus.CANCELED).setFailureCause(new ErrorInfo(cause,42L)).build());
  try {
    jobResult.toJobExecutionResult(getClass().getClassLoader());
    fail("Job should fail with an JobCancellationException.");
  }
 catch (  JobCancellationException expected) {
    assertThat(expected.getCause(),is(equalTo(cause)));
  }
}
