/** 
 * Tests the triggering and exceptional completion of an asynchronous operation.
 */
@Test public void testOperationFailure() throws Exception {
  final FlinkException testException=new FlinkException("Test exception");
  final TestingRestfulGateway testingRestfulGateway=new TestingRestfulGateway.Builder().setTriggerSavepointFunction((  JobID jobId,  String directory) -> FutureUtils.completedExceptionally(testException)).build();
  final TriggerId triggerId=testingTriggerHandler.handleRequest(triggerOperationRequest(),testingRestfulGateway).get().getTriggerId();
  AsynchronousOperationResult<OperationResult> operationResult=testingStatusHandler.handleRequest(statusOperationRequest(triggerId),testingRestfulGateway).get();
  assertThat(operationResult.queueStatus().getId(),is(QueueStatus.completed().getId()));
  final OperationResult resource=operationResult.resource();
  assertThat(resource.throwable,is(testException));
}
