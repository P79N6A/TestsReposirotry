/** 
 * Tests the triggering and successful completion of an asynchronous operation.
 */
@Test public void testOperationCompletion() throws Exception {
  final CompletableFuture<String> savepointFuture=new CompletableFuture<>();
  final TestingRestfulGateway testingRestfulGateway=new TestingRestfulGateway.Builder().setTriggerSavepointFunction((  JobID jobId,  String directory) -> savepointFuture).build();
  final TriggerId triggerId=testingTriggerHandler.handleRequest(triggerOperationRequest(),testingRestfulGateway).get().getTriggerId();
  AsynchronousOperationResult<OperationResult> operationResult=testingStatusHandler.handleRequest(statusOperationRequest(triggerId),testingRestfulGateway).get();
  assertThat(operationResult.queueStatus().getId(),is(QueueStatus.inProgress().getId()));
  final String savepointPath="foobar";
  savepointFuture.complete(savepointPath);
  operationResult=testingStatusHandler.handleRequest(statusOperationRequest(triggerId),testingRestfulGateway).get();
  assertThat(operationResult.queueStatus().getId(),is(QueueStatus.completed().getId()));
  assertThat(operationResult.resource().value,is(savepointPath));
}
