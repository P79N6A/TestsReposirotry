/** 
 * Verify that state &lt;TimeWindow&gt;of separate windows does not leak into other windows.
 */
@Test public void testWindowSeparationAndFiring() throws Exception {
  TriggerTestHarness<Object,TimeWindow> testHarness=new TriggerTestHarness<>(ContinuousEventTimeTrigger.<TimeWindow>of(Time.hours(1)),new TimeWindow.Serializer());
  assertEquals(TriggerResult.CONTINUE,testHarness.processElement(new StreamRecord<Object>(1),new TimeWindow(0,2)));
  assertEquals(TriggerResult.CONTINUE,testHarness.processElement(new StreamRecord<Object>(1),new TimeWindow(0,2)));
  assertEquals(TriggerResult.CONTINUE,testHarness.processElement(new StreamRecord<Object>(1),new TimeWindow(0,2)));
  assertEquals(TriggerResult.CONTINUE,testHarness.processElement(new StreamRecord<Object>(1),new TimeWindow(2,4)));
  assertEquals(TriggerResult.CONTINUE,testHarness.processElement(new StreamRecord<Object>(1),new TimeWindow(2,4)));
  assertEquals(2,testHarness.numStateEntries());
  assertEquals(0,testHarness.numProcessingTimeTimers());
  assertEquals(4,testHarness.numEventTimeTimers());
  assertEquals(2,testHarness.numEventTimeTimers(new TimeWindow(0,2)));
  assertEquals(2,testHarness.numEventTimeTimers(new TimeWindow(2,4)));
  Collection<Tuple2<TimeWindow,TriggerResult>> triggerResults=testHarness.advanceWatermark(2);
  boolean sawFiring=false;
  for (  Tuple2<TimeWindow,TriggerResult> r : triggerResults) {
    if (r.f0.equals(new TimeWindow(0,2))) {
      sawFiring=true;
      assertTrue(r.f1.equals(TriggerResult.FIRE));
    }
  }
  assertTrue(sawFiring);
  assertEquals(2,testHarness.numStateEntries());
  assertEquals(0,testHarness.numProcessingTimeTimers());
  assertEquals(3,testHarness.numEventTimeTimers());
  assertEquals(1,testHarness.numEventTimeTimers(new TimeWindow(0,2)));
  assertEquals(2,testHarness.numEventTimeTimers(new TimeWindow(2,4)));
  triggerResults=testHarness.advanceWatermark(4);
  sawFiring=false;
  for (  Tuple2<TimeWindow,TriggerResult> r : triggerResults) {
    if (r.f0.equals(new TimeWindow(2,4))) {
      sawFiring=true;
      assertTrue(r.f1.equals(TriggerResult.FIRE));
    }
  }
  assertTrue(sawFiring);
  assertEquals(2,testHarness.numStateEntries());
  assertEquals(0,testHarness.numProcessingTimeTimers());
  assertEquals(2,testHarness.numEventTimeTimers());
}
