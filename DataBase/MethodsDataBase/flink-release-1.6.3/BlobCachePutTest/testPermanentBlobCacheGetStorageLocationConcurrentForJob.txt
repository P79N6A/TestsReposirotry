/** 
 * Tests concurrent calls to  {@link PermanentBlobCache#getStorageLocation(JobID,BlobKey)}.
 */
@Test public void testPermanentBlobCacheGetStorageLocationConcurrentForJob() throws Exception {
  final JobID jobId=new JobID();
  final Configuration config=new Configuration();
  config.setString(BlobServerOptions.STORAGE_DIRECTORY,temporaryFolder.newFolder().getAbsolutePath());
  try (BlobServer server=new BlobServer(config,new VoidBlobStore());final PermanentBlobCache cache=new PermanentBlobCache(config,new VoidBlobStore(),new InetSocketAddress("localhost",server.getPort()))){
    server.start();
    BlobKey key=new PermanentBlobKey();
    CheckedThread[] threads=new CheckedThread[]{new PermanentBlobCacheGetStorageLocation(cache,jobId,key),new PermanentBlobCacheGetStorageLocation(cache,jobId,key),new PermanentBlobCacheGetStorageLocation(cache,jobId,key)};
    checkedThreadSimpleTest(threads);
  }
 }
