@Test public void testDiamondWithMixedPipelinedAndBlockingExchanges() throws Exception {
  final JobVertex vertex1=new JobVertex("vertex1");
  vertex1.setInvokableClass(NoOpInvokable.class);
  vertex1.setParallelism(8);
  final JobVertex vertex2=new JobVertex("vertex2");
  vertex2.setInvokableClass(NoOpInvokable.class);
  vertex2.setParallelism(8);
  final JobVertex vertex3=new JobVertex("vertex3");
  vertex3.setInvokableClass(NoOpInvokable.class);
  vertex3.setParallelism(8);
  final JobVertex vertex4=new JobVertex("vertex4");
  vertex4.setInvokableClass(NoOpInvokable.class);
  vertex4.setParallelism(8);
  vertex2.connectNewDataSetAsInput(vertex1,DistributionPattern.ALL_TO_ALL,ResultPartitionType.BLOCKING);
  vertex3.connectNewDataSetAsInput(vertex1,DistributionPattern.ALL_TO_ALL,ResultPartitionType.PIPELINED);
  vertex4.connectNewDataSetAsInput(vertex2,DistributionPattern.ALL_TO_ALL,ResultPartitionType.PIPELINED);
  vertex4.connectNewDataSetAsInput(vertex3,DistributionPattern.ALL_TO_ALL,ResultPartitionType.PIPELINED);
  final JobGraph jobGraph=new JobGraph("test job",vertex1,vertex2,vertex3,vertex4);
  final ExecutionGraph eg=createExecutionGraph(jobGraph);
  RestartPipelinedRegionStrategy failoverStrategy=(RestartPipelinedRegionStrategy)eg.getFailoverStrategy();
  Iterator<ExecutionVertex> evs=eg.getAllExecutionVertices().iterator();
  FailoverRegion preRegion=failoverStrategy.getFailoverRegion(evs.next());
  while (evs.hasNext()) {
    FailoverRegion region=failoverStrategy.getFailoverRegion(evs.next());
    assertTrue(preRegion == region);
  }
}
