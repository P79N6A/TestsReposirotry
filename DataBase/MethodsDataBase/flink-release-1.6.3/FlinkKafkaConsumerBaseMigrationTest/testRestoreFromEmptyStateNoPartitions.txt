/** 
 * Test restoring from an legacy empty state, when no partitions could be found for topics.
 */
@Test public void testRestoreFromEmptyStateNoPartitions() throws Exception {
  final DummyFlinkKafkaConsumer<String> consumerFunction=new DummyFlinkKafkaConsumer<>(Collections.<KafkaTopicPartition>emptyList(),FlinkKafkaConsumerBase.PARTITION_DISCOVERY_DISABLED);
  StreamSource<String,DummyFlinkKafkaConsumer<String>> consumerOperator=new StreamSource<>(consumerFunction);
  final AbstractStreamOperatorTestHarness<String> testHarness=new AbstractStreamOperatorTestHarness<>(consumerOperator,1,1,0);
  testHarness.setTimeCharacteristic(TimeCharacteristic.ProcessingTime);
  testHarness.setup();
  MigrationTestUtil.restoreFromSnapshot(testHarness,OperatorSnapshotUtil.getResourceFilename("kafka-consumer-migration-test-flink" + testMigrateVersion + "-empty-state-snapshot"),testMigrateVersion);
  testHarness.open();
  assertTrue(consumerFunction.getSubscribedPartitionsToStartOffsets() != null);
  assertTrue(consumerFunction.getSubscribedPartitionsToStartOffsets().isEmpty());
  assertTrue(consumerFunction.getRestoredState().isEmpty());
  consumerOperator.close();
  consumerOperator.cancel();
}
