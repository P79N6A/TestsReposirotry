/** 
 * Tests that the watermark of an input channel remains intact while in the IDLE status.
 */
@Test public void testSingleInputWatermarksIntactDuringIdleness(){
  BufferedValveOutputHandler valveOutput=new BufferedValveOutputHandler();
  StatusWatermarkValve valve=new StatusWatermarkValve(1,valveOutput);
  valve.inputWatermark(new Watermark(25),0);
  assertEquals(new Watermark(25),valveOutput.popLastSeenOutput());
  assertEquals(null,valveOutput.popLastSeenOutput());
  valve.inputStreamStatus(StreamStatus.IDLE,0);
  assertEquals(StreamStatus.IDLE,valveOutput.popLastSeenOutput());
  valve.inputWatermark(new Watermark(50),0);
  assertEquals(null,valveOutput.popLastSeenOutput());
  assertEquals(25,valve.getInputChannelStatus(0).watermark);
  valve.inputStreamStatus(StreamStatus.ACTIVE,0);
  assertEquals(StreamStatus.ACTIVE,valveOutput.popLastSeenOutput());
  assertEquals(null,valveOutput.popLastSeenOutput());
  valve.inputWatermark(new Watermark(50),0);
  assertEquals(new Watermark(50),valveOutput.popLastSeenOutput());
  assertEquals(null,valveOutput.popLastSeenOutput());
}
