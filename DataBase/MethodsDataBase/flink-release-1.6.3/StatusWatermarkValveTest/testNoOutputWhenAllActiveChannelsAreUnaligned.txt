/** 
 * Verify that we don't see any state changes/watermarks when all ACTIVE channels are unaligned. Earlier versions of the valve had a bug that would cause it to emit a  {@code Long.MAX_VALUE}watermark in that case.
 */
@Test public void testNoOutputWhenAllActiveChannelsAreUnaligned(){
  BufferedValveOutputHandler valveOutput=new BufferedValveOutputHandler();
  StatusWatermarkValve valve=new StatusWatermarkValve(3,valveOutput);
  valve.inputWatermark(new Watermark(10),0);
  valve.inputWatermark(new Watermark(7),1);
  valve.inputStreamStatus(StreamStatus.IDLE,2);
  assertEquals(new Watermark(7),valveOutput.popLastSeenOutput());
  assertEquals(null,valveOutput.popLastSeenOutput());
  valve.inputStreamStatus(StreamStatus.ACTIVE,2);
  assertEquals(null,valveOutput.popLastSeenOutput());
  valve.inputStreamStatus(StreamStatus.IDLE,0);
  valve.inputStreamStatus(StreamStatus.IDLE,1);
  assertEquals(null,valveOutput.popLastSeenOutput());
}
