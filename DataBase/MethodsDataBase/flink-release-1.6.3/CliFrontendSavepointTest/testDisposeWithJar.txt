/** 
 * Tests disposal with a JAR file.
 */
@Test public void testDisposeWithJar() throws Exception {
  replaceStdOutAndStdErr();
  final CompletableFuture<String> disposeSavepointFuture=new CompletableFuture<>();
  final DisposeSavepointClusterClient clusterClient=new DisposeSavepointClusterClient((  String savepointPath) -> {
    disposeSavepointFuture.complete(savepointPath);
    return CompletableFuture.completedFuture(Acknowledge.get());
  }
,getConfiguration());
  try {
    CliFrontend frontend=new MockedCliFrontend(clusterClient);
    File f=tmp.newFile();
    ZipOutputStream out=new ZipOutputStream(new FileOutputStream(f));
    out.close();
    final String disposePath="any-path";
    String[] parameters={"-d",disposePath,"-j",f.getAbsolutePath()};
    frontend.savepoint(parameters);
    final String actualSavepointPath=disposeSavepointFuture.get();
    assertEquals(disposePath,actualSavepointPath);
  }
  finally {
    clusterClient.shutdown();
    restoreStdOutAndStdErr();
  }
}
