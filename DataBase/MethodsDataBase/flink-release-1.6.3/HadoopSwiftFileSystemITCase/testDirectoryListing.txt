@Test public void testDirectoryListing() throws Exception {
  final Configuration conf=createConfiguration();
  FileSystem.initialize(conf);
  final Path directory=new Path("swift://" + CONTAINER + '.'+ SERVICENAME+ '/'+ TEST_DATA_DIR+ "/testdir/");
  final FileSystem fs=directory.getFileSystem();
  assertFalse(fs.exists(directory));
  try {
    assertTrue(fs.mkdirs(directory));
    assertTrue(fs.exists(directory));
    assertEquals(0,fs.listStatus(directory).length);
    final int numFiles=3;
    for (int i=0; i < numFiles; i++) {
      Path file=new Path(directory,"/file-" + i);
      try (FSDataOutputStream out=fs.create(file,FileSystem.WriteMode.NO_OVERWRITE);OutputStreamWriter writer=new OutputStreamWriter(out,StandardCharsets.UTF_8)){
        writer.write("hello-" + i + "\n");
      }
     }
    FileStatus[] files=fs.listStatus(directory);
    assertNotNull(files);
    assertEquals(3,files.length);
    for (    FileStatus status : files) {
      assertFalse(status.isDir());
    }
    assertTrue(fs.exists(directory));
  }
  finally {
    fs.delete(directory,true);
  }
  assertFalse(fs.exists(directory));
}
