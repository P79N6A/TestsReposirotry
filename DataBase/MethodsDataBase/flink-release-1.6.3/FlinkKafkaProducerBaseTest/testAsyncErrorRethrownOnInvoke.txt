/** 
 * Test ensuring that if an invoke call happens right after an async exception is caught, it should be rethrown.
 */
@Test public void testAsyncErrorRethrownOnInvoke() throws Throwable {
  final DummyFlinkKafkaProducer<String> producer=new DummyFlinkKafkaProducer<>(FakeStandardProducerConfig.get(),new KeyedSerializationSchemaWrapper<>(new SimpleStringSchema()),null);
  OneInputStreamOperatorTestHarness<String,Object> testHarness=new OneInputStreamOperatorTestHarness<>(new StreamSink<>(producer));
  testHarness.open();
  testHarness.processElement(new StreamRecord<>("msg-1"));
  producer.getPendingCallbacks().get(0).onCompletion(null,new Exception("artificial async exception"));
  try {
    testHarness.processElement(new StreamRecord<>("msg-2"));
  }
 catch (  Exception e) {
    Assert.assertTrue(e.getCause().getMessage().contains("artificial async exception"));
    return;
  }
  Assert.fail();
}
