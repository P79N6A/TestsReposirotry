@Test public void testOperations() throws Exception {
  SlotPool.AllocatedSlots allocatedSlots=new SlotPool.AllocatedSlots();
  final AllocationID allocation1=new AllocationID();
  final SlotRequestId slotRequestID=new SlotRequestId();
  final TaskManagerLocation taskManagerLocation=new LocalTaskManagerLocation();
  final ResourceID resource1=taskManagerLocation.getResourceID();
  final AllocatedSlot slot1=createSlot(allocation1,taskManagerLocation);
  allocatedSlots.add(slotRequestID,slot1);
  assertTrue(allocatedSlots.contains(slot1.getAllocationId()));
  assertTrue(allocatedSlots.containResource(resource1));
  assertEquals(slot1,allocatedSlots.get(allocation1));
  assertEquals(1,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(1,allocatedSlots.size());
  final AllocationID allocation2=new AllocationID();
  final SlotRequestId slotRequestID2=new SlotRequestId();
  final AllocatedSlot slot2=createSlot(allocation2,taskManagerLocation);
  allocatedSlots.add(slotRequestID2,slot2);
  assertTrue(allocatedSlots.contains(slot1.getAllocationId()));
  assertTrue(allocatedSlots.contains(slot2.getAllocationId()));
  assertTrue(allocatedSlots.containResource(resource1));
  assertEquals(slot1,allocatedSlots.get(allocation1));
  assertEquals(slot2,allocatedSlots.get(allocation2));
  assertEquals(2,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(2,allocatedSlots.size());
  final AllocationID allocation3=new AllocationID();
  final SlotRequestId slotRequestID3=new SlotRequestId();
  final TaskManagerLocation taskManagerLocation2=new LocalTaskManagerLocation();
  final ResourceID resource2=taskManagerLocation2.getResourceID();
  final AllocatedSlot slot3=createSlot(allocation3,taskManagerLocation2);
  allocatedSlots.add(slotRequestID3,slot3);
  assertTrue(allocatedSlots.contains(slot1.getAllocationId()));
  assertTrue(allocatedSlots.contains(slot2.getAllocationId()));
  assertTrue(allocatedSlots.contains(slot3.getAllocationId()));
  assertTrue(allocatedSlots.containResource(resource1));
  assertTrue(allocatedSlots.containResource(resource2));
  assertEquals(slot1,allocatedSlots.get(allocation1));
  assertEquals(slot2,allocatedSlots.get(allocation2));
  assertEquals(slot3,allocatedSlots.get(allocation3));
  assertEquals(2,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(1,allocatedSlots.getSlotsForTaskManager(resource2).size());
  assertEquals(3,allocatedSlots.size());
  allocatedSlots.remove(slot2.getAllocationId());
  assertTrue(allocatedSlots.contains(slot1.getAllocationId()));
  assertFalse(allocatedSlots.contains(slot2.getAllocationId()));
  assertTrue(allocatedSlots.contains(slot3.getAllocationId()));
  assertTrue(allocatedSlots.containResource(resource1));
  assertTrue(allocatedSlots.containResource(resource2));
  assertEquals(slot1,allocatedSlots.get(allocation1));
  assertNull(allocatedSlots.get(allocation2));
  assertEquals(slot3,allocatedSlots.get(allocation3));
  assertEquals(1,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(1,allocatedSlots.getSlotsForTaskManager(resource2).size());
  assertEquals(2,allocatedSlots.size());
  allocatedSlots.remove(slot1.getAllocationId());
  assertFalse(allocatedSlots.contains(slot1.getAllocationId()));
  assertFalse(allocatedSlots.contains(slot2.getAllocationId()));
  assertTrue(allocatedSlots.contains(slot3.getAllocationId()));
  assertFalse(allocatedSlots.containResource(resource1));
  assertTrue(allocatedSlots.containResource(resource2));
  assertNull(allocatedSlots.get(allocation1));
  assertNull(allocatedSlots.get(allocation2));
  assertEquals(slot3,allocatedSlots.get(allocation3));
  assertEquals(0,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(1,allocatedSlots.getSlotsForTaskManager(resource2).size());
  assertEquals(1,allocatedSlots.size());
  allocatedSlots.remove(slot3.getAllocationId());
  assertFalse(allocatedSlots.contains(slot1.getAllocationId()));
  assertFalse(allocatedSlots.contains(slot2.getAllocationId()));
  assertFalse(allocatedSlots.contains(slot3.getAllocationId()));
  assertFalse(allocatedSlots.containResource(resource1));
  assertFalse(allocatedSlots.containResource(resource2));
  assertNull(allocatedSlots.get(allocation1));
  assertNull(allocatedSlots.get(allocation2));
  assertNull(allocatedSlots.get(allocation3));
  assertEquals(0,allocatedSlots.getSlotsForTaskManager(resource1).size());
  assertEquals(0,allocatedSlots.getSlotsForTaskManager(resource2).size());
  assertEquals(0,allocatedSlots.size());
}
