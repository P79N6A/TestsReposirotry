/** 
 * Tests  {@link SpillableSubpartition#spillFinishedBufferConsumers} spilled bytes andbuffers counting.
 */
@Test public void testSpillFinishedBufferConsumersFull() throws Exception {
  SpillableSubpartition partition=createSubpartition();
  BufferBuilder bufferBuilder=createBufferBuilder(BUFFER_DATA_SIZE);
  partition.add(bufferBuilder.createBufferConsumer());
  assertEquals(0,partition.releaseMemory());
  assertEquals(1,partition.getBuffersInBacklog());
  fillBufferBuilder(bufferBuilder,BUFFER_DATA_SIZE).finish();
  assertEquals(BUFFER_DATA_SIZE,partition.spillFinishedBufferConsumers(false));
  assertEquals(1,partition.getBuffersInBacklog());
}
