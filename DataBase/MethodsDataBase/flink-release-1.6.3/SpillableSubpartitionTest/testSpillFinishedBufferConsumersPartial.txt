/** 
 * Tests  {@link SpillableSubpartition#spillFinishedBufferConsumers} spilled bytes andbuffers counting with partially filled buffers.
 */
@Test public void testSpillFinishedBufferConsumersPartial() throws Exception {
  SpillableSubpartition partition=createSubpartition();
  BufferBuilder bufferBuilder=createBufferBuilder(BUFFER_DATA_SIZE * 2);
  partition.add(bufferBuilder.createBufferConsumer());
  fillBufferBuilder(bufferBuilder,BUFFER_DATA_SIZE);
  assertEquals(0,partition.releaseMemory());
  assertEquals(2,partition.getBuffersInBacklog());
  fillBufferBuilder(bufferBuilder,BUFFER_DATA_SIZE).finish();
  assertEquals(BUFFER_DATA_SIZE,partition.spillFinishedBufferConsumers(false));
  assertEquals(2,partition.getBuffersInBacklog());
}
