@Test public void testClosingOnSnapshot() throws Exception {
  final File outDir=TEMP_FOLDER.newFolder();
  try (OneInputStreamOperatorTestHarness<Tuple2<String,Integer>,Object> testHarness=TestUtils.createRescalingTestSink(outDir,1,0,100L,2L)){
    testHarness.setup();
    testHarness.open();
    testHarness.setProcessingTime(0L);
    testHarness.processElement(new StreamRecord<>(Tuple2.of("test1",1),1L));
    testHarness.processElement(new StreamRecord<>(Tuple2.of("test2",1),1L));
    TestUtils.checkLocalFs(outDir,2,0);
    testHarness.setProcessingTime(101L);
    TestUtils.checkLocalFs(outDir,2,0);
    testHarness.processElement(new StreamRecord<>(Tuple2.of("test3",1),1L));
    TestUtils.checkLocalFs(outDir,3,0);
    testHarness.snapshot(0L,1L);
    TestUtils.checkLocalFs(outDir,3,0);
    testHarness.notifyOfCompletedCheckpoint(0L);
    TestUtils.checkLocalFs(outDir,0,3);
    testHarness.snapshot(1L,0L);
    testHarness.processElement(new StreamRecord<>(Tuple2.of("test4",10),10L));
    TestUtils.checkLocalFs(outDir,1,3);
  }
   TestUtils.checkLocalFs(outDir,1,3);
}
