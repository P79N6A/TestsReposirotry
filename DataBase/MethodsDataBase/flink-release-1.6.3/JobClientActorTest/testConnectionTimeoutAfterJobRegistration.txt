/** 
 * Tests that a  {@link JobClientActorConnectionTimeoutException}is thrown after a successful registration of the client at the JobManager.
 */
@Test(expected=JobClientActorConnectionTimeoutException.class) public void testConnectionTimeoutAfterJobRegistration() throws Exception {
  FiniteDuration jobClientActorTimeout=new FiniteDuration(1L,TimeUnit.SECONDS);
  FiniteDuration timeout=jobClientActorTimeout.$times(2L);
  UUID leaderSessionID=UUID.randomUUID();
  ActorRef jobManager=system.actorOf(Props.create(JobAcceptingActor.class,leaderSessionID));
  SettableLeaderRetrievalService settableLeaderRetrievalService=new SettableLeaderRetrievalService(jobManager.path().toString(),leaderSessionID);
  Props jobClientActorProps=JobAttachmentClientActor.createActorProps(settableLeaderRetrievalService,jobClientActorTimeout,false);
  ActorRef jobClientActor=system.actorOf(jobClientActorProps);
  Future<Object> jobExecutionResult=Patterns.ask(jobClientActor,new AttachToJobAndWait(testJobGraph.getJobID()),new Timeout(timeout));
  Future<Object> waitFuture=Patterns.ask(jobManager,new RegisterTest(),new Timeout(timeout));
  Await.result(waitFuture,timeout);
  jobManager.tell(PoisonPill.getInstance(),ActorRef.noSender());
  Await.result(jobExecutionResult,timeout);
}
