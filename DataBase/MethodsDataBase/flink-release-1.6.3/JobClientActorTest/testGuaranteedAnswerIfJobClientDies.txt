/** 
 * Tests that JobClient throws an Exception if the JobClientActor dies and can't answer to {@link akka.actor.Identify} message anymore.
 */
@Test public void testGuaranteedAnswerIfJobClientDies() throws Exception {
  FiniteDuration timeout=new FiniteDuration(2L,TimeUnit.SECONDS);
  UUID leaderSessionID=UUID.randomUUID();
  ActorRef jobManager=system.actorOf(Props.create(JobAcceptingActor.class,leaderSessionID));
  SettableLeaderRetrievalService settableLeaderRetrievalService=new SettableLeaderRetrievalService(jobManager.path().toString(),leaderSessionID);
  TestingHighAvailabilityServices highAvailabilityServices=new TestingHighAvailabilityServices();
  highAvailabilityServices.setJobMasterLeaderRetriever(HighAvailabilityServices.DEFAULT_JOB_ID,settableLeaderRetrievalService);
  JobListeningContext jobListeningContext=JobClient.submitJob(system,clientConfig,highAvailabilityServices,testJobGraph,timeout,false,getClass().getClassLoader());
  Future<Object> waitFuture=Patterns.ask(jobManager,new RegisterTest(),new Timeout(timeout));
  Await.result(waitFuture,timeout);
  jobListeningContext.getJobClientActor().tell(PoisonPill.getInstance(),ActorRef.noSender());
  try {
    JobClient.awaitJobResult(jobListeningContext);
    Assert.fail();
  }
 catch (  JobExecutionException e) {
  }
 finally {
    highAvailabilityServices.closeAndCleanupAllData();
  }
}
