@Test public void shouldThrowWhenPopulatingWithNonUniquePoints() throws Exception {
  Config config=Config.defaults(stringMap(default_schema_provider.name(),schemaIndex.providerName()));
  BatchInserter inserter=newBatchInserter(config);
  PointValue point=Values.pointValue(CoordinateReferenceSystem.WGS84,0.0,0.0);
  inserter.createNode(MapUtil.map("prop",point),TestLabels.LABEL_ONE);
  inserter.createNode(MapUtil.map("prop",point),TestLabels.LABEL_ONE);
  inserter.createDeferredConstraint(TestLabels.LABEL_ONE).assertPropertyIsUnique("prop").create();
  inserter.shutdown();
  GraphDatabaseService db=graphDatabaseService(config);
  try (Transaction tx=db.beginTx()){
    Iterator<IndexDefinition> indexes=db.schema().getIndexes().iterator();
    assertTrue(indexes.hasNext());
    IndexDefinition index=indexes.next();
    Schema.IndexState indexState=db.schema().getIndexState(index);
    assertEquals(Schema.IndexState.FAILED,indexState);
    assertFalse(indexes.hasNext());
    tx.success();
  }
  finally {
    db.shutdown();
  }
}
