@Test public void batchInserterShouldUseConfiguredIndexProvider() throws Exception {
  Config config=Config.defaults(stringMap(default_schema_provider.name(),schemaIndex.providerName()));
  BatchInserter inserter=newBatchInserter(config);
  inserter.createDeferredSchemaIndex(TestLabels.LABEL_ONE).on("key").create();
  inserter.shutdown();
  GraphDatabaseService db=graphDatabaseService(config);
  awaitIndexesOnline(db);
  try (Transaction tx=db.beginTx()){
    DependencyResolver dependencyResolver=((GraphDatabaseAPI)db).getDependencyResolver();
    ThreadToStatementContextBridge threadToStatementContextBridge=dependencyResolver.resolveDependency(ThreadToStatementContextBridge.class);
    KernelTransaction kernelTransaction=threadToStatementContextBridge.getKernelTransactionBoundToThisThread(true);
    TokenRead tokenRead=kernelTransaction.tokenRead();
    SchemaRead schemaRead=kernelTransaction.schemaRead();
    int labelId=tokenRead.nodeLabel(TestLabels.LABEL_ONE.name());
    int propertyId=tokenRead.propertyKey("key");
    IndexReference index=schemaRead.index(labelId,propertyId);
    assertTrue(unexpectedIndexProviderMessage(index),schemaIndex.providerName().contains(index.providerKey()));
    assertTrue(unexpectedIndexProviderMessage(index),schemaIndex.providerName().contains(index.providerVersion()));
    tx.success();
  }
  finally {
    db.shutdown();
  }
}
