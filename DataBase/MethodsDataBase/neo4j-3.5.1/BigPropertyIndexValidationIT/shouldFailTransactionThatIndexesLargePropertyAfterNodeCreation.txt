@Test public void shouldFailTransactionThatIndexesLargePropertyAfterNodeCreation(){
  GraphDatabaseService db=dbRule.getGraphDatabaseAPI();
  IndexDefinition index=Neo4jMatchers.createIndex(db,LABEL,propertyKey);
  expectedException.expect(TransactionFailureException.class);
  try (Transaction tx=db.beginTx()){
    db.execute("CREATE (n:" + LABEL + ")");
    try {
      db.execute("match (n:" + LABEL + ")set n.name= \""+ longString+ "\"");
      fail("Argument was illegal");
    }
 catch (    IllegalArgumentException e) {
    }
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    ResourceIterator<Node> nodes=db.getAllNodes().iterator();
    assertFalse(nodes.hasNext());
  }
   db.shutdown();
}
