@Test public void idGeneratorsRebuildAfterRecovery() throws IOException {
  GraphDatabaseService database=startDatabase(directory.databaseDir());
  int numberOfNodes=10;
  try (Transaction transaction=database.beginTx()){
    for (int nodeIndex=0; nodeIndex < numberOfNodes; nodeIndex++) {
      database.createNode();
    }
    transaction.success();
  }
   File restoreDbStoreDir=copyTransactionLogs();
  GraphDatabaseService recoveredDatabase=startDatabase(restoreDbStoreDir);
  try (Transaction tx=recoveredDatabase.beginTx()){
    assertEquals(numberOfNodes,count(recoveredDatabase.getAllNodes()));
    recoveredDatabase.createNode();
  }
   database.shutdown();
  recoveredDatabase.shutdown();
}
