@Test public void shouldFailWhenDuplicateKeyIsSentWithRun() throws Exception {
  connection.connect(address).send(util.defaultAcceptedVersions());
  assertThat(connection,util.eventuallyReceivesSelectedProtocolVersion());
  connection.send(util.chunk(new InitMessage(USER_AGENT,Collections.emptyMap())));
  assertThat(connection,util.eventuallyReceives(msgSuccess()));
  connection.send(util.chunk(64,createMsgWithDuplicateKey(RunMessage.SIGNATURE)));
  assertThat(connection,util.eventuallyReceives(msgFailure(Status.Request.Invalid,"Duplicate map key `key1`.")));
  assertThat(connection,eventuallyDisconnects());
}
