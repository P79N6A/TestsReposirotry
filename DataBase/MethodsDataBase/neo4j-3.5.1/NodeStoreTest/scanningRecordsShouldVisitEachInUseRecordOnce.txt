@Test public void scanningRecordsShouldVisitEachInUseRecordOnce() throws IOException {
  EphemeralFileSystemAbstraction fs=efs.get();
  nodeStore=newNodeStore(fs);
  ThreadLocalRandom rng=ThreadLocalRandom.current();
  final MutableLongSet nextRelSet=new LongHashSet();
  for (int i=0; i < 10_000; i++) {
    int nextRelCandidate=rng.nextInt(0,Integer.MAX_VALUE);
    if (nextRelSet.add(nextRelCandidate)) {
      long nodeId=nodeStore.nextId();
      NodeRecord record=new NodeRecord(nodeId,false,nextRelCandidate,20,true);
      nodeStore.updateRecord(record);
      if (rng.nextInt(0,10) < 3) {
        nextRelSet.remove(nextRelCandidate);
        record.setInUse(false);
        nodeStore.updateRecord(record);
      }
    }
  }
  Visitor<NodeRecord,IOException> scanner=record -> {
    assertTrue(nextRelSet.remove(record.getNextRel()));
    return false;
  }
;
  nodeStore.scanAllRecords(scanner);
  assertTrue(nextRelSet.isEmpty());
}
