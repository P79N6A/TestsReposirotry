@Test void shouldReturnRealSnapshotIfIndexAllowsIt() throws IOException {
  prepareIndex();
  Set<String> files=listDir(dir);
  assertFalse(files.isEmpty());
  try (ResourceIterator<File> snapshot=makeSnapshot()){
    Set<String> snapshotFiles=snapshot.stream().map(File::getName).collect(toSet());
    assertEquals(files,snapshotFiles);
  }
 }
