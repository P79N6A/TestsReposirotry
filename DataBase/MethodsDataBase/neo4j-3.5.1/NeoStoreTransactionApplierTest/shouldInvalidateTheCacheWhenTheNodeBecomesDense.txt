@Test public void shouldInvalidateTheCacheWhenTheNodeBecomesDense() throws Exception {
  final BatchTransactionApplier applier=newApplier(false);
  final NodeRecord before=new NodeRecord(11);
  before.setLabelField(42,singletonList(one));
  before.setInUse(true);
  before.setDense(false);
  final NodeRecord after=new NodeRecord(12);
  after.setInUse(true);
  after.setDense(true);
  after.setLabelField(42,asList(one,two,three));
  final Command.NodeCommand command=new Command.NodeCommand(before,after);
  boolean result=apply(applier,command::handle,transactionToApply);
  assertFalse(result);
  verify(lockService,times(1)).acquireNodeLock(command.getKey(),LockService.LockType.WRITE_LOCK);
  verify(nodeStore,times(1)).updateRecord(after);
}
