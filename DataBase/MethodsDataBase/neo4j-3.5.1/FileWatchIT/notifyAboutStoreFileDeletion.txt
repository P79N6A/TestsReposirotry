@Test(timeout=TEST_TIMEOUT) public void notifyAboutStoreFileDeletion() throws Exception {
  assumeFalse(SystemUtils.IS_OS_WINDOWS);
  String fileName=testDirectory.databaseLayout().metadataStore().getName();
  FileWatcher fileWatcher=getFileWatcher(database);
  CheckPointer checkpointer=getCheckpointer(database);
  DeletionLatchEventListener deletionListener=new DeletionLatchEventListener(fileName);
  fileWatcher.addFileWatchEventListener(deletionListener);
  do {
    createNode(database);
    forceCheckpoint(checkpointer);
  }
 while (!deletionListener.awaitModificationNotification());
  deleteFile(testDirectory.storeDir(),fileName);
  deletionListener.awaitDeletionNotification();
  logProvider.assertContainsMessageContaining("'" + fileName + "' which belongs to the store was deleted while database was running.");
}
