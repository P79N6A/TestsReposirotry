@Test(timeout=TEST_TIMEOUT) public void notifyWhenWholeStoreDirectoryRemoved() throws IOException, InterruptedException {
  assumeFalse(SystemUtils.IS_OS_WINDOWS);
  String fileName=testDirectory.databaseLayout().metadataStore().getName();
  FileWatcher fileWatcher=getFileWatcher(database);
  CheckPointer checkpointer=getCheckpointer(database);
  ModificationEventListener modificationListener=new ModificationEventListener(fileName);
  fileWatcher.addFileWatchEventListener(modificationListener);
  do {
    createNode(database);
    forceCheckpoint(checkpointer);
  }
 while (!modificationListener.awaitModificationNotification());
  fileWatcher.removeFileWatchEventListener(modificationListener);
  String storeDirectoryName=testDirectory.databaseLayout().databaseDirectory().getName();
  DeletionLatchEventListener eventListener=new DeletionLatchEventListener(storeDirectoryName);
  fileWatcher.addFileWatchEventListener(eventListener);
  FileUtils.deleteRecursively(testDirectory.databaseLayout().databaseDirectory());
  eventListener.awaitDeletionNotification();
  logProvider.assertContainsMessageContaining("'" + storeDirectoryName + "' which belongs to the store was deleted while database was running.");
}
