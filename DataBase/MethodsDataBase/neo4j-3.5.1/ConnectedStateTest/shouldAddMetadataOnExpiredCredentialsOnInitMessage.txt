@Test void shouldAddMetadataOnExpiredCredentialsOnInitMessage() throws Exception {
  MutableConnectionState connectionStateMock=mock(MutableConnectionState.class);
  when(context.connectionState()).thenReturn(connectionStateMock);
  AuthenticationResult authResult=mock(AuthenticationResult.class);
  when(authResult.credentialsExpired()).thenReturn(true);
  when(authResult.getLoginContext()).thenReturn(LoginContext.AUTH_DISABLED);
  when(boltSpi.authenticate(AUTH_TOKEN)).thenReturn(authResult);
  BoltStateMachineState newState=state.process(INIT_MESSAGE,context);
  assertEquals(readyState,newState);
  verify(connectionStateMock).onMetadata("credentials_expired",TRUE);
}
