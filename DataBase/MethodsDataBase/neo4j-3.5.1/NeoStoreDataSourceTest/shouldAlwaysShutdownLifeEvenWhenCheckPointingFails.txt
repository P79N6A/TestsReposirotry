@Test public void shouldAlwaysShutdownLifeEvenWhenCheckPointingFails() throws Exception {
  FileSystemAbstraction fs=this.fs.get();
  PageCache pageCache=pageCacheRule.getPageCache(fs);
  DatabaseHealth databaseHealth=mock(DatabaseHealth.class);
  when(databaseHealth.isHealthy()).thenReturn(true);
  IOException ex=new IOException("boom!");
  doThrow(ex).when(databaseHealth).assertHealthy(IOException.class);
  Dependencies dependencies=new Dependencies();
  dependencies.satisfyDependencies(databaseHealth);
  NeoStoreDataSource dataSource=dsRule.getDataSource(dir.databaseLayout(),fs,pageCache,dependencies);
  dataSource.start();
  try {
    dataSource.stop();
    fail("it should have thrown");
  }
 catch (  LifecycleException e) {
    assertEquals(ex,e.getCause());
  }
}
