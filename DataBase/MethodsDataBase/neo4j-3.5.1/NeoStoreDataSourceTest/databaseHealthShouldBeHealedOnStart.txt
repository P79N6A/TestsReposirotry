@Test public void databaseHealthShouldBeHealedOnStart() throws Throwable {
  NeoStoreDataSource theDataSource=null;
  try {
    DatabaseHealth databaseHealth=new DatabaseHealth(mock(DatabasePanicEventGenerator.class),NullLogProvider.getInstance().getLog(DatabaseHealth.class));
    Dependencies dependencies=new Dependencies();
    dependencies.satisfyDependency(databaseHealth);
    theDataSource=dsRule.getDataSource(dir.databaseLayout(),fs.get(),pageCacheRule.getPageCache(fs.get()),dependencies);
    databaseHealth.panic(new Throwable());
    theDataSource.start();
    databaseHealth.assertHealthy(Throwable.class);
  }
  finally {
    if (theDataSource != null) {
      theDataSource.stop();
      theDataSource.shutdown();
    }
  }
}
