@Test public void flushOfThePageCacheOnShutdownDoesNotHappenIfTheDbIsUnhealthy() throws Throwable {
  DatabaseHealth health=mock(DatabaseHealth.class);
  when(health.isHealthy()).thenReturn(false);
  PageCache pageCache=spy(pageCacheRule.getPageCache(fs.get()));
  Dependencies dependencies=new Dependencies();
  dependencies.satisfyDependency(health);
  NeoStoreDataSource ds=dsRule.getDataSource(dir.databaseLayout(),fs.get(),pageCache,dependencies);
  ds.start();
  verify(pageCache,never()).flushAndForce();
  ds.stop();
  ds.shutdown();
  verify(pageCache,never()).flushAndForce(IOLimiter.UNLIMITED);
}
