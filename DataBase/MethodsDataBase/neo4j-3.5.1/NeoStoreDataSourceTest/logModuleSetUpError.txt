@Test public void logModuleSetUpError(){
  Config config=Config.defaults();
  IdGeneratorFactory idGeneratorFactory=mock(IdGeneratorFactory.class);
  Throwable openStoresError=new RuntimeException("Can't set up modules");
  doThrow(openStoresError).when(idGeneratorFactory).create(any(File.class),anyLong(),anyBoolean());
  CommunityIdTypeConfigurationProvider idTypeConfigurationProvider=new CommunityIdTypeConfigurationProvider();
  AssertableLogProvider logProvider=new AssertableLogProvider();
  SimpleLogService logService=new SimpleLogService(logProvider,logProvider);
  PageCache pageCache=pageCacheRule.getPageCache(fs.get());
  Dependencies dependencies=new Dependencies();
  dependencies.satisfyDependencies(idGeneratorFactory,idTypeConfigurationProvider,config,logService);
  NeoStoreDataSource dataSource=dsRule.getDataSource(dir.databaseLayout(),fs.get(),pageCache,dependencies);
  try {
    dataSource.start();
    fail("Exception expected");
  }
 catch (  Exception e) {
    assertEquals(openStoresError,e);
  }
  logProvider.assertAtLeastOnce(inLog(NeoStoreDataSource.class).warn(equalTo("Exception occurred while setting up store modules. Attempting to close things down."),equalTo(openStoresError)));
}
