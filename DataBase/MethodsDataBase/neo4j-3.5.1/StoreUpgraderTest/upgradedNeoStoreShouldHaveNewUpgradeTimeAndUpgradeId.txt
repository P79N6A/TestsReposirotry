@Test public void upgradedNeoStoreShouldHaveNewUpgradeTimeAndUpgradeId() throws Exception {
  fileSystem.deleteFile(databaseLayout.file(INTERNAL_LOG_FILE));
  PageCache pageCache=pageCacheRule.getPageCache(fileSystem);
  UpgradableDatabase upgradableDatabase=getUpgradableDatabase(pageCache);
  newUpgrader(upgradableDatabase,allowMigrateConfig,pageCache).migrateIfNeeded(databaseLayout);
  StoreFactory factory=new StoreFactory(databaseLayout,allowMigrateConfig,new DefaultIdGeneratorFactory(fileSystem),pageCache,fileSystem,NullLogProvider.getInstance(),EmptyVersionContextSupplier.EMPTY);
  try (NeoStores neoStores=factory.openAllNeoStores()){
    assertThat(neoStores.getMetaDataStore().getUpgradeTransaction(),equalTo(neoStores.getMetaDataStore().getLastCommittedTransaction()));
    assertThat(neoStores.getMetaDataStore().getUpgradeTime(),not(equalTo(MetaDataStore.FIELD_NOT_INITIALIZED)));
    long minuteAgo=System.currentTimeMillis() - MINUTES.toMillis(1);
    assertThat(neoStores.getMetaDataStore().getUpgradeTime(),greaterThan(minuteAgo));
  }
 }
