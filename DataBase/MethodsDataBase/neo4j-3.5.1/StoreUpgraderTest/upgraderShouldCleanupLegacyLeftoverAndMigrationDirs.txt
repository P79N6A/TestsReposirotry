@Test public void upgraderShouldCleanupLegacyLeftoverAndMigrationDirs() throws Exception {
  fileSystem.deleteFile(databaseLayout.file(INTERNAL_LOG_FILE));
  fileSystem.mkdir(databaseLayout.file(StoreUpgrader.MIGRATION_DIRECTORY));
  fileSystem.mkdir(databaseLayout.file(StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY));
  fileSystem.mkdir(databaseLayout.file(StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_1"));
  fileSystem.mkdir(databaseLayout.file(StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_2"));
  fileSystem.mkdir(databaseLayout.file(StoreUpgrader.MIGRATION_LEFT_OVERS_DIRECTORY + "_42"));
  PageCache pageCache=pageCacheRule.getPageCache(fileSystem);
  UpgradableDatabase upgradableDatabase=getUpgradableDatabase(pageCache);
  StoreUpgrader storeUpgrader=newUpgrader(upgradableDatabase,pageCache);
  storeUpgrader.migrateIfNeeded(databaseLayout);
  assertThat(migrationHelperDirs(),is(emptyCollectionOf(File.class)));
}
