@Test public void shouldRollbackRelationshipOnFailure() throws Exception {
  long n1, n2;
  try (org.neo4j.graphdb.Transaction tx=graphDb.beginTx()){
    n1=graphDb.createNode().getId();
    n2=graphDb.createNode().getId();
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    int label=tx.token().relationshipTypeGetOrCreateForName("R");
    tx.dataWrite().relationshipCreate(n1,label,n2);
    tx.failure();
  }
   try (org.neo4j.graphdb.Transaction ignore=graphDb.beginTx()){
    assertEquals(0,graphDb.getNodeById(n1).getDegree());
  }
 }
