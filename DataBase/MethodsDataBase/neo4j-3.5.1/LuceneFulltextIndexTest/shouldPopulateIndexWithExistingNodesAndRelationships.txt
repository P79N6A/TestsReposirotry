@Test public void shouldPopulateIndexWithExistingNodesAndRelationships() throws Exception {
  long firstNodeID;
  long secondNodeID;
  long firstRelID;
  long secondRelID;
  try (Transaction tx=db.beginTx()){
    Node node=db.createNode();
    node.createRelationshipTo(node,RELTYPE);
    node.createRelationshipTo(node,RELTYPE);
    node.createRelationshipTo(node,RELTYPE);
    firstNodeID=createNodeIndexableByPropertyValue(LABEL,"Hello. Hello again.");
    secondNodeID=createNodeIndexableByPropertyValue(LABEL,"This string is slightly shorter than the zebra one");
    firstRelID=createRelationshipIndexableByPropertyValue(firstNodeID,secondNodeID,"Goodbye");
    secondRelID=createRelationshipIndexableByPropertyValue(secondNodeID,firstNodeID,"And now, something completely different");
    tx.success();
  }
   SchemaDescriptor nodes=fulltextAdapter.schemaFor(NODE,new String[]{LABEL.name()},settings,PROP);
  SchemaDescriptor rels=fulltextAdapter.schemaFor(RELATIONSHIP,new String[]{RELTYPE.name()},settings,PROP);
  IndexReference nodesIndex;
  IndexReference relsIndex;
  try (KernelTransactionImplementation tx=getKernelTransaction()){
    nodesIndex=tx.schemaWrite().indexCreate(nodes,FulltextIndexProviderFactory.DESCRIPTOR.name(),Optional.of(NODE_INDEX_NAME));
    relsIndex=tx.schemaWrite().indexCreate(rels,FulltextIndexProviderFactory.DESCRIPTOR.name(),Optional.of(REL_INDEX_NAME));
    tx.success();
  }
   await(nodesIndex);
  await(relsIndex);
  try (Transaction tx=db.beginTx()){
    KernelTransaction ktx=kernelTransaction(tx);
    assertQueryFindsIds(ktx,NODE_INDEX_NAME,"hello",firstNodeID);
    assertQueryFindsIds(ktx,NODE_INDEX_NAME,"string",secondNodeID);
    assertQueryFindsNothing(ktx,NODE_INDEX_NAME,"goodbye");
    assertQueryFindsNothing(ktx,NODE_INDEX_NAME,"different");
    assertQueryFindsNothing(ktx,REL_INDEX_NAME,"hello");
    assertQueryFindsNothing(ktx,REL_INDEX_NAME,"string");
    assertQueryFindsIds(ktx,REL_INDEX_NAME,"goodbye",firstRelID);
    assertQueryFindsIds(ktx,REL_INDEX_NAME,"different",secondRelID);
  }
 }
