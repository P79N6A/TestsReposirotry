@Test public void testFailOnNestedTransactions() throws Throwable {
  BoltStateMachine machine=init(newMachine());
  machine.process(new RunMessage("BEGIN",EMPTY_PARAMS),nullResponseHandler());
  machine.process(DiscardAllMessage.INSTANCE,nullResponseHandler());
  machine.process(new RunMessage("BEGIN",EMPTY_PARAMS),nullResponseHandler());
  machine.process(DiscardAllMessage.INSTANCE,nullResponseHandler());
  assertThat(machine,inState(FailedState.class));
}
