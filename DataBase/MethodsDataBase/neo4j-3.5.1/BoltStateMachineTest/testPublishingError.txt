@Test public void testPublishingError() throws Throwable {
  BoltStateMachine machine=init(newMachine());
  machine.process(new RunMessage("RETURN 1",EMPTY_PARAMS),nullResponseHandler());
  BoltResponseRecorder recorder=new BoltResponseRecorder(){
    @Override public void onRecords(    BoltResult result,    boolean pull){
      throw new RuntimeException("I've been expecting you, Mr Bond.");
    }
  }
;
  machine.process(PullAllMessage.INSTANCE,recorder);
  assertThat(recorder.nextResponse(),failedWithStatus(Status.General.UnknownError));
  assertThat(machine,inState(FailedState.class));
}
