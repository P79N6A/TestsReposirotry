@SuppressWarnings("unchecked") @Test public void shouldTerminateOnAuthExpiryDuringSTREAMINGDiscardAll() throws Throwable {
  BoltResponseHandler responseHandler=mock(BoltResponseHandler.class);
  doThrow(new AuthorizationExpiredException("Auth expired!")).when(responseHandler).onRecords(any(),anyBoolean());
  BoltStateMachine machine=init(newMachine());
  machine.process(new RunMessage("RETURN 1",EMPTY_PARAMS),nullResponseHandler());
  txStateMachine(machine).ctx.currentResult=BoltResult.EMPTY;
  try {
    machine.process(DiscardAllMessage.INSTANCE,responseHandler);
    fail("Exception expected");
  }
 catch (  BoltConnectionAuthFatality e) {
    assertEquals("Auth expired!",e.getCause().getMessage());
  }
}
