@Test public void shouldNotFailWhenMarkedForTerminationAndPullAll() throws Exception {
  BoltStateMachineV1SPI spi=mock(BoltStateMachineV1SPI.class,RETURNS_MOCKS);
  BoltStateMachine machine=init(newMachine(spi));
  machine.process(new RunMessage("RETURN 42",EMPTY_PARAMS),nullResponseHandler());
  txStateMachine(machine).ctx.currentResult=BoltResult.EMPTY;
  BoltResponseHandler responseHandler=mock(BoltResponseHandler.class);
  machine.markForTermination();
  machine.process(PullAllMessage.INSTANCE,responseHandler);
  verify(spi,never()).reportError(any());
  assertThat(machine,not(inState(FailedState.class)));
}
