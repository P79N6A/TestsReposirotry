@Test public void shouldInvokeResponseHandlerOnMarkFailedIfThereIsHandler() throws Exception {
  BoltStateMachine machine=init(newMachine());
  Neo4jError error=Neo4jError.from(Status.Request.NoThreadsAvailable,"no threads");
  BoltResponseHandler responseHandler=mock(BoltResponseHandler.class);
  ((BoltStateMachineV1)machine).connectionState().setResponseHandler(responseHandler);
  machine.markFailed(error);
  assertNull(pendingError(machine));
  assertFalse(pendingIgnore(machine));
  assertThat(machine,inState(FailedState.class));
  verify(responseHandler).markFailed(error);
}
