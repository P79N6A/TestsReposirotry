@Test public void shouldReturnValueIfSufficientBytesAreBufferedEvenIfEOFHasBeenEncountered() throws Exception {
  FileSystemAbstraction fileSystem=fileSystemRule.get();
  StoreChannel storeChannel=fileSystem.open(new File("foo.txt"),OpenMode.READ_WRITE);
  ByteBuffer buffer=ByteBuffer.allocate(1);
  buffer.put((byte)1);
  buffer.flip();
  storeChannel.writeAll(buffer);
  storeChannel.force(false);
  storeChannel.close();
  storeChannel=fileSystem.open(new File("foo.txt"),OpenMode.READ);
  ReadAheadChannel<StoreChannel> channel=new ReadAheadChannel<>(storeChannel);
  try {
    channel.getShort();
    fail("Should have thrown exception signalling end of file reached");
  }
 catch (  ReadPastEndException endOfFile) {
  }
  assertEquals((byte)1,channel.get());
  try {
    channel.get();
    fail("Should have thrown exception signalling end of file reached");
  }
 catch (  ReadPastEndException endOfFile) {
  }
}
