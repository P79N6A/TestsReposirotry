@Test public void processNextBatchShouldDrainMaxBatchSizeItemsOnEachCall(){
  List<Job> drainedJobs=new ArrayList<>();
  List<Job> pushedJobs=new ArrayList<>();
  BoltConnection connection=newConnection(10);
  doAnswer(inv -> drainedJobs.addAll(inv.getArgument(1))).when(queueMonitor).drained(same(connection),anyCollection());
  for (int i=0; i < 15; i++) {
    Job newJob=Jobs.noop();
    pushedJobs.add(newJob);
    connection.enqueue(newJob);
  }
  connection.processNextBatch();
  verify(queueMonitor).drained(same(connection),anyCollection());
  assertEquals(10,drainedJobs.size());
  assertTrue(drainedJobs.containsAll(pushedJobs.subList(0,10)));
  drainedJobs.clear();
  connection.processNextBatch();
  verify(queueMonitor,times(2)).drained(same(connection),anyCollection());
  assertEquals(5,drainedJobs.size());
  assertTrue(drainedJobs.containsAll(pushedJobs.subList(10,15)));
}
