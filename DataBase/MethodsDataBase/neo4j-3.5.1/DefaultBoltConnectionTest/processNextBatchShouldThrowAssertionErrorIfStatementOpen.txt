@Test public void processNextBatchShouldThrowAssertionErrorIfStatementOpen() throws Exception {
  BoltConnection connection=newConnection(1);
  connection.enqueue(Jobs.noop());
  connection.enqueue(Jobs.noop());
  when(stateMachine.hasOpenStatement()).thenReturn(true);
  connection.processNextBatch();
  logProvider.assertExactly(AssertableLogProvider.inLog(DefaultBoltConnection.class.getName()).error(startsWith("Unexpected error"),isA(AssertionError.class)));
}
