@Test public void processNextBatchShouldCloseConnectionAndLogOnFatalBoltError(){
  BoltConnectionFatality exception=new BoltProtocolBreachFatality("fatal bolt error");
  BoltConnection connection=newConnection();
  connection.enqueue(machine -> {
    throw exception;
  }
);
  connection.processNextBatch();
  verify(stateMachine).close();
  logProvider.assertExactly(AssertableLogProvider.inLog(containsString(BoltServer.class.getPackage().getName())).error(containsString("Protocol breach detected in bolt session"),is(exception)));
}
