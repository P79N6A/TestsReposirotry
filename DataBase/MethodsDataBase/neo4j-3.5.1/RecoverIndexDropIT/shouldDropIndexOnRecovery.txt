@Test public void shouldDropIndexOnRecovery() throws IOException {
  CommittedTransactionRepresentation dropTransaction=prepareDropTransaction();
  File storeDir=directory.databaseDir();
  GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  createIndex(db);
  db.shutdown();
  appendDropTransactionToTransactionLog(directory.databaseDir(),dropTransaction);
  Monitors monitors=new Monitors();
  AssertRecoveryIsPerformed recoveryMonitor=new AssertRecoveryIsPerformed();
  monitors.addMonitorListener(recoveryMonitor);
  db=new TestGraphDatabaseFactory().setMonitors(monitors).newEmbeddedDatabase(storeDir);
  try {
    assertTrue(recoveryMonitor.recoveryWasPerformed);
    try (Transaction tx=db.beginTx()){
      assertEquals(0,count(db.schema().getIndexes()));
      tx.success();
    }
   }
  finally {
    db.shutdown();
  }
}
