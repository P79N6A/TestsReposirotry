@Test public void detachDeleteNodeExclusivelyLockNodes() throws KernelException {
  long nodeId=1L;
  returnRelationships(transaction,false,new TestRelationshipChain(nodeId).outgoing(1,2L,42));
  when(transaction.ambientNodeCursor()).thenReturn(new StubNodeCursor(false));
  LabelSet labels=mock(LabelSet.class);
  when(labels.all()).thenReturn(EMPTY_LONG_ARRAY);
  when(nodeCursor.labels()).thenReturn(labels);
  when(nodeCursor.next()).thenReturn(true);
  operations.nodeDetachDelete(nodeId);
  order.verify(locks).acquireExclusive(LockTracer.NONE,ResourceTypes.NODE,nodeId,2L);
  order.verify(locks,never()).releaseExclusive(ResourceTypes.NODE,nodeId);
  order.verify(locks,never()).releaseExclusive(ResourceTypes.NODE,2L);
  order.verify(txState).nodeDoDelete(nodeId);
}
