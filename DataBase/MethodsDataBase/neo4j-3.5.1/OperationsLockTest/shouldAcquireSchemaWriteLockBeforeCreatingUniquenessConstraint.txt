@Test public void shouldAcquireSchemaWriteLockBeforeCreatingUniquenessConstraint() throws Exception {
  String defaultProvider=Config.defaults().get(default_schema_provider);
  when(constraintIndexCreator.createUniquenessConstraintIndex(transaction,descriptor,defaultProvider)).thenReturn(42L);
  when(storageReader.constraintsGetForSchema(descriptor.schema())).thenReturn(Collections.emptyIterator());
  operations.uniquePropertyConstraintCreate(descriptor);
  order.verify(locks).acquireExclusive(LockTracer.NONE,ResourceTypes.LABEL,descriptor.getLabelId());
  order.verify(txState).constraintDoAdd(ConstraintDescriptorFactory.uniqueForSchema(descriptor),42L);
}
