@Test public void shouldCloseTransactionEvenIfCommitFails() throws Exception {
  BoltStateMachine machine=env.newMachine(BOLT_CHANNEL);
  machine.process(new InitMessage(USER_AGENT,emptyMap()),nullResponseHandler());
  runAndPull(machine,"BEGIN");
  runAndPull(machine,"X",map(),IGNORED);
  machine.process(AckFailureMessage.INSTANCE,nullResponseHandler());
  runAndPull(machine,"COMMIT",map(),IGNORED);
  machine.process(AckFailureMessage.INSTANCE,nullResponseHandler());
  assertFalse(hasTransaction(machine));
}
