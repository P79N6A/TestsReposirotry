@Test public void shouldBeAbleToCleanlyRunMultipleSessionsInSingleThread() throws Throwable {
  BoltStateMachine firstMachine=env.newMachine(BOLT_CHANNEL);
  firstMachine.process(new InitMessage(USER_AGENT,emptyMap()),null);
  BoltStateMachine secondMachine=env.newMachine(BOLT_CHANNEL);
  secondMachine.process(new InitMessage(USER_AGENT,emptyMap()),null);
  runAndPull(firstMachine,"BEGIN");
  Object[] stream=runAndPull(secondMachine,"CREATE (a:Person) RETURN id(a)");
  long id=((LongValue)((Record)stream[0]).fields()[0]).value();
  runAndPull(firstMachine,"ROLLBACK");
  stream=runAndPull(secondMachine,"MATCH (a:Person) WHERE id(a) = " + id + " RETURN COUNT(*)");
  assertThat(((Record)stream[0]).fields()[0],equalTo(longValue(1L)));
}
