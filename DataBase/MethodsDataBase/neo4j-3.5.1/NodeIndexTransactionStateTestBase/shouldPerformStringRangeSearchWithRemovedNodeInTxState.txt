@Test public void shouldPerformStringRangeSearchWithRemovedNodeInTxState() throws Exception {
  Set<Pair<Long,Value>> expected=new HashSet<>();
  long nodeToChange;
  try (Transaction tx=beginTransaction()){
    nodeToChange=nodeWithPropId(tx,"banana");
    nodeWithPropId(tx,"apple");
    tx.success();
  }
   createIndex();
  try (Transaction tx=beginTransaction()){
    int label=tx.tokenRead().nodeLabel("Node");
    int prop=tx.tokenRead().propertyKey("prop");
    expected.add(nodeWithProp(tx,"cherry"));
    nodeWithProp(tx,"dragonfruit");
    IndexReference index=tx.schemaRead().index(label,prop);
    TextValue newProperty=stringValue("kiwi");
    tx.dataWrite().nodeSetProperty(nodeToChange,prop,newProperty);
    assertNodeAndValueForSeek(expected,tx,index,needsValues,"berry",IndexQuery.range(prop,"b",true,"d",false));
  }
 }
