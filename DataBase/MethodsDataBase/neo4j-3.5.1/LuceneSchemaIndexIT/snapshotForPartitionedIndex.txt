@Test void snapshotForPartitionedIndex() throws Exception {
  try (LuceneIndexAccessor indexAccessor=createDefaultIndexAccessor()){
    generateUpdates(indexAccessor,32);
    indexAccessor.force(IOLimiter.UNLIMITED);
    List<String> singlePartitionFileTemplates=Arrays.asList(".cfe",".cfs",".si","segments_1");
    try (ResourceIterator<File> snapshotIterator=indexAccessor.snapshotFiles()){
      List<String> indexFileNames=asFileInsidePartitionNames(snapshotIterator);
      assertTrue(indexFileNames.size() >= (singlePartitionFileTemplates.size() * 4),"Expect files from 4 partitions");
      Map<String,Integer> templateMatches=countTemplateMatches(singlePartitionFileTemplates,indexFileNames);
      for (      String fileTemplate : singlePartitionFileTemplates) {
        Integer matches=templateMatches.get(fileTemplate);
        assertTrue(matches >= 4,"Expect to see at least 4 matches for template: " + fileTemplate);
      }
    }
   }
 }
