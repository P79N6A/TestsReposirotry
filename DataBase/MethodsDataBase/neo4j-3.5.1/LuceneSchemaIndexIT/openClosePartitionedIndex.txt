@Test void openClosePartitionedIndex() throws IOException {
  SchemaIndex reopenIndex=null;
  try {
    reopenIndex=LuceneSchemaIndexBuilder.create(descriptor,config).withFileSystem(fileSystem).withIndexRootFolder(new File(testDir.directory("reopenIndexFolder"),"reopenIndex")).build();
    reopenIndex.open();
    addDocumentToIndex(reopenIndex,1);
    reopenIndex.close();
    assertFalse(reopenIndex.isOpen());
    reopenIndex.open();
    assertTrue(reopenIndex.isOpen());
    addDocumentToIndex(reopenIndex,10);
    reopenIndex.close();
    assertFalse(reopenIndex.isOpen());
    reopenIndex.open();
    assertTrue(reopenIndex.isOpen());
    reopenIndex.close();
    reopenIndex.open();
    addDocumentToIndex(reopenIndex,100);
    reopenIndex.maybeRefreshBlocking();
    try (LuceneAllDocumentsReader allDocumentsReader=reopenIndex.allDocumentsReader()){
      assertEquals(111,allDocumentsReader.maxCount(),"All documents should be visible");
    }
   }
  finally {
    if (reopenIndex != null) {
      reopenIndex.close();
    }
  }
}
