@Test public void mustFlushStoresWithGivenIOLimiter(){
  IOLimiter limiter=IOLimiter.UNLIMITED;
  FileSystemAbstraction fs=fsRule.get();
  AtomicReference<IOLimiter> observedLimiter=new AtomicReference<>();
  PageCache pageCache=new DelegatingPageCache(pageCacheRule.getPageCache(fs)){
    @Override public void flushAndForce(    IOLimiter limiter) throws IOException {
      super.flushAndForce(limiter);
      observedLimiter.set(limiter);
    }
  }
;
  RecordStorageEngine engine=storageEngineRule.getWith(fs,pageCache,testDirectory.databaseLayout()).build();
  engine.flushAndForce(limiter);
  assertThat(observedLimiter.get(),sameInstance(limiter));
}
