@Test public void shouldRepopulatePreexistingIndexed() throws Throwable {
  long jakewins=dbWithIndexAndSingleIndexedNode();
  IndexPopulator populator=mock(IndexPopulator.class);
  IndexProvider provider=mock(IndexProvider.class);
  IndexAccessor accessor=mock(IndexAccessor.class);
  when(provider.getProviderDescriptor()).thenReturn(DESCRIPTOR);
  when(provider.getPopulator(any(StoreIndexDescriptor.class),any(IndexSamplingConfig.class))).thenReturn(populator);
  when(populator.sampleResult()).thenReturn(new IndexSample());
  when(provider.getOnlineAccessor(any(StoreIndexDescriptor.class),any(IndexSamplingConfig.class))).thenReturn(accessor);
  BatchInserter inserter=newBatchInserterWithIndexProvider(singleInstanceIndexProviderFactory(KEY,provider),provider.getProviderDescriptor());
  long boggle=inserter.createNode(map("handle","b0ggl3"),label("Hacker"));
  inserter.shutdown();
  verify(provider).init();
  verify(provider).start();
  verify(provider).getPopulator(any(StoreIndexDescriptor.class),any(IndexSamplingConfig.class));
  verify(populator).create();
  verify(populator).add(argThat(matchesCollection(add(jakewins,internalIndex.schema(),Values.of("Jakewins")),add(boggle,internalIndex.schema(),Values.of("b0ggl3")))));
  verify(populator).verifyDeferredConstraints(any(NodePropertyAccessor.class));
  verify(populator).close(true);
  verify(provider).stop();
  verify(provider).shutdown();
}
