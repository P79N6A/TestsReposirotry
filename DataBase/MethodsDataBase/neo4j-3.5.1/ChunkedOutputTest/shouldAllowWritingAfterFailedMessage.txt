@Test public void shouldAllowWritingAfterFailedMessage() throws Exception {
  out.beginMessage();
  out.writeInt(1);
  out.writeInt(2);
  out.messageSucceeded();
  out.beginMessage();
  out.writeByte((byte)3);
  out.writeByte((byte)4);
  out.messageFailed();
  out.beginMessage();
  out.writeInt(33);
  out.writeLong(44);
  out.messageSucceeded();
  out.flush();
  ByteBuf outboundMessage=peekSingleOutboundMessage();
  assertByteBufEqual(outboundMessage,chunkContaining(1,2) + messageBoundary() + chunkContaining(33,(long)44)+ messageBoundary());
}
