@Test public void shouldNotThrowIfOutOfSyncFlush() throws Throwable {
  out.beginMessage();
  out.writeLong(1);
  out.writeLong(2);
  out.writeLong(3);
  out.messageSucceeded();
  out.flush();
  out.close();
  out.flush();
  ByteBuf outboundMessage=peekSingleOutboundMessage();
  assertByteBufEqual(outboundMessage,chunkContaining((long)1) + chunkContaining((long)2) + chunkContaining((long)3)+ messageBoundary());
}
