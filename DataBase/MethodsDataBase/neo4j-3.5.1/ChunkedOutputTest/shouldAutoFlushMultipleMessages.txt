@Test public void shouldAutoFlushMultipleMessages() throws Exception {
  out.beginMessage();
  out.writeLong(1);
  out.writeLong(2);
  out.messageSucceeded();
  out.beginMessage();
  out.writeLong(3);
  out.writeLong(4);
  out.messageSucceeded();
  out.beginMessage();
  out.writeLong(5);
  out.writeLong(6);
  out.messageSucceeded();
  List<ByteBuf> outboundMessages=peekAllOutboundMessages();
  assertEquals(3,outboundMessages.size());
  assertByteBufEqual(outboundMessages.get(0),chunkContaining((long)1) + chunkContaining((long)2) + messageBoundary());
  assertByteBufEqual(outboundMessages.get(1),chunkContaining((long)3) + chunkContaining((long)4) + messageBoundary());
  assertByteBufEqual(outboundMessages.get(2),chunkContaining((long)5) + chunkContaining((long)6) + messageBoundary());
}
