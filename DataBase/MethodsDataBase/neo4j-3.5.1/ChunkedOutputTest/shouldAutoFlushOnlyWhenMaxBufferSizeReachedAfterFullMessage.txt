@Test public void shouldAutoFlushOnlyWhenMaxBufferSizeReachedAfterFullMessage() throws Exception {
  out.beginMessage();
  out.writeInt(1);
  out.writeInt(2);
  out.writeInt(3);
  out.writeLong(4);
  assertEquals(0,peekAllOutboundMessages().size());
  out.writeByte((byte)5);
  out.writeByte((byte)6);
  out.writeLong(7);
  out.writeInt(8);
  out.writeByte((byte)9);
  assertEquals(0,peekAllOutboundMessages().size());
  out.messageSucceeded();
  ByteBuf outboundMessage=peekSingleOutboundMessage();
  assertByteBufEqual(outboundMessage,chunkContaining(1,2,3) + chunkContaining((long)4,(byte)5,(byte)6) + chunkContaining((long)7,8,(byte)9)+ messageBoundary());
}
