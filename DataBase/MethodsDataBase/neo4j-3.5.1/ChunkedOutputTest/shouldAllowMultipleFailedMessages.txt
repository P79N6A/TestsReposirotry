@Test public void shouldAllowMultipleFailedMessages() throws Exception {
  for (int i=0; i < 7; i++) {
    out.beginMessage();
    out.writeByte((byte)i);
    out.writeShort((short)i);
    out.writeInt(i);
    out.messageFailed();
  }
  out.flush();
  assertEquals(0,peekAllOutboundMessages().size());
  out.beginMessage();
  out.writeByte((byte)8);
  out.writeShort((short)9);
  out.writeInt(10);
  out.writeDouble(199.92);
  out.messageSucceeded();
  assertByteBufEqual(peekSingleOutboundMessage(),chunkContaining((byte)8,(short)9,10) + chunkContaining(199.92) + messageBoundary());
}
