@Test public void shouldFailToMarkMessageAsSuccessfulAndThenAsFailed() throws Exception {
  out.beginMessage();
  out.writeInt(42);
  out.messageSucceeded();
  try {
    out.messageFailed();
    fail("Exception expected");
  }
 catch (  IllegalStateException ignore) {
  }
  out.flush();
  assertByteBufEqual(peekSingleOutboundMessage(),chunkContaining(42) + messageBoundary());
}
