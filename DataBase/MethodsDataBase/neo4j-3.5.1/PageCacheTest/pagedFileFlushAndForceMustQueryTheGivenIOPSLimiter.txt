@Test void pagedFileFlushAndForceMustQueryTheGivenIOPSLimiter() throws Exception {
  int pagesToDirty=10_000;
  PageCache cache=getPageCache(fs,nextPowerOf2(pagesToDirty),PageCacheTracer.NULL,PageCursorTracerSupplier.NULL);
  PagedFile pf=cache.map(file("a"),filePageSize);
  dirtyManyPages(pf,pagesToDirty);
  AtomicInteger callbackCounter=new AtomicInteger();
  AtomicInteger ioCounter=new AtomicInteger();
  pf.flushAndForce((previousStamp,recentlyCompletedIOs,swapper) -> {
    ioCounter.addAndGet(recentlyCompletedIOs);
    return callbackCounter.getAndIncrement();
  }
);
  pf.close();
  assertThat(callbackCounter.get(),greaterThan(0));
  assertThat(ioCounter.get(),greaterThanOrEqualTo(pagesToDirty - 30));
}
