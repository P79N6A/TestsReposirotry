@Test void mustFlushAllDirtyPagesWhenClosingPagedFileThatIsNotMappedWithDeleteOnClose() throws Exception {
  AtomicInteger flushCounter=new AtomicInteger();
  PageSwapperFactory swapperFactory=flushCountingPageSwapperFactory(flushCounter);
  swapperFactory.open(fs,Configuration.EMPTY);
  File file=file("a");
  try (PageCache cache=createPageCache(swapperFactory,maxPages,PageCacheTracer.NULL,PageCursorTracerSupplier.NULL,EmptyVersionContextSupplier.EMPTY);PagedFile pf=cache.map(file,filePageSize);PageCursor cursor=pf.io(0,PF_SHARED_WRITE_LOCK)){
    writeRecords(cursor);
    assertTrue(cursor.next());
  }
   assertThat(flushCounter.get(),is(1));
}
