@Test public void testDeletingNodeRemovesItFromAutoIndex(){
  newTransaction();
  AutoIndexer<Node> nodeAutoIndexer=graphDb.index().getNodeAutoIndexer();
  nodeAutoIndexer.startAutoIndexingProperty("foo");
  nodeAutoIndexer.setEnabled(true);
  Node node1=graphDb.createNode();
  node1.setProperty("foo","bar");
  newTransaction();
  try (IndexHits<Node> nodeIndexHits=graphDb.index().forNodes("node_auto_index").query("_id_:*")){
    assertThat(nodeIndexHits.size(),equalTo(1));
  }
   node1.delete();
  newTransaction();
  try (IndexHits<Node> nodeIndexHits=graphDb.index().forNodes("node_auto_index").query("_id_:*")){
    assertThat(nodeIndexHits.size(),equalTo(0));
  }
 }
