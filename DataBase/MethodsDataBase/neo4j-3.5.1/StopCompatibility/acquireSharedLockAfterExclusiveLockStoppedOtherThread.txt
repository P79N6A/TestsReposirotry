@Test public void acquireSharedLockAfterExclusiveLockStoppedOtherThread() throws Exception {
  AcquiredLock thisThreadsExclusiveLock=acquireExclusiveLockInThisThread();
  LockAcquisition exclusiveLockAcquisition=acquireExclusiveLockInAnotherThread();
  assertThreadIsWaitingForLock(exclusiveLockAcquisition);
  exclusiveLockAcquisition.stop();
  assertLockAcquisitionFailed(exclusiveLockAcquisition);
  thisThreadsExclusiveLock.release();
  LockAcquisition sharedLockAcquisition=acquireSharedLockInAnotherThread();
  assertLockAcquisitionSucceeded(sharedLockAcquisition);
}
