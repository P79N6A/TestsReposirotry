@Test public void shouldReadCorrectResultsFromMultipleNestedReadersWhenConcurrentWriteHappens() throws Exception {
  createIndex();
  try (Transaction tx=db.beginTx()){
    for (int id=0; id < IDS; id++) {
      for (int i=0; i < NODE_PER_ID; i++) {
        db.createNode(LABEL).setProperty(KEY,id);
      }
    }
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    List<ResourceIterator<Node>> iterators=new ArrayList<>();
    for (int id=0; id < IDS; id++) {
      iterators.add(db.findNodes(LABEL,KEY,id));
    }
    for (int i=0; i < NODE_PER_ID; i++) {
      assertRoundOfNodes(iterators);
      if (i % 2 == 1) {
        t2.execute(nodeCreator()).get();
      }
    }
    assertRoundOfNodes(iterators);
    for (    ResourceIterator<Node> reader : iterators) {
      assertFalse(reader.hasNext());
      reader.close();
    }
    tx.success();
  }
 }
