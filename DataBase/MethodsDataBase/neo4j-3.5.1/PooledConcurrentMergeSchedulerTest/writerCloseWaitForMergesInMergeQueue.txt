@Test void writerCloseWaitForMergesInMergeQueue(){
  assertTimeout(Duration.ofSeconds(10),() -> {
    indexWriter=mock(IndexWriter.class);
    SegmentCommitInfo segmentCommitInfo=getSegmentCommitInfo();
    Mockito.when(indexWriter.getNextMerge()).thenReturn(new TestOneMerge(segmentCommitInfo)).thenReturn(null);
    mergeScheduler.merge(indexWriter,MergeTrigger.EXPLICIT,false);
    assertEquals(1,mergeScheduler.getWriterTaskCount());
    Thread closeSchedulerThread=ThreadTestUtils.fork(() -> mergeScheduler.close());
    ThreadTestUtils.awaitThreadState(closeSchedulerThread,TimeUnit.SECONDS.toMillis(5),Thread.State.TIMED_WAITING);
    mergeScheduler.getExecutionLatch().countDown();
    closeSchedulerThread.join();
    assertEquals(0,mergeScheduler.getWriterTaskCount());
  }
);
}
