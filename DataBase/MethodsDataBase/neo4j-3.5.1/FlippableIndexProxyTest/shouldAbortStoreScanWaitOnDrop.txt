@Test public void shouldAbortStoreScanWaitOnDrop() throws Exception {
  FakePopulatingIndexProxy delegate=new FakePopulatingIndexProxy();
  FlippableIndexProxy flipper=new FlippableIndexProxy(delegate);
  OtherThreadExecutor<Void> waiter=cleanup.add(new OtherThreadExecutor<>("Waiter",null));
  Future<Object> waiting=waiter.executeDontWait(state -> flipper.awaitStoreScanCompleted());
  while (!delegate.awaitCalled) {
    Thread.sleep(10);
  }
  flipper.drop();
  waiting.get(10,SECONDS);
}
