@Test public void shouldLogContentOfTheMessageOnError() throws Exception {
  BoltRequestMessageReader requestMessageReader=mock(BoltRequestMessageReader.class);
  RuntimeException error=new RuntimeException("Hello!");
  doThrow(error).when(requestMessageReader).read(any());
  LogService logService=mock(LogService.class);
  Log log=mock(Log.class);
  when(logService.getInternalLog(MessageDecoder.class)).thenReturn(log);
  channel=new EmbeddedChannel(new MessageDecoder(packerUnderTest::newUnpacker,requestMessageReader,logService));
  byte[] messageBytes=packMessageWithSignature(RunMessage.SIGNATURE);
  try {
    channel.writeInbound(Unpooled.wrappedBuffer(messageBytes));
    fail("Exception expected");
  }
 catch (  RuntimeException e) {
    assertEquals(error,e);
  }
  assertMessageHexDumpLogged(log,messageBytes);
}
