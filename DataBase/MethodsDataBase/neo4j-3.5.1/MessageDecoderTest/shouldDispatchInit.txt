@Test public void shouldDispatchInit() throws Exception {
  BoltStateMachine stateMachine=mock(BoltStateMachine.class);
  SynchronousBoltConnection connection=new SynchronousBoltConnection(stateMachine);
  channel=new EmbeddedChannel(newDecoder(connection));
  String userAgent="Test/User Agent 1.0";
  Map<String,Object> authToken=MapUtil.map("scheme","basic","principal","user","credentials","password");
  channel.writeInbound(Unpooled.wrappedBuffer(serialize(packerUnderTest,new InitMessage(userAgent,authToken))));
  channel.finishAndReleaseAll();
  verify(stateMachine).process(refEq(new InitMessage(userAgent,authToken),"authToken"),any());
}
