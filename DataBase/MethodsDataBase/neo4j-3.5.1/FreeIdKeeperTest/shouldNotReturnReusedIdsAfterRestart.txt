@Test public void shouldNotReturnReusedIdsAfterRestart() throws Exception {
  StoreChannel channel=getStoreChannel();
  int batchSize=10;
  FreeIdKeeper keeper=getFreeIdKeeperAggressive(channel,batchSize);
  long idGen=0;
  for (long i=0; i < batchSize * 4; i++) {
    keeper.freeId(idGen++);
  }
  List<Long> reusedIds=new ArrayList<>();
  for (int i=0; i < batchSize * 2; i++) {
    long id=keeper.getId();
    reusedIds.add(id);
  }
  keeper.close();
  channel.close();
  channel=getStoreChannel();
  keeper=getFreeIdKeeper(channel,batchSize);
  List<Long> remainingIds=new ArrayList<>();
  long id;
  while ((id=keeper.getId()) != IdContainer.NO_RESULT) {
    remainingIds.add(id);
  }
  assertEquals(2 * batchSize,remainingIds.size());
  for (  Long remainingId : remainingIds) {
    assertFalse(reusedIds.contains(remainingId));
  }
}
