@Test public void shouldCompactFileOnCloseInRegularMode() throws Exception {
  StoreChannel channel=getStoreChannel();
  int batchSize=10;
  FreeIdKeeper keeper=getFreeIdKeeper(channel,batchSize);
  for (long i=0; i < batchSize * 4; i++) {
    keeper.freeId(i);
  }
  keeper.close();
  assertEquals(channel.size(),4 * batchSize * Long.BYTES);
  channel.close();
  channel=getStoreChannel();
  keeper=getFreeIdKeeper(channel,batchSize);
  for (long i=0; i < batchSize * 4; i++) {
    keeper.freeId(i);
  }
  for (int i=0; i < batchSize * 2; i++) {
    keeper.getId();
  }
  keeper.close();
  assertEquals(channel.size(),6 * batchSize * Long.BYTES);
}
