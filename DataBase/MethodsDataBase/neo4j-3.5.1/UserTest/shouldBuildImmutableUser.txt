@Test public void shouldBuildImmutableUser(){
  LegacyCredential abc=LegacyCredential.forPassword("123abc");
  LegacyCredential fruit=LegacyCredential.forPassword("fruit");
  User u1=new User.Builder("Steve",abc).build();
  User u2=new User.Builder("Steve",fruit).withRequiredPasswordChange(true).withFlag("nice_guy").build();
  assertThat(u1,equalTo(u1));
  assertThat(u1,not(equalTo(u2)));
  User u1AsU2=u1.augment().withCredentials(fruit).withRequiredPasswordChange(true).withFlag("nice_guy").build();
  assertThat(u1,not(equalTo(u1AsU2)));
  assertThat(u2,equalTo(u1AsU2));
  User u2AsU1=u2.augment().withCredentials(abc).withRequiredPasswordChange(false).withoutFlag("nice_guy").build();
  assertThat(u2,not(equalTo(u2AsU1)));
  assertThat(u1,equalTo(u2AsU1));
  assertThat(u1,not(equalTo(u2)));
}
