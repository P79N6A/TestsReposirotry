@Test public void shouldProvideIndexStatisticsWhenIndexIsBuiltViaPopulationAndConcurrentAdditionsAndChangesAndDeletions() throws Exception {
  indexOnlineMonitor.initialize(1);
  long[] nodes=repeatCreateNamedPeopleFor(NAMES.length * CREATION_MULTIPLIER);
  int initialNodes=nodes.length;
  IndexReference index=createPersonNameIndex();
  UpdatesTracker updatesTracker=executeCreationsDeletionsAndUpdates(nodes,CREATION_MULTIPLIER);
  awaitIndexesOnline();
  assertIndexedNodesMatchesStoreNodes();
  int seenWhilePopulating=initialNodes + updatesTracker.createdDuringPopulation() - updatesTracker.deletedDuringPopulation();
  double expectedSelectivity=UNIQUE_NAMES / seenWhilePopulating;
  int expectedIndexUpdates=updatesTracker.deletedAfterPopulation() + updatesTracker.createdAfterPopulation() + updatesTracker.updatedAfterPopulation();
  assertCorrectIndexSelectivity(expectedSelectivity,indexSelectivity(index));
  assertCorrectIndexSize(seenWhilePopulating,indexSize(index));
  assertCorrectIndexUpdates(expectedIndexUpdates,indexUpdates(index));
}
