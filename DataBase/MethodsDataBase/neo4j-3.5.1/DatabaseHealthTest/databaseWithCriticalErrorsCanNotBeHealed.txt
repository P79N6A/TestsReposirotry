@Test public void databaseWithCriticalErrorsCanNotBeHealed(){
  AssertableLogProvider logProvider=new AssertableLogProvider();
  DatabaseHealth databaseHealth=new DatabaseHealth(mock(DatabasePanicEventGenerator.class),logProvider.getLog(DatabaseHealth.class));
  assertTrue(databaseHealth.isHealthy());
  IOException criticalException=new IOException("Space exception.",new OutOfMemoryError("Out of memory."));
  databaseHealth.panic(criticalException);
  assertFalse(databaseHealth.isHealthy());
  assertFalse(databaseHealth.healed());
  logProvider.assertNoMessagesContaining("Database health set to OK");
  logProvider.assertContainsLogCallContaining("Database encountered a critical error and can't be healed. Restart required.");
}
