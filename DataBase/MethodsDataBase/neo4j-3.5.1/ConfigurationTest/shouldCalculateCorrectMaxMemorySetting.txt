@Test public void shouldCalculateCorrectMaxMemorySetting() throws Exception {
  long totalMachineMemory=OsBeanUtil.getTotalPhysicalMemory();
  assumeTrue(totalMachineMemory != VALUE_UNAVAILABLE);
  int percent=70;
  Configuration config=new Configuration(){
    @Override public long maxMemoryUsage(){
      return Configuration.calculateMaxMemoryFromPercent(percent);
    }
  }
;
  long memory=config.maxMemoryUsage();
  long expected=(long)((totalMachineMemory - Runtime.getRuntime().maxMemory()) * (percent / 100D));
  long diff=abs(expected - memory);
  assertThat(diff,lessThan((long)(expected / 10D)));
}
