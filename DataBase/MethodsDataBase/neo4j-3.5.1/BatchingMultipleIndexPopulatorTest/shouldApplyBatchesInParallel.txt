@Test public void shouldApplyBatchesInParallel() throws Exception {
  setProperty(BATCH_SIZE_NAME,2);
  EntityUpdates[] updates=new EntityUpdates[9];
  for (int i=0; i < updates.length; i++) {
    updates[i]=nodeUpdates(i,propertyId,String.valueOf(i),labelId);
  }
  IndexStoreView storeView=newStoreView(updates);
  ExecutorService executor=sameThreadExecutor();
  BatchingMultipleIndexPopulator batchingPopulator=new BatchingMultipleIndexPopulator(storeView,executor,NullLogProvider.getInstance(),mock(SchemaState.class));
  addPopulator(batchingPopulator,index1);
  batchingPopulator.indexAllEntities().run();
  verify(executor,atLeast(5)).execute(any(Runnable.class));
}
