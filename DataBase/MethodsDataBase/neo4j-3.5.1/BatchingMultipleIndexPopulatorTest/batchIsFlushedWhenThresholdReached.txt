@Test public void batchIsFlushedWhenThresholdReached() throws Exception {
  setProperty(BATCH_SIZE_NAME,2);
  EntityUpdates update1=nodeUpdates(1,propertyId,"foo",labelId);
  EntityUpdates update2=nodeUpdates(2,propertyId,"bar",labelId);
  EntityUpdates update3=nodeUpdates(3,propertyId,"baz",labelId);
  IndexStoreView storeView=newStoreView(update1,update2,update3);
  BatchingMultipleIndexPopulator batchingPopulator=new BatchingMultipleIndexPopulator(storeView,sameThreadExecutor(),NullLogProvider.getInstance(),mock(SchemaState.class));
  IndexPopulator populator=addPopulator(batchingPopulator,index1);
  batchingPopulator.indexAllEntities().run();
  verify(populator).add(forUpdates(index1,update1,update2));
  verify(populator).add(forUpdates(index1,update3));
}
