@Test public void populateFromQueueDoesNothingIfThresholdNotReached() throws Exception {
  setProperty(QUEUE_THRESHOLD_NAME,5);
  BatchingMultipleIndexPopulator batchingPopulator=new BatchingMultipleIndexPopulator(mock(IndexStoreView.class),immediateExecutor(),NullLogProvider.getInstance(),mock(SchemaState.class));
  IndexPopulator populator=addPopulator(batchingPopulator,index1);
  IndexUpdater updater=mock(IndexUpdater.class);
  when(populator.newPopulatingUpdater(any())).thenReturn(updater);
  IndexEntryUpdate<?> update1=add(1,index1.schema(),"foo");
  IndexEntryUpdate<?> update2=add(2,index1.schema(),"bar");
  batchingPopulator.queueUpdate(update1);
  batchingPopulator.queueUpdate(update2);
  batchingPopulator.populateFromQueueBatched(42);
  verify(updater,never()).process(any());
  verify(populator,never()).newPopulatingUpdater(any());
}
