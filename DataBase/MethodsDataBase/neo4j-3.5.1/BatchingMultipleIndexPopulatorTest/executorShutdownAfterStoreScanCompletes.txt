@Test public void executorShutdownAfterStoreScanCompletes() throws Exception {
  EntityUpdates update=nodeUpdates(1,propertyId,"foo",labelId);
  IndexStoreView storeView=newStoreView(update);
  ExecutorService executor=immediateExecutor();
  when(executor.awaitTermination(anyLong(),any())).thenReturn(true);
  BatchingMultipleIndexPopulator batchingPopulator=new BatchingMultipleIndexPopulator(storeView,executor,NullLogProvider.getInstance(),mock(SchemaState.class));
  StoreScan<IndexPopulationFailedKernelException> storeScan=batchingPopulator.indexAllEntities();
  verify(executor,never()).shutdown();
  storeScan.run();
  verify(executor,never()).shutdown();
  verify(executor,never()).awaitTermination(anyLong(),any());
  batchingPopulator.close(true);
  verify(executor).shutdown();
  verify(executor).awaitTermination(anyLong(),any());
}
