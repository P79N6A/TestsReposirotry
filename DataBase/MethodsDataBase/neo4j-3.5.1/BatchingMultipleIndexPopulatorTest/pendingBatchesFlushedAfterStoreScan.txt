@Test public void pendingBatchesFlushedAfterStoreScan() throws Exception {
  EntityUpdates update1=nodeUpdates(1,propertyId,"foo",labelId);
  EntityUpdates update2=nodeUpdates(2,propertyId,"bar",labelId);
  EntityUpdates update3=nodeUpdates(3,propertyId,"baz",labelId);
  EntityUpdates update42=nodeUpdates(4,42,"42",42);
  IndexStoreView storeView=newStoreView(update1,update2,update3,update42);
  BatchingMultipleIndexPopulator batchingPopulator=new BatchingMultipleIndexPopulator(storeView,sameThreadExecutor(),NullLogProvider.getInstance(),mock(SchemaState.class));
  IndexPopulator populator1=addPopulator(batchingPopulator,index1);
  IndexPopulator populator42=addPopulator(batchingPopulator,index42);
  batchingPopulator.indexAllEntities().run();
  verify(populator1).add(forUpdates(index1,update1,update2,update3));
  verify(populator42).add(forUpdates(index42,update42));
}
