@Test public void shouldProvideUserByUsernameEvenIfMidSetUsers() throws Throwable {
  FileUserRepository users=new FileUserRepository(fs,authFile,logProvider);
  users.create(new User.Builder("oskar",LegacyCredential.forPassword("hidden")).build());
  DoubleLatch latch=new DoubleLatch(2);
  Future<Object> setUsers=threading.execute(o -> {
    users.setUsers(new HangingListSnapshot(latch,10L,Collections.emptyList()));
    return null;
  }
,null);
  latch.startAndWaitForAllToStart();
  assertNotNull(users.getUserByName("oskar"));
  latch.finish();
  setUsers.get();
}
