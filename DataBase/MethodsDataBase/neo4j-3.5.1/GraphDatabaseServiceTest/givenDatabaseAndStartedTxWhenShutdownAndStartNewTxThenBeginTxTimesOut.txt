@Test public void givenDatabaseAndStartedTxWhenShutdownAndStartNewTxThenBeginTxTimesOut() throws Exception {
  GraphDatabaseService db=getTemporaryDatabase();
  Barrier.Control barrier=new Barrier.Control();
  t2.execute(state -> {
    try (Transaction tx=db.beginTx()){
      barrier.reached();
    }
     return null;
  }
);
  barrier.await();
  Future<Object> shutdownFuture=t3.execute(state -> {
    db.shutdown();
    return null;
  }
);
  t3.get().waitUntilWaiting(location -> location.isAt(DatabaseAvailability.class,"stop"));
  barrier.release();
  shutdownFuture.get();
  try {
    db.beginTx();
    fail("Should fail");
  }
 catch (  DatabaseShutdownException e) {
  }
}
