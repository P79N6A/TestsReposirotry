@Test void tryToShutdownComponentOnInitFailure() throws Throwable {
  LifeSupport lifeSupport=newLifeSupport();
  Lifecycle component=mock(Lifecycle.class);
  doThrow(new RuntimeException("Init exceptions")).when(component).init();
  doThrow(new RuntimeException("Shutdown exceptions")).when(component).shutdown();
  lifeSupport.add(component);
  try {
    lifeSupport.init();
    fail("Failure was expected");
  }
 catch (  Exception e) {
    String message=getExceptionStackTrace(e);
    assertThat(message,containsString("Exception during graceful attempt to shutdown partially initialized component. " + "Please use non suppressed exception to see original component failure."));
  }
  assertEquals(LifecycleStatus.SHUTDOWN,lifeSupport.getStatus());
  verify(component).shutdown();
}
