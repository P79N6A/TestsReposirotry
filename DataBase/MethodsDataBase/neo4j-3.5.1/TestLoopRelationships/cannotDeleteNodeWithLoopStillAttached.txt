@Test public void cannotDeleteNodeWithLoopStillAttached(){
  GraphDatabaseService db=getGraphDb();
  Node node;
  try (Transaction tx=db.beginTx()){
    node=db.createNode();
    node.createRelationshipTo(node,RelationshipType.withName("MAYOR_OF"));
    tx.success();
  }
   Transaction tx=newTransaction();
  node.delete();
  tx.success();
  exception.expect(ConstraintViolationException.class);
  exception.expectMessage("Cannot delete node<" + node.getId() + ">, because it still has relationships. "+ "To delete this node, you must first delete its relationships.");
  tx.close();
}
