@Test public void shouldLogOnlyTheFirstCaughtException() throws Exception {
  AssertableLogProvider logProvider=new AssertableLogProvider();
  BoltConnection connection=mock(BoltConnection.class);
  HouseKeeper houseKeeper=new HouseKeeper(connection,logProvider.getLog(HouseKeeper.class));
  Bootstrap bootstrap=newBootstrap(houseKeeper);
  RuntimeException error1=new RuntimeException("error #1");
  RuntimeException error2=new RuntimeException("error #2");
  RuntimeException error3=new RuntimeException("error #3");
  try (ServerSocket serverSocket=new ServerSocket(0)){
    ChannelFuture future=bootstrap.connect("localhost",serverSocket.getLocalPort()).sync();
    Channel channel=future.channel();
    channel.pipeline().fireExceptionCaught(error1);
    channel.pipeline().fireExceptionCaught(error2);
    channel.pipeline().fireExceptionCaught(error3);
    channel.closeFuture().sync();
  }
  finally {
    bootstrap.config().group().shutdownGracefully().sync();
  }
  logProvider.assertExactly(inLog(HouseKeeper.class).error(startsWith("Fatal error occurred when handling a client connection"),equalTo(error1)));
}
