@Test public void canFormatNestedMapsAndLists() throws Exception {
  String entity=json.assemble(new MappingRepresentation("test"){
    @Override protected void serialize(    MappingSerializer serializer){
      ArrayList<Representation> maps=new ArrayList<>();
      maps.add(new MappingRepresentation("map"){
        @Override protected void serialize(        MappingSerializer serializer){
          serializer.putString("foo","bar");
        }
      }
);
      serializer.putList("foo",new ServerListRepresentation(RepresentationType.MAP,maps));
    }
  }
);
  assertEquals("bar",((Map)((List)JsonHelper.jsonToMap(entity).get("foo")).get(0)).get("foo"));
}
