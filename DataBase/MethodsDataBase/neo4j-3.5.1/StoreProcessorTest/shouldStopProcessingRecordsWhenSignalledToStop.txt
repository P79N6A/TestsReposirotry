@SuppressWarnings("unchecked") @Test public void shouldStopProcessingRecordsWhenSignalledToStop() throws Exception {
  ConsistencyReport.Reporter reporter=mock(ConsistencyReport.Reporter.class);
  StoreProcessor processor=new StoreProcessor(CheckDecorator.NONE,reporter,Stage.SEQUENTIAL_FORWARD,CacheAccess.EMPTY);
  RecordStore<NodeRecord> nodeStore=new RecordStore.Delegator<NodeRecord>(stores.builder().build().getNodeStore()){
    @Override public void getRecordByCursor(    long id,    NodeRecord target,    RecordLoad mode,    PageCursor cursor) throws InvalidRecordException {
      if (id == 3) {
        processor.stop();
      }
      super.getRecordByCursor(id,target,mode,cursor);
    }
  }
;
  nodeStore.updateRecord(node(0,false,0,0));
  nodeStore.updateRecord(node(1,false,0,0));
  nodeStore.updateRecord(node(2,false,0,0));
  nodeStore.updateRecord(node(3,false,0,0));
  nodeStore.updateRecord(node(4,false,0,0));
  nodeStore.setHighestPossibleIdInUse(4);
  processor.applyFiltered(nodeStore);
  verify(reporter,times(3)).forNode(any(NodeRecord.class),any(RecordCheck.class));
}
