@Test public void shouldListAllIndexes() throws Exception {
  IndexReference toRetain;
  IndexReference toRetain2;
  IndexReference toDrop;
  IndexReference created;
  try (Transaction tx=beginTransaction()){
    toRetain=tx.schemaWrite().indexCreate(labelDescriptor(label,prop1));
    toRetain2=tx.schemaWrite().indexCreate(labelDescriptor(label2,prop1));
    toDrop=tx.schemaWrite().indexCreate(labelDescriptor(label,prop2));
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    created=tx.schemaWrite().indexCreate(labelDescriptor(label2,prop2));
    tx.schemaWrite().indexDrop(toDrop);
    Iterable<IndexReference> allIndexes=() -> tx.schemaRead().indexesGetAll();
    assertThat(allIndexes,containsInAnyOrder(toRetain,toRetain2,created));
    tx.success();
  }
 }
