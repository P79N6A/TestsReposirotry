@Test public void shouldHandleMultipleConcurrentStoreCopyWhenBeforeActionPerformsCheckPoint() throws Throwable {
  CheckPointingAction checkPointingAction=new CheckPointingAction(mutex);
  for (int i=0; i < 2; i++) {
    Resource firstLock=mutex.storeCopy(checkPointingAction);
    assertNotNull(checkPointingAction.lock);
    Resource secondLock=mutex.storeCopy(checkPointingAction);
    firstLock.close();
    Resource thirdLock=mutex.storeCopy(checkPointingAction);
    thirdLock.close();
    secondLock.close();
    checkPointingAction.unlock();
  }
}
