@Test void startTheDatabaseWithWrongVersionShouldFailAlsoWhenUpgradeIsAllowed() throws Throwable {
  File databaseDirectory=testDirectory.databaseDir();
  GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(databaseDirectory);
  try (Transaction tx=db.beginTx()){
    db.createNode();
    tx.success();
  }
   db.shutdown();
  String badStoreVersion="bad";
  try (FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();ThreadPoolJobScheduler scheduler=new ThreadPoolJobScheduler();PageCache pageCache=createPageCache(fileSystem,scheduler)){
    MetaDataStore.setRecord(pageCache,testDirectory.databaseLayout().metadataStore(),MetaDataStore.Position.STORE_VERSION,MetaDataStore.versionStringToLong(badStoreVersion));
  }
   RuntimeException exception=assertThrows(RuntimeException.class,() -> new TestGraphDatabaseFactory().newEmbeddedDatabaseBuilder(databaseDirectory).setConfig(GraphDatabaseSettings.allow_upgrade,"true").newGraphDatabase());
  assertTrue(exception.getCause() instanceof LifecycleException);
  assertTrue(exception.getCause().getCause() instanceof StoreUpgrader.UnexpectedUpgradingStoreVersionException);
}
