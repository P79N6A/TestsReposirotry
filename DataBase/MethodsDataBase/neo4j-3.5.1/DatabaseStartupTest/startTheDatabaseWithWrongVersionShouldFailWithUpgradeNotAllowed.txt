@Test void startTheDatabaseWithWrongVersionShouldFailWithUpgradeNotAllowed() throws Throwable {
  File databaseDir=testDirectory.databaseDir();
  GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(databaseDir);
  try (Transaction tx=db.beginTx()){
    db.createNode();
    tx.success();
  }
   db.shutdown();
  try (FileSystemAbstraction fileSystem=new DefaultFileSystemAbstraction();ThreadPoolJobScheduler scheduler=new ThreadPoolJobScheduler();PageCache pageCache=createPageCache(fileSystem,scheduler)){
    MetaDataStore.setRecord(pageCache,testDirectory.databaseLayout().metadataStore(),MetaDataStore.Position.STORE_VERSION,MetaDataStore.versionStringToLong("bad"));
  }
   RuntimeException exception=assertThrows(RuntimeException.class,() -> new TestGraphDatabaseFactory().newEmbeddedDatabase(databaseDir));
  assertTrue(exception.getCause() instanceof LifecycleException);
  assertTrue(exception.getCause().getCause() instanceof IllegalArgumentException);
  assertEquals("Unknown store version 'bad'",exception.getCause().getCause().getMessage());
}
