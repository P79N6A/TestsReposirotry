@Documented("Refer to items created earlier in the same batch job.\n" + "\n" + "The batch operation API allows you to refer to the URI returned from a\n"+ "created resource in subsequent job descriptions, within the same batch\n"+ "call.\n"+ "\n"+ "Use the +{[JOB ID]}+ special syntax to inject URIs from created resources\n"+ "into JSON strings in subsequent job descriptions.") @Test public void shouldBeAbleToReferToCreatedResource() throws Exception {
  String jsonString=new PrettyJSON().array().object().key("method").value("POST").key("to").value("/node").key("id").value(0).key("body").object().key("name").value("bob").endObject().endObject().object().key("method").value("POST").key("to").value("/node").key("id").value(1).key("body").object().key("age").value(12).endObject().endObject().object().key("method").value("POST").key("to").value("{0}/relationships").key("id").value(3).key("body").object().key("to").value("{1}").key("data").object().key("since").value("2010").endObject().key("type").value("KNOWS").endObject().endObject().object().key("method").value("POST").key("to").value("/index/relationship/my_rels").key("id").value(4).key("body").object().key("key").value("since").key("value").value("2010").key("uri").value("{3}").endObject().endObject().endArray().toString();
  String entity=gen.get().expectedStatus(200).payload(jsonString).post(batchUri()).entity();
  List<Map<String,Object>> results=JsonHelper.jsonToList(entity);
  assertEquals(4,results.size());
}
