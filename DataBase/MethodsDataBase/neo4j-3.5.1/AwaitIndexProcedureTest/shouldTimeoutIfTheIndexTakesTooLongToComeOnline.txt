@Test public void shouldTimeoutIfTheIndexTakesTooLongToComeOnline() throws InterruptedException, SchemaRuleNotFoundException, IndexNotFoundKernelException {
  when(tokenRead.nodeLabel(anyString())).thenReturn(0);
  when(tokenRead.propertyKey(anyString())).thenReturn(0);
  when(schemaRead.index(anyInt(),anyInt())).thenReturn(anyIndex);
  when(schemaRead.indexGetState(any(IndexReference.class))).thenReturn(POPULATING);
  AtomicReference<ProcedureException> exception=new AtomicReference<>();
  new Thread(() -> {
    try {
      procedure.awaitIndex(":Person(name)",0,TIME_UNIT);
    }
 catch (    ProcedureException e) {
      exception.set(e);
    }
  }
).start();
  assertEventually("Procedure did not time out",exception::get,not(nullValue()),TIMEOUT,TIME_UNIT);
  assertThat(exception.get().status(),is(Status.Procedure.ProcedureTimedOut));
}
