@Test public void shouldReportFailureWhenAllThreadsInThreadPoolAreBusy() throws Throwable {
  connection1=enterStreaming();
  connection2=enterStreaming();
  try {
    connection3=connectAndPerformBoltHandshake(newConnection());
    connection3.send(util.chunk(new InitMessage("TestClient/1.1",emptyMap())));
    assertThat(connection3,util.eventuallyReceives(msgFailure(Status.Request.NoThreadsAvailable,"There are no available threads to serve this request at the moment")));
    userLogProvider.assertContainsMessageContaining("since there are no available threads to serve it at the moment. You can retry at a later time");
    internalLogProvider.assertAtLeastOnce(AssertableLogProvider.inLog(startsWith(BoltConnection.class.getPackage().getName())).error(containsString("since there are no available threads to serve it at the moment. You can retry at a later time"),isA(RejectedExecutionException.class)));
  }
  finally {
    exitStreaming(connection1);
    exitStreaming(connection2);
  }
}
