@Test public void shouldHandleErrorThatCausesFailureMessage() throws Exception {
  Unpacker unpacker=mock(Unpacker.class);
  BoltIOException error=new BoltIOException(Status.General.UnknownError,"Hello");
  when(unpacker.unpackStructHeader()).thenThrow(error);
  BoltStateMachine stateMachine=mock(BoltStateMachine.class);
  BoltConnection connection=new SynchronousBoltConnection(stateMachine);
  BoltResponseHandler externalErrorResponseHandler=responseHandlerMock();
  BoltRequestMessageReader reader=new TestBoltRequestMessageReader(connection,externalErrorResponseHandler,emptyList());
  reader.read(unpacker);
  verify(stateMachine).handleExternalFailure(Neo4jError.from(error),externalErrorResponseHandler);
}
