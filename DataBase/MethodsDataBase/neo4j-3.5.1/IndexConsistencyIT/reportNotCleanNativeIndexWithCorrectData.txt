@Test public void reportNotCleanNativeIndexWithCorrectData() throws IOException, ConsistencyCheckIncompleteException {
  DatabaseLayout databaseLayout=db.databaseLayout();
  someData();
  resolveComponent(CheckPointer.class).forceCheckPoint(new SimpleTriggerInfo("forcedCheckpoint"));
  File indexesCopy=databaseLayout.file("indexesCopy");
  File indexSources=resolveComponent(DefaultIndexProviderMap.class).getDefaultProvider().directoryStructure().rootDirectory();
  copyRecursively(indexSources,indexesCopy,SOURCE_COPY_FILE_FILTER);
  db.shutdownAndKeepStore();
  copyRecursively(indexesCopy,indexSources);
  ConsistencyCheckService.Result result=fullConsistencyCheck();
  assertTrue("Expected consistency check to fail",result.isSuccessful());
  assertThat(readReport(result),hasItem(containsString("WARN : Index was not properly shutdown and rebuild is required.")));
}
