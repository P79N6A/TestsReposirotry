@Test public void reportNotCleanNativeIndex() throws IOException, ConsistencyCheckIncompleteException {
  DatabaseLayout databaseLayout=db.databaseLayout();
  someData();
  resolveComponent(CheckPointer.class).forceCheckPoint(new SimpleTriggerInfo("forcedCheckpoint"));
  File indexesCopy=databaseLayout.file("indexesCopy");
  File indexSources=resolveComponent(DefaultIndexProviderMap.class).getDefaultProvider().directoryStructure().rootDirectory();
  copyRecursively(indexSources,indexesCopy,SOURCE_COPY_FILE_FILTER);
  try (Transaction tx=db.beginTx()){
    createNewNode(new Label[]{LABEL_ONE});
    tx.success();
  }
   db.shutdownAndKeepStore();
  copyRecursively(indexesCopy,indexSources);
  ConsistencyCheckService.Result result=fullConsistencyCheck();
  assertFalse("Expected consistency check to fail",result.isSuccessful());
  assertThat(readReport(result),hasItem(containsString("WARN : Index was not properly shutdown and rebuild is required.")));
}
