@Test public void testMultiplePropertyUpdateFailures() throws IndexEntryConflictException, FlipFailedKernelException {
  NodePropertyAccessor nodePropertyAccessor=mock(NodePropertyAccessor.class);
  IndexEntryUpdate<?> update1=add(1,index1,"foo");
  IndexEntryUpdate<?> update2=add(2,index1,"bar");
  IndexUpdater updater=mock(IndexUpdater.class);
  IndexPopulator populator=createIndexPopulator(updater);
  addPopulator(populator,1);
  doThrow(getPopulatorException()).when(updater).process(any(IndexEntryUpdate.class));
  IndexUpdater multipleIndexUpdater=multipleIndexPopulator.newPopulatingUpdater(nodePropertyAccessor);
  multipleIndexUpdater.process(update1);
  multipleIndexUpdater.process(update2);
  verify(updater).process(update1);
  verify(updater,never()).process(update2);
  verify(updater).close();
  checkPopulatorFailure(populator);
}
