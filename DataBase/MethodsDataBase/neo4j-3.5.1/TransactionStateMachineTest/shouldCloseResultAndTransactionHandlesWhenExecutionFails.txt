@Test void shouldCloseResultAndTransactionHandlesWhenExecutionFails() throws Exception {
  KernelTransaction transaction=newTransaction();
  BoltResultHandle resultHandle=newResultHandle(new RuntimeException("some error"));
  TransactionStateMachineV1SPI stateMachineSPI=newTransactionStateMachineSPI(transaction,resultHandle);
  TransactionStateMachine stateMachine=newTransactionStateMachine(stateMachineSPI);
  RuntimeException e=assertThrows(RuntimeException.class,() -> stateMachine.run("SOME STATEMENT",null));
  assertEquals("some error",e.getMessage());
  assertNull(stateMachine.ctx.currentResultHandle);
  assertNull(stateMachine.ctx.currentResult);
  assertNull(stateMachine.ctx.currentTransaction);
}
