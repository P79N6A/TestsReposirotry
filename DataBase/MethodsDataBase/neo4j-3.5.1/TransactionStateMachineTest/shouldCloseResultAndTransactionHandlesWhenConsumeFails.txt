@Test void shouldCloseResultAndTransactionHandlesWhenConsumeFails() throws Exception {
  KernelTransaction transaction=newTransaction();
  TransactionStateMachineV1SPI stateMachineSPI=newTransactionStateMachineSPI(transaction);
  TransactionStateMachine stateMachine=newTransactionStateMachine(stateMachineSPI);
  stateMachine.run("SOME STATEMENT",null);
  assertNotNull(stateMachine.ctx.currentResultHandle);
  assertNotNull(stateMachine.ctx.currentResult);
  RuntimeException e=assertThrows(RuntimeException.class,() -> {
    stateMachine.streamResult(boltResult -> {
      throw new RuntimeException("some error");
    }
);
  }
);
  assertEquals("some error",e.getMessage());
  assertNull(stateMachine.ctx.currentResultHandle);
  assertNull(stateMachine.ctx.currentResult);
  assertNull(stateMachine.ctx.currentTransaction);
}
