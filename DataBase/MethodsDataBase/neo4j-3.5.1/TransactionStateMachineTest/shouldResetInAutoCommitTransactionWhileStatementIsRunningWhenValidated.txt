@Test void shouldResetInAutoCommitTransactionWhileStatementIsRunningWhenValidated() throws Exception {
  KernelTransaction transaction=newTimedOutTransaction();
  TransactionStateMachineV1SPI stateMachineSPI=newTransactionStateMachineSPI(transaction);
  TransactionStateMachine stateMachine=newTransactionStateMachine(stateMachineSPI);
  assertThat(stateMachine.state,is(TransactionStateMachine.State.AUTO_COMMIT));
  assertNull(stateMachine.ctx.currentTransaction);
  stateMachine.run("RETURN 1",null);
  assertThat(stateMachine.state,is(TransactionStateMachine.State.AUTO_COMMIT));
  assertNotNull(stateMachine.ctx.currentTransaction);
  stateMachine.validateTransaction();
  assertThat(stateMachine.state,is(TransactionStateMachine.State.AUTO_COMMIT));
  assertNull(stateMachine.ctx.currentTransaction);
  assertNull(stateMachine.ctx.currentResult);
  assertNull(stateMachine.ctx.currentResultHandle);
  verify(transaction,times(1)).getReasonIfTerminated();
  verify(transaction,times(1)).failure();
  verify(transaction,times(1)).close();
}
