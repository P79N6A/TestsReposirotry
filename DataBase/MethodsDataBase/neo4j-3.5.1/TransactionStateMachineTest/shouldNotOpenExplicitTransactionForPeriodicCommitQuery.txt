@Test public void shouldNotOpenExplicitTransactionForPeriodicCommitQuery() throws Exception {
  KernelTransaction transaction=newTransaction();
  TransactionStateMachineV1SPI stateMachineSPI=newTransactionStateMachineSPI(transaction);
  when(stateMachineSPI.isPeriodicCommit(PERIODIC_COMMIT_QUERY)).thenReturn(true);
  TransactionStateMachine stateMachine=newTransactionStateMachine(stateMachineSPI);
  stateMachine.run(PERIODIC_COMMIT_QUERY,EMPTY_MAP);
  assertEquals(transaction,stateMachine.ctx.currentTransaction);
  InOrder inOrder=inOrder(stateMachineSPI);
  inOrder.verify(stateMachineSPI).isPeriodicCommit(PERIODIC_COMMIT_QUERY);
  inOrder.verify(stateMachineSPI).executeQuery(any(LoginContext.class),eq(PERIODIC_COMMIT_QUERY),eq(EMPTY_MAP),any(),any());
  inOrder.verify(stateMachineSPI).beginTransaction(any(LoginContext.class),any(),any());
}
