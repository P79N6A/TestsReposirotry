@Test public void shouldTransitionToFailedStateIfPopulationJobCrashes() throws Exception {
  IndexPopulator failingPopulator=mock(IndexPopulator.class);
  doThrow(new RuntimeException("BORK BORK")).when(failingPopulator).add(any(Collection.class));
  FlippableIndexProxy index=new FlippableIndexProxy();
  createNode(map(name,"Taylor"),FIRST);
  IndexPopulationJob job=newIndexPopulationJob(failingPopulator,index,EntityType.NODE,indexDescriptor(FIRST,name,false));
  job.run();
  assertThat(index.getState(),equalTo(InternalIndexState.FAILED));
}
