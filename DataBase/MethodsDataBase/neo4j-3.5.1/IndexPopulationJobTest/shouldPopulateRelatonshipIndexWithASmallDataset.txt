@Test public void shouldPopulateRelatonshipIndexWithASmallDataset() throws Exception {
  String value="Philip J.Fry";
  long node1=createNode(map(name,value),FIRST);
  long node2=createNode(map(name,value),SECOND);
  long node3=createNode(map(age,31),FIRST);
  long node4=createNode(map(age,35,name,value),FIRST);
  long rel1=createRelationship(map(name,value),likes,node1,node3);
  createRelationship(map(name,value),knows,node3,node1);
  createRelationship(map(age,31),likes,node2,node1);
  long rel4=createRelationship(map(age,35,name,value),likes,node4,node4);
  IndexDescriptor descriptor=IndexDescriptorFactory.forSchema(SchemaDescriptorFactory.forRelType(0,0));
  IndexPopulator populator=spy(indexPopulator(descriptor));
  IndexPopulationJob job=newIndexPopulationJob(populator,new FlippableIndexProxy(),EntityType.RELATIONSHIP,descriptor);
  job.run();
  IndexEntryUpdate<?> update1=add(rel1,descriptor,Values.of(value));
  IndexEntryUpdate<?> update2=add(rel4,descriptor,Values.of(value));
  verify(populator).create();
  verify(populator).includeSample(update1);
  verify(populator).includeSample(update2);
  verify(populator,times(2)).add(anyCollection());
  verify(populator).sampleResult();
  verify(populator).close(true);
}
