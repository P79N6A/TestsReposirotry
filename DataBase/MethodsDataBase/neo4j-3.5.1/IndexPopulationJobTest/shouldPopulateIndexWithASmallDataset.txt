@Test public void shouldPopulateIndexWithASmallDataset() throws Exception {
  String value="Mattias";
  long node1=createNode(map(name,value),FIRST);
  createNode(map(name,value),SECOND);
  createNode(map(age,31),FIRST);
  long node4=createNode(map(age,35,name,value),FIRST);
  IndexPopulator populator=spy(indexPopulator(false));
  LabelSchemaDescriptor descriptor=SchemaDescriptorFactory.forLabel(0,0);
  IndexPopulationJob job=newIndexPopulationJob(populator,new FlippableIndexProxy(),EntityType.NODE,IndexDescriptorFactory.forSchema(descriptor));
  job.run();
  IndexEntryUpdate<?> update1=add(node1,descriptor,Values.of(value));
  IndexEntryUpdate<?> update2=add(node4,descriptor,Values.of(value));
  verify(populator).create();
  verify(populator).includeSample(update1);
  verify(populator).includeSample(update2);
  verify(populator,times(2)).add(anyCollection());
  verify(populator).sampleResult();
  verify(populator).close(true);
}
