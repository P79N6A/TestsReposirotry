@Test public void shouldIncludeProfileIfPresent() throws Throwable {
  QueryStatistics queryStatistics=mock(QueryStatistics.class);
  when(queryStatistics.containsUpdates()).thenReturn(false);
  QueryResult result=mock(QueryResult.class);
  when(result.fieldNames()).thenReturn(new String[0]);
  when(result.executionType()).thenReturn(explained(READ_ONLY));
  when(result.queryStatistics()).thenReturn(queryStatistics);
  when(result.getNotifications()).thenReturn(Collections.emptyList());
  when(result.executionPlanDescription()).thenReturn(plan("Join",map("arg1",1),2,4,3,1,singletonList("id1"),plan("Scan",map("arg2",1),2,4,7,1,singletonList("id2"))));
  TransactionalContext tc=mock(TransactionalContext.class);
  CypherAdapterStream stream=new CypherAdapterStream(result,Clock.systemUTC());
  MapValue meta=metadataOf(stream);
  MapValue expectedChild=mapValues("args",mapValues("arg2",intValue(1)),"identifiers",list(stringValue("id2")),"operatorType",stringValue("Scan"),"children",VirtualValues.EMPTY_LIST,"rows",longValue(1L),"dbHits",longValue(2L),"pageCacheHits",longValue(4L),"pageCacheMisses",longValue(7L),"pageCacheHitRatio",doubleValue(4.0 / 11));
  MapValue expectedProfile=mapValues("args",mapValues("arg1",intValue(1)),"identifiers",list(stringValue("id1")),"operatorType",stringValue("Join"),"children",list(expectedChild),"rows",longValue(1L),"dbHits",longValue(2L),"pageCacheHits",longValue(4L),"pageCacheMisses",longValue(3L),"pageCacheHitRatio",doubleValue(4.0 / 7));
  assertMapEqualsWithDelta((MapValue)meta.get("profile"),expectedProfile,0.0001);
}
