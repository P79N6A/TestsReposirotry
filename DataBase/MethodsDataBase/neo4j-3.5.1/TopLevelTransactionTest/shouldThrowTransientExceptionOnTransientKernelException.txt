@Test public void shouldThrowTransientExceptionOnTransientKernelException() throws Exception {
  KernelTransaction kernelTransaction=mock(KernelTransaction.class);
  when(kernelTransaction.isOpen()).thenReturn(true);
  doThrow(new TransactionFailureException(Status.Transaction.ConstraintsChanged,"Proving that TopLevelTransaction does the right thing")).when(kernelTransaction).close();
  TopLevelTransaction transaction=new TopLevelTransaction(kernelTransaction);
  transaction.success();
  try {
    transaction.close();
    fail("Should have failed");
  }
 catch (  TransientTransactionFailureException e) {
  }
}
