@Test public void shouldNotFindDeletedNodeInIndexScan() throws Exception {
  boolean needsValues=indexProvidesAllValues();
  int label=token.nodeLabel("Node");
  int prop=token.propertyKey("prop");
  IndexReference index=schemaRead.index(label,prop);
  IndexValueCapability wildcardCapability=index.valueCapability(ValueCategory.UNKNOWN);
  try (org.neo4j.internal.kernel.api.Transaction tx=beginTransaction();NodeValueIndexCursor node=cursors.allocateNodeValueIndexCursor()){
    MutableLongSet uniqueIds=new LongHashSet();
    tx.dataRead().nodeIndexScan(index,node,IndexOrder.NONE,needsValues);
    assertThat(node.numberOfProperties(),equalTo(1));
    assertFoundNodesAndValue(node,TOTAL_NODE_COUNT,uniqueIds,wildcardCapability,needsValues);
    tx.dataWrite().nodeDelete(strOne);
    tx.dataRead().nodeIndexScan(index,node,IndexOrder.NONE,needsValues);
    assertFoundNodesAndValue(node,TOTAL_NODE_COUNT - 1,uniqueIds,wildcardCapability,needsValues);
  }
 }
