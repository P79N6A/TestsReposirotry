@Test public void repetitiveRecoveryOfCorruptedLogs() throws IOException {
  GraphDatabaseAPI database=(GraphDatabaseAPI)databaseFactory.newEmbeddedDatabase(storeDir);
  generateTransactionsAndRotate(database,4,false);
  database.shutdown();
  removeLastCheckpointRecordFromLastLogFile();
  int expectedRecoveredTransactions=7;
  while (expectedRecoveredTransactions > 0) {
    truncateBytesFromLastLogFile(1 + random.nextInt(10));
    databaseFactory.newEmbeddedDatabase(storeDir).shutdown();
    int numberOfRecoveredTransactions=recoveryMonitor.getNumberOfRecoveredTransactions();
    assertEquals(expectedRecoveredTransactions,numberOfRecoveredTransactions);
    expectedRecoveredTransactions--;
    removeLastCheckpointRecordFromLastLogFile();
  }
}
