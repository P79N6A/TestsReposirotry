@Test public void repetitiveRecoveryIfCorruptedLogsWithCheckpoints() throws IOException {
  GraphDatabaseAPI database=(GraphDatabaseAPI)databaseFactory.newEmbeddedDatabase(storeDir);
  generateTransactionsAndRotate(database,4,true);
  database.shutdown();
  while (logFiles.getHighestLogVersion() > 0) {
    int bytesToTrim=1 + random.nextInt(100);
    truncateBytesFromLastLogFile(bytesToTrim);
    databaseFactory.newEmbeddedDatabase(storeDir).shutdown();
    int numberOfRecoveredTransactions=recoveryMonitor.getNumberOfRecoveredTransactions();
    assertThat(numberOfRecoveredTransactions,Matchers.greaterThanOrEqualTo(0));
  }
  File corruptedLogArchives=new File(storeDir,CorruptedLogsTruncator.CORRUPTED_TX_LOGS_BASE_NAME);
  assertThat(corruptedLogArchives.listFiles(),not(emptyArray()));
}
