@Test public void shouldNotifyOutputAboutFailedRecordMessage() throws Exception {
  PackOutput output=mock(PackOutput.class);
  Neo4jPack.Packer packer=mock(Neo4jPack.Packer.class);
  IOException error=new IOException("Unable to pack 42");
  doThrow(error).when(packer).pack(longValue(42));
  BoltResponseMessageWriterV1 writer=newWriter(output,packer);
  try {
    writer.write(new RecordMessage(() -> new AnyValue[]{stringValue("42"),longValue(42)}));
    fail("Exception expected");
  }
 catch (  IOException e) {
    assertEquals(error,e);
  }
  InOrder inOrder=inOrder(output,packer);
  inOrder.verify(output).beginMessage();
  inOrder.verify(packer).pack(stringValue("42"));
  inOrder.verify(packer).pack(longValue(42));
  inOrder.verify(output).messageFailed();
}
