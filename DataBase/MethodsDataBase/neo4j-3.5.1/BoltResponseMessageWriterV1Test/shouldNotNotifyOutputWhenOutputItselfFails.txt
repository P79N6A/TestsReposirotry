@Test public void shouldNotNotifyOutputWhenOutputItselfFails() throws Exception {
  PackOutput output=mock(PackOutput.class);
  Neo4jPack.Packer packer=mock(Neo4jPack.Packer.class);
  IOException error=new IOException("Unable to flush");
  doThrow(error).when(output).messageSucceeded();
  BoltResponseMessageWriterV1 writer=newWriter(output,packer);
  try {
    writer.write(new RecordMessage(() -> new AnyValue[]{longValue(1),longValue(2)}));
    fail("Exception expected");
  }
 catch (  IOException e) {
    assertEquals(error,e);
  }
  InOrder inOrder=inOrder(output,packer);
  inOrder.verify(output).beginMessage();
  inOrder.verify(packer).pack(longValue(1));
  inOrder.verify(packer).pack(longValue(2));
  inOrder.verify(output).messageSucceeded();
  verify(output,never()).messageFailed();
}
