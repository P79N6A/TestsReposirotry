@Test public void shouldHaveTaskQueueSizeEqualToMaxNumberOfProcessors() throws Exception {
  StageControl control=mock(StageControl.class);
  final CountDownLatch latch=new CountDownLatch(1);
  final int processors=2;
  int maxProcessors=5;
  Configuration configuration=new Configuration(){
    @Override public int maxNumberOfProcessors(){
      return maxProcessors;
    }
  }
;
  final ProcessorStep<Void> step=new BlockingProcessorStep(control,configuration,processors,latch);
  step.start(ORDER_SEND_DOWNSTREAM);
  step.processors(1);
  for (int i=0; i < processors + maxProcessors; i++) {
    step.receive(i,null);
  }
  Future<Void> receiveFuture=t2.execute(receive(processors,step));
  t2.get().waitUntilThreadState(Thread.State.TIMED_WAITING);
  latch.countDown();
  receiveFuture.get();
}
