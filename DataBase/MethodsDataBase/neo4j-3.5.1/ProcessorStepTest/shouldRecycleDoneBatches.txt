@Test public void shouldRecycleDoneBatches() throws Exception {
  StageControl control=mock(StageControl.class);
  MyProcessorStep step=new MyProcessorStep(control,0);
  step.start(ORDER_SEND_DOWNSTREAM);
  int batches=10;
  for (int i=0; i < batches; i++) {
    step.receive(i,i);
  }
  step.endOfUpstream();
  step.awaitCompleted();
  verify(control,times(batches)).recycle(any());
  step.close();
}
