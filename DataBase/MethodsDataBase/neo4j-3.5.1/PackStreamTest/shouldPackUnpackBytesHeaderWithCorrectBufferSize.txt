@Test void shouldPackUnpackBytesHeaderWithCorrectBufferSize() throws Throwable {
  Machine machine=new Machine();
  PackStream.Packer packer=machine.packer();
  MachineClient client=new MachineClient(8);
  PackStream.Unpacker unpacker=client.unpacker();
  for (int size=0; size <= 65536; size++) {
    machine.reset();
    packer.packBytesHeader(size);
    packer.flush();
    int bufferSize=computeOutputBufferSize(size,false);
    byte[] output=machine.output();
    assertThat(output.length,equalTo(bufferSize));
    client.reset(output);
    int value=unpacker.unpackBytesHeader();
    assertThat(value,equalTo(size));
  }
}
