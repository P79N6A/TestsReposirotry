@Test public void indexPopulationMustFailIfExceedingIndexKeySizeLimit(){
  String propValue=getString(keySizeLimit + 1);
  createNode(propValue);
  try (Transaction tx=db.beginTx()){
    db.schema().indexFor(LABEL_ONE).on(propKey).create();
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    db.schema().awaitIndexesOnline(1,TimeUnit.MINUTES);
    tx.success();
  }
 catch (  IllegalStateException e) {
    assertThat(e.getMessage(),Matchers.containsString("Index entered a FAILED state."));
  }
  try (Transaction tx=db.beginTx()){
    Iterator<IndexDefinition> iterator=db.schema().getIndexes(LABEL_ONE).iterator();
    assertTrue(iterator.hasNext());
    IndexDefinition next=iterator.next();
    assertEquals("state is FAILED",Schema.IndexState.FAILED,db.schema().getIndexState(next));
    assertThat(db.schema().getIndexFailure(next),Matchers.containsString("Index key-value size it to large. Please see index documentation for limitations."));
    tx.success();
  }
 }
