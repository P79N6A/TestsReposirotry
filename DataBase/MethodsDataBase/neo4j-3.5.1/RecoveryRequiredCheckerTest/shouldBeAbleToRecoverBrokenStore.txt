@Test public void shouldBeAbleToRecoverBrokenStore() throws Exception {
  try (FileSystemAbstraction fileSystemAbstraction=createAndCrashWithDefaultConfig()){
    PageCache pageCache=pageCacheRule.getPageCache(fileSystemAbstraction);
    RecoveryRequiredChecker recoverer=getRecoveryCheckerWithDefaultConfig(fileSystemAbstraction,pageCache);
    assertThat(recoverer.isRecoveryRequiredAt(databaseLayout),is(true));
    new TestGraphDatabaseFactory().setFileSystem(fileSystemAbstraction).newImpermanentDatabase(storeDir).shutdown();
    assertThat(recoverer.isRecoveryRequiredAt(databaseLayout),is(false));
  }
 }
