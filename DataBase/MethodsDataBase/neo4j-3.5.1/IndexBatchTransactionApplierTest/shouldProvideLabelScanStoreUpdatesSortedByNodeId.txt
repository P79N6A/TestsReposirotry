@Test public void shouldProvideLabelScanStoreUpdatesSortedByNodeId() throws Exception {
  IndexingService indexing=mock(IndexingService.class);
  when(indexing.convertToIndexUpdates(any(),eq(EntityType.NODE))).thenAnswer(o -> Iterables.empty());
  LabelScanWriter writer=new OrderVerifyingLabelScanWriter(10,15,20);
  WorkSync<Supplier<LabelScanWriter>,LabelUpdateWork> labelScanSync=spy(new WorkSync<>(singletonProvider(writer)));
  WorkSync<IndexingUpdateService,IndexUpdatesWork> indexUpdatesSync=new WorkSync<>(indexing);
  TransactionToApply tx=mock(TransactionToApply.class);
  PropertyStore propertyStore=mock(PropertyStore.class);
  try (IndexBatchTransactionApplier applier=new IndexBatchTransactionApplier(indexing,labelScanSync,indexUpdatesSync,mock(NodeStore.class),mock(RelationshipStore.class),new PropertyPhysicalToLogicalConverter(propertyStore))){
    try (TransactionApplier txApplier=applier.startTx(tx)){
      txApplier.visitNodeCommand(node(15));
      txApplier.visitNodeCommand(node(20));
      txApplier.visitNodeCommand(node(10));
    }
   }
   verify(labelScanSync).applyAsync(any());
}
