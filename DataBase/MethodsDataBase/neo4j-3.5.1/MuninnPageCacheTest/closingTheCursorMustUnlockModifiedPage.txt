@Test void closingTheCursorMustUnlockModifiedPage() throws Exception {
  writeInitialDataTo(file("a"));
  try (MuninnPageCache pageCache=createPageCache(fs,2,PageCacheTracer.NULL,PageCursorTracerSupplier.NULL);PagedFile pagedFile=map(pageCache,file("a"),8)){
    Future<?> task=executor.submit(() -> {
      try (PageCursor cursor=pagedFile.io(0,PF_SHARED_WRITE_LOCK)){
        assertTrue(cursor.next());
        cursor.putLong(41);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
);
    task.get();
    try (PageCursor cursor=pagedFile.io(0,PF_SHARED_WRITE_LOCK)){
      assertTrue(cursor.next());
      long value=cursor.getLong();
      cursor.setOffset(0);
      cursor.putLong(value + 1);
    }
     long clockArm=pageCache.evictPages(1,0,EvictionRunEvent.NULL);
    assertThat(clockArm,is(1L));
    ByteBuffer buf=readIntoBuffer("a");
    assertThat(buf.getLong(),is(42L));
    assertThat(buf.getLong(),is(y));
  }
 }
