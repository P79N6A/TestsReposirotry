@Test void shouldProcessRunMessage() throws Exception {
  StatementMetadata statementMetadata=mock(StatementMetadata.class);
  when(statementMetadata.fieldNames()).thenReturn(new String[]{"foo","bar","baz"});
  when(statementProcessor.run(any(),any())).thenReturn(statementMetadata);
  BoltResponseHandler responseHandler=mock(BoltResponseHandler.class);
  connectionState.setResponseHandler(responseHandler);
  BoltStateMachineState nextState=state.process(new RunMessage("RETURN 1",EMPTY_MAP),context);
  assertEquals(streamingState,nextState);
  verify(statementProcessor).run("RETURN 1",EMPTY_MAP);
  verify(responseHandler).onMetadata("fields",stringArray("foo","bar","baz"));
  verify(responseHandler).onMetadata(eq("result_available_after"),any());
}
