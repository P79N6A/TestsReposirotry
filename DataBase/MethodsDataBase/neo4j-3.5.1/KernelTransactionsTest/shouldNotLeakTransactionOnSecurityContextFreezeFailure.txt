@Test public void shouldNotLeakTransactionOnSecurityContextFreezeFailure() throws Throwable {
  KernelTransactions kernelTransactions=newKernelTransactions();
  LoginContext loginContext=mock(LoginContext.class);
  when(loginContext.authorize(any(),any())).thenThrow(new AuthorizationExpiredException("Freeze failed."));
  assertException(() -> kernelTransactions.newInstance(KernelTransaction.Type.explicit,loginContext,0L),AuthorizationExpiredException.class,"Freeze failed.");
  assertThat("We should not have any transaction",kernelTransactions.activeTransactions(),is(empty()));
}
