@Test public void shouldThrowExceptionOnNodeDuplicateRuleFound() throws DuplicateSchemaRuleException, SchemaRuleNotFoundException {
  TokenNameLookup tokenNameLookup=getDefaultTokenNameLookup();
  SchemaStorage schemaStorageSpy=Mockito.spy(storage);
  Mockito.when(schemaStorageSpy.loadAllSchemaRules(any(),any(),anyBoolean())).thenReturn(Iterators.iterator(getUniquePropertyConstraintRule(1L,LABEL1,PROP1),getUniquePropertyConstraintRule(2L,LABEL1,PROP1)));
  expectedException.expect(DuplicateSchemaRuleException.class);
  expectedException.expect(new KernelExceptionUserMessageMatcher(tokenNameLookup,"Multiple uniqueness constraints found for :Label1(prop1)."));
  schemaStorageSpy.constraintsGetSingle(ConstraintDescriptorFactory.uniqueForLabel(labelId(LABEL1),propId(PROP1)));
}
