@Test public void shouldCallHaltOnUnexpectedFailures() throws Exception {
  BoltResponseMessageWriter msgWriter=newResponseHandlerMock();
  doThrow(new RuntimeException("Something went horribly wrong")).when(msgWriter).write(any(SuccessMessage.class));
  BoltConnection connection=mock(BoltConnection.class);
  MessageProcessingHandler handler=new MessageProcessingHandler(msgWriter,connection,mock(Log.class));
  handler.onFinish();
  verify(connection).stop();
}
