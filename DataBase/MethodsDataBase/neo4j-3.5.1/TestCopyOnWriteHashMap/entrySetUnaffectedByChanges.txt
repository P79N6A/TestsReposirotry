@Test public void entrySetUnaffectedByChanges(){
  Map<Integer,String> map=new CopyOnWriteHashMap<>();
  map.put(0,"0");
  map.put(1,"1");
  map.put(2,"2");
  @SuppressWarnings("unchecked") Map.Entry<Integer,String>[] allEntries=map.entrySet().toArray(new Map.Entry[0]);
  assertThat(map.entrySet(),containsInAnyOrder(allEntries));
  Iterator<Entry<Integer,String>> entries=map.entrySet().iterator();
  map.remove(1);
  List<Entry<Integer,String>> entriesBeforeRemoval=Iterators.asList(entries);
  assertThat(entriesBeforeRemoval,containsInAnyOrder(allEntries));
}
