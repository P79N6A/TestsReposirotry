@Test public void shouldLogHelpfullyWhenPluginJarIsCorrupt() throws Exception {
  URL theJar=createJarFor(ClassWithOneProcedure.class,ClassWithAnotherProcedure.class,ClassWithNoProcedureAtAll.class);
  corruptJar(theJar);
  AssertableLogProvider logProvider=new AssertableLogProvider(true);
  ProcedureJarLoader jarloader=new ProcedureJarLoader(new ReflectiveProcedureCompiler(new TypeMappers(),new ComponentRegistry(),registryWithUnsafeAPI(),log,procedureConfig()),logProvider.getLog(ProcedureJarLoader.class));
  try {
    jarloader.loadProceduresFromDir(parentDir(theJar));
    fail("Should have logged and thrown exception.");
  }
 catch (  ZipException expected) {
    logProvider.assertContainsLogCallContaining(escapeJava(String.format("Plugin jar file: %s corrupted.",new File(theJar.toURI()).toPath())));
  }
}
