@Test public void shouldFailIfTheStoreInNotConsistent() throws Exception {
  breakNodeStore();
  Date timestamp=new Date();
  ConsistencyCheckService service=new ConsistencyCheckService(timestamp);
  String logsDir=testDirectory.directory().getPath();
  Config configuration=Config.defaults(settings(GraphDatabaseSettings.logs_directory.name(),logsDir));
  ConsistencyCheckService.Result result=runFullConsistencyCheck(service,configuration);
  assertFalse(result.isSuccessful());
  String reportFile=format("inconsistencies-%s.report",new SimpleDateFormat("yyyy-MM-dd.HH.mm.ss").format(timestamp));
  assertEquals(new File(logsDir,reportFile),result.reportFile());
  assertTrue("Inconsistency report file not generated",result.reportFile().exists());
}
