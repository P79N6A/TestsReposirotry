@Test public void shouldReportMissingSchemaIndex() throws Exception {
  DatabaseLayout databaseLayout=testDirectory.databaseLayout();
  GraphDatabaseService gds=getGraphDatabaseService(databaseLayout.databaseDirectory());
  Label label=Label.label("label");
  String propKey="propKey";
  createIndex(gds,label,propKey);
  gds.shutdown();
  File schemaDir=findFile(databaseLayout,"schema");
  FileUtils.deleteRecursively(schemaDir);
  ConsistencyCheckService service=new ConsistencyCheckService();
  Config configuration=Config.defaults(settings());
  Result result=runFullConsistencyCheck(service,configuration,databaseLayout);
  assertTrue(result.isSuccessful());
  File reportFile=result.reportFile();
  assertTrue("Consistency check report file should be generated.",reportFile.exists());
  assertThat("Expected to see report about schema index not being online",Files.readAllLines(reportFile.toPath()).toString(),allOf(containsString("schema rule"),containsString("not online")));
}
