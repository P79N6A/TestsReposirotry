@Test public void shouldCallCloseListenerOnCloseWhenCommitting() throws Exception {
  AtomicLong closeTxId=new AtomicLong(Long.MIN_VALUE);
  KernelTransactionImplementation tx=newTransaction(loginContext());
  tx.registerCloseListener(closeTxId::set);
  if (isWriteTx) {
    tx.upgradeToDataWrites();
    tx.txState().nodeDoCreate(42L);
  }
  tx.success();
  tx.close();
  assertThat(closeTxId.get(),isWriteTx ? greaterThan(BASE_TX_ID) : equalTo(0L));
}
