@Test public void mustNotLeakTasksOnCrash(){
  String exceptionMessage="When there's no more room in hell, the dead will walk the earth";
  CrashGenerationCleaner cleaner=newCrashingCrashGenerationCleaner(exceptionMessage);
  ExecutorService executorService=Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());
  try {
    cleaner.clean(executorService);
    fail("Expected to throw");
  }
 catch (  Throwable e) {
    Throwable rootCause=Exceptions.rootCause(e);
    assertTrue(rootCause instanceof IOException);
    assertEquals(exceptionMessage,rootCause.getMessage());
  }
 finally {
    List<Runnable> tasks=executorService.shutdownNow();
    assertEquals(0,tasks.size());
  }
}
