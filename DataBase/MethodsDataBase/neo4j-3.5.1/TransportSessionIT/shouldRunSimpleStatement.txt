@Test public void shouldRunSimpleStatement() throws Throwable {
  connection.connect(address).send(util.defaultAcceptedVersions()).send(util.chunk(new InitMessage("TestClient/1.1",emptyMap()),new RunMessage("UNWIND [1,2,3] AS a RETURN a, a * a AS a_squared"),PullAllMessage.INSTANCE));
  assertThat(connection,util.eventuallyReceivesSelectedProtocolVersion());
  Matcher<Map<? extends String,?>> entryTypeMatcher=hasEntry(is("type"),equalTo("r"));
  Matcher<Map<? extends String,?>> entryFieldMatcher=hasEntry(is("fields"),equalTo(asList("a","a_squared")));
  assertThat(connection,util.eventuallyReceives(msgSuccess(),msgSuccess(CoreMatchers.allOf(entryFieldMatcher,hasKey("result_available_after"))),msgRecord(eqRecord(equalTo(longValue(1L)),equalTo(longValue(1L)))),msgRecord(eqRecord(equalTo(longValue(2L)),equalTo(longValue(4L)))),msgRecord(eqRecord(equalTo(longValue(3L)),equalTo(longValue(9L)))),msgSuccess(CoreMatchers.allOf(entryTypeMatcher,hasKey("result_consumed_after")))));
}
