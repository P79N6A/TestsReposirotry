@Test public void shouldFailNicelyOnNullKeysInMap() throws Throwable {
  HashMap<String,Object> params=new HashMap<>();
  HashMap<String,Object> inner=new HashMap<>();
  inner.put(null,42L);
  inner.put("foo",1337L);
  params.put("p",inner);
  connection.connect(address).send(util.defaultAcceptedVersions()).send(util.chunk(new InitMessage("TestClient/1.1",emptyMap()),new RunMessage("RETURN {p}",ValueUtils.asMapValue(params)),PullAllMessage.INSTANCE));
  assertThat(connection,util.eventuallyReceivesSelectedProtocolVersion());
  assertThat(connection,util.eventuallyReceives(msgSuccess(),msgFailure(Status.Request.Invalid,"Value `null` is not supported as key in maps, must be a non-nullable string."),msgIgnored()));
  connection.send(util.chunk(AckFailureMessage.INSTANCE,new RunMessage("RETURN 1"),PullAllMessage.INSTANCE));
  assertThat(connection,util.eventuallyReceives(msgSuccess(),msgSuccess(),msgRecord(eqRecord(equalTo(longValue(1L)))),msgSuccess()));
}
