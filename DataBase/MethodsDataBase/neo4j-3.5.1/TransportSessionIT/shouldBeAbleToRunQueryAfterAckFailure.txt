@Test public void shouldBeAbleToRunQueryAfterAckFailure() throws Throwable {
  connection.connect(address).send(util.defaultAcceptedVersions()).send(util.chunk(new InitMessage("TestClient/1.1",emptyMap()),new RunMessage("QINVALID"),PullAllMessage.INSTANCE));
  assertThat(connection,util.eventuallyReceivesSelectedProtocolVersion());
  assertThat(connection,util.eventuallyReceives(msgSuccess(),msgFailure(Status.Statement.SyntaxError,String.format("Invalid input 'Q': expected <init> (line 1, column 1 (offset: 0))%n" + "\"QINVALID\"%n" + " ^")),msgIgnored()));
  connection.send(util.chunk(AckFailureMessage.INSTANCE,new RunMessage("RETURN 1"),PullAllMessage.INSTANCE));
  assertThat(connection,util.eventuallyReceives(msgSuccess(),msgSuccess(),msgRecord(eqRecord(equalTo(longValue(1L)))),msgSuccess()));
}
