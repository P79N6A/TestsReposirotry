@Test public void shouldFindNodesByLabelInTx() throws Exception {
  long inStore;
  long deletedInTx;
  long createdInTx;
  try (Transaction tx=beginTransaction()){
    inStore=createNode(tx.dataWrite(),labelOne);
    createNode(tx.dataWrite(),labelTwo);
    deletedInTx=createNode(tx.dataWrite(),labelOne);
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    tx.dataWrite().nodeDelete(deletedInTx);
    createdInTx=createNode(tx.dataWrite(),labelOne);
    createNode(tx.dataWrite(),labelTwo);
    Read read=tx.dataRead();
    try (NodeLabelIndexCursor cursor=tx.cursors().allocateNodeLabelIndexCursor()){
      MutableLongSet uniqueIds=new LongHashSet();
      read.nodeLabelScan(labelOne,cursor);
      assertNodes(cursor,uniqueIds,inStore,createdInTx);
    }
   }
 }
