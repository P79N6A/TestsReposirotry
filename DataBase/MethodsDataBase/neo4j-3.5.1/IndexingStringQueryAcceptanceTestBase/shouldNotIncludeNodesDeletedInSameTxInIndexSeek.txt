@Test public void shouldNotIncludeNodesDeletedInSameTxInIndexSeek(){
  createNodes(db,LABEL,nonMatching[0]);
  LongSet toDelete=createNodes(db,LABEL,matching[0],nonMatching[1],matching[1],nonMatching[2]);
  MutableLongSet expected=createNodes(db,LABEL,matching[2]);
  MutableLongSet found=new LongHashSet();
  try (Transaction tx=db.beginTx()){
    LongIterator deleting=toDelete.longIterator();
    while (deleting.hasNext()) {
      long id=deleting.next();
      db.getNodeById(id).delete();
      expected.remove(id);
    }
    collectNodes(found,db.findNodes(LABEL,KEY,template,searchMode));
  }
   assertThat(found,equalTo(expected));
}
