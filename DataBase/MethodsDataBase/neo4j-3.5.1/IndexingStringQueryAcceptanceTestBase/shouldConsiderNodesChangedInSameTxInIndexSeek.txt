@Test public void shouldConsiderNodesChangedInSameTxInIndexSeek(){
  createNodes(db,LABEL,nonMatching[0]);
  LongSet toChangeToMatch=createNodes(db,LABEL,nonMatching[1]);
  MutableLongSet toChangeToNotMatch=createNodes(db,LABEL,matching[0]);
  MutableLongSet expected=createNodes(db,LABEL,matching[1]);
  MutableLongSet found=new LongHashSet();
  try (Transaction tx=db.beginTx()){
    LongIterator toMatching=toChangeToMatch.longIterator();
    while (toMatching.hasNext()) {
      long id=toMatching.next();
      db.getNodeById(id).setProperty(KEY,matching[2]);
      expected.add(id);
    }
    LongIterator toNotMatching=toChangeToNotMatch.longIterator();
    while (toNotMatching.hasNext()) {
      long id=toNotMatching.next();
      db.getNodeById(id).setProperty(KEY,nonMatching[2]);
      expected.remove(id);
    }
    collectNodes(found,db.findNodes(LABEL,KEY,template,searchMode));
  }
   assertThat(found,equalTo(expected));
}
