@Test public void queryShouldFindDataAddedInLaterTransactions(){
  db=createDatabase();
  db.execute(format(NODE_CREATE,"node",array("Label1","Label2"),array("prop1","prop2"))).close();
  db.execute(format(RELATIONSHIP_CREATE,"rel",array("Reltype1","Reltype2"),array("prop1","prop2"))).close();
  awaitIndexesOnline();
  long horseId;
  long horseRelId;
  try (Transaction tx=db.beginTx()){
    Node zebra=db.createNode();
    zebra.setProperty("prop1","zebra");
    Node horse=db.createNode(Label.label("Label1"));
    horse.setProperty("prop2","horse");
    horse.setProperty("prop3","zebra");
    Relationship horseRel=zebra.createRelationshipTo(horse,RelationshipType.withName("Reltype1"));
    horseRel.setProperty("prop1","horse");
    Relationship loop=horse.createRelationshipTo(horse,RelationshipType.withName("loop"));
    loop.setProperty("prop2","zebra");
    horseId=horse.getId();
    horseRelId=horseRel.getId();
    tx.success();
  }
   assertQueryFindsIds(db,true,"node","horse",newSetWith(horseId));
  assertQueryFindsIds(db,true,"node","horse zebra",newSetWith(horseId));
  assertQueryFindsIds(db,false,"rel","horse",newSetWith(horseRelId));
  assertQueryFindsIds(db,false,"rel","horse zebra",newSetWith(horseRelId));
}
