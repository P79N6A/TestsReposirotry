@Test public void queryingIndexInPopulatingStateMustBlockUntilIndexIsOnlineEvenWhenTransactionHasState(){
  db=createDatabase();
  long nodeCount=10_000;
  try (Transaction tx=db.beginTx()){
    for (int i=0; i < nodeCount; i++) {
      db.createNode(LABEL).setProperty(PROP,"value");
    }
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    createSimpleNodesIndex();
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    db.createNode(LABEL).setProperty(PROP,"value");
    try (Result result=db.execute(format(QUERY_NODES,"nodes","value"));Stream<Map<String,Object>> stream=result.stream()){
      assertThat(stream.count(),is(nodeCount + 1));
    }
     tx.success();
  }
 }
