@Test public void queryResultsMustNotIncludeNodesDeletedInThisTransaction(){
  db=createDatabase();
  try (Transaction tx=db.beginTx()){
    createSimpleNodesIndex();
    tx.success();
  }
   long nodeIdA;
  long nodeIdB;
  try (Transaction tx=db.beginTx()){
    awaitIndexesOnline();
    Node nodeA=db.createNode(LABEL);
    nodeA.setProperty(PROP,"value");
    nodeIdA=nodeA.getId();
    Node nodeB=db.createNode(LABEL);
    nodeB.setProperty(PROP,"value");
    nodeIdB=nodeB.getId();
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    db.getNodeById(nodeIdA).delete();
    db.getNodeById(nodeIdB).delete();
    try (Result result=db.execute(format(QUERY_NODES,"nodes","value"))){
      assertThat(result.stream().count(),is(0L));
    }
     tx.success();
  }
 }
