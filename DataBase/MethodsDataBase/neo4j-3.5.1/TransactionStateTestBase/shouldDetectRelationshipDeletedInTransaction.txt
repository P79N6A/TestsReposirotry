@Test public void shouldDetectRelationshipDeletedInTransaction() throws Exception {
  long node;
  int relType;
  long deletedInTx, unaffected, addedInTx, addedAndRemovedInTx;
  try (Transaction tx=beginTransaction()){
    node=tx.dataWrite().nodeCreate();
    relType=tx.tokenWrite().relationshipTypeCreateForName("REL_TYPE");
    deletedInTx=tx.dataWrite().relationshipCreate(node,relType,node);
    unaffected=tx.dataWrite().relationshipCreate(node,relType,node);
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    addedInTx=tx.dataWrite().relationshipCreate(node,relType,node);
    addedAndRemovedInTx=tx.dataWrite().relationshipCreate(node,relType,node);
    tx.dataWrite().relationshipDelete(deletedInTx);
    tx.dataWrite().relationshipDelete(addedAndRemovedInTx);
    assertFalse(tx.dataRead().relationshipDeletedInTransaction(addedInTx));
    assertFalse(tx.dataRead().relationshipDeletedInTransaction(unaffected));
    assertTrue(tx.dataRead().relationshipDeletedInTransaction(addedAndRemovedInTx));
    assertTrue(tx.dataRead().relationshipDeletedInTransaction(deletedInTx));
  }
 }
