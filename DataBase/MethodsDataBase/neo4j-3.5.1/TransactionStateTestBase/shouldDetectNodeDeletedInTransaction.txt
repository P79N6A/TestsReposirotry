@Test public void shouldDetectNodeDeletedInTransaction() throws Exception {
  long deletedInTx, unaffected, addedInTx, addedAndRemovedInTx;
  try (Transaction tx=beginTransaction()){
    deletedInTx=tx.dataWrite().nodeCreate();
    unaffected=tx.dataWrite().nodeCreate();
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    addedInTx=tx.dataWrite().nodeCreate();
    addedAndRemovedInTx=tx.dataWrite().nodeCreate();
    tx.dataWrite().nodeDelete(deletedInTx);
    tx.dataWrite().nodeDelete(addedAndRemovedInTx);
    assertFalse(tx.dataRead().nodeDeletedInTransaction(addedInTx));
    assertFalse(tx.dataRead().nodeDeletedInTransaction(unaffected));
    assertTrue(tx.dataRead().nodeDeletedInTransaction(addedAndRemovedInTx));
    assertTrue(tx.dataRead().nodeDeletedInTransaction(deletedInTx));
  }
 }
