@Test void testHandleExceptionOnHasNext(){
  assertThrows(IllegalStateException.class,() -> Iterables.count(new ExceptionHandlingIterable(() -> new Iterator(){
    @Override public boolean hasNext(){
      throw new RuntimeException("exception on next");
    }
    @Override public Object next(){
      return null;
    }
    @Override public void remove(){
    }
  }
){
    @Override protected boolean exceptionOnHasNext(    Throwable t){
      rethrow(new IllegalStateException());
      return super.exceptionOnHasNext(t);
    }
  }
));
}
