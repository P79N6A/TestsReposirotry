@Test public void shouldDropUniquenessConstraintWhereConstraintRecordIsMissingAndIndexHasNoOwner() throws Exception {
  try (Transaction tx=db.beginTx()){
    db.schema().constraintFor(label).assertPropertyIsUnique(key).create();
    tx.success();
  }
   RecordStorageEngine storageEngine=db.getDependencyResolver().resolveDependency(RecordStorageEngine.class);
  SchemaStore schemaStore=storageEngine.testAccessNeoStores().getSchemaStore();
  SchemaRule constraintRule=single(filter(rule -> rule instanceof ConstraintRule,schemaStore.loadAllSchemaRules()));
  setSchemaRecordNotInUse(schemaStore,constraintRule.getId());
  SchemaRule indexRule=single(filter(rule -> rule instanceof StoreIndexDescriptor,schemaStore.loadAllSchemaRules()));
  setOwnerNull(schemaStore,(StoreIndexDescriptor)indexRule);
  storageEngine.loadSchemaCache();
  try (Transaction tx=db.beginTx()){
    db.schema().getConstraints(label).forEach(ConstraintDefinition::drop);
    db.schema().getIndexes(label).forEach(IndexDefinition::drop);
    tx.success();
  }
   try (Transaction ignore=db.beginTx()){
    assertFalse(db.schema().getConstraints().iterator().hasNext());
    assertFalse(db.schema().getIndexes().iterator().hasNext());
  }
 }
