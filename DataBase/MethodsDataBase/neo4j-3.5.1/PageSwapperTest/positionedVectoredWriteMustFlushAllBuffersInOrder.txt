@Test void positionedVectoredWriteMustFlushAllBuffersInOrder() throws Exception {
  File file=file("file");
  PageSwapperFactory factory=createSwapperFactory();
  PageSwapper swapper=createSwapperAndFile(factory,file,4);
  long pageA=createPage(4);
  long pageB=createPage(4);
  long pageC=createPage(4);
  long pageD=createPage(4);
  putInt(pageA,0,2);
  putInt(pageB,0,3);
  putInt(pageC,0,4);
  putInt(pageD,0,5);
  write(swapper,1,new long[]{pageA,pageB,pageC,pageD},0,4);
  long result=createPage(4);
  read(swapper,0,sizeOfAsInt(result),result);
  assertThat(getInt(result,0),is(0));
  putInt(result,0,0);
  assertThat(read(swapper,1,sizeOfAsInt(result),result),is(4L));
  assertThat(getInt(result,0),is(2));
  putInt(result,0,0);
  assertThat(read(swapper,2,sizeOfAsInt(result),result),is(4L));
  assertThat(getInt(result,0),is(3));
  putInt(result,0,0);
  assertThat(read(swapper,3,sizeOfAsInt(result),result),is(4L));
  assertThat(getInt(result,0),is(4));
  putInt(result,0,0);
  assertThat(read(swapper,4,sizeOfAsInt(result),result),is(4L));
  assertThat(getInt(result,0),is(5));
  putInt(result,0,0);
  assertThat(read(swapper,5,sizeOfAsInt(result),result),is(0L));
  assertThat(getInt(result,0),is(0));
}
