@Test public void shouldCloseIndexAndLabelScanSnapshots() throws Exception {
  LabelScanStore labelScanStore=mock(LabelScanStore.class);
  IndexingService indexingService=mock(IndexingService.class);
  ExplicitIndexProvider explicitIndexes=mock(ExplicitIndexProvider.class);
  when(explicitIndexes.allIndexProviders()).thenReturn(Collections.emptyList());
  DatabaseLayout databaseLayout=mock(DatabaseLayout.class);
  when(databaseLayout.metadataStore()).thenReturn(mock(File.class));
  LogFiles logFiles=mock(LogFiles.class);
  filesInStoreDirAre(databaseLayout,STANDARD_STORE_DIR_FILES,STANDARD_STORE_DIR_DIRECTORIES);
  StorageEngine storageEngine=mock(StorageEngine.class);
  NeoStoreFileListing fileListing=new NeoStoreFileListing(databaseLayout,logFiles,labelScanStore,indexingService,explicitIndexes,storageEngine);
  ResourceIterator<File> scanSnapshot=scanStoreFilesAre(labelScanStore,new String[]{"blah/scan.store","scan.more"});
  ResourceIterator<File> indexSnapshot=indexFilesAre(indexingService,new String[]{"schema/index/my.index"});
  ResourceIterator<StoreFileMetadata> result=fileListing.builder().excludeLogFiles().build();
  result.close();
  verify(scanSnapshot).close();
  verify(indexSnapshot).close();
}
