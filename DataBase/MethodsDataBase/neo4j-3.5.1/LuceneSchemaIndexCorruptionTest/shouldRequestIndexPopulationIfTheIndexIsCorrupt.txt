@Test void shouldRequestIndexPopulationIfTheIndexIsCorrupt(){
  long faultyIndexId=1;
  CorruptIndexException error=new CorruptIndexException("It's broken.","");
  LuceneIndexProvider provider=newFaultyIndexProvider(faultyIndexId,error);
  StoreIndexDescriptor descriptor=forSchema(forLabel(1,1),provider.getProviderDescriptor()).withId(faultyIndexId);
  InternalIndexState initialState=provider.getInitialState(descriptor);
  assertThat(initialState,equalTo(InternalIndexState.POPULATING));
  logProvider.assertAtLeastOnce(loggedException(error));
}
