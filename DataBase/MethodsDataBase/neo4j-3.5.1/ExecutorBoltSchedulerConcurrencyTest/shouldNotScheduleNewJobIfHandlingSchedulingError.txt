@Test public void shouldNotScheduleNewJobIfHandlingSchedulingError() throws Throwable {
  AtomicInteger handleSchedulingErrorCounter=new AtomicInteger(0);
  AtomicBoolean exitCondition=new AtomicBoolean();
  BoltConnection newConnection=newConnection(UUID.randomUUID().toString());
  doAnswer(newBlockingAnswer(handleSchedulingErrorCounter,exitCondition)).when(newConnection).handleSchedulingError(any());
  blockAllThreads();
  boltScheduler.created(newConnection);
  CompletableFuture.runAsync(() -> boltScheduler.enqueued(newConnection,Jobs.noop()));
  Predicates.awaitForever(() -> handleSchedulingErrorCounter.get() > 0,500,MILLISECONDS);
  afterExecuteEvent.countDown();
  afterExecuteBarrier.await();
  boltScheduler.enqueued(newConnection,Jobs.noop());
  exitCondition.set(true);
  assertEquals(1,handleSchedulingErrorCounter.get());
  verify(newConnection,never()).processNextBatch();
}
