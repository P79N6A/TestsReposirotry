@Test public void hasPropertiesShouldSeeNewlyCreatedPropertiesOnNewlyCreatedNode() throws Exception {
  try (Transaction tx=beginTransaction()){
    long node=tx.dataWrite().nodeCreate();
    try (NodeCursor cursor=tx.cursors().allocateNodeCursor();PropertyCursor props=tx.cursors().allocatePropertyCursor()){
      tx.dataRead().singleNode(node,cursor);
      assertTrue(cursor.next());
      assertFalse(hasProperties(cursor,props));
      tx.dataWrite().nodeSetProperty(node,tx.tokenWrite().propertyKeyGetOrCreateForName("prop"),stringValue("foo"));
      assertTrue(hasProperties(cursor,props));
    }
   }
 }
