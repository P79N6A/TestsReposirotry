@Test public void propertyTypeShouldBeTxStateAware() throws Exception {
  long node;
  try (Transaction tx=beginTransaction()){
    node=tx.dataWrite().nodeCreate();
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    try (NodeCursor nodes=tx.cursors().allocateNodeCursor();PropertyCursor properties=tx.cursors().allocatePropertyCursor()){
      tx.dataRead().singleNode(node,nodes);
      assertTrue(nodes.next());
      assertFalse(hasProperties(nodes,properties));
      int prop=tx.tokenWrite().propertyKeyGetOrCreateForName("prop");
      tx.dataWrite().nodeSetProperty(node,prop,stringValue("foo"));
      nodes.properties(properties);
      assertTrue(properties.next());
      assertThat(properties.propertyType(),equalTo(ValueGroup.TEXT));
    }
   }
 }
