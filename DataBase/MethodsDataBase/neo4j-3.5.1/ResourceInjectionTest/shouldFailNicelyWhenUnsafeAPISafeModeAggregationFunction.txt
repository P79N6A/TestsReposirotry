@Test public void shouldFailNicelyWhenUnsafeAPISafeModeAggregationFunction() throws Throwable {
  List<CallableUserAggregationFunction> procList=compiler.compileAggregationFunction(AggregationFunctionWithUnsafeAPI.class);
  verify(log).warn(notAvailableMessage("org.neo4j.kernel.impl.proc.listCoolPeople"));
  assertThat(procList.size(),equalTo(1));
  try {
    procList.get(0).create(new BasicContext()).update(new Object[]{});
    Object out=procList.get(0).create(new BasicContext()).result();
    fail();
  }
 catch (  ProcedureException e) {
    assertThat(e.getMessage(),notAvailableMessageMatcher("org.neo4j.kernel.impl.proc.listCoolPeople"));
  }
}
