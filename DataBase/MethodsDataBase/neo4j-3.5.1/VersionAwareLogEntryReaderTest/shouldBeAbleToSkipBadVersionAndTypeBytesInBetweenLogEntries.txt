@Test public void shouldBeAbleToSkipBadVersionAndTypeBytesInBetweenLogEntries() throws Exception {
  AcceptingInvalidLogEntryHandler invalidLogEntryHandler=new AcceptingInvalidLogEntryHandler();
  VersionAwareLogEntryReader<ReadableClosablePositionAwareChannel> reader=new VersionAwareLogEntryReader<>(new RecordStorageCommandReaderFactory(),invalidLogEntryHandler);
  InMemoryClosableChannel channel=new InMemoryClosableChannel(1_000);
  LogEntryWriter writer=new LogEntryWriter(channel.writer());
  long startTime=currentTimeMillis();
  long commitTime=startTime + 10;
  writer.writeStartEntry(1,2,startTime,3,new byte[0]);
  writer.writeCommitEntry(4,commitTime);
  channel.put((byte)127);
  channel.put((byte)126);
  channel.put((byte)125);
  long secondStartTime=startTime + 100;
  writer.writeStartEntry(1,2,secondStartTime,4,new byte[0]);
  LogEntryStart readStartEntry=reader.readLogEntry(channel.reader()).as();
  LogEntryCommit readCommitEntry=reader.readLogEntry(channel.reader()).as();
  LogEntryStart readSecondStartEntry=reader.readLogEntry(channel.reader()).as();
  assertEquals(1,readStartEntry.getMasterId());
  assertEquals(2,readStartEntry.getLocalId());
  assertEquals(startTime,readStartEntry.getTimeWritten());
  assertEquals(4,readCommitEntry.getTxId());
  assertEquals(commitTime,readCommitEntry.getTimeWritten());
  assertEquals(3,invalidLogEntryHandler.bytesSkipped);
  assertEquals(3,invalidLogEntryHandler.invalidEntryCalls);
  assertEquals(1,readSecondStartEntry.getMasterId());
  assertEquals(2,readSecondStartEntry.getLocalId());
  assertEquals(secondStartTime,readSecondStartEntry.getTimeWritten());
}
