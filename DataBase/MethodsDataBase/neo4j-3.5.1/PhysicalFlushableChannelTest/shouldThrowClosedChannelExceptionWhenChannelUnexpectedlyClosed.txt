@Test public void shouldThrowClosedChannelExceptionWhenChannelUnexpectedlyClosed() throws Exception {
  final File file=new File(directory.directory(),"file");
  StoreChannel storeChannel=fileSystemRule.get().open(file,OpenMode.READ_WRITE);
  PhysicalLogVersionedStoreChannel versionedStoreChannel=new PhysicalLogVersionedStoreChannel(storeChannel,1,(byte)-1);
  PhysicalFlushableChannel channel=new PhysicalFlushableChannel(versionedStoreChannel);
  storeChannel.close();
  channel.put((byte)0);
  try {
    channel.prepareForFlush();
    fail("Should have thrown exception");
  }
 catch (  ClosedChannelException e) {
  }
}
