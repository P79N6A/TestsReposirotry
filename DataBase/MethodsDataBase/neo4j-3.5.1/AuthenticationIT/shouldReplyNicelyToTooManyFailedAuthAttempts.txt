@Test public void shouldReplyNicelyToTooManyFailedAuthAttempts() throws Exception {
  startServerWithConfiguredUser();
  long timeout=System.currentTimeMillis() + 30_000;
  HTTP.Response response=null;
  while (System.currentTimeMillis() < timeout) {
    response=HTTP.withBasicAuth("neo4j","incorrect").POST(server.baseUri().resolve("authentication").toString(),HTTP.RawPayload.quotedJson("{'username':'neo4j', 'password':'something that is wrong'}"));
    if (response.status() == 429) {
      break;
    }
  }
  assertThat(response.status(),equalTo(429));
  JsonNode firstError=response.get("errors").get(0);
  assertThat(firstError.get("code").asText(),equalTo("Neo.ClientError.Security.AuthenticationRateLimit"));
  assertThat(firstError.get("message").asText(),equalTo("Too many failed authentication requests. Please wait 5 seconds and try again."));
}
