@Test public void shouldNotReportIndexInconsistenciesIfIndexIsFailed() throws Exception {
  DirectStoreAccess storeAccess=fixture.directStoreAccess();
  Iterator<StoreIndexDescriptor> rules=new SchemaStorage(storeAccess.nativeStores().getSchemaStore()).indexesGetAll();
  while (rules.hasNext()) {
    StoreIndexDescriptor rule=rules.next();
    IndexSamplingConfig samplingConfig=new IndexSamplingConfig(Config.defaults());
    IndexPopulator populator=storeAccess.indexes().lookup(rule.providerDescriptor()).getPopulator(rule,samplingConfig);
    populator.markAsFailed("Oh noes! I was a shiny index and then I was failed");
    populator.close(false);
  }
  for (  Long indexedNodeId : indexedNodes) {
    storeAccess.nativeStores().getNodeStore().updateRecord(notInUse(new NodeRecord(indexedNodeId,false,-1,-1)));
  }
  ConsistencySummaryStatistics stats=check();
  on(stats).verify(RecordType.LABEL_SCAN_DOCUMENT,2).verify(RecordType.COUNTS,3).andThatsAllFolks();
}
