@Test public void shouldCheckAllCollisionsFromUpdaterClose() throws Exception {
  populator=newPopulator();
  int iterations=228;
  for (int nodeId=0; nodeId < iterations; nodeId++) {
    addUpdate(populator,nodeId,1);
    when(nodePropertyAccessor.getNodePropertyValue(nodeId,PROPERTY_KEY_ID)).thenReturn(Values.of(nodeId));
  }
  addUpdate(populator,iterations,1);
  when(nodePropertyAccessor.getNodePropertyValue(iterations,PROPERTY_KEY_ID)).thenReturn(Values.of(1));
  try {
    populator.verifyDeferredConstraints(nodePropertyAccessor);
    fail("should have thrown exception");
  }
 catch (  IndexEntryConflictException conflict) {
    assertEquals(1,conflict.getExistingNodeId());
    assertEquals(Values.of(1),conflict.getSinglePropertyValue());
    assertEquals(iterations,conflict.getAddedNodeId());
  }
}
