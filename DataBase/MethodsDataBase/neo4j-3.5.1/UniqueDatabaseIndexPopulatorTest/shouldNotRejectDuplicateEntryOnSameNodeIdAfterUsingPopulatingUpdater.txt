@Test public void shouldNotRejectDuplicateEntryOnSameNodeIdAfterUsingPopulatingUpdater() throws Exception {
  populator=newPopulator();
  when(nodePropertyAccessor.getNodePropertyValue(1,PROPERTY_KEY_ID)).thenReturn(Values.of("value1"));
  IndexUpdater updater=populator.newPopulatingUpdater(nodePropertyAccessor);
  updater.process(add(1,schemaDescriptor,"value1"));
  updater.process(change(1,schemaDescriptor,"value1","value1"));
  updater.close();
  addUpdate(populator,2,"value2");
  addUpdate(populator,3,"value3");
  populator.verifyDeferredConstraints(nodePropertyAccessor);
  populator.close(true);
  assertEquals(asList(1L),getAllNodes(getDirectory(),"value1"));
  assertEquals(asList(2L),getAllNodes(getDirectory(),"value2"));
  assertEquals(asList(3L),getAllNodes(getDirectory(),"value3"));
}
