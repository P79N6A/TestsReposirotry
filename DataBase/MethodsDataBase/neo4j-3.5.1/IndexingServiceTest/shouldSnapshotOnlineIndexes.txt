@Test public void shouldSnapshotOnlineIndexes() throws Exception {
  int indexId=1;
  int indexId2=2;
  StoreIndexDescriptor rule1=storeIndex(indexId,2,3,PROVIDER_DESCRIPTOR);
  StoreIndexDescriptor rule2=storeIndex(indexId2,4,5,PROVIDER_DESCRIPTOR);
  IndexAccessor indexAccessor=mock(IndexAccessor.class);
  IndexingService indexing=newIndexingServiceWithMockedDependencies(mock(IndexPopulator.class),indexAccessor,new DataUpdates(),rule1,rule2);
  File theFile=new File("Blah");
  when(indexAccessor.snapshotFiles()).thenAnswer(newResourceIterator(theFile));
  when(indexProvider.getInitialState(rule1)).thenReturn(ONLINE);
  when(indexProvider.getInitialState(rule2)).thenReturn(ONLINE);
  when(storeView.indexSample(anyLong(),any(DoubleLongRegister.class))).thenReturn(newDoubleLongRegister(32L,32L));
  life.start();
  ResourceIterator<File> files=indexing.snapshotIndexFiles();
  assertThat(asCollection(files),equalTo(asCollection(iterator(theFile,theFile))));
}
