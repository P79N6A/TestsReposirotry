@Test public void failForceAllWhenOneOfTheIndexesFailToForce() throws IOException {
  IndexMapReference indexMapReference=new IndexMapReference();
  IndexProxy strangeIndexProxy=createIndexProxyMock(1);
  doThrow(new UncheckedIOException(new IOException("Can't force"))).when(strangeIndexProxy).force(any(IOLimiter.class));
  indexMapReference.modify(indexMap -> {
    IndexProxy validIndex=createIndexProxyMock(0);
    indexMap.putIndexProxy(validIndex);
    indexMap.putIndexProxy(validIndex);
    indexMap.putIndexProxy(strangeIndexProxy);
    indexMap.putIndexProxy(validIndex);
    indexMap.putIndexProxy(validIndex);
    return indexMap;
  }
);
  IndexingService indexingService=createIndexServiceWithCustomIndexMap(indexMapReference);
  expectedException.expectMessage("Unable to force");
  expectedException.expect(UnderlyingStorageException.class);
  indexingService.forceAll(IOLimiter.UNLIMITED);
}
