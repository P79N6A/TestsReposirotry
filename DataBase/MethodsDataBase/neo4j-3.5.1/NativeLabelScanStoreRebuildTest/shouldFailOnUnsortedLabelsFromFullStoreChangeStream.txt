@Test public void shouldFailOnUnsortedLabelsFromFullStoreChangeStream() throws Exception {
  PageCache pageCache=pageCacheRule.getPageCache(fileSystemRule.get());
  List<NodeLabelUpdate> existingData=new ArrayList<>();
  existingData.add(NodeLabelUpdate.labelChanges(1,new long[0],new long[]{2,1}));
  FullStoreChangeStream changeStream=asStream(existingData);
  NativeLabelScanStore nativeLabelScanStore=null;
  try {
    nativeLabelScanStore=new NativeLabelScanStore(pageCache,testDirectory.databaseLayout(),fileSystemRule.get(),changeStream,false,new Monitors(),immediate());
    nativeLabelScanStore.init();
    nativeLabelScanStore.start();
    fail("Expected native label scan store to fail on ");
  }
 catch (  IllegalArgumentException e) {
    assertThat(e.getMessage(),Matchers.containsString("unsorted label"));
    assertThat(e.getMessage(),Matchers.stringContainsInOrder(Iterables.asIterable("2","1")));
  }
 finally {
    if (nativeLabelScanStore != null) {
      nativeLabelScanStore.shutdown();
    }
  }
}
