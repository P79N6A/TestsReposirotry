@Test public void mustBeDirtyIfFailedDuringRebuild() throws Exception {
  PageCache pageCache=pageCacheRule.getPageCache(fileSystemRule.get());
  createDirtyIndex(pageCache);
  RecordingMonitor monitor=new RecordingMonitor();
  Monitors monitors=new Monitors();
  monitors.addMonitorListener(monitor);
  NativeLabelScanStore nativeLabelScanStore=new NativeLabelScanStore(pageCache,testDirectory.databaseLayout(),fileSystemRule.get(),EMPTY,false,monitors,immediate());
  nativeLabelScanStore.init();
  nativeLabelScanStore.start();
  assertTrue(monitor.notValid);
  assertTrue(monitor.rebuilding);
  assertTrue(monitor.rebuilt);
  nativeLabelScanStore.shutdown();
}
