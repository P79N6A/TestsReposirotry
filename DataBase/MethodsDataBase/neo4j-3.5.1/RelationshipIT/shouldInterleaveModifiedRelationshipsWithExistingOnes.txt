@Test public void shouldInterleaveModifiedRelationshipsWithExistingOnes() throws Exception {
  long refNode;
  long fromRefToOther1;
  long fromRefToOther2;
  int relType1;
  int relType2;
{
    Transaction transaction=newTransaction(AnonymousContext.writeToken());
    relType1=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type1");
    relType2=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type2");
    refNode=transaction.dataWrite().nodeCreate();
    long otherNode=transaction.dataWrite().nodeCreate();
    fromRefToOther1=transaction.dataWrite().relationshipCreate(refNode,relType1,otherNode);
    fromRefToOther2=transaction.dataWrite().relationshipCreate(refNode,relType2,otherNode);
    commit();
  }
{
    Transaction transaction=newTransaction(AnonymousContext.writeToken());
    transaction.dataWrite().relationshipDelete(fromRefToOther1);
    long endNode=transaction.dataWrite().nodeCreate();
    long localTxRel=transaction.dataWrite().relationshipCreate(refNode,relType1,endNode);
    assertRels(nodeGetRelationships(transaction,refNode,BOTH),fromRefToOther2,localTxRel);
    assertRelsInSeparateTx(refNode,BOTH,fromRefToOther1,fromRefToOther2);
    commit();
  }
}
