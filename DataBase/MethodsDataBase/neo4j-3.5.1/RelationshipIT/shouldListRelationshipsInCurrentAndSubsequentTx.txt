@Test public void shouldListRelationshipsInCurrentAndSubsequentTx() throws Exception {
  Transaction transaction=newTransaction(AnonymousContext.writeToken());
  int relType1=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type1");
  int relType2=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type2");
  long refNode=transaction.dataWrite().nodeCreate();
  long otherNode=transaction.dataWrite().nodeCreate();
  long fromRefToOther1=transaction.dataWrite().relationshipCreate(refNode,relType1,otherNode);
  long fromRefToOther2=transaction.dataWrite().relationshipCreate(refNode,relType2,otherNode);
  long fromOtherToRef=transaction.dataWrite().relationshipCreate(otherNode,relType1,refNode);
  long fromRefToRef=transaction.dataWrite().relationshipCreate(refNode,relType2,refNode);
  long endNode=transaction.dataWrite().nodeCreate();
  long fromRefToThird=transaction.dataWrite().relationshipCreate(refNode,relType2,endNode);
  assertRels(nodeGetRelationships(transaction,refNode,BOTH),fromRefToOther1,fromRefToOther2,fromRefToRef,fromRefToThird,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,BOTH,new int[]{relType1}),fromRefToOther1,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,BOTH,new int[]{relType1,relType2}),fromRefToOther1,fromRefToOther2,fromRefToRef,fromRefToThird,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,INCOMING),fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,INCOMING,new int[]{relType1}));
  assertRels(nodeGetRelationships(transaction,refNode,OUTGOING,new int[]{relType1,relType2}),fromRefToOther1,fromRefToOther2,fromRefToThird,fromRefToRef);
  commit();
  transaction=newTransaction();
  assertRels(nodeGetRelationships(transaction,refNode,BOTH),fromRefToOther1,fromRefToOther2,fromRefToRef,fromRefToThird,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,BOTH,new int[]{relType1}),fromRefToOther1,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,BOTH,new int[]{relType1,relType2}),fromRefToOther1,fromRefToOther2,fromRefToRef,fromRefToThird,fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,INCOMING),fromOtherToRef);
  assertRels(nodeGetRelationships(transaction,refNode,INCOMING,new int[]{relType1}));
  assertRels(nodeGetRelationships(transaction,refNode,OUTGOING,new int[]{relType1,relType2}),fromRefToOther1,fromRefToOther2,fromRefToThird,fromRefToRef);
  commit();
}
