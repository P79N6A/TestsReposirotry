@Test public void askingForNonExistantReltypeOnDenseNodeShouldNotCorruptState() throws Exception {
  long[] rels=new long[200];
  long refNode;
  int relTypeTheNodeDoesUse;
  int relTypeTheNodeDoesNotUse;
{
    Transaction transaction=newTransaction(AnonymousContext.writeToken());
    relTypeTheNodeDoesUse=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type1");
    relTypeTheNodeDoesNotUse=transaction.tokenWrite().relationshipTypeGetOrCreateForName("Type2");
    refNode=transaction.dataWrite().nodeCreate();
    long otherNode=transaction.dataWrite().nodeCreate();
    for (int i=0; i < rels.length; i++) {
      rels[i]=transaction.dataWrite().relationshipCreate(refNode,relTypeTheNodeDoesUse,otherNode);
    }
    commit();
  }
  Transaction transaction=newTransaction();
  assertRels(nodeGetRelationships(transaction,refNode,Direction.INCOMING,new int[]{relTypeTheNodeDoesNotUse}));
  assertRels(nodeGetRelationships(transaction,refNode,Direction.BOTH,new int[]{relTypeTheNodeDoesUse}),rels);
  commit();
}
