@Test public void shouldRunBuilderOnExistingStoreDir() throws Exception {
  File existingStoreDir=testDir.directory("existingStore");
  File storeDir=Config.defaults(GraphDatabaseSettings.data_directory,existingStoreDir.toPath().toString()).get(GraphDatabaseSettings.database_path);
  GraphDatabaseService db=new TestGraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  try {
    db.execute("create ()");
  }
  finally {
    db.shutdown();
  }
  try (ServerControls server=getTestServerBuilder(testDir.databaseDir()).copyFrom(existingStoreDir).newServer()){
    try (Transaction tx=server.graph().beginTx()){
      ResourceIterable<Node> allNodes=Iterables.asResourceIterable(server.graph().getAllNodes());
      assertTrue(Iterables.count(allNodes) > 0);
      server.graph().createNode();
      tx.success();
    }
   }
   db=new TestGraphDatabaseFactory().newEmbeddedDatabase(storeDir);
  try {
    try (Transaction tx=db.beginTx()){
      assertEquals(1,Iterables.count(db.getAllNodes()));
      tx.success();
    }
   }
  finally {
    db.shutdown();
  }
}
