@Test public void shouldPickFirstAvailableCandidateLongArrayWhenSomeDontHaveEnoughMemory(){
  NumberArrayFactory lowMemoryFactory=mock(NumberArrayFactory.class);
  doThrow(OutOfMemoryError.class).when(lowMemoryFactory).newLongArray(anyLong(),anyLong(),anyLong());
  NumberArrayFactory factory=new NumberArrayFactory.Auto(NO_MONITOR,lowMemoryFactory,NumberArrayFactory.HEAP);
  LongArray array=factory.newLongArray(KILO,-1);
  array.set(KILO - 10,12345);
  verify(lowMemoryFactory,times(1)).newLongArray(KILO,-1,0);
  assertTrue(array instanceof HeapLongArray);
  assertEquals(12345,array.get(KILO - 10));
}
