@Test public void shouldThrowOomOnNotEnoughMemory(){
  FailureMonitor monitor=new FailureMonitor();
  NumberArrayFactory lowMemoryFactory=mock(NumberArrayFactory.class);
  doThrow(OutOfMemoryError.class).when(lowMemoryFactory).newLongArray(anyLong(),anyLong(),anyLong());
  NumberArrayFactory factory=new NumberArrayFactory.Auto(monitor,lowMemoryFactory);
  try {
    factory.newLongArray(KILO,-1);
    fail("Should have thrown");
  }
 catch (  OutOfMemoryError e) {
    assertFalse(monitor.called);
  }
}
