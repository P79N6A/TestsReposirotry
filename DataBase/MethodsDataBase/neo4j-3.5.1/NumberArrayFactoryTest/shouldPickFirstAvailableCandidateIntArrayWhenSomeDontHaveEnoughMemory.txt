@Test public void shouldPickFirstAvailableCandidateIntArrayWhenSomeDontHaveEnoughMemory(){
  NumberArrayFactory lowMemoryFactory=mock(NumberArrayFactory.class);
  doThrow(OutOfMemoryError.class).when(lowMemoryFactory).newIntArray(anyLong(),anyInt(),anyLong());
  NumberArrayFactory factory=new NumberArrayFactory.Auto(NO_MONITOR,lowMemoryFactory,NumberArrayFactory.HEAP);
  IntArray array=factory.newIntArray(KILO,-1);
  array.set(KILO - 10,12345);
  verify(lowMemoryFactory,times(1)).newIntArray(KILO,-1,0);
  assertTrue(array instanceof HeapIntArray);
  assertEquals(12345,array.get(KILO - 10));
}
