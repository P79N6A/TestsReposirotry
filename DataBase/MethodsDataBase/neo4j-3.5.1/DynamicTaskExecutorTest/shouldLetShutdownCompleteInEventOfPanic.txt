@Test public void shouldLetShutdownCompleteInEventOfPanic() throws Exception {
  final TaskExecutor<Void> executor=new DynamicTaskExecutor<>(2,0,10,PARK,getClass().getSimpleName());
  IOException exception=new IOException("Failure");
  FailingTask failingTask=new FailingTask(exception);
  executor.submit(failingTask);
  failingTask.latch.await();
  try (OtherThreadExecutor<Void> closer=new OtherThreadExecutor<>("closer",null)){
    Future<Void> shutdown=closer.executeDontWait(state -> {
      executor.close();
      return null;
    }
);
    while (!closer.waitUntilWaiting().isAt(DynamicTaskExecutor.class,"close")) {
      Thread.sleep(10);
    }
    failingTask.latch.release();
    shutdown.get();
  }
 }
