@Test public void shouldNegotiateProtocolV3WhenClientSupportsBothV1V2AndV3() throws Exception {
  connection.connect(address).send(util.acceptedVersions(3,2,1,0)).send(util.chunk(new HelloMessage(map("user_agent",USER_AGENT))));
  assertThat(connection,eventuallyReceives(new byte[]{0,0,0,3}));
}
