@Test(timeout=5_000L) public void checkPointShouldLockOutWriter() throws Exception {
  CheckpointControlledMonitor monitor=new CheckpointControlledMonitor();
  try (GBPTree<MutableLong,MutableLong> index=index().with(monitor).build()){
    long key=10;
    try (Writer<MutableLong,MutableLong> writer=index.writer()){
      writer.put(new MutableLong(key),new MutableLong(key));
    }
     monitor.enabled=true;
    Future<?> checkpoint=executor.submit(throwing(() -> index.checkpoint(UNLIMITED)));
    monitor.barrier.awaitUninterruptibly();
    Future<?> writerClose=executor.submit(throwing(() -> index.writer().close()));
    shouldWait(writerClose);
    monitor.barrier.release();
    writerClose.get();
    checkpoint.get();
  }
 }
