@Test public void treeMustBeDirtyAfterCleanerDiedOnClose() throws Throwable {
  makeDirty();
  AtomicBoolean blockOnNextIO=new AtomicBoolean();
  Barrier.Control control=new Barrier.Control();
  PageCache pageCache=pageCacheThatBlockWhenToldTo(control,blockOnNextIO);
  ControlledRecoveryCleanupWorkCollector collector=new ControlledRecoveryCleanupWorkCollector();
  collector.init();
  Future<List<CleanupJob>> cleanJob;
  try (GBPTree<MutableLong,MutableLong> ignored=index(pageCache).with(collector).build()){
    blockOnNextIO.set(true);
    cleanJob=executor.submit(startAndReturnStartedJobs(collector));
    control.await();
  }
   control.release();
  assertFailedDueToUnmappedFile(cleanJob);
  MonitorDirty monitor=new MonitorDirty();
  try (GBPTree<MutableLong,MutableLong> ignored=index().with(monitor).build()){
    assertFalse(monitor.cleanOnStart());
  }
 }
