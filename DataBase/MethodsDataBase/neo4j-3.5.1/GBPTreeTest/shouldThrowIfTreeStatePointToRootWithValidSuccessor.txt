@Test public void shouldThrowIfTreeStatePointToRootWithValidSuccessor() throws Exception {
  try (PageCache specificPageCache=createPageCache(DEFAULT_PAGE_SIZE)){
    try (GBPTree<MutableLong,MutableLong> ignore=index(specificPageCache).build()){
    }
     try (PagedFile pagedFile=specificPageCache.map(indexFile,specificPageCache.pageSize());PageCursor cursor=pagedFile.io(0,PF_SHARED_WRITE_LOCK)){
      Pair<TreeState,TreeState> treeStates=TreeStatePair.readStatePages(cursor,IdSpace.STATE_PAGE_A,IdSpace.STATE_PAGE_B);
      TreeState newestState=TreeStatePair.selectNewestValidState(treeStates);
      long rootId=newestState.rootId();
      long stableGeneration=newestState.stableGeneration();
      long unstableGeneration=newestState.unstableGeneration();
      TreeNode.goTo(cursor,"root",rootId);
      TreeNode.setSuccessor(cursor,42,stableGeneration + 1,unstableGeneration + 1);
    }
     try (GBPTree<MutableLong,MutableLong> index=index(specificPageCache).build()){
      try (Writer<MutableLong,MutableLong> ignored=index.writer()){
        fail("Expected to throw because root pointed to by tree state should have a valid successor.");
      }
     }
 catch (    TreeInconsistencyException e) {
      assertThat(e.getMessage(),containsString(PointerChecking.WRITER_TRAVERSE_OLD_STATE_MESSAGE));
    }
  }
 }
