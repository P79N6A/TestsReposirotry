@Test public void indexMustBeDirtyWhenCrashedWithChangesSinceLastCheckpoint() throws Exception {
  try (EphemeralFileSystemAbstraction ephemeralFs=new EphemeralFileSystemAbstraction()){
    ephemeralFs.mkdirs(indexFile.getParentFile());
    PageCache pageCache=pageCacheRule.getPageCache(ephemeralFs);
    EphemeralFileSystemAbstraction snapshot;
    try (GBPTree<MutableLong,MutableLong> index=index(pageCache).build()){
      insert(index,0,1);
      snapshot=ephemeralFs.snapshot();
    }
     pageCache.close();
    MonitorDirty monitorDirty=new MonitorDirty();
    pageCache=pageCacheRule.getPageCache(snapshot);
    try (GBPTree<MutableLong,MutableLong> ignored=index(pageCache).with(monitorDirty).build()){
    }
     assertFalse("Expected to be dirty on start after crash",monitorDirty.cleanOnStart());
  }
 }
