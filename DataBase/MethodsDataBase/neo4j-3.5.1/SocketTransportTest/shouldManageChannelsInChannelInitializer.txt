@Test void shouldManageChannelsInChannelInitializer(){
  NetworkConnectionTracker connectionTracker=mock(NetworkConnectionTracker.class);
  SocketTransport socketTransport=newSocketTransport(connectionTracker,NO_THROTTLE);
  EmbeddedChannel channel=new EmbeddedChannel(socketTransport.channelInitializer());
  ArgumentCaptor<TrackedNetworkConnection> captor=ArgumentCaptor.forClass(TrackedNetworkConnection.class);
  verify(connectionTracker).add(captor.capture());
  verify(connectionTracker,never()).remove(any());
  channel.close();
  verify(connectionTracker).remove(captor.getValue());
}
