@Test public void shouldPopulateAndUpdate() throws Exception {
  withPopulator(indexProvider.getPopulator(descriptor,indexSamplingConfig),p -> p.add(updates(valueSet1)));
  try (IndexAccessor accessor=indexProvider.getOnlineAccessor(descriptor,indexSamplingConfig)){
    try (IndexUpdater updater=accessor.newUpdater(IndexUpdateMode.ONLINE)){
      List<IndexEntryUpdate<?>> updates=updates(valueSet2);
      for (      IndexEntryUpdate<?> update : updates) {
        updater.process(update);
      }
    }
     try (IndexReader reader=new QueryResultComparingIndexReader(accessor.newReader())){
      int propertyKeyId=descriptor.schema().getPropertyId();
      for (      NodeAndValue entry : Iterables.concat(valueSet1,valueSet2)) {
        NodeValueIterator nodes=new NodeValueIterator();
        reader.query(nodes,IndexOrder.NONE,false,IndexQuery.exact(propertyKeyId,entry.value));
        assertEquals(entry.nodeId,nodes.next());
        assertFalse(nodes.hasNext());
      }
    }
   }
 }
