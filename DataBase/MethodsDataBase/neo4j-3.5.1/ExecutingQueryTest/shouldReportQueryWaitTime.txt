@Test public void shouldReportQueryWaitTime(){
  query.compilationCompleted(new CompilerInfo("the-planner","the-runtime",emptyList()),null);
  query.waitsForQuery(subQuery);
  clock.forward(5,TimeUnit.SECONDS);
  QuerySnapshot snapshot=query.snapshot();
  assertEquals(5_000_000L,snapshot.waitTimeMicros());
  assertEquals("waiting",snapshot.status());
  assertThat(snapshot.resourceInformation(),CoreMatchers.<Map<String,Object>>allOf(hasEntry("waitTimeMillis",5_000L),hasEntry("queryId","query-2")));
  clock.forward(1,TimeUnit.SECONDS);
  query.waitsForQuery(null);
  clock.forward(2,TimeUnit.SECONDS);
  snapshot=query.snapshot();
  assertEquals(6_000_000L,snapshot.waitTimeMicros());
  assertEquals("running",snapshot.status());
}
