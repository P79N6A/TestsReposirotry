@Test public void shouldTransitionBetweenStates(){
  assertEquals("planning",query.snapshot().status());
  query.compilationCompleted(new CompilerInfo("the-planner","the-runtime",emptyList()),null);
  assertEquals("running",query.snapshot().status());
  try (LockWaitEvent event=lock("NODE",17)){
    assertEquals("waiting",query.snapshot().status());
  }
   assertEquals("running",query.snapshot().status());
  query.waitsForQuery(subQuery);
  assertEquals("waiting",query.snapshot().status());
  query.waitsForQuery(null);
  assertEquals("running",query.snapshot().status());
}
