@Test public void twoUncleanInARow() throws Exception {
  File databaseDir=testDirectory.databaseDir();
  try (EphemeralFileSystemAbstraction snapshot=produceUncleanStore(fs.get(),databaseDir)){
    try (EphemeralFileSystemAbstraction snapshot2=produceUncleanStore(snapshot,databaseDir)){
      GraphDatabaseAPI db=(GraphDatabaseAPI)new TestGraphDatabaseFactory().setFileSystem(produceUncleanStore(snapshot2,databaseDir)).newImpermanentDatabase(databaseDir);
      assertThat(properties(db),inTx(db,hasProperty("prop").withValue("Some value")));
      db.shutdown();
    }
   }
 }
