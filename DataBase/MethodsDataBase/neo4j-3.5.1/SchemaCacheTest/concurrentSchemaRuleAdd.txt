@Test public void concurrentSchemaRuleAdd() throws Throwable {
  SchemaCache cache=newSchemaCache();
  Race race=new Race();
  int indexNumber=10;
  for (int i=0; i < indexNumber; i++) {
    int id=i;
    race.addContestant(() -> cache.addSchemaRule(newIndexRule(id,id,id)));
  }
  race.go();
  assertEquals(indexNumber,Iterables.count(cache.indexDescriptors()));
  for (int labelId=0; labelId < indexNumber; labelId++) {
    assertEquals(1,Iterators.count(cache.indexDescriptorsForLabel(labelId)));
  }
  for (int propertyId=0; propertyId < indexNumber; propertyId++) {
    assertEquals(1,Iterators.count(cache.indexesByProperty(propertyId)));
  }
}
