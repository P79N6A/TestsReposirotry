@Documented("Add node to index.\n" + "\n" + "Associates a node with the given key/value pair in the given index.\n"+ "\n"+ "NOTE: Spaces in the URI have to be encoded as +%20+.\n"+ "\n"+ "CAUTION: This does *not* overwrite previous entries. If you index the\n"+ "same key/value/item combination twice, two index entries are created. To\n"+ "do update-type operations, you need to delete the old entry before adding\n"+ "a new one.") @Test public void shouldAddToIndex() throws Exception {
  final String indexName=indexes.newInstance();
  final String key="some-key";
  final String value="some value";
  long nodeId=createNode();
  gen().expectedStatus(201).payload(JsonHelper.createJsonFrom(generateNodeIndexCreationPayload(key,value,functionalTestHelper.nodeUri(nodeId)))).post(functionalTestHelper.indexNodeUri(indexName));
  JaxRsResponse response=RestRequest.req().get(functionalTestHelper.indexNodeUri(indexName,key,URIHelper.encode(value)));
  String entity=response.getEntity();
  Collection<?> hits=(Collection<?>)JsonHelper.readJson(entity);
  assertEquals(1,hits.size());
}
