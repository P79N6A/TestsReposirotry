@Test public void shouldCreateIndexInAnotherTransaction() throws Exception {
  StubKernel kernel=new StubKernel();
  IndexProxy indexProxy=mock(IndexProxy.class);
  IndexingService indexingService=mock(IndexingService.class);
  when(indexingService.getIndexProxy(INDEX_ID)).thenReturn(indexProxy);
  when(indexingService.getIndexProxy(descriptor)).thenReturn(indexProxy);
  when(indexProxy.getDescriptor()).thenReturn(index.withId(INDEX_ID).withoutCapabilities());
  NodePropertyAccessor nodePropertyAccessor=mock(NodePropertyAccessor.class);
  ConstraintIndexCreator creator=new ConstraintIndexCreator(() -> kernel,indexingService,nodePropertyAccessor,logProvider);
  long indexId=creator.createUniquenessConstraintIndex(createTransaction(),descriptor,getDefaultProvider());
  assertEquals(INDEX_ID,indexId);
  verify(schemaRead).indexGetCommittedId(indexReference);
  verify(schemaRead).index(descriptor);
  verifyNoMoreInteractions(schemaRead);
  verify(indexProxy).awaitStoreScanCompleted();
}
