@Test public void shouldRePlanAfterDataChangesFromAnEmptyDatabase() throws Exception {
  TestMonitor monitor=new TestMonitor();
  db.resolveDependency(Monitors.class).addMonitorListener(monitor);
  createIndex();
  executeDistantFriendsCountQuery(USERS);
  long replanTime=System.currentTimeMillis() + 1_800;
  createData(0,USERS,CONNECTIONS);
  while (System.currentTimeMillis() < replanTime) {
    Thread.sleep(100);
  }
  monitor.reset();
  executeDistantFriendsCountQuery(USERS);
  assertEquals("Query should have been replanned.",1,monitor.discards.get());
  assertThat("Replan should have occurred after TTL",monitor.waitTime.get(),greaterThanOrEqualTo(1L));
}
