@Test public void shouldAllowManyLabelsAndPropertyCursor() throws Exception {
  int propertyCount=10;
  int labelCount=15;
  GraphDatabaseAPI db=dbRule.getGraphDatabaseAPI();
  Node node;
  try (Transaction tx=db.beginTx()){
    node=db.createNode();
    for (int i=0; i < propertyCount; i++) {
      node.setProperty("foo" + i,"bar");
    }
    for (int i=0; i < labelCount; i++) {
      node.addLabel(label("label" + i));
    }
    tx.success();
  }
   Set<Integer> seenProperties=new HashSet<>();
  Set<Integer> seenLabels=new HashSet<>();
  try (Transaction tx=db.beginTx()){
    DependencyResolver resolver=db.getDependencyResolver();
    ThreadToStatementContextBridge bridge=resolver.resolveDependency(ThreadToStatementContextBridge.class);
    KernelTransaction ktx=bridge.getKernelTransactionBoundToThisThread(true);
    try (NodeCursor nodes=ktx.cursors().allocateNodeCursor();PropertyCursor propertyCursor=ktx.cursors().allocatePropertyCursor()){
      ktx.dataRead().singleNode(node.getId(),nodes);
      while (nodes.next()) {
        nodes.properties(propertyCursor);
        while (propertyCursor.next()) {
          seenProperties.add(propertyCursor.propertyKey());
        }
        LabelSet labels=nodes.labels();
        for (int i=0; i < labels.numberOfLabels(); i++) {
          seenLabels.add(labels.label(i));
        }
      }
    }
     tx.success();
  }
   assertEquals(propertyCount,seenProperties.size());
  assertEquals(labelCount,seenLabels.size());
}
