@Test void shouldMoveToFailedStateOnBegin_fail() throws Throwable {
  BoltStateMachineV3 machine=newStateMachine();
  machine.process(newHelloMessage(),nullResponseHandler());
  BoltResponseRecorder recorder=new BoltResponseRecorder();
  BeginMessage beginMessage=mock(BeginMessage.class);
  when(beginMessage.bookmark()).thenThrow(new RuntimeException("Fail"));
  machine.process(beginMessage,recorder);
  assertThat(recorder.nextResponse(),failedWithStatus(Status.General.UnknownError));
  assertThat(machine.state(),instanceOf(FailedState.class));
}
