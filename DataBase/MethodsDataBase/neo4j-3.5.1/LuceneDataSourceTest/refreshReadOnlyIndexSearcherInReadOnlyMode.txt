@Test public void refreshReadOnlyIndexSearcherInReadOnlyMode() throws Exception {
  IndexIdentifier indexIdentifier=identifier("foo");
  prepareIndexesByIdentifiers(indexIdentifier);
  stopDataSource();
  Config readOnlyConfig=Config.defaults(readOnlyConfig());
  dataSource=life.add(getLuceneDataSource(readOnlyConfig));
  IndexReference indexSearcher=dataSource.getIndexSearcher(indexIdentifier);
  IndexReference indexSearcher2=dataSource.getIndexSearcher(indexIdentifier);
  IndexReference indexSearcher3=dataSource.getIndexSearcher(indexIdentifier);
  IndexReference indexSearcher4=dataSource.getIndexSearcher(indexIdentifier);
  assertSame("Refreshed read only searcher should be the same.",indexSearcher,indexSearcher2);
  assertSame("Refreshed read only searcher should be the same.",indexSearcher2,indexSearcher3);
  assertSame("Refreshed read only searcher should be the same.",indexSearcher3,indexSearcher4);
}
