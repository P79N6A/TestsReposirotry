@Test(expected=IllegalStateException.class) public void createIdGeneratorMustRefuseOverwritingExistingFile() throws IOException {
  IdGeneratorImpl.createGenerator(fs,idGeneratorFile(),0,false);
  IdGenerator idGenerator=new IdGeneratorImpl(fs,idGeneratorFile(),1008,1000,false,IdType.NODE,() -> 0L);
  try {
    IdGeneratorImpl.createGenerator(fs,idGeneratorFile(),0,true);
  }
  finally {
    closeIdGenerator(idGenerator);
    StoreChannel fileChannel=fs.open(idGeneratorFile(),OpenMode.READ_WRITE);
    ByteBuffer buffer=ByteBuffer.allocate(9);
    fileChannel.readAll(buffer);
    buffer.flip();
    assertEquals((byte)0,buffer.get());
    assertEquals(0L,buffer.getLong());
    buffer.flip();
    int readCount=fileChannel.read(buffer);
    if (readCount != -1 && readCount != 0) {
      fail("Id generator header not ok read 9 + " + readCount + " bytes from file");
    }
    fileChannel.close();
    File file=idGeneratorFile();
    if (file.exists()) {
      assertTrue(file.delete());
    }
  }
}
