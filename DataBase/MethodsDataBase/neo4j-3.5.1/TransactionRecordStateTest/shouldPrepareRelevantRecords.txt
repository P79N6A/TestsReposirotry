@Test public void shouldPrepareRelevantRecords() throws Exception {
  PrepareTrackingRecordFormats format=new PrepareTrackingRecordFormats(Standard.LATEST_RECORD_FORMATS);
  NeoStores neoStores=neoStoresRule.builder().with(format).with(GraphDatabaseSettings.dense_node_threshold.name(),"1").build();
  TransactionRecordState state=newTransactionRecordState(neoStores);
  state.nodeCreate(0);
  state.relCreate(0,0,0,0);
  state.relCreate(1,0,0,0);
  state.relCreate(2,0,0,0);
  List<StorageCommand> commands=new ArrayList<>();
  state.extractCommands(commands);
  int nodes=0;
  int rels=0;
  int groups=0;
  for (  StorageCommand command : commands) {
    if (command instanceof NodeCommand) {
      assertTrue(format.node().prepared(((NodeCommand)command).getAfter()));
      nodes++;
    }
 else     if (command instanceof RelationshipCommand) {
      assertTrue(format.relationship().prepared(((RelationshipCommand)command).getAfter()));
      rels++;
    }
 else     if (command instanceof RelationshipGroupCommand) {
      assertTrue(format.relationshipGroup().prepared(((RelationshipGroupCommand)command).getAfter()));
      groups++;
    }
  }
  assertEquals(1,nodes);
  assertEquals(3,rels);
  assertEquals(1,groups);
}
