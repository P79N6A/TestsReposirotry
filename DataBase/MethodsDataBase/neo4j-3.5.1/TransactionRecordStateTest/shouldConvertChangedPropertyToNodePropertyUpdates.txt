@Test public void shouldConvertChangedPropertyToNodePropertyUpdates() throws Exception {
  NeoStores neoStores=neoStoresRule.builder().build();
  int nodeId=0;
  TransactionRecordState recordState=newTransactionRecordState(neoStores);
  recordState.nodeCreate(nodeId);
  recordState.nodeAddProperty(nodeId,propertyId1,value1);
  recordState.nodeAddProperty(nodeId,propertyId2,value2);
  apply(neoStores,transactionRepresentationOf(recordState));
  Value newValue1=Values.of("new");
  Value newValue2=Values.of("new 2");
  recordState=newTransactionRecordState(neoStores);
  recordState.nodeChangeProperty(nodeId,propertyId1,newValue1);
  recordState.nodeChangeProperty(nodeId,propertyId2,newValue2);
  Iterable<EntityUpdates> indexUpdates=indexUpdatesOf(neoStores,recordState);
  EntityUpdates expected=EntityUpdates.forEntity(nodeId).changed(propertyId1,value1,newValue1).changed(propertyId2,value2,newValue2).build();
  assertEquals(expected,Iterables.single(indexUpdates));
}
