@Test public void shouldConvertMixedLabelRemovalAndRemovePropertyToNodePropertyUpdates() throws Exception {
  NeoStores neoStores=neoStoresRule.builder().build();
  long nodeId=0;
  TransactionRecordState recordState=newTransactionRecordState(neoStores);
  recordState.nodeCreate(nodeId);
  recordState.nodeAddProperty(nodeId,propertyId1,value1);
  addLabelsToNode(recordState,nodeId,bothLabelIds);
  apply(neoStores,recordState);
  recordState=newTransactionRecordState(neoStores);
  recordState.nodeRemoveProperty(nodeId,propertyId1);
  removeLabelsFromNode(recordState,nodeId,secondLabelId);
  Iterable<EntityUpdates> indexUpdates=indexUpdatesOf(neoStores,recordState);
  EntityUpdates expected=EntityUpdates.forEntity(nodeId).withTokens(bothLabelIds).withTokensAfter(oneLabelId).removed(propertyId1,value1).build();
  assertEquals(expected,Iterables.single(indexUpdates));
}
