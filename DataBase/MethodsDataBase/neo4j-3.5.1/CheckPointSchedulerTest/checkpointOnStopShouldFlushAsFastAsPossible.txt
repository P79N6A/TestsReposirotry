@Test(timeout=10_000) public void checkpointOnStopShouldFlushAsFastAsPossible() throws Throwable {
  CheckableIOLimiter ioLimiter=new CheckableIOLimiter();
  CountDownLatch checkPointerLatch=new CountDownLatch(1);
  WaitUnlimitedCheckPointer checkPointer=new WaitUnlimitedCheckPointer(ioLimiter,checkPointerLatch);
  CheckPointScheduler scheduler=new CheckPointScheduler(checkPointer,ioLimiter,jobScheduler,0L,health);
  scheduler.start();
  Future<?> checkpointerStarter=executor.submit(jobScheduler::runJob);
  checkPointerLatch.await();
  scheduler.stop();
  checkpointerStarter.get();
  assertTrue("Checkpointer should be created.",checkPointer.isCheckpointCreated());
  assertTrue("Limiter should be enabled in the end.",ioLimiter.isLimited());
}
