@Test public void shouldNotSeeRelationshipDeletedInTransaction() throws Exception {
  long n1, n2, r;
  try (Transaction tx=beginTransaction()){
    n1=tx.dataWrite().nodeCreate();
    n2=tx.dataWrite().nodeCreate();
    int label=tx.tokenWrite().relationshipTypeGetOrCreateForName("R");
    r=tx.dataWrite().relationshipCreate(n1,label,n2);
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    tx.dataWrite().relationshipDelete(r);
    try (NodeCursor node=tx.cursors().allocateNodeCursor();RelationshipTraversalCursor relationship=tx.cursors().allocateRelationshipTraversalCursor()){
      tx.dataRead().singleNode(n1,node);
      assertTrue("should access node",node.next());
      node.allRelationships(relationship);
      assertFalse("should not find relationship",relationship.next());
    }
     tx.success();
  }
 }
