@Test public void groupCursorShouldNewRelationshipBetweenAlreadyConnectedDenseNodes() throws Exception {
  long start;
  long end;
  long existingRelationship;
  int type, bulk;
  try (Transaction tx=beginTransaction()){
    Write write=tx.dataWrite();
    start=write.nodeCreate();
    end=write.nodeCreate();
    type=tx.tokenWrite().relationshipTypeGetOrCreateForName("R");
    existingRelationship=write.relationshipCreate(start,type,end);
    bulk=tx.tokenWrite().relationshipTypeGetOrCreateForName("BULK");
    for (int i=0; i < 100; i++) {
      write.relationshipCreate(start,bulk,write.nodeCreate());
    }
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    Write write=tx.dataWrite();
    long newRelationship=write.relationshipCreate(start,type,write.nodeCreate());
    try (NodeCursor node=tx.cursors().allocateNodeCursor();RelationshipTraversalCursor traversal=tx.cursors().allocateRelationshipTraversalCursor();RelationshipGroupCursor group=tx.cursors().allocateRelationshipGroupCursor()){
      Read read=tx.dataRead();
      read.singleNode(start,node);
      assertTrue(node.next());
      assertTrue(node.isDense());
      node.relationships(group);
      while (group.next()) {
        int t=group.type();
        if (t == type) {
          assertEquals(2,group.outgoingCount());
          assertEquals(0,group.incomingCount());
          assertEquals(0,group.loopCount());
          assertRelationships(OUT,group,traversal,existingRelationship,newRelationship);
        }
 else         if (t == bulk) {
          assertEquals(bulk,group.type());
          assertEquals(100,group.outgoingCount());
          assertEquals(0,group.incomingCount());
          assertEquals(0,group.loopCount());
        }
 else {
          fail(t + "  is not the type you're looking for ");
        }
      }
    }
   }
 }
