@Test public void propertyTypeShouldBeTxStateAware() throws Exception {
  long relationship;
  try (Transaction tx=beginTransaction()){
    Write write=tx.dataWrite();
    int token=tx.tokenWrite().relationshipTypeGetOrCreateForName("R");
    relationship=write.relationshipCreate(write.nodeCreate(),token,write.nodeCreate());
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    try (RelationshipScanCursor relationships=tx.cursors().allocateRelationshipScanCursor();PropertyCursor properties=tx.cursors().allocatePropertyCursor()){
      tx.dataRead().singleRelationship(relationship,relationships);
      assertTrue(relationships.next());
      assertFalse(hasProperties(relationships,tx));
      int prop=tx.tokenWrite().propertyKeyGetOrCreateForName("prop");
      tx.dataWrite().relationshipSetProperty(relationship,prop,stringValue("foo"));
      relationships.properties(properties);
      assertTrue(properties.next());
      assertThat(properties.propertyType(),equalTo(ValueGroup.TEXT));
    }
   }
 }
