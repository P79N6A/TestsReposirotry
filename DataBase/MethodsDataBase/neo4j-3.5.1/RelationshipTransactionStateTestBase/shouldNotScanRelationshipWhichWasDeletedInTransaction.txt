@Test public void shouldNotScanRelationshipWhichWasDeletedInTransaction() throws Exception {
  final int nRelationshipsInStore=5 + 1 + 5;
  int type;
  long n1, n2, r;
  try (Transaction tx=beginTransaction()){
    n1=tx.dataWrite().nodeCreate();
    n2=tx.dataWrite().nodeCreate();
    type=tx.tokenWrite().relationshipTypeGetOrCreateForName("R");
    relateNTimes(5,type,n1,n2,tx);
    r=tx.dataWrite().relationshipCreate(n1,type,n2);
    relateNTimes(5,type,n1,n2,tx);
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    assertTrue("should delete relationship",tx.dataWrite().relationshipDelete(r));
    try (RelationshipScanCursor relationship=tx.cursors().allocateRelationshipScanCursor()){
      tx.dataRead().allRelationshipsScan(relationship);
      assertCountRelationships(relationship,nRelationshipsInStore - 1,n1,type,n2);
    }
     tx.success();
  }
 }
