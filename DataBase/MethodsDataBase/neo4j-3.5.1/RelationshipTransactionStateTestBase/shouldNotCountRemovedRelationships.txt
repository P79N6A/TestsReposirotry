@Test public void shouldNotCountRemovedRelationships() throws Exception {
  int relationshipId;
  long relationship;
  try (Transaction tx=beginTransaction()){
    Write write=tx.dataWrite();
    relationshipId=tx.tokenWrite().relationshipTypeGetOrCreateForName("R");
    relationship=write.relationshipCreate(write.nodeCreate(),relationshipId,write.nodeCreate());
    tx.success();
  }
   try (Transaction tx=beginTransaction()){
    Write write=tx.dataWrite();
    write.relationshipDelete(relationship);
    long countsTxState=tx.dataRead().countsForRelationship(-1,relationshipId,-1);
    long countsNoTxState=tx.dataRead().countsForRelationshipWithoutTxState(-1,relationshipId,-1);
    assertEquals(0,countsTxState);
    assertEquals(1,countsNoTxState);
  }
 }
