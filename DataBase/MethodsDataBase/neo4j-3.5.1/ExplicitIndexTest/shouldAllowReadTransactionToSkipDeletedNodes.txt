@Test public void shouldAllowReadTransactionToSkipDeletedNodes(){
  String indexName="index";
  Index<Node> nodeIndex;
  Node node;
  String key="key";
  String value="value";
  try (Transaction tx=db.beginTx()){
    nodeIndex=db.index().forNodes(indexName);
    node=db.createNode();
    nodeIndex.add(node,key,value);
    tx.success();
  }
   try (Transaction tx=db.beginTx()){
    node.delete();
    tx.success();
  }
   try (Transaction tx=db.beginTransaction(explicit,new SecurityContext(ANONYMOUS,READ))){
    IndexHits<Node> hits=nodeIndex.get(key,value);
    assertNull(hits.getSingle());
  }
 }
