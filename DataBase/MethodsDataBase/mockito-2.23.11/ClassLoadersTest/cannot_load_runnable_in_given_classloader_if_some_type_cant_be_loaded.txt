@Test public void cannot_load_runnable_in_given_classloader_if_some_type_cant_be_loaded() throws Exception {
  final ClassLoader cl=isolatedClassLoader().withCurrentCodeSourceUrls().withPrivateCopyOf(ClassLoadersTest.class.getPackage().getName()).without(AClass.class.getName()).build();
  try {
    ClassLoaders.using(cl).execute(new Runnable(){
      @Override public void run(){
        AClass cant_be_found=new AClass();
      }
    }
);
    Assertions.fail("should have raised a ClassNotFoundException");
  }
 catch (  IllegalStateException ise) {
    assertThat(ise).hasCauseInstanceOf(NoClassDefFoundError.class).hasMessageContaining("AClass");
  }
}
