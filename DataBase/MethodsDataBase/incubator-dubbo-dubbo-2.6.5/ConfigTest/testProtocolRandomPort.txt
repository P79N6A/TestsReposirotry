@Test public void testProtocolRandomPort() throws Exception {
  ServiceConfig<DemoService> demoService=null;
  ServiceConfig<HelloService> helloService=null;
  ApplicationConfig application=new ApplicationConfig();
  application.setName("test-protocol-random-port");
  RegistryConfig registry=new RegistryConfig();
  registry.setAddress("N/A");
  ProtocolConfig protocol=new ProtocolConfig();
  protocol.setName("dubbo");
  protocol.setPort(-1);
  demoService=new ServiceConfig<DemoService>();
  demoService.setInterface(DemoService.class);
  demoService.setRef(new DemoServiceImpl());
  demoService.setApplication(application);
  demoService.setRegistry(registry);
  demoService.setProtocol(protocol);
  helloService=new ServiceConfig<HelloService>();
  helloService.setInterface(HelloService.class);
  helloService.setRef(new HelloServiceImpl());
  helloService.setApplication(application);
  helloService.setRegistry(registry);
  helloService.setProtocol(protocol);
  try {
    demoService.export();
    helloService.export();
    Assert.assertEquals(demoService.getExportedUrls().get(0).getPort(),helloService.getExportedUrls().get(0).getPort());
  }
  finally {
    unexportService(demoService);
    unexportService(helloService);
  }
}
