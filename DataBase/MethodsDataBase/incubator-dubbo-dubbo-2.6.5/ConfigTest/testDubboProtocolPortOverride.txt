@Test public void testDubboProtocolPortOverride() throws Exception {
  String dubboPort=System.getProperty("dubbo.protocol.dubbo.port");
  int port=55555;
  System.setProperty("dubbo.protocol.dubbo.port",String.valueOf(port));
  ServiceConfig<DemoService> service=null;
  try {
    ApplicationConfig application=new ApplicationConfig();
    application.setName("dubbo-protocol-port-override");
    RegistryConfig registry=new RegistryConfig();
    registry.setAddress("N/A");
    ProtocolConfig protocol=new ProtocolConfig();
    service=new ServiceConfig<DemoService>();
    service.setInterface(DemoService.class);
    service.setRef(new DemoServiceImpl());
    service.setApplication(application);
    service.setRegistry(registry);
    service.setProtocol(protocol);
    service.export();
    Assert.assertEquals(port,service.getExportedUrls().get(0).getPort());
  }
  finally {
    if (StringUtils.isNotEmpty(dubboPort)) {
      System.setProperty("dubbo.protocol.dubbo.port",dubboPort);
    }
    if (service != null) {
      service.unexport();
    }
  }
}
