/** 
 * Events do not pass through the thread pool and execute directly on the IO
 */
@SuppressWarnings("deprecation") @Ignore("Heartbeat is processed in HeartbeatHandler not WrappedChannelHandler.") @Test public void test_Received_Event_invoke_direct() throws RemotingException {
  handler=new ConnectionOrderedChannelHandler(new BizChannelHander(false),url);
  ThreadPoolExecutor executor=(ThreadPoolExecutor)getField(handler,"SHARED_EXECUTOR",1);
  executor.shutdown();
  executor=(ThreadPoolExecutor)getField(handler,"executor",1);
  executor.shutdown();
  Request req=new Request();
  req.setHeartbeat(true);
  final AtomicInteger count=new AtomicInteger(0);
  handler.received(new MockedChannel(){
    @Override public void send(    Object message) throws RemotingException {
      Assert.assertEquals("response.heartbeat",true,((Response)message).isHeartbeat());
      count.incrementAndGet();
    }
  }
,req);
  Assert.assertEquals("channel.send must be invoke",1,count.get());
}
