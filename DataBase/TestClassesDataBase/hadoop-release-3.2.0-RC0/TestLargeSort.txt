public class TestLargeSort {
  MiniMRClientCluster cluster;
  @Before public void setup() throws IOException {
    Configuration conf=new YarnConfiguration();
    cluster=MiniMRClientClusterFactory.create(this.getClass(),2,conf);
    cluster.start();
  }
  @After public void cleanup() throws IOException {
    if (cluster != null) {
      cluster.stop();
      cluster=null;
    }
  }
  @Test public void testLargeSort() throws Exception {
    String[] args=new String[0];
    int[] ioSortMbs={128,256,1536};
    for (    int ioSortMb : ioSortMbs) {
      Configuration conf=new Configuration(cluster.getConfig());
      conf.setInt(MRJobConfig.MAP_MEMORY_MB,2048);
      conf.setInt(MRJobConfig.IO_SORT_MB,ioSortMb);
      conf.setInt(LargeSorter.NUM_MAP_TASKS,1);
      conf.setInt(LargeSorter.MBS_PER_MAP,ioSortMb);
      assertEquals("Large sort failed for " + ioSortMb,0,ToolRunner.run(conf,new LargeSorter(),args));
    }
  }
}
