/** 
 * A codec which just slows down the saving of the image significantly by sleeping a few milliseconds on every write. This makes it easy to catch the standby in the middle of saving a checkpoint.
 */
public static class SlowCodec extends GzipCodec {
  @Override public CompressionOutputStream createOutputStream(  OutputStream out) throws IOException {
    CompressionOutputStream ret=super.createOutputStream(out);
    CompressionOutputStream spy=Mockito.spy(ret);
    Mockito.doAnswer(new GenericTestUtils.SleepAnswer(5)).when(spy).write(Mockito.<byte[]>any(),Mockito.anyInt(),Mockito.anyInt());
    return spy;
  }
}
