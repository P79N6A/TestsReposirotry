/** 
 * S3A tests through the  {@link FileContext} API.
 */
public class ITestS3A {
  private FileContext fc;
  @Rule public final Timeout testTimeout=new Timeout(90000);
  @Before public void setUp() throws Exception {
    Configuration conf=new Configuration();
    fc=S3ATestUtils.createTestFileContext(conf);
  }
  @After public void tearDown() throws Exception {
    if (fc != null) {
      fc.delete(getTestPath(),true);
    }
  }
  protected Path getTestPath(){
    return S3ATestUtils.createTestPath(new Path("/tests3afc"));
  }
  @Test public void testS3AStatus() throws Exception {
    FsStatus fsStatus=fc.getFsStatus(null);
    assertNotNull(fsStatus);
    assertTrue("Used capacity should be positive: " + fsStatus.getUsed(),fsStatus.getUsed() >= 0);
    assertTrue("Remaining capacity should be positive: " + fsStatus.getRemaining(),fsStatus.getRemaining() >= 0);
    assertTrue("Capacity should be positive: " + fsStatus.getCapacity(),fsStatus.getCapacity() >= 0);
  }
  @Test public void testS3ACreateFileInSubDir() throws Exception {
    Path dirPath=getTestPath();
    fc.mkdir(dirPath,FileContext.DIR_DEFAULT_PERM,true);
    Path filePath=new Path(dirPath,"file");
    try (FSDataOutputStream file=fc.create(filePath,EnumSet.of(CreateFlag.CREATE))){
      file.write(666);
    }
   }
}
