/** 
 * Capture output printed to  {@link System#err}. <p> Usage: <pre> try (SystemErrCapturer capture = new SystemErrCapturer()) { ... // Call capture.getOutput() to get the output string } </pre> TODO: Add lambda support once Java 8 is common. <pre> SystemErrCapturer.withCapture(capture -> { ... }) </pre>
 */
public static class SystemErrCapturer implements AutoCloseable {
  final private ByteArrayOutputStream bytes;
  final private PrintStream bytesPrintStream;
  final private PrintStream oldErr;
  public SystemErrCapturer(){
    bytes=new ByteArrayOutputStream();
    bytesPrintStream=new PrintStream(bytes);
    oldErr=System.err;
    System.setErr(new TeePrintStream(oldErr,bytesPrintStream));
  }
  public String getOutput(){
    return bytes.toString();
  }
  @Override public void close() throws Exception {
    IOUtils.closeQuietly(bytesPrintStream);
    System.setErr(oldErr);
  }
}
