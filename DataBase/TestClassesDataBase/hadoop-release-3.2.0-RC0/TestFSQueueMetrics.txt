/** 
 * The test class for  {@link FSQueueMetrics}.
 */
public class TestFSQueueMetrics {
  private static final Configuration CONF=new Configuration();
  private MetricsSystem ms;
  @Before public void setUp(){
    ms=new MetricsSystemImpl();
    QueueMetrics.clearQueueMetrics();
  }
  /** 
 * Test if the metric scheduling policy is set correctly.
 */
  @Test public void testSchedulingPolicy(){
    String queueName="single";
    FSQueueMetrics metrics=FSQueueMetrics.forQueue(ms,queueName,null,false,CONF);
    metrics.setSchedulingPolicy("drf");
    checkSchedulingPolicy(queueName,"drf");
    metrics.setSchedulingPolicy("fair");
    checkSchedulingPolicy(queueName,"fair");
  }
  private void checkSchedulingPolicy(  String queueName,  String policy){
    MetricsSource queueSource=TestQueueMetrics.queueSource(ms,queueName);
    MetricsCollectorImpl collector=new MetricsCollectorImpl();
    queueSource.getMetrics(collector,true);
    MetricsRecords.assertTag(collector.getRecords().get(0),"SchedulingPolicy",policy);
  }
}
