/** 
 * A mapper that increases the JVM's heap usage to a target value configured  via  {@link MemoryLoaderMapper#TARGET_VALUE} using a {@link MemoryLoader}.
 */
@SuppressWarnings({"deprecation","unchecked"}) static class MemoryLoaderMapper extends MapReduceBase implements Mapper<WritableComparable,Writable,WritableComparable,Writable> {
  static final String TARGET_VALUE="map.memory-loader.target-value";
  private static MemoryLoader loader=null;
  public void map(  WritableComparable key,  Writable val,  OutputCollector<WritableComparable,Writable> output,  Reporter reporter) throws IOException {
    assertNotNull("Mapper not configured!",loader);
    loader.load();
    output.collect(key,val);
  }
  public void configure(  JobConf conf){
    loader=new MemoryLoader(conf.getLong(TARGET_VALUE,-1));
  }
}
