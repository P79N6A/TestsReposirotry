/** 
 * Unit tests for ZookeeperFederationStateStore.
 */
public class TestZookeeperFederationStateStore extends FederationStateStoreBaseTest {
  private static final Logger LOG=LoggerFactory.getLogger(TestZookeeperFederationStateStore.class);
  /** 
 * Zookeeper test server. 
 */
  private static TestingServer curatorTestingServer;
  private static CuratorFramework curatorFramework;
  @Before public void before() throws IOException, YarnException {
    try {
      curatorTestingServer=new TestingServer();
      curatorTestingServer.start();
      String connectString=curatorTestingServer.getConnectString();
      curatorFramework=CuratorFrameworkFactory.builder().connectString(connectString).retryPolicy(new RetryNTimes(100,100)).build();
      curatorFramework.start();
      Configuration conf=new YarnConfiguration();
      conf.set(CommonConfigurationKeys.ZK_ADDRESS,connectString);
      setConf(conf);
    }
 catch (    Exception e) {
      LOG.error("Cannot initialize ZooKeeper store",e);
      throw new IOException(e);
    }
    super.before();
  }
  @After public void after() throws Exception {
    super.after();
    curatorFramework.close();
    try {
      curatorTestingServer.stop();
    }
 catch (    IOException e) {
    }
  }
  @Override protected FederationStateStore createStateStore(){
    Configuration conf=new Configuration();
    super.setConf(conf);
    return new ZookeeperFederationStateStore();
  }
}
