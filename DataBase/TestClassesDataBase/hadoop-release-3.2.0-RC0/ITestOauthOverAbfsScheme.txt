/** 
 * Test Oauth fail fast when uri scheme is incorrect.
 */
public class ITestOauthOverAbfsScheme extends AbstractAbfsIntegrationTest {
  public ITestOauthOverAbfsScheme() throws Exception {
    Assume.assumeTrue("ITestOauthOverAbfsScheme is skipped because auth type is not OAuth",getAuthType() == AuthType.OAuth);
  }
  @Test public void testOauthOverSchemeAbfs() throws Exception {
    String[] urlWithoutScheme=this.getTestUrl().split(":");
    String fsUrl;
    fsUrl=FileSystemUriSchemes.ABFS_SCHEME + ":" + urlWithoutScheme[1];
    Configuration config=getRawConfiguration();
    config.set(CommonConfigurationKeysPublic.FS_DEFAULT_NAME_KEY,fsUrl.toString());
    AbfsClient client=this.getFileSystem(config).getAbfsClient();
    Field baseUrlField=AbfsClient.class.getDeclaredField("baseUrl");
    baseUrlField.setAccessible(true);
    String url=((URL)baseUrlField.get(client)).toString();
    Assume.assumeTrue("OAuth authentication over scheme abfs must use HTTPS",url.startsWith(FileSystemUriSchemes.HTTPS_SCHEME));
  }
}
