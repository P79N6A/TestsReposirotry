public static class WaitForItHandler implements EventHandler<Event> {
  private Event event=null;
  @Override public synchronized void handle(  Event event){
    this.event=event;
    notifyAll();
  }
  public synchronized Event getAndClearEvent() throws InterruptedException {
    if (event == null) {
      final long waitTime=5000;
      long waitStartTime=Time.monotonicNow();
      while (event == null && Time.monotonicNow() - waitStartTime < waitTime) {
        wait(waitTime);
      }
    }
    Event e=event;
    event=null;
    return e;
  }
}
