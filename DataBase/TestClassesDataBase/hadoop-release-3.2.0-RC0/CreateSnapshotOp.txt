/** 
 * createSnapshot operaiton 
 */
class CreateSnapshotOp extends AtMostOnceOp {
  private String snapshotPath;
  private final String dir;
  private final String snapshotName;
  CreateSnapshotOp(  DFSClient client,  String dir,  String snapshotName){
    super("createSnapshot",client);
    this.dir=dir;
    this.snapshotName=snapshotName;
  }
  @Override void prepare() throws Exception {
    final Path dirPath=new Path(dir);
    if (!dfs.exists(dirPath)) {
      dfs.mkdirs(dirPath);
      dfs.allowSnapshot(dirPath);
    }
  }
  @Override void invoke() throws Exception {
    this.snapshotPath=client.createSnapshot(dir,snapshotName);
  }
  @Override boolean checkNamenodeBeforeReturn() throws Exception {
    final Path sPath=SnapshotTestHelper.getSnapshotRoot(new Path(dir),snapshotName);
    boolean snapshotCreated=dfs.exists(sPath);
    for (int i=0; i < CHECKTIMES && !snapshotCreated; i++) {
      Thread.sleep(1000);
      snapshotCreated=dfs.exists(sPath);
    }
    return snapshotCreated;
  }
  @Override Object getResult(){
    return snapshotPath;
  }
}
