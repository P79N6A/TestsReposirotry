/** 
 * Test for error messages coming from SDK.
 */
public class ITestFileSystemOperationExceptionMessage extends AbstractWasbTestWithTimeout {
  @Test public void testAnonymouseCredentialExceptionMessage() throws Throwable {
    Configuration conf=AzureBlobStorageTestAccount.createTestConfiguration();
    CloudStorageAccount account=AzureBlobStorageTestAccount.createTestAccount(conf);
    AzureTestUtils.assume("No test account",account != null);
    String testStorageAccount=verifyWasbAccountNameInConfig(conf);
    conf=new Configuration();
    conf.set("fs.AbstractFileSystem.wasb.impl","org.apache.hadoop.fs.azure.Wasb");
    conf.set("fs.azure.skip.metrics","true");
    String testContainer=UUID.randomUUID().toString();
    String wasbUri=String.format("wasb://%s@%s",testContainer,testStorageAccount);
    try (NativeAzureFileSystem filesystem=new NativeAzureFileSystem()){
      filesystem.initialize(new URI(wasbUri),conf);
      fail("Expected an exception, got " + filesystem);
    }
 catch (    Exception ex) {
      Throwable innerException=ex.getCause();
      while (innerException != null && !(innerException instanceof AzureException)) {
        innerException=innerException.getCause();
      }
      if (innerException != null) {
        GenericTestUtils.assertExceptionContains(String.format(NO_ACCESS_TO_CONTAINER_MSG,testStorageAccount,testContainer),ex);
      }
 else {
        fail("No inner azure exception");
      }
    }
  }
}
