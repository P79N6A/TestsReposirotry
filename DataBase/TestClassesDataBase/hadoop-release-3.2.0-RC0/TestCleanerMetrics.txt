public class TestCleanerMetrics {
  Configuration conf=new Configuration();
  CleanerMetrics cleanerMetrics;
  @Before public void init(){
    cleanerMetrics=CleanerMetrics.getInstance();
  }
  @Test public void testMetricsOverMultiplePeriods(){
    simulateACleanerRun();
    assertMetrics(4,4,1,1);
    simulateACleanerRun();
    assertMetrics(4,8,1,2);
  }
  public void simulateACleanerRun(){
    cleanerMetrics.reportCleaningStart();
    cleanerMetrics.reportAFileProcess();
    cleanerMetrics.reportAFileDelete();
    cleanerMetrics.reportAFileProcess();
    cleanerMetrics.reportAFileProcess();
  }
  void assertMetrics(  int proc,  int totalProc,  int del,  int totalDel){
    assertEquals("Processed files in the last period are not measured correctly",proc,cleanerMetrics.getProcessedFiles());
    assertEquals("Total processed files are not measured correctly",totalProc,cleanerMetrics.getTotalProcessedFiles());
    assertEquals("Deleted files in the last period are not measured correctly",del,cleanerMetrics.getDeletedFiles());
    assertEquals("Total deleted files are not measured correctly",totalDel,cleanerMetrics.getTotalDeletedFiles());
  }
}
