public class TestLdapGroupsMappingBase {
  @Mock private DirContext context;
  @Mock private NamingEnumeration<SearchResult> userNames;
  @Mock private NamingEnumeration<SearchResult> groupNames;
  @Mock private NamingEnumeration<SearchResult> parentGroupNames;
  @Mock private SearchResult userSearchResult;
  @Mock private Attributes attributes;
  @Spy private LdapGroupsMapping groupsMapping=new LdapGroupsMapping();
  private String[] testGroups=new String[]{"group1","group2"};
  private String[] testParentGroups=new String[]{"group1","group2","group1_1"};
  @Before public void setupMocksBase() throws NamingException {
    MockitoAnnotations.initMocks(this);
    DirContext ctx=getContext();
    doReturn(ctx).when(groupsMapping).getDirContext();
    when(ctx.search(Mockito.anyString(),Mockito.anyString(),Mockito.any(Object[].class),Mockito.any(SearchControls.class))).thenReturn(userNames);
    when(userNames.hasMoreElements()).thenReturn(true);
    SearchResult groupSearchResult=mock(SearchResult.class);
    when(groupNames.hasMoreElements()).thenReturn(true,true,false);
    when(groupNames.nextElement()).thenReturn(groupSearchResult);
    Attribute group1Attr=new BasicAttribute("cn");
    group1Attr.add(testGroups[0]);
    Attributes group1Attrs=new BasicAttributes();
    group1Attrs.put(group1Attr);
    Attribute group2Attr=new BasicAttribute("cn");
    group2Attr.add(testGroups[1]);
    Attributes group2Attrs=new BasicAttributes();
    group2Attrs.put(group2Attr);
    when(groupSearchResult.getAttributes()).thenReturn(group1Attrs,group2Attrs);
    when(getUserNames().nextElement()).thenReturn(getUserSearchResult());
    when(getUserSearchResult().getAttributes()).thenReturn(getAttributes());
    SearchResult parentGroupResult=mock(SearchResult.class);
    when(parentGroupNames.hasMoreElements()).thenReturn(true,false);
    when(parentGroupNames.nextElement()).thenReturn(parentGroupResult);
    Attribute parentGroup1Attr=new BasicAttribute("cn");
    parentGroup1Attr.add(testParentGroups[2]);
    Attributes parentGroup1Attrs=new BasicAttributes();
    parentGroup1Attrs.put(parentGroup1Attr);
    when(parentGroupResult.getAttributes()).thenReturn(parentGroup1Attrs);
    when(parentGroupResult.getNameInNamespace()).thenReturn("CN=some_group,DC=test,DC=com");
  }
  protected DirContext getContext(){
    return context;
  }
  protected NamingEnumeration<SearchResult> getUserNames(){
    return userNames;
  }
  protected NamingEnumeration<SearchResult> getGroupNames(){
    return groupNames;
  }
  protected SearchResult getUserSearchResult(){
    return userSearchResult;
  }
  protected Attributes getAttributes(){
    return attributes;
  }
  protected LdapGroupsMapping getGroupsMapping(){
    return groupsMapping;
  }
  protected String[] getTestGroups(){
    return testGroups;
  }
  protected NamingEnumeration getParentGroupNames(){
    return parentGroupNames;
  }
  protected String[] getTestParentGroups(){
    return testParentGroups;
  }
}
