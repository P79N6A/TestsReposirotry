public static class CustomSpeculator extends DefaultSpeculator {
  public CustomSpeculator(  Configuration conf,  AppContext context){
    super(conf,context);
    verifyClassLoader(getClass());
  }
  /** 
 * Verifies that the class was loaded by the job classloader if it is in the context of the MRAppMaster, and if not throws an exception to fail the job.
 */
  private void verifyClassLoader(  Class<?> cls){
    for (    StackTraceElement e : new Throwable().getStackTrace()) {
      if (e.getClassName().equals(MRAppMaster.class.getName()) && !(cls.getClassLoader() instanceof ApplicationClassLoader)) {
        throw new ExceptionInInitializerError("incorrect classloader used");
      }
    }
  }
}
