/** 
 * This class is used to capture data send to Ganglia servers. Initial attempt was to use mockito to mock and capture but while testing figured out that mockito is keeping the reference to the byte array and since the sink code reuses the byte array hence all the captured byte arrays were pointing to one instance.
 */
private class MockDatagramSocket extends DatagramSocket {
  private List<byte[]> capture;
  /** 
 * @throws SocketException
 */
  public MockDatagramSocket() throws SocketException {
    capture=new ArrayList<byte[]>();
  }
  @Override public synchronized void send(  DatagramPacket p) throws IOException {
    byte[] bytes=new byte[p.getLength()];
    System.arraycopy(p.getData(),p.getOffset(),bytes,0,p.getLength());
    capture.add(bytes);
  }
  /** 
 * @return the captured byte arrays
 */
  synchronized List<byte[]> getCapturedSend(){
    return capture;
  }
}
