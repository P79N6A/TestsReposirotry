/** 
 * Test for JSON based HostsFileReader.
 */
public class TestCombinedHostsFileReader {
  static final String HOSTSTESTDIR=GenericTestUtils.getTestDir().getAbsolutePath();
  private final File newFile=new File(HOSTSTESTDIR,"dfs.hosts.new.json");
  static final String TESTCACHEDATADIR=System.getProperty("test.cache.data","build/test/cache");
  private final File jsonFile=new File(TESTCACHEDATADIR,"dfs.hosts.json");
  private final File legacyFile=new File(TESTCACHEDATADIR,"legacy.dfs.hosts.json");
  @Before public void setUp() throws Exception {
  }
  @After public void tearDown() throws Exception {
    newFile.delete();
  }
  @Test public void testLoadLegacyJsonFile() throws Exception {
    DatanodeAdminProperties[] all=CombinedHostsFileReader.readFile(legacyFile.getAbsolutePath());
    assertEquals(7,all.length);
  }
  @Test public void testLoadExistingJsonFile() throws Exception {
    DatanodeAdminProperties[] all=CombinedHostsFileReader.readFile(jsonFile.getAbsolutePath());
    assertEquals(7,all.length);
  }
  @Test public void testEmptyCombinedHostsFileReader() throws Exception {
    FileWriter hosts=new FileWriter(newFile);
    hosts.write("");
    hosts.close();
    DatanodeAdminProperties[] all=CombinedHostsFileReader.readFile(newFile.getAbsolutePath());
    assertEquals(0,all.length);
  }
}
