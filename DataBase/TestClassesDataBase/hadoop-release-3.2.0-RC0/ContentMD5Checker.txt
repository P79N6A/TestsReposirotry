/** 
 * Connection inspector to check that MD5 fields for content is set/not set as expected.
 */
private static class ContentMD5Checker extends StorageEvent<ResponseReceivedEvent> {
  private final boolean expectMd5;
  public ContentMD5Checker(  boolean expectMd5){
    this.expectMd5=expectMd5;
  }
  @Override public void eventOccurred(  ResponseReceivedEvent eventArg){
    HttpURLConnection connection=(HttpURLConnection)eventArg.getConnectionObject();
    if (isGetRange(connection)) {
      checkObtainedMd5(connection.getHeaderField(Constants.HeaderConstants.CONTENT_MD5));
    }
 else     if (isPutBlock(connection)) {
      checkObtainedMd5(connection.getRequestProperty(Constants.HeaderConstants.CONTENT_MD5));
    }
  }
  private void checkObtainedMd5(  String obtainedMd5){
    if (expectMd5) {
      assertNotNull(obtainedMd5);
    }
 else {
      assertNull("Expected no MD5, found: " + obtainedMd5,obtainedMd5);
    }
  }
  private static boolean isPutBlock(  HttpURLConnection connection){
    return connection.getRequestMethod().equals("PUT") && connection.getURL().getQuery() != null && connection.getURL().getQuery().contains("blockid");
  }
  private static boolean isGetRange(  HttpURLConnection connection){
    return connection.getRequestMethod().equals("GET") && connection.getHeaderField(Constants.HeaderConstants.STORAGE_RANGE_HEADER) != null;
  }
}
