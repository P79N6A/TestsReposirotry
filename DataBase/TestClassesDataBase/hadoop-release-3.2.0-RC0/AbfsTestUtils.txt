/** 
 * Some Utils for ABFS tests.
 */
public final class AbfsTestUtils extends AbstractAbfsIntegrationTest {
  private static final Logger LOG=LoggerFactory.getLogger(AbfsTestUtils.class);
  public AbfsTestUtils() throws Exception {
    super();
  }
  /** 
 * If unit tests were interrupted and crushed accidentally, the test containers won't be deleted. In that case, dev can use this tool to list and delete all test containers. By default, all test container used in E2E tests sharing same prefix: "abfs-testcontainer-"
 */
  public void checkContainers() throws Throwable {
    Assume.assumeTrue(this.getAuthType() == AuthType.SharedKey);
    int count=0;
    CloudStorageAccount storageAccount=AzureBlobStorageTestAccount.createTestAccount();
    CloudBlobClient blobClient=storageAccount.createCloudBlobClient();
    Iterable<CloudBlobContainer> containers=blobClient.listContainers(TEST_CONTAINER_PREFIX);
    for (    CloudBlobContainer container : containers) {
      count++;
      LOG.info("Container {}, URI {}",container.getName(),container.getUri());
    }
    LOG.info("Found {} test containers",count);
  }
  public void deleteContainers() throws Throwable {
    Assume.assumeTrue(this.getAuthType() == AuthType.SharedKey);
    int count=0;
    CloudStorageAccount storageAccount=AzureBlobStorageTestAccount.createTestAccount();
    CloudBlobClient blobClient=storageAccount.createCloudBlobClient();
    Iterable<CloudBlobContainer> containers=blobClient.listContainers(TEST_CONTAINER_PREFIX);
    for (    CloudBlobContainer container : containers) {
      LOG.info("Container {} URI {}",container.getName(),container.getUri());
      if (container.deleteIfExists()) {
        count++;
      }
    }
    LOG.info("Deleted {} test containers",count);
  }
}
