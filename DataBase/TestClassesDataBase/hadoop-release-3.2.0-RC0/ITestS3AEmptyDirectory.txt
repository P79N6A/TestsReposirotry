/** 
 * Tests which exercise treatment of empty/non-empty directories.
 */
public class ITestS3AEmptyDirectory extends AbstractS3ATestBase {
  @Test public void testDirectoryBecomesEmpty() throws Exception {
    S3AFileSystem fs=getFileSystem();
    Path dir=path("testEmptyDir");
    Path child=path("testEmptyDir/dir2");
    mkdirs(child);
    S3AFileStatus status=getS3AFileStatus(fs,dir);
    assertEmptyDirectory(false,status);
    assertDeleted(child,false);
    status=getS3AFileStatus(fs,dir);
    assertEmptyDirectory(true,status);
  }
  private static void assertEmptyDirectory(  boolean isEmpty,  S3AFileStatus s){
    String msg="dir is empty";
    Tristate expected=Tristate.fromBool(isEmpty);
    assertEquals(msg,expected,s.isEmptyDirectory());
  }
  @Test public void testDirectoryBecomesNonEmpty() throws Exception {
    S3AFileSystem fs=getFileSystem();
    Path dir=path("testEmptyDir");
    mkdirs(dir);
    S3AFileStatus status=getS3AFileStatus(fs,dir);
    assertEmptyDirectory(true,status);
    ContractTestUtils.touch(fs,path("testEmptyDir/file1"));
    status=getS3AFileStatus(fs,dir);
    assertEmptyDirectory(false,status);
  }
  private S3AFileStatus getS3AFileStatus(  S3AFileSystem fs,  Path p) throws IOException {
    return fs.innerGetFileStatus(p,true);
  }
}
