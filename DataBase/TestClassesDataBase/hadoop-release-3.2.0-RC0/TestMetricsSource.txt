/** 
 * Thread safe source: stores a key value pair. Allows thread safe key-value pair reads/writes.
 */
private static class TestMetricsSource implements MetricsSource {
  private String key="key0";
  private int val=0;
  synchronized String getKey(){
    return key;
  }
  synchronized void setKV(  final String newKey,  final int newVal){
    key=newKey;
    val=newVal;
  }
  @Override public void getMetrics(  MetricsCollector collector,  boolean all){
    MetricsRecordBuilder rb=collector.addRecord("TestMetricsSource").setContext("test");
synchronized (this) {
      rb.addGauge(info(key,"TestMetricsSource key"),val);
    }
  }
}
