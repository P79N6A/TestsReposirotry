/** 
 * A reducer that increases the JVM's heap usage to a target value configured  via  {@link MemoryLoaderReducer#TARGET_VALUE} using a {@link MemoryLoader}.
 */
@SuppressWarnings({"deprecation","unchecked"}) static class MemoryLoaderReducer extends MapReduceBase implements Reducer<WritableComparable,Writable,WritableComparable,Writable> {
  static final String TARGET_VALUE="reduce.memory-loader.target-value";
  private static MemoryLoader loader=null;
  public void reduce(  WritableComparable key,  Iterator<Writable> val,  OutputCollector<WritableComparable,Writable> output,  Reporter reporter) throws IOException {
    assertNotNull("Reducer not configured!",loader);
    loader.load();
    output.collect(key,key);
  }
  public void configure(  JobConf conf){
    loader=new MemoryLoader(conf.getLong(TARGET_VALUE,-1));
  }
}
