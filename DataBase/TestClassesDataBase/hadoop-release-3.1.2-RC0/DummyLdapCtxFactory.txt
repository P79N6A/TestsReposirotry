/** 
 * Ldap Context Factory implementation to be used for testing to check contexts are requested for the expected LDAP server URLs etc.
 */
public static class DummyLdapCtxFactory implements InitialContextFactory {
  private static DirContext contextToReturn;
  private static String expectedLdapUrl;
  public DummyLdapCtxFactory(){
  }
  protected static void setContextToReturn(  DirContext ctx){
    contextToReturn=ctx;
  }
  protected static void setExpectedLdapUrl(  String url){
    expectedLdapUrl=url;
  }
  @Override public Context getInitialContext(  Hashtable<?,?> env) throws NamingException {
    if (expectedLdapUrl != null) {
      String actualLdapUrl=(String)env.get(Context.PROVIDER_URL);
      assertEquals(expectedLdapUrl,actualLdapUrl);
    }
    if (contextToReturn == null) {
      InitialContextFactory defaultFactory=null;
      try {
        defaultFactory=LDAP_CTX_FACTORY_CLASS_DEFAULT.newInstance();
      }
 catch (      ReflectiveOperationException e) {
        fail("Could not initialize the default factory");
      }
      return defaultFactory.getInitialContext(env);
    }
    return contextToReturn;
  }
}
