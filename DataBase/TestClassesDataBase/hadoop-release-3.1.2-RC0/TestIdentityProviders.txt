public class TestIdentityProviders {
public class FakeSchedulable implements Schedulable {
    public FakeSchedulable(){
    }
    public UserGroupInformation getUserGroupInformation(){
      try {
        return UserGroupInformation.getCurrentUser();
      }
 catch (      IOException e) {
        return null;
      }
    }
    @Override public int getPriorityLevel(){
      return 0;
    }
  }
  @Test public void testPluggableIdentityProvider(){
    Configuration conf=new Configuration();
    conf.set(CommonConfigurationKeys.IPC_IDENTITY_PROVIDER_KEY,"org.apache.hadoop.ipc.UserIdentityProvider");
    List<IdentityProvider> providers=conf.getInstances(CommonConfigurationKeys.IPC_IDENTITY_PROVIDER_KEY,IdentityProvider.class);
    assertTrue(providers.size() == 1);
    IdentityProvider ip=providers.get(0);
    assertNotNull(ip);
    assertEquals(ip.getClass(),UserIdentityProvider.class);
  }
  @Test public void testUserIdentityProvider() throws IOException {
    UserIdentityProvider uip=new UserIdentityProvider();
    String identity=uip.makeIdentity(new FakeSchedulable());
    UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
    String username=ugi.getUserName();
    assertEquals(username,identity);
  }
}
