/** 
 * Test the S3Guard CLI entry point.
 */
public class TestS3GuardCLI extends Assert {
  /** 
 * Run a S3GuardTool command from a varags list.
 * @param args argument list
 * @return the return code
 * @throws Exception any exception
 */
  protected int run(  String... args) throws Exception {
    Configuration conf=new Configuration(false);
    return S3GuardTool.run(conf,args);
  }
  /** 
 * Run a S3GuardTool command from a varags list, catch any raised ExitException and verify the status code matches that expected.
 * @param status expected status code of an exception
 * @param args argument list
 * @throws Exception any exception
 */
  protected void runToFailure(  int status,  String... args) throws Exception {
    ExitUtil.ExitException ex=LambdaTestUtils.intercept(ExitUtil.ExitException.class,() -> run(args));
    if (ex.status != status) {
      throw ex;
    }
  }
  @Test public void testInfoNoArgs() throws Throwable {
    runToFailure(INVALID_ARGUMENT,BucketInfo.NAME);
  }
  @Test public void testInfoWrongFilesystem() throws Throwable {
    runToFailure(INVALID_ARGUMENT,BucketInfo.NAME,"file://");
  }
  @Test public void testNoCommand() throws Throwable {
    runToFailure(E_USAGE);
  }
  @Test public void testUnknownCommand() throws Throwable {
    runToFailure(E_USAGE,"unknown");
  }
  @Test public void testPruneNoArgs() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Prune.NAME);
  }
  @Test public void testDiffNoArgs() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Diff.NAME);
  }
  @Test public void testImportNoArgs() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Import.NAME);
  }
  @Test public void testDestroyNoArgs() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Destroy.NAME);
  }
  @Test public void testDestroyUnknownTableNoRegion() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Destroy.NAME,"-meta","dynamodb://ireland-team");
  }
  @Test public void testInitBucketAndRegion() throws Throwable {
    runToFailure(INVALID_ARGUMENT,Init.NAME,"-meta","dynamodb://ireland-team","-region","eu-west-1",S3ATestConstants.DEFAULT_CSVTEST_FILE);
  }
}
