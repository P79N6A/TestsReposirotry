/** 
 * Unit test for FederationRegistryClient.
 */
public class TestFederationRegistryClient {
  private Configuration conf;
  private UserGroupInformation user;
  private RegistryOperations registry;
  private FederationRegistryClient registryClient;
  @Before public void setup() throws Exception {
    this.conf=new YarnConfiguration();
    this.registry=new FSRegistryOperationsService();
    this.registry.init(this.conf);
    this.registry.start();
    this.user=UserGroupInformation.getCurrentUser();
    this.registryClient=new FederationRegistryClient(this.conf,this.registry,this.user);
    this.registryClient.cleanAllApplications();
    Assert.assertEquals(0,this.registryClient.getAllApplications().size());
  }
  @After public void breakDown(){
    registryClient.cleanAllApplications();
    Assert.assertEquals(0,registryClient.getAllApplications().size());
    registry.stop();
  }
  @Test public void testBasicCase(){
    ApplicationId appId=ApplicationId.newInstance(0,0);
    String scId1="subcluster1";
    String scId2="subcluster2";
    this.registryClient.writeAMRMTokenForUAM(appId,scId1,new Token<AMRMTokenIdentifier>());
    this.registryClient.writeAMRMTokenForUAM(appId,scId2,new Token<AMRMTokenIdentifier>());
    this.registryClient.writeAMRMTokenForUAM(appId,scId1,new Token<AMRMTokenIdentifier>());
    Assert.assertEquals(1,this.registryClient.getAllApplications().size());
    Assert.assertEquals(2,this.registryClient.loadStateFromRegistry(appId).size());
    this.registryClient.removeAppFromRegistry(appId);
    Assert.assertEquals(0,this.registryClient.getAllApplications().size());
    Assert.assertEquals(0,this.registryClient.loadStateFromRegistry(appId).size());
  }
}
