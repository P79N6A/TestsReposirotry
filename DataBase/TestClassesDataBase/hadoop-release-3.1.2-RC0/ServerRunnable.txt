/** 
 * Simple tcp server. Server gets a string, transforms it to upper case and returns it.
 */
private static class ServerRunnable implements Runnable {
  private volatile boolean works=true;
  private ServerSocket testSocket;
  private volatile boolean ready=false;
  private volatile Throwable throwable;
  private int port0;
  @Override public void run(){
    try {
      testSocket=new ServerSocket(0);
      port0=testSocket.getLocalPort();
      ready=true;
      while (works) {
        try {
          Socket connectionSocket=testSocket.accept();
          BufferedReader input=new BufferedReader(new InputStreamReader(connectionSocket.getInputStream()));
          DataOutputStream out=new DataOutputStream(connectionSocket.getOutputStream());
          String inData=input.readLine();
          String outData=inData.toUpperCase() + "\n";
          out.writeBytes(outData);
        }
 catch (        SocketException ignored) {
        }
      }
    }
 catch (    IOException ioe) {
      ioe.printStackTrace();
      throwable=ioe;
    }
  }
  public void stop(){
    works=false;
    try {
      testSocket.close();
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
  public boolean isReady(){
    return ready;
  }
  public int getPort(){
    return port0;
  }
  public Throwable getThrowable(){
    return throwable;
  }
}
