public static abstract class KMSCallable<T> implements Callable<T> {
  private List<URL> kmsUrl;
  protected URL getKMSUrl(){
    return kmsUrl.get(0);
  }
  protected URL[] getKMSHAUrl(){
    URL[] urls=new URL[kmsUrl.size()];
    return kmsUrl.toArray(urls);
  }
  protected void addKMSUrl(  URL url){
    if (kmsUrl == null) {
      kmsUrl=new ArrayList<URL>();
    }
    kmsUrl.add(url);
  }
  protected String generateLoadBalancingKeyProviderUriString(){
    if (kmsUrl == null || kmsUrl.size() == 0) {
      return null;
    }
    StringBuffer sb=new StringBuffer();
    for (int i=0; i < kmsUrl.size(); i++) {
      sb.append(KMSClientProvider.SCHEME_NAME + "://" + kmsUrl.get(0).getProtocol()+ "@");
      URL url=kmsUrl.get(i);
      sb.append(url.getAuthority());
      if (url.getPath() != null) {
        sb.append(url.getPath());
      }
      if (i < kmsUrl.size() - 1) {
        sb.append(",");
      }
    }
    return sb.toString();
  }
}
