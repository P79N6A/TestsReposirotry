private static class HdfsStatement extends Statement {
  private Statement statement;
  private String testName;
  public HdfsStatement(  Statement statement,  String testName){
    this.statement=statement;
    this.testName=testName;
  }
  @Override public void evaluate() throws Throwable {
    MiniDFSCluster miniHdfs=null;
    Configuration conf=HadoopUsersConfTestHelper.getBaseConf();
    if (Boolean.parseBoolean(System.getProperty(HADOOP_MINI_HDFS,"true"))) {
      miniHdfs=startMiniHdfs(conf);
      conf=miniHdfs.getConfiguration(0);
    }
    try {
      HDFS_CONF_TL.set(conf);
      HDFS_TEST_DIR_TL.set(resetHdfsTestDir(conf));
      statement.evaluate();
    }
  finally {
      HDFS_CONF_TL.remove();
      HDFS_TEST_DIR_TL.remove();
    }
  }
  private static AtomicInteger counter=new AtomicInteger();
  private Path resetHdfsTestDir(  Configuration conf){
    Path testDir=new Path("/tmp/" + testName + "-"+ counter.getAndIncrement());
    try {
      FileSystem fs=FileSystem.get(conf);
      fs.delete(testDir,true);
      fs.mkdirs(testDir);
    }
 catch (    Exception ex) {
      throw new RuntimeException(ex);
    }
    return testDir;
  }
}
