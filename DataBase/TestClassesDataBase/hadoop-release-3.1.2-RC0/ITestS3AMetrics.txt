/** 
 * Test s3a performance metrics register and output.
 */
public class ITestS3AMetrics extends AbstractS3ATestBase {
  @Test public void testMetricsRegister() throws IOException, InterruptedException {
    S3AFileSystem fs=getFileSystem();
    Path dest=path("testMetricsRegister");
    ContractTestUtils.touch(fs,dest);
    MutableCounterLong fileCreated=(MutableCounterLong)fs.getInstrumentation().getRegistry().get(Statistic.FILES_CREATED.getSymbol());
    assertEquals("Metrics system should report single file created event",1,fileCreated.value());
  }
  @Test public void testStreamStatistics() throws IOException {
    S3AFileSystem fs=getFileSystem();
    Path file=path("testStreamStatistics");
    byte[] data="abcdefghijklmnopqrstuvwxyz".getBytes();
    ContractTestUtils.createFile(fs,file,false,data);
    try (InputStream inputStream=fs.open(file)){
      while (inputStream.read(data) != -1) {
        LOG.debug("Read batch of data from input stream...");
      }
    }
     MutableCounterLong read=(MutableCounterLong)fs.getInstrumentation().getRegistry().get(Statistic.STREAM_SEEK_BYTES_READ.getSymbol());
    assertEquals("Stream statistics were not merged",26,read.value());
  }
}
