/** 
 * Test NameNode port defaulting code. 
 */
public class TestDefaultNameNodePort {
  @Test public void testGetAddressFromString() throws Exception {
    assertEquals(DFSUtilClient.getNNAddress("foo").getPort(),HdfsClientConfigKeys.DFS_NAMENODE_RPC_PORT_DEFAULT);
    assertEquals(DFSUtilClient.getNNAddress("hdfs://foo/").getPort(),HdfsClientConfigKeys.DFS_NAMENODE_RPC_PORT_DEFAULT);
    assertEquals(DFSUtilClient.getNNAddress("hdfs://foo:555").getPort(),555);
    assertEquals(DFSUtilClient.getNNAddress("foo:555").getPort(),555);
  }
  @Test public void testGetAddressFromConf() throws Exception {
    Configuration conf=new HdfsConfiguration();
    FileSystem.setDefaultUri(conf,"hdfs://foo/");
    assertEquals(DFSUtilClient.getNNAddress(conf).getPort(),HdfsClientConfigKeys.DFS_NAMENODE_RPC_PORT_DEFAULT);
    FileSystem.setDefaultUri(conf,"hdfs://foo:555/");
    assertEquals(DFSUtilClient.getNNAddress(conf).getPort(),555);
    FileSystem.setDefaultUri(conf,"foo");
    assertEquals(DFSUtilClient.getNNAddress(conf).getPort(),HdfsClientConfigKeys.DFS_NAMENODE_RPC_PORT_DEFAULT);
  }
  @Test public void testGetUri(){
    assertEquals(DFSUtilClient.getNNUri(new InetSocketAddress("foo",555)),URI.create("hdfs://foo:555"));
    assertEquals(DFSUtilClient.getNNUri(new InetSocketAddress("foo",HdfsClientConfigKeys.DFS_NAMENODE_RPC_PORT_DEFAULT)),URI.create("hdfs://foo"));
  }
}
