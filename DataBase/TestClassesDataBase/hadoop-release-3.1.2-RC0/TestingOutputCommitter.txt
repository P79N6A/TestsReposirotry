private static class TestingOutputCommitter extends StubbedOutputCommitter {
  CyclicBarrier syncBarrier;
  boolean shouldSucceed;
  public TestingOutputCommitter(  CyclicBarrier syncBarrier,  boolean shouldSucceed){
    super();
    this.syncBarrier=syncBarrier;
    this.shouldSucceed=shouldSucceed;
  }
  @Override public void commitJob(  JobContext jobContext) throws IOException {
    try {
      syncBarrier.await();
    }
 catch (    BrokenBarrierException e) {
    }
catch (    InterruptedException e) {
    }
    if (!shouldSucceed) {
      throw new IOException("forced failure");
    }
  }
}
