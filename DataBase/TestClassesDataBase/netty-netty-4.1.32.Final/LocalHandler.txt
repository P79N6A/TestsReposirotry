@Sharable static class LocalHandler extends ChannelInboundHandlerAdapter {
  private final String name;
  public volatile ChannelFuture lastWriteFuture;
  public final AtomicInteger count=new AtomicInteger(0);
  LocalHandler(  String name){
    this.name=name;
  }
  @Override public void channelActive(  ChannelHandlerContext ctx) throws Exception {
    for (int i=0; i < messageCountPerRun; i++) {
      lastWriteFuture=ctx.channel().write(name + ' ' + i);
    }
    ctx.channel().flush();
  }
  @Override public void channelRead(  ChannelHandlerContext ctx,  Object msg) throws Exception {
    count.incrementAndGet();
    ReferenceCountUtil.release(msg);
  }
}
