public class LineEncoderTest {
  @Test public void testEncode(){
    testLineEncode(LineSeparator.DEFAULT,"abc");
    testLineEncode(LineSeparator.WINDOWS,"abc");
    testLineEncode(LineSeparator.UNIX,"abc");
  }
  private static void testLineEncode(  LineSeparator lineSeparator,  String msg){
    EmbeddedChannel channel=new EmbeddedChannel(new LineEncoder(lineSeparator,CharsetUtil.UTF_8));
    assertTrue(channel.writeOutbound(msg));
    ByteBuf buf=channel.readOutbound();
    try {
      byte[] data=new byte[buf.readableBytes()];
      buf.readBytes(data);
      byte[] expected=(msg + lineSeparator.value()).getBytes(CharsetUtil.UTF_8);
      Assert.assertArrayEquals(expected,data);
      Assert.assertNull(channel.readOutbound());
    }
  finally {
      buf.release();
      assertFalse(channel.finish());
    }
  }
}
