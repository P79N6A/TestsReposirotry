@ChannelHandler.Sharable private static final class AcceptedChannelCounter extends ChannelInboundHandlerAdapter {
  final CountDownLatch latch;
  AcceptedChannelCounter(  int nChannels){
    latch=new CountDownLatch(nChannels);
  }
  @Override public void channelActive(  ChannelHandlerContext ctx) throws Exception {
    latch.countDown();
  }
}
