protected static final class MessageDelegatorChannelHandler extends SimpleChannelInboundHandler<ByteBuf> {
  private final MessageReceiver receiver;
  private final CountDownLatch latch;
  public MessageDelegatorChannelHandler(  MessageReceiver receiver,  CountDownLatch latch){
    super(false);
    this.receiver=receiver;
    this.latch=latch;
  }
  @Override protected void channelRead0(  ChannelHandlerContext ctx,  ByteBuf msg) throws Exception {
    receiver.messageReceived(msg);
    latch.countDown();
  }
}
