private static class ReadPendingInitializer extends ChannelInitializer<Channel> {
  final ReadPendingReadHandler readPendingHandler=new ReadPendingReadHandler();
  final CountDownLatch channelInitLatch=new CountDownLatch(1);
  volatile Channel channel;
  @Override protected void initChannel(  Channel ch) throws Exception {
    channel=ch;
    ch.pipeline().addLast(readPendingHandler);
    channelInitLatch.countDown();
  }
}
