private static final class TestEncoder extends HttpContentEncoder {
  @Override protected Result beginEncode(  HttpResponse headers,  String acceptEncoding){
    return new Result("test",new EmbeddedChannel(new MessageToByteEncoder<ByteBuf>(){
      @Override protected void encode(      ChannelHandlerContext ctx,      ByteBuf in,      ByteBuf out) throws Exception {
        out.writeBytes(String.valueOf(in.readableBytes()).getBytes(CharsetUtil.US_ASCII));
        in.skipBytes(in.readableBytes());
      }
    }
));
  }
}
