public class SocksAuthRequestDecoderTest {
  private static final String username="testUserName";
  private static final String password="testPassword";
  @Test public void testAuthRequestDecoder(){
    SocksAuthRequest msg=new SocksAuthRequest(username,password);
    SocksAuthRequestDecoder decoder=new SocksAuthRequestDecoder();
    EmbeddedChannel embedder=new EmbeddedChannel(decoder);
    SocksCommonTestUtils.writeMessageIntoEmbedder(embedder,msg);
    msg=embedder.readInbound();
    assertEquals(username,msg.username());
    assertEquals(password,msg.password());
    assertNull(embedder.readInbound());
  }
  @Test public void testAuthRequestDecoderPartialSend(){
    EmbeddedChannel ch=new EmbeddedChannel(new SocksAuthRequestDecoder());
    ByteBuf byteBuf=Unpooled.buffer(16);
    byteBuf.writeByte(SocksSubnegotiationVersion.AUTH_PASSWORD.byteValue());
    byteBuf.writeByte(username.length());
    byteBuf.writeBytes(username.getBytes());
    byteBuf.writeByte(password.length());
    ch.writeInbound(byteBuf);
    assertNull(ch.readInbound());
    ByteBuf byteBuf2=Unpooled.buffer();
    byteBuf2.writeBytes(password.getBytes());
    ch.writeInbound(byteBuf2);
    SocksAuthRequest msg=ch.readInbound();
    assertEquals(username,msg.username());
    assertEquals(password,msg.password());
    assertFalse(ch.finishAndReleaseAll());
  }
}
