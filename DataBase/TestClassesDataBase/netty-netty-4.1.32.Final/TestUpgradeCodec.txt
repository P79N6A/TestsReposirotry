private class TestUpgradeCodec implements UpgradeCodec {
  @Override public Collection<CharSequence> requiredUpgradeHeaders(){
    return Collections.<CharSequence>emptyList();
  }
  @Override public boolean prepareUpgradeResponse(  ChannelHandlerContext ctx,  FullHttpRequest upgradeRequest,  HttpHeaders upgradeHeaders){
    return true;
  }
  @Override public void upgradeTo(  ChannelHandlerContext ctx,  FullHttpRequest upgradeRequest){
    assertEquals(ctx.pipeline().context(HttpServerUpgradeHandler.class),ctx);
    assertNotNull(ctx.pipeline().get(HttpServerUpgradeHandler.class));
    ctx.pipeline().addAfter(ctx.name(),"marker",new ChannelInboundHandlerAdapter());
  }
}
