private static final class MulticastTestHandler extends SimpleChannelInboundHandler<DatagramPacket> {
  private final CountDownLatch latch=new CountDownLatch(1);
  private boolean done;
  private volatile boolean fail;
  @Override protected void channelRead0(  ChannelHandlerContext ctx,  DatagramPacket msg) throws Exception {
    if (done) {
      fail=true;
    }
    assertEquals(1,msg.content().readInt());
    latch.countDown();
    done=true;
  }
  public boolean await() throws Exception {
    boolean success=latch.await(10,TimeUnit.SECONDS);
    if (fail) {
      fail();
    }
    return success;
  }
}
