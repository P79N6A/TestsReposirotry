public class DefaultChannelGroupTest {
  @Test public void testNotThrowBlockingOperationException() throws Exception {
    EventLoopGroup bossGroup=new NioEventLoopGroup();
    EventLoopGroup workerGroup=new NioEventLoopGroup();
    final ChannelGroup allChannels=new DefaultChannelGroup(GlobalEventExecutor.INSTANCE);
    ServerBootstrap b=new ServerBootstrap();
    b.group(bossGroup,workerGroup);
    b.childHandler(new ChannelInboundHandlerAdapter(){
      @Override public void channelActive(      ChannelHandlerContext ctx){
        allChannels.add(ctx.channel());
      }
    }
);
    b.channel(NioServerSocketChannel.class);
    ChannelFuture f=b.bind(0).syncUninterruptibly();
    if (f.isSuccess()) {
      allChannels.add(f.channel());
      allChannels.close().awaitUninterruptibly();
    }
    bossGroup.shutdownGracefully();
    workerGroup.shutdownGracefully();
    bossGroup.terminationFuture().sync();
    workerGroup.terminationFuture().sync();
  }
}
