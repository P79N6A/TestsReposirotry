@Configuration static class WebServerConfig implements BeanPostProcessor {
  private final MockWebServer server=new MockWebServer();
  @PreDestroy public void shutdown() throws IOException {
    this.server.shutdown();
  }
  @Bean public MockWebServer authz(){
    return this.server;
  }
  @Override public Object postProcessAfterInitialization(  Object bean,  String beanName) throws BeansException {
    if (bean instanceof WebSecurityConfigurerAdapter) {
      Field f=ReflectionUtils.findField(bean.getClass(),field -> field.getAnnotation(Value.class) != null);
      if (f != null) {
        ReflectionUtils.setField(f,bean,this.server.url("/.well-known/jwks.json").toString());
      }
    }
    return null;
  }
}
