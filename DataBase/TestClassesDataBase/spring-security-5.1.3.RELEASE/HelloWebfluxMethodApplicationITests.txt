/** 
 * @author Rob Winch
 * @since 5.0
 */
@RunWith(SpringRunner.class) @SpringBootTest(webEnvironment=SpringBootTest.WebEnvironment.RANDOM_PORT) public class HelloWebfluxMethodApplicationITests {
  @Autowired WebTestClient rest;
  @Test public void messageWhenNotAuthenticated() throws Exception {
    this.rest.get().uri("/message").exchange().expectStatus().isUnauthorized();
  }
  @Test public void messageWhenUserThenForbidden() throws Exception {
    this.rest.get().uri("/message").headers(robsCredentials()).exchange().expectStatus().isEqualTo(HttpStatus.FORBIDDEN);
  }
  @Test public void messageWhenAdminThenOk() throws Exception {
    this.rest.get().uri("/message").headers(adminCredentials()).exchange().expectStatus().isOk().expectBody(String.class).isEqualTo("Hello World!");
  }
  private Consumer<HttpHeaders> robsCredentials(){
    return httpHeaders -> httpHeaders.setBasicAuth("rob","rob");
  }
  private Consumer<HttpHeaders> adminCredentials(){
    return httpHeaders -> httpHeaders.setBasicAuth("admin","admin");
  }
}
