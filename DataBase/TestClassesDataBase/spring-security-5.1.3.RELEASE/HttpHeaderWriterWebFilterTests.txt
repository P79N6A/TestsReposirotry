/** 
 * @author Rob Winch
 * @since 5.0
 */
@RunWith(MockitoJUnitRunner.class) public class HttpHeaderWriterWebFilterTests {
  @Mock ServerHttpHeadersWriter writer;
  HttpHeaderWriterWebFilter filter;
  @Before public void setup(){
    when(writer.writeHttpHeaders(any())).thenReturn(Mono.empty());
    filter=new HttpHeaderWriterWebFilter(writer);
  }
  @Test public void filterWhenCompleteThenWritten(){
    WebTestClient rest=WebTestClientBuilder.bindToWebFilters(filter).build();
    rest.get().uri("/foo").exchange();
    verify(writer).writeHttpHeaders(any());
  }
  @Test public void filterWhenNotCompleteThenNotWritten(){
    WebTestHandler handler=WebTestHandler.bindToWebFilters(filter);
    WebHandlerResult result=handler.exchange(MockServerHttpRequest.get("/foo"));
    verify(writer,never()).writeHttpHeaders(any());
    result.getExchange().getResponse().setComplete();
    verify(writer).writeHttpHeaders(any());
  }
}
