/** 
 * @author Josh Cummings
 */
public class SessionManagementConfigTransientAuthenticationTests {
  private static final String CONFIG_LOCATION_PREFIX="classpath:org/springframework/security/config/http/SessionManagementConfigTransientAuthenticationTests";
  @Autowired MockMvc mvc;
  @Rule public final SpringTestRule spring=new SpringTestRule();
  @Test public void postWhenTransientAuthenticationThenNoSessionCreated() throws Exception {
    this.spring.configLocations(this.xml("WithTransientAuthentication")).autowire();
    MvcResult result=this.mvc.perform(post("/login")).andReturn();
    assertThat(result.getRequest().getSession(false)).isNull();
  }
  @Test public void postWhenTransientAuthenticationThenAlwaysSessionOverrides() throws Exception {
    this.spring.configLocations(this.xml("CreateSessionAlwaysWithTransientAuthentication")).autowire();
    MvcResult result=this.mvc.perform(post("/login")).andReturn();
    assertThat(result.getRequest().getSession(false)).isNotNull();
  }
static class TransientAuthenticationProvider implements AuthenticationProvider {
    @Override public Authentication authenticate(    Authentication authentication) throws AuthenticationException {
      return new SomeTransientAuthentication();
    }
    @Override public boolean supports(    Class<?> authentication){
      return true;
    }
  }
@Transient static class SomeTransientAuthentication extends AbstractAuthenticationToken {
    SomeTransientAuthentication(){
      super(null);
    }
    @Override public Object getCredentials(){
      return null;
    }
    @Override public Object getPrincipal(){
      return null;
    }
  }
  private String xml(  String configName){
    return CONFIG_LOCATION_PREFIX + "-" + configName+ ".xml";
  }
}
