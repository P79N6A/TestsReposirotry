@EnableWebFluxSecurity @EnableWebFlux @Import(ReactiveAuthenticationTestConfiguration.class) static class AuthenticationPrincipalConfig {
  @Bean public PrincipalBean principalBean(){
    return new PrincipalBean();
  }
static class PrincipalBean {
    public String username(    UserDetails user){
      return user.getUsername();
    }
  }
@RestController public static class AuthenticationPrincipalResolver {
    @GetMapping("/spel") String username(    @AuthenticationPrincipal(expression="@principalBean.username(#this)") String username){
      return username;
    }
  }
}
