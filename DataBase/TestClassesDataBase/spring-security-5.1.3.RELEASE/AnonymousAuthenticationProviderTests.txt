/** 
 * Tests  {@link AnonymousAuthenticationProvider}.
 * @author Ben Alex
 */
public class AnonymousAuthenticationProviderTests {
  @Test public void testDetectsAnInvalidKey() throws Exception {
    AnonymousAuthenticationProvider aap=new AnonymousAuthenticationProvider("qwerty");
    AnonymousAuthenticationToken token=new AnonymousAuthenticationToken("WRONG_KEY","Test",AuthorityUtils.createAuthorityList("ROLE_ONE","ROLE_TWO"));
    try {
      aap.authenticate(token);
      fail("Should have thrown BadCredentialsException");
    }
 catch (    BadCredentialsException expected) {
    }
  }
  @Test public void testDetectsMissingKey() throws Exception {
    try {
      new AnonymousAuthenticationProvider(null);
      fail("Should have thrown IllegalArgumentException");
    }
 catch (    IllegalArgumentException expected) {
    }
  }
  @Test public void testGettersSetters() throws Exception {
    AnonymousAuthenticationProvider aap=new AnonymousAuthenticationProvider("qwerty");
    assertThat(aap.getKey()).isEqualTo("qwerty");
  }
  @Test public void testIgnoresClassesItDoesNotSupport() throws Exception {
    AnonymousAuthenticationProvider aap=new AnonymousAuthenticationProvider("qwerty");
    TestingAuthenticationToken token=new TestingAuthenticationToken("user","password","ROLE_A");
    assertThat(aap.supports(TestingAuthenticationToken.class)).isFalse();
    assertThat(aap.authenticate(token)).isNull();
  }
  @Test public void testNormalOperation() throws Exception {
    AnonymousAuthenticationProvider aap=new AnonymousAuthenticationProvider("qwerty");
    AnonymousAuthenticationToken token=new AnonymousAuthenticationToken("qwerty","Test",AuthorityUtils.createAuthorityList("ROLE_ONE","ROLE_TWO"));
    Authentication result=aap.authenticate(token);
    assertThat(token).isEqualTo(result);
  }
  @Test public void testSupports(){
    AnonymousAuthenticationProvider aap=new AnonymousAuthenticationProvider("qwerty");
    assertThat(aap.supports(AnonymousAuthenticationToken.class)).isTrue();
    assertThat(aap.supports(TestingAuthenticationToken.class)).isFalse();
  }
}
