private static abstract class CommonWebSecurityConfigurerAdapter extends WebSecurityConfigurerAdapter {
  @Override protected void configure(  HttpSecurity http) throws Exception {
    http.authorizeRequests().anyRequest().authenticated().and().securityContext().securityContextRepository(securityContextRepository()).and().oauth2Login().tokenEndpoint().accessTokenResponseClient(createOauth2AccessTokenResponseClient()).and().userInfoEndpoint().userService(createOauth2UserService()).oidcUserService(createOidcUserService());
  }
  @Bean SecurityContextRepository securityContextRepository(){
    return new HttpSessionSecurityContextRepository();
  }
  @Bean HttpSessionOAuth2AuthorizationRequestRepository oauth2AuthorizationRequestRepository(){
    return new HttpSessionOAuth2AuthorizationRequestRepository();
  }
}
