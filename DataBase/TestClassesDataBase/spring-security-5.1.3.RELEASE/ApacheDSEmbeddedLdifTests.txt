/** 
 * Tests reproducing problems with loading structures from ldif on embedded ApacheDS server.
 * @author Marcin ZajÄ…czkowski
 */
public class ApacheDSEmbeddedLdifTests {
  private static final String LDAP_ROOT="ou=ssattributes,dc=springframework,dc=org";
  private static final int LDAP_PORT=52389;
  private ApacheDSContainer server;
  private SpringSecurityLdapTemplate ldapTemplate;
  @Before public void setUp() throws Exception {
    this.server=new ApacheDSContainer(LDAP_ROOT,"classpath:test-server-custom-attribute-types.ldif");
    this.server.setPort(LDAP_PORT);
    this.server.afterPropertiesSet();
    this.ldapTemplate=new SpringSecurityLdapTemplate(createLdapContextSource());
  }
  private LdapContextSource createLdapContextSource() throws Exception {
    LdapContextSource ldapContextSource=new LdapContextSource();
    ldapContextSource.setUrl("ldap://localhost:" + LDAP_PORT);
    ldapContextSource.setBase(LDAP_ROOT);
    ldapContextSource.afterPropertiesSet();
    return ldapContextSource;
  }
  @After public void tearDown() throws Exception {
    if (this.server != null) {
      this.server.destroy();
    }
  }
  @Ignore @Test public void customAttributeTypesShouldBeProperlyCreatedWhenLoadedFromLdif(){
    assertThat(this.ldapTemplate.compare("uid=objectWithCustomAttribute1","uid","objectWithCustomAttribute1")).isTrue();
    assertThat(this.ldapTemplate.compare("uid=objectWithCustomAttribute1","customAttribute","I am custom")).isTrue();
  }
}
