@EnableWebSecurity static class DisableUseExpressionsConfig extends WebSecurityConfigurerAdapter {
  private Class<? extends FilterInvocationSecurityMetadataSource> filterInvocationSecurityMetadataSourceType;
  @Override protected void configure(  HttpSecurity http) throws Exception {
    http.apply(new UrlAuthorizationConfigurer<>(getApplicationContext())).getRegistry().antMatchers("/users**","/sessions/**").hasRole("USER").antMatchers("/signup").hasRole("ANONYMOUS").anyRequest().hasRole("USER");
  }
  @Override public void init(  final WebSecurity web) throws Exception {
    super.init(web);
    final HttpSecurity http=this.getHttp();
    web.postBuildAction(() -> {
      FilterSecurityInterceptor securityInterceptor=http.getSharedObject(FilterSecurityInterceptor.class);
      DisableUseExpressionsConfig.this.filterInvocationSecurityMetadataSourceType=securityInterceptor.getSecurityMetadataSource().getClass();
    }
);
  }
}
