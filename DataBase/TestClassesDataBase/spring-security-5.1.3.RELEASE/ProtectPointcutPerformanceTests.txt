/** 
 * @author Luke Taylor
 */
@ContextConfiguration(locations={"/protect-pointcut-performance-app-context.xml"}) @RunWith(SpringJUnit4ClassRunner.class) public class ProtectPointcutPerformanceTests implements ApplicationContextAware {
  ApplicationContext ctx;
  @Before public void clearContext(){
    SecurityContextHolder.clearContext();
  }
  @Test public void usingPrototypeDoesNotParsePointcutOnEachCall(){
    StopWatch sw=new StopWatch();
    sw.start();
    for (int i=0; i < 1000; i++) {
      try {
        SessionRegistry reg=(SessionRegistry)ctx.getBean("sessionRegistryPrototype");
        reg.getAllPrincipals();
        fail("Expected AuthenticationCredentialsNotFoundException");
      }
 catch (      AuthenticationCredentialsNotFoundException expected) {
      }
    }
    sw.stop();
  }
  public void setApplicationContext(  ApplicationContext applicationContext) throws BeansException {
    ctx=applicationContext;
  }
}
