/** 
 * @author Rob Winch
 */
@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(classes=DataConfig.class) public class SecurityMessageRepositoryTests {
  @Autowired SecurityMessageRepository repository;
  User user;
  @Before public void setup(){
    user=new User();
    user.setId(0L);
    List<GrantedAuthority> authorities=AuthorityUtils.createAuthorityList("ROLE_USER");
    UsernamePasswordAuthenticationToken authentication=new UsernamePasswordAuthenticationToken(user,"notused",authorities);
    SecurityContextHolder.getContext().setAuthentication(authentication);
  }
  @After public void cleanup(){
    SecurityContextHolder.clearContext();
  }
  @Test public void findAllOnlyToCurrentUser(){
    Long expectedId=user.getId();
    List<Message> messages=repository.findAll();
    assertThat(messages).hasSize(3);
    for (    Message m : messages) {
      assertThat(m.getTo().getId()).isEqualTo(expectedId);
    }
  }
}
