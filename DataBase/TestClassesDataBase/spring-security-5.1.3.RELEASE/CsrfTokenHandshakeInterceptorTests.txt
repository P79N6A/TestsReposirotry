/** 
 * @author Rob Winch
 */
@RunWith(MockitoJUnitRunner.class) public class CsrfTokenHandshakeInterceptorTests {
  @Mock WebSocketHandler wsHandler;
  @Mock ServerHttpResponse response;
  Map<String,Object> attributes;
  ServerHttpRequest request;
  MockHttpServletRequest httpRequest;
  CsrfTokenHandshakeInterceptor interceptor;
  @Before public void setup(){
    httpRequest=new MockHttpServletRequest();
    attributes=new HashMap<>();
    request=new ServletServerHttpRequest(httpRequest);
    interceptor=new CsrfTokenHandshakeInterceptor();
  }
  @Test public void beforeHandshakeNoAttribute() throws Exception {
    interceptor.beforeHandshake(request,response,wsHandler,attributes);
    assertThat(attributes).isEmpty();
  }
  @Test public void beforeHandshake() throws Exception {
    CsrfToken token=new DefaultCsrfToken("header","param","token");
    httpRequest.setAttribute(CsrfToken.class.getName(),token);
    interceptor.beforeHandshake(request,response,wsHandler,attributes);
    assertThat(attributes.keySet()).containsOnly(CsrfToken.class.getName());
    assertThat(attributes.values()).containsOnly(token);
  }
}
