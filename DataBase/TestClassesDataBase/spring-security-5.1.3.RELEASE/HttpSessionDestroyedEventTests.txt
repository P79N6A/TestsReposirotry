/** 
 * @author Rob Winch
 */
public class HttpSessionDestroyedEventTests {
  private MockHttpSession session;
  private HttpSessionDestroyedEvent destroyedEvent;
  @Before public void setUp(){
    session=new MockHttpSession();
    session.setAttribute("notcontext","notcontext");
    session.setAttribute("null",null);
    session.setAttribute("context",new SecurityContextImpl());
    destroyedEvent=new HttpSessionDestroyedEvent(session);
  }
  @Test public void getSecurityContexts(){
    List<SecurityContext> securityContexts=destroyedEvent.getSecurityContexts();
    assertThat(securityContexts).hasSize(1);
    assertThat(securityContexts.get(0)).isSameAs(session.getAttribute("context"));
  }
  @Test public void getSecurityContextsMulti(){
    session.setAttribute("another",new SecurityContextImpl());
    List<SecurityContext> securityContexts=destroyedEvent.getSecurityContexts();
    assertThat(securityContexts).hasSize(2);
  }
  @Test public void getSecurityContextsDiffImpl(){
    session.setAttribute("context",mock(SecurityContext.class));
    List<SecurityContext> securityContexts=destroyedEvent.getSecurityContexts();
    assertThat(securityContexts).hasSize(1);
    assertThat(securityContexts.get(0)).isSameAs(session.getAttribute("context"));
  }
}
