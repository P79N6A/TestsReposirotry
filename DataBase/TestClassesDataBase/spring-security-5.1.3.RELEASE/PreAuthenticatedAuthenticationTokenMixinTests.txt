/** 
 * @author Rob Winch
 * @since 4.2
 */
public class PreAuthenticatedAuthenticationTokenMixinTests extends AbstractMixinTests {
  private static final String PREAUTH_JSON="{" + "\"@class\": \"org.springframework.security.web.authentication.preauth.PreAuthenticatedAuthenticationToken\"," + "\"principal\": \"principal\", "+ "\"credentials\": \"credentials\", "+ "\"authenticated\": true, "+ "\"details\": null, "+ "\"authorities\": " + SimpleGrantedAuthorityMixinTests.AUTHORITIES_ARRAYLIST_JSON + "}";
  PreAuthenticatedAuthenticationToken expected;
  @Before public void setupExpected(){
    expected=new PreAuthenticatedAuthenticationToken("principal","credentials",AuthorityUtils.createAuthorityList("ROLE_USER"));
  }
  @Test public void serializeWhenPrincipalCredentialsAuthoritiesThenSuccess() throws JsonProcessingException, JSONException {
    String serializedJson=mapper.writeValueAsString(expected);
    JSONAssert.assertEquals(PREAUTH_JSON,serializedJson,true);
  }
  @Test public void deserializeAuthenticatedUsernamePasswordAuthenticationTokenMixinTest() throws Exception {
    PreAuthenticatedAuthenticationToken deserialized=mapper.readValue(PREAUTH_JSON,PreAuthenticatedAuthenticationToken.class);
    assertThat(deserialized).isNotNull();
    assertThat(deserialized.isAuthenticated()).isTrue();
    assertThat(deserialized.getAuthorities()).isEqualTo(expected.getAuthorities());
  }
}
