public class TestSecurityContextHolderTests {
  private SecurityContext context;
  @Before public void setup(){
    context=SecurityContextHolder.createEmptyContext();
  }
  @After public void cleanup(){
    TestSecurityContextHolder.clearContext();
  }
  @Test public void clearContextClearsBoth(){
    SecurityContextHolder.setContext(context);
    TestSecurityContextHolder.setContext(context);
    TestSecurityContextHolder.clearContext();
    assertThat(SecurityContextHolder.getContext()).isNotSameAs(context);
    assertThat(TestSecurityContextHolder.getContext()).isNotSameAs(context);
  }
  @Test public void getContextDefaultsNonNull(){
    assertThat(TestSecurityContextHolder.getContext()).isNotNull();
    assertThat(SecurityContextHolder.getContext()).isNotNull();
  }
  @Test public void setContextSetsBoth(){
    TestSecurityContextHolder.setContext(context);
    assertThat(TestSecurityContextHolder.getContext()).isSameAs(context);
    assertThat(SecurityContextHolder.getContext()).isSameAs(context);
  }
  @Test public void setContextWithAuthentication(){
    Authentication authentication=mock(Authentication.class);
    TestSecurityContextHolder.setAuthentication(authentication);
    assertThat(TestSecurityContextHolder.getContext().getAuthentication()).isSameAs(authentication);
  }
}
