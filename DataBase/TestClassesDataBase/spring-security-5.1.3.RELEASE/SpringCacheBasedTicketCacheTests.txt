/** 
 * Tests {@link org.springframework.security.cas.authentication.SpringCacheBasedTicketCache}.
 * @author Marten Deinum
 * @since 3.2
 */
public class SpringCacheBasedTicketCacheTests extends AbstractStatelessTicketCacheTests {
  private static CacheManager cacheManager;
  @BeforeClass public static void initCacheManaer(){
    cacheManager=new ConcurrentMapCacheManager();
    cacheManager.getCache("castickets");
  }
  @Test public void testCacheOperation() throws Exception {
    SpringCacheBasedTicketCache cache=new SpringCacheBasedTicketCache(cacheManager.getCache("castickets"));
    final CasAuthenticationToken token=getToken();
    cache.putTicketInCache(token);
    assertThat(cache.getByTicketId("ST-0-ER94xMJmn6pha35CQRoZ")).isEqualTo(token);
    cache.removeTicketFromCache(getToken());
    assertThat(cache.getByTicketId("ST-0-ER94xMJmn6pha35CQRoZ")).isNull();
    assertThat(cache.getByTicketId(null)).isNull();
    assertThat(cache.getByTicketId("UNKNOWN_SERVICE_TICKET")).isNull();
  }
  @Test(expected=IllegalArgumentException.class) public void testStartupDetectsMissingCache() throws Exception {
    new SpringCacheBasedTicketCache(null);
  }
}
