@EnableWebSecurity static class PasswordEncoderWithUserDetailsServiceConfig extends WebSecurityConfigurerAdapter {
  @Override protected void configure(  AuthenticationManagerBuilder auth) throws Exception {
    BCryptPasswordEncoder encoder=new BCryptPasswordEncoder();
    UserDetails user=User.withUsername("user").passwordEncoder(encoder::encode).password("password").roles("USER").build();
    InMemoryUserDetailsManager uds=new InMemoryUserDetailsManager(user);
    auth.userDetailsService(uds).passwordEncoder(encoder);
  }
  @Bean public DataSource dataSource(){
    EmbeddedDatabaseBuilder builder=new EmbeddedDatabaseBuilder();
    return builder.setType(EmbeddedDatabaseType.HSQL).build();
  }
}
