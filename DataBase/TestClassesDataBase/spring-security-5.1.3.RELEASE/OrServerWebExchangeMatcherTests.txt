/** 
 * @author Rob Winch
 * @since 5.0
 */
@RunWith(MockitoJUnitRunner.class) public class OrServerWebExchangeMatcherTests {
  @Mock ServerWebExchange exchange;
  @Mock ServerWebExchangeMatcher matcher1;
  @Mock ServerWebExchangeMatcher matcher2;
  OrServerWebExchangeMatcher matcher;
  @Before public void setUp() throws Exception {
    matcher=new OrServerWebExchangeMatcher(matcher1,matcher2);
  }
  @Test public void matchesWhenFalseFalseThenFalse() throws Exception {
    when(matcher1.matches(exchange)).thenReturn(ServerWebExchangeMatcher.MatchResult.notMatch());
    when(matcher2.matches(exchange)).thenReturn(ServerWebExchangeMatcher.MatchResult.notMatch());
    ServerWebExchangeMatcher.MatchResult matches=matcher.matches(exchange).block();
    assertThat(matches.isMatch()).isFalse();
    assertThat(matches.getVariables()).isEmpty();
    verify(matcher1).matches(exchange);
    verify(matcher2).matches(exchange);
  }
  @Test public void matchesWhenTrueFalseThenTrueAndMatcher2NotInvoked() throws Exception {
    Map<String,Object> params=Collections.singletonMap("foo","bar");
    when(matcher1.matches(exchange)).thenReturn(ServerWebExchangeMatcher.MatchResult.match(params));
    ServerWebExchangeMatcher.MatchResult matches=matcher.matches(exchange).block();
    assertThat(matches.isMatch()).isTrue();
    assertThat(matches.getVariables()).isEqualTo(params);
    verify(matcher1).matches(exchange);
    verify(matcher2,never()).matches(exchange);
  }
  @Test public void matchesWhenFalseTrueThenTrue() throws Exception {
    Map<String,Object> params=Collections.singletonMap("foo","bar");
    when(matcher1.matches(exchange)).thenReturn(ServerWebExchangeMatcher.MatchResult.notMatch());
    when(matcher2.matches(exchange)).thenReturn(ServerWebExchangeMatcher.MatchResult.match(params));
    ServerWebExchangeMatcher.MatchResult matches=matcher.matches(exchange).block();
    assertThat(matches.isMatch()).isTrue();
    assertThat(matches.getVariables()).isEqualTo(params);
    verify(matcher1).matches(exchange);
    verify(matcher2).matches(exchange);
  }
}
