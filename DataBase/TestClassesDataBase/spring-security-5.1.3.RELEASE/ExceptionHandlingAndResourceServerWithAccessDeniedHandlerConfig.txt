@EnableWebSecurity static class ExceptionHandlingAndResourceServerWithAccessDeniedHandlerConfig extends WebSecurityConfigurerAdapter {
  @Override protected void configure(  HttpSecurity http) throws Exception {
    http.authorizeRequests().anyRequest().denyAll().and().exceptionHandling().defaultAccessDeniedHandlerFor(new AccessDeniedHandlerImpl(),request -> false).and().httpBasic().and().oauth2ResourceServer().jwt();
  }
  @Bean public UserDetailsService userDetailsService(){
    return new InMemoryUserDetailsManager(org.springframework.security.core.userdetails.User.withDefaultPasswordEncoder().username("basic-user").password("basic-password").roles("USER").build());
  }
}
