/** 
 * Basic tests for closeable bitmap
 */
@RunWith(RobolectricTestRunner.class) public class CloseableBitmapTest {
  @Mock public Bitmap mBitmap;
  @Mock public ResourceReleaser<Bitmap> mResourceReleaser;
  private CloseableStaticBitmap mCloseableStaticBitmap;
  @Before public void setup(){
    MockitoAnnotations.initMocks(this);
    mCloseableStaticBitmap=new CloseableStaticBitmap(mBitmap,mResourceReleaser,ImmutableQualityInfo.FULL_QUALITY,0,ExifInterface.ORIENTATION_UNDEFINED);
  }
  @Test public void testBasic() throws Exception {
    Assert.assertFalse(mCloseableStaticBitmap.isClosed());
    Assert.assertSame(mBitmap,mCloseableStaticBitmap.getUnderlyingBitmap());
    mCloseableStaticBitmap.close();
    Assert.assertTrue(mCloseableStaticBitmap.isClosed());
    Assert.assertNull(mCloseableStaticBitmap.getUnderlyingBitmap());
    verify(mResourceReleaser).release(mBitmap);
    mCloseableStaticBitmap.close();
    Assert.assertTrue(mCloseableStaticBitmap.isClosed());
    Assert.assertNull(mCloseableStaticBitmap.getUnderlyingBitmap());
  }
  @Test public void testFinalize() throws Throwable {
    mCloseableStaticBitmap.finalize();
    Assert.assertTrue(mCloseableStaticBitmap.isClosed());
    Assert.assertNull(mCloseableStaticBitmap.getUnderlyingBitmap());
    verify(mResourceReleaser).release(mBitmap);
  }
}
