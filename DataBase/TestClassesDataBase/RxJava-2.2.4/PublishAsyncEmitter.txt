static final class PublishAsyncEmitter implements FlowableOnSubscribe<Integer>, FlowableSubscriber<Integer> {
  final PublishProcessor<Integer> processor;
  FlowableEmitter<Integer> current;
  PublishAsyncEmitter(){
    this.processor=PublishProcessor.create();
  }
  long requested(){
    return current.requested();
  }
  @Override public void subscribe(  final FlowableEmitter<Integer> t){
    this.current=t;
    final ResourceSubscriber<Integer> as=new ResourceSubscriber<Integer>(){
      @Override public void onComplete(){
        t.onComplete();
      }
      @Override public void onError(      Throwable e){
        t.onError(e);
      }
      @Override public void onNext(      Integer v){
        t.onNext(v);
      }
    }
;
    processor.subscribe(as);
    t.setCancellable(new Cancellable(){
      @Override public void cancel() throws Exception {
        as.dispose();
      }
    }
);
    ;
  }
  @Override public void onSubscribe(  Subscription s){
    s.request(Long.MAX_VALUE);
  }
  @Override public void onNext(  Integer t){
    processor.onNext(t);
  }
  @Override public void onError(  Throwable e){
    processor.onError(e);
  }
  @Override public void onComplete(){
    processor.onComplete();
  }
}
