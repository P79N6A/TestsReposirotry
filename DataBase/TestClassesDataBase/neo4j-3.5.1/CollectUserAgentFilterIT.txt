public class CollectUserAgentFilterIT extends AbstractRestFunctionalTestBase {
  public static final String USER_AGENT="test/1.0";
  private static FunctionalTestHelper functionalTestHelper;
  @BeforeClass public static void setupServer(){
    functionalTestHelper=new FunctionalTestHelper(server());
  }
  @Test public void shouldRecordUserAgent(){
    sendRequest("test/1.0");
    assertThat(resolveDependency(UsageData.class).get(UsageDataKeys.clientNames),hasItem(USER_AGENT));
  }
  private void sendRequest(  String userAgent){
    String url=functionalTestHelper.baseUri().toString();
    JaxRsResponse resp=RestRequest.req().header("User-Agent",userAgent).get(url);
    String json=resp.getEntity();
    resp.close();
    assertEquals(json,200,resp.getStatus());
  }
}
