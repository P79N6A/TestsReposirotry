private class LabelCreator extends Thread {
  private final GraphDatabaseService database;
  private final CountDownLatch createLatch;
  LabelCreator(  GraphDatabaseService database,  CountDownLatch createLatch){
    this.database=database;
    this.createLatch=createLatch;
  }
  @Override public void run(){
    try {
      while (!stop) {
        try (Transaction transaction=database.beginTx()){
          Label[] createdLabels=getLabels();
          Node node=database.createNode(createdLabels);
          Iterable<Label> nodeLabels=node.getLabels();
          assertEquals(asSet(asList(createdLabels)),asSet(nodeLabels));
          transaction.success();
        }
 catch (        Exception e) {
          stop=true;
          throw e;
        }
      }
    }
  finally {
      createLatch.countDown();
    }
  }
}
