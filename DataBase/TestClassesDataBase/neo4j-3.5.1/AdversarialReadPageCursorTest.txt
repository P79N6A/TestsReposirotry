class AdversarialReadPageCursorTest {
  @Test void shouldNotMessUpUnrelatedSegmentOnReadBytes() throws Exception {
    byte[] buf=new byte[4];
    byte[] page=new byte[]{7};
    AdversarialReadPageCursor cursor=new AdversarialReadPageCursor(new ByteArrayPageCursor(page),new PageCacheRule.AtomicBooleanInconsistentReadAdversary(new AtomicBoolean(true)));
    cursor.next(0);
    cursor.getBytes(buf,buf.length - 1,1);
    cursor.shouldRetry();
    cursor.getBytes(buf,buf.length - 1,1);
    assertEquals(0,buf[0]);
    assertEquals(0,buf[1]);
    assertEquals(0,buf[2]);
  }
}
