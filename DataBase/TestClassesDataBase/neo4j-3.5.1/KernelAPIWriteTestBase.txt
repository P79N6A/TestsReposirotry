/** 
 * KernelAPIWriteTestBase is the basis of write tests targeting the Kernel API. Just as with KernelAPIReadTestBase, write tests cannot provide all the functionality needed to construct the test kernel, and also do not know how to assert the effects of the writes. These things are abstracted behind the KernelAPIWriteTestSupport interface, which needs to be implemented to test Kernel write implementations. Since write tests modify the graph, the test graph is recreated on every test run.
 * @param < WriteSupport > The test support for the current test.
 */
@SuppressWarnings("WeakerAccess") public abstract class KernelAPIWriteTestBase<WriteSupport extends KernelAPIWriteTestSupport> {
  protected static final TemporaryFolder folder=new TemporaryFolder();
  protected static KernelAPIWriteTestSupport testSupport;
  protected static GraphDatabaseService graphDb;
  /** 
 * Creates a new instance of WriteSupport, which will be used to execute the concrete test
 */
  public abstract WriteSupport newTestSupport();
  @Before public void setupGraph() throws IOException {
    if (testSupport == null) {
      folder.create();
      testSupport=newTestSupport();
      testSupport.setup(folder.getRoot());
      graphDb=testSupport.graphBackdoor();
    }
    testSupport.clearGraph();
  }
  protected Transaction beginTransaction() throws TransactionFailureException {
    Kernel kernel=testSupport.kernelToTest();
    return kernel.beginTransaction(Transaction.Type.implicit,LoginContext.AUTH_DISABLED);
  }
  @AfterClass public static void tearDown(){
    if (testSupport != null) {
      testSupport.tearDown();
      folder.delete();
      testSupport=null;
    }
  }
}
