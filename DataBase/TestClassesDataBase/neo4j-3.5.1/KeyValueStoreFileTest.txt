public class KeyValueStoreFileTest {
  public ExpectedException exception=ExpectedException.none();
  @Rule public RuleChain ruleChain=RuleChain.outerRule(Timeout.seconds(1000)).around(exception);
  @Test public void shouldFailAfterEnoughAttempts() throws IOException {
    WritableBuffer buffer=mock(WritableBuffer.class);
    PageCursor cursor=mock(PageCursor.class);
    when(cursor.shouldRetry()).thenReturn(true);
    when(cursor.getCurrentFile()).thenReturn(new File("foo/bar.a"));
    exception.expect(UnderlyingStorageException.class);
    KeyValueStoreFile.readKeyValuePair(cursor,42,buffer,buffer);
  }
}
