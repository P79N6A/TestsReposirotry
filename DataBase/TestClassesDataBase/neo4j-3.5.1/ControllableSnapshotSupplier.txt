private static class ControllableSnapshotSupplier implements Supplier<KernelTransactionsSnapshot> {
  KernelTransactionsSnapshot mostRecentlyReturned;
  @Override public KernelTransactionsSnapshot get(){
    return mostRecentlyReturned=mock(KernelTransactionsSnapshot.class);
  }
  void setMostRecentlyReturnedSnapshotToAllClosed(){
    when(mostRecentlyReturned.allClosed()).thenReturn(true);
  }
}
