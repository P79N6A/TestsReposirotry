private static class OrderVerifyingCommandHandler extends CommandVisitor.Adapter {
  private boolean nodeVisited;
  private boolean updated;
  private boolean deleted;
  @Override public boolean visitNodeCommand(  NodeCommand command){
    if (!nodeVisited) {
      updated=false;
      deleted=false;
    }
    nodeVisited=true;
switch (command.getMode()) {
case CREATE:
      assertFalse(updated);
    assertFalse(deleted);
  break;
case UPDATE:
updated=true;
assertFalse(deleted);
break;
case DELETE:
deleted=true;
break;
default :
throw new IllegalStateException("Unknown command mode: " + command.getMode());
}
return false;
}
}
