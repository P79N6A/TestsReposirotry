private static class CountingTransactionEventHandler extends AtomicInteger implements TransactionEventHandler<CountingTransactionEventHandler> {
  @Override public CountingTransactionEventHandler beforeCommit(  TransactionData data){
    getAndIncrement();
    return this;
  }
  @Override public void afterCommit(  TransactionData data,  CountingTransactionEventHandler state){
    getAndDecrement();
    assertThat(state,sameInstance(this));
  }
  @Override public void afterRollback(  TransactionData data,  CountingTransactionEventHandler state){
    getAndDecrement();
    assertThat(state,sameInstance(this));
  }
}
