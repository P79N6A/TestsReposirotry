public class TransactionTimeoutIT extends ExclusiveServerTestBase {
  private CommunityNeoServer server;
  @After public void stopTheServer(){
    server.stop();
  }
  @Test public void shouldHonorReallyLowSessionTimeout() throws Exception {
    server=serverOnRandomPorts().withProperty(ServerSettings.transaction_idle_timeout.name(),"1").build();
    server.start();
    String tx=HTTP.POST(txURI(),asList(map("statement","CREATE (n)"))).location();
    Thread.sleep(1000 * 5);
    Map<String,Object> response=HTTP.POST(tx + "/commit").content();
    @SuppressWarnings("unchecked") List<Map<String,Object>> errors=(List<Map<String,Object>>)response.get("errors");
    assertThat(errors.get(0).get("code"),equalTo(TransactionNotFound.code().serialize()));
  }
  private String txURI(){
    return server.baseUri().toString() + "db/data/transaction";
  }
}
