private static class MaintenanceThread extends Thread {
  private final DelayedBuffer buffer;
  private final long nanoInterval;
  private volatile boolean end;
  MaintenanceThread(  DelayedBuffer buffer,  long nanoInterval){
    this.buffer=buffer;
    this.nanoInterval=nanoInterval;
    start();
  }
  @Override public void run(){
    while (!end) {
      buffer.maintenance();
      LockSupport.parkNanos(nanoInterval);
    }
  }
  void halt() throws InterruptedException {
    end=true;
    while (isAlive()) {
      Thread.sleep(1);
    }
  }
}
