public class SchemaIndexMigratorTest {
  private final FileSystemAbstraction fs=mock(FileSystemAbstraction.class);
  private final ProgressReporter progressReporter=mock(ProgressReporter.class);
  private final IndexProvider indexProvider=mock(IndexProvider.class);
  private final DatabaseLayout databaseLayout=DatabaseLayout.of(new File("store"),GraphDatabaseSettings.DEFAULT_DATABASE_NAME);
  private final DatabaseLayout migrationLayout=DatabaseLayout.of(new File("migrationDir"),GraphDatabaseSettings.DEFAULT_DATABASE_NAME);
  private final SchemaIndexMigrator migrator=new SchemaIndexMigrator(fs,indexProvider);
  @Test public void schemaAndLabelIndexesRemovedAfterSuccessfulMigration() throws IOException {
    IndexDirectoryStructure directoryStructure=mock(IndexDirectoryStructure.class);
    File indexProviderRootDirectory=databaseLayout.file("just-some-directory");
    when(directoryStructure.rootDirectory()).thenReturn(indexProviderRootDirectory);
    when(indexProvider.directoryStructure()).thenReturn(directoryStructure);
    when(indexProvider.getProviderDescriptor()).thenReturn(new IndexProviderDescriptor("key","version"));
    migrator.migrate(databaseLayout,migrationLayout,progressReporter,StandardV2_3.STORE_VERSION,StandardV3_0.STORE_VERSION);
    migrator.moveMigratedFiles(migrationLayout,databaseLayout,StandardV2_3.STORE_VERSION,StandardV3_0.STORE_VERSION);
    verify(fs).deleteRecursively(indexProviderRootDirectory);
  }
}
