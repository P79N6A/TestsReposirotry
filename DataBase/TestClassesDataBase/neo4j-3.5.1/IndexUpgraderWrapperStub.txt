private static class IndexUpgraderWrapperStub extends IndexUpgraderWrapper {
  private final Set<String> migratedIndexes;
  private final boolean failIndexUpgrade;
  IndexUpgraderWrapperStub(  Supplier<EmbeddedJarLoader> jarLoaderSupplier,  Set<String> migratedIndexes,  boolean failIndexUpgrade){
    super(jarLoaderSupplier);
    this.migratedIndexes=migratedIndexes;
    this.failIndexUpgrade=failIndexUpgrade;
  }
  @Override public void upgradeIndex(  Path indexPath){
    if (failIndexUpgrade) {
      throw new RuntimeException("Fail index migration: " + indexPath);
    }
    migratedIndexes.add(indexPath.getFileName().toString());
  }
}
