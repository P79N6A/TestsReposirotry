@ExtendWith(TestDirectoryExtension.class) class PlatformModuleTest {
  @Inject private TestDirectory testDirectory;
  @Test void shouldRunDeferredExecutors() throws InterruptedException {
    AtomicInteger counter=new AtomicInteger(0);
    Semaphore lock=new Semaphore(1);
    BufferingExecutor later=new BufferingExecutor();
    GraphDatabaseDependencies externalDependencies=newDependencies().withDeferredExecutor(later,Group.LOG_ROTATION);
    lock.acquire(1);
    later.execute(counter::incrementAndGet);
    later.execute(lock::release);
    assertFalse(lock.tryAcquire(1,1,TimeUnit.SECONDS));
    assertThat(counter.get(),equalTo(0));
    PlatformModule pm=new PlatformModule(testDirectory.storeDir(),Config.defaults(),DatabaseInfo.UNKNOWN,externalDependencies);
    assertTrue(lock.tryAcquire(1,60,TimeUnit.SECONDS));
    assertThat(counter.get(),equalTo(1));
  }
}
