class UniqueDatabaseIndexSamplerTest {
  private final IndexSearcher indexSearcher=mock(IndexSearcher.class,Mockito.RETURNS_DEEP_STUBS);
  private final TaskCoordinator taskControl=new TaskCoordinator(0,TimeUnit.MILLISECONDS);
  @Test void uniqueSamplingUseDocumentsNumber() throws IndexNotFoundKernelException {
    when(indexSearcher.getIndexReader().numDocs()).thenReturn(17);
    UniqueLuceneIndexSampler sampler=new UniqueLuceneIndexSampler(indexSearcher,taskControl.newInstance());
    IndexSample sample=sampler.sampleIndex();
    assertEquals(17,sample.indexSize());
  }
  @Test void uniqueSamplingCancel(){
    when(indexSearcher.getIndexReader().numDocs()).thenAnswer(invocation -> {
      taskControl.cancel();
      return 17;
    }
);
    UniqueLuceneIndexSampler sampler=new UniqueLuceneIndexSampler(indexSearcher,taskControl.newInstance());
    IndexNotFoundKernelException notFoundKernelException=assertThrows(IndexNotFoundKernelException.class,sampler::sampleIndex);
    assertEquals(notFoundKernelException.getMessage(),"Index dropped while sampling.");
  }
}
