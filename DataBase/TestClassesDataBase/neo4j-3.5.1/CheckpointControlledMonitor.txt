private static class CheckpointControlledMonitor extends Monitor.Adaptor {
  private final Barrier.Control barrier=new Barrier.Control();
  private volatile boolean enabled;
  @Override public void checkpointCompleted(){
    if (enabled) {
      barrier.reached();
    }
  }
}
