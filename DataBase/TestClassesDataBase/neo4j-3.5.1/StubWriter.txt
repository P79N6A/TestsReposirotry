private static class StubWriter extends KeyValueWriter.Writer {
  IOException next;
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  @Override void write(  byte[] data) throws IOException {
    io();
    this.data.write(data);
  }
  @Override KeyValueStoreFile open(  Metadata metadata,  int keySize,  int valueSize){
    return null;
  }
  @Override void close() throws IOException {
    io();
  }
  public void assertData(  byte... expected){
    assertArrayEquals(expected,this.data.toByteArray());
  }
  private void io() throws IOException {
    try {
      if (next != null) {
        throw next;
      }
    }
  finally {
      next=null;
    }
  }
}
