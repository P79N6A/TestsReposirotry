public class IndexUpgraderWrapperTest {
  @Test public void indexUpgraderInvokesLuceneMigrator() throws Throwable {
    IndexUpgraderWrapper upgrader=getIndexUpgrader(createJarLoader());
    UpgraderStub.resetInvocationMark();
    upgrader.upgradeIndex(Paths.get("some"));
    assertTrue(UpgraderStub.getInvocationMark());
  }
  @Test public void indexUpgraderReleaseResourcesOnClose() throws Throwable {
    EmbeddedJarLoader jarLoader=createJarLoader();
    IndexUpgraderWrapper upgrader=getIndexUpgrader(jarLoader);
    upgrader.upgradeIndex(Paths.get("some"));
    upgrader.close();
    verify(jarLoader).close();
  }
  private IndexUpgraderWrapper getIndexUpgrader(  EmbeddedJarLoader jarLoader){
    return new IndexUpgraderWrapper(() -> jarLoader);
  }
  private EmbeddedJarLoader createJarLoader() throws ClassNotFoundException, IOException {
    EmbeddedJarLoader jarLoader=Mockito.mock(EmbeddedJarLoader.class);
    when(jarLoader.loadEmbeddedClass(anyString())).thenReturn(UpgraderStub.class);
    return jarLoader;
  }
}
