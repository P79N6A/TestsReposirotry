public class BatchedFlushStrategyTest {
  @Test public void testFlush(){
    DirectRecordAccessSet recordAccessSet=Mockito.mock(DirectRecordAccessSet.class);
    BatchInserterImpl.BatchedFlushStrategy flushStrategy=createFlushStrategy(recordAccessSet,2);
    flushStrategy.flush();
    Mockito.verifyZeroInteractions(recordAccessSet);
    flushStrategy.flush();
    Mockito.verify(recordAccessSet).commit();
    Mockito.reset(recordAccessSet);
    flushStrategy.flush();
    flushStrategy.flush();
    flushStrategy.flush();
    flushStrategy.flush();
    flushStrategy.flush();
    flushStrategy.flush();
    flushStrategy.flush();
    Mockito.verify(recordAccessSet,Mockito.times(3)).commit();
  }
  @Test public void testForceFlush(){
    DirectRecordAccessSet recordAccessSet=Mockito.mock(DirectRecordAccessSet.class);
    BatchInserterImpl.BatchedFlushStrategy flushStrategy=createFlushStrategy(recordAccessSet,2);
    flushStrategy.forceFlush();
    flushStrategy.forceFlush();
    Mockito.verify(recordAccessSet,Mockito.times(2)).commit();
    flushStrategy.flush();
    flushStrategy.forceFlush();
    Mockito.verify(recordAccessSet,Mockito.times(3)).commit();
  }
  @Test public void testResetBatchCounterOnForce(){
    DirectRecordAccessSet recordAccessSet=Mockito.mock(DirectRecordAccessSet.class);
    BatchInserterImpl.BatchedFlushStrategy flushStrategy=createFlushStrategy(recordAccessSet,3);
    flushStrategy.flush();
    flushStrategy.flush();
    Mockito.verifyZeroInteractions(recordAccessSet);
    flushStrategy.forceFlush();
    Mockito.verify(recordAccessSet).commit();
    Mockito.verifyNoMoreInteractions(recordAccessSet);
    flushStrategy.flush();
    flushStrategy.flush();
  }
  private BatchInserterImpl.BatchedFlushStrategy createFlushStrategy(  DirectRecordAccessSet recordAccessSet,  int batchSize){
    return new BatchInserterImpl.BatchedFlushStrategy(recordAccessSet,batchSize);
  }
}
