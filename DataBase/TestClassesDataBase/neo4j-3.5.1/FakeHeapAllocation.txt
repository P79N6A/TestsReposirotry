public class FakeHeapAllocation extends HeapAllocation implements TestRule {
  private final MutableLongLongMap allocation=new LongLongHashMap();
  @Override public long allocatedBytes(  long threadId){
    return Math.max(0,allocation.get(threadId));
  }
  public FakeHeapAllocation add(  long bytes){
    return add(currentThread().getId(),bytes);
  }
  public FakeHeapAllocation add(  long threadId,  long bytes){
    allocation.put(threadId,allocatedBytes(threadId) + bytes);
    return this;
  }
  @Override public Statement apply(  Statement base,  Description description){
    return new Statement(){
      @Override public void evaluate() throws Throwable {
        base.evaluate();
      }
    }
;
  }
}
