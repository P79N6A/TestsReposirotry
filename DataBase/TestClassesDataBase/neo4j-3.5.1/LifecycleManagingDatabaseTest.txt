public class LifecycleManagingDatabaseTest {
  @Test public void mustIgnoreExceptionsFromPreLoadingCypherQuery(){
    final GraphDatabaseFacade mockDb=mock(GraphDatabaseFacade.class);
    Config config=Config.defaults();
    GraphDatabaseFacadeFactory.Dependencies deps=GraphDatabaseDependencies.newDependencies().userLogProvider(NullLogProvider.getInstance());
    GraphFactory factory=new SimpleGraphFactory(mockDb);
    LifecycleManagingDatabase db=new LifecycleManagingDatabase(config,factory,deps){
      @Override protected boolean isInTestMode(){
        return false;
      }
    }
;
    when(mockDb.execute(LifecycleManagingDatabase.CYPHER_WARMUP_QUERY)).thenThrow(new TransactionFailureException("Boo"));
    db.init();
    db.start();
    assertTrue("the database should be running",db.isRunning());
    db.stop();
    db.shutdown();
  }
}
