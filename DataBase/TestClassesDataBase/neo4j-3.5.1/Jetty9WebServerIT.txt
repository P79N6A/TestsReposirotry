public class Jetty9WebServerIT extends ExclusiveServerTestBase {
  @Rule public SuppressOutput suppressOutput=suppressAll();
  @Rule public ImpermanentDatabaseRule dbRule=new ImpermanentDatabaseRule();
  private Jetty9WebServer webServer;
  @Test public void shouldBeAbleToUsePortZero() throws Exception {
    webServer=new Jetty9WebServer(NullLogProvider.getInstance(),Config.defaults(),NetworkConnectionTracker.NO_OP);
    webServer.setHttpAddress(new ListenSocketAddress("localhost",0));
    webServer.start();
  }
  @Test public void shouldBeAbleToRestart() throws Throwable {
    webServer=new Jetty9WebServer(NullLogProvider.getInstance(),Config.defaults(),NetworkConnectionTracker.NO_OP);
    webServer.setHttpAddress(new ListenSocketAddress("127.0.0.1",7878));
    webServer.start();
    webServer.stop();
    webServer.start();
  }
  @Test public void shouldStopCleanlyEvenWhenItHasntBeenStarted(){
    new Jetty9WebServer(NullLogProvider.getInstance(),Config.defaults(),NetworkConnectionTracker.NO_OP).stop();
  }
  @After public void cleanup(){
    if (webServer != null) {
      webServer.stop();
    }
  }
}
