private static class LockNode implements ThreadRepository.Task {
  private final LockService locks;
  private final long nodeId;
  private Lock lock;
  LockNode(  LockService locks,  long nodeId){
    this.locks=locks;
    this.nodeId=nodeId;
  }
  private final ThreadRepository.Task release=new ThreadRepository.Task(){
    @Override public void perform(){
      lock.release();
    }
  }
;
  @Override public void perform(){
    this.lock=locks.acquireNodeLock(nodeId,LockService.LockType.WRITE_LOCK);
  }
}
