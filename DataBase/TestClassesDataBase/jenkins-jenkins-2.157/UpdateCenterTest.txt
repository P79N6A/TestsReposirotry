/** 
 * Quick test for  {@link UpdateCenter}.
 * @author Kohsuke Kawaguchi
 */
public class UpdateCenterTest {
  @Test public void data() throws Exception {
    try {
      doData("https://updates.jenkins.io/update-center.json?version=build");
      doData("https://updates.jenkins.io/stable/update-center.json?version=build");
    }
 catch (    Exception x) {
      assumeNoException("Might be no Internet connectivity, or might start failing due to expiring certificate through no fault of code changes",x);
    }
  }
  private void doData(  String location) throws Exception {
    URL url=new URL(location);
    String jsonp=DownloadService.loadJSON(url);
    JSONObject json=JSONObject.fromObject(jsonp);
    UpdateSite us=new UpdateSite("default",url.toExternalForm());
    UpdateSite.Data data=us.new Data(json);
    assertTrue(data.core.url.startsWith("http://updates.jenkins-ci.org/"));
    assertTrue(data.plugins.containsKey("rake"));
    System.out.println(data.core.url);
    CertificateFactory cf=CertificateFactory.getInstance("X509");
    JSONObject signature=json.getJSONObject("signature");
    for (    Object cert : signature.getJSONArray("certificates")) {
      X509Certificate c=(X509Certificate)cf.generateCertificate(new ByteArrayInputStream(Base64.decode(cert.toString().toCharArray())));
      c.checkValidity(new Date(System.currentTimeMillis() + TimeUnit.DAYS.toMillis(30)));
    }
  }
}
