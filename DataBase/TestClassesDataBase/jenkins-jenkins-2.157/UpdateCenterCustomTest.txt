/** 
 * Tests of the custom  {@link UpdateCenter} implementation.
 */
public class UpdateCenterCustomTest {
  @Rule public final JenkinsRule j=new CustomUpdateCenterRule(CustomUpdateCenter.class);
  @Test public void shouldStartupWithCustomUpdateCenter() throws Exception {
    UpdateCenter uc=j.jenkins.getUpdateCenter();
    assertThat("Update Center must be a custom instance",uc,instanceOf(CustomUpdateCenter.class));
  }
private static final class CustomUpdateCenterRule extends JenkinsRule {
    private final String updateCenterClassName;
    private String _oldValue=null;
    private static final String PROPERTY_NAME=UpdateCenter.class.getName() + ".className";
    public CustomUpdateCenterRule(    Class<?> ucClass){
      this.updateCenterClassName=ucClass.getName();
    }
    @Override protected ServletContext createWebServer() throws Exception {
      _oldValue=System.getProperty(PROPERTY_NAME);
      System.setProperty(PROPERTY_NAME,updateCenterClassName);
      return super.createWebServer();
    }
    @Override public void after() throws Exception {
      if (_oldValue != null) {
        System.setProperty(PROPERTY_NAME,_oldValue);
      }
    }
    public String getUpdateCenterClassName(){
      return updateCenterClassName;
    }
  }
public static final class CustomUpdateCenter extends UpdateCenter {
    public CustomUpdateCenter(){
      super();
    }
    public CustomUpdateCenter(    UpdateCenterConfiguration config){
      super(config);
    }
  }
}
