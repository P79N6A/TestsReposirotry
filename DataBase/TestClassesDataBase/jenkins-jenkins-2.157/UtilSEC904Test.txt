/** 
 * @author Kohsuke Kawaguchi
 */
public class UtilSEC904Test {
  @Rule public TemporaryFolder tmp=new TemporaryFolder();
  @Test public void resolveSymlinkToFile() throws Exception {
    File root=tmp.getRoot();
    File a=new File(root,"a");
    File aa=new File(a,"aa");
    aa.mkdirs();
    File aaTxt=new File(aa,"aa.txt");
    FileUtils.write(aaTxt,"aa");
    File b=new File(root,"b");
    b.mkdir();
    File _a=new File(b,"_a");
    Util.createSymlink(_a.getParentFile(),a.getAbsolutePath(),_a.getName(),TaskListener.NULL);
    File _b=new File(a,"_b");
    Util.createSymlink(_b.getParentFile(),b.getAbsolutePath(),_b.getName(),TaskListener.NULL);
    assertTrue(Files.isSymbolicLink(_a.toPath()));
    assertTrue(Files.isSymbolicLink(_b.toPath()));
    assertEquals(Util.resolveSymlinkToFile(_a),a);
    assertEquals(Util.resolveSymlinkToFile(_b),b);
    assertNull(Util.resolveSymlinkToFile(new File(_a,"aa")));
    assertNull(Util.resolveSymlinkToFile(new File(_a,"aa/aa.txt")));
  }
}
