public class SystemConfigurationTestCase {
  @Rule public JenkinsRule j=new JenkinsRule();
  private PageDecoratorImpl pageDecoratorImpl;
  @After public void tearDown(){
    if (pageDecoratorImpl != null) {
      PageDecorator.ALL.remove(pageDecoratorImpl);
    }
  }
  @Test @Issue("JENKINS-2289") public void pageDecoratorIsListedInPage() throws Exception {
    pageDecoratorImpl=new PageDecoratorImpl();
    PageDecorator.ALL.add(pageDecoratorImpl);
    HtmlPage page=j.createWebClient().goTo("configure");
    j.assertXPath(page,"//tr[@name='hudson-pages-SystemConfigurationTestCase$PageDecoratorImpl']");
    HtmlForm form=page.getFormByName("config");
    form.getInputByName("_.decoratorId").setValueAttribute("this_is_a_profile");
    j.submit(form);
    assertEquals("The decorator field was incorrect","this_is_a_profile",pageDecoratorImpl.getDecoratorId());
  }
private static class PageDecoratorImpl extends PageDecorator {
    private String decoratorId;
    @Override public boolean configure(    StaplerRequest req,    JSONObject json) throws FormException {
      decoratorId=json.getString("decoratorId");
      return true;
    }
    public String getDecoratorId(){
      return decoratorId;
    }
  }
}
