public class AccessDeniedException2Test {
  @Rule public JenkinsRule r=new JenkinsRule();
  @Issue("JENKINS-39402") @Test public void youAreInGroupHeaders() throws Exception {
    JenkinsRule.DummySecurityRealm realm=r.createDummySecurityRealm();
    String[] groups=new String[1000];
    for (int i=0; i < groups.length; i++) {
      groups[i]="group" + i;
    }
    realm.addGroups("user",groups);
    r.jenkins.setSecurityRealm(realm);
    r.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy());
    try {
      r.createWebClient().login("user");
      fail("should not have been allowed to access anything");
    }
 catch (    FailingHttpStatusCodeException x) {
      assertEquals(HttpURLConnection.HTTP_FORBIDDEN,x.getStatusCode());
      assertNotNull(x.getResponse().getResponseHeaderValue("X-You-Are-In-Group-Disabled"));
    }
  }
}
