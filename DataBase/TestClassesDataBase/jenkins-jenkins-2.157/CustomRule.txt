static class CustomRule extends JenkinsRule {
  @Override public void before() throws Throwable {
    env=new TestEnvironment(testDescription);
    env.pin();
  }
  @Override public Hudson newHudson() throws Exception {
    ServletContext ws=createWebServer();
    wa=new WebAppMain(){
      @Override public WebAppMain.FileAndDescription getHomeDir(      ServletContextEvent event){
        try {
          return new WebAppMain.FileAndDescription(homeLoader.allocate(),"test");
        }
 catch (        Exception x) {
          throw new AssertionError(x);
        }
      }
    }
;
    wa.contextInitialized(new ServletContextEvent(ws));
    wa.joinInit();
    Object a=WebApp.get(ws).getApp();
    if (a instanceof Hudson) {
      return (Hudson)a;
    }
    return null;
  }
}
