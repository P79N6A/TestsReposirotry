/** 
 * Tests for ItemListener events.
 * @author Alan.Harder@sun.com
 */
public class ItemListenerTest {
  @Rule public JenkinsRule j=new JenkinsRule();
  private StringBuffer events=new StringBuffer();
  @Before public void setUp() throws Exception {
    ItemListener listener=new ItemListener(){
      @Override public void onCreated(      Item item){
        events.append('C');
      }
      @Override public void onCopied(      Item src,      Item item){
        events.append('Y');
      }
    }
;
    ItemListener.all().add(0,listener);
  }
  @Test public void onCreatedViaCLI() throws Exception {
    CLICommandInvoker.Result result=new CLICommandInvoker(j,"create-job").withStdin(new ByteArrayInputStream(("<project><actions/><builders/><publishers/><buildWrappers/></project>").getBytes())).invokeWithArgs("testJob");
    assertThat(result,CLICommandInvoker.Matcher.succeeded());
    assertNotNull("job should be created: " + result,j.jenkins.getItem("testJob"));
    assertEquals("onCreated event should be triggered: " + result,"C",events.toString());
  }
}
