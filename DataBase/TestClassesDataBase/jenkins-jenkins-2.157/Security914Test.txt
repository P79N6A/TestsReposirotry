@Issue("SECURITY-914") public class Security914Test {
  @Rule public JenkinsRule j=new JenkinsRule();
  @Test public void cannotUseInvalidLocale_toTraverseFolder() throws Exception {
    Assume.assumeTrue(Functions.isWindows());
    if (j.jenkins.pluginManager.getPlugin("credentials") == null) {
      ((TestPluginManager)j.jenkins.pluginManager).installDetachedPlugin("credentials");
    }
    j.createWebClient().goTo("plugin/credentials/images/24x24/credentials.png","image/png");
    JenkinsRule.WebClient wc=j.createWebClient();
    wc.getOptions().setThrowExceptionOnFailingStatusCode(false);
    WebRequest request=new WebRequest(new URL(j.getURL() + "plugin/credentials/.xml"));
    request.setAdditionalHeader("Accept-Language","../../../../jenkinsTests.tmp/" + j.jenkins.getRootDir().getName() + "/config");
    Page p=wc.getPage(request);
    assertEquals(p.getWebResponse().getStatusCode(),404);
    assertNotEquals(p.getWebResponse().getContentType(),"application/xml");
  }
  @Test public void cannotUseInvalidLocale_toAnyFileInSystem() throws Exception {
    Assume.assumeTrue(Functions.isWindows());
    if (j.jenkins.pluginManager.getPlugin("credentials") == null) {
      ((TestPluginManager)j.jenkins.pluginManager).installDetachedPlugin("credentials");
    }
    j.createWebClient().goTo("plugin/credentials/images/24x24/credentials.png","image/png");
    JenkinsRule.WebClient wc=j.createWebClient();
    wc.getOptions().setThrowExceptionOnFailingStatusCode(false);
    WebRequest request=new WebRequest(new URL(j.getURL() + "plugin/credentials/.ini"));
    request.setAdditionalHeader("Accept-Language","../../../../../../../../../../../../windows/win");
    Page p=wc.getPage(request);
    assertEquals(p.getWebResponse().getStatusCode(),404);
    assertEquals(p.getWebResponse().getContentType(),"text/html");
  }
}
