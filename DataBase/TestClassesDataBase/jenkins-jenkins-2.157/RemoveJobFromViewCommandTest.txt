/** 
 * @author pjanouse
 */
public class RemoveJobFromViewCommandTest extends ViewManipulationTestBase {
  @Override public CLICommandInvoker getCommand(){
    return new CLICommandInvoker(j,"remove-job-from-view");
  }
  @Test public void removeJobShouldSucceed() throws Exception {
    j.jenkins.addView(new ListView("aView"));
    FreeStyleProject project=j.createFreeStyleProject("aProject");
    ((DirectlyModifiableView)j.jenkins.getView("aView")).add(project);
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(1));
    assertThat(j.jenkins.getView("aView").contains(project),equalTo(true));
    final CLICommandInvoker.Result result=command.authorizedTo(Jenkins.READ,View.READ,Job.READ,View.CONFIGURE).invokeWithArgs("aView","aProject");
    assertThat(result,succeededSilently());
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(0));
    assertThat(j.jenkins.getView("aView").contains(project),equalTo(false));
  }
  @Test public void removeJobManyShouldSucceed() throws Exception {
    j.jenkins.addView(new ListView("aView"));
    FreeStyleProject project1=j.createFreeStyleProject("aProject1");
    FreeStyleProject project2=j.createFreeStyleProject("aProject2");
    ((DirectlyModifiableView)j.jenkins.getView("aView")).add(project1);
    ((DirectlyModifiableView)j.jenkins.getView("aView")).add(project2);
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(2));
    assertThat(j.jenkins.getView("aView").contains(project1),equalTo(true));
    assertThat(j.jenkins.getView("aView").contains(project2),equalTo(true));
    final CLICommandInvoker.Result result=command.authorizedTo(Jenkins.READ,View.READ,Job.READ,View.CONFIGURE).invokeWithArgs("aView","aProject1","aProject2");
    assertThat(result,succeededSilently());
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(0));
    assertThat(j.jenkins.getView("aView").contains(project1),equalTo(false));
    assertThat(j.jenkins.getView("aView").contains(project2),equalTo(false));
  }
  @Test public void removeJobManyShouldSucceedEvenAJobIsSpecifiedTwice() throws Exception {
    j.jenkins.addView(new ListView("aView"));
    FreeStyleProject project=j.createFreeStyleProject("aProject");
    ((DirectlyModifiableView)j.jenkins.getView("aView")).add(project);
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(1));
    assertThat(j.jenkins.getView("aView").contains(project),equalTo(true));
    final CLICommandInvoker.Result result=command.authorizedTo(Jenkins.READ,View.READ,Job.READ,View.CONFIGURE).invokeWithArgs("aView","aProject","aProject");
    assertThat(result,succeededSilently());
    assertThat(j.jenkins.getView("aView").getAllItems().size(),equalTo(0));
    assertThat(j.jenkins.getView("aView").contains(project),equalTo(false));
  }
}
