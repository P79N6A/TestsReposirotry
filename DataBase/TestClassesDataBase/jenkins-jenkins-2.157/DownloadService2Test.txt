@Issue("SECURITY-163") public class DownloadService2Test {
  @Rule public JenkinsRule r=new JenkinsRule();
  @Test public void updateNow() throws Exception {
    for (    DownloadService.Downloadable d : DownloadService.Downloadable.all()) {
      FormValidation v=d.updateNow();
      assertEquals(v.toString(),FormValidation.Kind.OK,v.kind);
    }
  }
  @WithoutJenkins @Test public void loadJSONHTML() throws Exception {
    assertRoots("[list, signature]","hudson.tasks.Maven.MavenInstaller.json.html");
    assertRoots("[data, signature, version]","hudson.tools.JDKInstaller.json.html");
  }
  private static void assertRoots(  String expected,  String file) throws Exception {
    URL resource=DownloadService2Test.class.getResource(file);
    assertNotNull(file,resource);
    JSONObject json=JSONObject.fromObject(DownloadService.loadJSONHTML(resource));
    @SuppressWarnings("unchecked") Set<String> keySet=json.keySet();
    assertEquals(expected,new TreeSet<String>(keySet).toString());
  }
}
