public class SetupWizardRestartTest {
  @Rule public RestartableJenkinsRule rr=new RestartableJenkinsRule();
  @Issue("JENKINS-47439") @Test public void restartKeepsSetupWizardState(){
    rr.addStep(new Statement(){
      @Override public void evaluate() throws IOException {
        Main.isUnitTest=false;
        FileUtils.write(InstallUtil.getLastExecVersionFile(),"");
        Jenkins j=rr.j.getInstance();
        InstallUtil.proceedToNextStateFrom(InstallState.UNKNOWN);
        assertEquals("Unexpected install state",InstallState.NEW,j.getInstallState());
        assertTrue("Expecting setup wizard filter to be up",j.getSetupWizard().hasSetupWizardFilter());
        InstallUtil.saveLastExecVersion();
      }
    }
);
    rr.addStep(new Statement(){
      @Override public void evaluate(){
        Jenkins j=rr.j.getInstance();
        assertEquals("Unexpected install state",InstallState.NEW,j.getInstallState());
        assertTrue("Expecting setup wizard filter to be up after restart",j.getSetupWizard().hasSetupWizardFilter());
      }
    }
);
  }
}
