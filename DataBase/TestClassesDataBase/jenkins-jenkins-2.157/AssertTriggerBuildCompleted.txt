private static final class AssertTriggerBuildCompleted extends TestBuilder {
  private final FreeStyleProject us;
  private final WebClient wc;
  private AssertTriggerBuildCompleted(  FreeStyleProject us,  WebClient wc){
    this.us=us;
    this.wc=wc;
  }
  @Override public boolean perform(  AbstractBuild<?,?> build,  Launcher launcher,  BuildListener listener) throws InterruptedException, IOException {
    FreeStyleBuild success=us.getLastSuccessfulBuild();
    FreeStyleBuild last=us.getLastBuild();
    try {
      assertFalse("Upstream build is not completed after downstream started",last.isBuilding());
      assertNotNull("Upstream build permalink not correctly updated",success);
      assertEquals(1,success.getNumber());
    }
 catch (    AssertionError ex) {
      System.err.println("Upstream build log: " + last.getLog());
      throw ex;
    }
    try {
      wc.getPage(us,"lastSuccessfulBuild");
    }
 catch (    SAXException ex) {
      throw new AssertionError(ex);
    }
    return true;
  }
}
