public class SecurityRealmTest {
  @Rule public JenkinsRule j=new JenkinsRule();
  @Test @Issue("JENKINS-43852") public void testCacheHeaderInResponse() throws Exception {
    SecurityRealm securityRealm=j.createDummySecurityRealm();
    j.jenkins.setSecurityRealm(securityRealm);
    WebResponse response=j.createWebClient().goTo("securityRealm/captcha","").getWebResponse();
    assertEquals(response.getContentAsString(),"");
    securityRealm.setCaptchaSupport(new DummyCaptcha());
    response=j.createWebClient().goTo("securityRealm/captcha","image/png").getWebResponse();
    assertThat(response.getResponseHeaderValue("Cache-Control"),is("no-cache, no-store, must-revalidate"));
    assertThat(response.getResponseHeaderValue("Pragma"),is("no-cache"));
    assertThat(response.getResponseHeaderValue("Expires"),is("0"));
  }
private class DummyCaptcha extends CaptchaSupport {
    @Override public boolean validateCaptcha(    String id,    String text){
      return false;
    }
    @Override public void generateImage(    String id,    OutputStream ios) throws IOException {
    }
  }
}
