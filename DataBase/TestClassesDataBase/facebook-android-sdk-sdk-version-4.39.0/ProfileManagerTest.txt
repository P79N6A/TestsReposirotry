@PrepareForTest({ProfileCache.class}) public class ProfileManagerTest extends FacebookPowerMockTestCase {
  @Before public void before(){
    FacebookSdk.setApplicationId("123456789");
    FacebookSdk.setAutoLogAppEventsEnabled(false);
    FacebookSdk.sdkInitialize(RuntimeEnvironment.application);
  }
  @Test public void testLoadCurrentProfileEmptyCache(){
    ProfileCache profileCache=mock(ProfileCache.class);
    LocalBroadcastManager localBroadcastManager=mock(LocalBroadcastManager.class);
    ProfileManager profileManager=new ProfileManager(localBroadcastManager,profileCache);
    assertFalse(profileManager.loadCurrentProfile());
    verify(profileCache,times(1)).load();
  }
  @Test public void testLoadCurrentProfileWithCache(){
    ProfileCache profileCache=mock(ProfileCache.class);
    Profile profile=ProfileTest.createDefaultProfile();
    when(profileCache.load()).thenReturn(profile);
    LocalBroadcastManager localBroadcastManager=mock(LocalBroadcastManager.class);
    ProfileManager profileManager=new ProfileManager(localBroadcastManager,profileCache);
    assertTrue(profileManager.loadCurrentProfile());
    verify(profileCache,times(1)).load();
    verify(profileCache,never()).save(any(Profile.class));
    verify(localBroadcastManager).sendBroadcast(any(Intent.class));
    profileManager.setCurrentProfile(ProfileTest.createDefaultProfile());
    verify(localBroadcastManager,times(1)).sendBroadcast(any(Intent.class));
    profileManager.setCurrentProfile(null);
    verify(localBroadcastManager,times(2)).sendBroadcast(any(Intent.class));
  }
}
