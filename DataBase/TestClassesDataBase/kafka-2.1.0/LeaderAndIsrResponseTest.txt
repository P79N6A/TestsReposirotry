public class LeaderAndIsrResponseTest {
  @Test public void testErrorCountsFromGetErrorResponse(){
    HashMap<TopicPartition,LeaderAndIsrRequest.PartitionState> partitionStates=new HashMap<>();
    partitionStates.put(new TopicPartition("foo",0),new LeaderAndIsrRequest.PartitionState(15,1,10,Collections.singletonList(10),20,Collections.singletonList(10),false));
    partitionStates.put(new TopicPartition("foo",1),new LeaderAndIsrRequest.PartitionState(15,1,10,Collections.singletonList(10),20,Collections.singletonList(10),false));
    LeaderAndIsrRequest request=new LeaderAndIsrRequest.Builder(ApiKeys.LEADER_AND_ISR.latestVersion(),15,20,partitionStates,Collections.<Node>emptySet()).build();
    LeaderAndIsrResponse response=request.getErrorResponse(0,Errors.CLUSTER_AUTHORIZATION_FAILED.exception());
    assertEquals(Collections.singletonMap(Errors.CLUSTER_AUTHORIZATION_FAILED,2),response.errorCounts());
  }
  @Test public void testErrorCountsWithTopLevelError(){
    Map<TopicPartition,Errors> errors=new HashMap<>();
    errors.put(new TopicPartition("foo",0),Errors.NONE);
    errors.put(new TopicPartition("foo",1),Errors.NOT_LEADER_FOR_PARTITION);
    LeaderAndIsrResponse response=new LeaderAndIsrResponse(Errors.UNKNOWN_SERVER_ERROR,errors);
    assertEquals(Collections.singletonMap(Errors.UNKNOWN_SERVER_ERROR,2),response.errorCounts());
  }
  @Test public void testErrorCountsNoTopLevelError(){
    Map<TopicPartition,Errors> errors=new HashMap<>();
    errors.put(new TopicPartition("foo",0),Errors.NONE);
    errors.put(new TopicPartition("foo",1),Errors.CLUSTER_AUTHORIZATION_FAILED);
    LeaderAndIsrResponse response=new LeaderAndIsrResponse(Errors.NONE,errors);
    Map<Errors,Integer> errorCounts=response.errorCounts();
    assertEquals(2,errorCounts.size());
    assertEquals(1,errorCounts.get(Errors.NONE).intValue());
    assertEquals(1,errorCounts.get(Errors.CLUSTER_AUTHORIZATION_FAILED).intValue());
  }
  @Test public void testToString(){
    Map<TopicPartition,Errors> errors=new HashMap<>();
    errors.put(new TopicPartition("foo",0),Errors.NONE);
    errors.put(new TopicPartition("foo",1),Errors.CLUSTER_AUTHORIZATION_FAILED);
    LeaderAndIsrResponse response=new LeaderAndIsrResponse(Errors.NONE,errors);
    String responseStr=response.toString();
    assertTrue(responseStr.contains(LeaderAndIsrResponse.class.getSimpleName()));
    assertTrue(responseStr.contains(errors.toString()));
    assertTrue(responseStr.contains(Errors.NONE.name()));
  }
}
