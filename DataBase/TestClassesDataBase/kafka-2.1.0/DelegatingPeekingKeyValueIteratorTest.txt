public class DelegatingPeekingKeyValueIteratorTest {
  private final String name="name";
  private InMemoryKeyValueStore<String,String> store;
  @Before public void setUp(){
    store=new InMemoryKeyValueStore<>(name,Serdes.String(),Serdes.String());
  }
  @Test public void shouldPeekNextKey(){
    store.put("A","A");
    final DelegatingPeekingKeyValueIterator<String,String> peekingIterator=new DelegatingPeekingKeyValueIterator<>(name,store.all());
    assertEquals("A",peekingIterator.peekNextKey());
    assertEquals("A",peekingIterator.peekNextKey());
    assertTrue(peekingIterator.hasNext());
    peekingIterator.close();
  }
  @Test public void shouldPeekNext(){
    store.put("A","A");
    final DelegatingPeekingKeyValueIterator<String,String> peekingIterator=new DelegatingPeekingKeyValueIterator<>(name,store.all());
    assertEquals(KeyValue.pair("A","A"),peekingIterator.peekNext());
    assertEquals(KeyValue.pair("A","A"),peekingIterator.peekNext());
    assertTrue(peekingIterator.hasNext());
    peekingIterator.close();
  }
  @Test public void shouldPeekAndIterate(){
    final String[] kvs={"a","b","c","d","e","f"};
    for (    final String kv : kvs) {
      store.put(kv,kv);
    }
    final DelegatingPeekingKeyValueIterator<String,String> peekingIterator=new DelegatingPeekingKeyValueIterator<>(name,store.all());
    int index=0;
    while (peekingIterator.hasNext()) {
      final String peekNext=peekingIterator.peekNextKey();
      final String key=peekingIterator.next().key;
      assertEquals(kvs[index],peekNext);
      assertEquals(kvs[index],key);
      index++;
    }
    assertEquals(kvs.length,index);
    peekingIterator.close();
  }
  @Test(expected=NoSuchElementException.class) public void shouldThrowNoSuchElementWhenNoMoreItemsLeftAndNextCalled(){
    final DelegatingPeekingKeyValueIterator<String,String> peekingIterator=new DelegatingPeekingKeyValueIterator<>(name,store.all());
    peekingIterator.next();
    peekingIterator.close();
  }
  @Test(expected=NoSuchElementException.class) public void shouldThrowNoSuchElementWhenNoMoreItemsLeftAndPeekNextCalled(){
    final DelegatingPeekingKeyValueIterator<String,String> peekingIterator=new DelegatingPeekingKeyValueIterator<>(name,store.all());
    peekingIterator.peekNextKey();
    peekingIterator.close();
  }
}
