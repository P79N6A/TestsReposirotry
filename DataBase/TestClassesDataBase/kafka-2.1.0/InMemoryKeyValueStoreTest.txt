public class InMemoryKeyValueStoreTest extends AbstractKeyValueStoreTest {
  @SuppressWarnings("unchecked") @Override protected <K,V>KeyValueStore<K,V> createKeyValueStore(  final ProcessorContext context){
    final StoreBuilder storeBuilder=Stores.keyValueStoreBuilder(Stores.inMemoryKeyValueStore("my-store"),(Serde<K>)context.keySerde(),(Serde<V>)context.valueSerde());
    final StateStore store=storeBuilder.build();
    store.init(context,store);
    return (KeyValueStore<K,V>)store;
  }
  @Test public void shouldRemoveKeysWithNullValues(){
    store.close();
    driver.addEntryToRestoreLog(0,"zero");
    driver.addEntryToRestoreLog(1,"one");
    driver.addEntryToRestoreLog(2,"two");
    driver.addEntryToRestoreLog(3,"three");
    driver.addEntryToRestoreLog(0,null);
    store=createKeyValueStore(driver.context());
    context.restore(store.name(),driver.restoredEntries());
    assertEquals(3,driver.sizeOf(store));
    assertThat(store.get(0),nullValue());
  }
}
