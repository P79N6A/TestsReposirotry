private abstract static class AbstractTestInterceptor implements ChannelInterceptor {
  private AtomicInteger counter=new AtomicInteger();
  private volatile boolean afterCompletionInvoked;
  public AtomicInteger getCounter(){
    return this.counter;
  }
  public boolean wasAfterCompletionInvoked(){
    return this.afterCompletionInvoked;
  }
  @Override public Message<?> preSend(  Message<?> message,  MessageChannel channel){
    assertNotNull(message);
    counter.incrementAndGet();
    return message;
  }
  @Override public void afterSendCompletion(  Message<?> message,  MessageChannel channel,  boolean sent,  Exception ex){
    this.afterCompletionInvoked=true;
  }
}
