@SuppressWarnings("rawtypes") private static class TestWebSocketHandler extends AbstractWebSocketHandler {
  private List<WebSocketMessage> receivedMessages=new ArrayList<>();
  private int waitMessageCount;
  private final CountDownLatch latch=new CountDownLatch(1);
  private Throwable transportError;
  public void setWaitMessageCount(  int waitMessageCount){
    this.waitMessageCount=waitMessageCount;
  }
  public List<WebSocketMessage> getReceivedMessages(){
    return this.receivedMessages;
  }
  public Throwable getTransportError(){
    return this.transportError;
  }
  @Override public void handleMessage(  WebSocketSession session,  WebSocketMessage<?> message) throws Exception {
    this.receivedMessages.add(message);
    if (this.receivedMessages.size() >= this.waitMessageCount) {
      this.latch.countDown();
    }
  }
  @Override public void handleTransportError(  WebSocketSession session,  Throwable exception) throws Exception {
    this.transportError=exception;
    this.latch.countDown();
  }
  public void await() throws InterruptedException {
    this.latch.await(5,TimeUnit.SECONDS);
  }
}
