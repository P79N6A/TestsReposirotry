private static class AttributesHandler {
  @SuppressWarnings("unchecked") public Mono<ServerResponse> attributes(  ServerRequest request){
    assertTrue(request.attributes().containsKey(RouterFunctions.REQUEST_ATTRIBUTE));
    assertTrue(request.attributes().containsKey(HandlerMapping.BEST_MATCHING_HANDLER_ATTRIBUTE));
    Map<String,String> pathVariables=(Map<String,String>)request.attributes().get(RouterFunctions.URI_TEMPLATE_VARIABLES_ATTRIBUTE);
    assertNotNull(pathVariables);
    assertEquals(1,pathVariables.size());
    assertEquals("bar",pathVariables.get("foo"));
    pathVariables=(Map<String,String>)request.attributes().get(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);
    assertNotNull(pathVariables);
    assertEquals(1,pathVariables.size());
    assertEquals("bar",pathVariables.get("foo"));
    PathPattern pattern=(PathPattern)request.attributes().get(RouterFunctions.MATCHING_PATTERN_ATTRIBUTE);
    assertNotNull(pattern);
    assertEquals("/attributes/{foo}",pattern.getPatternString());
    pattern=(PathPattern)request.attributes().get(HandlerMapping.BEST_MATCHING_PATTERN_ATTRIBUTE);
    assertNotNull(pattern);
    assertEquals("/attributes/{foo}",pattern.getPatternString());
    return ServerResponse.ok().build();
  }
}
