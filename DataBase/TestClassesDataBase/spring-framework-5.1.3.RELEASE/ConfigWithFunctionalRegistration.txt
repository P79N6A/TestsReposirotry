@Configuration static class ConfigWithFunctionalRegistration {
  @Autowired void register(  GenericApplicationContext ctx){
    ctx.registerBean("spouse",TestBean.class,() -> new TestBean("functional"));
    Supplier<TestBean> testBeanSupplier=() -> new TestBean(ctx.getBean("spouse",TestBean.class));
    ctx.registerBean(TestBean.class,testBeanSupplier,bd -> bd.setPrimary(true));
  }
  @Bean public NestedTestBean nestedTestBean(  TestBean testBean){
    return new NestedTestBean(testBean.getSpouse().getName());
  }
}
