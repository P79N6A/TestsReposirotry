/** 
 * Integration tests that verify support for  {@link Nested @Nested} test classes inconjunction with the  {@link SpringExtension},  {@link Sql @Sql}, and {@link Transactional @Transactional} in a JUnit Jupiter environment.
 * @author Sam Brannen
 * @since 5.1.3
 */
@SpringJUnitConfig(PopulatedSchemaDatabaseConfig.class) @Transactional @TestInstance(Lifecycle.PER_CLASS) class NestedTestsWithSqlScriptsAndJUnitJupiterTests {
  @Autowired JdbcTemplate jdbcTemplate;
  @BeforeTransaction @AfterTransaction void checkInitialDatabaseState(){
    assertEquals(0,countRowsInTable("user"));
  }
  @Test @Sql("/org/springframework/test/context/jdbc/data.sql") void sqlScripts(){
    assertEquals(1,countRowsInTable("user"));
  }
  private int countRowsInTable(  String tableName){
    return JdbcTestUtils.countRowsInTable(this.jdbcTemplate,tableName);
  }
@Nested @SpringJUnitConfig(PopulatedSchemaDatabaseConfig.class) @Transactional class NestedTests {
    @Autowired JdbcTemplate jdbcTemplate;
    @BeforeTransaction @AfterTransaction void checkInitialDatabaseState(){
      assertEquals(0,countRowsInTable("user"));
    }
    @Test @Sql("/org/springframework/test/context/jdbc/data.sql") void nestedSqlScripts(){
      assertEquals(1,countRowsInTable("user"));
    }
    private int countRowsInTable(    String tableName){
      return JdbcTestUtils.countRowsInTable(this.jdbcTemplate,tableName);
    }
  }
}
