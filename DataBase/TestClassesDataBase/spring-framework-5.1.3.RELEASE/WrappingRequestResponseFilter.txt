private static class WrappingRequestResponseFilter extends OncePerRequestFilter {
  public static final String PRINCIPAL_NAME="WrapRequestResponseFilterPrincipal";
  @Override protected void doFilterInternal(  HttpServletRequest request,  HttpServletResponse response,  FilterChain filterChain) throws ServletException, IOException {
    filterChain.doFilter(new HttpServletRequestWrapper(request){
      @Override public Principal getUserPrincipal(){
        return () -> PRINCIPAL_NAME;
      }
      @Override public AsyncContext getAsyncContext(){
        return super.getAsyncContext() != null ? new AsyncContextWrapper(super.getAsyncContext()) : null;
      }
    }
,new HttpServletResponseWrapper(response));
  }
}
