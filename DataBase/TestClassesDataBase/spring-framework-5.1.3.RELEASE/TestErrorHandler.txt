private static class TestErrorHandler implements ErrorHandler {
  private final CountDownLatch latch;
  private volatile Throwable lastError;
  TestErrorHandler(  int expectedErrorCount){
    this.latch=new CountDownLatch(expectedErrorCount);
  }
  @Override public void handleError(  Throwable t){
    this.lastError=t;
    this.latch.countDown();
  }
}
