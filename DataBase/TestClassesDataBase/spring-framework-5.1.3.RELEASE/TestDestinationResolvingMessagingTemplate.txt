private static class TestDestinationResolvingMessagingTemplate extends AbstractDestinationResolvingMessagingTemplate<MessageChannel> {
  private MessageChannel messageChannel;
  private Message<?> message;
  private Message<?> receiveMessage;
  private void setReceiveMessage(  Message<?> receiveMessage){
    this.receiveMessage=receiveMessage;
  }
  @Override protected void doSend(  MessageChannel channel,  Message<?> message){
    this.messageChannel=channel;
    this.message=message;
  }
  @Override protected Message<?> doReceive(  MessageChannel channel){
    this.messageChannel=channel;
    return this.receiveMessage;
  }
  @Override protected Message<?> doSendAndReceive(  MessageChannel channel,  Message<?> requestMessage){
    this.message=requestMessage;
    this.messageChannel=channel;
    return this.receiveMessage;
  }
}
