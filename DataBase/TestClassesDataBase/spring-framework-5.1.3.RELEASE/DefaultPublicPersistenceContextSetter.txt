@Repository @SuppressWarnings("serial") public static class DefaultPublicPersistenceContextSetter implements Serializable {
  private EntityManager em;
  @PersistenceContext(type=PersistenceContextType.EXTENDED) public void setEntityManager(  EntityManager em){
    if (this.em != null) {
      throw new IllegalStateException("Already called");
    }
    this.em=em;
  }
  public EntityManager getEntityManager(){
    return em;
  }
}
