/** 
 * @author Juergen Hoeller
 * @author Alex Pogrebnyak
 */
public class Spr12334Tests {
  @Test public void shouldNotScanTwice(){
    TestImport.scanned=false;
    AnnotationConfigApplicationContext context=new AnnotationConfigApplicationContext();
    context.scan(TestImport.class.getPackage().getName());
    context.refresh();
    context.getBean(TestConfiguration.class);
  }
  @Import(TestImport.class) public @interface AnotherImport {}
@Configuration @AnotherImport public static class TestConfiguration {
  }
public static class TestImport implements ImportBeanDefinitionRegistrar {
    private static boolean scanned=false;
    @Override public void registerBeanDefinitions(    AnnotationMetadata metadata,    BeanDefinitionRegistry registry){
      if (scanned) {
        throw new IllegalStateException("Already scanned");
      }
      scanned=true;
    }
  }
}
