private static abstract class AbstractNotifyingRunnable implements Runnable {
  private final Object monitor;
  protected AbstractNotifyingRunnable(  Object monitor){
    this.monitor=monitor;
  }
  @Override public final void run(){
synchronized (this.monitor) {
      try {
        doRun();
      }
  finally {
        this.monitor.notifyAll();
      }
    }
  }
  protected abstract void doRun();
}
