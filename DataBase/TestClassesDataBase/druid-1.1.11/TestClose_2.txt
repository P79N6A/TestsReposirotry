public class TestClose_2 extends PoolTestCase {
  public void test_close() throws Exception {
    DruidDataSource dataSource=new DruidDataSource();
    dataSource.setPoolPreparedStatements(true);
    dataSource.setUrl("jdbc:mock:xxx");
    String sql="SELECT 1";
    Connection conn=dataSource.getConnection();
    CallableStatement stmt=conn.prepareCall(sql);
    ResultSet rs=stmt.executeQuery();
    rs.next();
    Assert.assertEquals(false,rs.isClosed());
    Assert.assertEquals(false,stmt.isClosed());
    stmt.close();
    Assert.assertEquals(true,stmt.isClosed());
    Assert.assertEquals(true,rs.isClosed());
    CallableStatement stmt2=conn.prepareCall(sql);
    Assert.assertEquals(true,stmt.isClosed());
    Assert.assertEquals(stmt.unwrap(MockStatement.class),stmt2.unwrap(MockStatement.class));
    conn.close();
    Assert.assertEquals(true,stmt.isClosed());
    Assert.assertEquals(true,rs.isClosed());
    rs.close();
    stmt.close();
    dataSource.close();
  }
}
