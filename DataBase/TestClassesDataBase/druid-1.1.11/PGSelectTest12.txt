public class PGSelectTest12 extends PGTest {
  public void test_0() throws Exception {
    String sql="WITH regional_sales AS (" + "        SELECT region, SUM(amount) AS total_sales" + "        FROM orders"+ "        GROUP BY region"+ "     ), top_regions AS ("+ "        SELECT region"+ "        FROM regional_sales"+ "        WHERE total_sales > (SELECT SUM(total_sales)/10 FROM regional_sales)"+ "     )\n"+ "SELECT region,"+ "       product,"+ "       SUM(quantity) AS product_units,"+ "       SUM(amount) AS product_sales\n"+ "FROM orders\n"+ "WHERE region IN (SELECT region FROM top_regions)\n"+ "GROUP BY region, product;";
    PGSQLStatementParser parser=new PGSQLStatementParser(sql);
    List<SQLStatement> statementList=parser.parseStatementList();
    SQLStatement statemen=statementList.get(0);
    Assert.assertEquals(1,statementList.size());
    PGSchemaStatVisitor visitor=new PGSchemaStatVisitor();
    statemen.accept(visitor);
    Assert.assertEquals(4,visitor.getColumns().size());
    Assert.assertEquals(1,visitor.getTables().size());
  }
}
