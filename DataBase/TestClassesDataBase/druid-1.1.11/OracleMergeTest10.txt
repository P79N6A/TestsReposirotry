public class OracleMergeTest10 extends OracleTest {
  public void test_0() throws Exception {
    String sql="merge into bonuses d \n" + "   using (select employee_id.* from employees) s \n" + "   on (employee_id = a) \n"+ "   when not matched then insert (d.employee_id, d.bonus) \n"+ "     values (s.employee_id, s.salary)\n"+ "     where (s.salary <= 8000)\n"+ "   when matched then update set d.bonus = bonus \n"+ "     delete where (salary > 8000)";
    SQLStatementParser parser=new OracleStatementParser(sql);
    List<SQLStatement> stmtList=parser.parseStatementList();
    SQLMergeStatement mergeStatement=(SQLMergeStatement)stmtList.get(0);
    String result=SQLUtils.toOracleString(mergeStatement);
    Assert.assertEquals("MERGE INTO bonuses d\n" + "USING (\n" + "\tSELECT employee_id.*\n"+ "\tFROM employees\n"+ ") s ON (employee_id = a) \n"+ "WHEN MATCHED THEN UPDATE SET d.bonus = bonus\n"+ "\tWHERE salary > 8000\n"+ "WHEN NOT MATCHED THEN INSERT (d.employee_id, d.bonus) VALUES (s.employee_id, s.salary)\n"+ "\tWHERE s.salary <= 8000",result);
  }
}
