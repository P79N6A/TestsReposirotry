public class TestAbondon extends TestCase {
  private DruidDataSource dataSource;
  protected void setUp() throws Exception {
    DruidDataSourceStatManager.clear();
    dataSource=new DruidDataSource();
    dataSource.setRemoveAbandoned(true);
    dataSource.setRemoveAbandonedTimeoutMillis(10);
    dataSource.setLogAbandoned(true);
    dataSource.setTimeBetweenEvictionRunsMillis(10);
    dataSource.setMinEvictableIdleTimeMillis(300 * 1000);
    dataSource.setUrl("jdbc:mock:xxx");
  }
  protected void tearDown() throws Exception {
    dataSource.close();
    Assert.assertEquals(0,DruidDataSourceStatManager.getInstance().getDataSourceList().size());
  }
  public void test_0() throws Exception {
    DruidPooledConnection conn=dataSource.getConnection();
    Assert.assertEquals(false,conn.isClosed());
    Thread.sleep(10);
    for (int i=0; i < 100; ++i) {
      if (conn.isAbandonded()) {
        break;
      }
      Thread.sleep(10);
    }
    Assert.assertEquals(true,conn.isAbandonded());
  }
}
