/** 
 * 类Case2.java的实现描述：TODO 类实现描述
 * @author admin 2011-5-4 下午02:45:21
 */
public class Case2 extends PoolTestCase {
  public void test_singleThread() throws Exception {
    Class.forName("com.alibaba.druid.mock.MockDriver");
    Properties properties=new Properties();
    properties.put("maxActive","100");
    properties.put("maxIdle","30");
    properties.put("maxWait","10000");
    properties.put("url","jdbc:mock:");
    properties.put("filters","stat");
    properties.put("validationQuery","SELECT 1");
    DruidDataSource dataSource=(DruidDataSource)DruidDataSourceFactory.createDataSource(properties);
    JMXUtils.register("com.alibaba.druid:type=DruidDataSource",dataSource);
    final int COUNT=10;
    Assert.assertEquals(0,dataSource.getCreateCount());
    Assert.assertEquals(0,dataSource.getDestroyCount());
    Assert.assertEquals(0,dataSource.getPoolingCount());
    Connection[] connections=new Connection[COUNT];
    for (int i=0; i < COUNT; ++i) {
      connections[i]=dataSource.getConnection();
    }
    for (int i=0; i < COUNT; ++i) {
      connections[i].close();
    }
    Assert.assertEquals(0,dataSource.getDestroyCount());
    dataSource.close();
    Assert.assertEquals(dataSource.getCreateCount(),dataSource.getDestroyCount());
  }
}
