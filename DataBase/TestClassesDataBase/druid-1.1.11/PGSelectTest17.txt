public class PGSelectTest17 extends PGTest {
  public void test_0() throws Exception {
    String sql="WITH RECURSIVE search_graph(id, link, data, depth, path, cycle) AS (" + "        SELECT g.id, g.link, g.data, 1," + "          ARRAY[ROW(g.f1, g.f2)],"+ "          false"+ "        FROM graph g"+ "      UNION ALL"+ "        SELECT g.id, g.link, g.data, sg.depth + 1,"+ "          path || ROW(g.f1, g.f2),"+ "          ROW(g.f1, g.f2) = ANY(path)"+ "        FROM graph g, search_graph sg"+ "        WHERE g.id = sg.link AND NOT cycle"+ ")"+ "SELECT * FROM search_graph;";
    PGSQLStatementParser parser=new PGSQLStatementParser(sql);
    List<SQLStatement> statementList=parser.parseStatementList();
    SQLStatement statemen=statementList.get(0);
    Assert.assertEquals(1,statementList.size());
    PGSchemaStatVisitor visitor=new PGSchemaStatVisitor();
    statemen.accept(visitor);
    System.out.println("Tables : " + visitor.getTables());
    System.out.println("fields : " + visitor.getColumns());
    Assert.assertEquals(5,visitor.getColumns().size());
    Assert.assertEquals(1,visitor.getTables().size());
  }
}
