public class MergeStatFilterTest_tddl extends TestCase {
  private DruidDataSource dataSource;
  protected void setUp() throws Exception {
    TabularData sqlList=JdbcStatManager.getInstance().getSqlList();
    if (sqlList.size() > 0) {
      for (      Object item : JdbcStatManager.getInstance().getSqlList().values()) {
        String text=JSONUtils.toJSONString(item);
        System.out.println(text);
      }
    }
    Assert.assertEquals(0,JdbcStatManager.getInstance().getSqlList().size());
    dataSource=new DruidDataSource();
    dataSource.setUrl("jdbc:mock:xx");
    dataSource.setDbType("mysql");
    dataSource.setFilters("mergeStat");
    Connection conn=dataSource.getConnection();
{
      Statement stmt=conn.createStatement();
      stmt.execute("select 1");
      System.out.println(stmt.getClass().getName());
    }
    conn.close();
    System.out.println(conn.getClass().getName());
  }
  protected void tearDown() throws Exception {
    JdbcUtils.close(dataSource);
    Assert.assertEquals(0,JdbcStatManager.getInstance().getSqlList().size());
  }
  public void test_merge() throws Exception {
    for (int i=0; i < 100; ++i) {
      String tableName="t_" + i;
      String sql="select * from " + tableName + " where "+ tableName+ ".id = "+ i;
      Connection conn=dataSource.getConnection();
      Statement stmt=conn.createStatement();
      stmt.execute(sql);
      stmt.close();
      conn.close();
    }
    Assert.assertEquals(2,dataSource.getDataSourceStat().getSqlStatMap().size());
  }
}
