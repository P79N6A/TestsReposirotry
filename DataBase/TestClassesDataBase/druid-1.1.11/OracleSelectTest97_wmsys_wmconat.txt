public class OracleSelectTest97_wmsys_wmconat extends OracleTest {
  public void test_0() throws Exception {
    String sql="SELECT NVL(TO_CHAR(WMSYS.WM_CONCAT(NVL(O.CHILD_ITEM_CODE, O.ITEM_CODE))), ?)\n" + "FROM ECC_CPR.CCG_GTS_OSG3A_V O\n" + "WHERE O.ENABLED_FLAG = ?\n"+ "\tAND NVL(O.PRICE, ?) = ?\n"+ "\tAND O.CONTRACT_HEADER_ID = :B1";
    System.out.println(sql);
    OracleStatementParser parser=new OracleStatementParser(sql);
    List<SQLStatement> statementList=parser.parseStatementList();
    SQLSelectStatement stmt=(SQLSelectStatement)statementList.get(0);
    System.out.println(stmt.toString());
    Assert.assertEquals(1,statementList.size());
    SQLMethodInvokeExpr expr=(SQLMethodInvokeExpr)stmt.getSelect().getQueryBlock().getSelectList().get(0).getExpr();
    SQLMethodInvokeExpr param0=(SQLMethodInvokeExpr)expr.getParameters().get(0);
    assertTrue(param0.getParameters().get(0) instanceof SQLAggregateExpr);
    OracleSchemaStatVisitor visitor=new OracleSchemaStatVisitor();
    stmt.accept(visitor);
{
      String text=SQLUtils.toOracleString(stmt);
      assertEquals("SELECT NVL(TO_CHAR(WMSYS.WM_CONCAT(NVL(O.CHILD_ITEM_CODE, O.ITEM_CODE))), ?)\n" + "FROM ECC_CPR.CCG_GTS_OSG3A_V O\n" + "WHERE O.ENABLED_FLAG = ?\n"+ "\tAND NVL(O.PRICE, ?) = ?\n"+ "\tAND O.CONTRACT_HEADER_ID = :B1",text);
    }
    System.out.println("Tables : " + visitor.getTables());
    System.out.println("fields : " + visitor.getColumns());
    System.out.println("coditions : " + visitor.getConditions());
    System.out.println("relationships : " + visitor.getRelationships());
    System.out.println("orderBy : " + visitor.getOrderByColumns());
    assertEquals(1,visitor.getTables().size());
    assertEquals(5,visitor.getColumns().size());
    assertEquals(2,visitor.getConditions().size());
    assertEquals(0,visitor.getRelationships().size());
    assertEquals(0,visitor.getOrderByColumns().size());
  }
  public void test_1() throws Exception {
    String sql="SELECT NVL(TO_CHAR(WMSYS.WM_CONCAT(NVL(O.CHILD_ITEM_CODE, O.ITEM_CODE))), ?)\n" + "FROM ECC_CPR.CCG_GTS_OSG3A_V O\n" + "WHERE O.ENABLED_FLAG = ?\n"+ "\tAND NVL(O.PRICE, ?) = ?\n"+ "\tAND O.CONTRACT_HEADER_ID = :B1";
    System.out.println(sql);
    OracleStatementParser parser=new OracleStatementParser(sql);
    List<SQLStatement> statementList=parser.parseStatementList();
    SQLSelectStatement stmt=(SQLSelectStatement)statementList.get(0);
    System.out.println(stmt.toString());
    Assert.assertEquals(1,statementList.size());
    SQLSelectQueryBlock queryBlock=stmt.getSelect().getQueryBlock();
    SQLMethodInvokeExpr nvl=(SQLMethodInvokeExpr)queryBlock.getSelectList().get(0).getExpr();
    SQLMethodInvokeExpr toChar=(SQLMethodInvokeExpr)nvl.getParameters().get(0);
    assertTrue(toChar.getParameters().get(0) instanceof SQLAggregateExpr);
    OracleSchemaStatVisitor visitor=new OracleSchemaStatVisitor();
    stmt.accept(visitor);
{
      String text=SQLUtils.toOracleString(stmt);
      assertEquals("SELECT NVL(TO_CHAR(WMSYS.WM_CONCAT(NVL(O.CHILD_ITEM_CODE, O.ITEM_CODE))), ?)\n" + "FROM ECC_CPR.CCG_GTS_OSG3A_V O\n" + "WHERE O.ENABLED_FLAG = ?\n"+ "\tAND NVL(O.PRICE, ?) = ?\n"+ "\tAND O.CONTRACT_HEADER_ID = :B1",text);
    }
    System.out.println("Tables : " + visitor.getTables());
    System.out.println("fields : " + visitor.getColumns());
    System.out.println("coditions : " + visitor.getConditions());
    System.out.println("relationships : " + visitor.getRelationships());
    System.out.println("orderBy : " + visitor.getOrderByColumns());
    assertEquals(1,visitor.getTables().size());
    assertEquals(5,visitor.getColumns().size());
    assertEquals(2,visitor.getConditions().size());
    assertEquals(0,visitor.getRelationships().size());
    assertEquals(0,visitor.getOrderByColumns().size());
  }
}
