public class Bug_for_happyday517_2 extends TestCase {
  private DruidDataSource dataSource;
  private MockDriver driver;
  final DataTruncation exception=new java.sql.DataTruncation(0,true,true,0,0);
  private int originalDataSourceCount=0;
  protected void setUp() throws Exception {
    originalDataSourceCount=DruidDataSourceStatManager.getInstance().getDataSourceList().size();
    final MockPreparedStatement mockStatement=new MockPreparedStatement(null,null){
      public boolean execute() throws SQLException {
        throw exception;
      }
    }
;
    driver=new MockDriver(){
      public Connection connect(      String url,      Properties info) throws SQLException {
        super.connect(url,info);
        return new MockConnection(driver,url,info){
          public PreparedStatement prepareStatement(          String sql) throws SQLException {
            return mockStatement;
          }
        }
;
      }
    }
;
    dataSource=new DruidDataSource();
    dataSource.setDriver(driver);
    dataSource.setUrl("jdbc:mock:xxx");
    dataSource.setFilters("stat,trace,log4j,encoding");
  }
  protected void tearDown() throws Exception {
    dataSource.close();
    Assert.assertEquals(originalDataSourceCount,DruidDataSourceStatManager.getInstance().getDataSourceList().size());
  }
  public void test_bug() throws Exception {
    Connection conn=dataSource.getConnection();
    PreparedStatement stmt=conn.prepareStatement("insert into message.dbo.TempSMS(sms) values ('333')");
    Exception error=null;
    try {
      stmt.execute();
    }
 catch (    SQLException ex) {
      error=ex;
    }
    Assert.assertTrue(exception == error);
    stmt.close();
    conn.close();
  }
}
