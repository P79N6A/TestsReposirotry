public class TenantSelectTest2 extends TestCase {
  private String sql="SELECT ID, NAME FROM orders WHERE FID = ? OR FID = ?";
  private String expect_sql="SELECT ID, NAME, tenant" + "\nFROM orders" + "\nWHERE FID = ?"+ "\n\tOR FID = ?";
  private WallConfig config=new WallConfig();
  private WallConfig config_callback=new WallConfig();
  protected void setUp() throws Exception {
    config.setTenantTablePattern("*");
    config.setTenantColumn("tenant");
    config_callback.setTenantCallBack(new TenantTestCallBack());
  }
  public void testMySql() throws Exception {
    WallProvider.setTenantValue(123);
    MySqlWallProvider provider=new MySqlWallProvider(config);
    WallCheckResult checkResult=provider.check(sql);
    Assert.assertEquals(0,checkResult.getViolations().size());
    String resultSql=SQLUtils.toSQLString(checkResult.getStatementList(),JdbcConstants.MYSQL);
    Assert.assertEquals(expect_sql,resultSql);
  }
  public void testMySql2() throws Exception {
    MySqlWallProvider provider=new MySqlWallProvider(config_callback);
    WallCheckResult checkResult=provider.check(sql);
    Assert.assertEquals(0,checkResult.getViolations().size());
    String resultSql=SQLUtils.toSQLString(checkResult.getStatementList(),JdbcConstants.MYSQL);
    Assert.assertEquals(expect_sql,resultSql);
  }
}
