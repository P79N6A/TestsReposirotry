class DefaultLogCaptor extends AppenderSkeleton implements LogCaptor {
  private final List<LoggingEvent> loggedEvents=new ArrayList<LoggingEvent>();
  private final Level originalLoggingLevel=Logger.getRootLogger().getLevel();
  private final Level levelToCapture;
  public DefaultLogCaptor(  Level levelToCapture){
    super();
    this.levelToCapture=levelToCapture;
    setupLogging();
  }
  @Override public void finalize(){
    super.finalize();
    stopLogging();
  }
  @Override public List<LoggingEvent> loggedEvents(){
    return new ArrayList<LoggingEvent>(loggedEvents);
  }
  @Override public void clear(){
    loggedEvents.clear();
  }
  protected void setupLogging(){
    loggedEvents.clear();
    Logger.getRootLogger().addAppender(this);
    Logger.getRootLogger().setLevel(levelToCapture);
  }
  protected void stopLogging(){
    Logger.getRootLogger().removeAppender(this);
    Logger.getRootLogger().setLevel(originalLoggingLevel);
  }
  @Override protected void append(  LoggingEvent loggingEvent){
    loggedEvents.add(loggingEvent);
  }
  @Override public boolean requiresLayout(){
    return false;
  }
  @Override public void close(){
  }
}
