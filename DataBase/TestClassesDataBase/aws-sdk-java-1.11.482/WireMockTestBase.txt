/** 
 * Base class for tests that use a WireMock server
 */
public abstract class WireMockTestBase {
  @Rule public WireMockRule mockServer=new WireMockRule(0);
  protected Request<?> newGetRequest(  String resourcePath){
    Request<?> request=newRequest(resourcePath);
    request.setHttpMethod(HttpMethodName.GET);
    return request;
  }
  protected Request<?> newRequest(  String resourcePath){
    Request<?> request=new DefaultRequest<String>("mock");
    request.setEndpoint(URI.create("http://localhost:" + mockServer.port() + resourcePath));
    return request;
  }
  protected HttpResponseHandler<AmazonServiceException> stubErrorHandler() throws Exception {
    HttpResponseHandler<AmazonServiceException> errorHandler=mock(JsonErrorResponseHandler.class);
    when(errorHandler.handle(any(HttpResponse.class))).thenReturn(mockException());
    return errorHandler;
  }
  private AmazonServiceException mockException(){
    AmazonServiceException exception=new AmazonServiceException("Dummy error response");
    exception.setStatusCode(500);
    return exception;
  }
}
