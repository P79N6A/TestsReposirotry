private static class MockProxy {
  private ExecutorService exec;
  private ServerSocket ss=null;
  private AtomicLong accepts=new AtomicLong(0);
  public int getPort(){
    return ss.getLocalPort();
  }
  public void init() throws IOException {
    exec=Executors.newSingleThreadExecutor();
    ss=new ServerSocket(0);
  }
  public void run(){
    exec.submit(new Runnable(){
      @Override public void run(){
        while (true) {
          try {
            Socket s=ss.accept();
            accepts.incrementAndGet();
            s.close();
          }
 catch (          IOException ignored) {
          }
        }
      }
    }
);
  }
  public long getAcceptCount(){
    return accepts.get();
  }
  public void resetAcceptCount(){
    accepts.set(0);
  }
  public void stop(){
    exec.shutdownNow();
    exec=null;
  }
}
