private static class AppendableByteSource extends ByteSource {
  private byte[] bytes;
  public AppendableByteSource(  byte[] initialBytes){
    this.bytes=initialBytes.clone();
  }
  @Override public InputStream openStream(){
    return new In();
  }
  public void append(  byte[] b){
    byte[] newBytes=Arrays.copyOf(bytes,bytes.length + b.length);
    System.arraycopy(b,0,newBytes,bytes.length,b.length);
    bytes=newBytes;
  }
private class In extends InputStream {
    private int pos;
    @Override public int read() throws IOException {
      byte[] b=new byte[1];
      return read(b) == -1 ? -1 : UnsignedBytes.toInt(b[0]);
    }
    @Override public int read(    byte[] b,    int off,    int len){
      if (pos >= bytes.length) {
        return -1;
      }
      int lenToRead=Math.min(len,bytes.length - pos);
      System.arraycopy(bytes,pos,b,off,lenToRead);
      pos+=lenToRead;
      return lenToRead;
    }
  }
}
