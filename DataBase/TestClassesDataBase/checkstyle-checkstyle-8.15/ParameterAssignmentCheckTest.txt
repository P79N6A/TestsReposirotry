public class ParameterAssignmentCheckTest extends AbstractModuleTestSupport {
  @Override protected String getPackageLocation(){
    return "com/puppycrawl/tools/checkstyle/checks/coding/parameterassignment";
  }
  @Test public void testDefault() throws Exception {
    final DefaultConfiguration checkConfig=createModuleConfig(ParameterAssignmentCheck.class);
    final String[] expected={"9:15: " + getCheckMessage(MSG_KEY,"field"),"10:15: " + getCheckMessage(MSG_KEY,"field"),"12:14: " + getCheckMessage(MSG_KEY,"field"),"20:30: " + getCheckMessage(MSG_KEY,"field1")};
    verify(checkConfig,getPath("InputParameterAssignmentWithUnchecked.java"),expected);
  }
  @Test public void testReceiverParameter() throws Exception {
    final DefaultConfiguration checkConfig=createModuleConfig(ParameterAssignmentCheck.class);
    final String[] expected=CommonUtil.EMPTY_STRING_ARRAY;
    verify(checkConfig,getPath("InputParameterAssignmentReceiver.java"),expected);
  }
  @Test public void testTokensNotNull(){
    final ParameterAssignmentCheck check=new ParameterAssignmentCheck();
    Assert.assertNotNull("Acceptable tokens should not be null",check.getAcceptableTokens());
    Assert.assertNotNull("Default tokens should not be null",check.getDefaultTokens());
    Assert.assertNotNull("Required tokens should not be null",check.getRequiredTokens());
  }
  @Test public void testImproperToken(){
    final ParameterAssignmentCheck check=new ParameterAssignmentCheck();
    final DetailAST classDefAst=new DetailAST();
    classDefAst.setType(TokenTypes.CLASS_DEF);
    try {
      check.visitToken(classDefAst);
      Assert.fail("IllegalStateException is expected");
    }
 catch (    IllegalStateException ex) {
    }
    try {
      check.leaveToken(classDefAst);
      Assert.fail("IllegalStateException is expected");
    }
 catch (    IllegalStateException ex) {
    }
  }
  /** 
 * We cannot reproduce situation when visitToken is called and leaveToken is not. So, we have to use reflection to be sure that even in such situation state of the field will be cleared.
 * @throws Exception when code tested throws exception
 */
  @Test @SuppressWarnings("unchecked") public void testClearState() throws Exception {
    final ParameterAssignmentCheck check=new ParameterAssignmentCheck();
    final Optional<DetailAST> methodDef=TestUtil.findTokenInAstByPredicate(JavaParser.parseFile(new File(getPath("InputParameterAssignmentReceiver.java")),JavaParser.Options.WITHOUT_COMMENTS),ast -> ast.getType() == TokenTypes.METHOD_DEF);
    assertTrue("Ast should contain METHOD_DEF",methodDef.isPresent());
    assertTrue("State is not cleared on beginTree",TestUtil.isStatefulFieldClearedDuringBeginTree(check,methodDef.get(),"parameterNamesStack",parameterNamesStack -> ((Collection<Set<String>>)parameterNamesStack).isEmpty()));
  }
}
