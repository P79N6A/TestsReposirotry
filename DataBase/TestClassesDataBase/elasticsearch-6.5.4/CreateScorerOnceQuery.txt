static class CreateScorerOnceQuery extends Query {
  private final Query query;
  CreateScorerOnceQuery(  Query query){
    this.query=query;
  }
  @Override public String toString(  String field){
    return query.toString(field);
  }
  @Override public Query rewrite(  IndexReader reader) throws IOException {
    Query queryRewritten=query.rewrite(reader);
    if (query != queryRewritten) {
      return new CreateScorerOnceQuery(queryRewritten);
    }
    return super.rewrite(reader);
  }
  @Override public Weight createWeight(  IndexSearcher searcher,  boolean needsScores,  float boost) throws IOException {
    return new CreateScorerOnceWeight(query.createWeight(searcher,needsScores,boost));
  }
  @Override public boolean equals(  Object obj){
    return sameClassAs(obj) && query.equals(((CreateScorerOnceQuery)obj).query);
  }
  @Override public int hashCode(){
    return 31 * classHash() + query.hashCode();
  }
}
