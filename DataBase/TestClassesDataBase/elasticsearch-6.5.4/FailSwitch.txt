private static class FailSwitch {
  private volatile int failRate;
  private volatile boolean onceFailedFailAlways=false;
  public boolean fail(){
    final int rnd=randomIntBetween(1,100);
    boolean fail=rnd <= failRate;
    if (fail && onceFailedFailAlways) {
      failAlways();
    }
    return fail;
  }
  public void failNever(){
    failRate=0;
  }
  public void failAlways(){
    failRate=100;
  }
  public void failRandomly(){
    failRate=randomIntBetween(1,100);
  }
  public void failRate(  int rate){
    failRate=rate;
  }
  public void onceFailedFailAlways(){
    onceFailedFailAlways=true;
  }
}
