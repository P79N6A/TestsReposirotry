public class EvilEnvironmentAwareCommandTests extends ESTestCase {
  @Rule public TestRule restoreSystemProperties=new TestRuleRestoreSystemProperties("es.path.conf");
  public void testEsPathConfNotSet() throws Exception {
    clearEsPathConf();
class TestEnvironmentAwareCommand extends EnvironmentAwareCommand {
      private TestEnvironmentAwareCommand(      String description){
        super(description);
      }
      @Override protected void execute(      Terminal terminal,      OptionSet options,      Environment env) throws Exception {
      }
    }
    final TestEnvironmentAwareCommand command=new TestEnvironmentAwareCommand("test");
    final UserException e=expectThrows(UserException.class,() -> command.mainWithoutErrorHandling(new String[0],new MockTerminal()));
    assertThat(e,hasToString(containsString("the system property [es.path.conf] must be set")));
  }
  @SuppressForbidden(reason="clears system property es.path.conf as part of test setup") private void clearEsPathConf(){
    System.clearProperty("es.path.conf");
  }
}
