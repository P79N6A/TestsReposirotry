private static class TestShardStateAction extends ShardStateAction {
  TestShardStateAction(  Settings settings,  ClusterService clusterService,  TransportService transportService,  AllocationService allocationService,  RoutingService routingService){
    super(settings,clusterService,transportService,allocationService,routingService,THREAD_POOL);
  }
  private Runnable onBeforeWaitForNewMasterAndRetry;
  public void setOnBeforeWaitForNewMasterAndRetry(  Runnable onBeforeWaitForNewMasterAndRetry){
    this.onBeforeWaitForNewMasterAndRetry=onBeforeWaitForNewMasterAndRetry;
  }
  private Runnable onAfterWaitForNewMasterAndRetry;
  public void setOnAfterWaitForNewMasterAndRetry(  Runnable onAfterWaitForNewMasterAndRetry){
    this.onAfterWaitForNewMasterAndRetry=onAfterWaitForNewMasterAndRetry;
  }
  @Override protected void waitForNewMasterAndRetry(  String actionName,  ClusterStateObserver observer,  TransportRequest request,  Listener listener,  Predicate<ClusterState> changePredicate){
    onBeforeWaitForNewMasterAndRetry.run();
    super.waitForNewMasterAndRetry(actionName,observer,request,listener,changePredicate);
    onAfterWaitForNewMasterAndRetry.run();
  }
}
