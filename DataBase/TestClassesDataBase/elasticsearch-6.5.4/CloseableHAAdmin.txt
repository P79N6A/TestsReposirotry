/** 
 * The default HAAdmin tool does not throw exceptions on failures, and does not close any client connection resources when it concludes. This subclass overrides the tool to allow for exception throwing, and to keep track of and clean up connection resources.
 */
private static class CloseableHAAdmin extends DFSHAAdmin {
  private final List<CloseableHAServiceTarget> serviceTargets=new ArrayList<>();
  @Override protected HAServiceTarget resolveTarget(  String nnId){
    CloseableHAServiceTarget target=new CloseableHAServiceTarget(super.resolveTarget(nnId));
    serviceTargets.add(target);
    return target;
  }
  @Override public int run(  String[] argv) throws Exception {
    return runCmd(argv);
  }
  public int transitionToStandby(  String namenodeID) throws Exception {
    return run(new String[]{"-transitionToStandby",namenodeID});
  }
  public int transitionToActive(  String namenodeID) throws Exception {
    return run(new String[]{"-transitionToActive",namenodeID});
  }
  public void close(){
    for (    CloseableHAServiceTarget serviceTarget : serviceTargets) {
      serviceTarget.close();
    }
  }
}
