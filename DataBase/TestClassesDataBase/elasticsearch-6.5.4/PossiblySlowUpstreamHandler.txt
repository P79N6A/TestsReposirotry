class PossiblySlowUpstreamHandler extends SimpleChannelInboundHandler<Object> {
  private final ExecutorService executorService;
  PossiblySlowUpstreamHandler(  ExecutorService executorService){
    this.executorService=executorService;
  }
  @Override protected void channelRead0(  ChannelHandlerContext ctx,  Object msg) throws Exception {
    executorService.submit(new PossiblySlowRunnable(ctx,msg));
  }
  @Override public void exceptionCaught(  ChannelHandlerContext ctx,  Throwable cause) throws Exception {
    logger.info("Caught exception",cause);
    ctx.channel().close().sync();
  }
}
