public static class TestS3RepositoryPlugin extends S3RepositoryPlugin {
  public TestS3RepositoryPlugin(  final Settings settings){
    super(settings);
  }
  @Override public Map<String,Repository.Factory> getRepositories(  final Environment env,  final NamedXContentRegistry registry){
    return Collections.singletonMap(S3Repository.TYPE,(metadata) -> new S3Repository(metadata,env.settings(),registry,new S3Service(env.settings()){
      @Override AmazonS3 buildClient(      S3ClientSettings clientSettings){
        return new MockAmazonS3(blobs,bucket,serverSideEncryption,cannedACL,storageClass);
      }
    }
));
  }
}
