private static final class AssertingChannel extends AbstractRestChannel {
  private final RestStatus expectedStatus;
  private final AtomicReference<RestResponse> responseReference=new AtomicReference<>();
  protected AssertingChannel(  RestRequest request,  boolean detailedErrorsEnabled,  RestStatus expectedStatus){
    super(request,detailedErrorsEnabled);
    this.expectedStatus=expectedStatus;
  }
  @Override public void sendResponse(  RestResponse response){
    assertEquals(expectedStatus,response.status());
    responseReference.set(response);
  }
  RestResponse getRestResponse(){
    return responseReference.get();
  }
  boolean getSendResponseCalled(){
    return getRestResponse() != null;
  }
}
