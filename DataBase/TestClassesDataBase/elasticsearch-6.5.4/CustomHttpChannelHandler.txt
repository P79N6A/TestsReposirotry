private class CustomHttpChannelHandler extends Netty4HttpServerTransport.HttpChannelHandler {
  private final ExecutorService executorService;
  CustomHttpChannelHandler(  Netty4HttpServerTransport transport,  ExecutorService executorService,  ThreadContext threadContext){
    super(transport,randomBoolean(),threadContext);
    this.executorService=executorService;
  }
  @Override protected void initChannel(  Channel ch) throws Exception {
    super.initChannel(ch);
    ch.pipeline().replace("handler","handler",new PossiblySlowUpstreamHandler(executorService));
  }
}
