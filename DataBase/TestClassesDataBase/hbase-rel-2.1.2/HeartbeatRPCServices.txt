/** 
 * Custom RSRpcServices instance that allows heartbeat support to be toggled
 */
private static class HeartbeatRPCServices extends RSRpcServices {
  private static volatile boolean heartbeatsEnabled=true;
  public HeartbeatRPCServices(  HRegionServer rs) throws IOException {
    super(rs);
  }
  @Override public ScanResponse scan(  RpcController controller,  ScanRequest request) throws ServiceException {
    ScanRequest.Builder builder=ScanRequest.newBuilder(request);
    builder.setClientHandlesHeartbeats(heartbeatsEnabled);
    return super.scan(controller,builder.build());
  }
}
