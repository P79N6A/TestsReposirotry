public static class FaultyScannerObserver implements RegionCoprocessor, RegionObserver {
  private int faults=0;
  @Override public Optional<RegionObserver> getRegionObserver(){
    return Optional.of(this);
  }
  @Override public boolean preScannerNext(  final ObserverContext<RegionCoprocessorEnvironment> e,  final InternalScanner s,  final List<Result> results,  final int limit,  final boolean hasMore) throws IOException {
    final TableName tableName=e.getEnvironment().getRegionInfo().getTable();
    if (!tableName.isSystemTable() && (faults++ % 2) == 0) {
      LOG.debug(" Injecting fault in table=" + tableName + " scanner");
      throw new IOException("injected fault");
    }
    return hasMore;
  }
}
