/** 
 * Test different variants of initTableMapperJob method
 */
@Category({MapReduceTests.class,SmallTests.class}) public class TestTableMapReduceUtil {
  @ClassRule public static final HBaseClassTestRule CLASS_RULE=HBaseClassTestRule.forClass(TestTableMapReduceUtil.class);
  @Test public void testInitTableMapperJob1() throws Exception {
    Configuration configuration=new Configuration();
    Job job=new Job(configuration,"tableName");
    TableMapReduceUtil.initTableMapperJob("Table",new Scan(),Import.Importer.class,Text.class,Text.class,job,false,WALInputFormat.class);
    assertEquals(WALInputFormat.class,job.getInputFormatClass());
    assertEquals(Import.Importer.class,job.getMapperClass());
    assertEquals(LongWritable.class,job.getOutputKeyClass());
    assertEquals(Text.class,job.getOutputValueClass());
    assertNull(job.getCombinerClass());
    assertEquals("Table",job.getConfiguration().get(TableInputFormat.INPUT_TABLE));
  }
  @Test public void testInitTableMapperJob2() throws Exception {
    Configuration configuration=new Configuration();
    Job job=new Job(configuration,"tableName");
    TableMapReduceUtil.initTableMapperJob(Bytes.toBytes("Table"),new Scan(),Import.Importer.class,Text.class,Text.class,job,false,WALInputFormat.class);
    assertEquals(WALInputFormat.class,job.getInputFormatClass());
    assertEquals(Import.Importer.class,job.getMapperClass());
    assertEquals(LongWritable.class,job.getOutputKeyClass());
    assertEquals(Text.class,job.getOutputValueClass());
    assertNull(job.getCombinerClass());
    assertEquals("Table",job.getConfiguration().get(TableInputFormat.INPUT_TABLE));
  }
  @Test public void testInitTableMapperJob3() throws Exception {
    Configuration configuration=new Configuration();
    Job job=new Job(configuration,"tableName");
    TableMapReduceUtil.initTableMapperJob(Bytes.toBytes("Table"),new Scan(),Import.Importer.class,Text.class,Text.class,job);
    assertEquals(TableInputFormat.class,job.getInputFormatClass());
    assertEquals(Import.Importer.class,job.getMapperClass());
    assertEquals(LongWritable.class,job.getOutputKeyClass());
    assertEquals(Text.class,job.getOutputValueClass());
    assertNull(job.getCombinerClass());
    assertEquals("Table",job.getConfiguration().get(TableInputFormat.INPUT_TABLE));
  }
  @Test public void testInitTableMapperJob4() throws Exception {
    Configuration configuration=new Configuration();
    Job job=new Job(configuration,"tableName");
    TableMapReduceUtil.initTableMapperJob(Bytes.toBytes("Table"),new Scan(),Import.Importer.class,Text.class,Text.class,job,false);
    assertEquals(TableInputFormat.class,job.getInputFormatClass());
    assertEquals(Import.Importer.class,job.getMapperClass());
    assertEquals(LongWritable.class,job.getOutputKeyClass());
    assertEquals(Text.class,job.getOutputValueClass());
    assertNull(job.getCombinerClass());
    assertEquals("Table",job.getConfiguration().get(TableInputFormat.INPUT_TABLE));
  }
}
