/** 
 * Predicate that waits for all store files in a table to have no compacted files.
 */
static class NoFilesToDischarge implements Predicate<Exception> {
  private final MiniHBaseCluster cluster;
  private final TableName tn;
  NoFilesToDischarge(  MiniHBaseCluster cluster,  TableName tn){
    this.cluster=cluster;
    this.tn=tn;
  }
  @Override public boolean evaluate() throws Exception {
    for (    HRegion region : cluster.getRegions(tn)) {
      for (      HStore store : region.getStores()) {
        Collection<HStoreFile> files=store.getStoreEngine().getStoreFileManager().getCompactedfiles();
        if (null != files && !files.isEmpty()) {
          LOG.debug(region.getRegionInfo().getEncodedName() + " still has compacted files");
          return false;
        }
      }
    }
    return true;
  }
}
