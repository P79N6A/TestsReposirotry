/** 
 * a mock fs which throws exception for first 3 times, and then process the call (returns the excepted result).
 */
static class MockFileSystem extends FileSystem {
  int retryCount;
  final static int successRetryCount=3;
  public MockFileSystem(){
    retryCount=0;
  }
  @Override public FSDataOutputStream append(  Path arg0,  int arg1,  Progressable arg2) throws IOException {
    throw new IOException("");
  }
  @Override public FSDataOutputStream create(  Path arg0,  FsPermission arg1,  boolean arg2,  int arg3,  short arg4,  long arg5,  Progressable arg6) throws IOException {
    LOG.debug("Create, " + retryCount);
    if (retryCount++ < successRetryCount)     throw new IOException("Something bad happen");
    return null;
  }
  @Override public boolean delete(  Path arg0) throws IOException {
    if (retryCount++ < successRetryCount)     throw new IOException("Something bad happen");
    return true;
  }
  @Override public boolean delete(  Path arg0,  boolean arg1) throws IOException {
    if (retryCount++ < successRetryCount)     throw new IOException("Something bad happen");
    return true;
  }
  @Override public FileStatus getFileStatus(  Path arg0) throws IOException {
    FileStatus fs=new FileStatus();
    return fs;
  }
  @Override public boolean exists(  Path path){
    return true;
  }
  @Override public URI getUri(){
    throw new RuntimeException("Something bad happen");
  }
  @Override public Path getWorkingDirectory(){
    throw new RuntimeException("Something bad happen");
  }
  @Override public FileStatus[] listStatus(  Path arg0) throws IOException {
    throw new IOException("Something bad happen");
  }
  @Override public boolean mkdirs(  Path arg0,  FsPermission arg1) throws IOException {
    LOG.debug("mkdirs, " + retryCount);
    if (retryCount++ < successRetryCount)     throw new IOException("Something bad happen");
    return true;
  }
  @Override public FSDataInputStream open(  Path arg0,  int arg1) throws IOException {
    throw new IOException("Something bad happen");
  }
  @Override public boolean rename(  Path arg0,  Path arg1) throws IOException {
    LOG.debug("rename, " + retryCount);
    if (retryCount++ < successRetryCount)     throw new IOException("Something bad happen");
    return true;
  }
  @Override public void setWorkingDirectory(  Path arg0){
    throw new RuntimeException("Something bad happen");
  }
}
