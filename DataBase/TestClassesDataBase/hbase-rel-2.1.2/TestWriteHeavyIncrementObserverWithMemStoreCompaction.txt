@Category({CoprocessorTests.class,MediumTests.class}) public class TestWriteHeavyIncrementObserverWithMemStoreCompaction extends WriteHeavyIncrementObserverTestBase {
  @ClassRule public static final HBaseClassTestRule CLASS_RULE=HBaseClassTestRule.forClass(TestWriteHeavyIncrementObserverWithMemStoreCompaction.class);
  @BeforeClass public static void setUp() throws Exception {
    WriteHeavyIncrementObserverTestBase.setUp();
    UTIL.getAdmin().createTable(TableDescriptorBuilder.newBuilder(NAME).setCoprocessor(WriteHeavyIncrementObserver.class.getName()).setValue(CompactingMemStore.COMPACTING_MEMSTORE_TYPE_KEY,MemoryCompactionPolicy.EAGER.name()).setColumnFamily(ColumnFamilyDescriptorBuilder.of(FAMILY)).build());
    TABLE=UTIL.getConnection().getTable(NAME);
  }
  @Test public void test() throws Exception {
    doIncrement(10);
    assertSum();
    HStore store=UTIL.getHBaseCluster().findRegionsForTable(NAME).get(0).getStore(FAMILY);
    assertEquals(0,store.getStorefilesCount());
  }
}
