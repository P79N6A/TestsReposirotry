/** 
 * HStoreForTesting is merely the same as HStore, the difference is in the doCompaction method of HStoreForTesting there is a checkpoint "hbase.hstore.compaction.complete" which doesn't let hstore compaction complete. In the former edition, this config is set in HStore class inside compact method, though this is just for testing, otherwise it doesn't do any help. In HBASE-8518, we try to get rid of all "hbase.hstore.compaction.complete" config (except for testing code).
 */
public static class HStoreForTesting extends HStore {
  protected HStoreForTesting(  final HRegion region,  final ColumnFamilyDescriptor family,  final Configuration confParam) throws IOException {
    super(region,family,confParam);
  }
  @Override protected List<HStoreFile> doCompaction(  CompactionRequestImpl cr,  Collection<HStoreFile> filesToCompact,  User user,  long compactionStartTime,  List<Path> newFiles) throws IOException {
    if (!this.conf.getBoolean("hbase.hstore.compaction.complete",true)) {
      LOG.warn("hbase.hstore.compaction.complete is set to false");
      List<HStoreFile> sfs=new ArrayList<>(newFiles.size());
      final boolean evictOnClose=cacheConf != null ? cacheConf.shouldEvictOnClose() : true;
      for (      Path newFile : newFiles) {
        HStoreFile sf=createStoreFileAndReader(newFile);
        sf.closeStoreFile(evictOnClose);
        sfs.add(sf);
      }
      return sfs;
    }
    return super.doCompaction(cr,filesToCompact,user,compactionStartTime,newFiles);
  }
}
