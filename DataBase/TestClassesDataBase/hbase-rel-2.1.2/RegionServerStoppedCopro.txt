/** 
 * This copro is used to simulate region server down exception for Get and Scan
 */
@CoreCoprocessor public static class RegionServerStoppedCopro implements RegionCoprocessor, RegionObserver {
  public RegionServerStoppedCopro(){
  }
  @Override public Optional<RegionObserver> getRegionObserver(){
    return Optional.of(this);
  }
  @Override public void preGetOp(  final ObserverContext<RegionCoprocessorEnvironment> e,  final Get get,  final List<Cell> results) throws IOException {
    int replicaId=e.getEnvironment().getRegion().getRegionInfo().getReplicaId();
    if (e.getEnvironment().getRegion().getRegionInfo().getReplicaId() <= 1) {
      LOG.info("Throw Region Server Stopped Exceptoin for replica id " + replicaId);
      throw new RegionServerStoppedException("Server " + e.getEnvironment().getServerName() + " not running");
    }
 else {
      LOG.info("We're replica region " + replicaId);
    }
  }
  @Override public void preScannerOpen(  final ObserverContext<RegionCoprocessorEnvironment> e,  final Scan scan) throws IOException {
    int replicaId=e.getEnvironment().getRegion().getRegionInfo().getReplicaId();
    if (e.getEnvironment().getRegion().getRegionInfo().getReplicaId() <= 1) {
      LOG.info("Throw Region Server Stopped Exceptoin for replica id " + replicaId);
      throw new RegionServerStoppedException("Server " + e.getEnvironment().getServerName() + " not running");
    }
 else {
      LOG.info("We're replica region " + replicaId);
    }
  }
}
