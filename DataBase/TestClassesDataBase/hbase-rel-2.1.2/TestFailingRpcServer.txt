private static class TestFailingRpcServer extends NettyRpcServer {
  TestFailingRpcServer(  Server server,  String name,  List<RpcServer.BlockingServiceAndInterface> services,  InetSocketAddress bindAddress,  Configuration conf,  RpcScheduler scheduler) throws IOException {
    super(server,name,services,bindAddress,conf,scheduler,true);
  }
static final class FailingConnection extends NettyServerRpcConnection {
    private FailingConnection(    TestFailingRpcServer rpcServer,    Channel channel){
      super(rpcServer,channel);
    }
    @Override public void processRequest(    ByteBuff buf) throws IOException, InterruptedException {
      throw new DoNotRetryIOException("Failing for test");
    }
  }
  @Override protected NettyRpcServerPreambleHandler createNettyRpcServerPreambleHandler(){
    return new NettyRpcServerPreambleHandler(TestFailingRpcServer.this){
      @Override protected NettyServerRpcConnection createNettyServerRpcConnection(      Channel channel){
        return new FailingConnection(TestFailingRpcServer.this,channel);
      }
    }
;
  }
}
