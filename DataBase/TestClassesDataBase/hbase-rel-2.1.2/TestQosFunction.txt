/** 
 * Basic test that qos function is sort of working; i.e. a change in method naming style over in pb doesn't break it.
 */
@Category({RegionServerTests.class,MediumTests.class}) public class TestQosFunction extends QosTestHelper {
  @ClassRule public static final HBaseClassTestRule CLASS_RULE=HBaseClassTestRule.forClass(TestQosFunction.class);
  private Configuration conf;
  private RSRpcServices rpcServices;
  private AnnotationReadingPriorityFunction qosFunction;
  @Before public void setUp(){
    conf=HBaseConfiguration.create();
    rpcServices=Mockito.mock(RSRpcServices.class);
    when(rpcServices.getConfiguration()).thenReturn(conf);
    qosFunction=new AnnotationReadingPriorityFunction(rpcServices,RSRpcServices.class);
  }
  @Test public void testPriority(){
    checkMethod(conf,"ReplicateWALEntry",HConstants.REPLICATION_QOS,qosFunction);
    checkMethod(conf,"OpenRegion",HConstants.ADMIN_QOS,qosFunction);
    checkMethod(conf,"Multi",HConstants.NORMAL_QOS,qosFunction,MultiRequest.getDefaultInstance());
  }
  @Test public void testAnnotations(){
    checkMethod(conf,"CloseRegion",HConstants.ADMIN_QOS,qosFunction);
    checkMethod(conf,"CompactRegion",HConstants.ADMIN_QOS,qosFunction);
    checkMethod(conf,"FlushRegion",HConstants.ADMIN_QOS,qosFunction);
  }
}
