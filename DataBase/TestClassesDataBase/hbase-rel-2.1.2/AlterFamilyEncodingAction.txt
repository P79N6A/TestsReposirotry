private class AlterFamilyEncodingAction extends ColumnAction {
  @Override void perform() throws IOException {
    TableDescriptor selected=selectTable(disabledTables);
    if (selected == null) {
      return;
    }
    ColumnFamilyDescriptor columnDesc=selectFamily(selected);
    if (columnDesc == null) {
      return;
    }
    Admin admin=connection.getAdmin();
    try {
      TableName tableName=selected.getTableName();
      DataBlockEncoding[] possibleIds={DataBlockEncoding.NONE,DataBlockEncoding.PREFIX,DataBlockEncoding.DIFF,DataBlockEncoding.FAST_DIFF,DataBlockEncoding.ROW_INDEX_V1};
      short id=possibleIds[RandomUtils.nextInt(0,possibleIds.length)].getId();
      LOG.info("Altering encoding of column family: " + columnDesc + " to: "+ id+ " in table: "+ tableName);
      ColumnFamilyDescriptor cfd=ColumnFamilyDescriptorBuilder.newBuilder(columnDesc).setDataBlockEncoding(DataBlockEncoding.getEncodingById(id)).build();
      TableDescriptor td=TableDescriptorBuilder.newBuilder(selected).modifyColumnFamily(cfd).build();
      admin.modifyTable(td);
      TableDescriptor freshTableDesc=admin.getTableDescriptor(tableName);
      ColumnFamilyDescriptor freshColumnDesc=freshTableDesc.getColumnFamily(columnDesc.getName());
      Assert.assertEquals("Encoding of column family: " + columnDesc + " was not altered",freshColumnDesc.getDataBlockEncoding().getId(),id);
      Assert.assertTrue("After alter encoding of column family, Table: " + tableName + " is not disabled",admin.isTableDisabled(tableName));
      disabledTables.put(tableName,freshTableDesc);
      LOG.info("Altered encoding of column family: " + freshColumnDesc + " to: "+ id+ " in table: "+ tableName);
    }
 catch (    Exception e) {
      LOG.warn("Caught exception in action: " + this.getClass());
      throw e;
    }
 finally {
      admin.close();
    }
  }
}
