@Category({MiscTests.class,MediumTests.class}) public class TestConnectionCache extends TestCase {
  @ClassRule public static final HBaseClassTestRule CLASS_RULE=HBaseClassTestRule.forClass(TestConnectionCache.class);
  private static final HBaseTestingUtility UTIL=new HBaseTestingUtility();
  /** 
 * test for ConnectionCache cleaning expired Connection
 */
  @Test public void testConnectionChore() throws Exception {
    UTIL.startMiniCluster();
    ConnectionCache cache=new ConnectionCache(UTIL.getConfiguration(),UserProvider.instantiate(UTIL.getConfiguration()),1000,5000);
    ConnectionCache.ConnectionInfo info=cache.getCurrentConnection();
    assertEquals(false,info.connection.isClosed());
    Thread.sleep(7000);
    assertEquals(true,info.connection.isClosed());
    UTIL.shutdownMiniCluster();
  }
}
