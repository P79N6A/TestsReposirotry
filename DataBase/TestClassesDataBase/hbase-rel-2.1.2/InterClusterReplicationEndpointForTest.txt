public static class InterClusterReplicationEndpointForTest extends HBaseInterClusterReplicationEndpoint {
  static AtomicInteger replicateCount=new AtomicInteger();
  static boolean failedOnce;
  public InterClusterReplicationEndpointForTest(){
    replicateCount.set(0);
  }
  @Override public boolean replicate(  ReplicateContext replicateContext){
    boolean success=super.replicate(replicateContext);
    if (success) {
      replicateCount.addAndGet(replicateContext.entries.size());
    }
    return success;
  }
  @Override protected Callable<Integer> createReplicator(  List<Entry> entries,  int ordinal){
    if (failedOnce) {
      return () -> ordinal;
    }
 else {
      failedOnce=true;
      return () -> {
        throw new IOException("Sample Exception: Failed to replicate.");
      }
;
    }
  }
}
