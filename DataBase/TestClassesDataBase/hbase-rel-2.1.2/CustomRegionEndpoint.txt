/** 
 * RegionEndpoint to test metrics from endpoint calls
 */
public static class CustomRegionEndpoint extends MultiRowMutationEndpoint {
  private Timer endpointExecution;
  @Override public void mutateRows(  RpcController controller,  MutateRowsRequest request,  RpcCallback<MutateRowsResponse> done){
    long start=System.nanoTime();
    super.mutateRows(controller,request,done);
    endpointExecution.updateNanos(System.nanoTime() - start);
  }
  @Override public void start(  CoprocessorEnvironment env) throws IOException {
    super.start(env);
    if (env instanceof RegionCoprocessorEnvironment) {
      MetricRegistry registry=((RegionCoprocessorEnvironment)env).getMetricRegistryForRegionServer();
      if (endpointExecution == null) {
        endpointExecution=registry.timer("EndpointExecution");
      }
    }
  }
}
