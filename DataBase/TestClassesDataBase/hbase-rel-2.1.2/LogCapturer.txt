/** 
 * LogCapturer is similar to  {@link org.apache.hadoop.test.GenericTestUtils.LogCapturer}except that this implementation has a default appender to the root logger. Hadoop 2.8+ supports the default appender in the LogCapture it ships and this can be replaced. TODO: This class can be removed after we upgrade Hadoop dependency.
 */
static class LogCapturer {
  private StringWriter sw=new StringWriter();
  private WriterAppender appender;
  private org.apache.log4j.Logger logger;
  LogCapturer(  org.apache.log4j.Logger logger){
    this.logger=logger;
    Appender defaultAppender=org.apache.log4j.Logger.getRootLogger().getAppender("stdout");
    if (defaultAppender == null) {
      defaultAppender=org.apache.log4j.Logger.getRootLogger().getAppender("console");
    }
    final Layout layout=(defaultAppender == null) ? new PatternLayout() : defaultAppender.getLayout();
    this.appender=new WriterAppender(layout,sw);
    this.logger.addAppender(this.appender);
  }
  String getOutput(){
    return sw.toString();
  }
  public void stopCapturing(){
    this.logger.removeAppender(this.appender);
  }
}
