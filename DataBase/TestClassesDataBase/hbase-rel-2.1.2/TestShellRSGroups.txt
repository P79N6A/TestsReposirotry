@Category({ClientTests.class,LargeTests.class}) public class TestShellRSGroups {
  @ClassRule public static final HBaseClassTestRule CLASS_RULE=HBaseClassTestRule.forClass(TestShellRSGroups.class);
  final Logger LOG=LoggerFactory.getLogger(getClass());
  private final static HBaseTestingUtility TEST_UTIL=new HBaseTestingUtility();
  private final static ScriptingContainer jruby=new ScriptingContainer();
  private static String basePath;
  @BeforeClass public static void setUpBeforeClass() throws Exception {
    basePath=System.getProperty("basedir");
    TEST_UTIL.getConfiguration().setInt("hbase.regionserver.msginterval",100);
    TEST_UTIL.getConfiguration().setInt("hbase.client.pause",250);
    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,6);
    TEST_UTIL.getConfiguration().setBoolean(CoprocessorHost.ABORT_ON_ERROR_KEY,false);
    TEST_UTIL.getConfiguration().setInt("hfile.format.version",3);
    SecureTestUtil.enableSecurity(TEST_UTIL.getConfiguration());
    VisibilityTestUtil.enableVisiblityLabels(TEST_UTIL.getConfiguration());
    TEST_UTIL.getConfiguration().set(HConstants.HBASE_MASTER_LOADBALANCER_CLASS,RSGroupBasedLoadBalancer.class.getName());
    TEST_UTIL.getConfiguration().set(CoprocessorHost.MASTER_COPROCESSOR_CONF_KEY,RSGroupAdminEndpoint.class.getName());
    TEST_UTIL.startMiniCluster(1,4);
    List<String> loadPaths=new ArrayList<>(2);
    loadPaths.add(basePath + "/src/main/ruby");
    loadPaths.add(basePath + "/src/test/ruby");
    jruby.setLoadPaths(loadPaths);
    jruby.put("$TEST_CLUSTER",TEST_UTIL);
    System.setProperty("jruby.jit.logging.verbose","true");
    System.setProperty("jruby.jit.logging","true");
    System.setProperty("jruby.native.verbose","true");
  }
  @AfterClass public static void tearDownAfterClass() throws Exception {
    TEST_UTIL.shutdownMiniCluster();
  }
  @Test public void testRunShellTests() throws IOException {
    try {
      System.setProperty("shell.test","Hbase::RSGroupShellTest");
      jruby.runScriptlet(PathType.ABSOLUTE,basePath + "/src/test/ruby/tests_runner.rb");
    }
  finally {
      System.clearProperty("shell.test");
    }
  }
}
