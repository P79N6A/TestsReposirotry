public static class TruncateTableProcedureOnHDFSFailure extends TruncateTableProcedure {
  private boolean failOnce=false;
  public TruncateTableProcedureOnHDFSFailure(){
    super();
  }
  public TruncateTableProcedureOnHDFSFailure(  final MasterProcedureEnv env,  TableName tableName,  boolean preserveSplits) throws HBaseIOException {
    super(env,tableName,preserveSplits);
  }
  @Override protected Flow executeFromState(  MasterProcedureEnv env,  MasterProcedureProtos.TruncateTableState state) throws InterruptedException {
    if (!failOnce && state == MasterProcedureProtos.TruncateTableState.TRUNCATE_TABLE_CREATE_FS_LAYOUT) {
      try {
        RegionInfo regionInfo=getFirstRegionInfo();
        Configuration conf=env.getMasterConfiguration();
        MasterFileSystem mfs=env.getMasterServices().getMasterFileSystem();
        Path tempdir=mfs.getTempDir();
        Path tableDir=FSUtils.getTableDir(tempdir,regionInfo.getTable());
        Path regionDir=FSUtils.getRegionDir(tableDir,regionInfo);
        FileSystem fs=FileSystem.get(conf);
        fs.mkdirs(regionDir);
        failOnce=true;
        return Flow.HAS_MORE_STATE;
      }
 catch (      IOException e) {
        fail("failed to create a region directory: " + e);
      }
    }
    return super.executeFromState(env,state);
  }
}
