class DodgyFSLog extends FSHLog {
  volatile boolean throwSyncException=false;
  volatile boolean throwAppendException=false;
  public DodgyFSLog(  FileSystem fs,  Path root,  String logDir,  Configuration conf) throws IOException {
    super(fs,root,logDir,conf);
  }
  @Override public byte[][] rollWriter(  boolean force) throws FailedLogCloseException, IOException {
    byte[][] regions=super.rollWriter(force);
    rolls.getAndIncrement();
    return regions;
  }
  @Override protected Writer createWriterInstance(  Path path) throws IOException {
    final Writer w=super.createWriterInstance(path);
    return new Writer(){
      @Override public void close() throws IOException {
        w.close();
      }
      @Override public void sync(      boolean forceSync) throws IOException {
        if (throwSyncException) {
          throw new IOException("FAKE! Failed to replace a bad datanode...");
        }
        w.sync(forceSync);
      }
      @Override public void append(      Entry entry) throws IOException {
        if (throwAppendException) {
          throw new IOException("FAKE! Failed to replace a bad datanode...");
        }
        w.append(entry);
      }
      @Override public long getLength(){
        return w.getLength();
      }
    }
;
  }
}
