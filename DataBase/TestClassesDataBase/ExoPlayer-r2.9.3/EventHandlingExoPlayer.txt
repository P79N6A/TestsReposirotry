private static class EventHandlingExoPlayer extends StubExoPlayer implements Handler.Callback, PlayerMessage.Sender {
  private final Handler handler;
  public EventHandlingExoPlayer(  Looper looper){
    this.handler=new Handler(looper,this);
  }
  @Override public Looper getApplicationLooper(){
    return handler.getLooper();
  }
  @Override public PlayerMessage createMessage(  PlayerMessage.Target target){
    return new PlayerMessage(this,target,Timeline.EMPTY,0,handler);
  }
  @Override public void sendMessage(  PlayerMessage message){
    handler.obtainMessage(0,message).sendToTarget();
  }
  @Override @SuppressWarnings("unchecked") public boolean handleMessage(  Message msg){
    PlayerMessage message=(PlayerMessage)msg.obj;
    try {
      message.getTarget().handleMessage(message.getType(),message.getPayload());
      message.markAsProcessed(true);
    }
 catch (    ExoPlaybackException e) {
      fail("Unexpected ExoPlaybackException.");
    }
    return true;
  }
}
