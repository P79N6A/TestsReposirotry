private class MediaSourceListener implements MediaSource.SourceInfoRefreshListener, MediaSourceEventListener {
  @Override public void onSourceInfoRefreshed(  MediaSource source,  Timeline timeline,  Object manifest){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
    timelines.addLast(timeline);
  }
  @Override public void onMediaPeriodCreated(  int windowIndex,  MediaPeriodId mediaPeriodId){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
    lastCreatedMediaPeriod.set(mediaPeriodId);
  }
  @Override public void onMediaPeriodReleased(  int windowIndex,  MediaPeriodId mediaPeriodId){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
    lastReleasedMediaPeriod.set(mediaPeriodId);
  }
  @Override public void onLoadStarted(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  LoadEventInfo loadEventInfo,  MediaLoadData mediaLoadData){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
  @Override public void onLoadCompleted(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  LoadEventInfo loadEventInfo,  MediaLoadData mediaLoadData){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
    completedLoads.add(Pair.create(windowIndex,mediaPeriodId));
  }
  @Override public void onLoadCanceled(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  LoadEventInfo loadEventInfo,  MediaLoadData mediaLoadData){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
  @Override public void onLoadError(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  LoadEventInfo loadEventInfo,  MediaLoadData mediaLoadData,  IOException error,  boolean wasCanceled){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
  @Override public void onReadingStarted(  int windowIndex,  MediaPeriodId mediaPeriodId){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
  @Override public void onUpstreamDiscarded(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  MediaLoadData mediaLoadData){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
  @Override public void onDownstreamFormatChanged(  int windowIndex,  @Nullable MediaPeriodId mediaPeriodId,  MediaLoadData mediaLoadData){
    Assertions.checkState(Looper.myLooper() == playbackThread.getLooper());
  }
}
