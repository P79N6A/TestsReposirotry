/** 
 * Unit test for  {@link OggPageHeader}.
 */
@RunWith(RobolectricTestRunner.class) public final class OggPageHeaderTest {
  @Test public void testPopulatePageHeader() throws IOException, InterruptedException {
    FakeExtractorInput input=OggTestData.createInput(TestUtil.joinByteArrays(OggTestData.buildOggHeader(0x01,123456,4,2),TestUtil.createByteArray(2,2)),true);
    OggPageHeader header=new OggPageHeader();
    populatePageHeader(input,header,false);
    assertThat(header.type).isEqualTo(0x01);
    assertThat(header.headerSize).isEqualTo(27 + 2);
    assertThat(header.bodySize).isEqualTo(4);
    assertThat(header.pageSegmentCount).isEqualTo(2);
    assertThat(header.granulePosition).isEqualTo(123456);
    assertThat(header.pageSequenceNumber).isEqualTo(4);
    assertThat(header.streamSerialNumber).isEqualTo(0x1000);
    assertThat(header.pageChecksum).isEqualTo(0x100000);
    assertThat(header.revision).isEqualTo(0);
  }
  @Test public void testPopulatePageHeaderQuiteOnExceptionLessThan27Bytes() throws IOException, InterruptedException {
    FakeExtractorInput input=OggTestData.createInput(TestUtil.createByteArray(2,2),false);
    OggPageHeader header=new OggPageHeader();
    assertThat(populatePageHeader(input,header,true)).isFalse();
  }
  @Test public void testPopulatePageHeaderQuiteOnExceptionNotOgg() throws IOException, InterruptedException {
    byte[] headerBytes=TestUtil.joinByteArrays(OggTestData.buildOggHeader(0x01,123456,4,2),TestUtil.createByteArray(2,2));
    headerBytes[0]='o';
    FakeExtractorInput input=OggTestData.createInput(headerBytes,false);
    OggPageHeader header=new OggPageHeader();
    assertThat(populatePageHeader(input,header,true)).isFalse();
  }
  @Test public void testPopulatePageHeaderQuiteOnExceptionWrongRevision() throws IOException, InterruptedException {
    byte[] headerBytes=TestUtil.joinByteArrays(OggTestData.buildOggHeader(0x01,123456,4,2),TestUtil.createByteArray(2,2));
    headerBytes[4]=0x01;
    FakeExtractorInput input=OggTestData.createInput(headerBytes,false);
    OggPageHeader header=new OggPageHeader();
    assertThat(populatePageHeader(input,header,true)).isFalse();
  }
  private boolean populatePageHeader(  FakeExtractorInput input,  OggPageHeader header,  boolean quite) throws IOException, InterruptedException {
    while (true) {
      try {
        return header.populate(input,quite);
      }
 catch (      SimulatedIOException e) {
      }
    }
  }
}
