public class TestLlapWebServices {
  private static LlapWebServices llapWS=null;
  private static int llapWSPort;
  @BeforeClass public static void beforeTests() throws Exception {
    llapWSPort=MetaStoreUtils.findFreePortExcepting(Integer.valueOf(HiveConf.ConfVars.LLAP_DAEMON_WEB_PORT.getDefaultValue()));
    llapWS=new LlapWebServices(llapWSPort,null,null);
    llapWS.init(new HiveConf());
    llapWS.start();
    Thread.sleep(5000);
  }
  @Test public void testContextRootUrlRewrite() throws Exception {
    String contextRootURL="http://localhost:" + llapWSPort + "/";
    String contextRootContent=getURLResponseAsString(contextRootURL);
    String indexHtmlUrl="http://localhost:" + llapWSPort + "/index.html";
    String indexHtmlContent=getURLResponseAsString(indexHtmlUrl);
    Assert.assertEquals(contextRootContent,indexHtmlContent);
  }
  private String getURLResponseAsString(  String baseURL) throws IOException {
    URL url=new URL(baseURL);
    HttpURLConnection conn=(HttpURLConnection)url.openConnection();
    Assert.assertEquals(HttpURLConnection.HTTP_OK,conn.getResponseCode());
    StringWriter writer=new StringWriter();
    IOUtils.copy(conn.getInputStream(),writer,"UTF-8");
    return writer.toString();
  }
  @AfterClass public static void afterTests() throws Exception {
    llapWS.stop();
  }
}
