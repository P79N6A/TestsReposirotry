public static class VerifyFastBytesHashMultiSet {
  private int count;
  private FastBytesHashMultiSetElement[] array;
  private TreeMap<BytesWritable,Integer> keyValueMap;
  public VerifyFastBytesHashMultiSet(){
    count=0;
    array=new FastBytesHashMultiSetElement[50];
    keyValueMap=new TreeMap<BytesWritable,Integer>();
  }
  public int getCount(){
    return count;
  }
  public boolean contains(  byte[] key){
    BytesWritable keyBytesWritable=new BytesWritable(key,key.length);
    return keyValueMap.containsKey(keyBytesWritable);
  }
  public void add(  byte[] key){
    BytesWritable keyBytesWritable=new BytesWritable(key,key.length);
    if (keyValueMap.containsKey(keyBytesWritable)) {
      int index=keyValueMap.get(keyBytesWritable);
      array[index].incrementMultiSetCount();
    }
 else {
      if (count >= array.length) {
        FastBytesHashMultiSetElement[] newArray=new FastBytesHashMultiSetElement[array.length * 2];
        System.arraycopy(array,0,newArray,0,count);
        array=newArray;
      }
      array[count]=new FastBytesHashMultiSetElement(key);
      keyValueMap.put(keyBytesWritable,count);
      count++;
    }
  }
  public byte[] addRandomExisting(  byte[] value,  Random r){
    Preconditions.checkState(count > 0);
    int index=r.nextInt(count);
    array[index].incrementMultiSetCount();
    return array[index].getKey();
  }
  public byte[] getKey(  int index){
    return array[index].getKey();
  }
  public int getMultiSetCount(  int index){
    return array[index].getMultiSetCount();
  }
  public void verify(  VectorMapJoinFastBytesHashMultiSet map){
    int mapSize=map.size();
    if (mapSize != count) {
      TestCase.fail("map.size() does not match expected count");
    }
    for (int index=0; index < count; index++) {
      FastBytesHashMultiSetElement element=array[index];
      byte[] key=element.getKey();
      int multiSetCount=element.getMultiSetCount();
      VectorMapJoinHashMultiSetResult hashMultiSetResult=map.createHashMultiSetResult();
      JoinUtil.JoinResult joinResult=map.contains(key,0,key.length,hashMultiSetResult);
      if (joinResult != JoinUtil.JoinResult.MATCH) {
        assertTrue(false);
      }
      assertEquals(hashMultiSetResult.count(),multiSetCount);
    }
  }
}
