public static class MetricCheckingHook implements HiveSemanticAnalyzerHook {
  @Override public ASTNode preAnalyze(  HiveSemanticAnalyzerHookContext context,  ASTNode ast) throws SemanticException {
    try {
      CodahaleMetrics metrics=(CodahaleMetrics)MetricsFactory.getInstance();
      String json=metrics.dumpJson();
      MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_semanticAnalyze",1);
      MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_compile",1);
      MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_hs2_operation_RUNNING",1);
      MetricsTestUtils.verifyMetricsJson(json,MetricsTestUtils.COUNTER,"active_calls_api_hs2_sql_operation_RUNNING",1);
    }
 catch (    Exception e) {
      throw new SemanticException("metrics verification failed",e);
    }
    return ast;
  }
  @Override public void postAnalyze(  HiveSemanticAnalyzerHookContext context,  List<Task<? extends Serializable>> rootTasks) throws SemanticException {
  }
}
