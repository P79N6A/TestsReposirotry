public class TestLlapTokenChecker {
  @Test public void testGetToken(){
    check(LlapTokenChecker.getTokenInfoInternal("u",null),"u",null);
    check(LlapTokenChecker.getTokenInfoInternal(null,createTokens("u",null)),"u",null);
    check(LlapTokenChecker.getTokenInfoInternal(null,createTokens("u","a")),"u","a");
    check(LlapTokenChecker.getTokenInfoInternal("u",createTokens("u","a")),"u","a");
    check(LlapTokenChecker.getTokenInfoInternal("u",createTokens("u","a","u",null)),"u","a");
    checkGetThrows("u",createTokens("u2","a"));
    checkGetThrows("u2",createTokens("u2","a","u3","a"));
    checkGetThrows(null,createTokens("u2","a","u3","a"));
    checkGetThrows(null,createTokens("u2","a","u2","a1"));
  }
  @Test public void testCheckPermissions(){
    LlapTokenChecker.checkPermissionsInternal("u",null,"u",null,null);
    LlapTokenChecker.checkPermissionsInternal(null,createTokens("u",null),"u",null,null);
    LlapTokenChecker.checkPermissionsInternal("u",createTokens("u","a"),"u","a",null);
    checkPrmThrows("u2",null,"u","a");
    checkPrmThrows("u",null,"u","a");
    checkPrmThrows(null,createTokens("u2","a"),"u","a");
    checkPrmThrows(null,createTokens("u","a2"),"u","a");
    checkPrmThrows(null,createTokens("u",null),"u","a");
  }
  private List<LlapTokenIdentifier> createTokens(  String... args){
    List<LlapTokenIdentifier> tokens=new ArrayList<>();
    for (int i=0; i < args.length; i+=2) {
      tokens.add(new LlapTokenIdentifier(new Text(args[i]),null,null,"c",args[i + 1],false));
    }
    return tokens;
  }
  private void checkGetThrows(  String kerberosName,  List<LlapTokenIdentifier> tokens){
    try {
      LlapTokenChecker.getTokenInfoInternal(kerberosName,tokens);
      fail("Didn't throw");
    }
 catch (    SecurityException ex) {
    }
  }
  private void checkPrmThrows(  String kerberosName,  List<LlapTokenIdentifier> tokens,  String userName,  String appId){
    try {
      LlapTokenChecker.checkPermissionsInternal(kerberosName,tokens,userName,appId,null);
      fail("Didn't throw");
    }
 catch (    SecurityException ex) {
    }
  }
  private void check(  LlapTokenChecker.LlapTokenInfo p,  String user,  String appId){
    assertEquals(user,p.userName);
    assertEquals(appId,p.appId);
  }
}
