public class CLIServiceRestoreTest {
  CLIService service=getService();
  @Test public void testRestore() throws HiveSQLException {
    SessionHandle session=service.openSession("foo","bar",null);
    service.stop();
    service=getService();
    try {
      service.getSessionManager().getSession(session);
      Assert.fail("session already exists before restore");
    }
 catch (    HiveSQLException e) {
      Assert.assertTrue(e.getMessage().contains("Invalid SessionHandle"));
    }
    service.createSessionWithSessionHandle(session,"foo","bar",null);
    Assert.assertNotNull(service.getSessionManager().getSession(session));
    service.stop();
  }
  public CLIService getService(){
    HiveConf conf=new HiveConf();
    conf.setVar(HiveConf.ConfVars.HIVE_AUTHORIZATION_MANAGER,"org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory");
    CLIService service=new CLIService(null);
    service.init(conf);
    service.start();
    return service;
  }
}
