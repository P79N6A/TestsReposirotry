public class TestErrors {
  @Rule public TemporaryFolder temp=new TemporaryFolder();
  @Test(timeout=20000L) public void testAllInvalidConfig() throws Exception {
    File f=temp.newFolder();
    MultiLayerSpace mls=new MultiLayerSpace.Builder().addLayer(new DenseLayerSpace.Builder().nIn(4).nOut(new FixedValue<>(0)).activation(Activation.TANH).build()).addLayer(new OutputLayerSpace.Builder().nOut(3).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build()).build();
    CandidateGenerator candidateGenerator=new RandomSearchGenerator(mls);
    OptimizationConfiguration configuration=new OptimizationConfiguration.Builder().candidateGenerator(candidateGenerator).dataProvider(new TestDataProviderMnist(32,10)).modelSaver(new FileModelSaver(f)).scoreFunction(new TestSetLossScoreFunction(true)).terminationConditions(new MaxCandidatesCondition(5)).build();
    IOptimizationRunner runner=new LocalOptimizationRunner(configuration);
    runner.execute();
  }
  @Test(timeout=20000L) public void testAllInvalidDataConfigMismatch() throws Exception {
    File f=temp.newFolder();
    MultiLayerSpace mls=new MultiLayerSpace.Builder().addLayer(new DenseLayerSpace.Builder().nIn(4).nOut(10).activation(Activation.TANH).build()).addLayer(new OutputLayerSpace.Builder().nIn(10).nOut(3).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build()).build();
    CandidateGenerator candidateGenerator=new RandomSearchGenerator(mls);
    OptimizationConfiguration configuration=new OptimizationConfiguration.Builder().candidateGenerator(candidateGenerator).dataProvider(new TestDataProviderMnist(32,10)).modelSaver(new FileModelSaver(f)).scoreFunction(new TestSetLossScoreFunction(true)).terminationConditions(new MaxCandidatesCondition(5)).build();
    IOptimizationRunner runner=new LocalOptimizationRunner(configuration);
    runner.execute();
  }
  @Test(timeout=20000L) public void testAllInvalidConfigCG() throws Exception {
    File f=temp.newFolder();
    ComputationGraphSpace mls=new ComputationGraphSpace.Builder().addInputs("in").layer("0",new DenseLayerSpace.Builder().nIn(4).nOut(new FixedValue<>(0)).activation(Activation.TANH).build(),"in").layer("1",new OutputLayerSpace.Builder().nOut(3).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build(),"0").setOutputs("1").build();
    CandidateGenerator candidateGenerator=new RandomSearchGenerator(mls);
    OptimizationConfiguration configuration=new OptimizationConfiguration.Builder().candidateGenerator(candidateGenerator).dataProvider(new TestDataProviderMnist(32,10)).modelSaver(new FileModelSaver(f)).scoreFunction(new TestSetLossScoreFunction(true)).terminationConditions(new MaxCandidatesCondition(5)).build();
    IOptimizationRunner runner=new LocalOptimizationRunner(configuration);
    runner.execute();
  }
  @Test(timeout=20000L) public void testAllInvalidDataConfigMismatchCG() throws Exception {
    File f=temp.newFolder();
    ComputationGraphSpace mls=new ComputationGraphSpace.Builder().addInputs("in").layer("0",new DenseLayerSpace.Builder().nIn(4).nOut(10).activation(Activation.TANH).build(),"in").addLayer("1",new OutputLayerSpace.Builder().nIn(10).nOut(3).activation(Activation.SOFTMAX).lossFunction(LossFunctions.LossFunction.MCXENT).build(),"0").setOutputs("1").build();
    CandidateGenerator candidateGenerator=new RandomSearchGenerator(mls);
    OptimizationConfiguration configuration=new OptimizationConfiguration.Builder().candidateGenerator(candidateGenerator).dataProvider(new TestDataProviderMnist(32,10)).modelSaver(new FileModelSaver(f)).scoreFunction(new TestSetLossScoreFunction(true)).terminationConditions(new MaxCandidatesCondition(5)).build();
    IOptimizationRunner runner=new LocalOptimizationRunner(configuration,new MultiLayerNetworkTaskCreator());
    runner.execute();
  }
}
