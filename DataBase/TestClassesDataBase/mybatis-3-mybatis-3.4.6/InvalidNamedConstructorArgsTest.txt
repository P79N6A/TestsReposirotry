public class InvalidNamedConstructorArgsTest {
  private static SqlSessionFactory sqlSessionFactory;
  @BeforeClass public static void setUp() throws Exception {
    Reader reader=Resources.getResourceAsReader("org/apache/ibatis/submitted/named_constructor_args/mybatis-config.xml");
    sqlSessionFactory=new SqlSessionFactoryBuilder().build(reader);
    reader.close();
    SqlSession session=sqlSessionFactory.openSession();
    Connection conn=session.getConnection();
    reader=Resources.getResourceAsReader("org/apache/ibatis/submitted/named_constructor_args/CreateDB.sql");
    ScriptRunner runner=new ScriptRunner(conn);
    runner.setLogWriter(null);
    runner.runScript(reader);
    conn.close();
    reader.close();
    session.close();
  }
interface NoMatchingConstructorMapper {
    @ConstructorArgs({@Arg(column="id",name="noSuchConstructorArg")}) @Select("select * from users ") User select();
  }
  @Test public void noMatchingConstructorArgName(){
    Configuration configuration=sqlSessionFactory.getConfiguration();
    when(configuration).addMapper(NoMatchingConstructorMapper.class);
    then(caughtException()).isInstanceOf(BuilderException.class).hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.InvalidNamedConstructorArgsTest$NoMatchingConstructorMapper.select-void'").hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.User'").hasMessageContaining("[noSuchConstructorArg]");
  }
interface ConstructorWithWrongJavaType {
    @ConstructorArgs({@Arg(column="id",name="id",javaType=Integer.class)}) @Select("select * from users ") User select();
  }
  @Test public void wrongJavaType(){
    Configuration configuration=sqlSessionFactory.getConfiguration();
    when(configuration).addMapper(ConstructorWithWrongJavaType.class);
    then(caughtException()).isInstanceOf(BuilderException.class).hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.InvalidNamedConstructorArgsTest$ConstructorWithWrongJavaType.select-void'").hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.User'").hasMessageContaining("[id]");
  }
interface ConstructorMissingRequiresJavaType {
    @ConstructorArgs({@Arg(column="id",name="id")}) @Select("select * from users ") User select();
  }
  @Test public void missingRequiredJavaType(){
    Configuration configuration=sqlSessionFactory.getConfiguration();
    when(configuration).addMapper(ConstructorMissingRequiresJavaType.class);
    then(caughtException()).isInstanceOf(BuilderException.class).hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.InvalidNamedConstructorArgsTest$ConstructorMissingRequiresJavaType.select-void'").hasMessageContaining("'org.apache.ibatis.submitted.named_constructor_args.User'").hasMessageContaining("[id]");
  }
}
