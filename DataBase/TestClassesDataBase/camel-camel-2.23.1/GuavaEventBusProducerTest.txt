public class GuavaEventBusProducerTest extends CamelTestSupport {
  EventBus eventBus=new EventBus();
  Object receivedEvent;
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").to("guava-eventbus:eventBus");
      }
    }
;
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry registry=super.createRegistry();
    registry.bind("eventBus",eventBus);
    return registry;
  }
  @Test public void shouldReceiveMessageFromCamel() throws InterruptedException {
    String message="message";
    eventBus.register(this);
    sendBody("direct:start",message);
    assertEquals(message,receivedEvent);
  }
  @Subscribe public void receiveEvent(  Object event){
    this.receivedEvent=event;
  }
}
