/** 
 * @version 
 */
public class RmiRouteTest extends RmiRouteTestSupport {
  protected int getStartPort(){
    return 37503;
  }
  @Test public void testPojoRoutes() throws Exception {
    if (classPathHasSpaces()) {
      return;
    }
    LocateRegistry.createRegistry(getPort());
    JndiContext context=new JndiContext();
    context.bind("bye",new SayService("Good Bye!"));
    CamelContext camelContext=new DefaultCamelContext(context);
    camelContext.addRoutes(getRouteBuilder(camelContext));
    camelContext.start();
    Endpoint endpoint=camelContext.getEndpoint("direct:hello");
    ISay proxy=ProxyHelper.createProxy(endpoint,false,ISay.class);
    String rc=proxy.say();
    assertEquals("Good Bye!",rc);
    camelContext.stop();
  }
  protected RouteBuilder getRouteBuilder(  final CamelContext context){
    return new RouteBuilder(){
      public void configure(){
        from("direct:hello").toF("rmi://localhost:%s/bye",getPort());
        RmiEndpoint bye=(RmiEndpoint)endpoint("rmi://localhost:" + getPort() + "/bye");
        bye.setRemoteInterfaces(ISay.class);
        from(bye).to("bean:bye");
      }
    }
;
  }
}
