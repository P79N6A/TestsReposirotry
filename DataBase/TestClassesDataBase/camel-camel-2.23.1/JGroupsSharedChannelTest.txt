/** 
 * Test for shared channel in JGroups endpoint
 */
public class JGroupsSharedChannelTest extends CamelTestSupport {
  private static final String JGROUPS_SHARED_CHANNEL="jgroups:sharedChannel";
  private static final String DIRECT_PRODUCER="direct:producer";
  private static final String MOCK_CONSUMER="mock:consumer";
  private static final String PRODUCER_ROUTE="producerRoute";
  private static final String CONSUMER_ROUTE="consumerRoute";
  private static final String TEST_MESSAGE="Test Message";
  @Test public void testStopStartProducer() throws Exception {
    context().stopRoute(PRODUCER_ROUTE);
    context().startRoute(PRODUCER_ROUTE);
    testSendReceive();
  }
  @Test public void testStopStartConsumer() throws Exception {
    context().stopRoute(CONSUMER_ROUTE);
    template().sendBody(DIRECT_PRODUCER,TEST_MESSAGE);
    context().startRoute(CONSUMER_ROUTE);
    testSendReceive();
  }
  private void testSendReceive() throws InterruptedException {
    template().sendBody(DIRECT_PRODUCER,TEST_MESSAGE);
    final MockEndpoint mockEndpoint=getMockEndpoint(MOCK_CONSUMER);
    mockEndpoint.expectedMinimumMessageCount(1);
    mockEndpoint.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(DIRECT_PRODUCER).routeId(PRODUCER_ROUTE).to(JGROUPS_SHARED_CHANNEL);
        from(JGROUPS_SHARED_CHANNEL).routeId(CONSUMER_ROUTE).to(MOCK_CONSUMER);
      }
    }
;
  }
}
