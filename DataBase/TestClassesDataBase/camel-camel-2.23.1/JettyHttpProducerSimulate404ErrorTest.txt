/** 
 * @version 
 */
public class JettyHttpProducerSimulate404ErrorTest extends BaseJettyTest {
  private String url="jetty://http://127.0.0.1:" + getPort() + "/bar";
  @Test public void test404() throws Exception {
    Thread.sleep(1000);
    try {
      template.sendBody(url,null);
      fail("Should have thrown exception");
    }
 catch (    Exception e) {
      HttpOperationFailedException cause=assertIsInstanceOf(HttpOperationFailedException.class,e.getCause());
      assertEquals(404,cause.getStatusCode());
      assertEquals("http://127.0.0.1:" + getPort() + "/bar",cause.getUri());
      assertEquals("Page not found",cause.getResponseBody());
      assertNotNull(cause.getResponseHeaders());
    }
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(url).process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            Thread.sleep(1000);
            exchange.getOut().setBody("Page not found");
            exchange.getOut().setHeader(Exchange.HTTP_RESPONSE_CODE,404);
          }
        }
);
      }
    }
;
  }
}
