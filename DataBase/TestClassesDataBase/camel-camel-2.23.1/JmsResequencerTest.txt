/** 
 * Unit test for issues CAMEL-1034 and CAMEL-1037
 */
public class JmsResequencerTest extends CamelSpringTestSupport {
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/component/jms/issues/JmsResequencerTest-context.xml");
  }
  @Test public void testBatchResequencer() throws Exception {
    testResequencer("activemq:queue:in1");
  }
  @Test public void testStreamResequencer() throws Exception {
    testResequencer("activemq:queue:in2");
  }
  private void testResequencer(  String endpoint) throws Exception {
    MockEndpoint result=getMockEndpoint("mock:result");
    result.expectedMessageCount(100);
    for (int i=0; i < 100; i++) {
      result.message(i).body().isEqualTo(Integer.valueOf(i + 1));
    }
    for (int i=100; i > 0; i--) {
      template.sendBodyAndHeader(endpoint,Integer.valueOf(i),"num",Long.valueOf(i));
    }
    assertMockEndpointsSatisfied();
  }
}
