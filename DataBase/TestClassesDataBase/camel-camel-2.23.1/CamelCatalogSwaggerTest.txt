public class CamelCatalogSwaggerTest {
  private Server server;
  private CamelCatalogRest catalog;
  private int port;
  @Before public void setup(){
    catalog=new CamelCatalogRest();
    port=AvailablePortFinder.getNextAvailable(9000);
    JAXRSServerFactoryBean sf=new JAXRSServerFactoryBean();
    sf.setResourceClasses(CamelCatalogRest.class);
    sf.setResourceProvider(CamelCatalogRest.class,new SingletonResourceProvider(catalog));
    Swagger2Feature swagger=new Swagger2Feature();
    swagger.setBasePath("/");
    swagger.setScanAllResources(false);
    swagger.setPrettyPrint(true);
    swagger.setSupportSwaggerUi(true);
    swagger.setTitle("Camel Catalog REST Api");
    swagger.setDescription("REST Api for the Camel Catalog");
    swagger.setVersion(catalog.getCatalogVersion());
    swagger.setContact("Apache Camel");
    sf.getFeatures().add(swagger);
    sf.setProvider(JacksonJsonProvider.class);
    sf.setAddress("http://localhost:" + port);
    server=sf.create();
    server.start();
  }
  @After public void stop(){
    if (server != null) {
      server.stop();
    }
  }
  @Test public void testSwagger() throws Exception {
    given().baseUri("http://localhost:" + port).when().get("/swagger.json").then().body("paths./camel-catalog/catalogVersion.get.summary",Matchers.is("The version of this Camel Catalog"));
  }
}
