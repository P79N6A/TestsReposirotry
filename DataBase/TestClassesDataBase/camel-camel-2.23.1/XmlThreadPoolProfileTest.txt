@RunWith(Arquillian.class) @ImportResource("imported-context.xml") public class XmlThreadPoolProfileTest {
  @Inject @Uri("direct:inbound") private ProducerTemplate inbound;
  @Deployment public static Archive<?> deployment(){
    return ShrinkWrap.create(JavaArchive.class).addPackage(CdiCamelExtension.class.getPackage()).addAsResource(Paths.get("src/test/resources/camel-context-threadPoolProfile.xml").toFile(),"imported-context.xml").addAsManifestResource(EmptyAsset.INSTANCE,"beans.xml");
  }
  @Test public void verifyThreadProfile(  CamelContext context){
    ThreadPoolProfile profile=context.getExecutorServiceManager().getThreadPoolProfile("thread-pool-profile");
    assertThat("Thread pool profile is null!",profile,is(notNullValue()));
    assertThat("Thread pool profile is incorrect!",profile.getPoolSize(),is(equalTo(5)));
  }
  @Test public void sendMessageToInbound(){
    String body=inbound.requestBody((Object)"message",String.class);
    assertThat("Body is incorrect!",body,matchesPattern("^Processed \\[message] with \\[Camel \\(test\\) thread #\\d+ - Profile Threads]$"));
  }
}
