public class LoanBrokerWSTest extends CamelSpringTestSupport {
  private static String url;
  @BeforeClass public static void setupFreePort() throws Exception {
    int port=AvailablePortFinder.getNextAvailable();
    String bank1="bank1.port=" + port;
    port=AvailablePortFinder.getNextAvailable();
    String bank2="bank2.port=" + port;
    port=AvailablePortFinder.getNextAvailable();
    String bank3="bank3.port=" + port;
    port=AvailablePortFinder.getNextAvailable();
    String credit="credit_agency.port=" + port;
    port=AvailablePortFinder.getNextAvailable();
    String loan="loan_broker.port=" + port;
    File custom=new File("target/custom.properties");
    FileOutputStream fos=new FileOutputStream(custom);
    fos.write(bank1.getBytes());
    fos.write("\n".getBytes());
    fos.write(bank2.getBytes());
    fos.write("\n".getBytes());
    fos.write(bank3.getBytes());
    fos.write("\n".getBytes());
    fos.write(credit.getBytes());
    fos.write("\n".getBytes());
    fos.write(loan.getBytes());
    fos.write("\n".getBytes());
    fos.close();
    url="http://localhost:" + port + "/loanBroker";
  }
  @Test public void testInvocation() throws Exception {
    LoanBrokerWS loanBroker=Client.getProxy(url);
    String result=loanBroker.getLoanQuote("SSN",1000.54,10);
    log.info("Result: {}",result);
    assertTrue(result.startsWith("The best rate is [ssn:SSN bank:bank"));
  }
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("/META-INF/spring/webServiceCamelContext.xml");
  }
}
