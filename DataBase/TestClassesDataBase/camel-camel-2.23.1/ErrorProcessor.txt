/** 
 * This processor throws an exception as the fourth message received.
 */
private static final class ErrorProcessor implements Processor {
  int count;
  @Override public void process(  Exchange exchange) throws Exception {
    count++;
    if (count == 4) {
      throw new RuntimeException("Ooops");
    }
  }
}
