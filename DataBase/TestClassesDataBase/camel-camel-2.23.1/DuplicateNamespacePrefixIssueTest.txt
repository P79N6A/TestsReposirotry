/** 
 * CAMEL-10817: dumpModelAsXml can return invalid XML namespace xmlns:xmlns
 */
@RunWith(PaxExam.class) public class DuplicateNamespacePrefixIssueTest extends AbstractFeatureTest {
  @Test public void testRoutesNamespacePrefixesNotDuplicated() throws Exception {
    CamelContext context=new BlueprintCamelContext(bundleContext,blueprintContainer);
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:foo").id("foo").choice().when(xpath("foo:foo/foo:foo = 'foo'")).log("Matched foo").when(xpath("foo:foo/foo:bar = 'bar'")).log("Matched bar").when(xpath("foo:foo/foo:cheese = 'cheese'")).log("Matched cheese");
      }
    }
);
    String originalModelXML=ModelHelper.dumpModelAsXml(context,context.getRouteDefinition("foo"));
    InputStream stream=new ByteArrayInputStream(originalModelXML.getBytes("UTF-8"));
    RoutesDefinition routesDefinition=ModelHelper.loadRoutesDefinition(context,stream);
    String modifiedModelXML=ModelHelper.dumpModelAsXml(context,routesDefinition);
    String modifiedRoutesElementXML=modifiedModelXML.split("\n")[1];
    String expectedRoutesElementXML="<routes xmlns=\"http://camel.apache.org/schema/spring\">";
    Assert.assertEquals(expectedRoutesElementXML,modifiedRoutesElementXML);
  }
  @Configuration public Option[] configure(){
    return AbstractFeatureTest.configure();
  }
}
