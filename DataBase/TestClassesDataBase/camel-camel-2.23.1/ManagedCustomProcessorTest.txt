/** 
 * @version 
 */
public class ManagedCustomProcessorTest extends ManagementTestSupport {
  @Test public void testManageCustomProcessor() throws Exception {
    if (isPlatform("aix")) {
      return;
    }
    MBeanServer mbeanServer=getMBeanServer();
    ObjectName on=ObjectName.getInstance("org.apache.camel:context=camel-1,type=processors,name=\"custom\"");
    getMockEndpoint("mock:result").expectedMessageCount(1);
    getMockEndpoint("mock:result").expectedHeaderReceived("foo","hey");
    template.sendBody("direct:start","Hello World");
    assertMockEndpointsSatisfied();
    String foo=(String)mbeanServer.getAttribute(on,"Foo");
    assertEquals("hey",foo);
    mbeanServer.setAttribute(on,new Attribute("Foo","changed"));
    resetMocks();
    getMockEndpoint("mock:result").expectedMessageCount(1);
    getMockEndpoint("mock:result").expectedHeaderReceived("foo","changed");
    template.sendBody("direct:start","Bye World");
    assertMockEndpointsSatisfied();
    String state=(String)mbeanServer.getAttribute(on,"State");
    assertEquals("Started",state);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").routeId("foo").process(new MyCustomProcessor()).id("custom").to("mock:result");
      }
    }
;
  }
@ManagedResource(description="My Managed Component") public static class MyCustomProcessor extends ServiceSupport implements Processor {
    private String foo="hey";
    @ManagedAttribute public String getFoo(){
      return foo;
    }
    @ManagedAttribute public void setFoo(    String foo){
      this.foo=foo;
    }
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setHeader("foo",getFoo());
    }
    @Override protected void doStart() throws Exception {
    }
    @Override protected void doStop() throws Exception {
    }
  }
}
