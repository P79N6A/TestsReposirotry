public class CxfHolderConsumerTest extends CamelTestSupport {
  protected static final String ADDRESS="http://localhost:" + CXFTestSupport.getPort1() + "/CxfHolderConsumerTest/test";
  protected static final String CXF_ENDPOINT_URI="cxf://" + ADDRESS + "?serviceClass=org.apache.camel.component.cxf.holder.MyOrderEndpoint"+ "&loggingFeatureEnabled=true";
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from(CXF_ENDPOINT_URI).process(new MyProcessor());
      }
    }
;
  }
  @Test public void testInvokingServiceFromCXFClient() throws Exception {
    JaxWsProxyFactoryBean proxyFactory=new JaxWsProxyFactoryBean();
    ClientFactoryBean clientBean=proxyFactory.getClientFactoryBean();
    clientBean.setAddress(ADDRESS);
    clientBean.setServiceClass(MyOrderEndpoint.class);
    MyOrderEndpoint client=(MyOrderEndpoint)proxyFactory.create();
    Holder<String> strPart=new Holder<>();
    strPart.value="parts";
    Holder<String> strCustomer=new Holder<>();
    strCustomer.value="";
    String result=client.myOrder(strPart,2,strCustomer);
    assertEquals("Get a wrong order result","Ordered ammount 2",result);
    assertEquals("Get a wrong parts","parts",strPart.value);
    assertEquals("Get a wrong customer","newCustomer",strCustomer.value);
  }
  @Test public void testInvokingServiceWithSoapHeaderFromCXFClient() throws Exception {
    JaxWsProxyFactoryBean proxyFactory=new JaxWsProxyFactoryBean();
    ClientFactoryBean clientBean=proxyFactory.getClientFactoryBean();
    clientBean.setAddress(ADDRESS);
    clientBean.setServiceClass(MyOrderEndpoint.class);
    MyOrderEndpoint client=(MyOrderEndpoint)proxyFactory.create();
    Holder<String> header=new Holder<>();
    header.value="parts";
    String result=client.mySecureOrder(1,header);
    assertEquals("Get a wrong order result","Ordered ammount 1",result);
    assertEquals("Get a wrong parts","secureParts",header.value);
  }
}
