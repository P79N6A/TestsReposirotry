public class IrcConsumerTest {
  private IRCConnection connection;
  private Processor processor;
  private IrcEndpoint endpoint;
  private IrcConfiguration configuration;
  private IrcConsumer consumer;
  private IRCEventAdapter listener;
  @Before public void doSetup(){
    connection=mock(IRCConnection.class);
    endpoint=mock(IrcEndpoint.class);
    processor=mock(Processor.class);
    configuration=mock(IrcConfiguration.class);
    listener=mock(IRCEventAdapter.class);
    List<IrcChannel> channels=new ArrayList<>();
    channels.add(new IrcChannel("#chan1",null));
    channels.add(new IrcChannel("#chan2","chan2key"));
    when(configuration.getChannels()).thenReturn(channels);
    when(endpoint.getConfiguration()).thenReturn(configuration);
    consumer=new IrcConsumer(endpoint,processor,connection);
    consumer.setListener(listener);
  }
  @Test public void doStopTest() throws Exception {
    consumer.doStop();
    verify(connection).doPart("#chan1");
    verify(connection).doPart("#chan2");
    verify(connection).removeIRCEventListener(listener);
  }
  @Test public void doStartTest() throws Exception {
    consumer.doStart();
    verify(connection).addIRCEventListener(listener);
    verify(endpoint).joinChannels();
  }
}
