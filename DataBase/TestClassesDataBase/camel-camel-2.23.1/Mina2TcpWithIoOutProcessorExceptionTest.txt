/** 
 * To unit test CAMEL-364.
 */
public class Mina2TcpWithIoOutProcessorExceptionTest extends BaseMina2Test {
  @Test public void testExceptionThrownInProcessor(){
    String body="Hello World";
    Object result=template.requestBody(String.format("mina2:tcp://localhost:%1$s?textline=true&sync=true",getPort()),body);
    assertNotNull("the result should not be null",result);
    assertEquals("result is IllegalArgumentException",result,"java.lang.IllegalArgumentException: Forced exception");
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        errorHandler(defaultErrorHandler().maximumRedeliveries(2));
        from(String.format("mina2:tcp://localhost:%1$s?textline=true&sync=true",getPort())).process(new Processor(){
          public void process(          Exchange e){
            assertEquals("Hello World",e.getIn().getBody(String.class));
            throw new IllegalArgumentException("Forced exception");
          }
        }
);
      }
    }
;
  }
}
