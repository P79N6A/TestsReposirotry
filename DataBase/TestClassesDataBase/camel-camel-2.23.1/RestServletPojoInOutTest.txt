public class RestServletPojoInOutTest extends ServletCamelRouterTestSupport {
  @Test public void testServletPojoInOut() throws Exception {
    String body="{\"id\": 123, \"name\": \"Donald Duck\"}";
    WebRequest req=new PostMethodWebRequest(CONTEXT_URL + "/services/users/lives",new ByteArrayInputStream(body.getBytes()),"application/json");
    ServletUnitClient client=newClient();
    client.setExceptionsThrownOnErrorStatus(false);
    WebResponse response=client.getResponse(req);
    assertEquals(200,response.getResponseCode());
    String out=response.getText();
    assertNotNull(out);
    assertEquals("{\"iso\":\"EN\",\"country\":\"England\"}",out);
  }
  @Test public void testServletPojoGet() throws Exception {
    WebRequest req=new GetMethodWebRequest(CONTEXT_URL + "/services/users/lives");
    ServletUnitClient client=newClient();
    client.setExceptionsThrownOnErrorStatus(false);
    WebResponse response=client.getResponse(req);
    assertEquals(200,response.getResponseCode());
    String out=response.getText();
    assertNotNull(out);
    assertEquals("{\"iso\":\"EN\",\"country\":\"England\"}",out);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        restConfiguration().component("servlet").bindingMode(RestBindingMode.auto);
        rest("/users/").get("lives").to("direct:start").post("lives").type(UserPojo.class).outType(CountryPojo.class).route().bean(new UserService(),"livesWhere");
        CountryPojo country=new CountryPojo();
        country.setIso("EN");
        country.setCountry("England");
        from("direct:start").transform().constant(country);
      }
    }
;
  }
}
