public class LoanBrokerQueueTest extends TestSupport {
  private AbstractApplicationContext applicationContext;
  private CamelContext camelContext;
  private ProducerTemplate template;
  @Before public void startServices() throws Exception {
    applicationContext=new ClassPathXmlApplicationContext("META-INF/spring/server.xml");
    camelContext=getCamelContext();
    camelContext.addRoutes(new LoanBrokerRoute());
    template=camelContext.createProducerTemplate();
    camelContext.start();
  }
  @After public void stopServices() throws Exception {
    if (camelContext != null) {
      camelContext.stop();
    }
  }
  @Test public void testClientInvocation() throws Exception {
    String out=template.requestBodyAndHeader("jms:queue:loan",null,Constants.PROPERTY_SSN,"Client-A",String.class);
    log.info("Result: {}",out);
    assertNotNull(out);
    assertTrue(out.startsWith("The best rate is [ssn:Client-A bank:bank"));
  }
  protected CamelContext getCamelContext() throws Exception {
    return applicationContext.getBean("camel",CamelContext.class);
  }
}
