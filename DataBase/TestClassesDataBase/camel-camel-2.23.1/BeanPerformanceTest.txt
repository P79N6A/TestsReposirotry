/** 
 */
public class BeanPerformanceTest extends ContextTestSupport {
  private static final AtomicLong INVOKED=new AtomicLong();
  private final int times=100000;
  public static void doSomething(  String payload){
    assertEquals("Hello World",payload);
    INVOKED.incrementAndGet();
  }
  @Test public void testBeanPerformance() throws Exception {
    StopWatch watch=new StopWatch();
    log.info("Invoking a bean in a route {} times",times);
    for (int i=0; i < times; i++) {
      template.sendBody("direct:start","Hello World");
    }
    log.info("Took {} to invoke the bean {} times",TimeUtils.printDuration(watch.taken()),times);
    assertEquals(times,INVOKED.get());
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").bean(BeanPerformanceTest.class,"doSomething");
      }
    }
;
  }
}
