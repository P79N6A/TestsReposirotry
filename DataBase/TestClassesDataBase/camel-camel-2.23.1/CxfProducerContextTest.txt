public class CxfProducerContextTest extends CxfProducerTest {
  private static final String TEST_KEY="sendSimpleMessage-test";
  private static final String TEST_VALUE="exchange property value should get passed through request context";
  @Test public void testExchangePropertyPropagation() throws Exception {
    Exchange exchange=sendSimpleMessage();
    assertNotNull(exchange);
    Map<String,Object> requestContext=CastUtils.cast((Map<?,?>)exchange.getProperty(Client.REQUEST_CONTEXT));
    assertNotNull(requestContext);
    String actualValue=(String)requestContext.get(TEST_KEY);
    assertEquals("exchange property should get propagated to the request context",TEST_VALUE,actualValue);
  }
  @Override protected String getSimpleEndpointUri(){
    return "cxf://http://localhost:" + CXFTestSupport.getPort4() + "/CxfProducerContextTest/simple?serviceClass=org.apache.camel.component.cxf.HelloService";
  }
  @Override protected String getJaxwsEndpointUri(){
    return "cxf://http://localhost:" + CXFTestSupport.getPort4() + "/CxfProducerContextTest/jaxws?serviceClass=org.apache.hello_world_soap_http.Greeter";
  }
  @Override protected Exchange sendSimpleMessage(){
    Exchange exchange=template.send(getSimpleEndpointUri(),new Processor(){
      public void process(      final Exchange exchange){
        final List<String> params=new ArrayList<>();
        params.add(TEST_MESSAGE);
        Map<String,Object> requestContext=new HashMap<>();
        requestContext.put(Message.ENDPOINT_ADDRESS,getSimpleServerAddress());
        exchange.getIn().setBody(params);
        exchange.getIn().setHeader(Client.REQUEST_CONTEXT,requestContext);
        exchange.getIn().setHeader(CxfConstants.OPERATION_NAME,ECHO_OPERATION);
        exchange.getIn().setHeader(Exchange.FILE_NAME,"testFile");
        exchange.getIn().setHeader("requestObject",new DefaultCxfBinding());
        exchange.getProperties().put(TEST_KEY,TEST_VALUE);
      }
    }
);
    return exchange;
  }
  @Override protected Exchange sendJaxWsMessage(){
    Exchange exchange=template.send(getJaxwsEndpointUri(),new Processor(){
      public void process(      final Exchange exchange){
        final List<String> params=new ArrayList<>();
        params.add(TEST_MESSAGE);
        Map<String,Object> requestContext=new HashMap<>();
        requestContext.put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY,getJaxWsServerAddress());
        exchange.getIn().setBody(params);
        exchange.getIn().setHeader(Client.REQUEST_CONTEXT,requestContext);
        exchange.getIn().setHeader(CxfConstants.OPERATION_NAME,GREET_ME_OPERATION);
        exchange.getIn().setHeader(Exchange.FILE_NAME,"testFile");
      }
    }
);
    return exchange;
  }
}
