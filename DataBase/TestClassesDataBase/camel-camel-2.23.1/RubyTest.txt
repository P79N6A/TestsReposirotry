/** 
 * @version 
 */
public class RubyTest extends CamelTestSupport {
  protected String expected="<hello>world!</hello>";
  protected String scriptName="src/test/java/org/apache/camel/ruby/example.rb";
  @Test public void testSendMatchingMessage() throws Exception {
    if (isPlatform("windows")) {
      return;
    }
    MockEndpoint resultEndpoint=getMockEndpoint("mock:results");
    resultEndpoint.expectedBodiesReceived(expected);
    template.sendBodyAndHeader("direct:a",expected,"foo","bar");
    assertMockEndpointsSatisfied();
  }
  @Test public void testSendNotMatchingMessage() throws Exception {
    if (isPlatform("windows")) {
      return;
    }
    MockEndpoint resultEndpoint=getMockEndpoint("mock:results");
    resultEndpoint.expectedMessageCount(0);
    template.sendBodyAndHeader("direct:a",expected,"foo","123");
    assertMockEndpointsSatisfied();
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    if (isPlatform("windows")) {
      return super.createCamelContext();
    }
    CamelContext answer=super.createCamelContext();
    RubyCamel.setCamelContext(answer);
    RubyCamel.clearRoutes();
    runScript(scriptName);
    List<RouteBuilder> list=RubyCamel.getRoutes();
    log.info("Found route builders: " + list);
    for (    RouteBuilder routeBuilder : list) {
      answer.addRoutes(routeBuilder);
    }
    return answer;
  }
  public static void runScript(  String name){
    String[] args={name};
    Main.main(args);
  }
}
