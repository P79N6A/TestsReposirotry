@RunWith(SpringRunner.class) @EnableAutoConfiguration @SpringBootTest public class RestDslPostTest extends Assert {
  static final int PORT=SocketUtils.findAvailableTcpPort(20000);
  @EndpointInject(uri="mock:user") protected MockEndpoint resultEndpointUser;
  @EndpointInject(uri="mock:country") protected MockEndpoint resultEndpointCountry;
  @Autowired protected ProducerTemplate template;
  @Autowired CamelContext context;
  @Test public void testMultiplePostTypes() throws Exception {
    UserPojo user=new UserPojo();
    user.setId(1);
    user.setName("My Name");
    resultEndpointUser.expectedBodiesReceived(user);
    resultEndpointUser.expectedMessageCount(1);
    CountryPojo country=new CountryPojo();
    country.setCountry("England");
    country.setIso("EN");
    resultEndpointCountry.expectedBodiesReceived(country);
    resultEndpointCountry.expectedMessageCount(1);
    ExchangeBuilder builder=ExchangeBuilder.anExchange(context).withHeader(Exchange.HTTP_METHOD,HttpMethod.POST).withHeader(Exchange.ACCEPT_CONTENT_TYPE,MediaType.APPLICATION_JSON);
    Exchange outExchangeUser=builder.withBody("{\"id\": 1, \"name\": \"My Name\"}").build();
    Exchange outExchangeCountry=builder.withBody("{\"iso\": \"EN\", \"country\": \"England\"}").build();
    template.send("jetty:http://localhost:" + PORT + "/user",outExchangeUser);
    template.send("jetty:http://localhost:" + PORT + "/country",outExchangeCountry);
    resultEndpointCountry.assertIsSatisfied();
    resultEndpointUser.assertIsSatisfied();
  }
@Configuration public static class ContextConfig {
    @Bean public RouteBuilder route(){
      return new RouteBuilder(){
        public void configure(){
          restConfiguration().host("localhost").port(PORT).bindingMode(RestBindingMode.json);
          rest("/").post("/user").type(UserPojo.class).route().to("mock:user").endRest().post("/country").type(CountryPojo.class).route().to("mock:country").endRest();
        }
      }
;
    }
  }
}
