@RunWith(Arquillian.class) public class CustomCamelContextTest {
  @Inject @Uri("direct:inbound") private ProducerTemplate inbound;
  @Inject @Uri("mock:outbound") private MockEndpoint outbound;
  @Deployment public static Archive<?> deployment(){
    return ShrinkWrap.create(JavaArchive.class).addPackage(CdiCamelExtension.class.getPackage()).addClasses(ManualStartupCamelContext.class,UriEndpointRoute.class).addAsManifestResource(EmptyAsset.INSTANCE,"beans.xml");
  }
  @Test @InSequence(1) public void verifyCamelContext(  CamelContext context){
    assertThat(context.getName(),is(equalTo("manual-startup")));
    assertThat(inbound.getCamelContext().getName(),is(equalTo(context.getName())));
    assertThat(outbound.getCamelContext().getName(),is(equalTo(context.getName())));
    assertThat(context.getRouteStatus("uri-route"),is(equalTo(ServiceStatus.Stopped)));
  }
  @Test @InSequence(2) public void sendMessageToInbound(  CamelContext context) throws Exception {
    context.startAllRoutes();
    outbound.expectedMessageCount(1);
    outbound.expectedBodiesReceived("test");
    inbound.sendBody("test");
    assertIsSatisfied(2L,TimeUnit.SECONDS,outbound);
  }
}
