/** 
 * @version 
 */
public class HttpProducerJMXBeansIssueTest extends BaseJettyTest {
  private static final Logger LOG=LoggerFactory.getLogger(HttpProducerJMXBeansIssueTest.class);
  @Override @Before public void setUp() throws Exception {
    enableJMX();
    System.setProperty("org.apache.camel.jmx.createRmiConnector","True");
    super.setUp();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("jetty:http://localhost:{{port}}/leak").transform(constant("Bye World"));
        from("direct:leak").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            LOG.debug("URL is: " + exchange.getIn().getHeader("url"));
          }
        }
).recipientList(header("url"));
      }
    }
;
  }
  @Test public void testNothing(){
  }
  public void testSendAlot() throws Exception {
    Endpoint ep=context.getEndpoint("direct:leak");
    Producer p=ep.createProducer();
    p.start();
    for (int i=0; i < 10000; i++) {
      Exchange ex=ep.createExchange();
      ex.getIn().setHeader("url","http://localhost:{{port}}/leak?id=" + i);
      p.process(ex);
    }
    p.stop();
  }
}
