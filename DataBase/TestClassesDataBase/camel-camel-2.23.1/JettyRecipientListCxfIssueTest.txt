/** 
 */
public class JettyRecipientListCxfIssueTest extends CamelSpringTestSupport {
  private static int port1=AvailablePortFinder.getNextAvailable(20032);
  private static int port2=AvailablePortFinder.getNextAvailable(20043);
  private static int port3=AvailablePortFinder.getNextAvailable(20044);
static {
    System.setProperty("RecipientListCxfTest.port1",Integer.toString(port1));
    System.setProperty("RecipientListCxfTest.port2",Integer.toString(port2));
    System.setProperty("RecipientListCxfTest.port3",Integer.toString(port3));
  }
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/itest/greeter/JettyRecipientListCxfIssueTest.xml");
  }
  @Test public void testJettyRecipientListCxf() throws Exception {
    final String request=context().getTypeConverter().convertTo(String.class,new File("src/test/resources/greetMe.xml"));
    assertNotNull(request);
    Exchange out=template.request("jetty:http://0.0.0.0:{{RecipientListCxfTest.port3}}/myapp",new Processor(){
      @Override public void process(      Exchange exchange) throws Exception {
        exchange.getIn().setHeader("operationName","greetMe");
        exchange.getIn().setBody(request);
      }
    }
);
    assertNotNull(out);
    assertTrue("Should have out",out.hasOut());
    String body=out.getOut().getBody(String.class);
    log.info("Reply from jetty call:\n{}",body);
    assertNotNull(body);
    assertTrue("Should have Bye Camel",body.contains("Bye Camel"));
  }
}
