@RunWith(CamelCdiRunner.class) public class AdviceTest {
  @ClassRule public static MessageVerifier verifier=new MessageVerifier();
  void advice(  @Observes CamelContextStartingEvent event,  @Uri("mock:messages") MockEndpoint messages,  ModelCamelContext context) throws Exception {
    messages.expectedMessageCount(2);
    messages.expectedBodiesReceived("Hello","Bye");
    verifier.messages=messages;
    context.getRouteDefinition("route").adviceWith(context,new AdviceWithRouteBuilder(){
      @Override public void configure(){
        weaveAddLast().to("mock:messages");
      }
    }
);
  }
  @Test public void test(){
  }
private static class MessageVerifier extends Verifier {
    MockEndpoint messages;
    @Override protected void verify() throws InterruptedException {
      assertIsSatisfied(2L,TimeUnit.SECONDS,messages);
    }
  }
}
