/** 
 * Simple processor the copies the in to the out and increments a counter. Used to verify that the pipeline actually takes the output of one stage of  the pipe and feeds it in as input into the next stage.
 */
private static final class InToOut implements Processor {
  public void process(  Exchange exchange) throws Exception {
    exchange.getOut().copyFrom(exchange.getIn());
    Integer counter=exchange.getIn().getHeader("copy-counter",Integer.class);
    if (counter == null) {
      counter=0;
    }
    exchange.getOut().setHeader("copy-counter",counter + 1);
  }
}
