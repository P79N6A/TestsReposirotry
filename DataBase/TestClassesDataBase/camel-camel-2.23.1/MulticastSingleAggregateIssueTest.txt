/** 
 * @version 
 */
public class MulticastSingleAggregateIssueTest extends ContextTestSupport {
  @Test public void testMulticastSingleAggregateIssue() throws Exception {
    getMockEndpoint("mock:a").expectedBodiesReceived(2);
    getMockEndpoint("mock:a").expectedHeaderReceived("foo","I was here");
    template.sendBody("direct:a",1);
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:a").multicast(new SumAggregateBean()).to("direct:foo").end().to("mock:a");
        from("direct:foo").bean(IncreaseOne.class);
      }
    }
;
  }
public static class IncreaseOne {
    public int addOne(    int num){
      return num + 1;
    }
  }
public static class SumAggregateBean implements AggregationStrategy {
    public Exchange aggregate(    Exchange oldExchange,    Exchange newExchange){
      newExchange.getIn().setHeader("foo","I was here");
      if (oldExchange == null) {
        return newExchange;
      }
      int num1=oldExchange.getIn().getBody(int.class);
      int num2=newExchange.getIn().getBody(int.class);
      newExchange.getIn().setHeader("foo","I was here");
      newExchange.getIn().setBody(num1 + num2);
      return newExchange;
    }
  }
}
