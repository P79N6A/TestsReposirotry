/** 
 * @version 
 */
public class MinaUdpTest extends BaseMinaTest {
  protected int messageCount=3;
  @Test public void testMinaRoute() throws Exception {
    MockEndpoint endpoint=getMockEndpoint("mock:result");
    endpoint.expectedBodiesReceived("Hello Message: 0","Hello Message: 1","Hello Message: 2");
    sendUdpMessages();
    assertMockEndpointsSatisfied();
  }
  protected void sendUdpMessages() throws Exception {
    DatagramSocket socket=new DatagramSocket();
    try {
      InetAddress address=InetAddress.getByName("127.0.0.1");
      for (int i=0; i < messageCount; i++) {
        String text="Hello Message: " + i;
        byte[] data=text.getBytes();
        DatagramPacket packet=new DatagramPacket(data,data.length,address,getPort());
        socket.send(packet);
        Thread.sleep(100);
      }
    }
  finally {
      socket.close();
    }
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        int port2=getNextPort();
        from("mina:udp://127.0.0.1:{{port}}?sync=false").to("mina:udp://127.0.0.1:" + port2 + "?sync=false");
        from("mina:udp://127.0.0.1:" + port2 + "?sync=false").to("mock:result");
      }
    }
;
  }
}
