public class SpringJmsClientRemotingServerTest extends TestSupport {
  private static ClassPathXmlApplicationContext appCtx;
  @BeforeClass public static void setupFreePort() throws Exception {
    int port=AvailablePortFinder.getNextAvailable();
    String bank1="tcp.port=" + port;
    File custom=new File("target/custom.properties");
    FileOutputStream fos=new FileOutputStream(custom);
    fos.write(bank1.getBytes());
    fos.close();
    appCtx=new ClassPathXmlApplicationContext("/META-INF/spring/camel-server.xml","camel-client-remoting.xml");
    appCtx.start();
  }
  @AfterClass public static void stopSpring(){
    appCtx.stop();
  }
  @Test public void testCamelRemotingInvocation(){
    Multiplier multiplier=appCtx.getBean("multiplierProxy",Multiplier.class);
    int response=multiplier.multiply(33);
    assertEquals("Get a wrong response",99,response);
  }
}
