public class DeadLetterChannelNotHandleNewExceptionTest extends ContextTestSupport {
public static class BadErrorHandler {
    @Handler public void onException(    Exchange exchange,    Exception exception) throws Exception {
      throw new RuntimeException("error in errorhandler");
    }
  }
  @Test public void testDeadLetterChannelNotHandleNewException() throws Exception {
    try {
      template.sendBody("direct:start","Hello World");
      fail("Should have thrown exception");
    }
 catch (    CamelExecutionException e) {
      RuntimeException cause=assertIsInstanceOf(RuntimeException.class,e.getCause());
      assertEquals("error in errorhandler",cause.getMessage());
    }
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        errorHandler(deadLetterChannel("bean:" + BadErrorHandler.class.getName()).deadLetterHandleNewException(false));
        from("direct:start").log("Incoming ${body}").throwException(new IllegalArgumentException("Forced"));
      }
    }
;
  }
}
