public static class CreditService {
  private int totalCredit;
  private Map<String,Integer> reservations=new HashMap<>();
  public CreditService(  int totalCredit){
    this.totalCredit=totalCredit;
  }
  public synchronized void reserveCredit(  String id,  @Header("amount") int amount){
    int credit=getCredit();
    if (amount > credit) {
      throw new IllegalStateException("Insufficient credit");
    }
    reservations.put(id,amount);
  }
  public synchronized void refundCredit(  String id){
    reservations.remove(id);
  }
  public synchronized int getCredit(){
    return totalCredit - reservations.values().stream().reduce(0,(a,b) -> a + b);
  }
}
