public class SpringJacksonObjectMapperRegistryTest extends CamelSpringTestSupport {
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/component/jackson/SpringJacksonObjectMapperRegistryTest.xml");
  }
  @Test public void testMarshalAndUnmarshalMap() throws Exception {
    Map<String,Object> in=new HashMap<>();
    in.put("name","Camel");
    MockEndpoint mock=getMockEndpoint("mock:reverse");
    mock.expectedMessageCount(1);
    mock.message(0).body().isInstanceOf(Map.class);
    mock.message(0).body().isEqualTo(in);
    Object marshalled=template.requestBody("direct:in",in);
    String marshalledAsString=context.getTypeConverter().convertTo(String.class,marshalled);
    assertEquals("{\"name\":\"Camel\"}",marshalledAsString);
    template.sendBody("direct:back",marshalled);
    mock.assertIsSatisfied();
    MyJsonObjectMapper mapper=(MyJsonObjectMapper)context.getRegistry().lookupByName("myJsonObjectMapper");
    assertNotNull(mapper);
    JacksonDataFormat df=(JacksonDataFormat)context.getDataFormats().get("jack").getDataFormat();
    assertNotNull(df);
    assertSame(mapper,df.getObjectMapper());
  }
}
