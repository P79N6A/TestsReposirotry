/** 
 * @version 
 */
public class DefaultCamelContextStopFailureTest extends ContextTestSupport {
  private static String stopOrder;
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    context.addService(new MyService("A",false));
    context.addService(new MyService("B",true));
    context.addService(new MyService("C",false));
    return context;
  }
  @Test public void testStopWithFailure() throws Exception {
    stopOrder="";
    context.stop();
    assertEquals("CBA",stopOrder);
  }
private static final class MyService implements Service {
    private String name;
    private boolean fail;
    private MyService(    String name,    boolean fail){
      this.name=name;
      this.fail=fail;
    }
    public void start() throws Exception {
    }
    public void stop() throws Exception {
      stopOrder=stopOrder + name;
      if (fail) {
        throw new IllegalArgumentException("Fail " + name);
      }
    }
  }
}
