/** 
 * Consumer test for statistics on Docker Platform
 */
@RunWith(MockitoJUnitRunner.class) public class DockerStatsConsumerTest extends CamelTestSupport {
  private String host="localhost";
  private Integer port=2375;
  private String containerId="470b9b823e6c";
  private DockerConfiguration dockerConfiguration;
  @Mock private StatsCmd statsCmd;
  @Mock private DockerClient dockerClient;
  public void setupMocks(){
    Mockito.when(dockerClient.statsCmd(anyString())).thenReturn(statsCmd);
  }
  @Test public void testStats() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMinimumMessageCount(1);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        from("docker://stats?host=" + host + "&port="+ port+ "&containerId="+ containerId).log("${body}").to("mock:result");
      }
    }
;
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext camelContext=super.createCamelContext();
    dockerConfiguration=new DockerConfiguration();
    dockerConfiguration.setParameters(DockerTestUtils.getDefaultParameters(host,port,dockerConfiguration));
    DockerComponent dockerComponent=new DockerComponent(dockerConfiguration);
    dockerComponent.setClient(DockerTestUtils.getClientProfile(host,port,dockerConfiguration),dockerClient);
    camelContext.addComponent("docker",dockerComponent);
    setupMocks();
    return camelContext;
  }
}
