/** 
 * Unit test for http client options.
 */
public class JettyHttpClientOptionsTest extends BaseJettyTest {
  @Test public void testCustomHttpBinding() throws Exception {
    HttpCommonEndpoint jettyEndpoint=context.getEndpoint("http://localhost:{{port}}/myapp/myservice?httpClient.soTimeout=5555",HttpCommonEndpoint.class);
    assertNotNull("Jetty endpoint should not be null ",jettyEndpoint);
    HttpProducer producer=(HttpProducer)jettyEndpoint.createProducer();
    assertEquals("Get the wrong http client parameter",5555,producer.getHttpClient().getParams().getSoTimeout());
    Object out=template.requestBody("http://localhost:{{port}}/myapp/myservice","Hello World");
    assertEquals("Bye World",context.getTypeConverter().convertTo(String.class,out));
  }
  @Test public void testProxySettingOfJettyHttpClient() throws Exception {
    HttpCommonEndpoint jettyEndpoint=context.getEndpoint("jetty://http://localhost:{{port}}/proxy/setting?proxyHost=192.168.0.1&proxyPort=9090",HttpCommonEndpoint.class);
    assertNotNull("Jetty endpoint should not be null ",jettyEndpoint);
    JettyHttpProducer producer=(JettyHttpProducer)jettyEndpoint.createProducer();
    assertProxyAddress(producer.getClient(),"192.168.0.1",9090);
    context.getProperties().put("http.proxyHost","192.168.0.2");
    context.getProperties().put("http.proxyPort","8080");
    jettyEndpoint=context.getEndpoint("jetty://http://localhost:{{port}}/proxy2/setting",HttpCommonEndpoint.class);
    producer=(JettyHttpProducer)jettyEndpoint.createProducer();
    assertProxyAddress(producer.getClient(),"192.168.0.2",8080);
    context.getProperties().clear();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("jetty:http://localhost:{{port}}/myapp/myservice?httpClient.soTimeout=5555").transform().constant("Bye World");
      }
    }
;
  }
  private void assertProxyAddress(  HttpClient client,  String expectedHost,  int expectedPort){
    CamelHttpClient camelHttpClient=(CamelHttpClient)client;
    assertEquals("Got the wrong http proxy host parameter",expectedHost,camelHttpClient.getProxyHost());
    assertEquals("Got the wrong http proxy port paramerter",expectedPort,camelHttpClient.getProxyPort());
  }
}
