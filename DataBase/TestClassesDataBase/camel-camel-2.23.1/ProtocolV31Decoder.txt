@Sharable public static class ProtocolV31Decoder extends MessageToMessageDecoder<DatagramPacket> {
  @Override protected void decode(  ChannelHandlerContext ctx,  DatagramPacket packet,  List<Object> out) throws OncRpcException, IOException {
    byte[] bytes=new byte[packet.content().readableBytes()];
    packet.content().readBytes(bytes);
    XdrBufferDecodingStream xbds=new XdrBufferDecodingStream(bytes);
    xbds.beginDecoding();
    int id=xbds.xdrDecodeInt() & 0xbf;
    xbds.endDecoding();
    XdrAble outMsg=null;
    if (id == gmetadata_full) {
      outMsg=new Ganglia_metadata_msg();
    }
 else     if (id == gmetric_string) {
      outMsg=new Ganglia_value_msg();
    }
 else {
      fail("During those tests, the gmond mock should only receive metadata or string messages");
    }
    xbds=new XdrBufferDecodingStream(bytes);
    xbds.beginDecoding();
    outMsg.xdrDecode(xbds);
    xbds.endDecoding();
    out.add(outMsg);
  }
}
