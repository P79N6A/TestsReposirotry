public class JmsProxyMEPTest extends CamelTestSupport {
  protected String componentName="activemq";
  private Calculator calculatorProxy;
  protected CamelContext createCamelContext() throws Exception {
    CamelContext camelContext=super.createCamelContext();
    ConnectionFactory connectionFactory=CamelJmsTestHelper.createConnectionFactory();
    camelContext.addComponent(componentName,jmsComponentAutoAcknowledge(connectionFactory));
    calculatorProxy=new ProxyBuilder(camelContext).binding(false).endpoint("direct:calculatorProxy").build(Calculator.class);
    return camelContext;
  }
  @Test public void testSynchronous() throws Exception {
    int result=calculatorProxy.add(30,13);
    assertEquals(43,result);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:calculatorProxy").to("log:calc").to("activemq:calculator-queue?exchangePattern=InOut");
        from("activemq:calculator-queue?exchangePattern=InOut").bean(CalculatorImpl.class);
      }
    }
;
  }
}
