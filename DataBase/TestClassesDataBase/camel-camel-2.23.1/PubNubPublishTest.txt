public class PubNubPublishTest extends PubNubTestBase {
  private String endpoint="pubnub:someChannel?pubnub=#pubnub";
  @EndpointInject(uri="mock:result") private MockEndpoint mockResult;
  @Test public void testPubNub() throws Exception {
    stubFor(post(urlPathEqualTo("/publish/myPublishKey/mySubscribeKey/0/someChannel/0")).willReturn(aResponse().withStatus(200).withBody("[1,\"Sent\",\"14598111595318003\"]")));
    mockResult.expectedMessageCount(1);
    mockResult.expectedHeaderReceived(TIMETOKEN,"14598111595318003");
    template.sendBody("direct:publish",new Hello("Hi"));
    assertMockEndpointsSatisfied();
  }
  @Test(expected=CamelExecutionException.class) public void testPublishEmptyBody() throws Exception {
    template.sendBody("direct:publish",null);
  }
  @Test public void testFireWithOperationHeader() throws Exception {
    stubFor(get(urlPathEqualTo("/publish/myPublishKey/mySubscribeKey/0/someChannel/0/%22Hi%22")).willReturn(aResponse().withBody("[1,\"Sent\",\"14598111595318003\"]")));
    mockResult.expectedMessageCount(1);
    mockResult.expectedHeaderReceived(TIMETOKEN,"14598111595318003");
    template.sendBodyAndHeader("direct:publish","Hi",PubNubConstants.OPERATION,"FIRE");
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        from("direct:publish").to(endpoint).to("mock:result");
      }
    }
;
  }
static class Hello {
    private String message;
    Hello(    String message){
      this.message=message;
    }
    public String getMessage(){
      return message;
    }
  }
}
