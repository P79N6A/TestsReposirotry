/** 
 * Unit test that ftp consumer will not match directories (CAMEL-920)
 */
public class FtpConsumerDirectoriesNotMatchedTest extends FtpServerTestSupport {
  private String getFtpUrl(){
    return "ftp://admin@localhost:" + getPort() + "/dirnotmatched/?password=admin"+ "&recursive=true&include=^.*txt$";
  }
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    prepareFtpServer();
  }
  @Test public void testSkipDirectories() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(3);
    mock.assertIsSatisfied();
  }
  private void prepareFtpServer() throws Exception {
    sendFile(getFtpUrl() + "/?password=admin","This is a dot file",".skipme");
    sendFile(getFtpUrl() + "/?password=admin","This is a web file","index.html");
    sendFile(getFtpUrl() + "/?password=admin","This is a readme file","readme.txt");
    sendFile(getFtpUrl() + "/2007/?password=admin","2007 report","report2007.txt");
    sendFile(getFtpUrl() + "/2008/?password=admin","2008 report","report2008.txt");
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from(getFtpUrl()).to("mock:result");
      }
    }
;
  }
}
