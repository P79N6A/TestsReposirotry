public class CxfRsEndpointTest extends CamelTestSupport {
  private static final String CTX=CXFTestSupport.getPort1() + "/CxfRsEndpointTest";
  @Test public void testCreateCxfRsEndpoint() throws Exception {
    String endpointUri="cxfrs://http://localhost:" + CTX + ""+ "?loggingFeatureEnabled=true&loggingSizeLimit=200"+ "&resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerService,"+ "java.lang.String,org.apache.camel.component.cxf.jaxrs.testbean.Order";
    CxfRsComponent component=new CxfRsComponent(context);
    CxfRsEndpoint endpoint=(CxfRsEndpoint)component.createEndpoint(endpointUri);
    assertNotNull("The endpoint should not be null ",endpoint);
    assertEquals("Get a wrong address ",endpointUri,endpoint.getEndpointUri());
    assertEquals("Get a wrong size of resouces classes",3,endpoint.getResourceClasses().size());
    assertEquals("Get a wrong resources class",CustomerService.class,endpoint.getResourceClasses().get(0));
    assertEquals("Get a wrong loggingFeatureEnabled setting",true,endpoint.isLoggingFeatureEnabled());
    assertEquals("Get a wrong loggingSizeLimit setting",200,endpoint.getLoggingSizeLimit());
  }
  @Test public void testCxfRsEndpointParameters() throws Exception {
    CxfRsComponent component=new CxfRsComponent(context);
    String endpointUri="cxfrs://http://localhost:" + CTX + "/templatetest/TID/ranges/start=0;end=1?"+ "continuationTimeout=80000&httpClientAPI=true&loggingFeatureEnabled=true&loggingSizeLimit=200&q1=11&q2=12";
    CxfRsEndpoint endpoint=(CxfRsEndpoint)component.createEndpoint(endpointUri);
    assertEquals("Get a wrong URI ",endpointUri,endpoint.getEndpointUri());
    assertEquals("Get a wrong usingClientAPI option",true,endpoint.isHttpClientAPI());
    assertNotNull("The Parameter should not be null" + endpoint.getParameters());
    assertEquals("Get a wrong parameter map","{q1=11, q2=12}",endpoint.getParameters().toString());
    assertEquals("Get a wrong continucationTimeout",80000,endpoint.getContinuationTimeout());
  }
  @Test public void testCxfRsEndpointResourceClass() throws Exception {
    String endpointUri="cxfrs://http://localhost:" + CTX + ""+ "?resourceClass=org.apache.camel.component.cxf.jaxrs.testbean.CustomerService";
    CxfRsComponent component=new CxfRsComponent(context);
    CxfRsEndpoint endpoint=(CxfRsEndpoint)component.createEndpoint(endpointUri);
    assertNotNull("The endpoint should not be null ",endpoint);
    assertEquals("Get a wrong address ",endpointUri,endpoint.getEndpointUri());
    assertEquals("Get a wrong size of resouces classes",1,endpoint.getResourceClasses().size());
    assertEquals("Get a wrong resources class",CustomerService.class,endpoint.getResourceClasses().get(0));
    assertEquals("Get a wrong continucationTimeout",30000,endpoint.getContinuationTimeout());
  }
  @Test public void testCxfRsEndpointSetProvider() throws Exception {
    String endpointUri="cxfrs://http://localhost:" + CTX + ""+ "?resourceClass=org.apache.camel.component.cxf.jaxrs.testbean.CustomerService";
    CxfRsComponent component=new CxfRsComponent(context);
    CxfRsEndpoint endpoint=(CxfRsEndpoint)component.createEndpoint(endpointUri);
    JSONProvider<?> jsonProvider=new JSONProvider<>();
    jsonProvider.setDropRootElement(true);
    jsonProvider.setSupportUnwrapped(true);
    endpoint.setProvider(jsonProvider);
    JAXRSServerFactoryBean sfb=endpoint.createJAXRSServerFactoryBean();
    assertEquals("Get a wrong proider size",1,sfb.getProviders().size());
    JAXRSClientFactoryBean cfb=endpoint.createJAXRSClientFactoryBean();
    assertEquals("Get a wrong proider size",1,cfb.getProviders().size());
  }
  @Test public void testCxfRsEndpointCamelContextAware() throws Exception {
    String endpointUri="cxfrs://simple";
    CxfRsEndpoint endpoint=new CxfRsEndpoint();
    endpoint.setAddress("http://localhost:9000/test");
    endpoint.setResourceClasses(CustomerService.class);
    CamelContext context=new DefaultCamelContext();
    context.addEndpoint(endpointUri,endpoint);
    assertEquals("Get a wrong camel context.",context,endpoint.getCamelContext());
  }
}
