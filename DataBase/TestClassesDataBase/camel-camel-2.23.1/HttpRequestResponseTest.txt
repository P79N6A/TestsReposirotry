/** 
 * Unit test for request response in message
 */
public class HttpRequestResponseTest extends BaseJettyTest {
  @Test public void testHttpServletRequestResponse() throws Exception {
    Object response=template.requestBody("http://localhost:{{port}}/myapp/myservice","bookid=123");
    String body=context.getTypeConverter().convertTo(String.class,response);
    assertEquals("Written by servlet response<html><body>Book 123 is Camel in Action</body></html>",body);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("jetty:http://localhost:{{port}}/myapp/myservice").process(new MyBookService());
      }
    }
;
  }
public class MyBookService implements Processor {
    public void process(    Exchange exchange) throws Exception {
      String body=exchange.getIn().getBody(String.class);
      HttpServletRequest req=exchange.getIn().getBody(HttpServletRequest.class);
      assertNotNull(req);
      HttpServletResponse res=exchange.getIn().getBody(HttpServletResponse.class);
      assertNotNull(res);
      HttpMessage msg=(HttpMessage)exchange.getIn();
      assertNotNull(msg.getRequest());
      assertNotNull(msg.getResponse());
      res.getOutputStream().print("Written by servlet response");
      assertEquals("bookid=123",body);
      exchange.getOut().setBody("<html><body>Book 123 is Camel in Action</body></html>");
    }
  }
}
