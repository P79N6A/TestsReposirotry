/** 
 * Unit test based on the first sample test from the JOLT project.
 */
public class JoltFirstSampleTest extends CamelTestSupport {
  @Test public void testFirstSampleJolt() throws Exception {
    getMockEndpoint("mock:result").expectedMinimumMessageCount(1);
    getMockEndpoint("mock:result").expectedBodiesReceived(IOHelper.loadText(ResourceHelper.resolveMandatoryResourceAsInputStream(context,"org/apache/camel/component/jolt/firstSample/output.json")).trim());
    sendBody("direct://start",ResourceHelper.resolveMandatoryResourceAsInputStream(context,"org/apache/camel/component/jolt/firstSample/input.json"));
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    final Processor processor=new Processor(){
      public void process(      Exchange exchange){
        Map<String,String> contextMap=new HashMap<>();
        contextMap.put("contextB","bb");
        exchange.getIn().setHeader(JoltConstants.JOLT_CONTEXT,contextMap);
      }
    }
;
    return new RouteBuilder(){
      public void configure(){
        from("direct://start").process(processor).to("jolt:org/apache/camel/component/jolt/firstSample/spec.json?inputType=JsonString&outputType=JsonString").to("mock:result");
      }
    }
;
  }
}
