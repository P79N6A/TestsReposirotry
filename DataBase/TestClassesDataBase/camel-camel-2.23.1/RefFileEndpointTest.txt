/** 
 * @version 
 */
public class RefFileEndpointTest extends ContextTestSupport {
  private SimpleRegistry registry=new SimpleRegistry();
  @Override @Before public void setUp() throws Exception {
    deleteDirectory("target/foo");
    super.setUp();
  }
  @Test public void testRefFileEndpoint() throws Exception {
    getMockEndpoint("mock:result").expectedMessageCount(1);
    template.sendBodyAndHeader("file:target/foo","Hello World",Exchange.FILE_NAME,"hello.txt");
    assertMockEndpointsSatisfied();
    FileConsumer consumer=(FileConsumer)context.getRoute("foo").getConsumer();
    assertEquals(3000,consumer.getDelay());
    assertEquals(250,consumer.getInitialDelay());
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=new DefaultCamelContext(registry);
    registry.put("foo",context.getEndpoint("file:target/foo?initialDelay=250&delay=3000&delete=true"));
    return context;
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("ref:foo").routeId("foo").to("mock:result");
      }
    }
;
  }
}
