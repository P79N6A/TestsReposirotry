/** 
 * Same route but not transacted
 */
public class TransactionalClientDataSourceMixedTransactedTest extends TransactionalClientDataSourceTest {
  @Test public void testTransactionRollback() throws Exception {
    template.sendBody("direct:fail","Hello World");
    int count=jdbc.queryForObject("select count(*) from books",Integer.class);
    assertEquals("Number of books",2,count);
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new SpringRouteBuilder(){
      public void configure() throws Exception {
        onException(IllegalArgumentException.class).onWhen(exceptionMessage().contains("Donkey")).handled(true);
        from("direct:okay").transacted().setBody(constant("Tiger in Action")).bean("bookService").setBody(constant("Elephant in Action")).bean("bookService").setBody(constant("Donkey in Action")).bean("bookService");
        from("direct:fail").setBody(constant("Tiger in Action")).bean("bookService").setBody(constant("Donkey in Action")).bean("bookService");
      }
    }
;
  }
}
