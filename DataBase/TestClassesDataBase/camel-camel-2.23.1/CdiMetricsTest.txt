@RunWith(CamelCdiRunner.class) public class CdiMetricsTest {
  @Inject private Meter generated;
  @Inject private Meter attempt;
  @Inject private Meter success;
  @Inject private Meter redelivery;
  @Inject private Meter error;
  @Inject @Metric(name="success-ratio") private Gauge<Double> ratio;
  @Test @Order(1) public void stopCamelContext(  CamelContext context) throws Exception {
    Thread.sleep(5000);
    context.stop();
  }
  @Test @Order(2) public void testMetricsValues(){
    assertThat("Meter counts are not consistent!",attempt.getCount() - redelivery.getCount() - success.getCount()- error.getCount(),is(equalTo(0L)));
    assertThat("Success rate gauge value is incorrect!",ratio.getValue(),is(equalTo(success.getOneMinuteRate() / generated.getOneMinuteRate())));
  }
}
