public class AdviceWithTransactionIssueTest extends SpringTestSupport {
  @Override public boolean isUseRouteBuilder(){
    return false;
  }
  @Override protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/spring/issues/AdviceWithTransactionIssueTest.xml");
  }
  @Test public void testAdviceWithWeaveById() throws Exception {
    context.getRouteDefinitions().get(0).adviceWith(context,new AdviceWithRouteBuilder(){
      @Override public void configure() throws Exception {
        weaveById("mock-b*").after().to("mock:last");
      }
    }
);
    context.start();
    MockEndpoint mockLast=getMockEndpoint("mock:last");
    mockLast.expectedBodiesReceived("bar");
    mockLast.setExpectedMessageCount(1);
    template.sendBody("seda:start","bar");
    assertMockEndpointsSatisfied();
  }
  @Test public void testAdviceWithAddLast() throws Exception {
    context.getRouteDefinitions().get(0).adviceWith(context,new AdviceWithRouteBuilder(){
      @Override public void configure() throws Exception {
        weaveAddLast().to("mock:last");
      }
    }
);
    context.start();
    MockEndpoint mockLast=getMockEndpoint("mock:last");
    mockLast.expectedBodiesReceived("bar");
    mockLast.setExpectedMessageCount(1);
    template.sendBody("seda:start","bar");
    assertMockEndpointsSatisfied();
  }
}
