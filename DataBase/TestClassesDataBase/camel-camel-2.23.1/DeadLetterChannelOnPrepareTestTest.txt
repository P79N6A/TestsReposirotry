public class DeadLetterChannelOnPrepareTestTest extends CamelBlueprintTestSupport {
  @Override protected String getBlueprintDescriptor(){
    return "org/apache/camel/test/blueprint/DeadLetterChannelOnPrepareTestTest.xml";
  }
  @Test public void testDeadLetterChannelOnPrepare() throws Exception {
    getMockEndpoint("mock:dead").expectedBodiesReceived("Hello World");
    getMockEndpoint("mock:dead").expectedHeaderReceived("FailedBecause","Forced");
    template.sendBody("direct:start","Hello World");
    assertMockEndpointsSatisfied();
  }
public static class MyPrepareProcessor implements Processor {
    @Override public void process(    Exchange exchange) throws Exception {
      Exception cause=exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Exception.class);
      exchange.getIn().setHeader("FailedBecause",cause.getMessage());
    }
  }
}
