/** 
 * @version 
 */
public class RmiIllegalArgumentExceptionTest extends RmiRouteTestSupport {
  private boolean created;
  protected int getStartPort(){
    return 37502;
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    if (classPathHasSpaces()) {
      return null;
    }
    if (!created) {
      LocateRegistry.createRegistry(getPort());
      created=true;
    }
    JndiRegistry context=super.createRegistry();
    context.bind("echo",new EchoService());
    return context;
  }
  @Test public void tesIllegal() throws Exception {
    if (classPathHasSpaces()) {
      return;
    }
    getMockEndpoint("mock:result").expectedMessageCount(0);
    try {
      template.sendBody("direct:echo","Hello World");
      fail("Should have thrown an exception");
    }
 catch (    CamelExecutionException e) {
      assertIsInstanceOf(RemoteException.class,e.getCause());
      IllegalArgumentException iae=assertIsInstanceOf(IllegalArgumentException.class,e.getCause().getCause().getCause().getCause());
      assertEquals("Illegal",iae.getMessage());
    }
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        RmiEndpoint echo=(RmiEndpoint)endpoint("rmi://localhost:" + getPort() + "/echo");
        echo.setRemoteInterfaces(IEcho.class);
        from(echo).to("bean:echo");
        from("direct:echo").to("rmi://localhost:" + getPort() + "/echo?method=foo").to("mock:result");
      }
    }
;
  }
}
