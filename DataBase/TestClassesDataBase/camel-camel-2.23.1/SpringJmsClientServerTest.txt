public class SpringJmsClientServerTest extends CamelSpringTestSupport {
  @BeforeClass public static void setupFreePort() throws Exception {
    int port=AvailablePortFinder.getNextAvailable();
    String bank1="tcp.port=" + port;
    File custom=new File("target/custom.properties");
    FileOutputStream fos=new FileOutputStream(custom);
    fos.write(bank1.getBytes());
    fos.close();
  }
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("/META-INF/spring/camel-server.xml");
  }
  @Test public void testCamelClientInvocation(){
    int response=template.requestBody("jms:queue:numbers",22,Integer.class);
    assertEquals("Get a wrong response",66,response);
  }
  @Test public void testCamelEndpointInvocation() throws Exception {
    Endpoint endpoint=context.getEndpoint("jms:queue:numbers");
    Exchange exchange=endpoint.createExchange(ExchangePattern.InOut);
    exchange.getIn().setBody(11);
    Producer producer=endpoint.createProducer();
    producer.start();
    producer.process(exchange);
    int response=exchange.getOut().getBody(Integer.class);
    assertEquals("Get a wrong response.",33,response);
    producer.stop();
  }
}
