public class StAXComponentRefTest extends CamelTestSupport {
  @EndpointInject(uri="mock:records") private MockEndpoint recordsEndpoint;
  @BeforeClass public static void initRouteExample(){
    RecordsUtil.createXMLFile();
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("myHandler",new CountingHandler());
    return jndi;
  }
  @Override public RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("file:target/in").routeId("stax-parser").to("stax:#myHandler").process(new Processor(){
          @Override public void process(          Exchange exchange) throws Exception {
            assertEquals(11,exchange.getIn().getBody(CountingHandler.class).getNumber());
          }
        }
).to("mock:records");
      }
    }
;
  }
  @Test public void testStax() throws Exception {
    recordsEndpoint.expectedMessageCount(1);
    recordsEndpoint.message(0).body().isInstanceOf(CountingHandler.class);
    recordsEndpoint.assertIsSatisfied();
  }
}
