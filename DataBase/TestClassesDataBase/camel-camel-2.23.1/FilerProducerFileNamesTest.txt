/** 
 * Unit test for the how FileProducer behaves a bit strangely when generating filenames
 */
public class FilerProducerFileNamesTest extends ContextTestSupport {
  @Override @Before public void setUp() throws Exception {
    deleteDirectory("target/reports");
    super.setUp();
  }
  @Test public void testProducerWithMessageIdAsFileName() throws Exception {
    Endpoint endpoint=context.getEndpoint("direct:report");
    Exchange exchange=endpoint.createExchange();
    exchange.getIn().setBody("This is a good report");
    FileEndpoint fileEndpoint=resolveMandatoryEndpoint("file:target/reports/report.txt",FileEndpoint.class);
    String id=fileEndpoint.getGeneratedFileName(exchange.getIn());
    template.send("direct:report",exchange);
    File file=new File("target/reports/" + id);
    assertEquals("File should exists",true,file.exists());
  }
  @Test public void testProducerWithHeaderFileName() throws Exception {
    template.sendBody("direct:report2","This is super good report");
    File file=new File("target/report-super.txt");
    assertEquals("File should exists",true,file.exists());
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("direct:report").to("file:target/reports/");
        from("direct:report2").setHeader(Exchange.FILE_NAME,constant("report-super.txt")).to("file:target/");
      }
    }
;
  }
}
