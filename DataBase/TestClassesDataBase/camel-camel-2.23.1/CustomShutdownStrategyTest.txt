@DirtiesContext @RunWith(SpringRunner.class) @EnableAutoConfiguration @SpringBootTest public class CustomShutdownStrategyTest extends Assert {
  @Autowired CamelContext camelContext;
@Configuration @EnableAutoConfiguration public static class Config extends SpringRouteBuilder {
    @Override public void configure() throws Exception {
      from("seda:foo").to("mock:foo");
    }
    @Bean public ShutdownStrategy shutdownStrategy(){
      ShutdownStrategy strat=new MyShutdown();
      strat.setTimeout(60000);
      return strat;
    }
  }
  @Test public void testCustomShutdown() throws Exception {
    ShutdownStrategy stat=camelContext.getShutdownStrategy();
    assertEquals(60000,stat.getTimeout());
    assertTrue(stat instanceof MyShutdown);
    camelContext.stop();
    assertTrue(((MyShutdown)stat).isInvoked());
  }
private static class MyShutdown extends DefaultShutdownStrategy {
    private boolean invoked;
    @Override protected boolean doShutdown(    CamelContext context,    List<RouteStartupOrder> routes,    long timeout,    TimeUnit timeUnit,    boolean suspendOnly,    boolean abortAfterTimeout,    boolean forceShutdown) throws Exception {
      invoked=true;
      return super.doShutdown(context,routes,timeout,timeUnit,suspendOnly,abortAfterTimeout,forceShutdown);
    }
    boolean isInvoked(){
      return invoked;
    }
  }
}
