/** 
 * @version 
 */
public class ManagedSanitizeTest extends ManagementTestSupport {
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    context.getManagementStrategy().getManagementAgent().setMask(true);
    return context;
  }
  @Test public void testSanitize() throws Exception {
    MBeanServer mbeanServer=getMBeanServer();
    ObjectName name=ObjectName.getInstance("org.apache.camel:context=camel-1,type=endpoints,name=\"stub://foo\\?password=xxxxxx&username=foo\"");
    assertTrue("Should be registered",mbeanServer.isRegistered(name));
    String uri=(String)mbeanServer.getAttribute(name,"EndpointUri");
    assertEquals("stub://foo?password=xxxxxx&username=foo",uri);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").routeId("foo").to("stub:foo?username=foo&password=secret").to("mock:result");
        from("stub:foo?username=foo&password=secret").routeId("stub").to("mock:stub");
      }
    }
;
  }
}
