/** 
 * @version 
 */
public class RoutingUsingCamelContextFactoryTest extends TestSupport {
  protected String body="<hello>world!</hello>";
  protected AbstractXmlApplicationContext applicationContext;
  @Test public void testXMLRouteLoading() throws Exception {
    applicationContext=createApplicationContext();
    SpringCamelContext context=applicationContext.getBean("camel-A",SpringCamelContext.class);
    assertValidContext(context);
    MockEndpoint resultEndpoint=(MockEndpoint)resolveMandatoryEndpoint(context,"mock:result");
    resultEndpoint.expectedBodiesReceived(body);
    ProducerTemplate template=context.createProducerTemplate();
    template.start();
    template.send("seda:start",new Processor(){
      public void process(      Exchange exchange){
        Message in=exchange.getIn();
        in.setHeader("name","James");
        in.setBody(body);
      }
    }
);
    template.stop();
    resultEndpoint.assertIsSatisfied();
  }
  protected void assertValidContext(  SpringCamelContext context){
    assertNotNull("No context found!",context);
    List<Route> routes=context.getRoutes();
    assertNotNull("Should have some routes defined",routes);
    assertEquals("Number of routes defined",1,routes.size());
  }
  protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/spring/routingUsingCamelContextFactory.xml");
  }
  @Override @After public void tearDown() throws Exception {
    super.tearDown();
    IOHelper.close(applicationContext);
  }
}
