/** 
 * Tests that verify the usage of default settings in the XPath language by declaring a bean called xpath in the registry
 */
public class XPathLanguageDefaultSettingsTest extends CamelSpringTestSupport {
  private static final String KEY=XPathFactory.DEFAULT_PROPERTY_NAME + ":" + "http://java.sun.com/jaxp/xpath/dom";
  private boolean jvmAdequate=true;
  private String oldPropertyValue;
  @Override @Before public void setUp() throws Exception {
    if (!isJavaVendor("ibm")) {
      oldPropertyValue=System.setProperty(KEY,"com.sun.org.apache.xpath.internal.jaxp.XPathFactoryImpl");
    }
 else {
      jvmAdequate=false;
    }
    super.setUp();
  }
  @Override @After public void tearDown() throws Exception {
    if (oldPropertyValue != null) {
      System.setProperty(KEY,oldPropertyValue);
    }
 else {
      System.clearProperty(KEY);
    }
    super.tearDown();
  }
  @Override protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/language/xpath/XPathLanguageDefaultSettingsTest.xml");
  }
  @Test public void testSpringDSLXPathLanguageDefaultSettings() throws Exception {
    if (!jvmAdequate) {
      return;
    }
    MockEndpoint mockEndpointResult=getMockEndpoint("mock:testDefaultXPathSettingsResult");
    MockEndpoint mockEndpointException=getMockEndpoint("mock:testDefaultXPathSettingsResultException");
    mockEndpointResult.expectedMessageCount(1);
    mockEndpointException.expectedMessageCount(0);
    template.sendBody("seda:testDefaultXPathSettings","<a>Hello|there|Camel</a>");
    assertMockEndpointsSatisfied();
  }
}
