public class DefaultErrorHandlerOnPrepareTestTest extends CamelBlueprintTestSupport {
  @Override protected String getBlueprintDescriptor(){
    return "org/apache/camel/test/blueprint/DefaultErrorHandlerOnPrepareTestTest.xml";
  }
  @Test public void testDefaultErrorHandlerOnPrepare() throws Exception {
    Exchange out=template.request("direct:start",new Processor(){
      @Override public void process(      Exchange exchange) throws Exception {
        exchange.getIn().setBody("Hello World");
      }
    }
);
    assertNotNull(out);
    assertTrue("Should be failed",out.isFailed());
    assertIsInstanceOf(IllegalArgumentException.class,out.getException());
    assertEquals("Forced",out.getIn().getHeader("FailedBecause"));
  }
public static class MyPrepareProcessor implements Processor {
    @Override public void process(    Exchange exchange) throws Exception {
      Exception cause=exchange.getProperty(Exchange.EXCEPTION_CAUGHT,Exception.class);
      exchange.getIn().setHeader("FailedBecause",cause.getMessage());
    }
  }
}
