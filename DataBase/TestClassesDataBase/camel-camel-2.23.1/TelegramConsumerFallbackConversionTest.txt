/** 
 * Checks if conversions of generic objects are happening correctly.
 */
public class TelegramConsumerFallbackConversionTest extends TelegramTestSupport {
  @EndpointInject(uri="direct:message") protected ProducerTemplate template;
  @Before public void mockAPIs(){
    mockTelegramService();
  }
  @Test public void testEverythingOk() throws Exception {
    TelegramService service=currentMockService();
    template.sendBody(new BrandNewType("wrapped message"));
    ArgumentCaptor<OutgoingTextMessage> captor=ArgumentCaptor.forClass(OutgoingTextMessage.class);
    verify(service).sendMessage(eq("mock-token"),captor.capture());
    List<OutgoingTextMessage> msgs=captor.getAllValues();
    assertCollectionSize(msgs,1);
    String text=msgs.get(0).getText();
    assertEquals("wrapped message",text);
  }
  @Override protected RoutesBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:message").to("telegram:bots/mock-token?chatId=1234");
      }
    }
;
  }
private static class BrandNewType {
    String message;
    BrandNewType(    String message){
      this.message=message;
    }
    @Override public String toString(){
      return message;
    }
  }
}
