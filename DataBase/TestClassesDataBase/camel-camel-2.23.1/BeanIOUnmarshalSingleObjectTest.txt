public class BeanIOUnmarshalSingleObjectTest extends CamelTestSupport {
  private static final String NEW_LINE="\n";
  private static final String INPUT="1234:Content starts from here" + NEW_LINE + "then continues"+ NEW_LINE+ "and ends here.";
  @Test public void testMultiLineContentUnmarshal() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    template.sendBody("direct:unmarshal",INPUT);
    mock.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        BeanIODataFormat format=new BeanIODataFormat("org/apache/camel/dataformat/beanio/single-object-mapping.xml","keyValueStream");
        format.setUnmarshalSingleObject(true);
        from("direct:unmarshal").unmarshal(format).process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            Map body=(Map)exchange.getIn().getBody();
            assertEquals(":",body.get("separator"));
            assertEquals("1234",body.get("key"));
            assertEquals(INPUT.substring(5),body.get("value"));
          }
        }
).marshal(format).to("mock:result");
      }
    }
;
  }
}
