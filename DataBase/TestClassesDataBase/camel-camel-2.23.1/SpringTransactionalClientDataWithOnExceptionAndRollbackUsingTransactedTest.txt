/** 
 * Easier transaction configuration as we do not have to setup a transaction error handler
 */
public class SpringTransactionalClientDataWithOnExceptionAndRollbackUsingTransactedTest extends SpringTransactionalClientDataSourceTransactedTest {
  @Test public void testTransactionRollback() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:error");
    mock.expectedMessageCount(1);
    String out=template.requestBody("direct:fail","Hello World",String.class);
    assertEquals("Sorry",out);
    assertMockEndpointsSatisfied();
    int count=jdbc.queryForObject("select count(*) from books",Integer.class);
    assertEquals("Number of books",1,count);
  }
  protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("/org/apache/camel/spring/interceptor/springTransactionalClientDataWithOnExceptionAndRollbackUsingTransacted.xml");
  }
}
