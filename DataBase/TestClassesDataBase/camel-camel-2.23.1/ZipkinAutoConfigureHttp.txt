/** 
 * Integration test requires running Zipkin running <p>The easiest way to run is locally: <pre> {@code curl -sSL https://zipkin.io/quickstart.sh | bash -s java -jar zipkin.jar}</pre> <p>This test has to be run with environment variables set. For example: <pre> {@code ZIPKIN_COLLECTOR_HTTP_SERVICE_HOST=localhost ZIPKIN_COLLECTOR_HTTP_SERVICE_PORT=9411}</pre>
 */
public class ZipkinAutoConfigureHttp extends CamelTestSupport {
  private ZipkinTracer zipkin;
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    zipkin=new ZipkinTracer();
    zipkin.addClientServiceMapping("seda:cat","cat");
    zipkin.addServerServiceMapping("seda:cat","cat");
    zipkin.init(context);
    return context;
  }
  @Test public void testZipkinRoute() throws Exception {
    template.requestBody("direct:start","Hello Cat");
  }
  @Override protected RoutesBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").to("seda:cat");
        from("seda:cat").routeId("cat").log("routing at ${routeId}").delay(simple("${random(1000,2000)}"));
      }
    }
;
  }
}
