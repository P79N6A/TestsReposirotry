public class TikaDetectTest extends CamelTestSupport {
  @EndpointInject(uri="mock:result") protected MockEndpoint resultEndpoint;
  @Test public void testDocumentDetect() throws Exception {
    File document=new File("src/test/resources/test.doc");
    template.sendBody("direct:start",document);
    resultEndpoint.setExpectedMessageCount(1);
    resultEndpoint.expectedMessagesMatches(new Predicate(){
      @Override public boolean matches(      Exchange exchange){
        Object body=exchange.getIn().getBody(String.class);
        assertThat(body,instanceOf(String.class));
        assertThat((String)body,containsString("application/x-tika-msoffice"));
        return true;
      }
    }
);
    resultEndpoint.assertIsSatisfied();
  }
  @Test public void testImageDetect() throws Exception {
    File document=new File("src/test/resources/testGIF.gif");
    template.sendBody("direct:start",document);
    resultEndpoint.setExpectedMessageCount(1);
    resultEndpoint.expectedMessagesMatches(new Predicate(){
      @Override public boolean matches(      Exchange exchange){
        Object body=exchange.getIn().getBody(String.class);
        assertThat(body,instanceOf(String.class));
        assertThat((String)body,containsString("image/gif"));
        return true;
      }
    }
);
    resultEndpoint.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").to("tika:detect").to("mock:result");
      }
    }
;
  }
}
