/** 
 * @version 
 */
public class SplitterStreamCacheTest extends ContextTestSupport {
  private static final String TEST_FILE="org/apache/camel/converter/stream/test.xml";
  protected int numMessages=200;
  @Test public void testSendStreamSource() throws Exception {
    MockEndpoint resultEndpoint=getMockEndpoint("mock:result");
    resultEndpoint.expectedMessageCount(numMessages);
    for (int c=0; c < numMessages; c++) {
      template.sendBody("seda:parallel",new StreamSource(getTestFileStream()));
    }
    assertMockEndpointsSatisfied();
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        context.getStreamCachingStrategy().setSpoolDirectory("target/tmp");
        context.getStreamCachingStrategy().setSpoolThreshold(-1);
        from("seda:parallel?concurrentConsumers=5").streamCaching().split(XPathBuilder.xpath("//person/city")).to("mock:result");
      }
    }
;
  }
  protected InputStream getTestFileStream(){
    InputStream answer=getClass().getClassLoader().getResourceAsStream(TEST_FILE);
    assertNotNull("Should have found the file: " + TEST_FILE + " on the classpath",answer);
    return answer;
  }
}
