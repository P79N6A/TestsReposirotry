/** 
 * Unit test for  {@link ChunkComponent} and {@link ChunkEndpoint}
 */
public class ChunkComponentNestedLayersTest extends CamelTestSupport {
  @EndpointInject(uri="mock:endSimple") protected MockEndpoint endSimpleMock;
  @Produce(uri="direct:startSimple") protected ProducerTemplate startSimpleProducerTemplate;
  /** 
 * Test using two following distinct themeLayer of the same theme without Resource URI header defined
 */
  @Test public void testChunkDoubleLayers() throws Exception {
    Exchange exchange=createExchangeWithBody("The Body");
    exchange.getIn().setHeader("name","Andrew");
    endSimpleMock.expectedMessageCount(1);
    endSimpleMock.expectedBodiesReceived("<div>\nMars to Andrew. Come in, Andrew. This is the body: <div>\nEarth to Andrew. Come in, Andrew.\n</div>\n\n</div>\n");
    startSimpleProducerTemplate.send(exchange);
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure(){
        from("direct:startSimple").to("chunk:example?themeLayer=example_1").to("chunk:example?themeLayer=example_2").to("mock:endSimple");
      }
    }
;
  }
}
