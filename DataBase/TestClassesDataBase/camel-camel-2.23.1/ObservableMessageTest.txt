public class ObservableMessageTest extends CamelTestSupport {
  protected MyObservableMessage observableMessage=new MyObservableMessage();
  @EndpointInject(uri="mock:result") protected MockEndpoint resultEndpoint;
  @Produce(uri="direct:start") protected ProducerTemplate template;
  @Test public void testUseObservableInRoute() throws Exception {
    resultEndpoint.expectedBodiesReceived("Hello James","Hello Claus");
    template.sendBody("James");
    template.sendBody("Claus");
    assertMockEndpointsSatisfied();
  }
public class MyObservableMessage extends ObservableMessage {
    @Override protected void configure(    Observable<Message> observable){
      observable.map(message -> "Hello " + message.getBody(String.class)).subscribe(body -> {
        template.sendBody(resultEndpoint,body);
      }
);
    }
  }
  @Override protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      @Override public void configure(){
        from("direct:start").process(observableMessage);
      }
    }
;
  }
}
