/** 
 * Unit test for testing mail polling is happening according to the default poll interval.
 */
public class MailDefaultDelayForMailConsumeTest extends CamelTestSupport {
  @Test public void testConsuming() throws Exception {
    Mailbox.clearAll();
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedBodiesReceived("Hello London");
    template.sendBody("smtp://bond@localhost","Hello London");
    mock.setResultWaitTime(2000L);
    mock.assertIsSatisfied();
    mock.reset();
    mock.expectedBodiesReceived("Hello Paris");
    mock.setResultWaitTime(1000L + 2000L);
    StopWatch watch=new StopWatch();
    template.sendBody("smtp://bond@localhost","Hello Paris");
    mock.assertIsSatisfied();
    long delta=watch.stop();
    assertTrue("Camel should not default poll the mailbox to often",delta > 1000 - 1000L);
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("pop3://bond@localhost?delay=1000").to("mock:result");
      }
    }
;
  }
}
