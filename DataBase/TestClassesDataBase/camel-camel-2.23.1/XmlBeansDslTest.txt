public class XmlBeansDslTest extends CamelTestSupport {
  @Test public void testSendXmlAndUnmarshal() throws Exception {
    MockEndpoint unmarshal=getMockEndpoint("mock:unmarshal");
    unmarshal.expectedMessageCount(1);
    MockEndpoint marshal=getMockEndpoint("mock:marshal");
    marshal.expectedMessageCount(1);
    template.sendBody("direct:start",createBuyStocksDocument());
    assertMockEndpointsSatisfied();
    Object marshaledBody=marshal.getReceivedExchanges().get(0).getIn().getBody();
    assertIsInstanceOf(byte[].class,marshaledBody);
    Object unmarshaledBody=unmarshal.getReceivedExchanges().get(0).getIn().getBody();
    assertIsInstanceOf(BuyStocksDocument.class,unmarshaledBody);
  }
  private BuyStocksDocument createBuyStocksDocument(){
    BuyStocksDocument document=BuyStocksDocument.Factory.newInstance();
    BuyStocks payload=document.addNewBuyStocks();
    Order order=payload.addNewOrder();
    order.setSymbol("IBM");
    order.setBuyerID("cmueller");
    order.setPrice(140.34);
    order.setVolume(2000);
    return document;
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:start").marshal().xmlBeans().to("mock:marshal").unmarshal().xmlBeans().to("mock:unmarshal");
      }
    }
;
  }
}
