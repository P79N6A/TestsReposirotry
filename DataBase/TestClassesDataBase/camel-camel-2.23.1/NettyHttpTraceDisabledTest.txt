public class NettyHttpTraceDisabledTest extends BaseNettyTest {
  private int portTraceOn=getNextPort();
  private int portTraceOff=getNextPort();
  @Test public void testTraceDisabled() throws Exception {
    HttpClient httpclient=new HttpClient();
    TraceMethod trace=new TraceMethod("http://localhost:" + portTraceOff + "/myservice");
    httpclient.executeMethod(trace);
    assertTrue(trace.getStatusCode() == 405);
    trace.releaseConnection();
  }
  @Test public void testTraceEnabled() throws Exception {
    HttpClient httpclient=new HttpClient();
    TraceMethod trace=new TraceMethod("http://localhost:" + portTraceOn + "/myservice");
    httpclient.executeMethod(trace);
    assertTrue(trace.getStatusCode() == 200);
    trace.releaseConnection();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("netty4-http:http://localhost:" + portTraceOff + "/myservice").to("log:foo");
        from("netty4-http:http://localhost:" + portTraceOn + "/myservice?traceEnabled=true").to("log:bar");
      }
    }
;
  }
}
