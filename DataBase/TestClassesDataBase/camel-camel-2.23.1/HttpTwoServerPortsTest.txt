/** 
 * @version 
 */
public class HttpTwoServerPortsTest extends BaseJettyTest {
  private int port1;
  private int port2;
  @Test public void testTwoServerPorts() throws Exception {
    String reply=template.requestBody("direct:a","World",String.class);
    assertEquals("Bye World",reply);
    reply=template.requestBody("direct:b","Camel",String.class);
    assertEquals("Hi Camel",reply);
    reply=template.requestBody("direct:a","Earth",String.class);
    assertEquals("Bye Earth",reply);
    reply=template.requestBody("direct:b","Moon",String.class);
    assertEquals("Hi Moon",reply);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        port1=getPort();
        port2=getNextPort();
        from("direct:a").to("http://localhost:" + port1 + "/myapp");
        from("direct:b").to("http://localhost:" + port2 + "/myotherapp");
        from("jetty://http://localhost:" + port1 + "/myapp").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            String in=exchange.getIn().getBody(String.class);
            exchange.getOut().setBody("Bye " + in);
          }
        }
);
        from("jetty://http://localhost:" + port2 + "/myotherapp").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            String in=exchange.getIn().getBody(String.class);
            exchange.getOut().setBody("Hi " + in);
          }
        }
);
      }
    }
;
  }
}
