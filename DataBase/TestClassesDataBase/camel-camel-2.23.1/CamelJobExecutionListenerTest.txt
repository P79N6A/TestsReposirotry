@RunWith(MockitoJUnitRunner.class) public class CamelJobExecutionListenerTest extends CamelTestSupport {
  @Mock JobExecution jobExecution;
  CamelJobExecutionListener jobExecutionListener;
  @Override protected void doPostSetup() throws Exception {
    jobExecutionListener=new CamelJobExecutionListener(template(),"seda:eventQueue");
  }
  @Test public void shouldSendBeforeJobEvent() throws Exception {
    jobExecutionListener.beforeJob(jobExecution);
    assertEquals(jobExecution,consumer().receiveBody("seda:eventQueue"));
  }
  @Test public void shouldSetBeforeJobEventHeader() throws Exception {
    jobExecutionListener.beforeJob(jobExecution);
    Exchange beforeJobEvent=consumer().receive("seda:eventQueue");
    assertEquals(CamelJobExecutionListener.EventType.BEFORE.name(),beforeJobEvent.getIn().getHeader(CamelJobExecutionListener.EventType.HEADER_KEY));
  }
  @Test public void shouldSendAfterJobEvent() throws Exception {
    jobExecutionListener.afterJob(jobExecution);
    assertEquals(jobExecution,consumer().receiveBody("seda:eventQueue"));
  }
  @Test public void shouldSetAfterJobEventHeader() throws Exception {
    jobExecutionListener.afterJob(jobExecution);
    Exchange beforeJobEvent=consumer().receive("seda:eventQueue");
    assertEquals(CamelJobExecutionListener.EventType.AFTER.name(),beforeJobEvent.getIn().getHeader(CamelJobExecutionListener.EventType.HEADER_KEY));
  }
}
