/** 
 * @version 
 */
public class FileProducerTempFileExistsIssueTest extends ContextTestSupport {
  @Override @Before public void setUp() throws Exception {
    deleteDirectory("target/tempprefix");
    super.setUp();
  }
  @Override public boolean isUseRouteBuilder(){
    return false;
  }
  @Test public void testIllegalConfiguration() throws Exception {
    try {
      context.getEndpoint("file://target/tempprefix?fileExist=Append&tempPrefix=foo").createProducer();
      fail("Should have thrown exception");
    }
 catch (    IllegalArgumentException e) {
      assertEquals("You cannot set both fileExist=Append and tempPrefix/tempFileName options",e.getMessage());
    }
    try {
      context.getEndpoint("file://target/tempprefix?fileExist=Append&tempFileName=foo").createProducer();
      fail("Should have thrown exception");
    }
 catch (    IllegalArgumentException e) {
      assertEquals("You cannot set both fileExist=Append and tempPrefix/tempFileName options",e.getMessage());
    }
  }
  @Test public void testWriteUsingTempPrefixButFileExist() throws Exception {
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"hello.txt");
    template.sendBodyAndHeader("file://target/tempprefix?tempPrefix=foo","Bye World",Exchange.FILE_NAME,"hello.txt");
    File file=new File("target/tempprefix/hello.txt");
    assertEquals(true,file.exists());
    assertEquals("Bye World",context.getTypeConverter().convertTo(String.class,file));
  }
  @Test public void testWriteUsingTempPrefixButBothFileExist() throws Exception {
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"hello.txt");
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"foohello.txt");
    template.sendBodyAndHeader("file://target/tempprefix?tempPrefix=foo","Bye World",Exchange.FILE_NAME,"hello.txt");
    File file=new File("target/tempprefix/hello.txt");
    assertEquals(true,file.exists());
    assertEquals("Bye World",context.getTypeConverter().convertTo(String.class,file));
  }
  @Test public void testWriteUsingTempPrefixButFileExistOverride() throws Exception {
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"hello.txt");
    template.sendBodyAndHeader("file://target/tempprefix?tempPrefix=foo&fileExist=Override","Bye World",Exchange.FILE_NAME,"hello.txt");
    File file=new File("target/tempprefix/hello.txt");
    assertEquals(true,file.exists());
    assertEquals("Bye World",context.getTypeConverter().convertTo(String.class,file));
  }
  @Test public void testWriteUsingTempPrefixButFileExistIgnore() throws Exception {
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"hello.txt");
    template.sendBodyAndHeader("file://target/tempprefix?tempPrefix=foo&fileExist=Ignore","Bye World",Exchange.FILE_NAME,"hello.txt");
    File file=new File("target/tempprefix/hello.txt");
    assertEquals(true,file.exists());
    assertEquals("Hello World",context.getTypeConverter().convertTo(String.class,file));
  }
  @Test public void testWriteUsingTempPrefixButFileExistFail() throws Exception {
    template.sendBodyAndHeader("file://target/tempprefix","Hello World",Exchange.FILE_NAME,"hello.txt");
    try {
      template.sendBodyAndHeader("file://target/tempprefix?tempPrefix=foo&fileExist=Fail","Bye World",Exchange.FILE_NAME,"hello.txt");
      fail("Should have thrown an exception");
    }
 catch (    CamelExecutionException e) {
      GenericFileOperationFailedException cause=assertIsInstanceOf(GenericFileOperationFailedException.class,e.getCause());
      assertTrue(cause.getMessage().startsWith("File already exist"));
    }
    File file=new File("target/tempprefix/hello.txt");
    assertEquals(true,file.exists());
    assertEquals("Hello World",context.getTypeConverter().convertTo(String.class,file));
  }
}
