public class JcrAuthLoginFailureTest extends JcrAuthTestBase {
  @Test public void testCreateNodeWithAuthentication() throws Exception {
    Exchange exchange=createExchangeWithBody("<message>hello!</message>");
    Exchange out=template.send("direct:a",exchange);
    assertNotNull(out);
    String uuid=out.getOut().getBody(String.class);
    assertNull("Expected body to be null, found JCR node UUID",uuid);
    assertTrue("Wrong exception type",out.getException() instanceof LoginException);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:a").setHeader(JcrConstants.JCR_NODE_NAME,constant("node")).setHeader("my.contents.property",body()).to("jcr://not-a-user:nonexisting-password@repository" + BASE_REPO_PATH);
      }
    }
;
  }
}
