public class UndertowMethodRestricTest extends BaseUndertowTest {
  private static String url;
  @BeforeClass public static void init(){
    url="http://localhost:" + getPort() + "/methodRestrict";
  }
  @Test public void testProperHttpMethod() throws Exception {
    HttpClient httpClient=new HttpClient();
    PostMethod httpPost=new PostMethod(url);
    StringRequestEntity reqEntity=new StringRequestEntity("This is a test",null,null);
    httpPost.setRequestEntity(reqEntity);
    int status=httpClient.executeMethod(httpPost);
    assertEquals(200,status);
    String result=httpPost.getResponseBodyAsString();
    assertEquals("This is a test response",result);
  }
  @Test public void testImproperHttpMethod() throws Exception {
    HttpClient httpClient=new HttpClient();
    GetMethod httpGet=new GetMethod(url);
    int status=httpClient.executeMethod(httpGet);
    assertEquals("Get a wrong response status",405,status);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("undertow://http://localhost:{{port}}/methodRestrict?httpMethodRestrict=POST").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            Message in=exchange.getIn();
            String request=in.getBody(String.class);
            exchange.getOut().setBody(request + " response");
          }
        }
);
      }
    }
;
  }
}
