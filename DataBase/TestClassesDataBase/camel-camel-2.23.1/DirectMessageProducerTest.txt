/** 
 * Tests posting a twitter update with the default In Message Exchange Pattern
 */
public class DirectMessageProducerTest extends CamelTwitterTestSupport {
  private static final Logger LOG=LoggerFactory.getLogger(DirectMessageProducerTest.class);
  @EndpointInject(uri="mock:result") protected MockEndpoint resultEndpoint;
  @Test public void testDirectMessage() throws Exception {
    Date now=new Date();
    String tweet="Test a tweet posted on " + now.toString();
    LOG.info("Tweet: " + tweet);
    ProducerTemplate producerTemplate=context.createProducerTemplate();
    producerTemplate.sendBody("direct:tweets",tweet);
    resultEndpoint.expectedMessageCount(1);
    resultEndpoint.expectedBodyReceived().body(String.class);
    resultEndpoint.assertIsSatisfied();
    List<Exchange> tweets=resultEndpoint.getExchanges();
    assertNotNull(tweets);
    assertThat(tweets.size(),is(1));
    String receivedTweet=tweets.get(0).getIn().getBody(String.class);
    assertThat(receivedTweet,is(tweet));
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:tweets").to("twitter-directmessage:cameltweet?" + getUriTokens()).to("mock:result");
      }
    }
;
  }
}
