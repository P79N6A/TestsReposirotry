public class CaffeineLoadCacheProducerMultiOperationSameCacheTest extends CaffeineLoadCacheTestSupport {
  @Test public void testSameCachePutAndGet() throws Exception {
    final Map<String,String> map=new HashMap<>();
    map.put("1","1");
    fluentTemplate().withBody("1").to("direct://start").send();
    MockEndpoint mock1=getMockEndpoint("mock:result");
    mock1.expectedMinimumMessageCount(1);
    mock1.expectedHeaderReceived(CaffeineConstants.ACTION_HAS_RESULT,true);
    mock1.expectedHeaderReceived(CaffeineConstants.ACTION_SUCCEEDED,true);
    assertEquals("1",mock1.getExchanges().get(0).getIn().getBody());
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        from("direct://start").toF("caffeine-loadcache://%s?cache=#cache&action=PUT&key=1","test").toF("caffeine-loadcache://%s?cache=#cache&key=1&action=GET","test").to("log:org.apache.camel.component.caffeine?level=INFO&showAll=true&multiline=true").log("Test! ${body}").to("mock:result");
      }
    }
;
  }
}
