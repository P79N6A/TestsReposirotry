public class FromRestOptionsTest extends ContextTestSupport {
  static final String ALLOWS="HEAD,GET,PUT,POST,DELETE,OPTIONS";
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("dummy-rest",new DummyRestConsumerFactory());
    return jndi;
  }
  @Test public void testRestOptionsModel() throws Exception {
    RestDefinition rest=context.getRestDefinitions().get(0);
    assertNotNull(rest);
    assertEquals("/say/hello",rest.getPath());
    assertEquals(1,rest.getVerbs().size());
    assertIsInstanceOf(OptionsVerbDefinition.class,rest.getVerbs().get(0));
    Exchange out=template.request("seda:options-say-hello",new Processor(){
      @Override public void process(      Exchange exchange) throws Exception {
        exchange.getIn().setBody("Me");
      }
    }
);
    assertMockEndpointsSatisfied();
    assertNotNull(out);
    assertEquals(out.getOut().getHeader("Allow"),ALLOWS);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        restConfiguration().host("localhost");
        rest("/say/hello").options().route().setHeader(Exchange.HTTP_RESPONSE_CODE,constant(200)).setHeader("Allow",constant(ALLOWS));
      }
    }
;
  }
}
