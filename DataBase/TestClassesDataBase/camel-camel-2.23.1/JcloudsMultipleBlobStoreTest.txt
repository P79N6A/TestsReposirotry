public class JcloudsMultipleBlobStoreTest extends CamelTestSupport {
  private static final String TEST_CONTAINER="testContainer";
  private static final String TEST_BLOB1="testBlob1";
  private static final String TEST_BLOB2="testBlob2";
  BlobStoreContext blobStoreContext1=ContextBuilder.newBuilder("transient").name("b1").credentials("identity","credential").build(BlobStoreContext.class);
  BlobStore blobStore1=blobStoreContext1.getBlobStore();
  BlobStoreContext blobStoreContext2=ContextBuilder.newBuilder("transient").name("b2").credentials("identity","credential").build(BlobStoreContext.class);
  BlobStore blobStore2=blobStoreContext2.getBlobStore();
  @Test public void testWithMultipleServices() throws InterruptedException {
    String message1="Blob 1";
    String message2="Blob 2";
    MockEndpoint mockEndpoint1=resolveMandatoryEndpoint("mock:results1",MockEndpoint.class);
    mockEndpoint1.expectedBodiesReceived(message1);
    MockEndpoint mockEndpoint2=resolveMandatoryEndpoint("mock:results2",MockEndpoint.class);
    mockEndpoint2.expectedBodiesReceived(message2);
    JcloudsBlobStoreHelper.writeBlob(blobStore1,TEST_CONTAINER,TEST_BLOB1,new StringPayload(message1));
    JcloudsBlobStoreHelper.writeBlob(blobStore2,TEST_CONTAINER,TEST_BLOB2,new StringPayload(message2));
    mockEndpoint1.assertIsSatisfied();
    mockEndpoint2.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    blobStore1.createContainerInLocation(null,TEST_CONTAINER);
    blobStore2.createContainerInLocation(null,TEST_CONTAINER);
    ((JcloudsComponent)context.getComponent("jclouds")).setBlobStores(Lists.newArrayList(blobStore1,blobStore2));
    return new RouteBuilder(){
      public void configure(){
        from("jclouds:blobstore:b1?container=" + TEST_CONTAINER).convertBodyTo(String.class).to("mock:results1");
        from("jclouds:blobstore:b2?container=" + TEST_CONTAINER).convertBodyTo(String.class).to("mock:results2");
      }
    }
;
  }
}
