/** 
 * For documentation how to write files using the FileProducer.
 */
public class ToFileRouteTest extends ContextTestSupport {
  @Test public void testToFile() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    mock.expectedFileExists("target/test-reports/report.txt");
    template.sendBody("direct:reports","This is a great report");
    assertMockEndpointsSatisfied();
  }
  protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry reg=super.createRegistry();
    reg.bind("processReport",new ProcessReport());
    return reg;
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("direct:reports").process("processReport").to("file://target/test-reports","mock:result");
      }
    }
;
  }
private static class ProcessReport implements Processor {
    public void process(    Exchange exchange) throws Exception {
      String body=exchange.getIn().getBody(String.class);
      exchange.getOut().setBody(body);
      exchange.getOut().setHeader(Exchange.FILE_NAME,"report.txt");
    }
  }
}
