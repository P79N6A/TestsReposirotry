/** 
 * @version 
 */
public class BeanOgnMethodWithXPathInjectionTest extends ContextTestSupport {
  private static final Logger LOG=LoggerFactory.getLogger(BeanRouteTest.class);
  protected MyBean myBean=new MyBean();
  protected MyOtherBean myOtherBean=new MyOtherBean(myBean);
  @Test public void testSendMessage() throws Exception {
    String expectedBody="<env:Envelope xmlns:env='http://www.w3.org/2003/05/soap-envelope'><env:Body>" + "<foo>bar</foo></env:Body></env:Envelope>";
    Object out=template.requestBodyAndHeader("direct:in",expectedBody,"foo","bar");
    assertEquals("bar",out);
    assertEquals("bean body: " + myBean,expectedBody,myBean.body);
    assertEquals("bean foo: " + myBean,"bar",myBean.foo);
  }
  @Test public void testSendTwoMessages() throws Exception {
    String expectedBody="<env:Envelope xmlns:env='http://www.w3.org/2003/05/soap-envelope'><env:Body>" + "<foo>bar</foo></env:Body></env:Envelope>";
    Object out=template.requestBodyAndHeader("direct:in",expectedBody,"foo","bar");
    assertEquals("bar",out);
    assertEquals("bean body: " + myBean,expectedBody,myBean.body);
    assertEquals("bean foo: " + myBean,"bar",myBean.foo);
    String expectedBody2="<env:Envelope xmlns:env='http://www.w3.org/2003/05/soap-envelope'><env:Body>" + "<foo>baz</foo></env:Body></env:Envelope>";
    Object out2=template.requestBodyAndHeader("direct:in",expectedBody2,"foo","bar");
    assertEquals("baz",out2);
    assertEquals("bean body: " + myBean,expectedBody2,myBean.body);
    assertEquals("bean foo: " + myBean,"baz",myBean.foo);
  }
  @Override protected Context createJndiContext() throws Exception {
    JndiContext answer=new JndiContext();
    answer.bind("myBean",myBean);
    answer.bind("myOtherBean",myOtherBean);
    return answer;
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:in").transform().method("myOtherBean","doSomething.read");
      }
    }
;
  }
public static class MyOtherBean {
    private final MyBean inner;
    public MyOtherBean(    MyBean inner){
      this.inner=inner;
    }
    public MyBean doSomething(){
      return inner;
    }
  }
public static class MyBean {
    public String body;
    public String foo;
    @Override public String toString(){
      return "MyBean[foo: " + foo + " body: "+ body+ "]";
    }
    public String read(    String body,    @XPath("/soap:Envelope/soap:Body/foo/text()") String foo){
      this.foo=foo;
      this.body=body;
      LOG.info("read() method called on " + this);
      return foo;
    }
  }
}
