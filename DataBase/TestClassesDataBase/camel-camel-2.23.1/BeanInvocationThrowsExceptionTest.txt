/** 
 * Unit test for bean invocation that throws an exception
 */
public class BeanInvocationThrowsExceptionTest extends ContextTestSupport {
  @Test public void testBeanInvocation(){
    int result=(Integer)template.sendBody("direct:input",ExchangePattern.InOut,"Hello London");
    assertEquals(1,result);
  }
  @Test public void testBeanInvocationFailure(){
    Exchange exchange=getMandatoryEndpoint("direct:input").createExchange(ExchangePattern.InOut);
    exchange.getIn().setBody("Hello Paris");
    Exchange out=template.send("direct:input",exchange);
    assertTrue("Should be failed",out.isFailed());
    assertTrue("Should be IllegalArgumentException",out.getException() instanceof IllegalArgumentException);
    assertEquals("Forced exception",out.getException().getMessage());
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("direct:input").bean(new ExceptionBean());
      }
    }
;
  }
public static class ExceptionBean {
    public int doSomething(    String request) throws Exception {
      if (request.equals("Hello London")) {
        return 1;
      }
 else {
        throw new IllegalArgumentException("Forced exception");
      }
    }
  }
}
