public class ConsulEventWatchTest extends ConsulTestSupport {
  private String key;
  private EventClient client;
  @Override public void doPreSetup(){
    key=generateRandomString();
    client=getConsul().eventClient();
  }
  @Test public void testWatchEvent() throws Exception {
    List<String> values=generateRandomListOfStrings(3);
    MockEndpoint mock=getMockEndpoint("mock:event-watch");
    mock.expectedMessageCount(values.size());
    mock.expectedBodiesReceived(values);
    mock.expectedHeaderReceived(ConsulConstants.CONSUL_RESULT,true);
    values.forEach(v -> client.fireEvent(key,v));
    mock.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        fromF("consul:event?key=%s&blockSeconds=1",key).to("log:org.apache.camel.component.consul?level=INFO&showAll=true").to("mock:event-watch");
      }
    }
;
  }
}
