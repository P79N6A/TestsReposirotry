public class RemovePropertyTest extends ContextTestSupport {
  private MockEndpoint end;
  private MockEndpoint mid;
  private String propertyName="foo";
  private String expectedPropertyValue="bar";
  @Test public void testSetExchangePropertyMidRouteThenRemove() throws Exception {
    mid.expectedMessageCount(1);
    end.expectedMessageCount(1);
    template.sendBody("direct:start","<blah/>");
    assertMockEndpointsSatisfied();
    List<Exchange> midExchanges=mid.getExchanges();
    Exchange midExchange=midExchanges.get(0);
    String actualPropertyValue=midExchange.getProperty(propertyName,String.class);
    assertEquals(expectedPropertyValue,actualPropertyValue);
    List<Exchange> endExchanges=end.getExchanges();
    Exchange endExchange=endExchanges.get(0);
    assertNull(endExchange.getProperty(propertyName,String.class));
  }
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    end=getMockEndpoint("mock:end");
    mid=getMockEndpoint("mock:mid");
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:start").setProperty(propertyName).constant(expectedPropertyValue).to("mock:mid").removeProperty(propertyName).to("mock:end");
      }
    }
;
  }
}
