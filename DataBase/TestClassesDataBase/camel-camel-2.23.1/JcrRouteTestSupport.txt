/** 
 * JcrRouteTestSupport
 * @version $Id$
 */
public abstract class JcrRouteTestSupport extends CamelTestSupport {
  protected static final String CONFIG_FILE="target/test-classes/repository-simple-security.xml";
  protected static final String REPO_PATH="target/repository-simple-security";
  private Repository repository;
  @Override @Before public void setUp() throws Exception {
    deleteDirectory(REPO_PATH);
    super.setUp();
  }
  protected Repository getRepository(){
    return repository;
  }
  protected Session openSession() throws RepositoryException {
    return getRepository().login(new SimpleCredentials("user","pass".toCharArray()));
  }
  @Override protected Context createJndiContext() throws Exception {
    File config=new File(CONFIG_FILE);
    if (!config.exists()) {
      throw new FileNotFoundException("Missing config file: " + config.getPath());
    }
    Context context=super.createJndiContext();
    repository=new TransientRepository(CONFIG_FILE,REPO_PATH);
    context.bind("repository",repository);
    return context;
  }
}
