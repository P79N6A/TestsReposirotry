private class MultiMasterZookeeperPolicyEnforcedContext {
  CamelContext controlledContext;
  ProducerTemplate template;
  MockEndpoint mock;
  String routename;
  String path;
  MultiMasterZookeeperPolicyEnforcedContext(  String name,  int activeNodesDesired,  String path) throws Exception {
    controlledContext=new DefaultCamelContext();
    routename=name;
    this.path=path;
    template=controlledContext.createProducerTemplate();
    mock=controlledContext.getEndpoint("mock:controlled",MockEndpoint.class);
    controlledContext.addRoutes(new FailoverRoute(name,activeNodesDesired,path));
    controlledContext.start();
  }
  public void sendMessageToEnforcedRoute(  String message,  int expected) throws InterruptedException {
    mock.expectedMessageCount(expected);
    try {
      LOG.info("Sending message to: {}","vm:" + routename);
      template.sendBody("vm:" + routename,ExchangePattern.InOut,message);
    }
 catch (    Exception e) {
      if (expected > 0) {
        LOG.error(e.getMessage(),e);
        fail("Expected messages...");
      }
    }
    mock.await(2,TimeUnit.SECONDS);
    mock.assertIsSatisfied(2000);
  }
  public void shutdown() throws Exception {
    LoggerFactory.getLogger(getClass()).debug("stopping");
    controlledContext.stop();
    LoggerFactory.getLogger(getClass()).debug("stopped");
  }
  public void startup() throws Exception {
    LoggerFactory.getLogger(getClass()).debug("starting");
    controlledContext.start();
    LoggerFactory.getLogger(getClass()).debug("started");
  }
}
