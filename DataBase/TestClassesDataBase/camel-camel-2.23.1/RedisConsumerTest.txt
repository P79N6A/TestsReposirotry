@RunWith(MockitoJUnitRunner.class) public class RedisConsumerTest extends CamelTestSupport {
  @Mock private RedisMessageListenerContainer listenerContainer;
  @Captor private ArgumentCaptor<Collection<ChannelTopic>> collectionCaptor;
  @Captor private ArgumentCaptor<MessageListener> messageListenerCaptor;
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry registry=super.createRegistry();
    registry.bind("listenerContainer",listenerContainer);
    return registry;
  }
  @Test public void registerConsumerForTwoChannelTopics() throws Exception {
    verify(listenerContainer).addMessageListener(any(MessageListener.class),collectionCaptor.capture());
    Collection<ChannelTopic> topics=collectionCaptor.getValue();
    Iterator<ChannelTopic> topicIterator=topics.iterator();
    Topic firstTopic=topicIterator.next();
    Topic twoTopic=topicIterator.next();
    assertEquals("one",firstTopic.getTopic());
    assertEquals("two",twoTopic.getTopic());
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("spring-redis://localhost:6379?command=SUBSCRIBE&channels=one,two&listenerContainer=#listenerContainer").to("mock:result");
      }
    }
;
  }
}
