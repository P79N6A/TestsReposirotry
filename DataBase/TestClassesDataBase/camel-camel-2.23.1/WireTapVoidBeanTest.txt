/** 
 * Wire tap unit test
 */
public class WireTapVoidBeanTest extends ContextTestSupport {
  private static final Logger LOG=LoggerFactory.getLogger(WireTapVoidBeanTest.class);
  @Test public void testWireTapToVoidBean() throws Exception {
    getMockEndpoint("mock:result").expectedBodiesReceived("Hello World");
    template.sendBody("direct:start","Hello World");
    assertMockEndpointsSatisfied();
    final MyTapBean tapBean=(MyTapBean)context.getRegistry().lookupByName("tap");
    await().atMost(2,TimeUnit.SECONDS).untilAsserted(() -> {
      assertEquals("Hello World",tapBean.getTapped());
    }
);
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("tap",new MyTapBean());
    return jndi;
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:start").wireTap("bean:tap").dynamicUri(false).to("mock:result");
      }
    }
;
  }
public static class MyTapBean {
    private String tapped;
    public void tapSomething(    String body){
      LOG.info("Wire tapping: {}",body);
      tapped=body;
    }
    public String getTapped(){
      return tapped;
    }
  }
}
