/** 
 * @version 
 */
public class PollEnricherRefTest extends ContextTestSupport {
  private SedaEndpoint cool=new SedaEndpoint();
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("cool",cool);
    jndi.bind("agg",new UseLatestAggregationStrategy());
    return jndi;
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    cool.setCamelContext(context);
    return context;
  }
  @Test public void testPollEnrichRef() throws Exception {
    Exchange exchange=new DefaultExchange(context);
    exchange.getIn().setBody("Bye World");
    cool.getQueue().add(exchange);
    String out=template.requestBody("direct:start","Hello World",String.class);
    assertEquals("Bye World",out);
    assertEquals(0,cool.getQueue().size());
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        cool.setEndpointUriIfNotSpecified("cool");
        from("direct:start").pollEnrichRef("cool",2000,"agg");
      }
    }
;
  }
}
