/** 
 * @version 
 */
public class JmsInOutExclusiveTopicTest extends CamelTestSupport {
  @Test public void testJmsInOutExclusiveTopicTest() throws Exception {
    getMockEndpoint("mock:result").expectedBodiesReceived("Bye Camel");
    String out=template.requestBody("direct:start","Camel",String.class);
    assertEquals("Bye Camel",out);
    assertMockEndpointsSatisfied();
  }
  protected CamelContext createCamelContext() throws Exception {
    CamelContext camelContext=super.createCamelContext();
    ConnectionFactory connectionFactory=CamelJmsTestHelper.createConnectionFactory();
    camelContext.addComponent("activemq",jmsComponentAutoAcknowledge(connectionFactory));
    return camelContext;
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("direct:start").to("activemq:topic:news?replyToType=Exclusive&replyTo=queue:back").to("mock:result");
        from("activemq:topic:news?disableReplyTo=true").transform(body().prepend("Bye ")).process(new Processor(){
          @Override public void process(          Exchange exchange) throws Exception {
            String replyTo=exchange.getIn().getHeader("JMSReplyTo",String.class);
            String cid=exchange.getIn().getHeader("JMSCorrelationID",String.class);
            log.info("ReplyTo: {}",replyTo);
            log.info("CorrelationID: {}",cid);
            if (replyTo != null && cid != null) {
              Thread.sleep(1000);
              log.info("Sending back reply message on {}",replyTo);
              template.sendBodyAndHeader("activemq:" + replyTo,exchange.getIn().getBody(),"JMSCorrelationID",cid);
            }
          }
        }
);
      }
    }
;
  }
}
