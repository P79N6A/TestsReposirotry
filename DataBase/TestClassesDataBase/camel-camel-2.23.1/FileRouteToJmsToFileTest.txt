/** 
 * Unit test that we can do file over JMS to file.
 */
public class FileRouteToJmsToFileTest extends CamelTestSupport {
  protected String componentName="activemq";
  @Test public void testRouteFileToFile() throws Exception {
    deleteDirectory("target/file2file");
    NotifyBuilder notify=new NotifyBuilder(context).from("activemq:queue:hello").whenDone(1).create();
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    template.sendBodyAndHeader("file://target/file2file/in","Hello World",Exchange.FILE_NAME,"hello.txt");
    assertMockEndpointsSatisfied();
    notify.matchesMockWaitTime();
    File file=new File("target/file2file/out/hello.txt");
    assertTrue("The file should exists",file.exists());
  }
  protected CamelContext createCamelContext() throws Exception {
    CamelContext camelContext=super.createCamelContext();
    ConnectionFactory connectionFactory=CamelJmsTestHelper.createConnectionFactory();
    camelContext.addComponent(componentName,jmsComponentAutoAcknowledge(connectionFactory));
    return camelContext;
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("file://target/file2file/in").to("activemq:queue:hello");
        from("activemq:queue:hello").to("file://target/file2file/out","mock:result");
      }
    }
;
  }
}
