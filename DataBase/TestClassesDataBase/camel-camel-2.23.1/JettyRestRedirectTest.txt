public class JettyRestRedirectTest extends BaseJettyTest {
  @Test public void testRedirectInvocation() throws Exception {
    String response=template.requestBody("jetty:http://localhost:" + getPort2() + "/metadata/profile/tag?httpClient.supportRedirect=true","<hello>Camel</hello>",String.class);
    assertEquals("It should support the redirect out of box.","Mock profile",response);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        restConfiguration().component("jetty").host("localhost").scheme("http").port(getPort2());
        rest("/metadata/profile").get("/{id}").to("direct:profileLookup").post("/tag").to("direct:tag");
        from("direct:profileLookup").transform().constant("Mock profile");
        from("direct:tag").log("${headers}").process(new Processor(){
          @Override public void process(          Exchange ex) throws Exception {
            ex.getOut().setHeader(Exchange.HTTP_RESPONSE_CODE,302);
            ex.getOut().setHeader("location","/metadata/profile/1");
          }
        }
).log("${headers}").transform().constant("Redirecting...");
      }
    }
;
  }
}
