public class ElasticsearchBulkTest extends ElasticsearchBaseTest {
  @Test public void testBulkIndex() throws Exception {
    List<Map<String,String>> documents=new ArrayList<>();
    Map<String,String> document1=createIndexedData("1");
    Map<String,String> document2=createIndexedData("2");
    documents.add(document1);
    documents.add(document2);
    List<?> indexIds=template.requestBody("direct:bulk_index",documents,List.class);
    assertNotNull("indexIds should be set",indexIds);
    assertCollectionSize("Indexed documents should match the size of documents",indexIds,documents.size());
  }
  @Test public void bulkIndexRequestBody() throws Exception {
    String prefix=createPrefix();
    BulkRequest request=new BulkRequest();
    request.add(new IndexRequest(prefix + "foo",prefix + "bar",prefix + "baz").source("{\"" + prefix + "content\": \""+ prefix+ "hello\"}"));
    @SuppressWarnings("unchecked") List<String> indexedDocumentIds=template.requestBody("direct:bulk_index",request,List.class);
    assertThat(indexedDocumentIds,notNullValue());
    assertThat(indexedDocumentIds.size(),equalTo(1));
    assertThat(indexedDocumentIds,hasItem(prefix + "baz"));
  }
  @Test public void bulkRequestBody() throws Exception {
    String prefix=createPrefix();
    BulkRequest request=new BulkRequest();
    request.add(new IndexRequest(prefix + "foo",prefix + "bar",prefix + "baz").source("{\"" + prefix + "content\": \""+ prefix+ "hello\"}"));
    BulkResponse response=template.requestBody("direct:bulk",request,BulkResponse.class);
    assertThat(response,notNullValue());
    assertEquals(prefix + "baz",response.getItems()[0].getId());
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure(){
        from("direct:bulk_index").to("elasticsearch5://elasticsearch?operation=BULK_INDEX&indexName=twitter&indexType=tweet&ip=localhost&port=" + ES_TRANSPORT_PORT);
        from("direct:bulk").to("elasticsearch5://elasticsearch?operation=BULK&indexName=twitter&indexType=tweet&ip=localhost&port=" + ES_TRANSPORT_PORT);
      }
    }
;
  }
}
