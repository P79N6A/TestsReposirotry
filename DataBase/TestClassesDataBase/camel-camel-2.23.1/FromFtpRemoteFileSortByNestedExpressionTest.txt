/** 
 * Unit test to verify remotefile sort by option.
 */
public class FromFtpRemoteFileSortByNestedExpressionTest extends FtpServerTestSupport {
  private String getFtpUrl(){
    return "ftp://admin@localhost:" + getPort() + "/sortbynested?password=admin&consumer.delay=5000";
  }
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    prepareFtpServer();
  }
  @Override public boolean isUseRouteBuilder(){
    return false;
  }
  @Test public void testSortFiles() throws Exception {
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(getFtpUrl() + "&sortBy=file:ext;file:name").to("mock:result");
      }
    }
);
    context.start();
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedBodiesReceived("Hello Dublin","Hello London","Hello Paris","Hello Copenhagen");
    assertMockEndpointsSatisfied();
  }
  @Test public void testSortFilesReverse() throws Exception {
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(getFtpUrl() + "&sortBy=file:ext;reverse:file:name").to("mock:reverse");
      }
    }
);
    context.start();
    MockEndpoint reverse=getMockEndpoint("mock:reverse");
    reverse.expectedBodiesReceived("Hello Paris","Hello London","Hello Dublin","Hello Copenhagen");
    assertMockEndpointsSatisfied();
  }
  private void prepareFtpServer() throws Exception {
    sendFile(getFtpUrl(),"Hello Paris","paris.txt");
    sendFile(getFtpUrl(),"Hello London","london.txt");
    sendFile(getFtpUrl(),"Hello Copenhagen","copenhagen.xml");
    sendFile(getFtpUrl(),"Hello Dublin","dublin.txt");
  }
}
