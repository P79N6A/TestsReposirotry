/** 
 * Unit test for CAMEL_6820Test.  This test is to verify the ability to  support the Camel File Component more cleanly along with better support  for ByteMessages. 
 */
public class CAMEL6820Test extends JmsTestSupport {
  private static final String TEST_DATA_DIR="target/testdata";
  private static final String FILE_OUTPUT_URI="file:" + TEST_DATA_DIR;
  private static final String FILE_INPUT_URI="file:" + TEST_DATA_DIR;
  private static final String SJMS_QUEUE_URI="sjms:queue:file.converter.queue";
  private static final String MOCK_RESULT_URI="mock:result";
  @Test public void testCamelGenericFileConverterMessage() throws Exception {
    File f=new File(TEST_DATA_DIR);
    if (f.exists()) {
      FileUtils.deleteDirectory(new File(TEST_DATA_DIR));
    }
    f.mkdirs();
    SjmsComponent component=context.getComponent("sjms",SjmsComponent.class);
    assertNotNull(component);
    final String expectedBody="Hello World";
    MockEndpoint mock=getMockEndpoint(MOCK_RESULT_URI);
    mock.expectedMessageCount(1);
    mock.expectedBodiesReceived(expectedBody);
    template.sendBody(FILE_OUTPUT_URI,expectedBody);
    mock.assertIsSatisfied();
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from(FILE_INPUT_URI).convertBodyTo(InputStream.class).to(SJMS_QUEUE_URI);
        from(SJMS_QUEUE_URI).convertBodyTo(String.class).to(MOCK_RESULT_URI);
      }
    }
;
  }
}
