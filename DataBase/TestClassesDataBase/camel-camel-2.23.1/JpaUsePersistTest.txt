/** 
 * @version 
 */
public class JpaUsePersistTest extends AbstractJpaMethodTest {
  @Rule public ExpectedException expectedException=ExpectedException.none();
  public boolean usePersist(){
    return true;
  }
  @Test public void produceExistingEntityShouldThrowAnException() throws Exception {
    setUp("jpa://" + Order.class.getName() + "?usePersist=true");
    Order order=createOrder();
    save(order);
    order=createOrder();
    order.setProductName("Cheese");
    order.setProductSku("54321");
    order.setQuantity(2);
    expectedException.expectCause(CoreMatchers.instanceOf(PersistenceException.class));
    template.requestBody(endpoint,order);
    assertEntitiesInDatabase(1,Order.class.getName());
  }
  private Order createOrder(){
    Order order=new Order();
    order.setId(1L);
    order.setProductName("Beer");
    order.setProductSku("12345");
    order.setQuantity(5);
    return order;
  }
}
