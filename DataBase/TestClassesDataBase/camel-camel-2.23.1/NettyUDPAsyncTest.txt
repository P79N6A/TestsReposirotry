public class NettyUDPAsyncTest extends BaseNettyTest {
  private void sendFile(  String uri) throws Exception {
    template.send(uri,new Processor(){
      public void process(      Exchange exchange) throws Exception {
        byte[] buffer=exchange.getContext().getTypeConverter().mandatoryConvertTo(byte[].class,new File("src/test/resources/test.txt"));
        exchange.setProperty(Exchange.CHARSET_NAME,"ASCII");
        exchange.getIn().setBody(buffer);
      }
    }
);
  }
  @Test public void testUDPInOnlyWithNettyConsumer() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    mock.message(0).body().startsWith("Song Of A Dream".getBytes());
    sendFile("netty4:udp://localhost:{{port}}?sync=false");
    mock.assertIsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("netty4:udp://localhost:{{port}}?sync=false").to("mock:result").to("log:Message");
      }
    }
;
  }
}
