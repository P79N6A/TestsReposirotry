/** 
 * Test that verifies JMX properties can be configured via Spring.
 * @version 
 */
public class JMXAgentTest extends DefaultJMXAgentTest {
  protected final String jmxServiceUrl="service:jmx:rmi:///jndi/rmi://localhost:" + getPort() + "/jmxrmi/camel";
  protected JMXConnector clientConnector;
  protected int getPort(){
    return 20008;
  }
  @Override @After public void tearDown() throws Exception {
    if (clientConnector != null) {
      try {
        clientConnector.close();
      }
 catch (      Exception e) {
      }
      clientConnector=null;
    }
    super.tearDown();
  }
  @Override protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/spring/jmxConfig.xml");
  }
  @Override protected MBeanServerConnection getMBeanConnection() throws Exception {
    if (mbsc == null) {
      if (clientConnector == null) {
        clientConnector=JMXConnectorFactory.connect(new JMXServiceURL(jmxServiceUrl),null);
      }
      mbsc=clientConnector.getMBeanServerConnection();
    }
    return mbsc;
  }
}
