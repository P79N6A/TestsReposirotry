/** 
 */
public class BaseMinaTest extends CamelTestSupport {
  private static volatile int port;
  @BeforeClass public static void initPort() throws Exception {
    port=AvailablePortFinder.getNextAvailable();
  }
  @AfterClass public static void savePort() throws Exception {
    File file=new File("target/minaport.txt");
    FileOutputStream fos=new FileOutputStream(file,false);
    try {
      fos.write(String.valueOf(port).getBytes());
    }
  finally {
      IOHelper.close(fos);
    }
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    context.addComponent("properties",new PropertiesComponent("ref:prop"));
    return context;
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    Properties prop=new Properties();
    prop.setProperty("port","" + getPort());
    jndi.bind("prop",prop);
    return jndi;
  }
  protected int getNextPort(){
    port=AvailablePortFinder.getNextAvailable();
    return port;
  }
  protected int getPort(){
    return port;
  }
}
