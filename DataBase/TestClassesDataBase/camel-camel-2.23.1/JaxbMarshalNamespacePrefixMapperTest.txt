/** 
 */
public class JaxbMarshalNamespacePrefixMapperTest extends CamelTestSupport {
  @Override protected JndiRegistry createRegistry() throws Exception {
    Map<String,String> map=new HashMap<>();
    map.put("http://www.camel.apache.org/jaxb/example/order/1","o");
    map.put("http://www.camel.apache.org/jaxb/example/address/1","a");
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("myPrefix",map);
    return jndi;
  }
  @Test public void testNamespacePrefix() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    Order order=new Order();
    order.setId("1");
    Address address=new Address();
    address.setStreet("Main Street");
    address.setStreetNumber("3a");
    address.setZip("65843");
    address.setCity("Sulzbach");
    order.setAddress(address);
    template.sendBody("direct:start",order);
    assertMockEndpointsSatisfied();
    String xml=mock.getExchanges().get(0).getIn().getBody(String.class);
    log.info(xml);
    assertTrue(xml.contains("xmlns:a=\"http://www.camel.apache.org/jaxb/example/address/1\""));
    assertTrue(xml.contains("xmlns:o=\"http://www.camel.apache.org/jaxb/example/order/1\""));
    assertTrue(xml.contains("<o:id>1</o:id>"));
    assertTrue(xml.contains("<a:street>Main Street</a:street>"));
    assertTrue(xml.contains("</o:order>"));
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        JaxbDataFormat df=new JaxbDataFormat();
        df.setContextPath("org.apache.camel.example");
        df.setNamespacePrefixRef("myPrefix");
        from("direct:start").marshal(df).to("mock:result");
      }
    }
;
  }
}
