public class CxfConsumerWSRMTest extends CamelBlueprintTestSupport {
  private static final QName SERVICE_NAME=new QName("http://apache.org/hello_world_soap_http","SOAPService");
  private static final QName PORT_NAME=new QName("http://apache.org/hello_world_soap_http","SoapPort");
  @Override protected Properties useOverridePropertiesWithPropertiesComponent(){
    Properties extra=new Properties();
    extra.put("router.address","http://localhost:" + CXFTestSupport.getPort1() + "/CxfConsumerWSRMTest/router");
    return extra;
  }
  @Override protected String getBlueprintDescriptor(){
    return "org/apache/camel/test/cxf/blueprint/CxfConsumerWSRMBeans.xml";
  }
  public boolean isCreateCamelContextPerClass(){
    return true;
  }
  @Test public void testInvokeGreeter() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    Bus clientBus=context.getRegistry().lookupByNameAndType("client-bus",Bus.class);
    assertNotNull(clientBus);
    BusFactory.setThreadDefaultBus(clientBus);
    try {
      Service service=Service.create(SERVICE_NAME);
      service.addPort(PORT_NAME,"http://schemas.xmlsoap.org/soap/","http://localhost:" + CXFTestSupport.getPort1() + "/CxfConsumerWSRMTest/router");
      Greeter greeter=service.getPort(PORT_NAME,Greeter.class);
      greeter.greetMeOneWay("test");
    }
  finally {
      BusFactory.setThreadDefaultBus(null);
    }
    assertMockEndpointsSatisfied();
  }
}
