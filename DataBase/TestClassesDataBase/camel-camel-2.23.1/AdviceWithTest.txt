@RunWith(CamelSpringBootRunner.class) @UseAdviceWith @SpringBootApplication @SpringBootTest(classes=AdviceWithTest.class) public class AdviceWithTest {
  @Autowired ProducerTemplate producerTemplate;
  @Autowired ModelCamelContext camelContext;
  @Test public void shouldMockEndpoints() throws Exception {
    assertFalse(camelContext.getStatus().isStarted());
    camelContext.getRouteDefinitions().get(0).adviceWith(camelContext,new AdviceWithRouteBuilder(){
      @Override public void configure() throws Exception {
        replaceFromWith("seda:start");
        weaveAddLast().to("mock:result");
      }
    }
);
    camelContext.start();
    MockEndpoint mock=camelContext.getEndpoint("mock:result",MockEndpoint.class);
    String msg="msg";
    mock.expectedBodiesReceived(msg);
    producerTemplate.sendBody("seda:start",msg);
    mock.assertIsSatisfied();
  }
}
