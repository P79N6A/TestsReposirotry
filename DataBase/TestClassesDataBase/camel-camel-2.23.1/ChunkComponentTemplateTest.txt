/** 
 * Unit test for  {@link ChunkComponent} and {@link ChunkEndpoint}
 */
public class ChunkComponentTemplateTest extends CamelTestSupport {
  @EndpointInject(uri="mock:endSimple") protected MockEndpoint endSimpleMock;
  @Produce(uri="direct:startSimple") protected ProducerTemplate startSimpleProducerTemplate;
  /** 
 * Test using code Template header
 */
  @Test public void testChunkWithTemplateHeader() throws Exception {
    Exchange exchange=createExchangeWithBody("The Body");
    exchange.getIn().setHeader("someHeader","Some Header");
    exchange.getIn().setHeader(ChunkConstants.CHUNK_TEMPLATE,"Body='{$body}'|SomeHeader='{$headers.someHeader}'");
    endSimpleMock.expectedMessageCount(1);
    endSimpleMock.expectedBodiesReceived("Body='The Body'|SomeHeader='Some Header'");
    startSimpleProducerTemplate.send(exchange);
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure(){
        from("direct:startSimple").to("chunk://hello").to("mock:endSimple");
      }
    }
;
  }
}
