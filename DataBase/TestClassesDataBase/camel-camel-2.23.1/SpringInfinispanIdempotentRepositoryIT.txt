public class SpringInfinispanIdempotentRepositoryIT extends CamelSpringTestSupport {
  @Override protected AbstractApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/component/infinispan/processor/idempotent/SpringInfinispanIdempotentRepositoryIT.xml");
  }
  @Test public void testIdempotent() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    String messageId=UUID.randomUUID().toString();
    for (int i=0; i < 5; i++) {
      template.sendBodyAndHeader("direct:start",UUID.randomUUID().toString(),"MessageId",messageId);
    }
    mock.assertIsSatisfied();
  }
}
