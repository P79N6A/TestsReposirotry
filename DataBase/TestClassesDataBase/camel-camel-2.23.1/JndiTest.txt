/** 
 * @version 
 */
public class JndiTest extends TestSupport {
  protected Context context;
  public static Context createInitialContext() throws Exception {
    InputStream in=JndiTest.class.getClassLoader().getResourceAsStream("jndi-example.properties");
    try {
      assertNotNull("Cannot find jndi-example.properties on the classpath!",in);
      Properties properties=new Properties();
      properties.load(in);
      return new InitialContext(new Hashtable<>(properties));
    }
  finally {
      IOHelper.close(in);
    }
  }
  @Test public void testLookupOfSimpleName() throws Exception {
    Object value=assertLookup("foo");
    assertEquals("foo","bar",value);
  }
  @Test public void testLookupOfTypedObject() throws Exception {
    Object value=assertLookup("example");
    ExampleBean bean=assertIsInstanceOf(ExampleBean.class,value);
    assertEquals("Bean.name","James",bean.getName());
    assertEquals("Bean.price",2.34d,bean.getPrice(),1e-5d);
    log.info("Found bean: " + bean);
  }
  protected Object assertLookup(  String name) throws NamingException {
    Object value=context.lookup(name);
    assertNotNull("Should have found JNDI entry: " + name + " in context: "+ context,value);
    return value;
  }
  @Before public void setUp() throws Exception {
    super.setUp();
    context=createInitialContext();
  }
}
