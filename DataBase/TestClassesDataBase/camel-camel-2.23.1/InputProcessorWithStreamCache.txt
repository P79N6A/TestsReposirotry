public static class InputProcessorWithStreamCache implements Processor {
  private final int number;
  public InputProcessorWithStreamCache(  int number){
    this.number=number;
  }
  @Override public void process(  Exchange exchange) throws Exception {
    CachedOutputStream cos=new CachedOutputStream(exchange);
    String s="Test Message " + number;
    cos.write(s.getBytes(Charset.forName("UTF-8")));
    cos.close();
    InputStream is=(InputStream)cos.newStreamCache();
    exchange.getOut().setBody(is);
  }
}
