public class JibxDataFormatUnmarshallWithDynamicClass extends CamelTestSupport {
  @Test public void testUnmarshallWithDynamicClass() throws InterruptedException, ParserConfigurationException, IOException, SAXException {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    String name="foo";
    double price=1;
    double amount=2;
    String purchaseOrderXml=String.format("<order2 name='%s' price='%s' amount='%s' />",name,price + "",amount + "");
    template.sendBody("direct:start",purchaseOrderXml);
    assertMockEndpointsSatisfied();
    PurchaseOrder2 body=mock.getReceivedExchanges().get(0).getIn().getBody(PurchaseOrder2.class);
    assertEquals(name,body.getName());
    assertEquals(price,body.getPrice(),1);
    assertEquals(amount,body.getAmount(),1);
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:start").setHeader(JibxDataFormat.UNMARSHALL_CLASS,constant(PurchaseOrder2.class)).unmarshal(new JibxDataFormat(PurchaseOrder.class)).convertBodyTo(PurchaseOrder2.class).to("mock:result");
      }
    }
;
  }
}
