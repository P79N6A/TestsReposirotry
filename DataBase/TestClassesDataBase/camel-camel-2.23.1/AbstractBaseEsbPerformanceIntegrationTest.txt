public abstract class AbstractBaseEsbPerformanceIntegrationTest extends CamelBlueprintTestSupport {
  protected Server server;
  protected String payload;
  protected int count=10000;
  @Before @Override public void setUp() throws Exception {
    server=new Server(9000);
    ServerConnector connector0=new ServerConnector(server);
    connector0.setReuseAddress(true);
    server.setConnectors(new Connector[]{connector0});
    ServletContextHandler context=new ServletContextHandler(ServletContextHandler.SESSIONS);
    context.setContextPath("/service");
    server.setHandler(context);
    context.addServlet(new ServletHolder(new EchoService()),"/EchoService");
    server.start();
    payload=readPayload();
    super.setUp();
  }
  @After @Override public void tearDown() throws Exception {
    super.tearDown();
    server.stop();
  }
  protected String readPayload() throws IOException {
    return IOUtils.toString(getClass().getResourceAsStream("/1K_buyStocks.xml"));
  }
  protected void send(  String endpointUri,  int messagesToSend){
    template.setDefaultEndpointUri(endpointUri);
    Map<String,Object> headers=new HashMap<>();
    headers.put("Content-Type","text/xml;charset=UTF-8");
    headers.put("SOAPAction","urn:buyStocks.2");
    headers.put("routing","xadmin;server1;community#1.0##");
    for (int i=0; i < messagesToSend; i++) {
      template.requestBodyAndHeaders(payload,headers);
    }
  }
}
