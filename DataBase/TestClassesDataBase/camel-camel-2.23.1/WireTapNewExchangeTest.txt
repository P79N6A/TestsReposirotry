/** 
 * @version 
 */
public class WireTapNewExchangeTest extends ContextTestSupport {
  @Test public void testFireAndForgetUsingExpressions() throws Exception {
    MockEndpoint result=getMockEndpoint("mock:result");
    result.expectedBodiesReceived("Hello World");
    MockEndpoint tap=getMockEndpoint("mock:tap");
    tap.expectedBodiesReceived("Bye World");
    tap.expectedHeaderReceived("id",123);
    String today=new SimpleDateFormat("yyyyMMdd").format(new Date());
    tap.expectedHeaderReceived("date",today);
    template.sendBody("direct:start","Hello World");
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").wireTap("direct:tap").newExchangeBody(constant("Bye World")).newExchangeHeader("id",constant(123)).newExchangeHeader("date",simple("${date:now:yyyyMMdd}")).end().to("mock:result");
        from("direct:tap").to("mock:tap");
      }
    }
;
  }
}
