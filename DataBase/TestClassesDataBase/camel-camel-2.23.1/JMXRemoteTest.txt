/** 
 * Tests against a "remote" JMX server. Creates an RMI Registry on or near port 39000 and registers the simple mbean <p/> Only test here is the notification test since everything should work the same as the platform server. May want to refactor the existing tests to run the full suite on the local platform and this "remote" setup.
 */
public class JMXRemoteTest extends SimpleBeanFixture {
  JMXServiceURL url;
  JMXConnectorServer connector;
  Registry registry;
  @After public void tearDown() throws Exception {
    super.tearDown();
    connector.stop();
  }
  @Override protected void initServer() throws Exception {
    int port=AvailablePortFinder.getNextAvailable(39000);
    registry=LocateRegistry.createRegistry(port);
    url=new JMXServiceURL("service:jmx:rmi:///jndi/rmi://localhost:" + port + "/"+ DOMAIN);
    server=MBeanServerFactory.createMBeanServer(DOMAIN);
    connector=JMXConnectorServerFactory.newJMXConnectorServer(url,Collections.<String,Object>emptyMap(),server);
    connector.start();
  }
  @Override protected JMXUriBuilder buildFromURI(){
    String uri=url.toString();
    return super.buildFromURI().withServerName(uri);
  }
  @Test public void notification() throws Exception {
    getSimpleMXBean().touch();
    getMockFixture().waitForMessages();
    getMockFixture().assertMessageReceived(new File("src/test/resources/consumer-test/touched.xml"));
  }
}
