/** 
 * Unit test for delayer interceptor configured in spring XML.
 */
public class DelayerInterceptorTest extends SpringTestSupport {
  protected AbstractXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("/org/apache/camel/spring/interceptor/delayerInterceptorTest.xml");
  }
  @Test public void testDelayer() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(10);
    long start=System.currentTimeMillis();
    for (int i=0; i < 10; i++) {
      template.sendBody("direct:start","Message #" + i);
    }
    long delta=System.currentTimeMillis() - start;
    assertMockEndpointsSatisfied();
    assertTrue("Should not be that fast to run: " + delta,delta > 100);
    assertTrue("Should not take that long to run: " + delta,delta < 5000);
  }
}
