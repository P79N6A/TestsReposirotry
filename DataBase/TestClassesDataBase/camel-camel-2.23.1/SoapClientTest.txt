/** 
 * Test that uses a dynamic proxy for CustomerService to send a request as SOAP and work with a static return SOAP message.
 */
public class SoapClientTest extends CamelTestSupport {
  @Produce(uri="direct:start") CustomerService customerService;
  @Test public void testRoundTripGetCustomersByName() throws Exception {
    GetCustomersByNameResponse response=customerService.getCustomersByName(new GetCustomersByName());
    assertEquals(1,response.getReturn().size());
    Customer firstCustomer=response.getReturn().get(0);
    assertEquals(100000.0,firstCustomer.getRevenue(),0.0D);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      String jaxbPackage=GetCustomersByName.class.getPackage().getName();
      @Override public void configure() throws Exception {
        ElementNameStrategy elNameStrat=new ServiceInterfaceStrategy(CustomerService.class,true);
        SoapJaxbDataFormat soapDataFormat=new SoapJaxbDataFormat(jaxbPackage,elNameStrat);
        final InputStream in=this.getClass().getResourceAsStream("response.xml");
        from("direct:start").marshal(soapDataFormat).process(new FileReplyProcessor(in)).unmarshal(soapDataFormat);
      }
    }
;
  }
}
