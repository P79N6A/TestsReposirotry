public class CxfRsConvertBodyToTest extends CamelTestSupport {
  private static final String PUT_REQUEST="<Customer><name>Mary</name><id>123</id></Customer>";
  private static final String CXT=CXFTestSupport.getPort1() + "/CxfRsConvertBodyToTest";
  private static final String CXF_RS_ENDPOINT_URI="cxfrs://http://localhost:" + CXT + "/rest?resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerService";
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        Response ok=Response.ok().build();
        from(CXF_RS_ENDPOINT_URI).convertBodyTo(Customer.class).to("mock:result").transform(constant(ok));
      }
    }
;
  }
  @Test public void testPutConsumer() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    mock.message(0).body().isInstanceOf(Customer.class);
    HttpPut put=new HttpPut("http://localhost:" + CXT + "/rest/customerservice/customers");
    StringEntity entity=new StringEntity(PUT_REQUEST,"ISO-8859-1");
    entity.setContentType("text/xml; charset=ISO-8859-1");
    put.addHeader("test","header1;header2");
    put.setEntity(entity);
    CloseableHttpClient httpclient=HttpClientBuilder.create().build();
    try {
      HttpResponse response=httpclient.execute(put);
      assertEquals(200,response.getStatusLine().getStatusCode());
      assertEquals("",EntityUtils.toString(response.getEntity()));
    }
  finally {
      httpclient.close();
    }
  }
}
