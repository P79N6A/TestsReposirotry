public class CxfRsConsumerWithBeanTest extends CamelTestSupport {
  private static final String CXT=CXFTestSupport.getPort1() + "/CxfRsConsumerWithBeanTest";
  private static final String CXF_RS_ENDPOINT_URI="cxfrs://http://localhost:" + CXT + "/rest?resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerServiceResource";
  private static final String CXF_RS_ENDPOINT_URI_2="cxfrs://http://localhost:" + CXT + "/rest2?resourceClasses=org.apache.camel.component.cxf.jaxrs.testbean.CustomerServiceResource";
  @Override protected Context createJndiContext() throws Exception {
    Context context=super.createJndiContext();
    context.bind("service",new ServiceUtil());
    return context;
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        from(CXF_RS_ENDPOINT_URI).to("bean://service?multiParameterArray=true");
        from(CXF_RS_ENDPOINT_URI_2).bean(ServiceUtil.class,"invoke",true);
      }
    }
;
  }
  @Test public void testPutConsumer() throws Exception {
    sendPutRequest("http://localhost:" + CXT + "/rest/customerservice/c20");
    sendPutRequest("http://localhost:" + CXT + "/rest2/customerservice/c20");
  }
  private void sendPutRequest(  String uri) throws Exception {
    HttpPut put=new HttpPut(uri);
    StringEntity entity=new StringEntity("string");
    entity.setContentType("text/plain");
    put.setEntity(entity);
    CloseableHttpClient httpclient=HttpClientBuilder.create().build();
    try {
      HttpResponse response=httpclient.execute(put);
      assertEquals(200,response.getStatusLine().getStatusCode());
      assertEquals("c20string",EntityUtils.toString(response.getEntity()));
    }
  finally {
      httpclient.close();
    }
  }
}
