public class HazelcastReliableTopicProducerTest extends HazelcastCamelTestSupport {
  @Mock private ITopic<String> reliableTopic;
  @Override protected void trainHazelcastInstance(  HazelcastInstance hazelcastInstance){
    when(hazelcastInstance.<String>getReliableTopic("bar")).thenReturn(reliableTopic);
  }
  @Override protected void verifyHazelcastInstance(  HazelcastInstance hazelcastInstance){
    verify(hazelcastInstance,atLeastOnce()).getReliableTopic("bar");
  }
  @After public void verifyQueueMock(){
    verifyNoMoreInteractions(reliableTopic);
  }
  @Test(expected=CamelExecutionException.class) public void testWithInvalidOperation(){
    template.sendBody("direct:publishInvalid","foo");
  }
  @Test public void noOperation(){
    template.sendBody("direct:no-operation","bar");
    verify(reliableTopic).publish("bar");
  }
  @Test public void publish(){
    template.sendBody("direct:publish","bar");
    verify(reliableTopic).publish("bar");
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:no-operation").to(String.format("hazelcast-%sbar?reliable=true",HazelcastConstants.TOPIC_PREFIX));
        from("direct:publishInvalid").setHeader(HazelcastConstants.OPERATION,constant("bogus")).to(String.format("hazelcast-%sbar?reliable=true",HazelcastConstants.TOPIC_PREFIX));
        from("direct:publish").setHeader(HazelcastConstants.OPERATION,constant(HazelcastOperation.PUBLISH)).to(String.format("hazelcast-%sbar?reliable=true",HazelcastConstants.TOPIC_PREFIX));
      }
    }
;
  }
}
