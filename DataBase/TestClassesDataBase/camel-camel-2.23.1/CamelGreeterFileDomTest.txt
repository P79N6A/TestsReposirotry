@ContextConfiguration public class CamelGreeterFileDomTest extends AbstractJUnit4SpringContextTests {
  private static final Logger LOG=LoggerFactory.getLogger(CamelGreeterFileDomTest.class);
  private static final String REQUEST="<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">" + "<soap:Body><greetMe xmlns=\"http://apache.org/hello_world_soap_http/types\">" + "<requestType>Willem</requestType></greetMe></soap:Body></soap:Envelope>";
  private static Endpoint endpoint;
  private static int port=AvailablePortFinder.getNextAvailable(20003);
static {
    System.setProperty("CamelGreeterFileDomTest.port",Integer.toString(port));
  }
  @Autowired protected CamelContext camelContext;
  @BeforeClass public static void startServer() throws Exception {
    Object implementor=new GreeterImpl();
    String address="http://localhost:" + port + "/SoapContext/SoapPort";
    endpoint=Endpoint.publish(address,implementor);
    LOG.info("The WS endpoint is published! ");
  }
  @AfterClass public static void stopServer() throws Exception {
    if (endpoint != null) {
      endpoint.stop();
      endpoint=null;
    }
  }
  @Test public void testCamelGreeter() throws Exception {
    TestSupport.deleteDirectory("target/greeter/response");
    assertNotNull(camelContext);
    ProducerTemplate template=camelContext.createProducerTemplate();
    Object result=template.requestBody("direct:start",REQUEST);
    template.stop();
    assertEquals("The result is wrong.","Hello Willem",result);
    File file=new File("target/greeter/response/response.txt");
    assertTrue("File " + file + " should be there.",file.exists());
  }
}
