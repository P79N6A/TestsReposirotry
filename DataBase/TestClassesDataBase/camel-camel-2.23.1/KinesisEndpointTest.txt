@RunWith(MockitoJUnitRunner.class) public class KinesisEndpointTest {
  @Mock private AmazonKinesis amazonKinesisClient;
  private CamelContext camelContext;
  @Before public void setup() throws Exception {
    SimpleRegistry registry=new SimpleRegistry();
    registry.put("kinesisClient",amazonKinesisClient);
    camelContext=new DefaultCamelContext(registry);
  }
  @Test public void allTheEndpointParams() throws Exception {
    KinesisEndpoint endpoint=(KinesisEndpoint)camelContext.getEndpoint("aws-kinesis://some_stream_name" + "?amazonKinesisClient=#kinesisClient" + "&maxResultsPerRequest=101"+ "&iteratorType=latest"+ "&shardId=abc"+ "&sequenceNumber=123");
    assertThat(endpoint.getConfiguration().getAmazonKinesisClient(),is(amazonKinesisClient));
    assertThat(endpoint.getConfiguration().getStreamName(),is("some_stream_name"));
    assertThat(endpoint.getConfiguration().getIteratorType(),is(ShardIteratorType.LATEST));
    assertThat(endpoint.getConfiguration().getMaxResultsPerRequest(),is(101));
    assertThat(endpoint.getConfiguration().getSequenceNumber(),is("123"));
    assertThat(endpoint.getConfiguration().getShardId(),is("abc"));
  }
  @Test public void onlyRequiredEndpointParams() throws Exception {
    KinesisEndpoint endpoint=(KinesisEndpoint)camelContext.getEndpoint("aws-kinesis://some_stream_name" + "?amazonKinesisClient=#kinesisClient");
    assertThat(endpoint.getConfiguration().getAmazonKinesisClient(),is(amazonKinesisClient));
    assertThat(endpoint.getConfiguration().getStreamName(),is("some_stream_name"));
    assertThat(endpoint.getConfiguration().getIteratorType(),is(ShardIteratorType.TRIM_HORIZON));
    assertThat(endpoint.getConfiguration().getMaxResultsPerRequest(),is(1));
  }
  @Test public void afterSequenceNumberRequiresSequenceNumber() throws Exception {
    KinesisEndpoint endpoint=(KinesisEndpoint)camelContext.getEndpoint("aws-kinesis://some_stream_name" + "?amazonKinesisClient=#kinesisClient" + "&iteratorType=AFTER_SEQUENCE_NUMBER"+ "&shardId=abc"+ "&sequenceNumber=123");
    assertThat(endpoint.getConfiguration().getAmazonKinesisClient(),is(amazonKinesisClient));
    assertThat(endpoint.getConfiguration().getStreamName(),is("some_stream_name"));
    assertThat(endpoint.getConfiguration().getIteratorType(),is(ShardIteratorType.AFTER_SEQUENCE_NUMBER));
    assertThat(endpoint.getConfiguration().getShardId(),is("abc"));
    assertThat(endpoint.getConfiguration().getSequenceNumber(),is("123"));
  }
  @Test public void atSequenceNumberRequiresSequenceNumber() throws Exception {
    KinesisEndpoint endpoint=(KinesisEndpoint)camelContext.getEndpoint("aws-kinesis://some_stream_name" + "?amazonKinesisClient=#kinesisClient" + "&iteratorType=AT_SEQUENCE_NUMBER"+ "&shardId=abc"+ "&sequenceNumber=123");
    assertThat(endpoint.getConfiguration().getAmazonKinesisClient(),is(amazonKinesisClient));
    assertThat(endpoint.getConfiguration().getStreamName(),is("some_stream_name"));
    assertThat(endpoint.getConfiguration().getIteratorType(),is(ShardIteratorType.AT_SEQUENCE_NUMBER));
    assertThat(endpoint.getConfiguration().getShardId(),is("abc"));
    assertThat(endpoint.getConfiguration().getSequenceNumber(),is("123"));
  }
}
