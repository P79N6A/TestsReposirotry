/** 
 */
public class HttpJmsAsyncTimeoutTest extends HttpAsyncTestSupport {
  @Test public void testHttpJmsAsync() throws Exception {
    try {
      template.requestBody("http://0.0.0.0:" + getPort() + "/myservice","Hello World",String.class);
      fail("Should have thrown exception");
    }
 catch (    CamelExecutionException e) {
      HttpOperationFailedException cause=assertIsInstanceOf(HttpOperationFailedException.class,e.getCause());
      assertEquals(504,cause.getStatusCode());
    }
  }
  @Override protected Context createJndiContext() throws Exception {
    JndiContext answer=new JndiContext();
    ConnectionFactory connectionFactory=CamelJmsTestHelper.createConnectionFactory();
    JmsComponent amq=jmsComponentAutoAcknowledge(connectionFactory);
    amq.setCamelContext(context);
    answer.bind("jms",amq);
    return answer;
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        fromF("jetty:http://0.0.0.0:%s/myservice?continuationTimeout=2000",getPort()).to("jms:queue:foo?requestTimeout=5000");
        from("jms:queue:foo").delayer(10000).transform(constant("Bye World"));
      }
    }
;
  }
}
