/** 
 * To unit test CAMEL-364.
 */
public class MinaTcpWithIoOutProcessorExceptionTest extends BaseMinaTest {
  @Test public void testExceptionThrownInProcessor(){
    String body="Hello World";
    Object result=template.requestBody("mina:tcp://localhost:{{port}}?textline=true&sync=true",body);
    assertNotNull("the result should not be null",result);
    assertEquals("result is IllegalArgumentException",result,"java.lang.IllegalArgumentException: Forced exception");
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        errorHandler(defaultErrorHandler().maximumRedeliveries(2));
        from("mina:tcp://localhost:{{port}}?textline=true&sync=true").process(new Processor(){
          public void process(          Exchange e){
            assertEquals("Hello World",e.getIn().getBody(String.class));
            throw new IllegalArgumentException("Forced exception");
          }
        }
);
      }
    }
;
  }
}
