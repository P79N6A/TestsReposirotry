@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations={"/SpringTest.xml"}) public class UndertowHttpsSpringTest {
  private Integer port;
  @Produce private ProducerTemplate template;
  @EndpointInject(uri="mock:input") private MockEndpoint mockEndpoint;
  @BeforeClass public static void setUpJaas() throws Exception {
    URL trustStoreUrl=UndertowHttpsSpringTest.class.getClassLoader().getResource("ssl/keystore.jks");
    System.setProperty("javax.net.ssl.trustStore",trustStoreUrl.toURI().getPath());
  }
  @AfterClass public static void tearDownJaas() throws Exception {
    System.clearProperty("java.security.auth.login.config");
  }
  @Test public void testSSLConsumer() throws Exception {
    mockEndpoint.expectedBodiesReceived("Hello World");
    String out=template.requestBody("undertow:https://localhost:" + port + "/spring?sslContextParameters=#sslClient","Hello World",String.class);
    assertEquals("Bye World",out);
    mockEndpoint.assertIsSatisfied();
  }
  public Integer getPort(){
    return port;
  }
  @Resource(name="dynaPort") public void setPort(  Integer port){
    this.port=port;
  }
}
