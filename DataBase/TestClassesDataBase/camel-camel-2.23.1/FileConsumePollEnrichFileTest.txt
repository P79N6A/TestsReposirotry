public class FileConsumePollEnrichFileTest extends ContextTestSupport {
  @Override @Before public void setUp() throws Exception {
    deleteDirectory("target/enrich");
    deleteDirectory("target/enrichdata");
    super.setUp();
  }
  @Test public void testPollEnrich() throws Exception {
    getMockEndpoint("mock:start").expectedBodiesReceived("Start");
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedBodiesReceived("Big file");
    mock.expectedFileExists("target/enrich/.done/AAA.fin");
    mock.expectedFileExists("target/enrichdata/.done/AAA.dat");
    template.sendBodyAndHeader("file://target/enrich","Start",Exchange.FILE_NAME,"AAA.fin");
    log.info("Sleeping for 1/4 sec before writing enrichdata file");
    Thread.sleep(250);
    template.sendBodyAndHeader("file://target/enrichdata","Big file",Exchange.FILE_NAME,"AAA.dat");
    log.info("... write done");
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("file://target/enrich?initialDelay=0&delay=10&move=.done").to("mock:start").pollEnrich("file://target/enrichdata?initialDelay=0&delay=10&move=.done",1000).to("mock:result");
      }
    }
;
  }
}
