/** 
 * Simple unit test for transaction client EIP pattern and JMS.
 */
public class JMSTransactionalClientWithRollbackTest extends CamelSpringTestSupport {
  protected ClassPathXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("/org/apache/camel/component/jms/tx/JMSTransactionalClientWithRollbackTest.xml");
  }
  @Test public void testTransactionSuccess() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    mock.expectedBodiesReceived("Bye World");
    mock.message(0).header("count").isEqualTo(3);
    template.sendBody("activemq:queue:okay","Hello World");
    mock.assertIsSatisfied();
  }
public static class MyProcessor implements Processor {
    private int count;
    public void process(    Exchange exchange) throws Exception {
      exchange.getIn().setBody("Bye World");
      exchange.getIn().setHeader("count",++count);
    }
  }
}
