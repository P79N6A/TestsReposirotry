public class NettyHttpMethodRestrictTest extends BaseNettyTest {
  private String getUrl(){
    return "http://localhost:" + getPort() + "/methodRestrict";
  }
  @Test public void testProperHttpMethod() throws Exception {
    HttpClient httpClient=new HttpClient();
    PostMethod httpPost=new PostMethod(getUrl());
    StringRequestEntity reqEntity=new StringRequestEntity("This is a test",null,null);
    httpPost.setRequestEntity(reqEntity);
    int status=httpClient.executeMethod(httpPost);
    assertEquals("Get a wrong response status",200,status);
    String result=httpPost.getResponseBodyAsString();
    assertEquals("Get a wrong result","This is a test response",result);
  }
  @Test public void testImproperHttpMethod() throws Exception {
    HttpClient httpClient=new HttpClient();
    GetMethod httpGet=new GetMethod(getUrl());
    int status=httpClient.executeMethod(httpGet);
    assertEquals("Get a wrong response status",405,status);
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("netty4-http:http://localhost:{{port}}/methodRestrict?httpMethodRestrict=POST").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            Message in=exchange.getIn();
            String request=in.getBody(String.class);
            exchange.getOut().setBody(request + " response");
          }
        }
);
      }
    }
;
  }
}
