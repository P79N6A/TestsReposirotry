/** 
 * Unit testing for using a CometdProducer and a CometdConsumer
 */
public class SslContextParametersCometdProducerConsumerTest extends CamelTestSupport {
  private int port;
  private String uri;
  @Test public void testProducer() throws Exception {
    Person person=new Person("David","Greco");
    template.requestBody("direct:input",person);
    MockEndpoint ep=context.getEndpoint("mock:test",MockEndpoint.class);
    List<Exchange> exchanges=ep.getReceivedExchanges();
    for (    Exchange exchange : exchanges) {
      Person person1=(Person)exchange.getIn().getBody();
      assertEquals("David",person1.getName());
      assertEquals("Greco",person1.getSurname());
    }
  }
  @Override @Before public void setUp() throws Exception {
    port=AvailablePortFinder.getNextAvailable(23500);
    uri="cometds://127.0.0.1:" + port + "/service/test?baseResource=file:./target/test-classes/webapp&"+ "timeout=240000&interval=0&maxInterval=30000&multiFrameInterval=1500&jsonCommented=true&logLevel=2";
    super.setUp();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        KeyStoreParameters ksp=new KeyStoreParameters();
        ksp.setResource("jsse/localhost.ks");
        ksp.setPassword("changeit");
        KeyManagersParameters kmp=new KeyManagersParameters();
        kmp.setKeyPassword("changeit");
        kmp.setKeyStore(ksp);
        TrustManagersParameters tmp=new TrustManagersParameters();
        tmp.setKeyStore(ksp);
        SSLContextParameters sslContextParameters=new SSLContextParameters();
        sslContextParameters.setKeyManagers(kmp);
        sslContextParameters.setTrustManagers(tmp);
        CometdComponent component=(CometdComponent)context.getComponent("cometds");
        component.setSslContextParameters(sslContextParameters);
        from("direct:input").to(uri);
        from(uri).to("mock:test");
      }
    }
;
  }
public static class Person {
    private String name;
    private String surname;
    Person(    String name,    String surname){
      this.name=name;
      this.surname=surname;
    }
    public String getName(){
      return name;
    }
    public String getSurname(){
      return surname;
    }
    public void setName(    String name){
      this.name=name;
    }
    public void setSurname(    String surname){
      this.surname=surname;
    }
  }
}
