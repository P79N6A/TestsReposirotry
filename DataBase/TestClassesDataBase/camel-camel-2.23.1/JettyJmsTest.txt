@ContextConfiguration public class JettyJmsTest extends AbstractJUnit4SpringContextTests {
  private static int port=AvailablePortFinder.getNextAvailable(20038);
  private static final String URL="jetty:http://localhost:" + port + "/test";
static {
    System.setProperty("JettyJmsTest.port",Integer.toString(port));
  }
  @Autowired protected CamelContext camelContext;
  @EndpointInject(uri="mock:resultEndpoint") protected MockEndpoint resultEndpoint;
  @Test public void testMocksAreValid() throws Exception {
    assertNotNull(resultEndpoint);
    resultEndpoint.reset();
    ProducerTemplate template=camelContext.createProducerTemplate();
    template.sendBodyAndHeader(URL,"Hello form Willem","Operation","greetMe");
    Thread.sleep(4000);
    template.stop();
    MockEndpoint.assertIsSatisfied(camelContext);
    List<Exchange> list=resultEndpoint.getReceivedExchanges();
    assertEquals("Should get one message",list.size(),1);
    for (    Exchange exchange : list) {
      Object result=exchange.getIn().getBody();
      assertEquals("Should get the request","Hello form Willem",result);
      assertEquals("Should get the header","greetMe",exchange.getIn().getHeader("Operation"));
    }
  }
}
