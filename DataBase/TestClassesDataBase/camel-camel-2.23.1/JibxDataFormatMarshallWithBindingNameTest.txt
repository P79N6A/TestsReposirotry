/** 
 * @version
 */
public class JibxDataFormatMarshallWithBindingNameTest extends CamelTestSupport {
  private static final String BINDING_NAME="purchaseOrder-jibx";
  @Test public void testMarshall() throws InterruptedException, ParserConfigurationException, IOException, SAXException {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMessageCount(1);
    PurchaseOrder purchaseOrder=new PurchaseOrder();
    String name="foo";
    purchaseOrder.setName(name);
    double price=49;
    purchaseOrder.setPrice(price);
    double amount=3;
    purchaseOrder.setAmount(amount);
    template.sendBody("direct:start",purchaseOrder);
    assertMockEndpointsSatisfied();
    String body=mock.getReceivedExchanges().get(0).getIn().getBody(String.class);
    DocumentBuilder builder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
    Element root=builder.parse(new InputSource(new StringReader(body))).getDocumentElement();
    assertEquals(name,root.getAttribute("name"));
    assertEquals(price + "",root.getAttribute("price"));
    assertEquals(amount + "",root.getAttribute("amount"));
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        JibxDataFormat jibxDataFormat=new JibxDataFormat(PurchaseOrder.class,BINDING_NAME);
        from("direct:start").marshal(jibxDataFormat).convertBodyTo(String.class).to("mock:result");
      }
    }
;
  }
}
