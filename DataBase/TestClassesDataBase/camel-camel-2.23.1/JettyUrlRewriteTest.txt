/** 
 */
public class JettyUrlRewriteTest extends BaseUrlRewriteTest {
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    HttpUrlRewrite myRewrite=new HttpUrlRewrite();
    myRewrite.setConfigFile("example/urlrewrite2.xml");
    jndi.bind("myRewrite",myRewrite);
    return jndi;
  }
  @Test public void testJettyUriRewrite() throws Exception {
    String out=template.requestBody("jetty:http://localhost:{{port}}/myapp/products/1234",null,String.class);
    assertEquals("http://localhost:" + getPort2() + "/myapp2/products/index.jsp?product_id=1234",out);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("jetty:http://localhost:{{port}}/myapp?matchOnUriPrefix=true").to("jetty:http://localhost:{{port2}}/myapp2?bridgeEndpoint=true&throwExceptionOnFailure=false&urlRewrite=#myRewrite");
        from("jetty:http://localhost:{{port2}}/myapp2?matchOnUriPrefix=true").transform().simple("${header.CamelHttpUrl}?${header.CamelHttpQuery}");
      }
    }
;
  }
}
