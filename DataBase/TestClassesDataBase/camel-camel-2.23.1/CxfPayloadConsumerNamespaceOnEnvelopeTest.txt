public class CxfPayloadConsumerNamespaceOnEnvelopeTest extends CamelTestSupport {
  protected static final String RESPONSE_PAYLOAD="<ns2:getTokenResponse xmlns:ns2=\"http://camel.apache.org/cxf/namespace\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">" + "<return xsi:type=\"xs:string\">Return Value</return></ns2:getTokenResponse>";
  protected static final String REQUEST_MESSAGE="<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">" + "<soap:Body><ns2:getToken xmlns:ns2=\"http://camel.apache.org/cxf/namespace\"><arg0 xsi:type=\"xs:string\">Send</arg0></ns2:getToken></soap:Body></soap:Envelope>";
  private AbstractXmlApplicationContext applicationContext;
static {
    CXFTestSupport.getPort1();
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    return SpringCamelContext.springCamelContext(applicationContext);
  }
  @Before public void setUp() throws Exception {
    applicationContext=new ClassPathXmlApplicationContext("org/apache/camel/component/cxf/GetTokenBeans.xml");
    super.setUp();
    assertNotNull("Should have created a valid spring context",applicationContext);
  }
  @After public void tearDown() throws Exception {
    IOHelper.close(applicationContext);
    super.tearDown();
  }
  @Override protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("direct:router").to("cxf:bean:serviceEndpoint?dataFormat=MESSAGE").convertBodyTo(String.class);
        from("cxf:bean:serviceEndpoint?dataFormat=PAYLOAD").convertBodyTo(String.class).convertBodyTo(Document.class).setBody().constant(RESPONSE_PAYLOAD);
      }
    }
;
  }
  @Test public void testInvokeRouter(){
    Object returnValue=template.requestBody("direct:router",REQUEST_MESSAGE);
    assertNotNull(returnValue);
    assertTrue(returnValue instanceof String);
    assertTrue(((String)returnValue).contains("Return Value"));
    assertTrue(((String)returnValue).contains("http://www.w3.org/2001/XMLSchema-instance"));
  }
}
