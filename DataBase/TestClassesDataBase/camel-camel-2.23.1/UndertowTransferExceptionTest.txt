public class UndertowTransferExceptionTest extends BaseUndertowTest {
  @Test public void getSerializedExceptionTest() throws IOException, ClassNotFoundException {
    HttpClient client=new HttpClient();
    GetMethod get=new GetMethod("http://localhost:" + getPort() + "/test/transfer");
    get.setRequestHeader("Accept","application/x-java-serialized-object");
    client.executeMethod(get);
    ObjectInputStream in=new ObjectInputStream(get.getResponseBodyAsStream());
    IllegalArgumentException e=(IllegalArgumentException)in.readObject();
    Assert.assertNotNull(e);
    Assert.assertEquals(500,get.getStatusCode());
    Assert.assertEquals("Camel cannot do this",e.getMessage());
  }
  @Override protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("undertow:http://localhost:" + getPort() + "/test/transfer?transferException=true").to("mock:input").throwException(new IllegalArgumentException("Camel cannot do this"));
      }
    }
;
  }
}
