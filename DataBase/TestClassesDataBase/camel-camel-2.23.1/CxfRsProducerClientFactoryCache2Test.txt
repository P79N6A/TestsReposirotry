/** 
 */
public class CxfRsProducerClientFactoryCache2Test extends Assert {
  private static int port2=CXFTestSupport.getPort("mySecurePort");
  private CamelContext context2;
  private ProducerTemplate template2;
  private AbstractApplicationContext applicationContext;
  @Before public void setUp() throws Exception {
    applicationContext=new ClassPathXmlApplicationContext("org/apache/camel/component/cxf/jaxrs/CxfRsProducerClientFactoryCacheTest2.xml");
    context2=SpringCamelContext.springCamelContext(applicationContext,false);
    context2.start();
    template2=context2.createProducerTemplate();
    template2.start();
  }
  @After public void tearDown() throws Exception {
    if (context2 != null) {
      context2.stop();
      template2.stop();
    }
    if (applicationContext != null) {
      applicationContext.close();
    }
  }
  @Test public void testGetCostumerWithHttpCentralClientAPI() throws Exception {
    doRunTest(template2,getPort2());
  }
  private void doRunTest(  ProducerTemplate template,  final int clientPort){
    Exchange exchange=template.request("direct://http",new Processor(){
      public void process(      Exchange exchange) throws Exception {
        exchange.setPattern(ExchangePattern.InOut);
        Message inMessage=exchange.getIn();
        inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_USING_HTTP_API,Boolean.TRUE);
        inMessage.setHeader(Exchange.HTTP_METHOD,"GET");
        inMessage.setHeader(Exchange.HTTP_PATH,"/customerservice/customers/123");
        inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS,Customer.class);
        inMessage.setHeader("clientPort",clientPort);
        inMessage.setBody(null);
      }
    }
);
    Customer response=(Customer)exchange.getOut().getBody();
    assertNotNull("The response should not be null ",response);
    assertEquals("Get a wrong customer id ",String.valueOf(response.getId()),"123");
    assertEquals("Get a wrong customer name",response.getName(),"John");
    assertEquals("Get a wrong response code",200,exchange.getOut().getHeader(Exchange.HTTP_RESPONSE_CODE));
  }
  public int getPort2(){
    return port2;
  }
}
