/** 
 * This test a timer endpoint in a route with Custom calendar.
 */
public class QuartzCustomCalendarNoFireTest extends BaseQuartzTest {
  @Test public void testQuartzCustomCronRouteNoFire() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedMinimumMessageCount(0);
    QuartzComponent component=context.getComponent("quartz2",QuartzComponent.class);
    Scheduler scheduler=component.getScheduler();
    Calendar c=scheduler.getCalendar(QuartzConstants.QUARTZ_CAMEL_CUSTOM_CALENDAR);
    Date now=new Date();
    java.util.Calendar tomorrow=java.util.Calendar.getInstance();
    tomorrow.setTime(now);
    tomorrow.add(java.util.Calendar.DAY_OF_MONTH,1);
    assertEquals(true,c.isTimeIncluded(tomorrow.getTimeInMillis()));
    assertEquals(false,c.isTimeIncluded(now.getTime()));
    assertMockEndpointsSatisfied();
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    HolidayCalendar cal=new HolidayCalendar();
    cal.addExcludedDate(new Date());
    jndi.bind("calendar",cal);
    return jndi;
  }
  @Override protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      public void configure(){
        from("quartz2://MyTimer?customCalendar=#calendar&cron=05+00+00+*+*+?").to("mock:result");
      }
    }
;
  }
}
