public class ApprovalExamplesIntegrationTest extends AbstractApprovalIntegrationTest {
  public ApprovalExamplesIntegrationTest(){
    super(3);
  }
  @Test public void example1(){
    final Map<String,String> body=new HashMap<>();
    body.put("contextId",accountIds.iterator().next());
    body.put("nextApproverIds",userId);
    final ApprovalResult result=template.requestBody("direct:example1",body,ApprovalResult.class);
    assertNotNull("Result should be received",result);
  }
  @Test public void example2(){
    final Map<String,String> body=new HashMap<>();
    body.put("contextId",accountIds.iterator().next());
    body.put("nextApproverIds",userId);
    final ApprovalResult result=template.requestBody("direct:example2",body,ApprovalResult.class);
    assertNotNull("Result should be received",result);
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    final JndiRegistry jndi=super.createRegistry();
    final ApprovalRequest approvalTemplate=new ApprovalRequest();
    approvalTemplate.setActionType(ApprovalRequest.Action.Submit);
    approvalTemplate.setComments("Sample approval template");
    approvalTemplate.setProcessDefinitionNameOrId("Test_Account_Process");
    approvalTemplate.setSkipEntryCriteria(true);
    jndi.bind("approvalTemplate",approvalTemplate);
    return jndi;
  }
  @Override protected RouteBuilder doCreateRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:example1").setHeader("approval.ContextId",simple("${body['contextId']}")).setHeader("approval.NextApproverIds",simple("${body['nextApproverIds']}")).to("salesforce:approval?" + "approvalActionType=Submit" + "&approvalComments=this is a test"+ "&approvalProcessDefinitionNameOrId=Test_Account_Process"+ "&approvalSkipEntryCriteria=true");
        from("direct:example2").setHeader("approval.ContextId",simple("${body['contextId']}")).setHeader("approval.NextApproverIds",simple("${body['nextApproverIds']}")).to("salesforce:approval?approval=#approvalTemplate");
      }
    }
;
  }
}
