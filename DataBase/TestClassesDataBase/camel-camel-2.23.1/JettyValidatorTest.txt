public class JettyValidatorTest extends CamelTestSupport {
  private int port;
  @Test public void testValidRequest() throws Exception {
    InputStream inputStream=this.getClass().getResourceAsStream("ValidRequest.xml");
    assertNotNull("the inputStream should not be null",inputStream);
    String response=template.requestBody("http://localhost:" + port + "/test",inputStream,String.class);
    assertEquals("The response should be ok",response,"<ok/>");
  }
  @Test public void testInvalidRequest() throws Exception {
    InputStream inputStream=this.getClass().getResourceAsStream("InvalidRequest.xml");
    assertNotNull("the inputStream should not be null",inputStream);
    String response=template.requestBody("http://localhost:" + port + "/test",inputStream,String.class);
    assertEquals("The response should be error",response,"<error/>");
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    port=AvailablePortFinder.getNextAvailable(8000);
    return new RouteBuilder(){
      public void configure(){
        from("jetty:http://localhost:" + port + "/test").convertBodyTo(String.class).to("log:in").doTry().to("validator:OptimizationRequest.xsd").transform(constant("<ok/>")).doCatch(ValidationException.class).transform(constant("<error/>")).end().to("log:out");
      }
    }
;
  }
}
