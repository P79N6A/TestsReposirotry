/** 
 */
@Ignore("Manual test") public class FtpCronScheduledRoutePolicyTest extends CamelTestSupport {
  protected FtpServer ftpServer;
  private String ftp="ftp:localhost:20128/myapp?password=admin&username=admin&delay=5s&idempotent=false&localWorkDirectory=target/tmp";
  @Test public void testFtpCronScheduledRoutePolicyTest() throws Exception {
    template.sendBodyAndHeader("file:res/home/myapp","Hello World",Exchange.FILE_NAME,"hello.txt");
    Thread.sleep(10 * 1000 * 60);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        CronScheduledRoutePolicy policy=new CronScheduledRoutePolicy();
        policy.setRouteStartTime("* 0/2 * * * ?");
        policy.setRouteStopTime("* 1/2 * * * ?");
        policy.setRouteStopGracePeriod(250);
        policy.setTimeUnit(TimeUnit.SECONDS);
        from(ftp).noAutoStartup().routePolicy(policy).shutdownRunningTask(ShutdownRunningTask.CompleteAllTasks).log("Processing ${file:name}").to("log:done");
      }
    }
;
  }
  @Before public void setUp() throws Exception {
    super.setUp();
    deleteDirectory("res");
    createDirectory("res/home/myapp");
    initFtpServer();
    ftpServer.start();
  }
  @After public void tearDown() throws Exception {
    super.tearDown();
    ftpServer.stop();
    ftpServer=null;
  }
  protected void initFtpServer() throws Exception {
    FtpServerFactory serverFactory=new FtpServerFactory();
    File file=new File("src/test/resources/users.properties");
    UserManager uman=new PropertiesUserManager(new ClearTextPasswordEncryptor(),file,"admin");
    serverFactory.setUserManager(uman);
    NativeFileSystemFactory fsf=new NativeFileSystemFactory();
    fsf.setCreateHome(true);
    serverFactory.setFileSystem(fsf);
    ListenerFactory factory=new ListenerFactory();
    factory.setPort(20128);
    serverFactory.addListener("default",factory.createListener());
    ftpServer=serverFactory.createServer();
  }
}
