public class BlueprintAddServiceTest extends CamelBlueprintTestSupport {
  private MyService myService=new MyService();
  @Override protected String getBlueprintDescriptor(){
    return "org/apache/camel/test/blueprint/BlueprintAddServiceTest.xml";
  }
  @Override protected void addServicesOnStartup(  Map<String,KeyValueHolder<Object,Dictionary>> services){
    services.put("myService",asService(myService,"beer","Carlsberg"));
  }
  @Test public void testAddService() throws Exception {
    getMockEndpoint("mock:result").expectedBodiesReceived("CamelCamel");
    template.sendBody("direct:start","Camel");
    assertMockEndpointsSatisfied();
    ServiceReference<?> ref=getBundleContext().getServiceReference("myService");
    assertEquals("Carlsberg",ref.getProperty("beer"));
    Object service=getBundleContext().getService(ref);
    assertSame(myService,service);
  }
}
