/** 
 * Test class for  {@link BoxSearchManager}APIs.
 */
public class BoxSearchManagerIntegrationTest extends AbstractBoxTestSupport {
  private static final Logger LOG=LoggerFactory.getLogger(BoxSearchManagerIntegrationTest.class);
  private static final String PATH_PREFIX=BoxApiCollection.getCollection().getApiName(BoxSearchManagerApiMethod.class).getName();
  private static final String CAMEL_TEST_FILE="/CamelTestFile.txt";
  private static final String CAMEL_TEST_FILE_NAME="CamelTestFile.txt";
  @Test public void testSearchFolder() throws Exception {
    final Map<String,Object> headers=new HashMap<>();
    headers.put("CamelBox.folderId","0");
    headers.put("CamelBox.query",CAMEL_TEST_FILE_NAME);
    @SuppressWarnings("rawtypes") final java.util.Collection result=requestBodyAndHeaders("direct://SEARCHFOLDER",null,headers);
    assertNotNull("searchFolder result",result);
    assertEquals("searchFolder file found",1,result.size());
    LOG.debug("searchFolder: " + result);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure(){
        from("direct://SEARCHFOLDER").to("box://" + PATH_PREFIX + "/searchFolder");
      }
    }
;
  }
  @Before public void setupTest() throws Exception {
    createTestFile();
  }
  @After public void teardownTest(){
    deleteTestFile();
  }
  public BoxAPIConnection getConnection(){
    BoxEndpoint endpoint=(BoxEndpoint)context().getEndpoint("box://" + PATH_PREFIX + "/searchFolder");
    return endpoint.getBoxConnection();
  }
  private void createTestFile() throws FileNotFoundException {
    BoxFolder rootFolder=BoxFolder.getRootFolder(getConnection());
    InputStream stream=getClass().getResourceAsStream(CAMEL_TEST_FILE);
    testFile=rootFolder.uploadFile(stream,CAMEL_TEST_FILE_NAME).getResource();
  }
}
