/** 
 * Unit test for CAMEL-1249
 */
public class MailUsingOwnComponentTest extends CamelTestSupport {
  @Override public boolean isUseRouteBuilder(){
    return false;
  }
  @Override protected CamelContext createCamelContext() throws Exception {
    CamelContext context=super.createCamelContext();
    MailConfiguration config=new MailConfiguration();
    config.setProtocol("smtp");
    config.setUsername("james");
    config.setHost("localhost");
    config.setPort(25);
    config.setPassword("admin");
    config.setIgnoreUriScheme(true);
    MailComponent myMailbox=new MailComponent();
    myMailbox.setConfiguration(config);
    context.addComponent("mailbox",myMailbox);
    return context;
  }
  @Test public void testUsingOwnMailComponent() throws Exception {
    Mailbox.clearAll();
    template.sendBodyAndHeader("mailbox:foo","Hello Mailbox","to","davsclaus@apache.org");
    Mailbox box=Mailbox.get("davsclaus@apache.org");
    Message msg=box.get(0);
    assertEquals("davsclaus@apache.org",msg.getRecipients(Message.RecipientType.TO)[0].toString());
  }
}
