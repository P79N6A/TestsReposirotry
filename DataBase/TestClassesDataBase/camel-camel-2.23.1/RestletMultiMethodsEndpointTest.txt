/** 
 * This unit test verifies a single route can service multiple methods.
 * @version 
 */
public class RestletMultiMethodsEndpointTest extends RestletTestSupport {
  @Test public void testPostMethod() throws Exception {
    HttpResponse response=doExecute(new HttpPost("http://localhost:" + portNum + "/users/homer"));
    assertHttpResponse(response,200,"text/plain","POST");
  }
  @Test public void testPutMethod() throws Exception {
    HttpResponse response=doExecute(new HttpPut("http://localhost:" + portNum + "/users/homer"));
    assertHttpResponse(response,200,"text/plain","PUT");
  }
  @Test public void testGetMethod() throws Exception {
    HttpResponse response=doExecute(new HttpGet("http://localhost:" + portNum + "/users/homer"));
    assertHttpResponse(response,200,"text/plain","GET");
  }
  @Test public void testDeleteMethod() throws Exception {
    HttpResponse response=doExecute(new HttpDelete("http://localhost:" + portNum + "/users/homer"));
    assertEquals(Status.CLIENT_ERROR_METHOD_NOT_ALLOWED.getCode(),response.getStatusLine().getStatusCode());
    Header header=response.getFirstHeader("Allow");
    assertNotNull(header);
    String value=header.getValue().toUpperCase(Locale.US);
    assertTrue("POST should be allowed",value.contains("POST"));
    assertTrue("GET should be allowed",value.contains("GET"));
    assertTrue("PUT should be allowed",value.contains("PUT"));
  }
  protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("restlet:http://localhost:" + portNum + "/users/{username}?restletMethods=post,get,put").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            exchange.getOut().setBody(exchange.getIn().getHeader(Exchange.HTTP_METHOD,String.class));
          }
        }
);
      }
    }
;
  }
}
