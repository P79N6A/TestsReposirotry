@ContextConfiguration public class JettyJmsTwowayTest extends AbstractJUnit4SpringContextTests {
  private static int port=AvailablePortFinder.getNextAvailable(20123);
  private static final String URL="jetty:http://localhost:" + port + "/test";
static {
    System.setProperty("JettyJmsTwowayTest.port",Integer.toString(port));
  }
  @Autowired protected CamelContext camelContext;
  @Test public void testSendingRequest() throws Exception {
    assertNotNull("the camelContext should not be null",camelContext);
    ProducerTemplate template=camelContext.createProducerTemplate();
    Exchange exchange=template.send(URL,new Processor(){
      public void process(      Exchange exchange) throws Exception {
        exchange.getIn().setBody("<hello>Willem</hello>");
        exchange.getIn().setHeader("Operation","greetMe");
      }
    }
);
    assertEquals("get result ","<response><hello>Willem</hello></response>",exchange.getOut().getBody(String.class));
    template.stop();
  }
}
