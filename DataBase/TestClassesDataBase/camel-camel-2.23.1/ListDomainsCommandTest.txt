public class ListDomainsCommandTest {
  private ListDomainsCommand command;
  private AmazonSDBClientMock sdbClient;
  private SdbConfiguration configuration;
  private Exchange exchange;
  @Before public void setUp(){
    sdbClient=new AmazonSDBClientMock();
    configuration=new SdbConfiguration();
    configuration.setDomainName("DOMAIN1");
    configuration.setMaxNumberOfDomains(new Integer(5));
    exchange=new DefaultExchange(new DefaultCamelContext());
    command=new ListDomainsCommand(sdbClient,configuration,exchange);
  }
  @SuppressWarnings({"unchecked"}) @Test public void execute(){
    exchange.getIn().setHeader(SdbConstants.NEXT_TOKEN,"TOKEN1");
    command.execute();
    assertEquals(new Integer(5),sdbClient.listDomainsRequest.getMaxNumberOfDomains());
    assertEquals("TOKEN1",sdbClient.listDomainsRequest.getNextToken());
    List<String> domains=exchange.getIn().getHeader(SdbConstants.DOMAIN_NAMES,List.class);
    assertEquals("TOKEN2",exchange.getIn().getHeader(SdbConstants.NEXT_TOKEN));
    assertEquals(2,domains.size());
    assertTrue(domains.contains("DOMAIN1"));
    assertTrue(domains.contains("DOMAIN2"));
  }
  @Test public void determineMaxNumberOfDomains(){
    assertEquals(new Integer(5),this.command.determineMaxNumberOfDomains());
    exchange.getIn().setHeader(SdbConstants.MAX_NUMBER_OF_DOMAINS,new Integer(10));
    assertEquals(new Integer(10),this.command.determineMaxNumberOfDomains());
  }
}
