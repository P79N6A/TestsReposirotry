/** 
 * Concurrent consumer with InOnly test.
 */
public class JmsConcurrentConsumerInOnlyTest extends CamelTestSupport {
  private int size=2000;
  @Test public void testConcurrentConsumers() throws Exception {
    for (int i=0; i < size; i++) {
      template.sendBody("activemq:foo","Hello " + i);
    }
    getMockEndpoint("mock:foo").expectedMessageCount(size);
    context.startAllRoutes();
    assertMockEndpointsSatisfied();
  }
  protected CamelContext createCamelContext() throws Exception {
    CamelContext camelContext=super.createCamelContext();
    ConnectionFactory connectionFactory=CamelJmsTestHelper.createPooledPersistentConnectionFactory();
    camelContext.addComponent("activemq",jmsComponentAutoAcknowledge(connectionFactory));
    return camelContext;
  }
  protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("activemq:foo?concurrentConsumers=2&maxConcurrentConsumers=5").routeId("foo").noAutoStartup().log("${threadName} got ${body}").delay(simple("${random(0,10)}")).to("mock:foo");
      }
    }
;
  }
}
