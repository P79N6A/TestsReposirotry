/** 
 * Example for wiki documentation
 */
public class AtomGoodBlogsTest extends TestSupport {
  private CamelContext context;
  protected CamelContext createCamelContext() throws Exception {
    SimpleRegistry registry=new SimpleRegistry();
    registry.put("blogService",new BlogService());
    context=new DefaultCamelContext(registry);
    context.addRoutes(createMyRoutes());
    return context;
  }
  /** 
 * This is the route builder where we create our routes using the Camel DSL
 */
  protected RouteBuilder createMyRoutes() throws Exception {
    return new RouteBuilder(){
      public void configure() throws Exception {
        from("atom:file:src/test/data/feed.atom?splitEntries=true&consumer.delay=1000").to("seda:feeds");
        from("seda:feeds").filter().method("blogService","isGoodBlog").to("seda:goodBlogs");
        from("seda:goodBlogs").to("mock:result");
      }
    }
;
  }
  /** 
 * This is the actual junit test method that does the assertion that our routes is working as expected
 */
  @Test public void testFiltering() throws Exception {
    context=createCamelContext();
    context.start();
    MockEndpoint mock=context.getEndpoint("mock:result",MockEndpoint.class);
    mock.expectedMinimumMessageCount(2);
    mock.assertIsSatisfied();
    context.stop();
  }
  /** 
 * Services for blogs
 */
public class BlogService {
    /** 
 * Tests the blogs if its a good blog entry or not
 */
    public boolean isGoodBlog(    Exchange exchange){
      Entry entry=exchange.getIn().getBody(Entry.class);
      String title=entry.getTitle();
      boolean good=title.toLowerCase().contains("camel");
      return good;
    }
  }
}
