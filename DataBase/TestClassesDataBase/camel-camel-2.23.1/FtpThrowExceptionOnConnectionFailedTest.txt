/** 
 * Unit test for login failure due bad password and no re connect attempts allowed
 */
public class FtpThrowExceptionOnConnectionFailedTest extends FtpServerTestSupport {
  @Test public void testBadLogin() throws Exception {
    try {
      uploadFile("dummy","cantremeber");
      fail("Should have thrown a GenericFileOperationFailedException");
    }
 catch (    GenericFileOperationFailedException e) {
      assertEquals(530,e.getCode());
    }
    File file=new File(FTP_ROOT_DIR + "login/report.txt");
    assertFalse("The file should NOT exists",file.exists());
  }
  private void uploadFile(  String username,  String password) throws Exception {
    Endpoint endpoint=context.getEndpoint("ftp://" + username + "@localhost:"+ getPort()+ "/login?password="+ password+ "&maximumReconnectAttempts=0&throwExceptionOnConnectFailed=true");
    Exchange exchange=endpoint.createExchange();
    exchange.getIn().setBody("Hello World from FTPServer");
    exchange.getIn().setHeader(Exchange.FILE_NAME,"report.txt");
    Producer producer=endpoint.createProducer();
    producer.start();
    producer.process(exchange);
    producer.stop();
  }
}
