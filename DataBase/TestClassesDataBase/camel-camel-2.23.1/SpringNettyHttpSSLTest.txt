@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations={"/org/apache/camel/component/netty4/http/SpringNettyHttpSSLTest.xml"}) public class SpringNettyHttpSSLTest extends Assert {
  @Produce private ProducerTemplate template;
  @EndpointInject(uri="mock:input") private MockEndpoint mockEndpoint;
  private Integer port;
  public Integer getPort(){
    return port;
  }
  @Resource(name="dynaPort") public void setPort(  Integer port){
    this.port=port;
  }
  @BeforeClass public static void setUpJaas() throws Exception {
    URL trustStoreUrl=NettyHttpSSLTest.class.getClassLoader().getResource("jsse/localhost.ks");
    System.setProperty("javax.net.ssl.trustStore",trustStoreUrl.toURI().getPath());
  }
  @AfterClass public static void tearDownJaas() throws Exception {
    System.clearProperty("java.security.auth.login.config");
  }
  @Test public void testSSLInOutWithNettyConsumer() throws Exception {
    mockEndpoint.expectedBodiesReceived("Hello World");
    String out=template.requestBody("https://localhost:" + getPort(),"Hello World",String.class);
    assertEquals("Bye World",out);
    mockEndpoint.assertIsSatisfied();
  }
}
