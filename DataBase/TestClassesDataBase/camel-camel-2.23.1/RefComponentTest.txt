public class RefComponentTest extends ContextTestSupport {
  private void bindToRegistry(  JndiRegistry jndi) throws Exception {
    Component comp=new DirectComponent();
    comp.setCamelContext(context);
    Endpoint slow=comp.createEndpoint("direct:somename");
    Consumer consumer=slow.createConsumer(new Processor(){
      public void process(      Exchange exchange) throws Exception {
        template.send("mock:result",exchange);
      }
    }
);
    consumer.start();
    jndi.bind("foo",slow);
  }
  @Test public void testRef() throws Exception {
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedBodiesReceived("Hello World");
    PropertyPlaceholderDelegateRegistry delegate=(PropertyPlaceholderDelegateRegistry)context.getRegistry();
    JndiRegistry jndi=(JndiRegistry)delegate.getRegistry();
    bindToRegistry(jndi);
    template.sendBody("ref:foo","Hello World");
    assertMockEndpointsSatisfied();
  }
}
