public class JettyHttpFileCacheTest extends CamelTestSupport {
  private static final String TEST_STRING="This is a test string and it has enough" + " aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa ";
  @Before public void setUp() throws Exception {
    super.setUp();
    context.getProperties().put(CachedOutputStream.TEMP_DIR,"target/cachedir");
    context.getProperties().put(CachedOutputStream.THRESHOLD,"16");
    deleteDirectory("target/cachedir");
    createDirectory("target/cachedir");
  }
  @Test public void testGetWithRelativePath() throws Exception {
    String response=template.requestBody("http://localhost:8201/clipboard/download/file","   ",String.class);
    assertEquals("should get the right response",TEST_STRING,response);
    File file=new File("target/cachedir");
    String[] files=file.list();
    assertTrue("There should not have any temp file",files.length == 0);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("jetty:http://localhost:8201/clipboard/download?chunked=true&matchOnUriPrefix=true").to("http://localhost:9101?bridgeEndpoint=true");
        from("jetty:http://localhost:9101?chunked=true&matchOnUriPrefix=true").process(new Processor(){
          public void process(          Exchange exchange) throws Exception {
            exchange.getOut().setBody(TEST_STRING);
          }
        }
);
      }
    }
;
  }
}
