@ContextConfiguration @RunWith(SpringJUnit4ClassRunner.class) public class ConsumerBreadcrumbIdTest extends CamelTestSupport {
  @Autowired private CamelEndpointMapping endpointMapping;
  @Autowired private WebServiceTemplate webServiceTemplate;
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    context.setTracing(true);
  }
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry registry=super.createRegistry();
    registry.bind("endpointMapping",this.endpointMapping);
    registry.bind("webServiceTemplate",this.webServiceTemplate);
    return registry;
  }
  @Test public void consumeWebServiceWithPojoRequestWhichIsWithBreadcrumb() throws Exception {
    QuoteRequest request=new QuoteRequest();
    request.setSymbol("GOOG");
    template.request("direct:webservice-marshall-asin",new Processor(){
      @Override public void process(      Exchange exchange) throws Exception {
        assertNotNull(exchange.getIn().getHeader("breadcrumbId"));
        assertEquals(exchange.getIn().getHeader("breadcrumbId"),"ID-Ralfs-MacBook-Pro-local-50523-1423553069254-0-5");
      }
    }
);
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        JaxbDataFormat jaxb=new JaxbDataFormat(false);
        jaxb.setContextPath("org.apache.camel.component.spring.ws.jaxb");
        from("direct:webservice-marshall-asin").marshal(jaxb).to("spring-ws:http://localhost/?soapAction=http://www.stockquotes.edu/GetQuoteAsIn&webServiceTemplate=#webServiceTemplate").convertBodyTo(String.class);
        from("spring-ws:soapaction:http://www.stockquotes.edu/GetQuoteAsIn?endpointMapping=#endpointMapping").setHeader("setin",constant("true")).process(new StockQuoteResponseProcessor());
      }
    }
;
  }
}
