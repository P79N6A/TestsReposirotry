/** 
 */
public class CxfRsProducerClientFactoryCacheTest extends Assert {
  private static int port1=CXFTestSupport.getPort1();
  private CamelContext context1;
  private ProducerTemplate template1;
  private AbstractApplicationContext applicationContext;
  @Before public void setUp() throws Exception {
    applicationContext=new ClassPathXmlApplicationContext("org/apache/camel/component/cxf/jaxrs/CxfRsProducerClientFactoryCacheTest1.xml");
    context1=SpringCamelContext.springCamelContext(applicationContext,false);
    context1.start();
    template1=context1.createProducerTemplate();
    template1.start();
  }
  @After public void tearDown() throws Exception {
    if (context1 != null) {
      context1.stop();
      template1.stop();
    }
    if (applicationContext != null) {
      applicationContext.close();
    }
  }
  @Test public void testGetCostumerWithHttpCentralClientAPI() throws Exception {
    doRunTest(template1,getPort1());
  }
  private void doRunTest(  ProducerTemplate template,  final int clientPort){
    Exchange exchange=template.send("direct://http",new Processor(){
      public void process(      Exchange exchange) throws Exception {
        exchange.setPattern(ExchangePattern.InOut);
        Message inMessage=exchange.getIn();
        inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_USING_HTTP_API,Boolean.TRUE);
        inMessage.setHeader(Exchange.HTTP_METHOD,"GET");
        inMessage.setHeader(Exchange.HTTP_PATH,"/customerservice/customers/123");
        inMessage.setHeader(CxfConstants.CAMEL_CXF_RS_RESPONSE_CLASS,Customer.class);
        inMessage.setHeader("clientPort",clientPort);
        inMessage.setBody(null);
      }
    }
);
    Customer response=(Customer)exchange.getOut().getBody();
    assertNotNull("The response should not be null ",response);
    assertEquals("Get a wrong customer id ",String.valueOf(response.getId()),"123");
    assertEquals("Get a wrong customer name",response.getName(),"John");
    assertEquals("Get a wrong response code",200,exchange.getOut().getHeader(Exchange.HTTP_RESPONSE_CODE));
  }
  public int getPort1(){
    return port1;
  }
}
