/** 
 */
public class StopCamelFromRouteTest extends Assert {
  private final CountDownLatch latch=new CountDownLatch(1);
  @Test public void testStopCamelFromRoute() throws Exception {
    CamelContext context=new DefaultCamelContext();
    context.addRoutes(createMyRoutes());
    context.start();
    MockEndpoint start=context.getEndpoint("mock:start",MockEndpoint.class);
    start.expectedMessageCount(1);
    MockEndpoint done=context.getEndpoint("mock:done",MockEndpoint.class);
    done.expectedMessageCount(1);
    ProducerTemplate template=context.createProducerTemplate();
    template.sendBody("direct:start","Hello Camel");
    assertTrue(latch.await(1,TimeUnit.MINUTES));
    context.stop();
    start.assertIsSatisfied();
    done.assertIsSatisfied();
  }
  public RouteBuilder createMyRoutes() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("direct:start").routeId("myRoute").to("mock:start").process(new Processor(){
          @Override public void process(          Exchange exchange) throws Exception {
            latch.countDown();
          }
        }
).to("mock:done");
      }
    }
;
  }
}
