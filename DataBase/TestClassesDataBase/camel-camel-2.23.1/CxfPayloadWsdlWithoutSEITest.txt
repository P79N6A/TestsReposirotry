public class CxfPayloadWsdlWithoutSEITest extends AbstractCxfWsdlFirstTest {
  @BeforeClass public static void startService(){
    Object implementor=new PersonImpl();
    String address="http://localhost:" + getPort1() + "/CxfPayloadWsdlWithoutSEITest/PersonService/";
    Endpoint.publish(address,implementor);
  }
  @Override protected ClassPathXmlApplicationContext createApplicationContext(){
    return new ClassPathXmlApplicationContext("org/apache/camel/component/cxf/CxfPayloadWsdlWithoutSEI.xml");
  }
  @Test @Override public void testInvokingServiceWithCamelProducer(){
    Exchange exchange=sendJaxWsMessage("hello");
    assertEquals("The request should be handled sucessfully ",exchange.isFailed(),false);
    org.apache.camel.Message out=exchange.getOut();
    String result=out.getBody(String.class);
    assertStringContains(result,"Bonjour");
    exchange=sendJaxWsMessage("");
    assertEquals("We should get a fault here",exchange.isFailed(),true);
    Throwable ex=exchange.getException();
    assertTrue("We should get a SoapFault here",ex instanceof SoapFault);
  }
  private Exchange sendJaxWsMessage(  final String personIdString){
    Exchange exchange=template.send("direct:producer",new Processor(){
      public void process(      final Exchange exchange){
        String body="<GetPerson xmlns=\"http://camel.apache.org/wsdl-first/types\"><personId>" + personIdString + "</personId></GetPerson>\n";
        exchange.getIn().setBody(body);
        exchange.getIn().setHeader(CxfConstants.OPERATION_NAME,"GetPerson");
      }
    }
);
    return exchange;
  }
}
