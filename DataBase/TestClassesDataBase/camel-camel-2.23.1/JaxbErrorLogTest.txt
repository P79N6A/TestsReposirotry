public class JaxbErrorLogTest extends CamelTestSupport {
  @Test public void testErrorHandling() throws Exception {
    getMockEndpoint("mock:end").expectedMessageCount(4);
    for (int i=0; i < 5; i++) {
      sendBody("seda:test",new CannotMarshal(i));
    }
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder(){
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        from("seda:test").bean(new FailingBean()).to("log:end","mock:end");
      }
    }
;
  }
public static final class FailingBean {
    @Handler public void handle(    @Body CannotMarshal body){
      if (body.getMessageNo() == 2) {
        throw new RuntimeException("Kaboom");
      }
    }
  }
  /** 
 * This class will throw RuntimeException on JAXB marshal
 */
@XmlRootElement public static final class CannotMarshal {
    private int messageNo;
    public CannotMarshal(){
    }
    public CannotMarshal(    int messageNo){
      this.messageNo=messageNo;
    }
    public int getMessageNo(){
      return messageNo;
    }
    public void setMessageNo(    int messageNo){
      this.messageNo=messageNo;
    }
    public void setUhoh(    String name){
    }
    public String getUhoh(){
      throw new RuntimeException("Can't marshal this");
    }
    @Override public String toString(){
      return "MessageNo. " + messageNo;
    }
  }
}
