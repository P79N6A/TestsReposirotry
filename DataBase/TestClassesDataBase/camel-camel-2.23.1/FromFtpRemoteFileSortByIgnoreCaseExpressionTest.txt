/** 
 * Unit test to verify remotefile sortby option.
 */
public class FromFtpRemoteFileSortByIgnoreCaseExpressionTest extends FtpServerTestSupport {
  private String getFtpUrl(){
    return "ftp://admin@localhost:" + getPort() + "/sortbyignore?password=admin&consumer.delay=5000";
  }
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    prepareFtpServer();
  }
  @Override public boolean isUseRouteBuilder(){
    return false;
  }
  @Test public void testSortFiles() throws Exception {
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(getFtpUrl() + "&sortBy=file:name").to("mock:result");
      }
    }
);
    context.start();
    MockEndpoint mock=getMockEndpoint("mock:result");
    mock.expectedBodiesReceived("Hello London","Hello Copenhagen","Hello Paris");
    assertMockEndpointsSatisfied();
  }
  @Test public void testSortFilesNoCase() throws Exception {
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(getFtpUrl() + "&sortBy=ignoreCase:file:name").to("mock:nocase");
      }
    }
);
    context.start();
    MockEndpoint nocase=getMockEndpoint("mock:nocase");
    nocase.expectedBodiesReceived("Hello Copenhagen","Hello London","Hello Paris");
    assertMockEndpointsSatisfied();
  }
  @Test public void testSortFilesNoCaseReverse() throws Exception {
    context.addRoutes(new RouteBuilder(){
      @Override public void configure() throws Exception {
        from(getFtpUrl() + "&sortBy=reverse:ignoreCase:file:name").to("mock:nocasereverse");
      }
    }
);
    context.start();
    MockEndpoint nocasereverse=getMockEndpoint("mock:nocasereverse");
    nocasereverse.expectedBodiesReceived("Hello Paris","Hello London","Hello Copenhagen");
    assertMockEndpointsSatisfied();
  }
  private void prepareFtpServer() throws Exception {
    sendFile(getFtpUrl(),"Hello Paris","report-3.dat");
    sendFile(getFtpUrl(),"Hello London","REPORT-2.txt");
    sendFile(getFtpUrl(),"Hello Copenhagen","Report-1.xml");
  }
}
