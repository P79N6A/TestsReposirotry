/** 
 * A simple  {@link KeyedBroadcastProcessFunction} that puts everything on the broadcast side in the state.
 */
private static class CheckpointingKeyedSingleBroadcastFunction extends KeyedBroadcastProcessFunction<Long,Tuple2<Long,Long>,Tuple2<Long,Long>,Tuple2<Long,Long>> {
  private static final long serialVersionUID=1333992081671604521L;
  private MapStateDescriptor<Long,String> stateDesc;
  @Override public void open(  Configuration parameters) throws Exception {
    super.open(parameters);
    stateDesc=new MapStateDescriptor<>("broadcast-state-3",BasicTypeInfo.LONG_TYPE_INFO,BasicTypeInfo.STRING_TYPE_INFO);
  }
  @Override public void processElement(  Tuple2<Long,Long> value,  ReadOnlyContext ctx,  Collector<Tuple2<Long,Long>> out) throws Exception {
    out.collect(value);
  }
  @Override public void processBroadcastElement(  Tuple2<Long,Long> value,  Context ctx,  Collector<Tuple2<Long,Long>> out) throws Exception {
    ctx.getBroadcastState(stateDesc).put(value.f0,Long.toString(value.f1));
  }
}
