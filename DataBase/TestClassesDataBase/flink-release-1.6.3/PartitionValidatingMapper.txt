/** 
 * Mapper that validates partitioning and maps to partition.
 */
public static class PartitionValidatingMapper extends RichMapFunction<Tuple2<Long,String>,Integer> {
  private final int numPartitions;
  private int ourPartition=-1;
  public PartitionValidatingMapper(  int numPartitions){
    this.numPartitions=numPartitions;
  }
  @Override public Integer map(  Tuple2<Long,String> value) throws Exception {
    int partition=value.f0.intValue() % numPartitions;
    if (ourPartition != -1) {
      assertEquals("inconsistent partitioning",ourPartition,partition);
    }
 else {
      ourPartition=partition;
    }
    return partition;
  }
}
