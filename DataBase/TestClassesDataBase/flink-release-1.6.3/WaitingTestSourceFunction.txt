/** 
 * This waits on the two multi-shot latches. The latches are triggered in a parallel flatMap inside the test topology.
 */
private static class WaitingTestSourceFunction implements SourceFunction<Tuple2<Integer,String>> {
  private static final long serialVersionUID=1L;
  private volatile boolean running=true;
  private final int numElements;
  public WaitingTestSourceFunction(  int numElements){
    this.numElements=numElements;
  }
  @Override public void run(  SourceContext<Tuple2<Integer,String>> ctx) throws Exception {
    for (int i=0; i < numElements && running; i++) {
      if (i % 5 == 0 && i > 0) {
        latch1.await();
        latch2.await();
        ModifyableClock.setCurrentTime(i * 1000);
      }
      ctx.collect(Tuple2.of(i,"message #" + i));
    }
  }
  @Override public void cancel(){
    running=false;
  }
}
