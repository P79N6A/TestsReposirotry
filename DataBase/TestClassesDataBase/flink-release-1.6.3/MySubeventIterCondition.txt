private static class MySubeventIterCondition extends IterativeCondition<SubEvent> {
  private static final long serialVersionUID=6215754202506583964L;
  @Override public boolean filter(  SubEvent value,  Context<SubEvent> ctx) throws Exception {
    if (!value.getName().startsWith("foo")) {
      return false;
    }
    double sum=0.0;
    for (    Event event : ctx.getEventsForPattern("middle")) {
      sum+=event.getPrice();
    }
    sum+=value.getPrice();
    return Double.compare(sum,5.0) < 0;
  }
}
