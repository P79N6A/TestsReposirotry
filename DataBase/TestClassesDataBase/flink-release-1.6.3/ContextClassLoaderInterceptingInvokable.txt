/** 
 * This is an  {@link AbstractInvokable} that stores the context class loader of the invokingthread in a static field so that tests can assert on the class loader instances.
 * @see #testSetsUserCodeClassLoader()
 */
public static class ContextClassLoaderInterceptingInvokable extends CheckpointsInOrderInvokable implements StoppableTask {
  public ContextClassLoaderInterceptingInvokable(  Environment environment){
    super(environment);
  }
  @Override public boolean triggerCheckpoint(  CheckpointMetaData checkpointMetaData,  CheckpointOptions checkpointOptions){
    classLoaders.add(Thread.currentThread().getContextClassLoader());
    return super.triggerCheckpoint(checkpointMetaData,checkpointOptions);
  }
  @Override public void notifyCheckpointComplete(  long checkpointId){
    classLoaders.add(Thread.currentThread().getContextClassLoader());
    super.notifyCheckpointComplete(checkpointId);
  }
  @Override public void stop(){
    classLoaders.add(Thread.currentThread().getContextClassLoader());
    stopLatch.trigger();
  }
}
