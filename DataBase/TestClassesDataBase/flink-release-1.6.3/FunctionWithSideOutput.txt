/** 
 * {@link BroadcastProcessFunction} that emits elements on side outputs.
 */
private static class FunctionWithSideOutput extends BroadcastProcessFunction<String,Integer,String> {
  private static final long serialVersionUID=7496674620398203933L;
  static final OutputTag<String> BROADCAST_TAG=new OutputTag<String>("br-out"){
    private static final long serialVersionUID=8037335313997479800L;
  }
;
  static final OutputTag<String> NON_BROADCAST_TAG=new OutputTag<String>("non-br-out"){
    private static final long serialVersionUID=-1092362442658548175L;
  }
;
  @Override public void processBroadcastElement(  Integer value,  Context ctx,  Collector<String> out) throws Exception {
    ctx.output(BROADCAST_TAG,"BR:" + value + " WM:"+ ctx.currentWatermark()+ " TS:"+ ctx.timestamp());
  }
  @Override public void processElement(  String value,  ReadOnlyContext ctx,  Collector<String> out) throws Exception {
    ctx.output(NON_BROADCAST_TAG,"NON-BR:" + value + " WM:"+ ctx.currentWatermark()+ " TS:"+ ctx.timestamp());
  }
}
