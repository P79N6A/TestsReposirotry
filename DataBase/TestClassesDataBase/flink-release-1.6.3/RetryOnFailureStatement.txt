/** 
 * Retries a test in case of a failure.
 */
private static class RetryOnFailureStatement extends Statement {
  private final int timesOnFailure;
  private int currentRun;
  private final Statement statement;
  private RetryOnFailureStatement(  int timesOnFailure,  Statement statement){
    if (timesOnFailure < 0) {
      throw new IllegalArgumentException("Negatives number of retries on failure");
    }
    this.timesOnFailure=timesOnFailure;
    this.statement=statement;
  }
  /** 
 * Retry a test in case of a failure.
 * @throws Throwable
 */
  @Override public void evaluate() throws Throwable {
    for (currentRun=0; currentRun <= timesOnFailure; currentRun++) {
      try {
        statement.evaluate();
        break;
      }
 catch (      Throwable t) {
        LOG.warn(String.format("Test run failed (%d/%d).",currentRun,timesOnFailure + 1),t);
        if (currentRun == timesOnFailure) {
          throw t;
        }
      }
    }
  }
}
