static class Watcher extends UntypedActor {
  private final FiniteDuration timeout;
  private final FiniteDuration interval;
  private final ErrorHandler errorHandler;
  Watcher(  FiniteDuration timeout,  FiniteDuration interval,  ErrorHandler errorHandler){
    this.timeout=Preconditions.checkNotNull(timeout);
    this.interval=Preconditions.checkNotNull(interval);
    this.errorHandler=Preconditions.checkNotNull(errorHandler);
  }
  @Override public void onReceive(  Object message) throws Exception {
    if (message instanceof Watch) {
      Watch watch=(Watch)message;
      getContext().actorSelection(watch.getTarget()).resolveOne(timeout).onComplete(new OnComplete<ActorRef>(){
        @Override public void onComplete(        Throwable failure,        ActorRef success) throws Throwable {
          if (success != null) {
            getContext().watch(success);
            getContext().system().scheduler().schedule(zeroDelay,interval,success,"Watcher message",getContext().dispatcher(),getSelf());
          }
 else {
            errorHandler.handleError(failure);
          }
        }
      }
,getContext().dispatcher());
    }
  }
}
