private static class ComplexNFAFactory implements NFACompiler.NFAFactory<Event> {
  private static final long serialVersionUID=1173020762472766713L;
  private final boolean handleTimeout;
  private ComplexNFAFactory(){
    this(false);
  }
  private ComplexNFAFactory(  boolean handleTimeout){
    this.handleTimeout=handleTimeout;
  }
  @Override public NFA<Event> createNFA(){
    Pattern<Event,?> pattern=Pattern.<Event>begin("start").where(new SimpleCondition<Event>(){
      private static final long serialVersionUID=5726188262756267490L;
      @Override public boolean filter(      Event value) throws Exception {
        return value.getName().equals("c");
      }
    }
).followedBy("middle1").where(new SimpleCondition<Event>(){
      private static final long serialVersionUID=5726188262756267490L;
      @Override public boolean filter(      Event value) throws Exception {
        return value.getName().equals("a");
      }
    }
).oneOrMore().optional().followedBy("middle2").where(new SimpleCondition<Event>(){
      private static final long serialVersionUID=5726188262756267490L;
      @Override public boolean filter(      Event value) throws Exception {
        return value.getName().equals("b");
      }
    }
).optional().followedBy("end").where(new SimpleCondition<Event>(){
      private static final long serialVersionUID=5726188262756267490L;
      @Override public boolean filter(      Event value) throws Exception {
        return value.getName().equals("a");
      }
    }
).within(Time.milliseconds(10L));
    return NFACompiler.compileFactory(pattern,handleTimeout).createNFA();
  }
}
