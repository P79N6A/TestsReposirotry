private static class BlockerStream extends FSDataOutputStream {
  private final OneShotLatch blocker=new OneShotLatch();
  @Override public long getPos() throws IOException {
    block();
    return 0L;
  }
  @Override public void write(  int b) throws IOException {
    block();
  }
  @Override public void flush() throws IOException {
    block();
  }
  @Override public void sync() throws IOException {
    block();
  }
  @Override public void close() throws IOException {
    blocker.trigger();
  }
  private void block() throws IOException {
    try {
      blocker.await();
    }
 catch (    InterruptedException e) {
      throw new IOException("interrupted");
    }
    throw new IOException("closed");
  }
}
