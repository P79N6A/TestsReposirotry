/** 
 * Tests for the JarActionHandler.
 */
public class JarActionHandlerTest {
  /** 
 * Test that the savepoint settings are correctly parsed.
 */
  @Test public void testSavepointRestoreSettings() throws Exception {
    Map<String,String> pathParams=new HashMap<>();
    pathParams.put("jarid","required");
    pathParams.put("savepointPath","ignored");
    pathParams.put("allowNonRestoredState","ignored");
    Map<String,String> queryParams=new HashMap<>();
    JarActionHandler.JarActionHandlerConfig config=JarActionHandler.JarActionHandlerConfig.fromParams(pathParams,queryParams);
    assertEquals(SavepointRestoreSettings.none(),config.getSavepointRestoreSettings());
    queryParams.put("savepointPath","the-savepoint-path");
    queryParams.put("allowNonRestoredState","");
    SavepointRestoreSettings expected=SavepointRestoreSettings.forPath("the-savepoint-path",false);
    config=JarActionHandler.JarActionHandlerConfig.fromParams(pathParams,queryParams);
    assertEquals(expected,config.getSavepointRestoreSettings());
    queryParams.put("allowNonRestoredState","true");
    expected=SavepointRestoreSettings.forPath("the-savepoint-path",true);
    config=JarActionHandler.JarActionHandlerConfig.fromParams(pathParams,queryParams);
    assertEquals(expected,config.getSavepointRestoreSettings());
  }
  /** 
 * Tests that empty String params are handled ignored.
 */
  @Test public void testEmptyStringParams() throws Exception {
    Map<String,String> pathParams=new HashMap<>();
    pathParams.put("jarid","required");
    Map<String,String> queryParams=new HashMap<>();
    queryParams.put("program-args","");
    queryParams.put("entry-class","");
    queryParams.put("parallelism","");
    queryParams.put("savepointPath","");
    queryParams.put("allowNonRestoredState","");
    JarActionHandler.JarActionHandlerConfig config=JarActionHandler.JarActionHandlerConfig.fromParams(pathParams,queryParams);
    assertEquals(0,config.getProgramArgs().length);
    Assert.assertNull(config.getEntryClass());
    assertEquals(1,config.getParallelism());
    assertEquals(SavepointRestoreSettings.none(),config.getSavepointRestoreSettings());
  }
}
