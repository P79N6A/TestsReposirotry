private static final class TestingOutputFormat extends DiscardingOutputFormat<Object> implements InitializeOnMaster, FinalizeOnMaster {
  private boolean isConfigured=false;
  @Override public void initializeGlobal(  int parallelism) throws IOException {
    if (!isConfigured) {
      throw new IllegalStateException("OutputFormat was not configured before initializeGlobal was called.");
    }
    if (!(Thread.currentThread().getContextClassLoader() instanceof TestClassLoader)) {
      throw new IllegalStateException("Context ClassLoader was not correctly switched.");
    }
    throw new TestException();
  }
  @Override public void finalizeGlobal(  int parallelism) throws IOException {
    if (!isConfigured) {
      throw new IllegalStateException("OutputFormat was not configured before finalizeGlobal was called.");
    }
    if (!(Thread.currentThread().getContextClassLoader() instanceof TestClassLoader)) {
      throw new IllegalStateException("Context ClassLoader was not correctly switched.");
    }
    throw new TestException();
  }
  @Override public void configure(  Configuration parameters){
    if (isConfigured) {
      throw new IllegalStateException("OutputFormat is already configured.");
    }
    if (!(Thread.currentThread().getContextClassLoader() instanceof TestClassLoader)) {
      throw new IllegalStateException("Context ClassLoader was not correctly switched.");
    }
    isConfigured=true;
  }
}
