private static class AsyncFailureInducingStateBackend extends MemoryStateBackend {
  private static final long serialVersionUID=-7613628662587098470L;
  @Override public OperatorStateBackend createOperatorStateBackend(  Environment env,  String operatorIdentifier) throws Exception {
    return new DefaultOperatorStateBackend(env.getUserClassLoader(),env.getExecutionConfig(),true){
      @Override public RunnableFuture<SnapshotResult<OperatorStateHandle>> snapshot(      long checkpointId,      long timestamp,      CheckpointStreamFactory streamFactory,      CheckpointOptions checkpointOptions) throws Exception {
        return new FutureTask<>(() -> {
          throw new Exception("Async part snapshot exception.");
        }
);
      }
    }
;
  }
  @Override public AsyncFailureInducingStateBackend configure(  Configuration config){
    return this;
  }
}
