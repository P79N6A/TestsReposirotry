private static class RandomTupleSource implements ParallelSourceFunction<Tuple2<Integer,Integer>> {
  private static final long serialVersionUID=1L;
  private int numKeys;
  private int remainingEvents;
  public RandomTupleSource(  int numEvents,  int numKeys){
    this.numKeys=numKeys;
    this.remainingEvents=numEvents;
  }
  @Override public void run(  SourceContext<Tuple2<Integer,Integer>> out) throws Exception {
    Random random=new Random(42);
    while (--remainingEvents >= 0) {
synchronized (out.getCheckpointLock()) {
        out.collect(new Tuple2<>(random.nextInt(numKeys),1));
      }
    }
  }
  @Override public void cancel(){
    this.remainingEvents=0;
  }
}
