/** 
 * A simple  {@link KeyedBroadcastProcessFunction} that puts everything on the broadcast side in the state.
 */
private static class CheckpointingKeyedBroadcastFunction extends KeyedBroadcastProcessFunction<Long,Tuple2<Long,Long>,Tuple2<Long,Long>,Tuple2<Long,Long>> {
  private static final long serialVersionUID=1333992081671604521L;
  private MapStateDescriptor<Long,Long> firstStateDesc;
  private MapStateDescriptor<String,Long> secondStateDesc;
  @Override public void open(  Configuration parameters) throws Exception {
    super.open(parameters);
    firstStateDesc=new MapStateDescriptor<>("broadcast-state-1",BasicTypeInfo.LONG_TYPE_INFO,BasicTypeInfo.LONG_TYPE_INFO);
    secondStateDesc=new MapStateDescriptor<>("broadcast-state-2",BasicTypeInfo.STRING_TYPE_INFO,BasicTypeInfo.LONG_TYPE_INFO);
  }
  @Override public void processElement(  Tuple2<Long,Long> value,  ReadOnlyContext ctx,  Collector<Tuple2<Long,Long>> out) throws Exception {
    out.collect(value);
  }
  @Override public void processBroadcastElement(  Tuple2<Long,Long> value,  Context ctx,  Collector<Tuple2<Long,Long>> out) throws Exception {
    ctx.getBroadcastState(firstStateDesc).put(value.f0,value.f1);
    ctx.getBroadcastState(secondStateDesc).put(Long.toString(value.f0),value.f1);
  }
}
