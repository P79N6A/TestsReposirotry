/** 
 * A RestartStrategy that blocks restarting on a given  {@link OneShotLatch}.
 */
private static final class TriggeredRestartStrategy implements RestartStrategy {
  private final OneShotLatch latch;
  TriggeredRestartStrategy(  OneShotLatch latch){
    this.latch=latch;
  }
  @Override public boolean canRestart(){
    return true;
  }
  @Override public void restart(  final RestartCallback restarter,  ScheduledExecutor executor){
    executor.execute(new Runnable(){
      @Override public void run(){
        try {
          latch.await();
        }
 catch (        InterruptedException e) {
          Thread.currentThread().interrupt();
        }
        restarter.triggerFullRecovery();
      }
    }
);
  }
}
