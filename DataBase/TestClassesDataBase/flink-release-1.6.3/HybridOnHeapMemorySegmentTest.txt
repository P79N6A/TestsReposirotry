/** 
 * Tests for the  {@link HybridMemorySegment} in on-heap mode.
 */
@RunWith(Parameterized.class) public class HybridOnHeapMemorySegmentTest extends MemorySegmentTestBase {
  public HybridOnHeapMemorySegmentTest(  int pageSize){
    super(pageSize);
  }
  @Override MemorySegment createSegment(  int size){
    return new HybridMemorySegment(new byte[size]);
  }
  @Override MemorySegment createSegment(  int size,  Object owner){
    return new HybridMemorySegment(new byte[size],owner);
  }
  @Test public void testHybridHeapSegmentSpecifics(){
    final byte[] buffer=new byte[411];
    HybridMemorySegment seg=new HybridMemorySegment(buffer);
    assertFalse(seg.isFreed());
    assertFalse(seg.isOffHeap());
    assertEquals(buffer.length,seg.size());
    assertTrue(buffer == seg.getArray());
    try {
      seg.getOffHeapBuffer();
      fail("should throw an exception");
    }
 catch (    IllegalStateException e) {
    }
    ByteBuffer buf1=seg.wrap(1,2);
    ByteBuffer buf2=seg.wrap(3,4);
    assertTrue(buf1 != buf2);
    assertEquals(1,buf1.position());
    assertEquals(3,buf1.limit());
    assertEquals(3,buf2.position());
    assertEquals(7,buf2.limit());
  }
}
