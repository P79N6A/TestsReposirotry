/** 
 * A simple keyed function for tests.
 */
private class TestKeyedFunction extends KeyedProcessFunction<String,String,Integer> {
  private ValueState<Integer> counterState;
  @Override public void open(  Configuration parameters) throws Exception {
    super.open(parameters);
    counterState=this.getRuntimeContext().getState(new ValueStateDescriptor<>("counter",Integer.class));
  }
  @Override public void processElement(  String value,  Context ctx,  Collector<Integer> out) throws Exception {
    Integer oldCount=counterState.value();
    Integer newCount=oldCount != null ? oldCount + 1 : 1;
    counterState.update(newCount);
    out.collect(newCount);
  }
}
