private static final class ReaderThread extends CheckedThread {
  private final LimitedConnectionsFileSystem fs;
  private final Path path;
  private final int maxConcurrentInputStreams;
  private final int maxConcurrentStreamsTotal;
  ReaderThread(  LimitedConnectionsFileSystem fs,  Path path,  int maxConcurrentInputStreams,  int maxConcurrentStreamsTotal){
    this.fs=fs;
    this.path=path;
    this.maxConcurrentInputStreams=maxConcurrentInputStreams;
    this.maxConcurrentStreamsTotal=maxConcurrentStreamsTotal;
  }
  @Override public void go() throws Exception {
    try (FSDataInputStream stream=fs.open(path)){
      assertTrue(fs.getNumberOfOpenInputStreams() <= maxConcurrentInputStreams);
      assertTrue(fs.getTotalNumberOfOpenStreams() <= maxConcurrentStreamsTotal);
      final byte[] readBuffer=new byte[4096];
      while (stream.read(readBuffer) != -1) {
      }
    }
   }
}
