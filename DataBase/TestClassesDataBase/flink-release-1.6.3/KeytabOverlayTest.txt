public class KeytabOverlayTest extends ContainerOverlayTestBase {
  @Rule public TemporaryFolder tempFolder=new TemporaryFolder();
  @Test public void testConfigure() throws Exception {
    File keytab=tempFolder.newFile();
    KeytabOverlay overlay=new KeytabOverlay(keytab);
    ContainerSpecification spec=new ContainerSpecification();
    overlay.configure(spec);
    assertEquals(TARGET_PATH.getPath(),spec.getDynamicConfiguration().getString(SecurityOptions.KERBEROS_LOGIN_KEYTAB));
    checkArtifact(spec,TARGET_PATH);
  }
  @Test public void testNoConf() throws Exception {
    KeytabOverlay overlay=new KeytabOverlay((Path)null);
    ContainerSpecification containerSpecification=new ContainerSpecification();
    overlay.configure(containerSpecification);
  }
  @Test public void testBuilderFromEnvironment() throws Exception {
    final Configuration conf=new Configuration();
    File keytab=tempFolder.newFile();
    conf.setString(SecurityOptions.KERBEROS_LOGIN_KEYTAB,keytab.getAbsolutePath());
    KeytabOverlay.Builder builder=KeytabOverlay.newBuilder().fromEnvironment(conf);
    assertEquals(builder.keytabPath,keytab);
  }
}
