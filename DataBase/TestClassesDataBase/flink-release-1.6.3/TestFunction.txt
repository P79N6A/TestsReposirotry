private static class TestFunction extends BroadcastProcessFunction<String,Integer,String> {
  private static final long serialVersionUID=7496674620398203933L;
  private final Set<String> keysToRegister;
  TestFunction(  Set<String> keysToRegister){
    this.keysToRegister=Preconditions.checkNotNull(keysToRegister);
  }
  @Override public void processBroadcastElement(  Integer value,  Context ctx,  Collector<String> out) throws Exception {
    for (    String k : keysToRegister) {
      ctx.getBroadcastState(STATE_DESCRIPTOR).put(k,value);
    }
    out.collect(value + "WM:" + ctx.currentWatermark()+ " TS:"+ ctx.timestamp());
  }
  @Override public void processElement(  String value,  ReadOnlyContext ctx,  Collector<String> out) throws Exception {
    Set<String> retrievedKeySet=new HashSet<>();
    for (    Map.Entry<String,Integer> entry : ctx.getBroadcastState(STATE_DESCRIPTOR).immutableEntries()) {
      retrievedKeySet.add(entry.getKey());
    }
    Assert.assertEquals(keysToRegister,retrievedKeySet);
    out.collect(value + "WM:" + ctx.currentWatermark()+ " TS:"+ ctx.timestamp());
  }
}
