private static class TestingLeaderGatewayRetriever extends LeaderGatewayRetriever<RpcGateway> {
  private final RpcGateway rpcGateway;
  private int retrievalAttempt=0;
  private TestingLeaderGatewayRetriever(  RpcGateway rpcGateway){
    this.rpcGateway=rpcGateway;
  }
  @Override protected CompletableFuture<RpcGateway> createGateway(  CompletableFuture<Tuple2<String,UUID>> leaderFuture){
    CompletableFuture<RpcGateway> result;
    if (retrievalAttempt < 2) {
      result=FutureUtils.completedExceptionally(new FlinkException("Could not resolve the leader gateway."));
    }
 else {
      result=CompletableFuture.completedFuture(rpcGateway);
    }
    retrievalAttempt++;
    return result;
  }
}
