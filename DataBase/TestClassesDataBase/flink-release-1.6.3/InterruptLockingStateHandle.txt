@SuppressWarnings("serial") private static class InterruptLockingStateHandle implements StreamStateHandle {
  private static final long serialVersionUID=1L;
  private volatile boolean closed;
  @Override public FSDataInputStream openInputStream() throws IOException {
    closed=false;
    FSDataInputStream is=new FSDataInputStream(){
      @Override public void seek(      long desired){
      }
      @Override public long getPos(){
        return 0;
      }
      @Override public int read() throws IOException {
        block();
        throw new EOFException();
      }
      @Override public void close() throws IOException {
        super.close();
        closed=true;
      }
    }
;
    return is;
  }
  private void block(){
    IN_RESTORE_LATCH.trigger();
    try {
synchronized (this) {
        wait();
      }
    }
 catch (    InterruptedException e) {
      while (!closed) {
        try {
synchronized (this) {
            wait();
          }
        }
 catch (        InterruptedException ignored) {
        }
      }
    }
  }
  @Override public void discardState() throws Exception {
  }
  @Override public long getStateSize(){
    return 0;
  }
}
