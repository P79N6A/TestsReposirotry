private static class LeftIdentityCoRichFlatMapFunction extends RichCoFlatMapFunction<String,String,String> implements ListCheckpointed<Long> {
  static long[] counts=new long[PARALLELISM];
  private long count;
  @Override public void flatMap1(  String value,  Collector<String> out){
    count+=1;
    out.collect(value);
  }
  @Override public void flatMap2(  String value,  Collector<String> out){
  }
  @Override public List<Long> snapshotState(  long checkpointId,  long timestamp) throws Exception {
    return Collections.singletonList(this.count);
  }
  @Override public void restoreState(  List<Long> state) throws Exception {
    if (state.isEmpty() || state.size() > 1) {
      throw new RuntimeException("Test failed due to unexpected recovered state size " + state.size());
    }
    this.count=state.get(0);
  }
  @Override public void close() throws IOException {
    counts[getRuntimeContext().getIndexOfThisSubtask()]=count;
  }
}
