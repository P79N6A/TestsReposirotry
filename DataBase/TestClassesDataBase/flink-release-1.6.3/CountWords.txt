private static class CountWords extends RichGroupReduceFunction<Tuple2<String,Integer>,Tuple2<String,Integer>> implements GroupCombineFunction<Tuple2<String,Integer>,Tuple2<String,Integer>> {
  private IntCounter reduceCalls;
  private IntCounter combineCalls;
  @Override public void open(  Configuration parameters){
    this.reduceCalls=getRuntimeContext().getIntCounter("reduce-calls");
    this.combineCalls=getRuntimeContext().getIntCounter("combine-calls");
  }
  @Override public void reduce(  Iterable<Tuple2<String,Integer>> values,  Collector<Tuple2<String,Integer>> out){
    reduceCalls.add(1);
    reduceInternal(values,out);
  }
  @Override public void combine(  Iterable<Tuple2<String,Integer>> values,  Collector<Tuple2<String,Integer>> out){
    combineCalls.add(1);
    reduceInternal(values,out);
  }
  private void reduceInternal(  Iterable<Tuple2<String,Integer>> values,  Collector<Tuple2<String,Integer>> out){
    int sum=0;
    String key=null;
    for (    Tuple2<String,Integer> e : values) {
      key=e.f0;
      sum+=e.f1;
    }
    out.collect(new Tuple2<>(key,sum));
  }
}
