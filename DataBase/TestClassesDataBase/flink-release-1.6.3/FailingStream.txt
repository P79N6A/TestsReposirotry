private static class FailingStream extends CheckpointStateOutputStream {
  private final IOException testException;
  FailingStream(  IOException testException){
    this.testException=testException;
  }
  @Nullable @Override public StreamStateHandle closeAndGetHandle() throws IOException {
    throw new UnsupportedOperationException();
  }
  @Override public long getPos() throws IOException {
    throw new UnsupportedOperationException();
  }
  @Override public void write(  int b) throws IOException {
    throw testException;
  }
  @Override public void flush() throws IOException {
    throw testException;
  }
  @Override public void sync() throws IOException {
    throw testException;
  }
  @Override public void close() throws IOException {
    throw new UnsupportedOperationException();
  }
}
