private static class StatefulStringStoringMap extends RichMapFunction<Integer,Integer> implements ListCheckpointed<String> {
  private static final long serialVersionUID=6092985758425330235L;
  private final ExecutionMode mode;
  private final String valueToStore;
  private StatefulStringStoringMap(  ExecutionMode mode,  String valueToStore){
    this.mode=mode;
    this.valueToStore=valueToStore;
  }
  @Override public Integer map(  Integer value) throws Exception {
    return value;
  }
  @Override public List<String> snapshotState(  long checkpointId,  long timestamp) throws Exception {
    return Arrays.asList(valueToStore + getRuntimeContext().getIndexOfThisSubtask());
  }
  @Override public void restoreState(  List<String> state) throws Exception {
switch (mode) {
case GENERATE:
      break;
case MIGRATE:
case RESTORE:
    Assert.assertEquals("Failed for " + valueToStore + getRuntimeContext().getIndexOfThisSubtask(),1,state.size());
  String value=state.get(0);
Assert.assertEquals(valueToStore + getRuntimeContext().getIndexOfThisSubtask(),value);
}
}
}
