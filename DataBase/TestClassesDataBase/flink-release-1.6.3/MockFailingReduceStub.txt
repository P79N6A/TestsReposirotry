public static class MockFailingReduceStub extends RichGroupReduceFunction<Record,Record> {
  private static final long serialVersionUID=1L;
  private int cnt=0;
  private final IntValue key=new IntValue();
  private final IntValue value=new IntValue();
  @Override public void reduce(  Iterable<Record> records,  Collector<Record> out){
    Record element=null;
    int valCnt=0;
    for (    Record next : records) {
      element=next;
      valCnt++;
    }
    if (++this.cnt >= 10) {
      throw new ExpectedTestException();
    }
    element.getField(0,this.key);
    this.value.setValue(valCnt - this.key.getValue());
    element.setField(1,this.value);
    out.collect(element);
  }
}
