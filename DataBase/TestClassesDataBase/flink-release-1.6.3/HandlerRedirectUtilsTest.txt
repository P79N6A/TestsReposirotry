/** 
 * Tests for the HandlerRedirectUtils.
 */
public class HandlerRedirectUtilsTest extends TestLogger {
  private static final String localRestAddress="http://127.0.0.1:1234";
  private static final String remoteRestAddress="http://127.0.0.2:1234";
  @Test public void testGetRedirectAddressWithLocalEqualsRemoteRESTAddress() throws Exception {
    JobManagerGateway jobManagerGateway=mock(JobManagerGateway.class);
    when(jobManagerGateway.requestRestAddress(any(Time.class))).thenReturn(CompletableFuture.completedFuture(localRestAddress));
    CompletableFuture<Optional<String>> redirectingAddressFuture=HandlerRedirectUtils.getRedirectAddress(localRestAddress,jobManagerGateway,Time.seconds(3L));
    Assert.assertTrue(redirectingAddressFuture.isDone());
    Assert.assertFalse(redirectingAddressFuture.get().isPresent());
  }
  @Test public void testGetRedirectAddressWithRemoteAkkaPath() throws Exception {
    JobManagerGateway jobManagerGateway=mock(AkkaJobManagerGateway.class);
    when(jobManagerGateway.requestRestAddress(any(Time.class))).thenReturn(CompletableFuture.completedFuture(remoteRestAddress));
    CompletableFuture<Optional<String>> optRedirectingAddress=HandlerRedirectUtils.getRedirectAddress(localRestAddress,jobManagerGateway,Time.seconds(3L));
    Assert.assertTrue(optRedirectingAddress.isDone());
    Assert.assertEquals(remoteRestAddress,optRedirectingAddress.get().get());
  }
}
