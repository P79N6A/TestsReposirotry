/** 
 * Tests for the JobVertexMetricsHandler.
 */
public class JobVertexMetricsHandlerTest extends TestLogger {
  @Test public void testGetPaths(){
    JobVertexMetricsHandler handler=new JobVertexMetricsHandler(Executors.directExecutor(),mock(MetricFetcher.class));
    String[] paths=handler.getPaths();
    Assert.assertEquals(1,paths.length);
    Assert.assertEquals("/jobs/:jobid/vertices/:vertexid/metrics",paths[0]);
  }
  @Test public void getMapFor() throws Exception {
    MetricFetcher fetcher=new MetricFetcher(mock(GatewayRetriever.class),mock(MetricQueryServiceRetriever.class),Executors.directExecutor(),TestingUtils.TIMEOUT());
    MetricStore store=MetricStoreTest.setupStore(fetcher.getMetricStore());
    JobVertexMetricsHandler handler=new JobVertexMetricsHandler(Executors.directExecutor(),fetcher);
    Map<String,String> pathParams=new HashMap<>();
    pathParams.put(PARAMETER_JOB_ID,"jobid");
    pathParams.put(PARAMETER_VERTEX_ID,"taskid");
    Map<String,String> metrics=handler.getMapFor(pathParams,store);
    assertEquals("4",metrics.get("8.abc.metric5"));
    assertEquals("5",metrics.get("8.opname.abc.metric6"));
    assertEquals("6",metrics.get("8.opname.abc.metric7"));
  }
  @Test public void getMapForNull(){
    MetricFetcher fetcher=new MetricFetcher(mock(GatewayRetriever.class),mock(MetricQueryServiceRetriever.class),Executors.directExecutor(),TestingUtils.TIMEOUT());
    MetricStore store=fetcher.getMetricStore();
    JobVertexMetricsHandler handler=new JobVertexMetricsHandler(Executors.directExecutor(),fetcher);
    Map<String,String> pathParams=new HashMap<>();
    Map<String,String> metrics=handler.getMapFor(pathParams,store);
    assertNull(metrics);
  }
}
