/** 
 * Sink that validates records received from each partition and checks that there are no duplicates.
 */
public static class PartitionValidatingSink implements SinkFunction<Integer> {
  private final int[] valuesPerPartition;
  public PartitionValidatingSink(  int numPartitions){
    this.valuesPerPartition=new int[numPartitions];
  }
  @Override public void invoke(  Integer value) throws Exception {
    valuesPerPartition[value]++;
    boolean missing=false;
    for (    int i : valuesPerPartition) {
      if (i < 100) {
        missing=true;
        break;
      }
    }
    if (!missing) {
      throw new SuccessException();
    }
  }
}
