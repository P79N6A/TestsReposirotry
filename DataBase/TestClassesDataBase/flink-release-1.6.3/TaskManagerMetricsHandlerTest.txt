/** 
 * Tests for the TaskManagerMetricsHandler.
 */
public class TaskManagerMetricsHandlerTest extends TestLogger {
  @Test public void testGetPaths(){
    TaskManagerMetricsHandler handler=new TaskManagerMetricsHandler(Executors.directExecutor(),mock(MetricFetcher.class));
    String[] paths=handler.getPaths();
    Assert.assertEquals(1,paths.length);
    Assert.assertEquals("/taskmanagers/:taskmanagerid/metrics",paths[0]);
  }
  @Test public void getMapFor() throws Exception {
    MetricFetcher fetcher=new MetricFetcher(mock(GatewayRetriever.class),mock(MetricQueryServiceRetriever.class),Executors.directExecutor(),TestingUtils.TIMEOUT());
    MetricStore store=MetricStoreTest.setupStore(fetcher.getMetricStore());
    TaskManagerMetricsHandler handler=new TaskManagerMetricsHandler(Executors.directExecutor(),fetcher);
    Map<String,String> pathParams=new HashMap<>();
    pathParams.put(TASK_MANAGER_ID_KEY,"tmid");
    Map<String,String> metrics=handler.getMapFor(pathParams,store);
    assertEquals("1",metrics.get("abc.metric2"));
  }
  @Test public void getMapForNull(){
    MetricFetcher fetcher=new MetricFetcher(mock(GatewayRetriever.class),mock(MetricQueryServiceRetriever.class),Executors.directExecutor(),TestingUtils.TIMEOUT());
    MetricStore store=fetcher.getMetricStore();
    TaskManagerMetricsHandler handler=new TaskManagerMetricsHandler(Executors.directExecutor(),fetcher);
    Map<String,String> pathParams=new HashMap<>();
    Map<String,String> metrics=handler.getMapFor(pathParams,store);
    assertNull(metrics);
  }
}
