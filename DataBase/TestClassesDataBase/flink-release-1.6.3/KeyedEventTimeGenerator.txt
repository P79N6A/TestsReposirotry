static class KeyedEventTimeGenerator implements FailingSource.EventEmittingGenerator {
  private final int keyUniverseSize;
  private final int watermarkTrailing;
  public KeyedEventTimeGenerator(  int keyUniverseSize,  int numElementsPerWindow){
    this.keyUniverseSize=keyUniverseSize;
    this.watermarkTrailing=4 * numElementsPerWindow / 3;
  }
  @Override public void emitEvent(  SourceFunction.SourceContext<Tuple2<Long,IntType>> ctx,  int eventSequenceNo){
    final IntType intTypeNext=new IntType(eventSequenceNo);
    for (long i=0; i < keyUniverseSize; i++) {
      final Tuple2<Long,IntType> generatedEvent=new Tuple2<>(i,intTypeNext);
      ctx.collectWithTimestamp(generatedEvent,eventSequenceNo);
    }
    ctx.emitWatermark(new Watermark(eventSequenceNo - watermarkTrailing));
  }
}
