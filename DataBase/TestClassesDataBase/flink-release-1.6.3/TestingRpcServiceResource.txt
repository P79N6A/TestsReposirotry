/** 
 * {@link ExternalResource} which starts a {@link org.apache.flink.runtime.rpc.TestingRpcService}.
 */
public class TestingRpcServiceResource extends ExternalResource {
  private TestingRpcService testingRpcService;
  public TestingRpcServiceResource(){
    this.testingRpcService=null;
  }
  public TestingRpcService getTestingRpcService(){
    checkInitialized();
    return testingRpcService;
  }
  private void checkInitialized(){
    assert (testingRpcService != null);
  }
  @Override protected void before(){
    if (testingRpcService != null) {
      terminateRpcService();
    }
    testingRpcService=new TestingRpcService();
  }
  @Override protected void after(){
    if (testingRpcService != null) {
      terminateRpcService();
      testingRpcService=null;
    }
  }
  private void terminateRpcService(){
    CompletableFuture<Void> terminationFuture=testingRpcService.stopService();
    terminationFuture.join();
  }
}
