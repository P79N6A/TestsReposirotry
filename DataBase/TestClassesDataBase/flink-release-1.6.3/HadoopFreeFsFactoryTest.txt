/** 
 * Tests that validate the behavior of the Hadoop File System Factory.
 */
public class HadoopFreeFsFactoryTest extends TestLogger {
  /** 
 * This test validates that the factory can be instantiated and configured even when Hadoop classes are missing from the classpath.
 */
  @Test public void testHadoopFactoryInstantiationWithoutHadoop() throws Exception {
    final String testClassName="org.apache.flink.runtime.fs.hdfs.HadoopFreeTests";
    URLClassLoader parent=(URLClassLoader)getClass().getClassLoader();
    ClassLoader hadoopFreeClassLoader=new HadoopFreeClassLoader(parent);
    Class<?> testClass=Class.forName(testClassName,false,hadoopFreeClassLoader);
    Method m=testClass.getDeclaredMethod("test");
    try {
      m.invoke(null);
    }
 catch (    InvocationTargetException e) {
      ExceptionUtils.rethrowException(e.getTargetException(),"exception in method");
    }
  }
private static final class HadoopFreeClassLoader extends URLClassLoader {
    private final ClassLoader properParent;
    HadoopFreeClassLoader(    URLClassLoader parent){
      super(parent.getURLs(),null);
      properParent=parent;
    }
    @Override public Class<?> loadClass(    String name) throws ClassNotFoundException {
      if (name.startsWith("org.apache.hadoop")) {
        throw new ClassNotFoundException(name);
      }
 else       if (name.startsWith("org.apache.log4j")) {
        return properParent.loadClass(name);
      }
 else {
        return super.loadClass(name);
      }
    }
  }
}
