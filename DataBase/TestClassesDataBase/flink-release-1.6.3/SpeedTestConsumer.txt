/** 
 * Invokable that consumes incoming records and allows slowdown via  {@link #IS_SLOW_EVERY_NUM_RECORDS}. <p>NOTE: needs to be <tt>public</tt> so that a task can be run with this!
 */
public static class SpeedTestConsumer extends AbstractInvokable {
  public SpeedTestConsumer(  Environment environment){
    super(environment);
  }
  @Override public void invoke() throws Exception {
    RecordReader<SpeedTestRecord> reader=new RecordReader<>(getEnvironment().getInputGate(0),SpeedTestRecord.class,getEnvironment().getTaskManagerInfo().getTmpDirectories());
    try {
      boolean isSlow=getTaskConfiguration().getBoolean(IS_SLOW_RECEIVER_CONFIG_KEY,false);
      int numRecords=0;
      while (reader.next() != null) {
        if (isSlow && (numRecords++ % IS_SLOW_EVERY_NUM_RECORDS) == 0) {
          Thread.sleep(IS_SLOW_SLEEP_MS);
        }
      }
    }
  finally {
      reader.clearBuffers();
    }
  }
}
