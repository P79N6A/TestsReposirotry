/** 
 * Sample test for  {@link DataLdapTest @DataLdapTest}
 * @author Eddú Meléndez
 */
@RunWith(SpringRunner.class) @DataLdapTest @TestPropertySource(properties={"spring.ldap.embedded.base-dn=dc=spring,dc=org","spring.ldap.embedded.ldif=classpath:org/springframework/boot/test/autoconfigure/data/ldap/schema.ldif"}) public class DataLdapTestIntegrationTests {
  @Autowired private LdapTemplate ldapTemplate;
  @Autowired private ExampleRepository exampleRepository;
  @Autowired private ApplicationContext applicationContext;
  @Test public void testRepository(){
    LdapQuery ldapQuery=LdapQueryBuilder.query().where("cn").is("Bob Smith");
    Optional<ExampleEntry> entry=this.exampleRepository.findOne(ldapQuery);
    assertThat(entry.isPresent()).isTrue();
    assertThat(entry.get().getDn()).isEqualTo(LdapUtils.newLdapName("cn=Bob Smith,ou=company1,c=Sweden,dc=spring,dc=org"));
    assertThat(this.ldapTemplate.findOne(ldapQuery,ExampleEntry.class).getDn()).isEqualTo(LdapUtils.newLdapName("cn=Bob Smith,ou=company1,c=Sweden,dc=spring,dc=org"));
  }
  @Test public void didNotInjectExampleService(){
    assertThatExceptionOfType(NoSuchBeanDefinitionException.class).isThrownBy(() -> this.applicationContext.getBean(ExampleService.class));
  }
}
