/** 
 * Integration tests for  {@link JooqTest}.
 * @author Michael Simons
 */
@RunWith(SpringRunner.class) @JooqTest public class JooqTestIntegrationTests {
  @Autowired private DSLContext dsl;
  @Autowired private DataSource dataSource;
  @Autowired private ApplicationContext applicationContext;
  @Test public void testDSLContext(){
    assertThat(this.dsl.selectCount().from("INFORMATION_SCHEMA.TABLES").fetchOne(0,Integer.class)).isGreaterThan(0);
  }
  @Test public void useDefinedDataSource() throws Exception {
    String product=this.dataSource.getConnection().getMetaData().getDatabaseProductName();
    assertThat(product).startsWith("HSQL");
    assertThat(this.dsl.configuration().dialect()).isEqualTo(SQLDialect.HSQLDB);
  }
  @Test public void didNotInjectExampleComponent(){
    assertThatExceptionOfType(NoSuchBeanDefinitionException.class).isThrownBy(() -> this.applicationContext.getBean(ExampleComponent.class));
  }
  @Test public void flywayAutoConfigurationWasImported(){
    assertThat(this.applicationContext).has(importedAutoConfiguration(FlywayAutoConfiguration.class));
  }
  @Test public void liquibaseAutoConfigurationWasImported(){
    assertThat(this.applicationContext).has(importedAutoConfiguration(LiquibaseAutoConfiguration.class));
  }
}
