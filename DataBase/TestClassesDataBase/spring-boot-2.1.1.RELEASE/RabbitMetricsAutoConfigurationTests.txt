/** 
 * Tests for  {@link RabbitMetricsAutoConfiguration}.
 * @author Stephane Nicoll
 */
public class RabbitMetricsAutoConfigurationTests {
  private ApplicationContextRunner contextRunner=new ApplicationContextRunner().with(MetricsRun.simple()).withConfiguration(AutoConfigurations.of(RabbitAutoConfiguration.class,RabbitMetricsAutoConfiguration.class));
  @Test public void autoConfiguredConnectionFactoryIsInstrumented(){
    this.contextRunner.run((context) -> {
      MeterRegistry registry=context.getBean(MeterRegistry.class);
      registry.get("rabbitmq.connections").meter();
    }
);
  }
  @Test public void rabbitmqNativeConnectionFactoryInstrumentationCanBeDisabled(){
    this.contextRunner.withPropertyValues("management.metrics.enable.rabbitmq=false").run((context) -> {
      MeterRegistry registry=context.getBean(MeterRegistry.class);
      assertThat(registry.find("rabbitmq.connections").meter()).isNull();
    }
);
  }
}
