/** 
 * Integration tests for remapped error pages.
 * @author Dave Syer
 */
@RunWith(SpringRunner.class) @SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT,properties="spring.mvc.servlet.path:/spring/") @DirtiesContext public class RemappedErrorViewIntegrationTests {
  @LocalServerPort private int port;
  private TestRestTemplate template=new TestRestTemplate();
  @Test public void directAccessToErrorPage(){
    String content=this.template.getForObject("http://localhost:" + this.port + "/spring/error",String.class);
    assertThat(content).contains("error");
    assertThat(content).contains("999");
  }
  @Test public void forwardToErrorPage(){
    String content=this.template.getForObject("http://localhost:" + this.port + "/spring/",String.class);
    assertThat(content).contains("error");
    assertThat(content).contains("500");
  }
@Configuration @Import({PropertyPlaceholderAutoConfiguration.class,WebMvcAutoConfiguration.class,HttpMessageConvertersAutoConfiguration.class,ServletWebServerFactoryAutoConfiguration.class,DispatcherServletAutoConfiguration.class,ErrorMvcAutoConfiguration.class}) @Controller public static class TestConfiguration implements ErrorPageRegistrar {
    @RequestMapping("/") public String home(){
      throw new RuntimeException("Planned!");
    }
    @Override public void registerErrorPages(    ErrorPageRegistry errorPageRegistry){
      errorPageRegistry.addErrorPages(new ErrorPage("/spring/error"));
    }
    public static void main(    String[] args){
      new SpringApplicationBuilder(TestConfiguration.class).properties("spring.mvc.servlet.path:spring/*").run(args);
    }
  }
}
