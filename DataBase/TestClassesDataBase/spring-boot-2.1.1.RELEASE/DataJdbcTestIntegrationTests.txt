/** 
 * Integration tests for  {@link DataJdbcTest}.
 * @author Andy Wilkinson
 */
@RunWith(SpringRunner.class) @DataJdbcTest @TestPropertySource(properties="spring.datasource.schema=classpath:org/springframework/boot/test/autoconfigure/data/jdbc/schema.sql") public class DataJdbcTestIntegrationTests {
  @Autowired private ExampleRepository repository;
  @Autowired private DataSource dataSource;
  @Autowired private ApplicationContext applicationContext;
  @Autowired private JdbcTemplate jdbcTemplate;
  @Test public void testRepository(){
    this.jdbcTemplate.update("INSERT INTO EXAMPLE_ENTITY (id, name, reference) VALUES (1, 'a', 'alpha')");
    this.jdbcTemplate.update("INSERT INTO EXAMPLE_ENTITY (id, name, reference) VALUES (2, 'b', 'bravo')");
    assertThat(this.repository.findAll()).hasSize(2);
  }
  @Test public void replacesDefinedDataSourceWithEmbeddedDefault() throws Exception {
    String product=this.dataSource.getConnection().getMetaData().getDatabaseProductName();
    assertThat(product).isEqualTo("H2");
  }
  @Test public void didNotInjectExampleComponent(){
    assertThatExceptionOfType(NoSuchBeanDefinitionException.class).isThrownBy(() -> this.applicationContext.getBean(ExampleComponent.class));
  }
  @Test public void flywayAutoConfigurationWasImported(){
    assertThat(this.applicationContext).has(importedAutoConfiguration(FlywayAutoConfiguration.class));
  }
  @Test public void liquibaseAutoConfigurationWasImported(){
    assertThat(this.applicationContext).has(importedAutoConfiguration(LiquibaseAutoConfiguration.class));
  }
}
