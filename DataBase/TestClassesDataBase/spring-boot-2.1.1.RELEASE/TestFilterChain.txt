private static class TestFilterChain extends MockFilterChain {
  private final FilterHandler handler;
  TestFilterChain(  FilterHandler handler){
    this.handler=handler;
  }
  @Override public void doFilter(  ServletRequest request,  ServletResponse response) throws IOException, ServletException {
    AtomicBoolean called=new AtomicBoolean();
    Chain chain=() -> {
      if (called.compareAndSet(false,true)) {
        super.doFilter(request,response);
      }
    }
;
    this.handler.handle((HttpServletRequest)request,(HttpServletResponse)response,chain);
    chain.call();
  }
}
