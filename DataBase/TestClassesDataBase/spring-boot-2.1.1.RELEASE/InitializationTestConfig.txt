@Configuration public static class InitializationTestConfig {
  private static boolean addedListener;
  @Bean public ReactiveWebServerFactory webServerFactory(){
    return new MockReactiveWebServerFactory();
  }
  @Bean public HttpHandler httpHandler(){
    if (!addedListener) {
      throw new RuntimeException("Handlers should be added after listeners, we're being initialized too early!");
    }
    return mock(HttpHandler.class);
  }
  @Bean public Listener listener(){
    return new Listener();
  }
  @Bean public ApplicationEventMulticaster applicationEventMulticaster(){
    return new SimpleApplicationEventMulticaster(){
      @Override public void addApplicationListenerBean(      String listenerBeanName){
        super.addApplicationListenerBean(listenerBeanName);
        if ("listener".equals(listenerBeanName)) {
          addedListener=true;
        }
      }
    }
;
  }
private static class Listener implements ApplicationListener<ContextRefreshedEvent> {
    @Override public void onApplicationEvent(    ContextRefreshedEvent event){
    }
  }
}
