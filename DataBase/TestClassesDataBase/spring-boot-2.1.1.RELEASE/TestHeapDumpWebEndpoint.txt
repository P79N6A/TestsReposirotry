private static class TestHeapDumpWebEndpoint extends HeapDumpWebEndpoint {
  private boolean available;
  private String heapDump="HEAPDUMP";
  private File file;
  TestHeapDumpWebEndpoint(){
    super(TimeUnit.SECONDS.toMillis(1));
    reset();
  }
  public void reset(){
    this.available=true;
  }
  @Override protected HeapDumper createHeapDumper(){
    return (file,live) -> {
      this.file=file;
      if (!TestHeapDumpWebEndpoint.this.available) {
        throw new HeapDumperUnavailableException("Not available",null);
      }
      if (file.exists()) {
        throw new IOException("File exists");
      }
      FileCopyUtils.copy(TestHeapDumpWebEndpoint.this.heapDump.getBytes(),file);
    }
;
  }
  public void setAvailable(  boolean available){
    this.available=available;
  }
}
