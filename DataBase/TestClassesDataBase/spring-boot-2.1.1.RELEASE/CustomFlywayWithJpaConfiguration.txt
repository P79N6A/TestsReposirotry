@Configuration protected static class CustomFlywayWithJpaConfiguration {
  private final DataSource dataSource;
  protected CustomFlywayWithJpaConfiguration(  DataSource dataSource){
    this.dataSource=dataSource;
  }
  @Bean public Flyway flyway(){
    return new Flyway();
  }
  @Bean public LocalContainerEntityManagerFactoryBean entityManagerFactoryBean(){
    Map<String,Object> properties=new HashMap<>();
    properties.put("configured","manually");
    properties.put("hibernate.transaction.jta.platform",NoJtaPlatform.INSTANCE);
    return new EntityManagerFactoryBuilder(new HibernateJpaVendorAdapter(),properties,null).dataSource(this.dataSource).build();
  }
}
