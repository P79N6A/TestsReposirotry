/** 
 * Test  {@link SpyBean} when mixed with Spring AOP.
 * @author Phillip Webb
 * @see <a href="https://github.com/spring-projects/spring-boot/issues/5837">5837</a>
 */
@RunWith(SpringRunner.class) public class SpyBeanWithAopProxyAndNotProxyTargetAwareTests {
  @SpyBean(proxyTargetAware=false) private DateService dateService;
  @Test(expected=UnfinishedVerificationException.class) public void verifyShouldUseProxyTarget(){
    this.dateService.getDate(false);
    verify(this.dateService,times(1)).getDate(false);
    verify(this.dateService,times(1)).getDate(eq(false));
    verify(this.dateService,times(1)).getDate(anyBoolean());
    reset(this.dateService);
  }
@Configuration @EnableCaching(proxyTargetClass=true) @Import(DateService.class) static class Config {
    @Bean public CacheResolver cacheResolver(    CacheManager cacheManager){
      SimpleCacheResolver resolver=new SimpleCacheResolver();
      resolver.setCacheManager(cacheManager);
      return resolver;
    }
    @Bean public ConcurrentMapCacheManager cacheManager(){
      ConcurrentMapCacheManager cacheManager=new ConcurrentMapCacheManager();
      cacheManager.setCacheNames(Arrays.asList("test"));
      return cacheManager;
    }
  }
@Service static class DateService {
    @Cacheable(cacheNames="test") public Long getDate(    boolean arg){
      return System.nanoTime();
    }
  }
}
