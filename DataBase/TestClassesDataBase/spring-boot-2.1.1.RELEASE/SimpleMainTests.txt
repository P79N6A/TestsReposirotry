/** 
 * Tests for  {@link SpringApplication} main method.
 * @author Dave Syer
 */
@Configuration public class SimpleMainTests {
  @Rule public OutputCapture outputCapture=new OutputCapture();
  private static final String SPRING_STARTUP="Started SpringApplication in";
  @Test(expected=IllegalArgumentException.class) public void emptyApplicationContext() throws Exception {
    SpringApplication.main(getArgs());
    assertThat(getOutput()).contains(SPRING_STARTUP);
  }
  @Test public void basePackageScan() throws Exception {
    SpringApplication.main(getArgs(ClassUtils.getPackageName(getClass()) + ".sampleconfig"));
    assertThat(getOutput()).contains(SPRING_STARTUP);
  }
  @Test public void configClassContext() throws Exception {
    SpringApplication.main(getArgs(getClass().getName()));
    assertThat(getOutput()).contains(SPRING_STARTUP);
  }
  @Test public void xmlContext() throws Exception {
    SpringApplication.main(getArgs("org/springframework/boot/sample-beans.xml"));
    assertThat(getOutput()).contains(SPRING_STARTUP);
  }
  @Test public void mixedContext() throws Exception {
    SpringApplication.main(getArgs(getClass().getName(),"org/springframework/boot/sample-beans.xml"));
    assertThat(getOutput()).contains(SPRING_STARTUP);
  }
  private String[] getArgs(  String... args){
    List<String> list=new ArrayList<>(Arrays.asList("--spring.main.web-application-type=none","--spring.main.show-banner=OFF","--spring.main.register-shutdownHook=false"));
    if (args.length > 0) {
      list.add("--spring.main.sources=" + StringUtils.arrayToCommaDelimitedString(args));
    }
    return StringUtils.toStringArray(list);
  }
  private String getOutput(){
    return this.outputCapture.toString();
  }
}
