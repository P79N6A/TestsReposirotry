/** 
 * Tests for  {@link MustacheView}.
 * @author Brian Clozel
 */
public class MustacheViewTests {
  private final String templateUrl="classpath:/" + getClass().getPackage().getName().replace(".","/") + "/template.html";
  private GenericApplicationContext context=new GenericApplicationContext();
  private MockServerWebExchange exchange;
  @Before public void init(){
    this.context.refresh();
  }
  @Test public void viewResolvesHandlebars(){
    this.exchange=MockServerWebExchange.from(MockServerHttpRequest.get("/test").build());
    MustacheView view=new MustacheView();
    view.setCompiler(Mustache.compiler());
    view.setUrl(this.templateUrl);
    view.setCharset(StandardCharsets.UTF_8.displayName());
    view.setApplicationContext(this.context);
    view.render(Collections.singletonMap("World","Spring"),MediaType.TEXT_HTML,this.exchange).block();
    assertThat(this.exchange.getResponse().getBodyAsString().block()).isEqualTo("Hello Spring");
  }
}
