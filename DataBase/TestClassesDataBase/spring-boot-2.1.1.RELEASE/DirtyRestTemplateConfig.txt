@Configuration static class DirtyRestTemplateConfig {
  @Bean public RestTemplate restTemplateOne(  RestTemplateBuilder builder){
    try {
      return builder.build();
    }
  finally {
      breakBuilderOnNextCall(builder);
    }
  }
  @Bean public RestTemplate restTemplateTwo(  RestTemplateBuilder builder){
    try {
      return builder.build();
    }
  finally {
      breakBuilderOnNextCall(builder);
    }
  }
  private void breakBuilderOnNextCall(  RestTemplateBuilder builder){
    builder.additionalCustomizers((restTemplate) -> {
      throw new IllegalStateException();
    }
);
  }
}
