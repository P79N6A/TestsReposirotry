@Configuration protected static class TestConfigurationWithLocalContainerEntityManagerFactoryBean extends TestConfiguration {
  @Bean public LocalContainerEntityManagerFactoryBean entityManagerFactory(  DataSource dataSource,  JpaVendorAdapter adapter){
    LocalContainerEntityManagerFactoryBean factoryBean=new LocalContainerEntityManagerFactoryBean();
    factoryBean.setJpaVendorAdapter(adapter);
    factoryBean.setDataSource(dataSource);
    factoryBean.setPersistenceUnitName("manually-configured");
    Map<String,Object> properties=new HashMap<>();
    properties.put("configured","manually");
    properties.put("hibernate.transaction.jta.platform",NoJtaPlatform.INSTANCE);
    factoryBean.setJpaPropertyMap(properties);
    return factoryBean;
  }
}
