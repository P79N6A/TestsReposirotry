@Configuration public static class EndpointConfig {
  private final CountDownLatch latch=new CountDownLatch(1);
  private volatile ClassLoader threadContextClassLoader;
  @Bean public ShutdownEndpoint endpoint(){
    ShutdownEndpoint endpoint=new ShutdownEndpoint();
    return endpoint;
  }
  @Bean public ApplicationListener<ContextClosedEvent> listener(){
    return (event) -> {
      EndpointConfig.this.threadContextClassLoader=Thread.currentThread().getContextClassLoader();
      EndpointConfig.this.latch.countDown();
    }
;
  }
}
