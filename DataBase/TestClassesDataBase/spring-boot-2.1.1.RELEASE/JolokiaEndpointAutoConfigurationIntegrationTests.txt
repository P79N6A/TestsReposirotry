/** 
 * Integration tests for  {@link JolokiaEndpointAutoConfiguration}.
 * @author Stephane Nicoll
 */
@RunWith(SpringRunner.class) @SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT,properties="management.endpoints.web.exposure.include=jolokia") @DirtiesContext public class JolokiaEndpointAutoConfigurationIntegrationTests {
  @Autowired private TestRestTemplate restTemplate;
  @Test public void jolokiaIsExposed(){
    ResponseEntity<String> response=this.restTemplate.getForEntity("/actuator/jolokia",String.class);
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(response.getBody()).contains("\"agent\"");
    assertThat(response.getBody()).contains("\"request\":{\"type\"");
  }
  @Test public void search(){
    ResponseEntity<String> response=this.restTemplate.getForEntity("/actuator/jolokia/search/java.lang:*",String.class);
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(response.getBody()).contains("GarbageCollector");
  }
  @Test public void read(){
    ResponseEntity<String> response=this.restTemplate.getForEntity("/actuator/jolokia/read/java.lang:type=Memory",String.class);
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(response.getBody()).contains("NonHeapMemoryUsage");
  }
  @Test public void list(){
    ResponseEntity<String> response=this.restTemplate.getForEntity("/actuator/jolokia/list/java.lang/type=Memory/attr",String.class);
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(response.getBody()).contains("NonHeapMemoryUsage");
  }
@Configuration @MinimalWebConfiguration @Import({JacksonAutoConfiguration.class,HttpMessageConvertersAutoConfiguration.class,JolokiaEndpointAutoConfiguration.class,EndpointAutoConfiguration.class,WebEndpointAutoConfiguration.class,ServletManagementContextAutoConfiguration.class,ManagementContextAutoConfiguration.class,ServletEndpointManagementContextConfiguration.class}) protected static class Application {
  }
  @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Import({ServletWebServerFactoryAutoConfiguration.class,DispatcherServletAutoConfiguration.class,ValidationAutoConfiguration.class,WebMvcAutoConfiguration.class,JacksonAutoConfiguration.class,ErrorMvcAutoConfiguration.class,PropertyPlaceholderAutoConfiguration.class}) protected @interface MinimalWebConfiguration {}
}
