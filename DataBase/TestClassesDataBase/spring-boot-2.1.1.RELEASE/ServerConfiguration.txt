@Configuration @EnableWebMvc static class ServerConfiguration {
  @Bean public ServletWebServerFactory container(){
    return new TomcatServletWebServerFactory(0);
  }
  @Bean public DispatcherServlet dispatcherServlet(){
    return new DispatcherServlet();
  }
  @Bean public MyController myController(){
    return new MyController();
  }
  @Bean public DispatcherFilter filter(  AnnotationConfigServletWebServerApplicationContext context){
    TargetServerConnection connection=new SocketTargetServerConnection(() -> context.getWebServer().getPort());
    HttpTunnelServer server=new HttpTunnelServer(connection);
    HandlerMapper mapper=new UrlHandlerMapper("/httptunnel",new HttpTunnelServerHandler(server));
    Collection<HandlerMapper> mappers=Collections.singleton(mapper);
    Dispatcher dispatcher=new Dispatcher(AccessManager.PERMIT_ALL,mappers);
    return new DispatcherFilter(dispatcher);
  }
}
