/** 
 * Tests for  {@link MetricsWebClientCustomizer}
 * @author Brian Clozel
 */
public class MetricsWebClientCustomizerTests {
  private MetricsWebClientCustomizer customizer;
  private WebClient.Builder clientBuilder;
  @Before public void setup(){
    this.customizer=new MetricsWebClientCustomizer(mock(MeterRegistry.class),mock(WebClientExchangeTagsProvider.class),"test");
    this.clientBuilder=WebClient.builder();
  }
  @Test public void customizeShouldAddFilterFunction(){
    this.clientBuilder.filter(mock(ExchangeFilterFunction.class));
    this.customizer.customize(this.clientBuilder);
    this.clientBuilder.filters((filters) -> assertThat(filters).hasSize(2).first().isInstanceOf(MetricsWebClientFilterFunction.class));
  }
  @Test public void customizeShouldNotAddDuplicateFilterFunction(){
    this.customizer.customize(this.clientBuilder);
    this.clientBuilder.filters((filters) -> assertThat(filters).hasSize(1));
    this.customizer.customize(this.clientBuilder);
    this.clientBuilder.filters((filters) -> assertThat(filters).hasSize(1).first().isInstanceOf(MetricsWebClientFilterFunction.class));
  }
}
