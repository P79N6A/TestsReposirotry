/** 
 * Basic integration tests for demo application.
 * @author Dave Syer
 */
@RunWith(SpringRunner.class) @SpringBootTest(classes={SampleSecureApplication.class}) public class SampleSecureApplicationTests {
  @Autowired private SampleService service;
  private Authentication authentication;
  @Before public void init(){
    this.authentication=new UsernamePasswordAuthenticationToken("user","password");
  }
  @After public void close(){
    SecurityContextHolder.clearContext();
  }
  @Test(expected=AuthenticationException.class) public void secure(){
    assertThat("Hello Security").isEqualTo(this.service.secure());
  }
  @Test public void authenticated(){
    SecurityContextHolder.getContext().setAuthentication(this.authentication);
    assertThat("Hello Security").isEqualTo(this.service.secure());
  }
  @Test public void preauth(){
    SecurityContextHolder.getContext().setAuthentication(this.authentication);
    assertThat("Hello World").isEqualTo(this.service.authorized());
  }
  @Test(expected=AccessDeniedException.class) public void denied(){
    SecurityContextHolder.getContext().setAuthentication(this.authentication);
    assertThat("Goodbye World").isEqualTo(this.service.denied());
  }
}
