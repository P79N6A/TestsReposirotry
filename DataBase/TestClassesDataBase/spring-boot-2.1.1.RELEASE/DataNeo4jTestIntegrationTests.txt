/** 
 * Integration test for  {@link DataNeo4jTest}.
 * @author Eddú Meléndez
 * @author Stephane Nicoll
 */
@RunWith(SpringRunner.class) @ContextConfiguration(initializers=DataNeo4jTestIntegrationTests.Initializer.class) @DataNeo4jTest public class DataNeo4jTestIntegrationTests {
  @ClassRule public static Neo4jContainer neo4j=new Neo4jContainer();
  @Autowired private Session session;
  @Autowired private ExampleRepository exampleRepository;
  @Autowired private ApplicationContext applicationContext;
  @Test public void testRepository(){
    ExampleGraph exampleGraph=new ExampleGraph();
    exampleGraph.setDescription("Look, new @DataNeo4jTest!");
    assertThat(exampleGraph.getId()).isNull();
    ExampleGraph savedGraph=this.exampleRepository.save(exampleGraph);
    assertThat(savedGraph.getId()).isNotNull();
    assertThat(this.session.countEntitiesOfType(ExampleGraph.class)).isEqualTo(1);
  }
  @Test public void didNotInjectExampleService(){
    assertThatExceptionOfType(NoSuchBeanDefinitionException.class).isThrownBy(() -> this.applicationContext.getBean(ExampleService.class));
  }
static class Initializer implements ApplicationContextInitializer<ConfigurableApplicationContext> {
    @Override public void initialize(    ConfigurableApplicationContext configurableApplicationContext){
      TestPropertyValues.of("spring.data.neo4j.uri=bolt://localhost:" + neo4j.getMappedPort()).applyTo(configurableApplicationContext.getEnvironment());
    }
  }
}
