/** 
 * Integration tests for  {@link RestDocsAutoConfiguration} with Mock MVC.
 * @author Andy Wilkinson
 */
@RunWith(SpringRunner.class) @WebMvcTest @AutoConfigureRestDocs(uriScheme="https",uriHost="api.example.com",uriPort=443) public class MockMvcRestDocsAutoConfigurationIntegrationTests {
  @Before public void deleteSnippets(){
    FileSystemUtils.deleteRecursively(new File("target/generated-snippets"));
  }
  @Autowired private MockMvc mvc;
  @Test public void defaultSnippetsAreWritten() throws Exception {
    this.mvc.perform(get("/")).andDo(document("default-snippets"));
    File defaultSnippetsDir=new File("target/generated-snippets/default-snippets");
    assertThat(defaultSnippetsDir).exists();
    assertThat(new File(defaultSnippetsDir,"curl-request.adoc")).has(contentContaining("'https://api.example.com/'"));
    assertThat(new File(defaultSnippetsDir,"http-request.adoc")).has(contentContaining("api.example.com"));
    assertThat(new File(defaultSnippetsDir,"http-response.adoc")).isFile();
  }
  private Condition<File> contentContaining(  String toContain){
    return new ContentContainingCondition(toContain);
  }
}
