static class TunnelConfiguration {
  @Bean public TunnelClient tunnelClient(  @Value("${server.port}") int serverPort){
    String url="http://localhost:" + serverPort + "/httptunnel";
    TunnelConnection connection=new HttpTunnelConnection(url,new SimpleClientHttpRequestFactory());
    return new TestTunnelClient(0,connection);
  }
static class TestTunnelClient extends TunnelClient {
    private int port;
    TestTunnelClient(    int listenPort,    TunnelConnection tunnelConnection){
      super(listenPort,tunnelConnection);
    }
    @Override public int start() throws IOException {
      this.port=super.start();
      return this.port;
    }
  }
}
