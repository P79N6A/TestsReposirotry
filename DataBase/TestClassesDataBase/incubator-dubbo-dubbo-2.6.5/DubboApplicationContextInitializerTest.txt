public class DubboApplicationContextInitializerTest {
  @Test public void testSpringContextLoaderListenerInWebXml() throws Exception {
    Tomcat tomcat=new Tomcat();
    tomcat.setBaseDir("target/test-classes");
    tomcat.setPort(12345);
    StandardContext context=new StandardContext();
    context.setName("test");
    context.setDocBase("test");
    context.setPath("/test");
    context.addLifecycleListener(new ContextConfig());
    tomcat.getHost().addChild(context);
    tomcat.start();
    Assert.assertEquals(1,context.getApplicationLifecycleListeners().length);
    Assert.assertTrue(context.getApplicationLifecycleListeners()[0] instanceof ContextLoaderListener);
    tomcat.stop();
    tomcat.destroy();
  }
  @Test public void testNoListenerInWebXml() throws Exception {
    Tomcat tomcat=new Tomcat();
    tomcat.setBaseDir("target/test-classes");
    tomcat.setPort(12345);
    StandardContext context=new StandardContext();
    context.setName("test2");
    context.setDocBase("test2");
    context.setPath("/test2");
    context.addLifecycleListener(new ContextConfig());
    tomcat.getHost().addChild(context);
    tomcat.start();
    Assert.assertEquals(1,context.getApplicationLifecycleListeners().length);
    Assert.assertTrue(context.getApplicationLifecycleListeners()[0] instanceof ContextLoaderListener);
    tomcat.stop();
    tomcat.destroy();
  }
  @Test public void testMetadataComplete() throws Exception {
    Tomcat tomcat=new Tomcat();
    tomcat.setBaseDir("target/test-classes");
    tomcat.setPort(12345);
    StandardContext context=new StandardContext();
    context.setName("test3");
    context.setDocBase("test3");
    context.setPath("/test3");
    context.addLifecycleListener(new ContextConfig());
    tomcat.getHost().addChild(context);
    tomcat.start();
    Assert.assertEquals(0,context.getApplicationLifecycleListeners().length);
    tomcat.stop();
    tomcat.destroy();
  }
}
