public class DubboApplicationListenerTest {
  @Test public void testTwoShutdownHook(){
    DubboShutdownHook spyHook=Mockito.spy(DubboShutdownHook.getDubboShutdownHook());
    ClassPathXmlApplicationContext applicationContext=getApplicationContext(spyHook,true);
    applicationContext.refresh();
    applicationContext.close();
    try {
      spyHook.start();
      spyHook.join();
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    Mockito.verify(spyHook,Mockito.times(2)).destroyAll();
  }
  @Test public void testOneShutdownHook(){
    DubboShutdownHook spyHook=Mockito.spy(DubboShutdownHook.getDubboShutdownHook());
    ClassPathXmlApplicationContext applicationContext=getApplicationContext(spyHook,false);
    applicationContext.refresh();
    applicationContext.close();
    Mockito.verify(spyHook,Mockito.times(1)).destroyAll();
  }
  private ClassPathXmlApplicationContext getApplicationContext(  DubboShutdownHook hook,  boolean registerHook){
    DubboBootstrap bootstrap=new DubboBootstrap(registerHook,hook);
    ClassPathXmlApplicationContext applicationContext=new ClassPathXmlApplicationContext();
    applicationContext.addApplicationListener(new DubboApplicationListener(bootstrap));
    return applicationContext;
  }
}
