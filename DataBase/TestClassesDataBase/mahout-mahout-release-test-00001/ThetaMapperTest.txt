public class ThetaMapperTest extends MahoutTestCase {
  @Test public void standard() throws Exception {
    Mapper.Context ctx=EasyMock.createMock(Mapper.Context.class);
    ComplementaryThetaTrainer trainer=EasyMock.createMock(ComplementaryThetaTrainer.class);
    Vector instance1=new DenseVector(new double[]{1,2,3});
    Vector instance2=new DenseVector(new double[]{4,5,6});
    Vector perLabelThetaNormalizer=new DenseVector(new double[]{7,8});
    ThetaMapper thetaMapper=new ThetaMapper();
    setField(thetaMapper,"trainer",trainer);
    trainer.train(0,instance1);
    trainer.train(1,instance2);
    EasyMock.expect(trainer.retrievePerLabelThetaNormalizer()).andReturn(perLabelThetaNormalizer);
    ctx.write(new Text(TrainNaiveBayesJob.LABEL_THETA_NORMALIZER),new VectorWritable(perLabelThetaNormalizer));
    EasyMock.replay(ctx,trainer);
    thetaMapper.map(new IntWritable(0),new VectorWritable(instance1),ctx);
    thetaMapper.map(new IntWritable(1),new VectorWritable(instance2),ctx);
    thetaMapper.cleanup(ctx);
    EasyMock.verify(ctx,trainer);
  }
}
