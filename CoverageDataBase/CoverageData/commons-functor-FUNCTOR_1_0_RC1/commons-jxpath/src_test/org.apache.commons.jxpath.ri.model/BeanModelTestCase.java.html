<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>BeanModelTestCase.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">commons-jxpath (Jan 19, 2019 5:24:34 PM)</a> &gt; <a href="../../index.html" class="el_group">commons-jxpath</a> &gt; <a href="../index.html" class="el_bundle">src/test</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.jxpath.ri.model</a> &gt; <span class="el_source">BeanModelTestCase.java</span></div><h1>BeanModelTestCase.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.jxpath.ri.model;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;

import org.apache.commons.jxpath.AbstractFactory;
import org.apache.commons.jxpath.ClassFunctions;
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.JXPathTestCase;
import org.apache.commons.jxpath.NestedTestBean;
import org.apache.commons.jxpath.Pointer;
import org.apache.commons.jxpath.ri.QName;
import org.apache.commons.jxpath.ri.compiler.NodeNameTest;
import org.apache.commons.jxpath.ri.compiler.TestFunctions;
import org.apache.commons.jxpath.ri.model.beans.PropertyOwnerPointer;
import org.apache.commons.jxpath.ri.model.beans.PropertyPointer;
import org.apache.commons.jxpath.ri.model.dynabeans.DynaBeanModelTest;

/**
 * Abstract superclass for Bean access with JXPath.
 *
 * @author Dmitri Plotnikov
 * @version $Revision$ $Date$
 */
<span class="fc" id="L44">public abstract class BeanModelTestCase extends JXPathTestCase {</span>
    private JXPathContext context;

    public void setUp() {
//        if (context == null) {
<span class="fc" id="L49">            context = JXPathContext.newContext(createContextBean());</span>
<span class="fc" id="L50">            context.setLocale(Locale.US);</span>
<span class="fc" id="L51">            context.setFactory(getAbstractFactory());</span>
//        }
<span class="fc" id="L53">    }</span>

    protected abstract Object createContextBean();
    protected abstract AbstractFactory getAbstractFactory();

    /**
     * Test property iterators, the core of the graph traversal engine
     */
    public void testIndividualIterators() {
<span class="fc" id="L62">        testIndividual(+1, 0, true, false, 0);</span>
<span class="fc" id="L63">        testIndividual(-1, 0, true, false, 4);</span>

<span class="fc" id="L65">        testIndividual(0, -1, true, true, 4);</span>
<span class="fc" id="L66">        testIndividual(+1, -1, true, true, 4);</span>
<span class="fc" id="L67">        testIndividual(-1, -1, true, true, 0);</span>

<span class="fc" id="L69">        testIndividual(0, 1, true, false, 2);</span>
<span class="fc" id="L70">        testIndividual(0, 1, true, true, 1);</span>

<span class="fc" id="L72">        testIndividual(0, 0, false, false, 4);</span>
<span class="fc" id="L73">        testIndividual(0, 0, false, true, 4);</span>
<span class="fc" id="L74">    }</span>

    private void testIndividual(
        int relativePropertyIndex,
        int offset,
        boolean useStartLocation,
        boolean reverse,
        int expected) 
    {
<span class="fc" id="L83">        PropertyOwnerPointer root =</span>
<span class="fc" id="L84">            (PropertyOwnerPointer) NodePointer.newNodePointer(</span>
<span class="fc" id="L85">                new QName(null, &quot;root&quot;),</span>
<span class="fc" id="L86">                createContextBean(),</span>
<span class="fc" id="L87">                Locale.getDefault());</span>

        NodeIterator it;

<span class="fc" id="L91">        PropertyPointer start = null;</span>

<span class="fc bfc" id="L93" title="All 2 branches covered.">        if (useStartLocation) {</span>
<span class="fc" id="L94">            start = root.getPropertyPointer();</span>
<span class="fc" id="L95">            start.setPropertyIndex(</span>
<span class="fc" id="L96">                relativeProperty(start, relativePropertyIndex));</span>
<span class="fc" id="L97">            start.setIndex(offset);</span>
        }
<span class="fc" id="L99">        it =</span>
<span class="fc" id="L100">            root.childIterator(</span>
<span class="fc" id="L101">                new NodeNameTest(new QName(null, &quot;integers&quot;)),</span>
<span class="fc" id="L102">                reverse,</span>
<span class="fc" id="L103">                start);</span>

<span class="fc" id="L105">        int size = 0;</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">        while (it.setPosition(it.getPosition() + 1)) {</span>
<span class="fc" id="L107">            size++;</span>
        }
<span class="fc" id="L109">        assertEquals(</span>
<span class="fc" id="L110">            &quot;ITERATIONS: Individual, relativePropertyIndex=&quot;</span>
<span class="fc" id="L111">                + relativePropertyIndex</span>
<span class="fc" id="L112">                + &quot;, offset=&quot;</span>
<span class="fc" id="L113">                + offset</span>
<span class="fc" id="L114">                + &quot;, useStartLocation=&quot;</span>
<span class="fc" id="L115">                + useStartLocation</span>
<span class="fc" id="L116">                + &quot;, reverse=&quot;</span>
<span class="fc" id="L117">                + reverse,</span>
<span class="fc" id="L118">            expected,</span>
<span class="fc" id="L119">            size);</span>
<span class="fc" id="L120">    }</span>

    /**
     * Test property iterators with multiple properties returned
     */
    public void testMultipleIterators() {
<span class="fc" id="L126">        testMultiple(0, 0, true, false, 20);</span>

<span class="fc" id="L128">        testMultiple(3, 0, true, false, 16);</span>
<span class="fc" id="L129">        testMultiple(3, -1, true, true, 8);</span>
<span class="fc" id="L130">        testMultiple(3, 0, true, true, 4);</span>
<span class="fc" id="L131">        testMultiple(0, 0, false, false, 21);</span>
<span class="fc" id="L132">        testMultiple(0, 0, false, true, 21);</span>

<span class="fc" id="L134">        testMultiple(3, 1, true, false, 15);</span>
<span class="fc" id="L135">        testMultiple(3, 3, true, false, 13);</span>
<span class="fc" id="L136">    }</span>

    private void testMultiple(
        int propertyIndex,
        int offset,
        boolean useStartLocation,
        boolean reverse,
        int expected) 
    {
<span class="fc" id="L145">        PropertyOwnerPointer root =</span>
<span class="fc" id="L146">            (PropertyOwnerPointer) NodePointer.newNodePointer(</span>
<span class="fc" id="L147">                new QName(null, &quot;root&quot;),</span>
<span class="fc" id="L148">                createContextBean(),</span>
<span class="fc" id="L149">                Locale.getDefault());</span>
        NodeIterator it;

<span class="fc" id="L152">        PropertyPointer start = null;</span>

<span class="fc bfc" id="L154" title="All 2 branches covered.">        if (useStartLocation) {</span>
<span class="fc" id="L155">            start = root.getPropertyPointer();</span>
<span class="fc" id="L156">            start.setPropertyIndex(propertyIndex);</span>
<span class="fc" id="L157">            start.setIndex(offset);</span>
        }
<span class="fc" id="L159">        it = root.childIterator(null, reverse, start);</span>

<span class="fc" id="L161">        int size = 0;</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">        while (it.setPosition(it.getPosition() + 1)) {</span>
//            System.err.println(&quot;LOC: &quot; + it.getCurrentNodePointer());
<span class="fc" id="L164">            size++;</span>
        }
<span class="fc" id="L166">        assertEquals(</span>
<span class="fc" id="L167">            &quot;ITERATIONS: Multiple, propertyIndex=&quot;</span>
<span class="fc" id="L168">                + propertyIndex</span>
<span class="fc" id="L169">                + &quot;, offset=&quot;</span>
<span class="fc" id="L170">                + offset</span>
<span class="fc" id="L171">                + &quot;, useStartLocation=&quot;</span>
<span class="fc" id="L172">                + useStartLocation</span>
<span class="fc" id="L173">                + &quot;, reverse=&quot;</span>
<span class="fc" id="L174">                + reverse,</span>
<span class="fc" id="L175">            expected,</span>
<span class="fc" id="L176">            size);</span>
<span class="fc" id="L177">    }</span>

    private int relativeProperty(PropertyPointer holder, int offset) {
<span class="fc" id="L180">        String[] names = holder.getPropertyNames();</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">        for (int i = 0; i &lt; names.length; i++) {</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">            if (names[i].equals(&quot;integers&quot;)) {</span>
<span class="fc" id="L183">                return i + offset;</span>
            }
        }
<span class="nc" id="L186">        return -1;</span>
    }

    public void testIteratePropertyArrayWithHasNext() {
<span class="fc" id="L190">        JXPathContext context = JXPathContext.newContext(createContextBean());</span>
<span class="fc" id="L191">        Iterator it = context.iteratePointers(&quot;/integers&quot;);</span>
<span class="fc" id="L192">        List actual = new ArrayList();</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">        while (it.hasNext()) {</span>
<span class="fc" id="L194">            actual.add(((Pointer) it.next()).asPath());</span>
        }
<span class="fc" id="L196">        assertEquals(</span>
<span class="fc" id="L197">            &quot;Iterating 'hasNext'/'next'&lt;&quot; + &quot;/integers&quot; + &quot;&gt;&quot;,</span>
<span class="fc" id="L198">            list(</span>
<span class="fc" id="L199">                &quot;/integers[1]&quot;,</span>
<span class="fc" id="L200">                &quot;/integers[2]&quot;,</span>
<span class="fc" id="L201">                &quot;/integers[3]&quot;,</span>
<span class="fc" id="L202">                &quot;/integers[4]&quot;),</span>
<span class="fc" id="L203">            actual);</span>
<span class="fc" id="L204">    }</span>

    public void testIteratePropertyArrayWithoutHasNext() {
<span class="fc" id="L207">        JXPathContext context = JXPathContext.newContext(createContextBean());</span>
<span class="fc" id="L208">        Iterator it = context.iteratePointers(&quot;/integers&quot;);</span>
<span class="fc" id="L209">        List actual = new ArrayList();</span>
<span class="fc bfc" id="L210" title="All 2 branches covered.">        for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc" id="L211">            actual.add(it.next().toString());</span>
        }
<span class="fc" id="L213">        assertEquals(</span>
<span class="fc" id="L214">            &quot;Iterating 'next'&lt;&quot; + &quot;/integers&quot; + &quot;&gt;&quot;,</span>
<span class="fc" id="L215">            list(</span>
<span class="fc" id="L216">                &quot;/integers[1]&quot;,</span>
<span class="fc" id="L217">                &quot;/integers[2]&quot;,</span>
<span class="fc" id="L218">                &quot;/integers[3]&quot;,</span>
<span class="fc" id="L219">                &quot;/integers[4]&quot;),</span>
<span class="fc" id="L220">            actual);</span>
<span class="fc" id="L221">    }</span>

    public void testIterateAndSet() {
<span class="fc" id="L224">        JXPathContext context = JXPathContext.newContext(createContextBean());</span>

<span class="fc" id="L226">        Iterator it = context.iteratePointers(&quot;beans/int&quot;);</span>
<span class="fc" id="L227">        int i = 5;</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">        while (it.hasNext()) {</span>
<span class="fc" id="L229">            NodePointer pointer = (NodePointer) it.next();</span>
<span class="fc" id="L230">            pointer.setValue(new Integer(i++));</span>
        }

<span class="fc" id="L233">        it = context.iteratePointers(&quot;beans/int&quot;);</span>
<span class="fc" id="L234">        List actual = new ArrayList();</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">        while (it.hasNext()) {</span>
<span class="fc" id="L236">            actual.add(((Pointer) it.next()).getValue());</span>
        }
<span class="fc" id="L238">        assertEquals(</span>
<span class="fc" id="L239">            &quot;Iterating &lt;&quot; + &quot;beans/int&quot; + &quot;&gt;&quot;,</span>
<span class="fc" id="L240">            list(new Integer(5), new Integer(6)),</span>
<span class="fc" id="L241">            actual);</span>
<span class="fc" id="L242">    }</span>

    /**
     * Test contributed by Kate Dvortsova
     */
    public void testIteratePointerSetValue() {
<span class="fc" id="L248">        JXPathContext context = JXPathContext.newContext(createContextBean());</span>

<span class="fc" id="L250">        assertXPathValue(context, &quot;/beans[1]/name&quot;, &quot;Name 1&quot;);</span>
<span class="fc" id="L251">        assertXPathValue(context, &quot;/beans[2]/name&quot;, &quot;Name 2&quot;);</span>

        // Test setting via context
<span class="fc" id="L254">        context.setValue(&quot;/beans[2]/name&quot;, &quot;Name 2 set&quot;);</span>
<span class="fc" id="L255">        assertXPathValue(context, &quot;/beans[2]/name&quot;, &quot;Name 2 set&quot;);</span>

        // Restore original value
<span class="fc" id="L258">        context.setValue(&quot;/beans[2]/name&quot;, &quot;Name 2&quot;);</span>
<span class="fc" id="L259">        assertXPathValue(context, &quot;/beans[2]/name&quot;, &quot;Name 2&quot;);</span>

<span class="fc" id="L261">        int iterCount = 0;</span>
<span class="fc" id="L262">        Iterator iter = context.iteratePointers(&quot;/beans/name&quot;);</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">        while (iter.hasNext()) {</span>
<span class="fc" id="L264">            iterCount++;</span>
<span class="fc" id="L265">            Pointer pointer = (Pointer) iter.next();</span>
<span class="fc" id="L266">            String s = (String) pointer.getValue();</span>
<span class="fc" id="L267">            s = s + &quot;suffix&quot;;</span>
<span class="fc" id="L268">            pointer.setValue(s);</span>
<span class="fc" id="L269">            assertEquals(&quot;pointer.getValue&quot;, s, pointer.getValue());</span>
            // fails right here, the value isn't getting set in the bean.
<span class="fc" id="L271">            assertEquals(</span>
<span class="fc" id="L272">                &quot;context.getValue&quot;,</span>
<span class="fc" id="L273">                s,</span>
<span class="fc" id="L274">                context.getValue(pointer.asPath()));</span>
        }
<span class="fc" id="L276">        assertEquals(&quot;Iteration count&quot;, 2, iterCount);</span>

<span class="fc" id="L278">        assertXPathValue(context, &quot;/beans[1]/name&quot;, &quot;Name 1suffix&quot;);</span>
<span class="fc" id="L279">        assertXPathValue(context, &quot;/beans[2]/name&quot;, &quot;Name 2suffix&quot;);</span>
<span class="fc" id="L280">    }</span>

    public void testRoot() {
<span class="fc" id="L283">        assertXPathValueAndPointer(context, &quot;/&quot;, context.getContextBean(), &quot;/&quot;);</span>
<span class="fc" id="L284">    }</span>

    public void testAxisAncestor() {
        // ancestor::
<span class="fc" id="L288">        assertXPathValue(context, &quot;int/ancestor::root = /&quot;, Boolean.TRUE);</span>

<span class="fc" id="L290">        assertXPathValue(</span>
<span class="fc" id="L291">            context,</span>
<span class="fc" id="L292">            &quot;count(beans/name/ancestor-or-self::node())&quot;,</span>
<span class="fc" id="L293">            new Double(5));</span>

<span class="fc" id="L295">        assertXPathValue(</span>
<span class="fc" id="L296">            context,</span>
<span class="fc" id="L297">            &quot;beans/name/ancestor-or-self::node()[3] = /&quot;,</span>
<span class="fc" id="L298">            Boolean.TRUE);</span>
<span class="fc" id="L299">    }</span>

    public void testAxisChild() {
<span class="fc" id="L302">        assertXPathValue(context, &quot;boolean&quot;, Boolean.FALSE);</span>

<span class="fc" id="L304">        assertXPathPointer(context, &quot;boolean&quot;, &quot;/boolean&quot;);</span>

<span class="fc" id="L306">        assertXPathPointerIterator(context, &quot;boolean&quot;, list(&quot;/boolean&quot;));</span>

        // Count elements in a child collection
<span class="fc" id="L309">        assertXPathValue(context, &quot;count(set)&quot;, new Double(3));</span>

//        assertXPathValue(context,&quot;boolean/class/name&quot;, &quot;java.lang.Boolean&quot;);

        // Child with namespace - should not find any
<span class="fc" id="L314">        assertXPathValueIterator(context, &quot;foo:boolean&quot;, list());</span>

        // Count all children with a wildcard
<span class="fc" id="L317">        assertXPathValue(context, &quot;count(*)&quot;, new Double(21));</span>

        // Same, constrained by node type = node()
<span class="fc" id="L320">        assertXPathValue(context, &quot;count(child::node())&quot;, new Double(21));</span>
<span class="fc" id="L321">    }</span>

    public void testAxisChildNestedBean() {
        // Nested bean
<span class="fc" id="L325">        assertXPathValue(context, &quot;nestedBean/name&quot;, &quot;Name 0&quot;);</span>

<span class="fc" id="L327">        assertXPathPointer(context, &quot;nestedBean/name&quot;, &quot;/nestedBean/name&quot;);</span>

<span class="fc" id="L329">        assertXPathPointerIterator(</span>
<span class="fc" id="L330">            context,</span>
<span class="fc" id="L331">            &quot;nestedBean/name&quot;,</span>
<span class="fc" id="L332">            list(&quot;/nestedBean/name&quot;));</span>
<span class="fc" id="L333">    }</span>

    public void testAxisChildNestedCollection() {
<span class="fc" id="L336">        assertXPathValueIterator(</span>
<span class="fc" id="L337">            context,</span>
<span class="fc" id="L338">            &quot;integers&quot;,</span>
<span class="fc" id="L339">            list(</span>
<span class="fc" id="L340">                new Integer(1),</span>
<span class="fc" id="L341">                new Integer(2),</span>
<span class="fc" id="L342">                new Integer(3),</span>
<span class="fc" id="L343">                new Integer(4)));</span>

<span class="fc" id="L345">        assertXPathPointer(context, &quot;integers&quot;, &quot;/integers&quot;);</span>

<span class="fc" id="L347">        assertXPathPointerIterator(</span>
<span class="fc" id="L348">            context,</span>
<span class="fc" id="L349">            &quot;integers&quot;,</span>
<span class="fc" id="L350">            list(</span>
<span class="fc" id="L351">                &quot;/integers[1]&quot;,</span>
<span class="fc" id="L352">                &quot;/integers[2]&quot;,</span>
<span class="fc" id="L353">                &quot;/integers[3]&quot;,</span>
<span class="fc" id="L354">                &quot;/integers[4]&quot;));</span>
<span class="fc" id="L355">    }</span>

    public void testIndexPredicate() {
<span class="fc" id="L358">        assertXPathValue(context, &quot;integers[2]&quot;, new Integer(2));</span>

<span class="fc" id="L360">        assertXPathPointer(context, &quot;integers[2]&quot;, &quot;/integers[2]&quot;);</span>

<span class="fc" id="L362">        assertXPathPointerIterator(</span>
<span class="fc" id="L363">            context,</span>
<span class="fc" id="L364">            &quot;integers[2]&quot;,</span>
<span class="fc" id="L365">            list(&quot;/integers[2]&quot;));</span>

<span class="fc" id="L367">        assertXPathValue(context, &quot;beans[1]/name&quot;, &quot;Name 1&quot;);</span>

<span class="fc" id="L369">        assertXPathPointer(context, &quot;beans[1]/name&quot;, &quot;/beans[1]/name&quot;);</span>

<span class="fc" id="L371">        assertXPathValueIterator(</span>
<span class="fc" id="L372">            context,</span>
<span class="fc" id="L373">            &quot;beans[1]/strings&quot;,</span>
<span class="fc" id="L374">            list(&quot;String 1&quot;, &quot;String 2&quot;, &quot;String 3&quot;));</span>

<span class="fc" id="L376">        assertXPathValueIterator(</span>
<span class="fc" id="L377">            context,</span>
<span class="fc" id="L378">            &quot;beans/strings[2]&quot;,</span>
<span class="fc" id="L379">            list(&quot;String 2&quot;, &quot;String 2&quot;));</span>

        // Find the first match
<span class="fc" id="L382">        assertXPathValue(context, &quot;beans/strings[2]&quot;, &quot;String 2&quot;);</span>

        // Indexing in a set collected from a UnionContext
<span class="fc" id="L385">        assertXPathValue(context, &quot;(beans/strings[2])[1]&quot;, &quot;String 2&quot;);</span>
<span class="fc" id="L386">    }</span>

    public void testAxisDescendant() {
        // descendant::
<span class="fc" id="L390">        assertXPathValue(context, &quot;count(descendant::node())&quot;, new Double(65));</span>

        // Should not find any descendants with name root
<span class="fc" id="L393">        assertXPathValue(context, &quot;count(descendant::root)&quot;, new Double(0));</span>

<span class="fc" id="L395">        assertXPathValue(context, &quot;count(descendant::name)&quot;, new Double(7));</span>
<span class="fc" id="L396">    }</span>

    public void testAxisDescendantOrSelf() {
        // descendant-or-self::
<span class="fc" id="L400">        assertXPathValueIterator(</span>
<span class="fc" id="L401">            context,</span>
<span class="fc" id="L402">            &quot;descendant-or-self::name&quot;,</span>
<span class="fc" id="L403">            set(</span>
<span class="fc" id="L404">                &quot;Name 1&quot;,</span>
<span class="fc" id="L405">                &quot;Name 2&quot;,</span>
<span class="fc" id="L406">                &quot;Name 3&quot;,</span>
<span class="fc" id="L407">                &quot;Name 6&quot;,</span>
<span class="fc" id="L408">                &quot;Name 0&quot;,</span>
<span class="fc" id="L409">                &quot;Name 5&quot;,</span>
<span class="fc" id="L410">                &quot;Name 4&quot;));</span>

        // Same - abbreviated syntax
<span class="fc" id="L413">        assertXPathValueIterator(</span>
<span class="fc" id="L414">            context,</span>
<span class="fc" id="L415">            &quot;//name&quot;,</span>
<span class="fc" id="L416">            set(</span>
<span class="fc" id="L417">                &quot;Name 1&quot;,</span>
<span class="fc" id="L418">                &quot;Name 2&quot;,</span>
<span class="fc" id="L419">                &quot;Name 3&quot;,</span>
<span class="fc" id="L420">                &quot;Name 6&quot;,</span>
<span class="fc" id="L421">                &quot;Name 0&quot;,</span>
<span class="fc" id="L422">                &quot;Name 5&quot;,</span>
<span class="fc" id="L423">                &quot;Name 4&quot;));</span>

        // See that it actually finds self
<span class="fc" id="L426">        assertXPathValue(</span>
<span class="fc" id="L427">            context,</span>
<span class="fc" id="L428">            &quot;count(descendant-or-self::root)&quot;,</span>
<span class="fc" id="L429">            new Double(1));</span>

        // Combine descendant-or-self:: and and self::
<span class="fc" id="L432">        assertXPathValue(context, &quot;count(nestedBean//.)&quot;, new Double(7));</span>

        // Combine descendant-or-self:: and and self::name
<span class="fc" id="L435">        assertXPathValue(context, &quot;count(//self::beans)&quot;, new Double(2));</span>

        // Count all nodes in the tree
<span class="fc" id="L438">        assertXPathValue(</span>
<span class="fc" id="L439">            context,</span>
<span class="fc" id="L440">            &quot;count(descendant-or-self::node())&quot;,</span>
<span class="fc" id="L441">            new Double(66));</span>

<span class="fc" id="L443">    }</span>

    public void testAxisFollowing() {
        // following::
<span class="fc" id="L447">        assertXPathValue(</span>
<span class="fc" id="L448">            context,</span>
<span class="fc" id="L449">            &quot;count(nestedBean/strings[2]/following::node())&quot;,</span>
<span class="fc" id="L450">            new Double(21));</span>

<span class="fc" id="L452">        assertXPathValue(</span>
<span class="fc" id="L453">            context,</span>
<span class="fc" id="L454">            &quot;count(nestedBean/strings[2]/following::strings)&quot;,</span>
<span class="fc" id="L455">            new Double(7));</span>
<span class="fc" id="L456">    }</span>

    public void testAxisFollowingSibling() {
        // following-sibling::
<span class="fc" id="L460">        assertXPathValue(</span>
<span class="fc" id="L461">            context,</span>
<span class="fc" id="L462">            &quot;count(/nestedBean/following-sibling::node())&quot;,</span>
<span class="fc" id="L463">            new Double(8));</span>

<span class="fc" id="L465">        assertXPathValue(</span>
<span class="fc" id="L466">            context,</span>
<span class="fc" id="L467">            &quot;count(/nestedBean/following-sibling::object)&quot;,</span>
<span class="fc" id="L468">            new Double(1));</span>

        // Combine parent:: and following-sibling::
<span class="fc" id="L471">        assertXPathValue(</span>
<span class="fc" id="L472">            context,</span>
<span class="fc" id="L473">            &quot;count(/nestedBean/boolean/../following-sibling::node())&quot;,</span>
<span class="fc" id="L474">            new Double(8));</span>

<span class="fc" id="L476">        assertXPathValue(</span>
<span class="fc" id="L477">            context,</span>
<span class="fc" id="L478">            &quot;count(/nestedBean/boolean/../following-sibling::object)&quot;,</span>
<span class="fc" id="L479">            new Double(1));</span>

        // Combine descendant:: and following-sibling::
<span class="fc" id="L482">        assertXPathValue(</span>
<span class="fc" id="L483">            context,</span>
<span class="fc" id="L484">            &quot;count(/descendant::boolean/following-sibling::node())&quot;,</span>
<span class="fc" id="L485">            new Double(53));</span>

<span class="fc" id="L487">        assertXPathValue(</span>
<span class="fc" id="L488">            context,</span>
<span class="fc" id="L489">            &quot;count(/descendant::boolean/following-sibling::name)&quot;,</span>
<span class="fc" id="L490">            new Double(7));</span>
<span class="fc" id="L491">    }</span>

    public void testAxisParent() {
        // parent::
<span class="fc" id="L495">        assertXPathValue(context, &quot;count(/beans/..)&quot;, new Double(1));</span>

<span class="fc" id="L497">        assertXPathValue(context, &quot;count(//..)&quot;, new Double(9));</span>

<span class="fc" id="L499">        assertXPathValue(context, &quot;count(//../..)&quot;, new Double(2));</span>

<span class="fc" id="L501">        assertXPathValueIterator(</span>
<span class="fc" id="L502">            context,</span>
<span class="fc" id="L503">            &quot;//parent::beans/name&quot;,</span>
<span class="fc" id="L504">            list(&quot;Name 1&quot;, &quot;Name 2&quot;));</span>
<span class="fc" id="L505">    }</span>

    public void testAxisPreceding() {
        // preceding::
<span class="fc" id="L509">        assertXPathValue(</span>
<span class="fc" id="L510">            context,</span>
<span class="fc" id="L511">            &quot;count(beans[2]/int/preceding::node())&quot;,</span>
<span class="fc" id="L512">            new Double(8));</span>

<span class="fc" id="L514">        assertXPathValue(</span>
<span class="fc" id="L515">            context,</span>
<span class="fc" id="L516">            &quot;count(beans[2]/int/preceding::boolean)&quot;,</span>
<span class="fc" id="L517">            new Double(2));</span>
<span class="fc" id="L518">    }</span>

    public void testAxisPrecedingSibling() {
        // preceding-sibling::
<span class="fc" id="L522">        assertXPathValue(</span>
<span class="fc" id="L523">            context,</span>
<span class="fc" id="L524">            &quot;count(/boolean/preceding-sibling::node())&quot;,</span>
<span class="fc" id="L525">            new Double(2));</span>

<span class="fc" id="L527">        assertXPathValue(</span>
<span class="fc" id="L528">            context,</span>
<span class="fc" id="L529">            &quot;count(/nestedBean/int/../preceding-sibling::node())&quot;,</span>
<span class="fc" id="L530">            new Double(12));</span>

<span class="fc" id="L532">        assertXPathValue(</span>
<span class="fc" id="L533">            context,</span>
<span class="fc" id="L534">            &quot;count(/descendant::int/preceding-sibling::node())&quot;,</span>
<span class="fc" id="L535">            new Double(10));</span>
<span class="fc" id="L536">    }</span>

    public void testAxisSelf() {
        // self::
<span class="fc" id="L540">        assertXPathValue(context, &quot;self::node() = /&quot;, Boolean.TRUE);</span>

<span class="fc" id="L542">        assertXPathValue(context, &quot;self::root = /&quot;, Boolean.TRUE);</span>
<span class="fc" id="L543">    }</span>

    public void testUnion() {
        // Union - note corrected document order
<span class="fc" id="L547">        assertXPathValueIterator(</span>
<span class="fc" id="L548">            context,</span>
<span class="fc" id="L549">            &quot;integers | beans[1]/strings&quot;,</span>
<span class="fc" id="L550">            list(</span>
<span class="fc" id="L551">                &quot;String 1&quot;,</span>
<span class="fc" id="L552">                &quot;String 2&quot;,</span>
<span class="fc" id="L553">                &quot;String 3&quot;,</span>
<span class="fc" id="L554">                new Integer(1),</span>
<span class="fc" id="L555">                new Integer(2),</span>
<span class="fc" id="L556">                new Integer(3),</span>
<span class="fc" id="L557">                new Integer(4)));</span>

<span class="fc" id="L559">        assertXPathValue(</span>
<span class="fc" id="L560">            context,</span>
<span class="fc" id="L561">            &quot;count((integers | beans[1]/strings)[contains(., '1')])&quot;,</span>
<span class="fc" id="L562">            new Double(2));</span>

<span class="fc" id="L564">        assertXPathValue(</span>
<span class="fc" id="L565">            context,</span>
<span class="fc" id="L566">            &quot;count((integers | beans[1]/strings)[name(.) = 'strings'])&quot;,</span>
<span class="fc" id="L567">            new Double(3));</span>

        // Note that the following is different from &quot;integer[2]&quot; -
        // it is a filter expression
<span class="fc" id="L571">        assertXPathValue(context, &quot;(integers)[2]&quot;, new Integer(2));</span>
<span class="fc" id="L572">    }</span>

    public void testAxisAttribute() {
        // Attributes are just like children to beans
<span class="fc" id="L576">        assertXPathValue(context, &quot;count(@*)&quot;, new Double(21.0));</span>

        // Unknown attribute
<span class="fc" id="L579">        assertXPathValueLenient(context, &quot;@foo&quot;, null);</span>
<span class="fc" id="L580">    }</span>

    /**
     * Testing the pseudo-attribute &quot;name&quot; that java beans
     * objects appear to have.
     */
    public void testAttributeName() {
<span class="fc" id="L587">        assertXPathValue(context, &quot;nestedBean[@name = 'int']&quot;, new Integer(1));</span>

<span class="fc" id="L589">        assertXPathPointer(</span>
<span class="fc" id="L590">            context,</span>
<span class="fc" id="L591">            &quot;nestedBean[@name = 'int']&quot;,</span>
<span class="fc" id="L592">            &quot;/nestedBean/int&quot;);</span>
<span class="fc" id="L593">    }</span>

    public void testAttributeLang() {

<span class="fc" id="L597">        assertXPathValue(context, &quot;@xml:lang&quot;, &quot;en-US&quot;);</span>

<span class="fc" id="L599">        assertXPathValue(context, &quot;count(@xml:*)&quot;, new Double(1));</span>

<span class="fc" id="L601">        assertXPathValue(context, &quot;lang('en')&quot;, Boolean.TRUE);</span>

<span class="fc" id="L603">        assertXPathValue(context, &quot;lang('fr')&quot;, Boolean.FALSE);</span>
<span class="fc" id="L604">    }</span>

    public void testCoreFunctions() {

<span class="fc" id="L608">        assertXPathValue(context, &quot;boolean(boolean)&quot;, Boolean.TRUE);</span>

<span class="fc" id="L610">        assertXPathValue(context, &quot;boolean(boolean = false())&quot;, Boolean.TRUE);</span>

<span class="fc" id="L612">        assertXPathValue(</span>
<span class="fc" id="L613">            context,</span>
<span class="fc" id="L614">            &quot;boolean(integers[position() &lt; 3])&quot;,</span>
<span class="fc" id="L615">            Boolean.TRUE);</span>

<span class="fc" id="L617">        assertXPathValue(</span>
<span class="fc" id="L618">            context,</span>
<span class="fc" id="L619">            &quot;boolean(integers[position() &gt; 4])&quot;,</span>
<span class="fc" id="L620">            Boolean.FALSE);</span>

<span class="fc" id="L622">        assertXPathValue(context, &quot;sum(integers)&quot;, new Double(10));        </span>

<span class="fc" id="L624">        assertXPathValueAndPointer(</span>
<span class="fc" id="L625">                context,</span>
<span class="fc" id="L626">                &quot;integers[last()]&quot;,</span>
<span class="fc" id="L627">                new Integer(4),</span>
<span class="fc" id="L628">                &quot;/integers[4]&quot;);</span>

<span class="fc" id="L630">        assertXPathValueAndPointer(</span>
<span class="fc" id="L631">                context,</span>
<span class="fc" id="L632">                &quot;//strings[last()]&quot;,</span>
<span class="fc" id="L633">                &quot;String 3&quot;,</span>
<span class="fc" id="L634">                &quot;/beans[1]/strings[3]&quot;);</span>
<span class="fc" id="L635">    }</span>

    public void testBooleanPredicate() {
        // use child axis

        // bean[1]/int = 1
        // bean[2]/int = 3

<span class="fc" id="L643">        assertXPathValue(context, &quot;beans[int &gt; 2]/name&quot;, &quot;Name 2&quot;);</span>

<span class="fc" id="L645">        assertXPathValueIterator(</span>
<span class="fc" id="L646">            context,</span>
<span class="fc" id="L647">            &quot;beans[int &gt; 2]/name&quot;,</span>
<span class="fc" id="L648">            list(&quot;Name 2&quot;));</span>

<span class="fc" id="L650">        assertXPathValueIterator(</span>
<span class="fc" id="L651">            context,</span>
<span class="fc" id="L652">            &quot;beans[int &gt;= 1]/name&quot;,</span>
<span class="fc" id="L653">            list(&quot;Name 1&quot;, &quot;Name 2&quot;));</span>

<span class="fc" id="L655">        assertXPathValueIterator(</span>
<span class="fc" id="L656">            context,</span>
<span class="fc" id="L657">            &quot;beans[int &lt; 2]/name&quot;,</span>
<span class="fc" id="L658">            list(&quot;Name 1&quot;));</span>

<span class="fc" id="L660">        assertXPathValueIterator(</span>
<span class="fc" id="L661">            context,</span>
<span class="fc" id="L662">            &quot;beans[int &lt;= 3]/name&quot;,</span>
<span class="fc" id="L663">            list(&quot;Name 1&quot;, &quot;Name 2&quot;));</span>

<span class="fc" id="L665">        assertXPathValueIterator(</span>
<span class="fc" id="L666">            context,</span>
<span class="fc" id="L667">            &quot;beans[1]/strings[string-length() = 8]&quot;,</span>
<span class="fc" id="L668">            list(&quot;String 1&quot;, &quot;String 2&quot;, &quot;String 3&quot;));</span>

        // use some fancy axis and the child axis in the predicate
<span class="fc" id="L671">        assertXPathValueIterator(</span>
<span class="fc" id="L672">            context,</span>
<span class="fc" id="L673">            &quot;//self::node()[name = 'Name 0']/name&quot;,</span>
<span class="fc" id="L674">            list(&quot;Name 0&quot;));</span>

        // use context-dependent function in the predicate
<span class="fc" id="L677">        assertXPathValue(</span>
<span class="fc" id="L678">            context,</span>
<span class="fc" id="L679">            &quot;beans/strings[name(.)='strings'][2]&quot;,</span>
<span class="fc" id="L680">            &quot;String 2&quot;);</span>

        // use context-independent function in the predicate
<span class="fc" id="L683">        assertXPathValueIterator(</span>
<span class="fc" id="L684">            context,</span>
<span class="fc" id="L685">            &quot;//self::node()[name(.) = concat('n', 'a', 'm', 'e')]&quot;,</span>
<span class="fc" id="L686">            list(</span>
<span class="fc" id="L687">                &quot;Name 1&quot;,</span>
<span class="fc" id="L688">                &quot;Name 2&quot;,</span>
<span class="fc" id="L689">                &quot;Name 3&quot;,</span>
<span class="fc" id="L690">                &quot;Name 6&quot;,</span>
<span class="fc" id="L691">                &quot;Name 0&quot;,</span>
<span class="fc" id="L692">                &quot;Name 5&quot;,</span>
<span class="fc" id="L693">                &quot;Name 4&quot;));</span>

<span class="fc" id="L695">        assertXPathValueIterator(</span>
<span class="fc" id="L696">            context,</span>
<span class="fc" id="L697">            &quot;integers[position()&lt;3]&quot;,</span>
<span class="fc" id="L698">            list(new Integer(1), new Integer(2)));</span>
            
<span class="fc" id="L700">        context.getVariables().declareVariable(</span>
<span class="fc" id="L701">            &quot;temp&quot;,</span>
<span class="fc" id="L702">            context.getValue(&quot;beans&quot;));</span>
        
<span class="fc" id="L704">        assertXPathValueIterator(</span>
<span class="fc" id="L705">            context,</span>
<span class="fc" id="L706">            &quot;$temp[int &lt; 2]/int&quot;,</span>
<span class="fc" id="L707">            list(new Integer(1)));</span>
<span class="fc" id="L708">    }</span>

    public void testDocumentOrder() {
<span class="fc" id="L711">        assertDocumentOrder(context, &quot;boolean&quot;, &quot;int&quot;, -1);</span>

<span class="fc" id="L713">        assertDocumentOrder(context, &quot;integers[1]&quot;, &quot;integers[2]&quot;, -1);</span>

<span class="fc" id="L715">        assertDocumentOrder(context, &quot;integers[1]&quot;, &quot;integers[1]&quot;, 0);</span>

<span class="fc" id="L717">        assertDocumentOrder(context, &quot;nestedBean/int&quot;, &quot;nestedBean&quot;, 1);</span>

<span class="fc" id="L719">        assertDocumentOrder(</span>
<span class="fc" id="L720">            context,</span>
<span class="fc" id="L721">            &quot;nestedBean/int&quot;,</span>
<span class="fc" id="L722">            &quot;nestedBean/strings&quot;,</span>
<span class="fc" id="L723">            -1);</span>

<span class="fc" id="L725">        assertDocumentOrder(context, &quot;nestedBean/int&quot;, &quot;object/int&quot;, -1);</span>
<span class="fc" id="L726">    }</span>

    public void testSetPropertyValue() {
        // Simple property
<span class="fc" id="L730">        assertXPathSetValue(context, &quot;int&quot;, new Integer(2));</span>

        // Simple property with conversion from string
<span class="fc" id="L733">        assertXPathSetValue(context, &quot;int&quot;, &quot;3&quot;, new Integer(3));</span>

        // Simple property with conversion from array
<span class="fc" id="L736">        assertXPathSetValue(context, &quot;int&quot;, new int[] { 4 }, new Integer(4));</span>

        // Attribute (which is the same as a child for beans
<span class="fc" id="L739">        assertXPathSetValue(context, &quot;@int&quot;, new Integer(10));</span>
<span class="fc" id="L740">    }</span>

    public void testSetCollectionElement() {
        // Collection element
<span class="fc" id="L744">        assertXPathSetValue(context, &quot;integers[2]&quot;, new Integer(5));</span>

        // Collection element with conversion
<span class="fc" id="L747">        assertXPathSetValue(</span>
<span class="fc" id="L748">            context,</span>
<span class="fc" id="L749">            &quot;integers[2]&quot;,</span>
<span class="fc" id="L750">            new int[] { 6 },</span>
<span class="fc" id="L751">            new Integer(6));</span>
<span class="fc" id="L752">    }</span>

    public void testSetContextDependentNode() {
        // Find node without using SimplePathInterpreter
<span class="fc" id="L756">        assertXPathSetValue(</span>
<span class="fc" id="L757">            context,</span>
<span class="fc" id="L758">            &quot;integers[position() = 1]&quot;,</span>
<span class="fc" id="L759">            new Integer(8));</span>

        // Find node without using SimplePathInterpreter and set its property
<span class="fc" id="L762">        assertXPathSetValue(</span>
<span class="fc" id="L763">            context,</span>
<span class="fc" id="L764">            &quot;beans[name = 'Name 1']/int&quot;,</span>
<span class="fc" id="L765">            new Integer(9));</span>

<span class="fc" id="L767">    }</span>

    public void testSetNonPrimitiveValue() {
        // First, let's see if we can set a collection element to null
<span class="fc" id="L771">        assertXPathSetValue(context, &quot;beans[2]&quot;, null);</span>

        // Now, assign it a whole bean
<span class="fc" id="L774">        context.setValue(&quot;beans[2]&quot;, new NestedTestBean(&quot;Name 9&quot;));</span>

<span class="fc" id="L776">        assertEquals(</span>
<span class="fc" id="L777">            &quot;Modified &lt;&quot; + &quot;beans[2]/name&quot; + &quot;&gt;&quot;,</span>
<span class="fc" id="L778">            &quot;Name 9&quot;,</span>
<span class="fc" id="L779">            context.getValue(&quot;beans[2]/name&quot;));</span>
<span class="fc" id="L780">    }</span>

    public void testCreatePath() {
<span class="fc" id="L783">        context.setValue(&quot;nestedBean&quot;, null);</span>

        // Calls factory.createObject(..., TestBean, &quot;nestedBean&quot;)
<span class="fc" id="L786">        assertXPathCreatePath(</span>
<span class="fc" id="L787">            context,</span>
<span class="fc" id="L788">            &quot;/nestedBean/int&quot;,</span>
<span class="fc" id="L789">            new Integer(1),</span>
<span class="fc" id="L790">            &quot;/nestedBean/int&quot;);</span>

<span class="fc" id="L792">        boolean ex = false;</span>
        try {
<span class="pc" id="L794">            assertXPathCreatePath(</span>
<span class="fc" id="L795">                context,</span>
<span class="fc" id="L796">                &quot;/nestedBean/beans[last() + 1]&quot;,</span>
<span class="fc" id="L797">                new Integer(1),</span>
<span class="fc" id="L798">                &quot;/nestedBean/beans[last() + 1]&quot;);</span>
<span class="nc" id="L799">        }</span>
<span class="fc" id="L800">        catch (Exception e) {</span>
<span class="fc" id="L801">            ex = true;</span>
        }
<span class="fc" id="L803">        assertTrue(&quot;Exception thrown on invalid path for creation&quot;, ex);</span>
        
<span class="fc" id="L805">    }</span>

    public void testCreatePathAndSetValue() {
<span class="fc" id="L808">        context.setValue(&quot;nestedBean&quot;, null);</span>

        // Calls factory.createObject(..., TestBean, &quot;nestedBean&quot;)
<span class="fc" id="L811">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L812">            context,</span>
<span class="fc" id="L813">            &quot;/nestedBean/int&quot;,</span>
<span class="fc" id="L814">            new Integer(2),</span>
<span class="fc" id="L815">            &quot;/nestedBean/int&quot;);</span>
<span class="fc" id="L816">    }</span>

    public void testCreatePathExpandNewCollection() {
<span class="fc" id="L819">        context.setValue(&quot;beans&quot;, null);</span>

        // Calls factory.createObject(..., testBean, &quot;beans&quot;, 2), 
        // then  factory.createObject(..., testBean, &quot;beans&quot;, 2)
<span class="fc" id="L823">        assertXPathCreatePath(</span>
<span class="fc" id="L824">            context,</span>
<span class="fc" id="L825">            &quot;/beans[2]/int&quot;,</span>
<span class="fc" id="L826">            new Integer(1),</span>
<span class="fc" id="L827">            &quot;/beans[2]/int&quot;);</span>
<span class="fc" id="L828">    }</span>

    public void testCreatePathAndSetValueExpandNewCollection() {
<span class="fc" id="L831">        context.setValue(&quot;beans&quot;, null);</span>

        // Calls factory.createObject(..., testBean, &quot;beans&quot;, 2), 
        // then factory.createObject(..., testBean, &quot;beans&quot;, 2)
<span class="fc" id="L835">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L836">            context,</span>
<span class="fc" id="L837">            &quot;/beans[2]/int&quot;,</span>
<span class="fc" id="L838">            new Integer(2),</span>
<span class="fc" id="L839">            &quot;/beans[2]/int&quot;);</span>
<span class="fc" id="L840">    }</span>

    public void testCreatePathExpandExistingCollection() {
        // Calls factory.createObject(..., TestBean, &quot;integers&quot;, 5)
        // to expand collection
<span class="fc" id="L845">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L846">            context,</span>
<span class="fc" id="L847">            &quot;/integers[5]&quot;,</span>
<span class="fc" id="L848">            new Integer(3),</span>
<span class="fc" id="L849">            &quot;/integers[5]&quot;);</span>
<span class="fc" id="L850">    }</span>

    public void testCreatePathExpandExistingCollectionAndSetProperty() {
        // Another, but the collection already exists
<span class="fc" id="L854">        assertXPathCreatePath(</span>
<span class="fc" id="L855">            context,</span>
<span class="fc" id="L856">            &quot;/beans[3]/int&quot;,</span>
<span class="fc" id="L857">            new Integer(1),</span>
<span class="fc" id="L858">            &quot;/beans[3]/int&quot;);</span>
<span class="fc" id="L859">    }</span>

    public void testCreatePathAndSetValueExpandExistingCollection() {
        // Another, but the collection already exists
<span class="fc" id="L863">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L864">            context,</span>
<span class="fc" id="L865">            &quot;/beans[3]/int&quot;,</span>
<span class="fc" id="L866">            new Integer(2),</span>
<span class="fc" id="L867">            &quot;/beans[3]/int&quot;);</span>
<span class="fc" id="L868">    }</span>

    public void testCreatePathCreateBeanExpandCollection() {
<span class="fc" id="L871">        context.setValue(&quot;nestedBean&quot;, null);</span>

        // Calls factory.createObject(..., TestBean, &quot;nestedBean&quot;)
        // Calls factory.createObject(..., nestedBean, &quot;strings&quot;, 2)
<span class="fc" id="L875">        assertXPathCreatePath(</span>
<span class="fc" id="L876">            context,</span>
<span class="fc" id="L877">            &quot;/nestedBean/strings[2]&quot;,</span>
<span class="fc" id="L878">            &quot;String 2&quot;,</span>
<span class="fc" id="L879">            &quot;/nestedBean/strings[2]&quot;);</span>
<span class="fc" id="L880">    }</span>

    public void testCreatePathAndSetValueCreateBeanExpandCollection() {
<span class="fc" id="L883">        context.setValue(&quot;nestedBean&quot;, null);</span>

        // Calls factory.createObject(..., TestBean, &quot;nestedBean&quot;)
        // Calls factory.createObject(..., nestedBean, &quot;strings&quot;, 2)
<span class="fc" id="L887">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L888">            context,</span>
<span class="fc" id="L889">            &quot;/nestedBean/strings[2]&quot;,</span>
<span class="fc" id="L890">            &quot;Test&quot;,</span>
<span class="fc" id="L891">            &quot;/nestedBean/strings[2]&quot;);</span>
<span class="fc" id="L892">    }</span>

    public void testRemovePathPropertyValue() {
        // Remove property value
<span class="fc" id="L896">        context.removePath(&quot;nestedBean/int&quot;);</span>
<span class="fc" id="L897">        assertEquals(</span>
<span class="fc" id="L898">            &quot;Remove property value&quot;,</span>
<span class="fc" id="L899">            new Integer(0),</span>
<span class="fc" id="L900">            context.getValue(&quot;nestedBean/int&quot;));</span>
<span class="fc" id="L901">    }</span>

    public void testRemovePathArrayElement() {
        // Assigns a new array to the property
<span class="fc" id="L905">        context.removePath(&quot;nestedBean/strings[1]&quot;);</span>
<span class="fc" id="L906">        assertEquals(</span>
<span class="fc" id="L907">            &quot;Remove array element&quot;,</span>
<span class="fc" id="L908">            &quot;String 2&quot;,</span>
<span class="fc" id="L909">            context.getValue(&quot;nestedBean/strings[1]&quot;));</span>
<span class="fc" id="L910">    }</span>

    public void testRemoveAllArrayElements() {
<span class="fc" id="L913">        context.removeAll(&quot;nestedBean/strings&quot;);</span>
<span class="fc" id="L914">        assertXPathValueIterator(</span>
<span class="fc" id="L915">            context,</span>
<span class="fc" id="L916">            &quot;nestedBean/strings&quot;,</span>
<span class="fc" id="L917">            list());</span>
<span class="fc" id="L918">    }</span>

    public void testRemoveAllListElements() {
<span class="fc" id="L921">        context.removeAll(&quot;list&quot;);</span>
<span class="fc" id="L922">        assertXPathValueIterator(</span>
<span class="fc" id="L923">            context,</span>
<span class="fc" id="L924">            &quot;list&quot;,</span>
<span class="fc bfc" id="L925" title="All 2 branches covered.">            this instanceof DynaBeanModelTest ? list(null, null, null) : list());</span>
<span class="fc" id="L926">    }</span>

    public void testRemoveAllMapEntries() {
<span class="fc" id="L929">        context.removeAll(&quot;map/*&quot;);</span>
<span class="fc" id="L930">        assertXPathValue(</span>
<span class="fc" id="L931">            context,</span>
<span class="fc" id="L932">            &quot;map&quot;,</span>
<span class="fc" id="L933">            Collections.EMPTY_MAP);</span>
<span class="fc" id="L934">    }</span>

    public void testRemovePathBeanValue() {
<span class="fc" id="L937">        context.removePath(&quot;nestedBean&quot;);</span>
<span class="fc" id="L938">        assertEquals(</span>
<span class="fc" id="L939">            &quot;Remove collection element&quot;,</span>
<span class="fc" id="L940">            null,</span>
<span class="fc" id="L941">            context.getValue(&quot;nestedBean&quot;));</span>
<span class="fc" id="L942">    }</span>
    
    public void testRelativeContextRelativePath() {
<span class="fc" id="L945">        JXPathContext relative =</span>
<span class="fc" id="L946">            context.getRelativeContext(context.getPointer(&quot;nestedBean&quot;));</span>
        
<span class="fc" id="L948">        assertXPathValueAndPointer(relative, </span>
<span class="fc" id="L949">            &quot;int&quot;, </span>
<span class="fc" id="L950">            new Integer(1), </span>
<span class="fc" id="L951">            &quot;/nestedBean/int&quot;);</span>
<span class="fc" id="L952">    }</span>

    public void testRelativeContextAbsolutePath() {
<span class="fc" id="L955">        JXPathContext relative =</span>
<span class="fc" id="L956">            context.getRelativeContext(context.getPointer(&quot;nestedBean&quot;));</span>
        
<span class="fc" id="L958">        assertXPathValueAndPointer(relative, </span>
<span class="fc" id="L959">            &quot;/integers[2]&quot;, </span>
<span class="fc" id="L960">            new Integer(2), </span>
<span class="fc" id="L961">            &quot;/integers[2]&quot;);</span>
<span class="fc" id="L962">    }</span>

    public void testRelativeContextParent() {
<span class="fc" id="L965">        JXPathContext relative =</span>
<span class="fc" id="L966">            context.getRelativeContext(context.getPointer(&quot;nestedBean&quot;));</span>
        
<span class="fc" id="L968">        assertXPathValueAndPointer(relative, </span>
<span class="fc" id="L969">            &quot;../integers[2]&quot;, </span>
<span class="fc" id="L970">            new Integer(2), </span>
<span class="fc" id="L971">            &quot;/integers[2]&quot;);</span>
<span class="fc" id="L972">    }</span>
    
    public void testRelativeContextInheritance() {
<span class="pc bfc" id="L975" title="All 2 branches covered.">        context.setFunctions(new ClassFunctions(TestFunctions.class, &quot;test&quot;));</span>
<span class="fc" id="L976">        JXPathContext relative =</span>
<span class="fc" id="L977">            context.getRelativeContext(context.getPointer(&quot;nestedBean&quot;));</span>
        
<span class="fc" id="L979">        assertXPathValue(relative, </span>
<span class="fc" id="L980">            &quot;test:countPointers(strings)&quot;, </span>
<span class="fc" id="L981">            new Integer(3));</span>
<span class="fc" id="L982">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span>commons-jxpath (Jan 19, 2019 5:24:34 PM)</div></body></html>