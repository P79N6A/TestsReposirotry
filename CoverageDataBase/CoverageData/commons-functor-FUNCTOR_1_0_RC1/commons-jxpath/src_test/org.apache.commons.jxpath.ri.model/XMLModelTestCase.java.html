<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>XMLModelTestCase.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">commons-jxpath (Jan 19, 2019 5:24:34 PM)</a> &gt; <a href="../../index.html" class="el_group">commons-jxpath</a> &gt; <a href="../index.html" class="el_bundle">src/test</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.jxpath.ri.model</a> &gt; <span class="el_source">XMLModelTestCase.java</span></div><h1>XMLModelTestCase.java</h1><pre class="source lang-java linenums"><span class="fc" id="L1">/*</span>
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.jxpath.ri.model;

import org.apache.commons.jxpath.AbstractFactory;
import org.apache.commons.jxpath.IdentityManager;
import org.apache.commons.jxpath.JXPathContext;
import org.apache.commons.jxpath.JXPathException;
import org.apache.commons.jxpath.JXPathTestCase;
import org.apache.commons.jxpath.Pointer;
import org.apache.commons.jxpath.Variables;
import org.apache.commons.jxpath.xml.DocumentContainer;

/**
 * Abstract superclass for pure XPath 1.0.  Subclasses
 * apply the same XPaths to contexts using different models:
 * DOM, JDOM etc.
 *
 * @author Dmitri Plotnikov
 * @version $Revision$ $Date$
 */

<span class="fc" id="L37">public abstract class XMLModelTestCase extends JXPathTestCase {</span>
    protected JXPathContext context;

    public void setUp() {
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">        if (context == null) {</span>
<span class="fc" id="L42">            DocumentContainer docCtr = createDocumentContainer();</span>
<span class="fc" id="L43">            context = createContext();</span>
<span class="fc" id="L44">            Variables vars = context.getVariables();</span>
<span class="fc" id="L45">            vars.declareVariable(&quot;document&quot;, docCtr.getValue());</span>
<span class="fc" id="L46">            vars.declareVariable(&quot;container&quot;, docCtr);</span>
<span class="fc" id="L47">            vars.declareVariable(&quot;element&quot;, context.getPointer(&quot;vendor/location/address/street&quot;).getNode());</span>
        }
<span class="fc" id="L49">    }</span>

    protected abstract String getModel();

    protected DocumentContainer createDocumentContainer() {
<span class="fc" id="L54">        return new DocumentContainer(</span>
<span class="pc bfc" id="L55" title="All 2 branches covered.">                JXPathTestCase.class.getResource(&quot;Vendor.xml&quot;),</span>
<span class="fc" id="L56">                getModel());</span>
    }
    
    protected abstract AbstractFactory getAbstractFactory();
        
    protected JXPathContext createContext() {
<span class="fc" id="L62">        JXPathContext context =</span>
<span class="fc" id="L63">            JXPathContext.newContext(createDocumentContainer());</span>
<span class="fc" id="L64">        context.setFactory(getAbstractFactory());</span>
<span class="fc" id="L65">        context.registerNamespace(&quot;product&quot;, &quot;productNS&quot;);</span>
<span class="fc" id="L66">        return context;</span>
    }

    /**
     * An XML signature is used to determine if we have the right result
     * after a modification of XML by JXPath.  It is basically a piece
     * of simplified XML.
     */
    protected abstract String getXMLSignature(
        Object node,
        boolean elements,
        boolean attributes,
        boolean text,
        boolean pi);

    protected void assertXMLSignature(
        JXPathContext context,
        String path,
        String signature,
        boolean elements,
        boolean attributes,
        boolean text,
        boolean pi) 
    {
<span class="fc" id="L90">        Object node = context.getPointer(path).getNode();</span>
<span class="fc" id="L91">        String sig = getXMLSignature(node, elements, attributes, text, pi);</span>
<span class="fc" id="L92">        assertEquals(&quot;XML Signature mismatch: &quot;, signature, sig);</span>
<span class="fc" id="L93">    }</span>

    // ------------------------------------------------ Individual Test Methods

    public void testDocumentOrder() {
<span class="fc" id="L98">        assertDocumentOrder(</span>
<span class="fc" id="L99">            context,</span>
<span class="fc" id="L100">            &quot;vendor/location&quot;,</span>
<span class="fc" id="L101">            &quot;vendor/location/address/street&quot;,</span>
<span class="fc" id="L102">            -1);</span>

<span class="fc" id="L104">        assertDocumentOrder(</span>
<span class="fc" id="L105">            context,</span>
<span class="fc" id="L106">            &quot;vendor/location[@id = '100']&quot;,</span>
<span class="fc" id="L107">            &quot;vendor/location[@id = '101']&quot;,</span>
<span class="fc" id="L108">            -1);</span>

<span class="fc" id="L110">        assertDocumentOrder(</span>
<span class="fc" id="L111">            context,</span>
<span class="fc" id="L112">            &quot;vendor//price:amount&quot;,</span>
<span class="fc" id="L113">            &quot;vendor/location&quot;,</span>
<span class="fc" id="L114">            1);</span>
<span class="fc" id="L115">    }</span>
    

    public void testSetValue() {
<span class="fc" id="L119">        assertXPathSetValue(</span>
<span class="fc" id="L120">            context,</span>
<span class="fc" id="L121">            &quot;vendor/location[@id = '100']&quot;,</span>
<span class="fc" id="L122">            &quot;New Text&quot;);</span>

<span class="fc" id="L124">        assertXMLSignature(</span>
<span class="fc" id="L125">            context,</span>
<span class="fc" id="L126">            &quot;vendor/location[@id = '100']&quot;,</span>
<span class="fc" id="L127">            &quot;&lt;E&gt;New Text&lt;/E&gt;&quot;,</span>
<span class="fc" id="L128">            false,</span>
<span class="fc" id="L129">            false,</span>
<span class="fc" id="L130">            true,</span>
<span class="fc" id="L131">            false);</span>

<span class="fc" id="L133">        assertXPathSetValue(</span>
<span class="fc" id="L134">            context,</span>
<span class="fc" id="L135">            &quot;vendor/location[@id = '101']&quot;,</span>
<span class="fc" id="L136">            &quot;Replacement Text&quot;);</span>

<span class="fc" id="L138">        assertXMLSignature(</span>
<span class="fc" id="L139">            context,</span>
<span class="fc" id="L140">            &quot;vendor/location[@id = '101']&quot;,</span>
<span class="fc" id="L141">            &quot;&lt;E&gt;Replacement Text&lt;/E&gt;&quot;,</span>
<span class="fc" id="L142">            false,</span>
<span class="fc" id="L143">            false,</span>
<span class="fc" id="L144">            true,</span>
<span class="fc" id="L145">            false);</span>
<span class="fc" id="L146">    }</span>

    /**
     * Test JXPathContext.createPath() with various arguments
     */
    public void testCreatePath() {
        // Create a DOM element
<span class="fc" id="L153">        assertXPathCreatePath(</span>
<span class="fc" id="L154">            context,</span>
<span class="fc" id="L155">            &quot;/vendor[1]/location[3]&quot;,</span>
<span class="fc" id="L156">            &quot;&quot;,</span>
<span class="fc" id="L157">            &quot;/vendor[1]/location[3]&quot;);</span>

        // Create a DOM element with contents
<span class="fc" id="L160">        assertXPathCreatePath(</span>
<span class="fc" id="L161">            context,</span>
<span class="fc" id="L162">            &quot;/vendor[1]/location[3]/address/street&quot;,</span>
<span class="fc" id="L163">            &quot;&quot;,</span>
<span class="fc" id="L164">            &quot;/vendor[1]/location[3]/address[1]/street[1]&quot;);</span>

        // Create a DOM attribute
<span class="fc" id="L167">        assertXPathCreatePath(</span>
<span class="fc" id="L168">            context,</span>
<span class="fc" id="L169">            &quot;/vendor[1]/location[2]/@manager&quot;,</span>
<span class="fc" id="L170">            &quot;&quot;,</span>
<span class="fc" id="L171">            &quot;/vendor[1]/location[2]/@manager&quot;);</span>

<span class="fc" id="L173">        assertXPathCreatePath(</span>
<span class="fc" id="L174">            context,</span>
<span class="fc" id="L175">            &quot;/vendor[1]/location[1]/@name&quot;,</span>
<span class="fc" id="L176">            &quot;local&quot;,</span>
<span class="fc" id="L177">            &quot;/vendor[1]/location[1]/@name&quot;);</span>

<span class="fc" id="L179">         assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L180">            context,</span>
<span class="fc" id="L181">            &quot;/vendor[1]/location[4]/@manager&quot;,</span>
<span class="fc" id="L182">            &quot;&quot;,</span>
<span class="fc" id="L183">            &quot;/vendor[1]/location[4]/@manager&quot;);</span>
         
<span class="fc" id="L185">         context.registerNamespace(&quot;price&quot;, &quot;priceNS&quot;);</span>
         
         // Create a DOM element
<span class="fc" id="L188">         assertXPathCreatePath(</span>
<span class="fc" id="L189">             context,</span>
<span class="fc" id="L190">             &quot;/vendor[1]/price:foo/price:bar&quot;,</span>
<span class="fc" id="L191">             &quot;&quot;,</span>
<span class="fc" id="L192">             &quot;/vendor[1]/price:foo[1]/price:bar[1]&quot;);</span>
<span class="fc" id="L193">    }</span>

    /**
     * Test JXPath.createPathAndSetValue() with various arguments
     */
    public void testCreatePathAndSetValue() {
        // Create a XML element
<span class="fc" id="L200">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L201">            context,</span>
<span class="fc" id="L202">            &quot;vendor/location[3]&quot;,</span>
<span class="fc" id="L203">            &quot;&quot;,</span>
<span class="fc" id="L204">            &quot;/vendor[1]/location[3]&quot;);</span>

        // Create a DOM element with contents
<span class="fc" id="L207">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L208">            context,</span>
<span class="fc" id="L209">            &quot;vendor/location[3]/address/street&quot;,</span>
<span class="fc" id="L210">            &quot;Lemon Circle&quot;,</span>
<span class="fc" id="L211">            &quot;/vendor[1]/location[3]/address[1]/street[1]&quot;);</span>

        // Create an attribute
<span class="fc" id="L214">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L215">            context,</span>
<span class="fc" id="L216">            &quot;vendor/location[2]/@manager&quot;,</span>
<span class="fc" id="L217">            &quot;John Doe&quot;,</span>
<span class="fc" id="L218">            &quot;/vendor[1]/location[2]/@manager&quot;);</span>

<span class="fc" id="L220">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L221">            context,</span>
<span class="fc" id="L222">            &quot;vendor/location[1]/@manager&quot;,</span>
<span class="fc" id="L223">            &quot;John Doe&quot;,</span>
<span class="fc" id="L224">            &quot;/vendor[1]/location[1]/@manager&quot;);</span>
        
<span class="fc" id="L226">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L227">            context,</span>
<span class="fc" id="L228">            &quot;/vendor[1]/location[4]/@manager&quot;,</span>
<span class="fc" id="L229">            &quot;James Dow&quot;,</span>
<span class="fc" id="L230">            &quot;/vendor[1]/location[4]/@manager&quot;);</span>
        
<span class="fc" id="L232">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L233">            context,</span>
<span class="fc" id="L234">            &quot;vendor/product/product:name/attribute::price:language&quot;,</span>
<span class="fc" id="L235">            &quot;English&quot;,</span>
<span class="fc" id="L236">            &quot;/vendor[1]/product[1]/product:name[1]/@price:language&quot;);</span>
        
<span class="fc" id="L238">        context.registerNamespace(&quot;price&quot;, &quot;priceNS&quot;);</span>
        
        // Create a DOM element
<span class="fc" id="L241">        assertXPathCreatePathAndSetValue(</span>
<span class="fc" id="L242">            context,</span>
<span class="fc" id="L243">            &quot;/vendor[1]/price:foo/price:bar&quot;,</span>
<span class="fc" id="L244">            &quot;123.20&quot;,</span>
<span class="fc" id="L245">            &quot;/vendor[1]/price:foo[1]/price:bar[1]&quot;);</span>
<span class="fc" id="L246">    }</span>

    /**
     * Test JXPathContext.removePath() with various arguments
     */
    public void testRemovePath() {
        // Remove XML nodes
<span class="fc" id="L253">        context.removePath(&quot;vendor/location[@id = '101']//street/text()&quot;);</span>
<span class="fc" id="L254">        assertEquals(</span>
<span class="fc" id="L255">            &quot;Remove DOM text&quot;,</span>
<span class="fc" id="L256">            &quot;&quot;,</span>
<span class="fc" id="L257">            context.getValue(&quot;vendor/location[@id = '101']//street&quot;));</span>

<span class="fc" id="L259">        context.removePath(&quot;vendor/location[@id = '101']//street&quot;);</span>
<span class="fc" id="L260">        assertEquals(</span>
<span class="fc" id="L261">            &quot;Remove DOM element&quot;,</span>
<span class="fc" id="L262">            new Double(0),</span>
<span class="fc" id="L263">            context.getValue(&quot;count(vendor/location[@id = '101']//street)&quot;));</span>

<span class="fc" id="L265">        context.removePath(&quot;vendor/location[@id = '100']/@name&quot;);</span>
<span class="fc" id="L266">        assertEquals(</span>
<span class="fc" id="L267">            &quot;Remove DOM attribute&quot;,</span>
<span class="fc" id="L268">            new Double(0),</span>
<span class="fc" id="L269">            context.getValue(&quot;count(vendor/location[@id = '100']/@name)&quot;));</span>
<span class="fc" id="L270">    }</span>

    public void testID() {
<span class="fc" id="L273">        context.setIdentityManager(new IdentityManager() {</span>
            public Pointer getPointerByID(JXPathContext context, String id) {
<span class="fc" id="L275">                NodePointer ptr = (NodePointer) context.getPointer(&quot;/&quot;);</span>
<span class="fc" id="L276">                ptr = ptr.getValuePointer(); // Unwrap the container</span>
<span class="fc" id="L277">                return ptr.getPointerByID(context, id);</span>
            }
        });

<span class="fc" id="L281">        assertXPathValueAndPointer(</span>
<span class="fc" id="L282">            context,</span>
<span class="fc" id="L283">            &quot;id(101)//street&quot;,</span>
<span class="fc" id="L284">            &quot;Tangerine Drive&quot;,</span>
<span class="fc" id="L285">            &quot;id('101')/address[1]/street[1]&quot;);</span>

<span class="fc" id="L287">        assertXPathPointerLenient(</span>
<span class="fc" id="L288">            context,</span>
<span class="fc" id="L289">            &quot;id(105)/address/street&quot;,</span>
<span class="fc" id="L290">            &quot;id(105)/address/street&quot;);</span>
<span class="fc" id="L291">    }</span>

    public void testAxisChild() {
<span class="fc" id="L294">        assertXPathValue(</span>
<span class="fc" id="L295">            context,</span>
<span class="fc" id="L296">            &quot;vendor/location/address/street&quot;,</span>
<span class="fc" id="L297">            &quot;Orchard Road&quot;);</span>

        // child:: - first child does not match, need to search
<span class="fc" id="L300">        assertXPathValue(</span>
<span class="fc" id="L301">            context,</span>
<span class="fc" id="L302">            &quot;vendor/location/address/city&quot;,</span>
<span class="fc" id="L303">            &quot;Fruit Market&quot;);</span>
        
        // local-name(qualified)
<span class="fc" id="L306">        assertXPathValue(</span>
<span class="fc" id="L307">            context,</span>
<span class="fc" id="L308">            &quot;local-name(vendor/product/price:amount)&quot;,</span>
<span class="fc" id="L309">            &quot;amount&quot;);</span>
        
        // local-name(non-qualified)
<span class="fc" id="L312">        assertXPathValue(context, &quot;local-name(vendor/location)&quot;, &quot;location&quot;);</span>

        // name (qualified)
<span class="fc" id="L315">        assertXPathValue(</span>
<span class="fc" id="L316">            context,</span>
<span class="fc" id="L317">            &quot;name(vendor/product/price:amount)&quot;,</span>
<span class="fc" id="L318">            &quot;value:amount&quot;);</span>

        // name (non-qualified)
<span class="fc" id="L321">        assertXPathValue(</span>
<span class="fc" id="L322">            context,</span>
<span class="fc" id="L323">            &quot;name(vendor/location)&quot;,</span>
<span class="fc" id="L324">            &quot;location&quot;);</span>

        // namespace-uri (qualified)
<span class="fc" id="L327">        assertXPathValue(</span>
<span class="fc" id="L328">            context,</span>
<span class="fc" id="L329">            &quot;namespace-uri(vendor/product/price:amount)&quot;,</span>
<span class="fc" id="L330">            &quot;priceNS&quot;);</span>

        // default namespace does not affect search
<span class="fc" id="L333">        assertXPathValue(context, &quot;vendor/product/prix&quot;, &quot;934.99&quot;);</span>
        
<span class="fc" id="L335">        assertXPathValue(context, &quot;/vendor/contact[@name='jim']&quot;, &quot;Jim&quot;);</span>
        
<span class="fc" id="L337">        boolean nsv = false;</span>
        try {
<span class="fc" id="L339">            context.setLenient(false);</span>
<span class="nc" id="L340">            context.getValue(&quot;/vendor/contact[@name='jane']&quot;);</span>
<span class="nc" id="L341">        }</span>
<span class="fc" id="L342">        catch (JXPathException ex) {</span>
<span class="fc" id="L343">            nsv = true;</span>
        }
<span class="fc" id="L345">        assertTrue(&quot;No such value: /vendor/contact[@name='jim']&quot;, nsv);</span>
                
<span class="fc" id="L347">        nsv = false;</span>
        try {
<span class="fc" id="L349">            context.setLenient(false);</span>
<span class="nc" id="L350">            context.getValue(&quot;/vendor/contact[@name='jane']/*&quot;);</span>
<span class="nc" id="L351">        }</span>
<span class="fc" id="L352">        catch (JXPathException ex) {</span>
<span class="fc" id="L353">            nsv = true;</span>
        }
<span class="fc" id="L355">        assertTrue(&quot;No such value: /vendor/contact[@name='jane']/*&quot;, nsv);</span>
        
        // child:: with a wildcard
<span class="fc" id="L358">        assertXPathValue(</span>
<span class="fc" id="L359">            context,</span>
<span class="fc" id="L360">            &quot;count(vendor/product/price:*)&quot;,</span>
<span class="fc" id="L361">            new Double(2));</span>

        // child:: with the default namespace
<span class="fc" id="L364">        assertXPathValue(context, &quot;count(vendor/product/*)&quot;, new Double(4));</span>

        // child:: with a qualified name
<span class="fc" id="L367">        assertXPathValue(context, &quot;vendor/product/price:amount&quot;, &quot;45.95&quot;);</span>
        
        // null default namespace
<span class="fc" id="L370">        context.registerNamespace(&quot;x&quot;, &quot;temp&quot;);</span>
<span class="fc" id="L371">        assertXPathValue(context, &quot;vendor/x:pos//number&quot;, &quot;109&quot;);</span>
<span class="fc" id="L372">    }</span>

    public void testAxisChildIndexPredicate() {
<span class="fc" id="L375">        assertXPathValue(</span>
<span class="fc" id="L376">            context,</span>
<span class="fc" id="L377">            &quot;vendor/location[2]/address/street&quot;,</span>
<span class="fc" id="L378">            &quot;Tangerine Drive&quot;);</span>
<span class="fc" id="L379">    }</span>

    public void testAxisDescendant() {
        // descendant::
<span class="fc" id="L383">        assertXPathValue(context, &quot;//street&quot;, &quot;Orchard Road&quot;);</span>

        // descendent:: with a namespace and wildcard
<span class="fc" id="L386">        assertXPathValue(context, &quot;count(//price:*)&quot;, new Double(2));</span>

<span class="fc" id="L388">        assertXPathValueIterator(context, &quot;vendor//saleEnds&quot;, list(&quot;never&quot;));</span>

<span class="fc" id="L390">        assertXPathValueIterator(context, &quot;vendor//promotion&quot;, list(&quot;&quot;));</span>

<span class="fc" id="L392">        assertXPathValueIterator(</span>
<span class="fc" id="L393">            context,</span>
<span class="fc" id="L394">            &quot;vendor//saleEnds[../@stores = 'all']&quot;,</span>
<span class="fc" id="L395">            list(&quot;never&quot;));</span>

<span class="fc" id="L397">        assertXPathValueIterator(</span>
<span class="fc" id="L398">            context,</span>
<span class="fc" id="L399">            &quot;vendor//promotion[../@stores = 'all']&quot;,</span>
<span class="fc" id="L400">            list(&quot;&quot;));</span>
<span class="fc" id="L401">    }</span>
    
//    public void testAxisDescendantDocumentOrder() {
//        Iterator iter = context.iteratePointers(&quot;//*&quot;);
//        while (iter.hasNext()) {
//            System.err.println(iter.next());
//        }
//    }

    public void testAxisParent() {
        // parent::
<span class="fc" id="L412">        assertXPathPointer(</span>
<span class="fc" id="L413">            context,</span>
<span class="fc" id="L414">            &quot;//street/..&quot;,</span>
<span class="fc" id="L415">            &quot;/vendor[1]/location[1]/address[1]&quot;);</span>

        // parent:: (note reverse document order)
<span class="fc" id="L418">        assertXPathPointerIterator(</span>
<span class="fc" id="L419">            context,</span>
<span class="fc" id="L420">            &quot;//street/..&quot;,</span>
<span class="fc" id="L421">            list(</span>
<span class="fc" id="L422">                &quot;/vendor[1]/location[2]/address[1]&quot;,</span>
<span class="fc" id="L423">                &quot;/vendor[1]/location[1]/address[1]&quot;));</span>

        // parent:: with a namespace and wildcard
<span class="fc" id="L426">        assertXPathValue(</span>
<span class="fc" id="L427">            context,</span>
<span class="fc" id="L428">            &quot;vendor/product/price:sale/saleEnds/parent::price:*&quot; + &quot;/saleEnds&quot;,</span>
<span class="fc" id="L429">            &quot;never&quot;);</span>
<span class="fc" id="L430">    }</span>

    public void testAxisFollowingSibling() {
        // following-sibling::
<span class="fc" id="L434">        assertXPathValue(</span>
<span class="fc" id="L435">            context,</span>
<span class="fc" id="L436">            &quot;vendor/location[.//employeeCount = 10]/&quot;</span>
                + &quot;following-sibling::location//street&quot;,
<span class="fc" id="L438">            &quot;Tangerine Drive&quot;);</span>

        // following-sibling:: produces the correct pointer
<span class="fc" id="L441">        assertXPathPointer(</span>
<span class="fc" id="L442">            context,</span>
<span class="fc" id="L443">            &quot;vendor/location[.//employeeCount = 10]/&quot;</span>
                + &quot;following-sibling::location//street&quot;,
<span class="fc" id="L445">            &quot;/vendor[1]/location[2]/address[1]/street[1]&quot;);</span>
<span class="fc" id="L446">    }</span>

    public void testAxisPrecedingSibling() {
        // preceding-sibling:: produces the correct pointer
<span class="fc" id="L450">        assertXPathPointer(</span>
<span class="fc" id="L451">            context,</span>
<span class="fc" id="L452">            &quot;//location[2]/preceding-sibling::location//street&quot;,</span>
<span class="fc" id="L453">            &quot;/vendor[1]/location[1]/address[1]/street[1]&quot;);</span>
<span class="fc" id="L454">    }</span>

    public void testAxisPreceding() {
        // preceding::
<span class="fc" id="L458">        assertXPathPointer(</span>
<span class="fc" id="L459">                context,</span>
<span class="fc" id="L460">                &quot;//location[2]/preceding-sibling::location//street&quot;,</span>
<span class="fc" id="L461">        &quot;/vendor[1]/location[1]/address[1]/street[1]&quot;);</span>
<span class="fc" id="L462">        assertXPathPointer(context, &quot;//location[2]/preceding::*[1]&quot;, &quot;/vendor[1]/location[1]/employeeCount[1]&quot;);</span>
<span class="fc" id="L463">        assertXPathPointer(context, &quot;//location[2]/preceding::node()[3]&quot;, &quot;/vendor[1]/location[1]/employeeCount[1]/text()[1]&quot;);</span>
<span class="fc" id="L464">        assertXPathPointer(context, &quot;//location[2]/preceding::node()[4]&quot;, &quot;/vendor[1]/location[1]/employeeCount[1]&quot;);</span>
<span class="fc" id="L465">    }</span>

    public void testAxisAttribute() {
        // attribute::
<span class="fc" id="L469">        assertXPathValue(context, &quot;vendor/location/@id&quot;, &quot;100&quot;);</span>

        // attribute:: produces the correct pointer
<span class="fc" id="L472">        assertXPathPointer(</span>
<span class="fc" id="L473">            context,</span>
<span class="fc" id="L474">            &quot;vendor/location/@id&quot;,</span>
<span class="fc" id="L475">            &quot;/vendor[1]/location[1]/@id&quot;);</span>

        // iterate over attributes
<span class="fc" id="L478">        assertXPathValueIterator(</span>
<span class="fc" id="L479">            context,</span>
<span class="fc" id="L480">            &quot;vendor/location/@id&quot;,</span>
<span class="fc" id="L481">            list(&quot;100&quot;, &quot;101&quot;));</span>

        // Using different prefixes for the same namespace
<span class="fc" id="L484">        assertXPathValue(</span>
<span class="fc" id="L485">            context,</span>
<span class="fc" id="L486">            &quot;vendor/product/price:amount/@price:discount&quot;,</span>
<span class="fc" id="L487">            &quot;10%&quot;);</span>
        
        // namespace uri for an attribute
<span class="fc" id="L490">        assertXPathValue(</span>
<span class="fc" id="L491">            context,</span>
<span class="fc" id="L492">            &quot;namespace-uri(vendor/product/price:amount/@price:discount)&quot;,</span>
<span class="fc" id="L493">            &quot;priceNS&quot;);</span>

        // local name of an attribute
<span class="fc" id="L496">        assertXPathValue(</span>
<span class="fc" id="L497">            context,</span>
<span class="fc" id="L498">            &quot;local-name(vendor/product/price:amount/@price:discount)&quot;,</span>
<span class="fc" id="L499">            &quot;discount&quot;);</span>

        // name for an attribute
<span class="fc" id="L502">        assertXPathValue(</span>
<span class="fc" id="L503">            context,</span>
<span class="fc" id="L504">            &quot;name(vendor/product/price:amount/@price:discount)&quot;,</span>
<span class="fc" id="L505">            &quot;price:discount&quot;);</span>

        // attribute:: with the default namespace
<span class="fc" id="L508">        assertXPathValue(</span>
<span class="fc" id="L509">            context,</span>
<span class="fc" id="L510">            &quot;vendor/product/price:amount/@discount&quot;,</span>
<span class="fc" id="L511">            &quot;20%&quot;);</span>

        // namespace uri of an attribute with the default namespace
<span class="fc" id="L514">        assertXPathValue(</span>
<span class="fc" id="L515">            context,</span>
<span class="fc" id="L516">            &quot;namespace-uri(vendor/product/price:amount/@discount)&quot;,</span>
<span class="fc" id="L517">            &quot;&quot;);</span>

        // local name of an attribute with the default namespace
<span class="fc" id="L520">        assertXPathValue(</span>
<span class="fc" id="L521">            context,</span>
<span class="fc" id="L522">            &quot;local-name(vendor/product/price:amount/@discount)&quot;,</span>
<span class="fc" id="L523">            &quot;discount&quot;);</span>

        // name of an attribute with the default namespace
<span class="fc" id="L526">        assertXPathValue(</span>
<span class="fc" id="L527">            context,</span>
<span class="fc" id="L528">            &quot;name(vendor/product/price:amount/@discount)&quot;,</span>
<span class="fc" id="L529">            &quot;discount&quot;);</span>

        // attribute:: with a namespace and wildcard
<span class="fc" id="L532">        assertXPathValueIterator(</span>
<span class="fc" id="L533">            context,</span>
<span class="fc" id="L534">            &quot;vendor/product/price:amount/@price:*&quot;,</span>
<span class="fc" id="L535">            list(&quot;10%&quot;));</span>

        // attribute:: with a wildcard
<span class="fc" id="L538">        assertXPathValueIterator(</span>
<span class="fc" id="L539">            context,</span>
<span class="fc" id="L540">            &quot;vendor/location[1]/@*&quot;,</span>
<span class="fc" id="L541">            set(&quot;100&quot;, &quot;&quot;, &quot;local&quot;));</span>

        // attribute:: with default namespace and wildcard
<span class="fc" id="L544">        assertXPathValueIterator(</span>
<span class="fc" id="L545">                context,</span>
<span class="fc" id="L546">                &quot;vendor/product/price:amount/@*&quot;,</span>
                //use a set because DOM returns attrs sorted by name, JDOM by occurrence order:
<span class="fc" id="L548">                set(&quot;10%&quot;, &quot;20%&quot;));</span>

        // attribute::node()
<span class="fc" id="L551">        assertXPathValueIterator(</span>
<span class="fc" id="L552">                context,</span>
<span class="fc" id="L553">                &quot;vendor/product/price:amount/attribute::node()&quot;,</span>
                //use a set because DOM returns attrs sorted by name, JDOM by occurrence order:
<span class="fc" id="L555">                set(&quot;10%&quot;, &quot;20%&quot;));</span>
        
        // attribute:: select non-ns'd attributes only
<span class="fc" id="L558">        assertXPathValueIterator(</span>
<span class="fc" id="L559">            context,</span>
<span class="fc" id="L560">            &quot;vendor/product/price:amount/@*[namespace-uri() = '']&quot;,</span>
<span class="fc" id="L561">            list(&quot;20%&quot;));</span>

        // Empty attribute
<span class="fc" id="L564">        assertXPathValue(context, &quot;vendor/location/@manager&quot;, &quot;&quot;);</span>

        // Missing attribute
<span class="fc" id="L567">        assertXPathValueLenient(context, &quot;vendor/location/@missing&quot;, null);</span>

        // Missing attribute with namespace
<span class="fc" id="L570">        assertXPathValueLenient(context, &quot;vendor/location/@miss:missing&quot;, null);</span>

        // Using attribute in a predicate
<span class="fc" id="L573">        assertXPathValue(</span>
<span class="fc" id="L574">            context,</span>
<span class="fc" id="L575">            &quot;vendor/location[@id='101']//street&quot;,</span>
<span class="fc" id="L576">            &quot;Tangerine Drive&quot;);</span>
        
<span class="fc" id="L578">        assertXPathValueIterator(</span>
<span class="fc" id="L579">            context,</span>
<span class="fc" id="L580">            &quot;/vendor/location[1]/@*[name()!= 'manager']&quot;, list(&quot;100&quot;,</span>
<span class="fc" id="L581">            &quot;local&quot;));</span>
<span class="fc" id="L582">    }</span>

    public void testAxisNamespace() {
        // namespace::
<span class="fc" id="L586">        assertXPathValueAndPointer(</span>
<span class="fc" id="L587">            context,</span>
<span class="fc" id="L588">            &quot;vendor/product/prix/namespace::price&quot;,</span>
<span class="fc" id="L589">            &quot;priceNS&quot;,</span>
<span class="fc" id="L590">            &quot;/vendor[1]/product[1]/prix[1]/namespace::price&quot;);</span>

        // namespace::*
<span class="fc" id="L593">        assertXPathValue(</span>
<span class="fc" id="L594">            context,</span>
<span class="fc" id="L595">            &quot;count(vendor/product/namespace::*)&quot;,</span>
<span class="fc" id="L596">            new Double(3));</span>

        // name of namespace
<span class="fc" id="L599">        assertXPathValue(</span>
<span class="fc" id="L600">            context,</span>
<span class="fc" id="L601">            &quot;name(vendor/product/prix/namespace::price)&quot;,</span>
<span class="fc" id="L602">            &quot;price&quot;);</span>

        // local name of namespace
<span class="fc" id="L605">        assertXPathValue(</span>
<span class="fc" id="L606">            context,</span>
<span class="fc" id="L607">            &quot;local-name(vendor/product/prix/namespace::price)&quot;,</span>
<span class="fc" id="L608">            &quot;price&quot;);</span>
<span class="fc" id="L609">    }</span>

    public void testAxisAncestor() {
        // ancestor::
<span class="fc" id="L613">        assertXPathValue(</span>
<span class="fc" id="L614">            context,</span>
<span class="fc" id="L615">            &quot;vendor/product/price:sale/saleEnds/&quot;</span>
                + &quot;ancestor::price:sale/saleEnds&quot;,
<span class="fc" id="L617">            &quot;never&quot;);</span>

        // ancestor:: with a wildcard
<span class="fc" id="L620">        assertXPathValue(</span>
<span class="fc" id="L621">            context,</span>
<span class="fc" id="L622">            &quot;vendor/product/price:sale/saleEnds/ancestor::price:*&quot;</span>
                + &quot;/saleEnds&quot;,
<span class="fc" id="L624">            &quot;never&quot;);</span>
<span class="fc" id="L625">    }</span>

    public void testAxisAncestorOrSelf() {
        // ancestor-or-self::
<span class="fc" id="L629">        assertXPathValue(</span>
<span class="fc" id="L630">            context,</span>
<span class="fc" id="L631">            &quot;vendor/product/price:sale/&quot;</span>
                + &quot;ancestor-or-self::price:sale/saleEnds&quot;,
<span class="fc" id="L633">            &quot;never&quot;);</span>
<span class="fc" id="L634">    }</span>

    public void testAxisFollowing() {
<span class="fc" id="L637">        assertXPathValueIterator(</span>
<span class="fc" id="L638">            context,</span>
<span class="fc" id="L639">            &quot;vendor/contact/following::location//street&quot;,</span>
<span class="fc" id="L640">            list(&quot;Orchard Road&quot;, &quot;Tangerine Drive&quot;));</span>

        // following:: with a namespace
<span class="fc" id="L643">        assertXPathValue(</span>
<span class="fc" id="L644">            context,</span>
<span class="fc" id="L645">            &quot;//location/following::price:sale/saleEnds&quot;,</span>
<span class="fc" id="L646">            &quot;never&quot;);</span>
<span class="fc" id="L647">        assertXPathPointer(context, &quot;//location[2]/following::node()[2]&quot;, &quot;/vendor[1]/product[1]&quot;);</span>
<span class="fc" id="L648">    }</span>

    public void testAxisSelf() {
        // self:: with a namespace
<span class="fc" id="L652">        assertXPathValue(</span>
<span class="fc" id="L653">            context,</span>
<span class="fc" id="L654">            &quot;//price:sale/self::price:sale/saleEnds&quot;,</span>
<span class="fc" id="L655">            &quot;never&quot;);</span>

        // self:: with an unmatching name
<span class="fc" id="L658">        assertXPathValueLenient(context, &quot;//price:sale/self::x/saleEnds&quot;, null);</span>
<span class="fc" id="L659">    }</span>

    public void testNodeTypeComment() {
        // comment()
<span class="fc" id="L663">        assertXPathValue(</span>
<span class="fc" id="L664">            context,</span>
<span class="fc" id="L665">            &quot;//product/comment()&quot;,</span>
<span class="fc" id="L666">            &quot;We are not buying this product, ever&quot;);</span>
<span class="fc" id="L667">    }</span>

    public void testNodeTypeText() {
        // text()
        //Note that this is questionable as the XPath spec tells us &quot;.&quot; is short for self::node() and text() is by definition _not_ a node:
<span class="fc" id="L672">        assertXPathValue(</span>
<span class="fc" id="L673">            context,</span>
<span class="fc" id="L674">            &quot;//product/text()[. != '']&quot;,</span>
<span class="fc" id="L675">            &quot;We love this product.&quot;);</span>

        // text() pointer
<span class="fc" id="L678">        assertXPathPointer(</span>
<span class="fc" id="L679">            context,</span>
<span class="fc" id="L680">            &quot;//product/text()&quot;,</span>
<span class="fc" id="L681">            &quot;/vendor[1]/product[1]/text()[1]&quot;);</span>

<span class="fc" id="L683">    }</span>

    public void testNodeTypeProcessingInstruction() {
        // processing-instruction() without an argument
<span class="fc" id="L687">        assertXPathValue(</span>
<span class="fc" id="L688">            context,</span>
<span class="fc" id="L689">            &quot;//product/processing-instruction()&quot;,</span>
<span class="fc" id="L690">            &quot;do not show anybody&quot;);</span>

        // processing-instruction() with an argument
<span class="fc" id="L693">        assertXPathValue(</span>
<span class="fc" id="L694">            context,</span>
<span class="fc" id="L695">            &quot;//product/processing-instruction('report')&quot;,</span>
<span class="fc" id="L696">            &quot;average only&quot;);</span>

        // processing-instruction() pointer without an argument
<span class="fc" id="L699">        assertXPathPointer(</span>
<span class="fc" id="L700">            context,</span>
<span class="fc" id="L701">            &quot;//product/processing-instruction('report')&quot;,</span>
<span class="fc" id="L702">            &quot;/vendor[1]/product[1]/processing-instruction('report')[1]&quot;);</span>

        // processing-instruction name
<span class="fc" id="L705">        assertXPathValue(</span>
<span class="fc" id="L706">            context,</span>
<span class="fc" id="L707">            &quot;name(//product/processing-instruction()[1])&quot;,</span>
<span class="fc" id="L708">            &quot;security&quot;);</span>
<span class="fc" id="L709">    }</span>

    public void testLang() {
        // xml:lang built-in attribute
<span class="fc" id="L713">        assertXPathValue(context, &quot;//product/prix/@xml:lang&quot;, &quot;fr&quot;);</span>

        // lang() used the built-in xml:lang attribute
<span class="fc" id="L716">        assertXPathValue(context, &quot;//product/prix[lang('fr')]&quot;, &quot;934.99&quot;);</span>

        // Default language
<span class="fc" id="L719">        assertXPathValue(</span>
<span class="fc" id="L720">            context,</span>
<span class="fc" id="L721">            &quot;//product/price:sale[lang('en')]/saleEnds&quot;,</span>
<span class="fc" id="L722">            &quot;never&quot;);</span>
<span class="fc" id="L723">    }</span>

    public void testDocument() {
<span class="fc" id="L726">        assertXPathValue(</span>
<span class="fc" id="L727">            context,</span>
<span class="fc" id="L728">            &quot;$document/vendor/location[1]//street&quot;,</span>
<span class="fc" id="L729">            &quot;Orchard Road&quot;);</span>

<span class="fc" id="L731">        assertXPathPointer(</span>
<span class="fc" id="L732">            context,</span>
<span class="fc" id="L733">            &quot;$document/vendor/location[1]//street&quot;,</span>
<span class="fc" id="L734">            &quot;$document/vendor[1]/location[1]/address[1]/street[1]&quot;);</span>

<span class="fc" id="L736">        assertXPathValue(context, &quot;$document/vendor//street&quot;, &quot;Orchard Road&quot;);</span>
<span class="fc" id="L737">    }</span>

    public void testContainer() {
<span class="fc" id="L740">        assertXPathValue(context, &quot;$container/vendor//street&quot;, &quot;Orchard Road&quot;);</span>

<span class="fc" id="L742">        assertXPathValue(context, &quot;$container//street&quot;, &quot;Orchard Road&quot;);</span>

<span class="fc" id="L744">        assertXPathPointer(</span>
<span class="fc" id="L745">            context,</span>
<span class="fc" id="L746">            &quot;$container//street&quot;,</span>
<span class="fc" id="L747">            &quot;$container/vendor[1]/location[1]/address[1]/street[1]&quot;);</span>

        // Conversion to number
<span class="fc" id="L750">        assertXPathValue(</span>
<span class="fc" id="L751">            context,</span>
<span class="fc" id="L752">            &quot;number(vendor/location/employeeCount)&quot;,</span>
<span class="fc" id="L753">            new Double(10));</span>
<span class="fc" id="L754">    }</span>

    public void testElementInVariable() {
<span class="fc" id="L757">        assertXPathValue(context, &quot;$element&quot;, &quot;Orchard Road&quot;);</span>
<span class="fc" id="L758">    }</span>

    public void testTypeConversions() {
        // Implicit conversion to number
<span class="fc" id="L762">        assertXPathValue(</span>
<span class="fc" id="L763">            context,</span>
<span class="fc" id="L764">            &quot;vendor/location/employeeCount + 1&quot;,</span>
<span class="fc" id="L765">            new Double(11));</span>

        // Implicit conversion to boolean
<span class="fc" id="L768">        assertXPathValue(</span>
<span class="fc" id="L769">            context,</span>
<span class="fc" id="L770">            &quot;vendor/location/employeeCount and true()&quot;,</span>
<span class="fc" id="L771">            Boolean.TRUE);</span>
<span class="fc" id="L772">    }</span>

    public void testBooleanFunction() {
<span class="fc" id="L775">        assertXPathValue(</span>
<span class="fc" id="L776">            context,</span>
<span class="fc" id="L777">            &quot;boolean(vendor//saleEnds[../@stores = 'all'])&quot;,</span>
<span class="fc" id="L778">            Boolean.TRUE);</span>

<span class="fc" id="L780">        assertXPathValue(</span>
<span class="fc" id="L781">            context,</span>
<span class="fc" id="L782">            &quot;boolean(vendor//promotion[../@stores = 'all'])&quot;,</span>
<span class="fc" id="L783">            Boolean.TRUE);</span>

<span class="fc" id="L785">        assertXPathValue(</span>
<span class="fc" id="L786">            context,</span>
<span class="fc" id="L787">            &quot;boolean(vendor//promotion[../@stores = 'some'])&quot;,</span>
<span class="fc" id="L788">            Boolean.FALSE);</span>
<span class="fc" id="L789">    }</span>
    
    public void testFunctionsLastAndPosition() {
<span class="fc" id="L792">        assertXPathPointer(</span>
<span class="fc" id="L793">                context,</span>
<span class="fc" id="L794">                &quot;vendor//location[last()]&quot;,</span>
<span class="fc" id="L795">                &quot;/vendor[1]/location[2]&quot;);</span>
<span class="fc" id="L796">    }</span>

    public void testNamespaceMapping() {
<span class="fc" id="L799">        context.registerNamespace(&quot;rate&quot;, &quot;priceNS&quot;);</span>
<span class="fc" id="L800">        context.registerNamespace(&quot;goods&quot;, &quot;productNS&quot;);</span>

<span class="fc" id="L802">        assertEquals(&quot;Context node namespace resolution&quot;, </span>
<span class="fc" id="L803">                &quot;priceNS&quot;, </span>
<span class="fc" id="L804">                context.getNamespaceURI(&quot;price&quot;));        </span>
        
<span class="fc" id="L806">        assertEquals(&quot;Registered namespace resolution&quot;, </span>
<span class="fc" id="L807">                &quot;priceNS&quot;, </span>
<span class="fc" id="L808">                context.getNamespaceURI(&quot;rate&quot;));</span>

        // child:: with a namespace and wildcard
<span class="fc" id="L811">        assertXPathValue(context, </span>
<span class="fc" id="L812">                &quot;count(vendor/product/rate:*)&quot;, </span>
<span class="fc" id="L813">                new Double(2));</span>

<span class="fc" id="L815">        assertXPathValue(context,</span>
<span class="fc" id="L816">                &quot;vendor[1]/product[1]/rate:amount[1]/@rate:discount&quot;, &quot;10%&quot;);</span>
<span class="fc" id="L817">        assertXPathValue(context,</span>
<span class="fc" id="L818">                &quot;vendor[1]/product[1]/rate:amount[1]/@price:discount&quot;, &quot;10%&quot;);</span>
<span class="fc" id="L819">        assertXPathValue(context,</span>
<span class="fc" id="L820">                &quot;vendor[1]/product[1]/price:amount[1]/@rate:discount&quot;, &quot;10%&quot;);</span>
<span class="fc" id="L821">        assertXPathValue(context,</span>
<span class="fc" id="L822">                &quot;vendor[1]/product[1]/price:amount[1]/@price:discount&quot;, &quot;10%&quot;);</span>

        // Preference for externally registered namespace prefix
<span class="fc" id="L825">        assertXPathValueAndPointer(context,</span>
<span class="fc" id="L826">                &quot;//product:name&quot;,</span>
<span class="fc" id="L827">                &quot;Box of oranges&quot;,</span>
<span class="fc" id="L828">                &quot;/vendor[1]/product[1]/goods:name[1]&quot;);</span>
        
        // Same, but with a child context        
<span class="fc" id="L831">        JXPathContext childCtx = </span>
<span class="fc" id="L832">            JXPathContext.newContext(context, context.getContextBean());</span>
<span class="fc" id="L833">        assertXPathValueAndPointer(childCtx,</span>
<span class="fc" id="L834">                &quot;//product:name&quot;,</span>
<span class="fc" id="L835">                &quot;Box of oranges&quot;,</span>
<span class="fc" id="L836">                &quot;/vendor[1]/product[1]/goods:name[1]&quot;);</span>
        
        // Same, but with a relative context        
<span class="fc" id="L839">        JXPathContext relativeCtx = </span>
<span class="fc" id="L840">            context.getRelativeContext(context.getPointer(&quot;/vendor&quot;));</span>
<span class="fc" id="L841">        assertXPathValueAndPointer(relativeCtx,</span>
<span class="fc" id="L842">                &quot;product/product:name&quot;,</span>
<span class="fc" id="L843">                &quot;Box of oranges&quot;,</span>
<span class="fc" id="L844">                &quot;/vendor[1]/product[1]/goods:name[1]&quot;);</span>
<span class="fc" id="L845">    }</span>

    public void testUnion() {
<span class="fc" id="L848">        assertXPathValue(context, &quot;/vendor[1]/contact[1] | /vendor[1]/contact[4]&quot;, &quot;John&quot;);</span>
<span class="fc" id="L849">        assertXPathValue(context, &quot;/vendor[1]/contact[4] | /vendor[1]/contact[1]&quot;, &quot;John&quot;);</span>
<span class="fc" id="L850">    }</span>

    public void testNodes() {
<span class="fc" id="L853">        Pointer pointer = context.getPointer(&quot;/vendor[1]/contact[1]&quot;);</span>
<span class="fc" id="L854">        assertFalse(pointer.getNode().equals(pointer.getValue()));</span>
<span class="fc" id="L855">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span>commons-jxpath (Jan 19, 2019 5:24:34 PM)</div></body></html>